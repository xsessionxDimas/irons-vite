{"version":3,"file":"AutoCaptureHandler.js.map","sources":["AutoCaptureHandler.js"],"sourcesContent":["/**\r\n* @copyright Microsoft 2020\r\n*/\r\nimport dynamicProto from \"@microsoft/dynamicproto-js\";\r\nimport { createUniqueNamespace, eventOff, eventOn, getDocument, getWindow, isNullOrUndefined, mergeEvtNamespace } from \"@microsoft/applicationinsights-core-js\";\r\nimport { ActionType } from \"../Enums\";\r\nimport { _DYN_ACTION_TYPE, _DYN_CAPTURE_PAGE_ACTION, _DYN_CLICK_COORDINATE_X, _DYN_CLICK_COORDINATE_Y, _DYN_CUSTOM_DATA_PREFIX, _DYN_DATA_TAGS, _DYN_INDEX_OF, _DYN_PARENT_NODE, _DYN_TAG_NAME, _DYN_TO_UPPER_CASE, _DYN__CONFIG, _DYN__DO_UNLOAD } from \"../__DynamicConstants\";\r\nimport { isElementDnt, isKeyboardEnter, isKeyboardSpace, isLeftClick, isMiddleClick, isRightClick } from \"../common/Utils\";\r\nvar clickCaptureInputTypes = { BUTTON: true, CHECKBOX: true, RADIO: true, RESET: true, SUBMIT: true };\r\nvar AutoCaptureHandler = /** @class */ (function () {\r\n    /**\r\n     * @param analyticsPlugin - WebAnalytics plugin\r\n     * @param traceLogger - Trace logger to log to console.\r\n     */\r\n    function AutoCaptureHandler(_analyticsPlugin, _config, _pageAction, _traceLogger) {\r\n        this._analyticsPlugin = _analyticsPlugin;\r\n        this._config = _config;\r\n        this._pageAction = _pageAction;\r\n        this._traceLogger = _traceLogger;\r\n        var _evtNamespace = mergeEvtNamespace(createUniqueNamespace(\"AutoCaptureHandler\"), _analyticsPlugin._evtNamespace);\r\n        dynamicProto(AutoCaptureHandler, this, function (_self) {\r\n            _self.click = function () {\r\n                var win = getWindow();\r\n                var doc = getDocument();\r\n                if (win) {\r\n                    // IE9 onwards addEventListener is available, 'click' event captures mouse click. mousedown works on other browsers\r\n                    var event_1 = (navigator.appVersion[_DYN_INDEX_OF /* @min:%2eindexOf */](\"MSIE\") !== -1) ? \"click\" : \"mousedown\";\r\n                    eventOn(win, event_1, _processClick, _evtNamespace);\r\n                    eventOn(win, \"keyup\", _processClick, _evtNamespace);\r\n                }\r\n                else if (doc) {\r\n                    // IE8 and below doesn't have addEventListener so it will use attachEvent\r\n                    // attaching to window does not work in IE8\r\n                    eventOn(doc, \"click\", _processClick, _evtNamespace);\r\n                    eventOn(doc, \"keyup\", _processClick, _evtNamespace);\r\n                }\r\n            };\r\n            _self[_DYN__DO_UNLOAD /* @min:%2e_doUnload */] = function (unloadCtx, unloadState, asyncCallback) {\r\n                eventOff(getWindow(), null, null, _evtNamespace);\r\n                eventOff(getDocument(), null, null, _evtNamespace);\r\n            };\r\n            function _capturePageAction(element, overrideValues, customProperties, isRightClick) {\r\n                var donotTrackTag = _self._config.dataTags[_DYN_CUSTOM_DATA_PREFIX /* @min:%2ecustomDataPrefix */] + _self[_DYN__CONFIG /* @min:%2e_config */][_DYN_DATA_TAGS /* @min:%2edataTags */].dntDataTag;\r\n                if (!isElementDnt(element, donotTrackTag)) {\r\n                    _self._pageAction[_DYN_CAPTURE_PAGE_ACTION /* @min:%2ecapturePageAction */](element, overrideValues, customProperties, isRightClick);\r\n                }\r\n            }\r\n            // Process click event\r\n            function _processClick(clickEvent) {\r\n                var _a;\r\n                var clickCaptureElements = { A: true, BUTTON: true, AREA: true, INPUT: true };\r\n                var win = getWindow();\r\n                if (isNullOrUndefined(clickEvent) && win) {\r\n                    clickEvent = win.event; // IE 8 does not pass the event\r\n                }\r\n                if (clickEvent) {\r\n                    var element = clickEvent.srcElement || clickEvent.target;\r\n                    // populate overrideValues\r\n                    var overrideValues = (_a = {},\r\n                        _a[_DYN_CLICK_COORDINATE_X /* @min:clickCoordinateX */] = clickEvent.pageX,\r\n                        _a[_DYN_CLICK_COORDINATE_Y /* @min:clickCoordinateY */] = clickEvent.pageY,\r\n                        _a);\r\n                    var isRightClickObj = isRightClick(clickEvent);\r\n                    if (isRightClickObj) {\r\n                        overrideValues[_DYN_ACTION_TYPE /* @min:%2eactionType */] = ActionType.CLICKRIGHT;\r\n                    }\r\n                    else if (isLeftClick(clickEvent)) {\r\n                        overrideValues[_DYN_ACTION_TYPE /* @min:%2eactionType */] = ActionType.CLICKLEFT;\r\n                    }\r\n                    else if (isKeyboardEnter(clickEvent)) {\r\n                        overrideValues[_DYN_ACTION_TYPE /* @min:%2eactionType */] = ActionType.KEYBOARDENTER;\r\n                    }\r\n                    else if (isKeyboardSpace(clickEvent)) {\r\n                        overrideValues[_DYN_ACTION_TYPE /* @min:%2eactionType */] = ActionType.KEYBOARDSPACE;\r\n                    }\r\n                    else if (isMiddleClick(clickEvent)) {\r\n                        overrideValues[_DYN_ACTION_TYPE /* @min:%2eactionType */] = ActionType.CLICKMIDDLE;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                    while (element && element[_DYN_TAG_NAME /* @min:%2etagName */]) {\r\n                        // control property will be available for <label> elements with 'for' attribute, only use it when is a\r\n                        // valid JSLL capture element to avoid infinite loops\r\n                        if (element.control && clickCaptureElements[element.control[_DYN_TAG_NAME /* @min:%2etagName */][_DYN_TO_UPPER_CASE /* @min:%2etoUpperCase */]()]) {\r\n                            element = element.control;\r\n                        }\r\n                        var tagNameUpperCased = element[_DYN_TAG_NAME /* @min:%2etagName */][_DYN_TO_UPPER_CASE /* @min:%2etoUpperCase */]();\r\n                        if (!clickCaptureElements[tagNameUpperCased]) {\r\n                            element = element.parentElement || element[_DYN_PARENT_NODE /* @min:%2eparentNode */];\r\n                            continue;\r\n                        }\r\n                        else {\r\n                            // Check allowed INPUT types\r\n                            var sendEvent = tagNameUpperCased === \"INPUT\" ? clickCaptureInputTypes[element.type[_DYN_TO_UPPER_CASE /* @min:%2etoUpperCase */]()] : true;\r\n                            if (sendEvent) {\r\n                                _capturePageAction(element, overrideValues, {}, isRightClickObj);\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    // handle automatic event firing on user click\r\n    AutoCaptureHandler.prototype.click = function () {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    AutoCaptureHandler.prototype._doUnload = function (unloadCtx, unloadState, asyncCallback) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    return AutoCaptureHandler;\r\n}());\r\nexport { AutoCaptureHandler };\r\n//# sourceMappingURL=AutoCaptureHandler.js.map"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;2DAKM,CAAC;;;;;8BACuB;AAC9B;AACA;AACA"}