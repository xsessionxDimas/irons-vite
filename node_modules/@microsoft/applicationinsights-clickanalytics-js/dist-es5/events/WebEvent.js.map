{"version":3,"file":"WebEvent.js.map","sources":["WebEvent.js"],"sourcesContent":["/**\r\n* @copyright Microsoft 2020\r\n*/\r\nimport dynamicProto from \"@microsoft/dynamicproto-js\";\r\nimport { getLocation, hasWindow, objExtend } from \"@microsoft/applicationinsights-core-js\";\r\nimport { getPageName, getUri } from \"../DataCollector\";\r\nimport { _DYN_BEHAVIOR, _DYN_BEHAVIOR_VALIDATOR, _DYN_CORE_DATA, _DYN_NAME, _DYN_PAGE_NAME, _DYN_PAGE_TYPE, _DYN_PROPERTIES, _DYN_SET_BASIC_PROPERTIES, _DYN_SET_COMMON_PROPERTIE4, _DYN__BEHAVIOR_META_TAG, _DYN__CONFIG, _DYN__DO_UNLOAD, _DYN__GET_VALID_BEHAVIOR, _DYN__META_TAGS, _DYN__PAGE_TAGS, _DYN__PAGE_TAGS_CALLBACK, _DYN__PAGE_TYPE_META_TAG, _DYN__TRACE_LOGGER } from \"../__DynamicConstants\";\r\nimport { isValueAssigned } from \"../common/Utils\";\r\nvar WebEvent = /** @class */ (function () {\r\n    /**\r\n     * @param clickAnalyticsPlugin - Click Analytics plugin instance\r\n     * @param config - ClickAnalytics configuration object\r\n     * @param contentHandler - Content handler\r\n     * @param id - Id object\r\n     * @param pageTagsCallback - callback methods to get pageTags value\r\n     * @param metaTags - Meta tags\r\n     * @param traceLogger - Trace logger to log to console.\r\n     */\r\n    function WebEvent(clickAnalyticsPlugin, config, contentHandler, pageTagsCallback, metaTags, traceLogger) {\r\n        dynamicProto(WebEvent, this, function (_self) {\r\n            _initDefaults();\r\n            function _initDefaults() {\r\n                _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */] = {};\r\n                _self._clickAnalyticsPlugin = clickAnalyticsPlugin;\r\n                _self[_DYN__CONFIG /* @min:%2e_config */] = config;\r\n                _self._contentHandler = contentHandler;\r\n                _self[_DYN__PAGE_TAGS_CALLBACK /* @min:%2e_pageTagsCallback */] = pageTagsCallback;\r\n                _self[_DYN__META_TAGS /* @min:%2e_metaTags */] = metaTags;\r\n                _self[_DYN__TRACE_LOGGER /* @min:%2e_traceLogger */] = traceLogger;\r\n            }\r\n            _self[_DYN_SET_BASIC_PROPERTIES /* @min:%2esetBasicProperties */] = function (event, overrideValues) {\r\n                if (!isValueAssigned(event[_DYN_NAME /* @min:%2ename */])) {\r\n                    event[_DYN_PAGE_NAME /* @min:%2epageName */] = getPageName(_self[_DYN__CONFIG /* @min:%2e_config */], overrideValues);\r\n                }\r\n                if (!isValueAssigned(event.uri) && hasWindow()) {\r\n                    event.uri = getUri(_self[_DYN__CONFIG /* @min:%2e_config */], getLocation());\r\n                }\r\n            };\r\n            /**\r\n             * Sets common properties for events that are based on the WebEvent schema.\r\n             * @param event - The event\r\n             */\r\n            _self[_DYN_SET_COMMON_PROPERTIE4 /* @min:%2esetCommonProperties */] = function (event, overrideValues) {\r\n                _self[_DYN_SET_BASIC_PROPERTIES /* @min:%2esetBasicProperties */](event, overrideValues);\r\n                _self._setPageTags(event, overrideValues);\r\n                // extract specific meta tags out of the pageTags.metaTags collection.  These will go into assigned first class fields in the event.\r\n                // the rest will go into pageTags.metaTags collection as is.\r\n                _self._pageTypeMetaTag = _getMetaData(_self._metaTags, _self._config[_DYN_CORE_DATA /* @min:%2ecoreData */], \"pageType\");\r\n                _self._behaviorMetaTag = _getMetaData(_self._metaTags, _self._config[_DYN_CORE_DATA /* @min:%2ecoreData */], \"behavior\");\r\n                if (isValueAssigned(overrideValues[_DYN_PAGE_TYPE /* @min:%2epageType */])) {\r\n                    event[_DYN_PAGE_TYPE /* @min:%2epageType */] = overrideValues[_DYN_PAGE_TYPE /* @min:%2epageType */];\r\n                }\r\n                // Only assign if not overriden and meta data is available\r\n                if (isValueAssigned(_self._pageTypeMetaTag) && !isValueAssigned(event[_DYN_PAGE_TYPE /* @min:%2epageType */])) {\r\n                    event[_DYN_PAGE_TYPE /* @min:%2epageType */] = _self[_DYN__PAGE_TYPE_META_TAG /* @min:%2e_pageTypeMetaTag */];\r\n                }\r\n            };\r\n            /**\r\n             * Sets pageTags.\r\n             * @param event - The event\r\n             */\r\n            _self._setPageTags = function (event, overrideValues) {\r\n                // Prepare the pageTags object that is mostly the same for all events.  Event specific pageTags will be added inside event constructors.\r\n                if (_self[_DYN__PAGE_TAGS_CALLBACK /* @min:%2e_pageTagsCallback */]) {\r\n                    _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */] = objExtend(true, _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */], _self[_DYN__PAGE_TAGS_CALLBACK /* @min:%2e_pageTagsCallback */]());\r\n                }\r\n                if (isValueAssigned(overrideValues.pageTags)) {\r\n                    _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */] = objExtend(true, _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */], overrideValues.pageTags);\r\n                }\r\n                // If metadata is present add it to pageTags property\r\n                if (_self[_DYN__META_TAGS /* @min:%2e_metaTags */]) {\r\n                    _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */].metaTags = {};\r\n                    // Remove not supported meta data in pageTags.metaTags\r\n                    for (var metaTag in _self[_DYN__META_TAGS /* @min:%2e_metaTags */]) {\r\n                        if (metaTag != \"behavior\" && metaTag != \"market\" && metaTag != \"pageType\") {\r\n                            _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */].metaTags[metaTag] = _self[_DYN__META_TAGS /* @min:%2e_metaTags */][metaTag];\r\n                        }\r\n                    }\r\n                }\r\n                // All metadata tags that must be saved as properties have been extracted at this point.  Assign pageTags as is.\r\n                event[_DYN_PROPERTIES /* @min:%2eproperties */] = event[_DYN_PROPERTIES /* @min:%2eproperties */] || {};\r\n                event[_DYN_PROPERTIES /* @min:%2eproperties */][\"pageTags\"] = _self[_DYN__PAGE_TAGS /* @min:%2e_pageTags */];\r\n            };\r\n            _self._getBehavior = function (overrideValues) {\r\n                var behavior;\r\n                // If override specified\r\n                if (overrideValues && isValueAssigned(overrideValues[_DYN_BEHAVIOR /* @min:%2ebehavior */])) {\r\n                    behavior = overrideValues[_DYN_BEHAVIOR /* @min:%2ebehavior */];\r\n                }\r\n                else if (isValueAssigned(_self[_DYN__BEHAVIOR_META_TAG /* @min:%2e_behaviorMetaTag */])) {\r\n                    // If behavior meta tag available\r\n                    behavior = _self[_DYN__BEHAVIOR_META_TAG /* @min:%2e_behaviorMetaTag */];\r\n                }\r\n                return _self[_DYN__GET_VALID_BEHAVIOR /* @min:%2e_getValidBehavior */](behavior);\r\n            };\r\n            _self[_DYN__GET_VALID_BEHAVIOR /* @min:%2e_getValidBehavior */] = function (behavior) {\r\n                return _self._config[_DYN_BEHAVIOR_VALIDATOR /* @min:%2ebehaviorValidator */](behavior);\r\n            };\r\n            _self[_DYN__DO_UNLOAD /* @min:%2e_doUnload */] = function (unloadCtx, unloadState, asyncCallback) {\r\n                _initDefaults();\r\n            };\r\n            /**\r\n             * Get the specified metadata value from the collection\r\n             * If overrideValue is specified in the config that takes precedence.\r\n             * @param metaTags - Meta data.\r\n             * @param coreData - Coredata values from configuration.\r\n             * @param metaTagName - Name of the metaTag to get.\r\n             * @returns Meta data value\r\n             */\r\n            function _getMetaData(metaTags, coreData, metaTagName) {\r\n                if (coreData && coreData[metaTagName]) {\r\n                    return coreData[metaTagName];\r\n                }\r\n                if (metaTags) {\r\n                    return metaTags[metaTagName];\r\n                }\r\n                return \"\";\r\n            }\r\n        });\r\n    }\r\n    // Fill common PartB fields\r\n    WebEvent.prototype.setBasicProperties = function (event, overrideValues) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    /**\r\n     * Sets common properties for events that are based on the WebEvent schema.\r\n     * @param event - The event\r\n     */\r\n    WebEvent.prototype.setCommonProperties = function (event, overrideValues) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    /**\r\n     * Teardown / Unload hook to allow implementations to perform some additional unload operations before the BaseTelemetryPlugin\r\n     * finishes it's removal.\r\n     * @param unloadCtx - This is the context that should be used during unloading.\r\n     * @param unloadState - The details / state of the unload process, it holds details like whether it should be unloaded synchronously or asynchronously and the reason for the unload.\r\n     * @param asyncCallback - An optional callback that the plugin must call if it returns true to inform the caller that it has completed any async unload/teardown operations.\r\n     * @returns boolean - true if the plugin has or will call asyncCallback, this allows the plugin to perform any asynchronous operations.\r\n     */\r\n    WebEvent.prototype._doUnload = function (unloadCtx, unloadState, asyncCallback) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    /**\r\n     * Sets pageTags.\r\n     * @param event - The event\r\n     */\r\n    WebEvent.prototype._setPageTags = function (event, overrideValues) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    WebEvent.prototype._getBehavior = function (overrideValues) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n        return null;\r\n    };\r\n    WebEvent.prototype._getValidBehavior = function (behavior) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n        return null;\r\n    };\r\n    return WebEvent;\r\n}());\r\nexport { WebEvent };\r\n//# sourceMappingURL=WebEvent.js.map"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;yDAmCM,CAAC;;;;;oBACa;AACpB;AACA;AACA"}