import{k as pe,r as w,c as u,ac as _e,u as v,p as l,aa as a,s as g,x as H,A as x,n as ve,R as O,S as ue,aB as e,C as _,F as m,$ as b,b6 as j,B as he,y as S,a2 as T,b4 as me,bd as fe,bb as ye}from"./@vue-BypzYtbH.js";import{f as k}from"./number-format-BdMuQVyW.js";import{d as U,_ as xe,a as be}from"./manipulate-file-oif_A7gg.js";import{d as we}from"./manipulate-html-string-DqTEGh-F.js";import{a as ge}from"./element-plus-BeWdvTRa.js";import{l as ke,F as V,G as De}from"./helpers-wUOLw-dU.js";import{d as $,e as q}from"./@progress-DBKeVTWA.js";import{s as z}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{P as Pe}from"./pdf-merger-js-DY3-eECH.js";import{u as Ie}from"./useHistoricalEformDmaStore-Fo4tKNgB.js";import{u as Fe}from"./useAttachmentStore-DqM3autD.js";import{s as G}from"./urls-CPQ2HRXU.js";import{e as Q}from"./lodash-DrHMlsdo.js";import{v as Se}from"./uuid-SoommWqA.js";import{_ as Te}from"./nw-img-vue-CR837WER.js";const s=D=>(fe("data-v-54d63327"),D=D(),ye(),D),Ee={key:0,class:"hiddenContainer"},Me=["id"],Re={class:"report-header mb-2"},Ae=s(()=>e("div",{class:"el-dialog__title avoid prevent-split"}," Detailed Information for Defect Identification ",-1)),He=["innerHTML"],Le={class:"el-dialog__title task-title download-by avoid prevent-split"},Ne={class:"mt-1 py-2"},Ce={class:"row mb-1"},Be={class:"col"},Oe={key:0,class:"form-floating approved-text-box"},je={class:"form-control",style:{"white-space":"break-spaces"}},Ue=s(()=>e("label",null,"Approved",-1)),Ve={class:"d-flex flex-row justify-content-between"},$e={class:"d-flex flex-row flex-grow-1 prevent-split"},qe={class:"flex-fill"},ze={class:"form-floating"},Ge=["innerHTML"],Qe=s(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),We={class:"flex-fill ps-3"},Je={class:"form-floating"},Ke=["innerHTML"],Xe=s(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),Ye={class:"flex-fill ps-3"},Ze={class:"form-floating"},et=["innerHTML"],tt=s(()=>e("label",{for:"floatingInput"},"Ownership",-1)),st=s(()=>e("div",{class:"mt-2"},null,-1)),ot={class:"report task-group general-accordion py-1 px-5"},it=s(()=>e("div",{class:"avoid prevent-split"},[e("h4",{class:"title ps-3"},"Photo of the defect identified (optional)")],-1)),lt={class:"report_section_body"},at={class:"p-2 d-flex"},nt={class:"d-flex flex-column"},ct=["src","alt"],rt={class:"image-carousel-description"},dt=s(()=>e("div",{class:"description-title"},"Description",-1)),pt={class:"description-text"},_t={style:{"font-family":"'Public sans', sans-serif !important","font-size":"14px","word-break":"break-word","white-space":"break-spaces"}},vt={class:"mt-1 mb-2 avoid prevent-split"},ut={class:"desc-wrapper"},ht=s(()=>e("p",{class:"desc-wrapper-title"},"Defect Identified Description",-1)),mt={class:"desc-wrapper-content"},ft={class:"desc-wrapper-content-pre"},yt={class:"mt-1 mb-2"},xt={class:"pe-0"},bt={class:"form-floating",avoid:""},wt=["value"],gt=s(()=>e("label",null,"Raised By",-1)),kt={class:"mt-1 mb-2"},Dt={class:"row m-0"},Pt={class:"col-4 p-0 date"},It={class:"form-floating avoid prevent-split"},Ft=["value"],St=s(()=>e("label",null,"Date Raised",-1)),Tt={class:"col pe-0 d-flex"},Et={class:"d-flex flex-column flex-fill"},Mt={class:"form-floating avoid prevent-split"},Rt=["value"],At=s(()=>e("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Ht={class:"ms-2 d-flex align-items-center"},Lt={class:"mt-1 mb-2 avoid prevent-split"},Nt={class:"desc-wrapper"},Ct=s(()=>e("p",{class:"desc-wrapper-title"},"Defect Repair instruction",-1)),Bt={class:"desc-wrapper-content"},Ot={class:"desc-wrapper-content-pre"},jt=s(()=>e("div",{class:"mt-2"},null,-1)),Ut={class:"report task-group general-accordion py-1 px-5"},Vt=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Priority")],-1)),$t={class:"report_section_body"},qt=s(()=>e("div",{class:"row p-3 m-1 priority-container avoid prevent-split",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1)),zt={key:0,class:"row p-3 m-1 priority-container avoid prevent-split"},Gt={class:"col-3 p-0"},Qt={class:"form-check"},Wt=s(()=>e("label",{class:"form-check-label"}," (P1) Immediate ",-1)),Jt=s(()=>e("div",{class:"col-6"},"Shall shut machine down and undertake repairs.",-1)),Kt=s(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Xt={key:1,class:"row p-3 m-1 priority-container avoid prevent-split"},Yt={class:"col-3 p-0"},Zt={class:"form-check"},es=s(()=>e("label",{class:"form-check-label"}," (P2) Urgent ",-1)),ts=s(()=>e("div",{class:"col-6"},"Shall complete within 7 days.",-1)),ss=s(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),os={key:2,class:"row p-3 m-1 priority-container avoid prevent-split"},is={class:"col-3 p-0"},ls={class:"form-check"},as=s(()=>e("label",{class:"form-check-label"}," (P3) Routine ",-1)),ns=s(()=>e("div",{class:"col-6"},"Shall complete within 60 days.",-1)),cs=s(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),rs={key:3,class:"row p-3 m-1 priority-container avoid prevent-split"},ds={class:"col-3 p-0"},ps={class:"form-check"},_s=s(()=>e("label",{class:"form-check-label"}," (P4) Monitor ",-1)),vs=s(()=>e("div",{class:"col-6"},"Shall continue to inspect and monitor for 90 days.",-1)),us=s(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),hs=s(()=>e("div",{class:"mt-2"},null,-1)),ms={class:"report task-group general-accordion py-1 px-5"},fs=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Parts Required")],-1)),ys={class:"report_section_body"},xs=s(()=>e("div",{class:"row p-3 m-1 priority-container avoid prevent-split",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Part Number"),e("div",{class:"col-5"},"Part Description"),e("div",{class:"col-1"},"Qty"),e("div",{class:"col"}),e("div",{class:"col"})],-1)),bs={class:"col-3 px-0"},ws={class:"d-flex flex-column"},gs=["value"],ks={class:"col-5"},Ds={class:"d-flex flex-column"},Ps=["value"],Is={class:"col-1 px-1 d-flex justify-content-start"},Fs={class:"d-flex flex-column"},Ss=["value"],Ts={class:"col px-1 d-flex flex-column justify-content-start"},Es={class:"row p-0 m-0 h-100 w-100 align-items-center"},Ms={class:"col px-1 d-flex flex-column justify-content-start position-relative"},Rs={class:"row p-0 m-0 h-100 w-100 align-items-center"},As=s(()=>e("div",{class:"mt-2"},null,-1)),Hs={class:"report task-group general-accordion py-1 px-5"},Ls=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Labour Required")],-1)),Ns={class:"report_section_body"},Cs=s(()=>e("div",{class:"row p-3 m-1 priority-container avoid prevent-split",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-6"},"Labour Activity"),e("div",{class:"col-2"},"Qty"),e("div",{class:"col-2 word-breaker"},"Hours Each"),e("div",{class:"col-2 word-breaker"},"Total Hours")],-1)),Bs={class:"col-6 px-0"},Os={class:"d-flex flex-column"},js=["value"],Us={class:"col-2 d-flex justify-content-start"},Vs={class:"d-flex flex-column"},$s=["value"],qs={class:"col-2 d-flex justify-content-start"},zs={class:"d-flex flex-column"},Gs=["value"],Qs={class:"col-2 d-flex justify-content-start"},Ws={class:"d-flex flex-column"},Js=["value"],Ks=s(()=>e("div",{class:"mt-2"},null,-1)),Xs={class:"report task-group general-accordion py-1 px-5"},Ys=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Other Resources Required (optional)")],-1)),Zs={class:"report_section_body"},eo={class:"d-flex flex-fill flex-column"},to=["value"],so=s(()=>e("div",{class:"mt-2"},null,-1)),oo={class:"report task-group general-accordion py-1 px-5"},io=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Defect Symptom")],-1)),lo={class:"report_section_body"},ao={class:"d-flex flex-fill flex-column"},no=["value"],co={key:0,class:"mt-2 avoid prevent-split"},ro={class:"desc-wrapper"},po=s(()=>e("p",{class:"desc-wrapper-title"},"Description",-1)),_o={class:"desc-wrapper-content"},vo={class:"desc-wrapper-content-pre"},uo=s(()=>e("div",{class:"mt-2"},null,-1)),ho={class:"report task-group general-accordion py-1 px-5"},mo=s(()=>e("div",{class:"report_section_header avoid prevent-split"},[e("h4",{class:"title ps-3"},"Defect Cause")],-1)),fo={class:"report_section_body"},yo={class:"d-flex flex-fill flex-column"},xo=["value"],bo={key:0,class:"mt-2 avoid prevent-split"},wo={class:"desc-wrapper"},go=s(()=>e("p",{class:"desc-wrapper-title"},"Description",-1)),ko={class:"desc-wrapper-content"},Do={class:"desc-wrapper-content-pre"},Po={key:0},Io={class:"p-2 d-flex"},Fo={class:"d-flex flex-column"},So=["src","alt"],To={class:"image-carousel-description"},Eo=s(()=>e("div",{class:"description-title"},"Description",-1)),Mo={class:"description-text"},Ro={style:{"font-family":"'Public sans' !important","font-size":"14px","word-break":"break-word","white-space":"break-spaces"}},Ao=pe({__name:"DefectForm",emits:["onDownloadFinish"],setup(D,{expose:W,emit:J}){const h=w(-1),K=J,p=Ie(),X=Fe(),L=w(),N=w(),E=w(),Y=Se(),o=u(()=>"previousCracks"in p.DefectDetailDownload?{}:p.DefectDetailDownload),Z=u(()=>p.TimeStamp),C=u(()=>p.FileName),ee=u(()=>p.IsIntervention),te=u(()=>p.SerialNumber),se=u(()=>p.OwnerShip),M=u(()=>p.IsAttachmentIncludeDownload),P=u(()=>p.ApprovalDefectDownload),B=d=>d.dimension.width>850?De(d.dimension.width,d.dimension.height,850):d.dimension,I=w([]),R=w([]),oe=()=>{E.value=ge.service({lock:!0,text:"Generating PDF",background:"rgba(0, 0, 0, 0.7)"}),I.value=[],R.value=[];let d=[];o.value.images&&o.value.images.length>0&&z(o.value.images).forEach(r=>{d.push(new Promise(n=>{p.loadImage(r.filename).then(t=>{n(t)}).catch(()=>{n({})})}))}),M.value&&o.value.parts&&o.value.parts.length>0&&o.value.parts.forEach(c=>{Q.isArray(c.images)&&c.images.length>0&&z(c.images).forEach(n=>{d.push(new Promise(t=>{p.loadImage(n.filename).then(i=>{t(i)})}))})}),Promise.allSettled(d).then(async c=>{const r=c.map(n=>{if(n.status==="fulfilled"&&n.value!=null)return n.value}).filter(n=>n!==void 0);if(c.length>0&&r.length>0){const n=o.value.images.map(i=>({id:i.filename,desc:i.description}));I.value=V(r,n),I.value.forEach(i=>{i.dimension=B(i)});const t=[];M.value&&(o.value.parts.forEach(i=>{const f=[];i.images.forEach(y=>{f.push({id:y.filename,desc:y.description})}),t.push(f)}),R.value=t.map(i=>{const f=V(r,i);return f.forEach(y=>{y.dimension=B(y)}),f}))}setTimeout(async()=>{await le()},1e3)})},ie=_e({render:function(){return ue("div",{style:{position:"absolute",bottom:"10px",right:"15px"}})}}),le=async()=>{const d={forcePageBreak:".page-break",paperSize:"A4",scale:.6,fileName:C.value,pageTemplate:ie,keepTogether:".prevent-split",margin:{top:"1cm",right:"1cm",bottom:"1cm",left:"1cm"}},c={...d,margin:"1cm"};$(L.value,d).then(r=>{var n;try{return q(r,c)}catch{return p.resetAfterDownload(),(n=E.value)==null||n.close(),null}}).then(async r=>{if(r){const n=await U(r,"temp.pdf"),t=new Pe;if(await t.add(n),M.value&&o.value.parts.length>0)for(let i=0;i<o.value.parts.length;i++){h.value=i,await ve();const f=await $(N.value,d),y=await q(f,c),ne=U(y,"temp.pdf");await t.add(ne);const F=o.value.parts[i].attachment;if(F&&F.length>0)for(let A=0;A<F.length;A++){const ce=await X.downloadAttachmentPDF(F[A].url),re=new Blob([ce],{type:"application/pdf"}),de=new File([re],"temp.pdf");await t.add(de)}}await t.save(C.value),K("onDownloadFinish")}}).catch(r=>{console.log(r)}).finally(()=>{var r;p.resetAfterDownload(),(r=E.value)==null||r.close()})};W({handleDataFetch:oe});const ae=u(()=>ke(se.value));return(d,c)=>{const r=O("Label"),n=O("pdfexport");return v(Q.isEmpty)(o.value)?x("",!0):(l(),a("div",Ee,[g(n,{ref_key:"contentToExport",ref:L},{default:H(()=>[e("div",{id:v(Y),class:"defect-review-eform",style:{width:"100%"}},[e("div",Re,[Ae,e("div",{class:"el-dialog__title task-title avoid prevent-split",innerHTML:v(we)(o.value.title,ee.value)},null,8,He),e("div",Le,"Downloaded by "+_(Z.value),1)]),e("div",Ne,[e("div",Ce,[e("div",Be,[P.value.approvedBy&&P.value.approvedDate?(l(),a("div",Oe,[e("div",je,_(P.value.approvedDate)+" â€” "+_(P.value.approvedBy.name),1),Ue])):x("",!0)])])]),e("div",Ve,[e("div",$e,[e("div",qe,[e("div",ze,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:o.value.assetNumber},null,8,Ge),Qe])]),e("div",We,[e("div",Je,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:te.value},null,8,Ke),Xe])]),e("div",Ye,[e("div",Ze,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:ae.value},null,8,et),tt])])])]),st,e("div",ot,[it,e("div",lt,[(l(!0),a(m,null,b(I.value,t=>(l(),a("div",{key:t.id,class:"my-1 d-flex justify-content-between avoid w-100"},[e("div",at,[e("div",nt,[e("img",{src:t.buffer,class:"report_section_body--image",style:j(t.dimension?`height: ${t.dimension.height}px; width: ${t.dimension.width}px;`:""),alt:t.id},null,12,ct),e("div",rt,[dt,e("div",pt,[e("pre",_t,_(decodeURIComponent(t.desc)),1)])])])])]))),128))])]),e("div",vt,[e("div",ut,[ht,e("div",mt,[e("pre",ft,_(o.value.description),1)])])]),e("div",yt,[e("div",xt,[e("div",bt,[e("input",{type:"text",class:"form-control",disabled:"",value:o.value.raisedBy},null,8,wt),gt])])]),e("div",kt,[e("div",Dt,[e("div",Pt,[e("div",It,[e("input",{type:"text",class:"form-control",disabled:"",value:o.value.date},null,8,Ft),St])]),e("div",Tt,[e("div",Et,[e("div",Mt,[e("input",{type:"text",class:"form-control",value:v(k)(o.value.plannedDuration),disabled:""},null,8,Rt),At])]),e("div",Ht,[g(r,null,{default:H(()=>[he("Hours")]),_:1})])])])]),e("div",Lt,[e("div",Nt,[Ct,e("div",Bt,[e("pre",Ot,_(o.value.instruction),1)])])]),jt,e("div",Ut,[Vt,e("div",$t,[qt,o.value.priority=="P1"?(l(),a("div",zt,[e("div",Gt,[e("div",Qt,[S(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":c[0]||(c[0]=t=>o.value.priority=t),value:"P1",disabled:""},null,512),[[T,o.value.priority]]),Wt])]),Jt,Kt])):o.value.priority=="P2"?(l(),a("div",Xt,[e("div",Yt,[e("div",Zt,[S(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":c[1]||(c[1]=t=>o.value.priority=t),value:"P2",disabled:""},null,512),[[T,o.value.priority]]),es])]),ts,ss])):o.value.priority=="P3"?(l(),a("div",os,[e("div",is,[e("div",ls,[S(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":c[2]||(c[2]=t=>o.value.priority=t),value:"P3",disabled:""},null,512),[[T,o.value.priority]]),as])]),ns,cs])):o.value.priority=="P4"?(l(),a("div",rs,[e("div",ds,[e("div",ps,[S(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":c[3]||(c[3]=t=>o.value.priority=t),value:"P4",disabled:""},null,512),[[T,o.value.priority]]),_s])]),vs,us])):x("",!0)])]),hs,e("div",ms,[fs,e("div",ys,[xs,(l(!0),a(m,null,b(o.value.parts,(t,i)=>(l(),a("div",{class:"row p-3 m-1 priority-container px-0 avoid prevent-split",key:i},[e("div",bs,[e("div",ws,[e("input",{type:"text",class:"form-control",value:t.partNumber,disabled:""},null,8,gs)])]),e("div",ks,[e("div",Ds,[e("input",{type:"text",class:"form-control",value:t.partDescription,disabled:""},null,8,Ps)])]),e("div",Is,[e("div",Fs,[e("input",{class:"form-control",value:v(k)(t.qty),disabled:""},null,8,Ss)]),e("div",{class:me(["ms-4 d-flex align-items-center",i===0?"hidden":""])},null,2)]),e("div",Ts,[e("div",Es,[g(xe,{index:i,"item-value":t.images||[],"is-disabled":!0},null,8,["index","item-value"])])]),e("div",Ms,[e("div",Rs,[g(be,{index:i,"item-value":t.attachment||[],"is-disabled":!0},null,8,["index","item-value"])])])]))),128))])]),As,e("div",Hs,[Ls,e("div",Ns,[Cs,(l(!0),a(m,null,b(o.value.labours,t=>(l(),a("div",{class:"row p-3 m-1 priority-container ps-0 avoid prevent-split",key:t.position},[e("div",Bs,[e("div",Os,[e("input",{type:"text",class:"form-control",value:t.position,disabled:""},null,8,js)])]),e("div",Us,[e("div",Vs,[e("input",{class:"form-control",value:v(k)(t.qty),disabled:""},null,8,$s)])]),e("div",qs,[e("div",zs,[e("input",{class:"form-control",value:v(k)(t.hireEach),disabled:""},null,8,Gs)])]),e("div",Qs,[e("div",Ws,[e("input",{class:"form-control",value:v(k)(t.totalHours),disabled:""},null,8,Js)])])]))),128))])]),Ks,e("div",Xs,[Ys,e("div",Zs,[(l(!0),a(m,null,b(o.value.resources,(t,i)=>(l(),a("div",{class:"p-2 d-flex",key:i},[e("div",eo,[e("input",{type:"text",class:"form-control avoid prevent-split",value:t,disabled:""},null,8,to)])]))),128))])]),so,e("div",oo,[io,e("div",lo,[(l(!0),a(m,null,b(o.value.symptoms,(t,i)=>(l(),a("div",{class:"p-2 d-flex",key:i},[e("div",ao,[e("input",{type:"text",class:"form-control avoid prevent-split",value:t.split(":")[0],disabled:""},null,8,no),t.split(":")[0]==="Other"?(l(),a("div",co,[e("div",ro,[po,e("div",_o,[e("pre",vo,_(v(G)(t)),1)])])])):x("",!0)])]))),128))])]),uo,e("div",ho,[mo,e("div",fo,[(l(!0),a(m,null,b(o.value.causes,(t,i)=>(l(),a("div",{class:"p-2 d-flex",key:i},[e("div",yo,[e("input",{type:"text",class:"form-control avoid prevent-split",value:t.split(":")[0],disabled:""},null,8,xo),t.split(":")[0]==="Other"?(l(),a("div",bo,[e("div",wo,[go,e("div",ko,[e("pre",Do,_(v(G)(t)),1)])])])):x("",!0)])]))),128))])])],8,Me)]),_:1},512),g(n,{ref_key:"contentToExportPart",ref:N},{default:H(()=>[h.value==0?(l(),a("div",Po,"Attachment Photo and File - Parts Required")):x("",!0),h.value>=0&&o.value.parts[h.value]?(l(),a(m,{key:1},[e("div",null,_(h.value+1)+". "+_(o.value.parts[h.value].partNumber)+" "+_(o.value.parts[h.value].partDescription),1),(l(!0),a(m,null,b(R.value[h.value],t=>(l(),a("div",{key:t.id,class:"my-1 d-flex justify-content-between avoid w-100"},[e("div",Io,[e("div",Fo,[e("img",{src:t.buffer,class:"report_section_body--image",style:j(t.dimension?`height: ${t.dimension.height}px; width: ${t.dimension.width}px;`:""),alt:t.id},null,12,So),e("div",To,[Eo,e("div",Mo,[e("pre",Ro,_(decodeURIComponent(t.desc)),1)])])])])]))),128))],64)):x("",!0)]),_:1},512)]))}}}),Jo=Te(Ao,[["__scopeId","data-v-54d63327"]]);export{Jo as I};
