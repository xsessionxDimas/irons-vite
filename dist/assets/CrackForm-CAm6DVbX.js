import{k as qe,r as u,a0 as Re,c as U,o as Cs,d as Ft,p as c,aa as v,s as d,x as y,q as ge,A as w,F as G,R as be,Y as ws,y as he,aB as e,$ as ye,bL as at,b4 as se,u as H,C as N,b6 as ja,B as x,bd as Ea,bb as Ha,a5 as Te,P as R,a2 as Me,z as Wa}from"./@vue-BypzYtbH.js";import{_ as za}from"./Repair-zyV2di4A.js";import{D as Xa,_ as Za,P as es,C as ts,a as as}from"./CrackForm-CIiKEd4n.js";import{u as Ue}from"./useOfflineCameraStore-BBsMm6DV.js";import{u as ss}from"./useDefectsStore-j2gYF-8i.js";import{c as Gt,b as xt,n as Ss,s as Vs,o as Ps,p as Is}from"./useEFormStore-DtkLPope.js";import{b as ls}from"./useDefectsFormStore-41UTMhiG.js";import{u as os}from"./usePositionListStore-BsprGHwA.js";import{u as ns}from"./useMasterStore-CzSO06fn.js";import{_ as st}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{a as Ot}from"./element-plus-BeWdvTRa.js";import{d as rs}from"./manipulate-html-string-DqTEGh-F.js";import{e as p}from"./lodash-DrHMlsdo.js";import{h as Jt,s as Ee,b as is,i as us}from"./urls-CPQ2HRXU.js";import{D as cs}from"./NAForm-BdrJ0TGj.js";import{_ as He}from"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import{q as $s,n as ds,l as vs,p as ms,A as Wt,o as Oe,t as xs,C as Ls}from"./helpers-wUOLw-dU.js";import{_ as fs}from"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import{f as Ie,c as zt,i as ps,a as ea,s as Ya}from"./index-BuVmIl8K.js";import{s as Pe,b as Fs,d as Os}from"./methods-bliey5hF.js";import{u as hs}from"./useDefectSheetStore-85RM-z1z.js";import{v as Xt}from"./uuid-SoommWqA.js";import{_ as ta}from"./nw-img-vue-CR837WER.js";import{d as Rs}from"./pinia-BjOS2_Ao.js";import{C as Ka}from"./CrackYesClass-COntz77m.js";import{u as Qa}from"./authentication-handler-Pueb_EI7.js";import{u as As}from"./useGlobalConnectionStore-DV9B81de.js";import{A as Ua,i as Lt}from"./date-format-8-IvfSl3.js";import{u as ys}from"./@vueuse-DFoNmIyu.js";import{g as Bs,h as Ns,a as Ts}from"./reference-file-C1vLEEpf.js";import{s as Ga}from"./prev-val-handler-DvA3D_kF.js";import{S as Ma,f as Ms,r as Es}from"./number-format-BdMuQVyW.js";import{i as Ge}from"./internet-connection-CnLQPjRt.js";import{_ as bs}from"./image-close-button-red-B1UxWyBV.js";import{_ as Hs}from"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import{a as Us,b as qs,_ as js}from"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import{_ as Ys}from"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import{s as Ja}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{_ as Ks}from"./pdf-DNpyvVEz.js";import{_ as Qs}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-DqiQYePb.js";import{u as Gs}from"./useAttachmentStore-DqM3autD.js";const Js={key:0,class:"text-center"},Ws={style:{height:"100px"}},zs={key:0},Xs={class:"row my-4"},Zs={key:0,class:"bg-secondary"},el=["src","onClick"],tl=["onClick"],al={key:0,class:"row mt-7 mb-0"},sl=e("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),ll=[sl],ol=qe({__name:"ImageListModal",props:{visibility:{type:Boolean,default:!1},images:{type:Array,required:!0},showDeleteButton:{type:Boolean,default:!0},showRemainingPhotosMessage:{default:!1,type:Boolean}},emits:["handle-close","handle-delete"],setup(i,{emit:f}){const s=i,g=f,D=u(!1),m=u(!1),T=u(""),q=Ue(),V=_=>{const Q=I.value.findIndex(Z=>Z.imgBlob==_),k=I.value[Q];if(Q>0){const Z=I.value.slice(Q),ve=I.value.slice(0,Q);I.value=[...Z,...ve]}T.value=k.url,m.value=!0},J=()=>{T.value="",m.value=!1},W=Re(s,"visibility"),ce=U(()=>p.cloneDeep(s.images)),le=u([]),ie=u(!1),de=u(""),fe=u(!1),_e=async()=>{var _;if(F(),D.value=!0,le.value=[],((_=ce.value)==null?void 0:_.length)>0){let Q=0;I.value.forEach(async k=>{var ve;const Z={fileUrl:`${k.imgBlob}`,ver:"v1"};try{const ee=await Ie.pendingTaskFile.where({filename:k.imgBlob}).first(),De=window.URL||window.webkitURL;if(!ee&&!Ge()){const we=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(Z).toString()}`,Ve=(await zt.getBlob(we)).data,me=new Blob([Ve]);await ps(Ie,"pendingTaskFile",{key:q.stateDumpToLocalInfo.taskKey,module:"serviceForm",workorder:q.stateDumpToLocalInfo.workOrder,type:me.type,fileType:"webp",createdBy:q.stateDumpToLocalInfo.updatedBy,email:q.stateDumpToLocalInfo.email,filename:k.imgBlob,originalFilename:k.imgBlob,blob:me,syncStatus:"Sync",syncDate:Ua()}),k.url=De.createObjectURL(me)}else p.isUndefined(ee)?k.url="":k.url=De.createObjectURL(ee.blob);Q++,Q==((ve=ce.value)==null?void 0:ve.length)&&(D.value=!1)}catch(ee){console.log("image",ee)}})}},I=u([]),F=()=>{const _=s.images;I.value=_==null?void 0:_.map(Q=>({imgBlob:Q.filename,url:"",description:Q.description}))},oe=_=>{!s.images||s.images.length==0||(de.value=s.images[_],ie.value=!0)},ne=()=>{ie.value=!1},K=()=>{ie.value=!1,Ce()},Ce=async()=>{var Z;const _={ver:"v1",fileUrl:de.value},Q={},k=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/delete_by_url?${new URLSearchParams(_).toString()}`;try{D.value=!0,fe.value=!0,Ge()?await Ie.pendingTaskFile.filter(ve=>ve.filename==de.value).delete():await zt.post(`${k}?${new URLSearchParams(_).toString()}`,Q),g("handle-delete",de.value)}catch(ve){console.log("delete image",ve)}finally{D.value=!1,fe.value=!1,((Z=s.images)==null?void 0:Z.length)==0&&pe()}};Cs(async()=>{_e()}),Ft(ce,async(_,Q)=>{(_==null?void 0:_.length)==0&&pe(),(_==null?void 0:_.length)!=(Q==null?void 0:Q.length)&&await _e()},{deep:!0});const pe=()=>{g("handle-close",!1)};return(_,Q)=>{const k=be("el-skeleton-item"),Z=be("el-dialog"),ve=ws("loading");return c(),v(G,null,[d(Z,{modelValue:W.value,"onUpdate:modelValue":Q[0]||(Q[0]=ee=>W.value=ee),title:"Detailed picture",width:"80%",onClose:Q[1]||(Q[1]=ee=>pe())},{default:y(()=>[D.value?(c(),v("div",Js,[he(e("div",Ws,null,512),[[ve,D.value]]),fe.value?(c(),v("span",zs,"deleting image...")):w("",!0)])):(c(),v(G,{key:1},[e("div",Xs,[(c(!0),v(G,null,ye(I.value,(ee,De)=>(c(),v("div",{key:ee.imgBlob,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[ee.url?(c(),v("div",Zs,[e("img",{src:ee.url,alt:"img",class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:we=>V(ee.imgBlob)},null,8,el),i.showDeleteButton?(c(),v("img",{key:0,onClick:we=>oe(De),alt:"delete",class:"delete-image-button",src:bs},null,8,tl)):w("",!0)])):(c(),ge(k,{key:1,variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}}))]))),128))]),i.showRemainingPhotosMessage?(c(),v("div",al,ll)):w("",!0)],64))]),_:1},8,["modelValue"]),d(st,{visibility:ie.value,caption:"Are you sure want to delete this image?",onOnNoConfirm:ne,onOnYesConfirm:K},null,8,["visibility"]),m.value?(c(),ge(Hs,{key:0,images:I.value,visibility:m.value,image:T.value,onHandleClose:J},null,8,["images","visibility","image"])):w("",!0)],64)}}}),nl={class:"py-2 ps-0 pe-2 w-100"},rl={class:"d-flex align-items-center"},il={class:"flex-fill large-camera-container"},ul={class:"ms-2"},cl=["src"],dl={key:0,class:"d-flex justify-content-center ms-2"},vl={class:"text-white"},ml=qe({__name:"OfflineLargeCamera",props:{id:{type:String,required:!0},allowDelete:{type:Boolean,required:!0,default:!1},disabled:{type:Boolean,required:!0,default:!1},isMandatory:{type:Boolean,default:!1},hasSubmitted:{type:Boolean,default:!1}},setup(i){const f=i,s=Ue(),g=u(!1),D=u(!1),m=at(()=>s.ImageObjects.find(F=>F.Id===f.id)),T=at(()=>{var F;return(F=m.value)==null?void 0:F.ImageInfos.length}),q=at(()=>{var F;return((F=m.value)==null?void 0:F.ImageInfos)??[]}),V=()=>{let F="/media/svg/dma/camera/e-form/png/cam-active.png";return T.value>0&&(F="/media/svg/dma/camera/e-form/png/cam-user.png"),W.value=="not-allowed"&&(F="/media/svg/dma/camera/e-form/png/cam-read.png"),F},J=at(()=>f.disabled?"disabled":""),W=at(()=>f.disabled?"not-allowed":"allowed"),ce=at(()=>{const F=T.value??0;return f.isMandatory?F>0||!f.hasSubmitted?"mandatory-label":"mandatory-label error":"mandatory-label"}),le=(F=!1)=>{f.disabled||(s.setIsActionFromDelete(F),s.toggleIsVisible(!0,f.id),f.isMandatory&&q.value.length==0?s.setShowCloseButton(!1):s.setShowCloseButton(!0))},ie=()=>{g.value=!0},de=()=>{g.value=!1},fe=async F=>{var oe,ne,K;if(f.isMandatory&&q.value.length==1)g.value=!1,le(!0);else{const Ce=(oe=m.value)==null?void 0:oe.ImageInfos.findIndex(pe=>pe===F);Ce!=-1&&((ne=m.value)==null||ne.ImageInfos.splice(Ce,1),(K=m.value)==null||K.ImageBlobs.splice(Ce,1))}},_e=()=>{D.value=!1},I=()=>{D.value=!1,le()};return(F,oe)=>(c(),v(G,null,[e("div",nl,[e("div",rl,[e("div",{class:se(["d-flex w-100 align-items-center camera-wrapper py-2",H(J)])},[e("div",il,[e("span",{class:se(H(ce))},N(`Please take a photo of the ${f.id} identified`),3)]),e("div",ul,[e("div",{class:se(["p-2 justify-items-center rounded",H(W)]),style:{background:"#F4F6F8"},onClick:oe[0]||(oe[0]=ne=>le())},[e("img",{src:V(),style:{height:"20px",width:"24px"},class:se(H(W)),alt:"camera"},null,10,cl)],2)]),H(T)&&H(T)>0?(c(),v("div",dl,[e("button",{class:"btn btn-sm btn-icon btn-bg-success lg-btn-icon",onClick:ie,style:{"background-color":"#18AF4A"}},[e("label",vl,"+"+N(H(T)),1)])])):w("",!0)],2)])]),g.value?(c(),ge(ol,{key:0,images:H(q),visibility:g.value,showDeleteButton:f.allowDelete,onHandleClose:de,onHandleDelete:fe},null,8,["images","visibility","showDeleteButton"])):w("",!0),d(Us,{visibility:D.value,caption:"The photo successfully taken, would you like to take another photo?",onOnNoConfirm:_e,onOnYesConfirm:I},null,8,["visibility"])],64))}}),gs=ta(ml,[["__scopeId","data-v-38f80a7f"]]),fl={class:"row text-center pb-5 pt-5 text-dark processing-time-container"},pl={class:"icon mb-4"},hl=["src"],yl={class:"mb-2"},Zt=qe({__name:"OfflineMessageBox",props:{show:{type:Boolean,required:!0},message:{type:String,default:"Data successfully submitted"},icon:{type:String,default:"/media/svg/dma/green-checklist.png"},showLeftButton:{type:Boolean,required:!1,default:!1},leftButtonLabel:{type:String,default:""},backgroundLeftButton:{type:String,default:"#FFF"},colorLeftButton:{type:String,default:"#18AF4A"},borderColorLeftButton:{type:String,default:"#18AF4A"},backgroundRightButton:{type:String,default:"#18AF4A"},colorRightButton:{type:String,default:"#FFF"},borderColorRightButton:{type:String,default:"#18AF4A"}},emits:["close","leftButtonAction"],setup(i,{emit:f}){const s=i,g=f,D=()=>{g("close")},m=()=>{g("leftButtonAction")},T=Re(s,"show"),q=u({color:`${s.colorLeftButton}`,border:`1px solid ${s.borderColorLeftButton}`,"background-color":`${s.backgroundLeftButton}`}),V=u({color:`${s.colorRightButton}`,border:`1px solid ${s.borderColorRightButton}`,"background-color":`${s.backgroundRightButton}`});return(J,W)=>{const ce=be("el-button"),le=be("el-dialog");return c(),ge(le,{modelValue:T.value,"onUpdate:modelValue":W[0]||(W[0]=ie=>T.value=ie),width:"45%","show-close":!1,"custom-class":"message-box-custom oil-not-in-range__header p-0 success-box",top:"30vh",center:!0,"close-on-click-modal":!1,"close-on-press-escape":!1},{default:y(()=>[e("div",fl,[e("div",pl,[e("img",{src:i.icon},null,8,hl)]),e("h3",yl,N(i.message),1)]),e("div",{class:se(["row text-center pt-5",i.showLeftButton?"justify-content-evenly":""])},[i.showLeftButton?(c(),ge(ce,{key:0,style:ja(q.value),class:"col-5",onClick:m},{default:y(()=>[x(N(i.leftButtonLabel),1)]),_:1},8,["style"])):w("",!0),d(ce,{style:ja(V.value),class:se(i.showLeftButton?"col-5":"col"),onClick:D},{default:y(()=>[x("Close")]),_:1},8,["style","class"])],2)]),_:1},8,["modelValue"])}}}),bl=["disabled"],gl=["src"],_l={key:0,class:"col-6 p-0 d-flex justify-content-center text-nowrap"},Dl={class:"text-white"},_s=qe({__name:"SmallCamera",props:{itemValue:{required:!0,type:Object},index:{requied:!0,type:Number},isDisabled:{required:!1,type:Boolean,defauly:!1}},emits:["handleChangeImage"],setup(i,{emit:f}){const s=u(!1),g=Ue(),D=i,m=f,T=u(!1),q=Re(D,"itemValue"),V=U(()=>q.value?Ja(q.value):[]),J=U(()=>p.cloneDeep(g.ImageObjects.find(I=>I.Id===`${D.index}-parts`))),W=()=>{g.toggleIsVisible(!0,`${D.index}-parts`),g.setShowCloseButton(!0)},ce=()=>{let I="/media/svg/dma/camera/e-form/png/cam-active.png";return V.value.length>0&&(I="/media/svg/dma/camera/e-form/png/cam-user.png"),I};Ft(J,async(I,F)=>{I&&I.ImageInfos.length>0&&I.ImageInfos.length!=(F==null?void 0:F.ImageInfos.length)&&(m("handleChangeImage",{index:D.index,value:[...Ja(q.value),...I.ImageInfos]}),T.value=!T.value,g.setCurrent(`${D.index}-parts`),g.clearCurrent())},{deep:!0});const le=U(()=>!fe.value),ie=()=>{s.value=!0},de=()=>{s.value=!1},fe=U(()=>D.isDisabled?D.isDisabled:!1),_e=async I=>{const F=p.cloneDeep(q.value).filter(oe=>oe.filename!=I);m("handleChangeImage",{index:D.index,value:F}),T.value=!T.value,g.setCurrent(`${D.index}-parts`),q.value.length==0&&de(),g.clearCurrent()};return(I,F)=>(c(),v(G,null,[e("div",{class:se(["row m-0 p-0",!H(p.isUndefined)(q.value)&&q.value.length>0?"justify-content-around":"justify-content-center"])},[e("div",{class:se(["d-flex justify-content-center",!H(p.isUndefined)(q.value)&&q.value.length>0?"col-6 pe-0 ps-1":"col-6 px-0"])},[e("button",{class:"btn btn-sm btn-icon btn-bg-light",disabled:fe.value,onClick:W},[e("img",{src:ce(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,gl)],8,bl)],2),V.value&&V.value.length>0?(c(),v("div",_l,[e("button",{class:"btn btn-sm btn-icon btn-bg-success",onClick:ie,style:{"background-color":"#18AF4A"}},[e("label",Dl,"+"+N(V.value.length),1)])])):w("",!0)],2),s.value?(c(),ge(Ys,{key:0,type:"task","re-render":T.value,images:V.value,"show-delete-button":le.value,"is-mandatory":!1,visibility:s.value,"is-monitoring":!le.value,"show-mandatory-caption":!1,onOnClose:de,onOnDelete:_e},null,8,["re-render","images","show-delete-button","visibility","is-monitoring"])):w("",!0)],64))}}),Ds=i=>(Ea("data-v-0764714f"),i=i(),Ha(),i),kl={class:"d-flex"},Cl=["onClick"],wl=Ds(()=>e("img",{src:Ks,alt:"pdf",class:"d-icon pdf",style:{"vertical-align":"-1px"}},null,-1)),Sl=[wl],Vl=["onClick"],Pl={style:{"white-space":"pre-wrap"},class:"pdf"},Il=["onClick"],$l=Ds(()=>e("img",{src:bs,alt:"close",class:"d-icon pdf",style:{"vertical-align":"-2px",width:"15px"}},null,-1)),xl=[$l],Ll=qe({__name:"AttachmentPreview",props:{visibility:{type:Boolean,required:!1},files:{type:Array,required:!0},showDeleteButton:{type:Boolean,required:!0,default:!0},isMonitoring:{type:Boolean,default:!1}},emits:["onClose","onChangeAttachment","onDownloaded"],setup(i,{emit:f}){const s=i,g=f,D=u(!1),m=u(""),T=()=>{D.value=!1},q=Re(s,"files"),V=Re(s,"visibility"),J=u(!1),W=u(""),ce=U(()=>{let I=!1;return s.showDeleteButton&&(I=!0),s.isMonitoring&&(I=!1),I}),le=I=>{m.value=I,D.value=!0},ie=()=>{V.value=!1,g("onClose")},de=I=>{J.value=!0,W.value=I},fe=()=>{J.value=!1},_e=()=>{J.value=!1;const I=p.cloneDeep(q.value).filter(F=>F.url!=W.value);g("onChangeAttachment",I),I.length==0&&ie(),W.value=""};return(I,F)=>{const oe=be("el-dialog");return c(),v(G,null,[d(oe,{modelValue:V.value,"onUpdate:modelValue":F[0]||(F[0]=ne=>V.value=ne),title:"Detailed Document",width:"80%","custom-class":"el-defect-crack-form-custom multi-defect-list-dialog",onClose:ie},{default:y(()=>[(c(!0),v(G,null,ye(i.files,ne=>(c(),v("div",{class:"multi-defect-list-item py-2 d-flex align-items-center justify-content-between",key:ne.filename},[e("div",kl,[e("div",{class:"multi-icon cursor-pointer",onClick:K=>le(ne.url)},Sl,8,Cl),e("div",{class:"multi-description cursor-pointer",onClick:K=>le(ne.url)},[e("span",Pl,N(ne.filename),1)],8,Vl)]),ce.value?(c(),v("div",{key:0,class:"multi-icon cursor-pointer",onClick:K=>de(ne.url)},xl,8,Il)):w("",!0)]))),128))]),_:1},8,["modelValue"]),d(st,{visibility:J.value,caption:"Are you sure want to delete this PDF?",onOnNoConfirm:fe,onOnYesConfirm:_e},null,8,["visibility"]),d(Qs,{show:D.value,onHandleCloseModal:T,"blob-url":m.value},null,8,["show","blob-url"])],64)}}}),Fl=ta(Ll,[["__scopeId","data-v-0764714f"]]),Ol=["disabled"],Rl=["src"],Al={key:0,class:"col-6 ps-0 pe-1 d-flex justify-content-center"},Bl={class:"text-white"},ks=qe({__name:"UploadAttachment",props:{itemValue:{required:!0,type:Object},index:{requied:!0,type:Number},isDisabled:{required:!1,type:Boolean,defauly:!1}},emits:["handleChangeAttachment"],setup(i,{emit:f}){const s=Gs(),g=ea(),D=i,m=f,T=Ue(),q=u(null),V=u(!1),J=u([]),W=u(!1);ys();const ce=()=>{q.value&&q.value.openUploadDialog()},le=()=>{V.value=!1},ie=()=>{},de=async K=>{J.value=[];const Ce=Ot.service({lock:!0,text:"Uploading",background:"rgba(0, 0, 0, 0.7)"});let pe=!0;const _=["application/pdf"];if((K[0].size>2097152||!_.includes(K[0].type))&&(pe=!1,J.value.push(K[0].name)),!pe)J.value.length>0&&(V.value=!0);else{const Q=new Blob([K[0]],{type:"application/pdf"});let k=$s(15);const Z=new FormData;Z.append("files",Q,encodeURI(`${k}.pdf`)),Z.append("userAccount",g.user.Email);const ve={module:"serviceForm",key:T.stateDumpToLocalInfo.taskKey,workorder:T.stateDumpToLocalInfo.workOrder,type:T.stateDumpToLocalInfo.type,createdBy:T.stateDumpToLocalInfo.updatedBy,email:T.stateDumpToLocalInfo.email,filename:k,originalFilename:K[0].name,blob:Q,syncStatus:"Pending",syncDate:Ua(),fileType:"pdf"};let ee;Ge()?ee=await ps(Ie,"pendingTaskFile",ve):ee=await s.uploadAttachment(Z,g.user.Email,ve),Promise.all([ee]).then(De=>{if(typeof De[0]=="string"&&!Ge()||Ge()){const we=p.cloneDeep(D.itemValue);we.push({filename:K[0].name,url:k}),fe(we)}})}Ce.close()},fe=K=>{m("handleChangeAttachment",{index:D.index,value:K})},_e=()=>{let K="/media/svg/dma/attachment/blue.png";return D.itemValue.length>0&&(K="/media/svg/dma/attachment/green.png"),K},I=U(()=>!ne.value),F=()=>{W.value=!0},oe=()=>{W.value=!1},ne=U(()=>D.isDisabled?D.isDisabled:!1);return(K,Ce)=>(c(),v("div",null,[e("div",{class:se(["row m-0",!H(p.isUndefined)(i.itemValue)&&i.itemValue.length>0?"justify-content-around":"justify-content-center"])},[e("div",{class:se(["d-flex justify-content-center",!H(p.isUndefined)(i.itemValue)&&i.itemValue.length>0?"col-6 pe-0 ps-1":"col-6 px-0"])},[e("button",{class:"btn btn-sm btn-icon btn-bg-light",disabled:ne.value,onClick:ce},[e("img",{src:_e(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,Rl)],8,Ol)],2),i.itemValue&&i.itemValue.length>0?(c(),v("div",Al,[e("button",{class:"btn btn-sm btn-icon btn-bg-success",onClick:F,style:{"background-color":"#18AF4A"}},[e("label",Bl,"+"+N(i.itemValue.length),1)])])):w("",!0)],2),d(Fl,{visibility:W.value,files:i.itemValue,"is-monitoring":!I.value,"show-delete-button":I.value,onOnClose:oe,onOnChangeAttachment:fe},null,8,["visibility","files","is-monitoring","show-delete-button"]),d(qs,{ref_key:"singlePDFUploader",ref:q,"is-multiple":!1,"accepted-file":"application/pdf",onOnFileDropped:de,onOnFileCancelled:ie},null,512),d(js,{show:V.value,onClose:le,imageList:J.value,fileType:"PDF"},null,8,["show","imageList"])]))}}),B=i=>(Ea("data-v-c1b0f368"),i=i(),Ha(),i),Nl={class:"d-flex justify-content-between"},Tl=B(()=>e("span",{class:"el-dialog__title"},"Detailed Information for Defect Identification",-1)),Ml=["innerHTML"],El={class:"d-flex",style:{"margin-right":"3rem"}},Hl={key:0,class:"rounded d-flex justify-content-center align-items-center header-badge red-bg text-dark-red mx-2"},Ul=B(()=>e("div",null,"Declined",-1)),ql=[Ul],jl={key:1,class:"rounded d-flex justify-content-center align-items-center approved-badge header-badge green mx-2"},Yl=B(()=>e("div",null,"Approved",-1)),Kl=[Yl],Ql=B(()=>e("div",null,[e("img",{src:za,alt:""})],-1)),Gl={style:{margin:"6px 0 4px 5px"}},Jl={class:"history-wrapper"},Wl=B(()=>e("hr",null,null,-1)),zl=B(()=>e("div",{class:"mt-1 p-2"},null,-1)),Xl={class:"d-flex flex-row justify-content-between"},Zl={class:"py-2 d-flex flex-row flex-grow-1"},eo={class:"flex-fill"},to={class:"form-floating"},ao=["innerHTML"],so=B(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),lo={class:"flex-fill ps-3"},oo={class:"form-floating"},no=["innerHTML"],ro=B(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),io={class:"flex-fill ps-3"},uo={class:"form-floating"},co=["innerHTML"],vo=B(()=>e("label",{for:"floatingInput"},"Ownership",-1)),mo={class:"d-flex flex-row justify-content-between"},fo={class:"mt-1 py-2"},po={class:"mt-1 py-2"},ho={class:"row"},yo={class:"col pe-0"},bo={class:"form-floating"},go=["value"],_o=B(()=>e("label",null,"Raised By",-1)),Do={class:"mt-1 py-2"},ko={class:"row"},Co={class:"col-4 pe-0 date"},wo={class:"form-floating"},So=["value"],Vo=B(()=>e("label",null,"Date Raised",-1)),Po={class:"col pe-0 d-flex"},Io={class:"d-flex flex-column flex-fill"},$o={class:"form-floating"},xo=["disabled"],Lo=B(()=>e("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Fo={key:0,class:"mt-2"},Oo={class:"ms-2 d-flex align-items-center"},Ro={class:"mt-1 py-2"},Ao=B(()=>e("div",{class:"mt-2"},null,-1)),Bo=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1)),No={class:"row p-3 m-1 priority-container"},To={class:"col-3"},Mo={class:"form-check"},Eo=["disabled"],Ho=B(()=>e("label",{class:"form-check-label"}," (P1) Immediate ",-1)),Uo=B(()=>e("div",{class:"col-6 word-breaker"},"Shall shut machine down and undertake repairs.",-1)),qo=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),jo={class:"row p-3 m-1 priority-container"},Yo={class:"col-3"},Ko={class:"form-check"},Qo=["disabled"],Go=B(()=>e("label",{class:"form-check-label"}," (P2) Urgent ",-1)),Jo=B(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 7 days.",-1)),Wo=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),zo={class:"row p-3 m-1 priority-container"},Xo={class:"col-3"},Zo={class:"form-check"},en=["disabled"],tn=B(()=>e("label",{class:"form-check-label"}," (P3) Routine ",-1)),an=B(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 60 days.",-1)),sn=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),ln={class:"row p-3 m-1 priority-container"},on={class:"col-3"},nn={class:"form-check"},rn=["disabled"],un=B(()=>e("label",{class:"form-check-label"}," (P4) Monitor ",-1)),cn=B(()=>e("div",{class:"col-6 word-breaker"},"Shall continue to inspect and monitor for 90 days.",-1)),dn=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),vn=B(()=>e("div",{class:"mt-2"},null,-1)),mn=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Part Number"),e("div",{class:"col-5"},"Part Description"),e("div",{class:"col-1"},"Qty"),e("div",{class:"col"}),e("div",{class:"col"})],-1)),fn={class:"col-3 ps-0"},pn={class:"d-flex flex-column"},hn=["value","disabled","onChange"],yn={key:0,class:"mt-2"},bn={class:"col-5"},gn={class:"d-flex flex-column"},_n=["value","onChange","disabled"],Dn={key:0,class:"mt-2"},kn={class:"col-1 px-1 d-flex flex-column justify-content-start"},Cn={class:"row p-0 m-0 h-50 w-100"},wn={class:"p-0 col-12 d-flex"},Sn=["onUpdate:modelValue","onInput","disabled","onFocusout"],Vn={key:0,class:"mt-2 flex-fill"},Pn={class:"col px-1 d-flex flex-column justify-content-start"},In={class:"row p-0 m-0 h-100 w-100 align-items-center"},$n={class:"col px-1 d-flex flex-column justify-content-start position-relative"},xn={class:"row p-0 m-0 h-100 w-100 align-items-center"},Ln=["onClick"],Fn={class:"d-flex justify-content-between align-items-center flex-row-reverse"},On={class:"fw-bolder"},Rn=["href"],An=B(()=>e("img",{src:as},null,-1)),Bn=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Nn=B(()=>e("div",{class:"mt-2"},null,-1)),Tn=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-6"},"Labour Activity"),e("div",{class:"col-2"},"Qty"),e("div",{class:"col-2"},"Hours Each"),e("div",{class:"col-2"},"Total Hours")],-1)),Mn={class:"col-6 px-0"},En={class:"d-flex flex-column"},Hn={key:0,class:"mt-2"},Un={class:"col-2 d-flex justify-content-start"},qn={class:"d-flex flex-column"},jn=["onUpdate:modelValue","onInput","disabled","onFocusout"],Yn={key:0,class:"mt-2"},Kn={class:"col-2 d-flex justify-content-start"},Qn={class:"d-flex flex-column"},Gn=["onUpdate:modelValue","onInput","disabled","onFocusout"],Jn={key:0,class:"mt-2"},Wn={class:"col-2 d-flex justify-content-start"},zn={class:"row p-0 m-0 h-50 w-100"},Xn={class:"p-0 col-12 d-flex"},Zn=["value"],er=["onClick"],tr={key:0,class:"mt-2 flex-fill"},ar=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),sr=B(()=>e("div",{class:"mt-2"},null,-1)),lr={class:"d-flex flex-fill flex-column"},or={class:"d-flex flex-row"},nr=["value","placeholder","onChange","disabled"],rr=["onClick"],ir={key:0,class:"mt-2"},ur=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),cr=B(()=>e("div",{class:"mt-2"},null,-1)),dr={class:"d-flex flex-row"},vr={class:"d-flex flex-fill flex-column"},mr={key:0,class:"mt-2"},fr=["onClick"],pr={key:0,class:"mt-2"},hr=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),yr=B(()=>e("div",{class:"mt-2"},null,-1)),br={class:"d-flex flex-row"},gr={class:"d-flex flex-fill flex-column"},_r={key:0,class:"mt-2"},Dr=["onClick"],kr={key:0,class:"mt-2"},Cr=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),wr={key:1,class:"my-5 w-100 d-flex justify-content-around"},Sr=["disabled"],Vr={key:0,class:"my-5 w-100 d-flex justify-content-around"},Pr={key:1,class:"my-5 w-100 d-flex justify-content-around"},Ir=qe({__name:"DefectForm",props:{visibility:{required:!0,type:Boolean},predefinedPriority:{required:!0,type:String,default:"P1"},defectData:{required:!0,type:Object},workOrder:{required:!1,type:String},headerId:{required:!1,type:String},taskId:{required:!1,type:String},status:{required:!0,type:String},viewOnly:{required:!1,type:Boolean,default:!1},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},generic:{required:!1,type:Boolean,default:!1},isForm:{required:!1,type:Boolean,default:!1},isComplete:{required:!0,type:Boolean,default:!1}},emits:["closeForm","onRefreshData"],setup(i,{emit:f}){const s=i,g=f,D=Ue(),m=ss(),T=Gt(),q=ls(),V=os(),J=ns(),W=ea(),ce=hs(),le=u(""),ie=u("Priority"),de=u("Parts"),fe=u("Labour"),_e=u("Other Resource (optional)"),I=u("Symptom"),F=u("Cause"),oe=u(!0),ne=u(!1),K=u(!1),Ce=u(Xt()),pe=u(!1),_=u(),Q=u(!0),k=u(!0),Z=u(!0),ve=u(!1),ee=u(!1),De=u(!1),we=u(!1),r=u(""),Ve=u(!1),me=Re(s,"visibility"),o=Re(s,"defectData"),X=u(),Y=u(s.predefinedPriority),z=u([""]),A=u([""]),E=u([""]),M=u([""]),te=u([!0]),re=u([""]),ae=u([!0]),Ae=u(!1),$e=u(!1),xe=u(!1);let Le=[];const Se=u(""),je=u(""),lt=u(),ot=u(""),nt=u([""]),rt=u([""]),it=u([""]),ut=u([""]),ct=u([!0]),dt=u([""]),vt=u([!0]),mt=u(),Je=u(""),ft=["images","description","priority","instruction","plannedDuration","parts","labours","resources","symptoms","causes"],aa=U(()=>{var O;const a=Fe()=="Decline"?"Declined":"Approved",n=((O=yt.value[0])==null?void 0:O.role)??" ";return`Are you sure want to modify this defect that has already ${a.toLowerCase()} by the ${n.charAt(0).toUpperCase()+n.slice(1)}`}),pt=U(()=>p.isUndefined(T.images)?[]:T.images.ImageInfos),ht=()=>{var a,n;return((n=(a=m.SelectedDefectDetailVersion)==null?void 0:a.detail)==null?void 0:n.isComplete)??!0},yt=U(()=>m.SelectedDefectHeaderHistory),bt=U(()=>m.VersionDate),sa=U(()=>{var a,n;return s.defectData.DefectRequirement!="Less than 30 minutes labour and less than $250 in parts"&&((n=(a=o.value)==null?void 0:a.Parts)==null?void 0:n.length)==0}),la=U(()=>({images:pt.value,description:s.defectData.Description.value,priority:s.defectData.Priority,instruction:s.defectData.Instruction.value,plannedDuration:s.defectData.PlannedDuration.value,parts:s.defectData.Parts,labours:s.defectData.Labours,resources:s.defectData.Resources,symptoms:s.defectData.Symptoms,causes:s.defectData.Causes})),oa=U(()=>k.value?!1:ds(ft,mt.value,la.value)),na=()=>{lt.value=p.cloneDeep(X.value),ot.value=p.cloneDeep(Y.value),nt.value=p.cloneDeep(z.value),rt.value=p.cloneDeep(A.value),it.value=p.cloneDeep(E.value),ut.value=p.cloneDeep(M.value),ct.value=p.cloneDeep(te.value),dt.value=p.cloneDeep(re.value),vt.value=p.cloneDeep(ae.value),je.value=Se.value},ra=()=>{m.setDefectData(s.headerId??""),s.plannerApprove&&m.HeaderStatus!="Decline"&&m.updateHeaderDefect(s.headerId),X.value=p.cloneDeep(lt.value),Y.value=p.cloneDeep(ot.value),z.value=p.cloneDeep(nt.value),A.value=p.cloneDeep(rt.value),E.value=p.cloneDeep(it.value),M.value=p.cloneDeep(ut.value),te.value=p.cloneDeep(ct.value),re.value=p.cloneDeep(dt.value),ae.value=p.cloneDeep(vt.value),Se.value=je.value},Rt=u(!1),gt=a=>{Rt.value=a},At=U(()=>T.SerialNumber),ia=U(()=>{const a=T.Ownership;return vs(a)}),ua=async a=>{const n=Ot.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});s.plannerApprove?await m.updatePlannerDefectDecline(a):await m.updateDefectDecline(a),n.close(),gt(!1),Bt()},Bt=()=>{ve.value=!0,setTimeout(async()=>{ve.value=!1,It()},1e3)},_t=()=>{const a=["Acknowledge","Decline"];a.includes(Fe()??"")||a.includes(s.status)?xe.value=!0:Dt()},Dt=()=>{xe.value=!1,Jt(Ce.value),K.value=!0,na(),xa(),mt.value={images:p.cloneDeep(pt.value),description:p.cloneDeep(s.defectData.Description.value),priority:p.cloneDeep(s.defectData.Priority),instruction:p.cloneDeep(s.defectData.Instruction.value),plannedDuration:p.cloneDeep(s.defectData.PlannedDuration.value),parts:p.cloneDeep(s.defectData.Parts),labours:p.cloneDeep(s.defectData.Labours),resources:p.cloneDeep(s.defectData.Resources),symptoms:p.cloneDeep(s.defectData.Symptoms),causes:p.cloneDeep(s.defectData.Causes)}},kt=()=>{K.value=!1,ra(),k.value=!0,Z.value=!0,Vt()},Ct=a=>k.value||a==0?"hidden":"",wt=U(()=>{let a="Defect Information Successfully Submitted";return s.status=="Decline"?ce.SelectedFitter.id?(a="Defect Identified Successfully Modified",a):(a="Defect Identified Successfully Submitted",a):(ne.value||(a="Defect Approved"),a)}),Ye=U({get:()=>{let a=Se.value;return a=Se.value,a},set:a=>{Se.value=a}}),Nt=U(()=>m.IsError),ca=U(()=>"Defect Identified Description"),da=U(()=>"Defect Repair Instructions / Actions"),va=a=>{o.value.setDescription(a.value),o.value.validateDescription()},Ke=a=>{a.preventDefault(),a.target.value=Oe(a.target.value),isNaN(Number(a.target.value))&&(o.value.setPlannedDuration(a.target.value),o.value.validatePlannedDuration()),o.value.setPlannedDuration(a.target.value),o.value.validatePlannedDuration()},ma=a=>{o.value.setInstruction(a.value),o.value.validateInstruction()},We=a=>{a.preventDefault(),o.value.Priority!=a.target.value&&(Ae.value=!0),o.value.setPriority(a.target.value)},Tt=(a,n)=>{a.preventDefault(),o.value.setPartNumber(n,a.target.value)},fa=(a,n)=>{a.preventDefault(),o.value.setPartDescription(n,a.target.value),o.value.validatePartDescription(o.value.Parts[n])},Qe=(a,n)=>{a.preventDefault(),a.target.value=Oe(a.target.value),isNaN(Number(a.target.value))&&(o.value.setPartQty(n,a.target.value),o.value.validatePartQty(o.value.Parts[n])),o.value.setPartQty(n,a.target.value),o.value.validatePartQty(o.value.Parts[n])},pa=a=>{const{value:n,index:O}=a;o.value.setPartImage(O,n),Le.push(p.last(n).filename)},ha=a=>{const{value:n,index:O}=a;o.value.setPartAttachment(O,n),Le.push(p.last(n).url)},Mt=()=>{Ve.value=!1,we.value=!0,is(Ce.value,"parts-collapse")},ya=()=>{if(o.value.Parts.every(n=>n.partDescription!==""&&n.qty!=="")){for(const n in o.value.Parts)if(Object.hasOwn(o.value.Parts,n)){const O=o.value.Parts[n];if(!O.partNumberValidation.isValid||!O.descriptionValidation.isValid||!O.qtyValidation.isValid)return}}else{o.value.validateParts();return}o.value.addPart({partNumber:"",partDescription:"",qty:""})},ba=a=>{o.value.removeParts(a)},St=a=>{o.value.setLabourActivity(a,z.value[a]),o.value.validateLaboursActivity(o.value.Labours[a])},Et=(a,n)=>{a.preventDefault(),a.target.value=Oe(a.target.value),isNaN(Number(a.target.value))&&(o.value.setLabourQty(n,a.target.value),o.value.validateLaboursQty(o.value.Labours[n]),o.value.Labours[n].position||St(n),Be(n)),o.value.setLabourQty(n,a.target.value),o.value.validateLaboursQty(o.value.Labours[n]),Be(n)},Ht=(a,n)=>{a.preventDefault(),a.target.value=Oe(a.target.value),isNaN(Number(a.target.value))&&(o.value.setLabourHireEach(n,a.target.value),o.value.validateLaboursHireEach(o.value.Labours[n]),o.value.Labours[n].position||St(n),Be(n)),o.value.setLabourHireEach(n,a.target.value),o.value.validateLaboursHireEach(o.value.Labours[n]),Be(n)},Be=a=>{if(!o.value.Labours[a].qty||!o.value.Labours[a].hireEach)return;o.value.Labours[a].totalHoursValidation.message="",o.value.Labours[a].totalHoursValidation.isValid=!0;const n=+o.value.Labours[a].qty,O=+o.value.Labours[a].hireEach;let t=n*O;Number.isInteger(t)||(t=Number((Math.round(t*100)/100).toFixed(2))),o.value.setLabourTotalHours(a,t.toString())},Ut=()=>{if(o.value.Labours.every(n=>n.position!==""&&n.qty!==""&&n.hireEach!==""&&n.totalHours!=="")){for(const n in o.value.Labours)if(Object.hasOwn(o.value.Labours,n)){const O=o.value.Labours[n];if(!O.positionValidation.isValid||!O.qtyValidation.isValid||!O.hireEachValidation.isValid)return}}else{o.value.validateLabours();return}o.value.addLabour({position:"",qty:"",hireEach:"",totalHours:""})},qt=a=>{z.value.splice(a,1),o.value.removeLabours(a)},Ne=a=>{let n=a.keyCode?a.keyCode:a.which;(n<48||n>57)&&n!=46&&a.preventDefault()},ga=(a,n)=>{a.preventDefault(),o.value.setResources(n,a.target.value),!(n==0&&o.value.Resources[n].value=="")&&o.value.validateResource(o.value.Resources[n])},_a=()=>{if(!o.value.Resources.every(n=>n.value!=="")){o.value.validateResourcesAdd();return}o.value.addResource("")},Da=a=>{o.value.removeResource(a),o.value.validateResourcesRemove()},ka=a=>{re.value[a]="",ae.value[a]=!0,o.value.setCauses(a,E.value[a]),o.value.validateCause(o.value.Causes[a])},Ca=a=>{const n=a.index;typeof n>"u"||n<0||(ae.value[n]=a.value!="",re.value[n]=a.value)},wa=()=>{for(const O in o.value.Causes)if(Object.hasOwn(o.value.Causes,O)&&!o.value.Causes[O].isValid)return;if(!o.value.Causes.every(O=>O.value!=="")){o.value.validateCauses();return}const n=E.value.length-1;if(E.value[n]==="Other")if(re.value[n])ae.value[n]=!0;else{ae.value[n]=!1;return}o.value.addCauses(""),E.value.push(""),re.value.push(""),ae.value.push(!0)},Sa=a=>{E.value.splice(a,1),re.value.splice(a,1),ae.value.splice(a,1),o.value.removeCauses(a)},Va=a=>{M.value[a]="",te.value[a]=!0,o.value.setSymptom(a,A.value[a]),o.value.validateSymptom(o.value.Symptoms[a])},Pa=a=>{const n=a.index;typeof n>"u"||n<0||(te.value[n]=a.value!="",M.value[n]=a.value)},Ia=()=>{for(const O in o.value.Symptoms)if(Object.hasOwn(o.value.Symptoms,O)&&!o.value.Symptoms[O].isValid)return;if(!o.value.Symptoms.every(O=>O.value!=="")){o.value.validateSymptoms();return}const n=A.value.length-1;if(A.value[n]==="Other")if(M.value[n])te.value[n]=!0;else{te.value[n]=!1;return}o.value.addSymptom(""),A.value.push(""),M.value.push(""),te.value.push(!0)},$a=a=>{A.value.splice(a,1),M.value.splice(a,1),te.value.splice(a,1),o.value.removeSymptom(a)},xa=()=>{var a;(a=_.value)==null||a.resetToLatest(),k.value=!1,o.value.Resources.length==0&&o.value.addResource(""),Z.value=!1},La=async()=>{o.value.setAssetNumber(m.SelectedDefectDetailVersion.detail.assetNumber),o.value.setPriority(m.SelectedDefectDetailVersion.detail.priority),o.value.setRaisedBy(m.SelectedDefectDetailVersion.detail.raisedBy),o.value.setDate(m.SelectedDefectDetailVersion.detail.date),o.value.setTitle(m.SelectedDefectDetailVersion.detail.title),o.value.setDescription(m.SelectedDefectDetailVersion.detail.description),o.value.importParts(...Pe(m.SelectedDefectDetailVersion.detail.parts)),o.value.importLabours(...Pe(m.SelectedDefectDetailVersion.detail.labours)),o.value.importResources(...Pe(m.SelectedDefectDetailVersion.detail.resources)),o.value.importSymptoms(...Pe(m.SelectedDefectDetailVersion.detail.symptoms)),o.value.importCauses(...Pe(m.SelectedDefectDetailVersion.detail.causes)),o.value.setPlannedDuration(m.SelectedDefectDetailVersion.detail.plannedDuration??""),o.value.setInstruction(m.SelectedDefectDetailVersion.detail.instruction),Y.value=m.SelectedDefectDetailVersion.detail.priority,Ye.value=m.SelectedDefectDetailVersion.detail.plannedDuration??"",z.value=o.value.Labours.map(a=>a.position),A.value=[],M.value=[],te.value=[],o.value.Symptoms.forEach(a=>{if(a.value.indexOf(":")>-1){const n=a.value.split(":");A.value.push(n[0]),M.value.push(Ee(a.value)),te.value.push(!0)}else A.value.push(a.value),M.value.push(""),te.value.push(!0)}),E.value=[],re.value=[],ae.value=[],o.value.Causes.forEach(a=>{if(a.value.indexOf(":")>-1){const n=a.value.split(":");E.value.push(n[0]),re.value.push(Ee(a.value)),ae.value.push(!0)}else E.value.push(a.value),re.value.push(""),ae.value.push(!0)}),await m.setDefectImages(m.SelectedDefectDetailVersion.detail.images)},Fa=async a=>{m.setDetailVersion(a.versionDate)&&(Je.value=a.versionDate,ze(),await La())},Vt=()=>{o.value.Resources.length==1&&o.value.Resources[0].value==""&&o.value.removeResource(0)},Oa=()=>{for(const n in o.value.Symptoms)if(Object.hasOwn(o.value.Symptoms,n)&&!o.value.Symptoms[n].isValid)return!1;const a=A.value.length-1;return A.value[a]==="Other"?M.value[a]?te.value[a]=!0:te.value[a]=!1:te.value[a]=!0,te.value[a]},Pt=()=>{for(const n in o.value.Causes)if(Object.hasOwn(o.value.Causes,n)&&!o.value.Causes[n].isValid)return!1;const a=E.value.length-1;return E.value[a]==="Other"?re.value[a]?ae.value[a]=!0:ae.value[a]=!1:ae.value[a]=!0,ae.value[a]},jt=async()=>{var a;o.value.validateDefectForm(),s.defectData.Type=="YES"&&(p.isUndefined(T.images)||T.images.ImageInfos.length<1)&&(pe.value=!0),(a=o.value)!=null&&a.IsValid&&Oa()&&Pt()&&!pe.value?Ve.value=!0:us()},Ra=()=>{o.value.Symptoms.forEach((a,n)=>{a.value=a.value.includes("Other")?`Other:${M.value[n]}`:a.value})},Yt=()=>{o.value.Causes.forEach((a,n)=>{a.value=a.value.includes("Other")?`Other:${re.value[n]}`:a.value})},Aa=async a=>{Ve.value=!1;const n=Ot.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});Ra(),Yt(),o.value.setIsComplete(a.isComplete);const O=s.fitterId==""?JSON.stringify(ce.SelectedFitter):s.fitterId,t=await m.updateDefectFitter(O,s.generic);if(Nt.value){r.value=t,n.close(),De.value=!0;return}n.close(),Bt()},Ba=()=>{Ve.value=!1},It=()=>{ee.value=!1,De.value=!1,Kt(),g("onRefreshData")},Kt=()=>{m.setDetailVersion(""),K.value=!1,pe.value=!1,D.clearCurrent(),Y.value="",z.value=[""],A.value=[""],E.value=[""],M.value=[""],te.value=[!0],re.value=[""],ae.value=[!0],k.value=!0,we.value=!1,Vt(),g("closeForm")},ze=(a=!1)=>{Xe.value=Fe(),Q.value=a?s.isComplete:ht()},Fe=()=>{var a;return Je.value?(a=yt.value.find(n=>n.createdDate==Je.value))==null?void 0:a.action:s.status},Xe=u(Fe()),Qt=()=>{ze(!0),D.addLocalImageInfo({taskKey:s.taskId,workOrder:s.workOrder,type:"defect",updatedBy:s.fitterId,email:W.user.Email}),D.setShowCloseButton(!0),Jt(Ce.value),oe.value=s.viewOnly,Na(),Y.value=s.defectData.Priority,Se.value=s.defectData.PlannedDuration.value,z.value=s.defectData.Labours.map(a=>a.position),Vt(),A.value=[],M.value=[],te.value=[],s.defectData.Symptoms.forEach(a=>{if(a.value.indexOf(":")>-1){const n=a.value.split(":");A.value.push(n[0]),M.value.push(Ee(a.value)),te.value.push(!0)}else A.value.push(a.value),M.value.push(""),te.value.push(!0)}),E.value=[],re.value=[],ae.value=[],s.defectData.Causes.forEach(a=>{if(a.value.indexOf(":")>-1){const n=a.value.split(":");E.value.push(n[0]),re.value.push(Ee(a.value)),ae.value.push(!0)}else E.value.push(a.value),re.value.push(""),ae.value.push(!0)}),ms(X.value),o.value.validatePlannedDuration()},Na=()=>{window.location.href.includes("e-form")&&(s.viewOnly?oe.value=!0:s.status=="Submited"?(oe.value=!1,ne.value=!0):oe.value=!0)},Ze=()=>{m.resetDetailVersion(),D.setShowCloseButton(!1),k.value?g("closeForm"):oa.value?$e.value=!0:g("closeForm")};Ft(()=>s.predefinedPriority,a=>{Y.value=a});const $t=()=>{$e.value=!1},Ta=()=>{if($e.value=!1,g("closeForm"),Le.length==0)return;const a=Ie.pendingTaskFile.where("filename").anyOf(Le);a&&a.delete()};return Ft(pt,a=>{a.length>0&&(pe.value=!1)},{deep:!0}),(a,n)=>{const O=be("el-collapse-item"),t=be("el-collapse"),l=be("Label"),j=be("el-option"),ue=be("el-select"),ke=be("el-dialog");return c(),v(G,null,[d(ke,{modelValue:me.value,"onUpdate:modelValue":n[14]||(n[14]=et=>me.value=et),"custom-class":`defectform el-defect-crack-form-custom edit-form-defect-yes ${Ce.value}`,width:"90%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1,onClosed:Kt,onOpened:Qt,"destroy-on-close":!0,"before-close":Ze},{title:y(()=>[e("div",Nl,[e("div",null,[Tl,e("span",{class:"el-dialog__title task-title",innerHTML:H(rs)(o.value.Title),ref_key:"defectDetailRef",ref:X},null,8,Ml)]),e("div",El,[Xe.value=="Decline"?(c(),v("div",Hl,ql)):Xe.value=="Acknowledge"?(c(),v("div",jl,Kl)):w("",!0),e("div",{class:se(["rounded d-flex justify-content-center align-items-center header-badge",Q.value?"green":"red"])},[Ql,e("div",Gl,N(Q.value?"Completed":"Incomplete"),1)],2)])])]),default:y(()=>{var et,tt;return[e("div",null,[d(t,{class:"task-group general-accordion py-1 px-5",modelValue:le.value,"onUpdate:modelValue":n[0]||(n[0]=b=>le.value=b)},{default:y(()=>[d(O,{title:"Changes and Approval History",name:"History"},{default:y(()=>[e("div",Jl,[d(Xa,{activities:yt.value},null,8,["activities"]),Wl,d(Za,{"version-dates":bt.value,onChangeVersion:Fa,ref_key:"defectVersion",ref:_},null,8,["version-dates"])])]),_:1})]),_:1},8,["modelValue"]),zl,e("div",Xl,[e("div",Zl,[e("div",eo,[e("div",to,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:o.value.AssetNumber},null,8,ao),so])]),e("div",lo,[e("div",oo,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:At.value},null,8,no),ro])]),e("div",io,[e("div",uo,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:ia.value},null,8,co),vo])])])]),e("div",mo,[d(gs,{id:"defect",disabled:Z.value,"allow-delete":!k.value,"is-mandatory":i.defectData.Type=="YES","has-submitted":pe.value},null,8,["disabled","allow-delete","is-mandatory","has-submitted"])]),pe.value?(c(),ge(l,{key:0,class:"error-label"},{default:y(()=>[x("Required")]),_:1})):w("",!0),e("div",fo,[d(He,{value:(tt=(et=o.value)==null?void 0:et.Description)==null?void 0:tt.value,label:ca.value,name:"defectPlaceholder",errorMessage:o.value.Description.errorMessage,"is-valid":o.value.Description.isValid,disabled:k.value,onHandleChange:va},null,8,["value","label","errorMessage","is-valid","disabled"])]),e("div",po,[e("div",ho,[e("div",yo,[e("div",bo,[e("input",{type:"text",class:"form-control",disabled:"",value:o.value.RaisedBy},null,8,go),_o])])])]),e("div",Do,[e("div",ko,[e("div",Co,[e("div",wo,[e("input",{type:"text",class:"form-control",disabled:"",value:o.value.Date},null,8,So),Vo])]),e("div",Po,[e("div",Io,[e("div",$o,[he(e("input",{type:"text",class:"form-control",onInput:R(Ke,["prevent"]),"onUpdate:modelValue":n[1]||(n[1]=b=>Ye.value=b),disabled:k.value,onKeypress:Ne,pattern:"[0-9]*",inputmode:"numeric",onFocusout:Ke},null,40,xo),[[Te,Ye.value]]),Lo]),o.value.PlannedDuration.isValid?w("",!0):(c(),v("div",Fo,[d(l,{class:"error-label"},{default:y(()=>[x(N(o.value.PlannedDuration.errorMessage),1)]),_:1})]))]),e("div",Oo,[d(l,null,{default:y(()=>[x("Hours")]),_:1})])])])]),e("div",Ro,[d(He,{value:o.value.Instruction.value,label:da.value,name:"InstructionPlaceholder",errorMessage:o.value.Instruction.errorMessage,"is-valid":o.value.Instruction.isValid,disabled:k.value,onHandleChange:ma},null,8,["value","label","errorMessage","is-valid","disabled"])]),Ao,d(t,{class:"task-group general-accordion py-1 px-5",modelValue:ie.value,"onUpdate:modelValue":n[6]||(n[6]=b=>ie.value=b)},{default:y(()=>[d(O,{title:"Priority",name:"Priority"},{default:y(()=>[Bo,e("div",No,[e("div",To,[e("div",Mo,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":n[2]||(n[2]=b=>Y.value=b),value:"P1",onChange:R(We,["prevent"]),disabled:k.value},null,40,Eo),[[Me,Y.value]]),Ho])]),Uo,qo]),e("div",jo,[e("div",Yo,[e("div",Ko,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":n[3]||(n[3]=b=>Y.value=b),value:"P2",onChange:R(We,["prevent"]),disabled:k.value},null,40,Qo),[[Me,Y.value]]),Go])]),Jo,Wo]),e("div",zo,[e("div",Xo,[e("div",Zo,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":n[4]||(n[4]=b=>Y.value=b),value:"P3",onChange:R(We,["prevent"]),disabled:k.value},null,40,en),[[Me,Y.value]]),tn])]),an,sn]),e("div",ln,[e("div",on,[e("div",nn,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":n[5]||(n[5]=b=>Y.value=b),value:"P4",onChange:R(We,["prevent"]),disabled:k.value},null,40,rn),[[Me,Y.value]]),un])]),cn,dn])]),_:1})]),_:1},8,["modelValue"]),vn,d(t,{class:"task-group general-accordion py-1 px-5 parts-collapse",modelValue:de.value,"onUpdate:modelValue":n[7]||(n[7]=b=>de.value=b)},{default:y(()=>[d(O,{title:"Parts",name:"Parts"},{default:y(()=>[we.value?(c(),ge(es,{key:0})):w("",!0),mn,(c(!0),v(G,null,ye(o.value.Parts,(b,$)=>(c(),v("div",{class:"row p-3 m-1 priority-container px-0",key:b.partNumber},[e("div",fn,[e("div",pn,[e("input",{type:"text",class:"form-control",value:o.value.Parts[$].partNumber,disabled:k.value,onChange:C=>Tt(C,$)},null,40,hn),b.partNumberValidation.isValid?w("",!0):(c(),v("div",yn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.partNumberValidation.message),1)]),_:2},1024)]))])]),e("div",bn,[e("div",gn,[e("input",{type:"text",class:"form-control",value:b.partDescription,onChange:C=>fa(C,$),disabled:k.value},null,40,_n),b.descriptionValidation.isValid?w("",!0):(c(),v("div",Dn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.descriptionValidation.message),1)]),_:2},1024)]))])]),e("div",kn,[e("div",Cn,[e("div",wn,[he(e("input",{class:"form-control","onUpdate:modelValue":C=>b.qty=C,onInput:R(C=>Qe(C,$),["prevent"]),disabled:k.value,pattern:"[0-9]*",inputmode:"numeric",onKeypress:Ne,onFocusout:C=>Qe(C,$)},null,40,Sn),[[Te,b.qty]])])]),b.qtyValidation.isValid?w("",!0):(c(),v("div",Vn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.qtyValidation.message),1)]),_:2},1024)]))]),e("div",Pn,[e("div",In,[d(_s,{index:$,"item-value":b.images||[],onHandleChangeImage:pa,"is-disabled":k.value},null,8,["index","item-value","is-disabled"])])]),e("div",$n,[e("div",xn,[d(ks,{index:$,"item-value":b.attachment||[],onHandleChangeAttachment:ha,"is-disabled":k.value},null,8,["index","item-value","is-disabled"])]),e("div",{class:se(["position-absolute",k.value?"hidden":""]),style:{top:"10px",right:"0px"}},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(C=>ba($),["prevent"])},null,8,Ln)],2)])]))),128)),e("div",Fn,[e("div",On,[x(" Check Partbook "),e("a",{href:H(q).statePartReference.linkAddress,target:"_blank",class:"fw-bolder",style:{color:"#18AF4A"}},[An,x(" "+N(H(q).statePartReference.brand),1)],8,Rn)]),he(e("button",{class:"my-3 btn-add-new",onClick:ya},[Bn,x(" Add more parts ")],512),[[Wa,!k.value]])])]),_:1})]),_:1},8,["modelValue"]),Nn,d(t,{class:"task-group general-accordion py-1 px-5",modelValue:fe.value,"onUpdate:modelValue":n[9]||(n[9]=b=>fe.value=b)},{default:y(()=>[d(O,{title:"Labour",name:"Labour"},{default:y(()=>[Tn,(c(!0),v(G,null,ye(o.value.Labours,(b,$)=>(c(),v("div",{key:b,class:"row p-3 m-1 priority-container px-0"},[e("div",Mn,[e("div",En,[d(ue,{modelValue:z.value[$],"onUpdate:modelValue":C=>z.value[$]=C,filterable:"",placeholder:"Select Labour",onChange:C=>St($),class:"w-100",disabled:k.value},{default:y(()=>[(c(!0),v(G,null,ye(H(V).positionOption,C=>(c(),ge(j,{key:C.value,label:C.label,value:C.label},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),b.positionValidation.isValid?w("",!0):(c(),v("div",Hn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.positionValidation.message),1)]),_:2},1024)]))])]),e("div",Un,[e("div",qn,[he(e("input",{class:"form-control","onUpdate:modelValue":C=>b.qty=C,pattern:"[0-9]*",inputmode:"numeric",onKeypress:n[8]||(n[8]=(...C)=>H(Wt)&&H(Wt)(...C)),onInput:R(C=>Et(C,$),["prevent"]),disabled:k.value,onFocusout:C=>Et(C,$)},null,40,jn),[[Te,b.qty]]),b.qtyValidation.isValid?w("",!0):(c(),v("div",Yn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.qtyValidation.message),1)]),_:2},1024)]))])]),e("div",Kn,[e("div",Qn,[he(e("input",{class:"form-control","onUpdate:modelValue":C=>b.hireEach=C,pattern:"[0-9]*",inputmode:"numeric",onKeypress:Ne,onInput:R(C=>Ht(C,$),["prevent"]),disabled:k.value,onFocusout:C=>Ht(C,$)},null,40,Gn),[[Te,b.hireEach]]),b.hireEachValidation.isValid?w("",!0):(c(),v("div",Jn,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.hireEachValidation.message),1)]),_:2},1024)]))])]),e("div",Wn,[e("div",zn,[e("div",Xn,[e("input",{class:"form-control",value:b.totalHours,disabled:""},null,8,Zn),e("div",{class:se(["ms-4 d-flex align-items-center",Ct($)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(C=>qt($),["prevent"])},null,8,er)],2)])]),b.totalHoursValidation.isValid?w("",!0):(c(),v("div",tr,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.totalHoursValidation.message),1)]),_:2},1024)]))])]))),128)),k.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:Ut},[ar,x(" Add more labour ")]))]),_:1})]),_:1},8,["modelValue"]),sr,d(t,{class:"task-group general-accordion py-1 px-5",modelValue:_e.value,"onUpdate:modelValue":n[10]||(n[10]=b=>_e.value=b)},{default:y(()=>[d(O,{title:"Other Resource (optional)",name:"Other Resource (optional)"},{default:y(()=>[(c(!0),v(G,null,ye(o.value.Resources,(b,$)=>(c(),v("div",{class:"p-2 d-flex",key:b.value},[e("div",lr,[e("div",or,[e("input",{type:"text",class:"form-control",value:b.value,placeholder:`Resource ${Number($)+1}`,onChange:C=>ga(C,$),disabled:k.value},null,40,nr),e("div",{class:se(["ms-4 d-flex align-items-center",Ct($)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(C=>Da($),["prevent"])},null,8,rr)],2)]),b.isValid?w("",!0):(c(),v("div",ir,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.errorMessage),1)]),_:2},1024)]))])]))),128)),k.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:_a},[ur,x(" Add new resource ")]))]),_:1})]),_:1},8,["modelValue"]),cr,d(t,{class:"task-group general-accordion py-1 px-5",modelValue:I.value,"onUpdate:modelValue":n[11]||(n[11]=b=>I.value=b)},{default:y(()=>[d(O,{title:"Symptom",name:"Symptom"},{default:y(()=>[(c(!0),v(G,null,ye(o.value.Symptoms,(b,$)=>(c(),v("div",{class:"p-2 d-flex flex-column",key:b.value},[e("div",dr,[e("div",vr,[d(ue,{modelValue:A.value[$],"onUpdate:modelValue":C=>A.value[$]=C,placeholder:"Select Symptom",filterable:"",onChange:C=>Va($),class:"w-100",disabled:k.value},{default:y(()=>[(c(!0),v(G,null,ye(H(J).Symptoms,C=>(c(),ge(j,{key:C.id,label:C.symptom,value:C.symptom},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),A.value[$]==="Other"?(c(),v("div",mr,[d(He,{value:M.value[$],label:"Description",name:"Description",errorMessage:"Required","is-valid":te.value[$],index:$,disabled:k.value,onHandleChange:Pa},null,8,["value","is-valid","index","disabled"])])):w("",!0)]),e("div",{class:se(["ms-4 d-flex align-items-center",$===0||k.value?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(C=>$a($),["prevent"])},null,8,fr)],2)]),b.isValid?w("",!0):(c(),v("div",pr,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.errorMessage),1)]),_:2},1024)]))]))),128)),k.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:R(Ia,["prevent"])},[hr,x(" Add another symptom ")]))]),_:1})]),_:1},8,["modelValue"]),yr,d(t,{class:"task-group general-accordion py-1 px-5",modelValue:F.value,"onUpdate:modelValue":n[12]||(n[12]=b=>F.value=b)},{default:y(()=>[d(O,{title:"Cause",name:"Cause"},{default:y(()=>[(c(!0),v(G,null,ye(o.value.Causes,(b,$)=>(c(),v("div",{class:"p-2 d-flex flex-column",key:b.value},[e("div",br,[e("div",gr,[d(ue,{modelValue:E.value[$],"onUpdate:modelValue":C=>E.value[$]=C,placeholder:"Select Cause",filterable:"",onChange:C=>ka($),class:"w-100",disabled:k.value},{default:y(()=>[(c(!0),v(G,null,ye(H(J).Causes,C=>(c(),ge(j,{key:C.id,label:C.causes,value:C.causes},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),E.value[$]==="Other"?(c(),v("div",_r,[d(He,{value:re.value[$],label:"Description",name:"Description",errorMessage:"Required","is-valid":ae.value[$],index:$,disabled:k.value,onHandleChange:Ca},null,8,["value","is-valid","index","disabled"])])):w("",!0)]),e("div",{class:se(["ms-4 d-flex align-items-center",$===0||k.value?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(C=>Sa($),["prevent"])},null,8,Dr)],2)]),b.isValid?w("",!0):(c(),v("div",kr,[d(l,{class:"error-label"},{default:y(()=>[x(N(b.errorMessage),1)]),_:2},1024)]))]))),128)),k.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:wa},[Cr,x(" Add another cause ")]))]),_:1})]),_:1},8,["modelValue"]),i.isForm?(c(),v("div",wr,[K.value?(c(),v(G,{key:1},[e("button",{class:"btn btn-light w-100",onClick:R(kt,["prevent"]),style:{background:"#FFFFFF",border:"1px solid rgba(145, 158, 171, 0.24)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Cancel"),e("button",{class:"ms-3 btn btn-success w-100",onClick:R(jt,["prevent"]),disabled:!K.value,style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Submit",8,Sr)],64)):(c(),v("button",{key:0,class:"btn btn-warning w-100",onClick:R(_t,["prevent"]),style:{background:"#FFC107","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Modify"))])):(c(),v(G,{key:2},[H(ce).SelectedFitter.name?(c(),v(G,{key:0},[K.value?(c(),v("div",Pr,[e("button",{class:"btn btn-light w-100",onClick:R(kt,["prevent"]),style:{background:"#FFFFFF",border:"1px solid rgba(145, 158, 171, 0.24)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Cancel"),e("button",{class:"ms-3 btn btn-success w-100",onClick:R(jt,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Submit")])):(c(),v("div",Vr,[e("button",{class:"ms-3 btn btn-warning w-100",onClick:R(_t,["prevent"]),style:{background:"#FFC107","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Modify")]))],64)):w("",!0)],64))]),d(ts,{show:Ve.value,"parts-warning":sa.value,onAddParts:Mt,onClose:Ba,onSubmit:Aa},null,8,["show","parts-warning"]),d(st,{visibility:$e.value,caption:"Are you sure want to close the defect form? <br /> Note: By closing the defect form, you will lose your defect data that you have already inputted.",onOnNoConfirm:$t,onOnYesConfirm:Ta},null,8,["visibility"]),d(st,{visibility:xe.value,caption:aa.value,onOnNoConfirm:n[13]||(n[13]=()=>{xe.value=!1}),onOnYesConfirm:Dt},null,8,["visibility","caption"]),d(Zt,{show:ee.value,onClose:It,message:wt.value},null,8,["show","message"]),d(Zt,{show:De.value,onClose:It,message:r.value,icon:"/media/svg/dma/alert.svg"},null,8,["show","message"]),d(cs,{visibility:Rt.value,formTitle:"Are you sure want to decline this defect information?","task-title":o.value.Title,onCloseForm:gt,onSubmitDecline:ua},null,8,["visibility","task-title"])]}),_:1},8,["modelValue","custom-class"]),d(fs,{show:ve.value,message:wt.value},null,8,["show","message"])],64)}}}),hd=ta(Ir,[["__scopeId","data-v-c1b0f368"]]),$r=Rs({id:"offlineCrack",state:()=>({stateLoading:!1,stateCancelled:!1,stateIsYes:void 0,stateCrackYesVisible:!1,stateViewYesVisible:!1,statePredefinedPriority:"",stateIsValid:!0,stateItemKey:"",stateTask:{},stateCrackInfo:{},statePayload:{updateParams:[]},stateReferencePhoto:{title:"",blob:"",id:""},statePreviousCrack:[]}),getters:{Loading:i=>i.stateLoading,Cancelled:i=>i.stateCancelled,CrackYesVisible:i=>i.stateCrackYesVisible,ViewYesVisible:i=>i.stateViewYesVisible,ItemKey:i=>i.stateItemKey,isValid:i=>i.stateIsValid,IsYes:i=>i.stateIsYes,crackInfo:i=>i.stateCrackInfo,selectedGroup:()=>xt().selectedGroup,selectedFitter:()=>xt().employee,supervisor:()=>{const i=ea();return{id:i.user.EmployeeId,name:i.user.Name}},images:()=>Ue().ImageObjects.find(f=>f.Id==="crack"),globalConnectionStore:()=>As(),eformStore:()=>xt(),referencePhoto:i=>i.stateReferencePhoto,onlineStatus:()=>ys(),Ownership:()=>Gt().Ownership,SerialNumber:()=>Gt().SerialNumber,PredefinedPriority:i=>i.statePredefinedPriority},actions:{setPredefinedPriority(i){this.statePredefinedPriority=i},setItemKey(i){this.stateItemKey=i},setCancelledState(i){this.stateCancelled=i},cretateInstance(i=!0){this.stateCrackInfo=new Ka,this.stateIsYes=i,this.stateCrackInfo.setType(i?"YES":"NO")},setDefectRequirment(i){this.stateCrackInfo instanceof Ka&&this.stateCrackInfo.setDefectRequirement(i)},setTask(i){this.stateTask=i},toggleYesVisible(i){this.stateCrackYesVisible=i,this.stateCancelled=!1},toggleViewYesVisible(i){this.stateViewYesVisible=i},createCrackF55Payload(i){var q;const f=this.stateCrackInfo,s=((q=this.images)==null?void 0:q.ImageInfos)??[],g=f.Resources.filter(V=>V.value!==""),D=f.Parts.map(V=>{const J=V.qty?String(parseFloat(V.qty)):V.qty;return{...V,qty:J}}),m=f.Labours.map(V=>{const J=V.qty?String(parseFloat(V.qty)):V.qty,W=V.hireEach?String(parseFloat(V.hireEach)):V.hireEach;return{...V,qty:J,hireEach:W}}),T=f.CrackLength.map(V=>{const J=V.currentCrack?String(parseFloat(V.currentCrack)):V.currentCrack;return{...V,currentCrack:J}});this.statePayload.defectDetail={type:f.Type,title:i,assetNumber:f.AssetNumber,description:f.Description.value,raisedBy:this.selectedFitter.name,date:Lt(),plannedDuration:f.PlannedDuration.value,instruction:f.Instruction.value,priority:f.Priority,parts:JSON.stringify(D),labours:JSON.stringify(m),resources:JSON.stringify(g.map(V=>V.value)),symptoms:JSON.stringify(f.Symptoms.map(V=>V.value)),causes:JSON.stringify(f.Causes.map(V=>V.value)),images:JSON.stringify(s),previousCracks:JSON.stringify(T),referencePhoto:this.stateReferencePhoto.id,referenceSection:this.stateReferencePhoto.title,requirement:f.DefectRequirement,isComplete:f.IsComplete}},createPayloadCrack(){const i=xt();this.statePayload.id=this.selectedGroup.id,this.statePayload.workorder=this.selectedGroup.workOrder,this.statePayload.headerId=this.selectedGroup.headerId,this.statePayload.updateParams=[],this.statePayload.updateParams.push({keyValue:this.stateTask.key,propertyParams:[{propertyName:"taskValue",propertyValue:this.stateIsYes?"3":"2"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.selectedFitter)},{propertyName:"updatedDate",propertyValue:Lt()},{propertyName:"reason",propertyValue:i.reasonNA}]}),this.statePayload.updateParams.push({keyValue:this.stateItemKey,propertyParams:[{propertyName:"value",propertyValue:this.stateIsYes?"3":"2"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.eformStore.employee)},{propertyName:"updatedDate",propertyValue:Lt()}]}),this.statePayload.employee=this.selectedFitter;const f=Xt(),s=Xt();this.statePayload.defectHeader={workorder:i.generalForm.workOrder,form:this.selectedGroup.modelId,serviceSheetDetailId:this.selectedGroup.id,category:this.stateTask.category,taskId:this.stateTask.key,taskNo:this.stateTask.description!=""?this.stateTask.description.split(";")[0]:this.stateTask.items[0].value,taskDesc:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,crackWorkorder:"",formCrack:"BA-PL-F55",crackType:this.stateIsYes?"YES":"NO",taskValue:this.stateIsYes?"3":"2",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.supervisor,status:"Submited",defectStatus:"Submited",isActive:"true",defectHeaderId:f,defectDetailId:s,pic:this.selectedFitter.name,role:"Fitter",declineReason:"",approveReason:"",action:"Submitted"};const g=xs(this.stateTask);this.createCrackF55Payload(g)},async createCrack(){this.stateLoading=!0;const i={ver:"v1"};try{const f=xt();await this.updateDefectToLocalDB(!1),f.reasonNA!=""&&f.setReasonNA("");const s=await zt.post(`${Ss}?${new URLSearchParams(i).toString()}`,this.statePayload);switch(this.stateLoading=!1,s.data.result.message){case Ma.TASK_UPDATED_BY_OTHER:return f.toggleTaskAlreadyUpdatedStatus(!0),!1;case Ma.SUBMITTED:return f.toggleFormAlreadySubmitted(!0),!1;case Ma.CLOSE:return f.toggleFormAlreadyClose(!0),!1;default:if(s.data.statusCode==400)return f.toogleTaskErrorDialog(!0),f.stateErrorMessageTaskErrorDialog=s.data.result.message,!1;break}return!0}catch(f){Ga("fe_event_error_service_form_post_crack",{errorMessage:f});const s=this.globalConnectionStore.checkIsErrorNoNetwork(f);return this.stateLoading=!1,Ya("IRONS",f),s?(this.eformStore.updateLocalServiceSheetByParam(this.statePayload.updateParams),this.eformStore.updateTaskProgressOnLocalDB2(),!0):(Qa(f),console.log(f),!1)}},async updateDefectToLocalDB(i=!0){this.stateLoading=!0,this.createPayloadCrack();const f=p.clone(this.statePayload.defectHeader);delete f.supervisor,delete f.defectStatus,await Vs(this.eformStore.stateGeneralForm.workOrder,this.stateTask.key,"false");const s={...p.clone(f),defectData:JSON.stringify(this.statePayload.defectDetail),statusSync:Ge()?"":"Sync",key:"",assetNumber:"",imageAvailable:!0,createdBy:p.clone(this.selectedFitter),createdDate:Lt(),updatedBy:p.clone(this.selectedFitter),updatedDate:Lt()};try{return await Ie.serviceSheetDefect.add(s),i&&(await Ps(this.eformStore.stateGeneralForm.workOrder,this.stateItemKey),await Ie.pendingTask.add({module:"serviceForm",section:"E-Form",type:"Defect",workorder:this.eformStore.generalForm.workOrder,key:this.stateTask.key,bindingKey:this.stateTask.key,payload:JSON.stringify(this.statePayload),syncDate:Ua(),itemKey:this.ItemKey,syncStatus:"Pending"}),this.eformStore.updateLocalServiceSheetByParam(this.statePayload.updateParams),this.eformStore.updateTaskProgressOnLocalDB2(),this.stateLoading=!1),!0}catch(g){return console.log("error update defect to local",g),this.stateLoading=!1,!1}},getPreviousCrackFromState(i){const f=[],s=this.eformStore.statePreviousCrackArr.find(g=>g.taskId==i);s&&(s.previousCrack.forEach(g=>{const D={currentCrack:g.currentCrack,locationDesc:g.locationDesc,locationId:g.locationId,previousCrack:g.previousCrack,isValid:!0,message:""};f.push(D)}),console.log(this.stateCrackInfo),this.stateCrackInfo.importPreviousCrack(...f))},async getReferencePhoto(i){let f="";try{const s=window.URL||window.webkitURL;if(Ge())f=await Ts(i);else{const g=await Bs(i);f=s.createObjectURL(g),Ns(i,this.eformStore.stateGeneralForm.workOrder,g)}return f}catch(s){return console.log(s),""}},async setReferencePhoto(i,f){this.stateReferencePhoto.title=i,this.stateReferencePhoto.blob=await this.getReferencePhoto(f),this.stateReferencePhoto.id=f},async getCrackDetail(i,f){this.stateLoading=!0;const s={ver:"v1"},g={servicesheetDetailId:i,taskId:f};try{const m=(await zt.post(`${Is}?${new URLSearchParams(s).toString()}`,g)).data.result.content.detail;this.updateCrackData(m)}catch(D){Ga("fe_event_error_service_form_get_crack_detail",{errorMessage:D}),Qa(D),Ya("IRONS",D),console.log(D)}this.stateLoading=!1},async getCrackFromLocalDB(i){const f=await Ie.serviceSheetDefect.where({taskId:i,workorder:this.eformStore.stateGeneralForm.workOrder,isActive:"true"}).first();let s;f&&(typeof f.defectData=="string"?s=JSON.parse(f.defectData):s=f.defectData);try{this.updateCrackData(s),this.stateLoading=!1}catch(g){console.log("OFFLINE - error when showing Defect detail",g)}},async getCrackHeaderIdLocally(i,f=void 0){const s=await Ie.serviceSheetDefect.where({taskId:i,workorder:f??this.eformStore.stateGeneralForm.workOrder,isActive:"true"}).first();return(s==null?void 0:s.defectHeaderId)??""},async updateCrackData(i){const f=Ue();f.clearCurrent(),f.setCurrent("crack");const[s,g]=Fs(i);this.stateCrackInfo=s,this.stateCrackInfo.setType(g?"YES":"NO"),await this.setReferencePhoto(i.referenceSection,i.referencePhoto),this.stateIsYes=g;const D=await Os(i.images,void 0);this.toggleViewYesVisible(!0),this.images.ImageInfos=D.ImageInfos,this.images.ImageBlobs=D.ImageBlobs},async getPreviousCrackFromLocalDB(i,f){const s=await Ie.previousCrack.where({workOrder:i,taskId:f}).first(),g=[];s&&(s.previousCrack.forEach(D=>{const m={currentCrack:D.currentCrack,locationDesc:D.locationDesc,locationId:D.locationId,previousCrack:D.previousCrack,isValid:!0,message:""};g.push(m)}),this.stateCrackInfo.importPreviousCrack(...g))},resetInstance(){this.stateLoading=!1,this.stateCrackInfo={},this.stateCrackYesVisible=!1,this.stateViewYesVisible=!1,this.statePredefinedPriority="",this.stateIsValid=!0,this.stateItemKey="",this.stateTask={},this.stateIsYes=void 0,this.stateReferencePhoto={title:"",blob:"",id:""},this.statePayload={updateParams:[]}}}}),L=i=>(Ea("data-v-914ed2d0"),i=i(),Ha(),i),xr={class:"d-flex justify-content-between"},Lr=L(()=>e("span",{class:"el-dialog__title"},"Crack Repair Request",-1)),Fr=["innerHTML"],Or={class:"d-flex",style:{"margin-right":"3rem"}},Rr={key:0,class:"rounded d-flex justify-content-center align-items-center header-badge red-bg text-dark-red mx-2"},Ar=L(()=>e("div",null,"Declined",-1)),Br=[Ar],Nr={key:1,class:"rounded d-flex justify-content-center align-items-center approved-badge header-badge green mx-2"},Tr=L(()=>e("div",null,"Approved",-1)),Mr=[Tr],Er=L(()=>e("div",null,[e("img",{src:za,alt:""})],-1)),Hr={style:{margin:"6px 0 4px 5px"}},Ur={class:"history-wrapper"},qr=L(()=>e("hr",null,null,-1)),jr=L(()=>e("div",{class:"mt-1 p-2"},null,-1)),Yr={class:"d-flex flex-row justify-content-between"},Kr={class:"py-2 d-flex flex-row flex-grow-1"},Qr={class:"flex-fill"},Gr={class:"form-floating"},Jr=["innerHTML"],Wr=L(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),zr={class:"flex-fill ps-3"},Xr={class:"form-floating"},Zr=["innerHTML"],ei=L(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),ti={class:"flex-fill ps-3"},ai={class:"form-floating"},si=["innerHTML"],li=L(()=>e("label",{for:"floatingInput"},"Ownership",-1)),oi={class:"d-flex flex-row justify-content-between"},ni={class:"d-flex justify-content-center reference-photo"},ri={class:"mt-1 py-2"},ii={class:"mt-1 py-2"},ui={class:"row"},ci={class:"col pe-0"},di={class:"form-floating"},vi=["value"],mi=L(()=>e("label",null,"Raised By",-1)),fi={class:"mt-1 py-2"},pi={class:"row"},hi={class:"col-4 pe-0 date"},yi={class:"form-floating"},bi=["value"],gi=L(()=>e("label",null,"Date Raised",-1)),_i={class:"col pe-0 d-flex"},Di={class:"d-flex flex-column flex-fill"},ki={class:"form-floating"},Ci=["disabled"],wi=L(()=>e("label",{class:"text-nowrap"},"How long will this crack repair take?",-1)),Si={key:0,class:"mt-2"},Vi={class:"ms-2 d-flex align-items-center"},Pi={class:"mt-1 py-2"},Ii={class:"mt-1 mb-3 px-3 previous-crack-container word-breaker"},$i=L(()=>e("div",{class:"row justify-content-center table-header-background-color p-1"}," Crack Length ",-1)),xi=L(()=>e("div",{class:"row table-header-background-color p-1"},[e("div",{class:"col"},"Location"),e("div",{class:"col-3"},"Previous"),e("div",{class:"col-3"},"Current"),e("div",{class:"col-1"})],-1)),Li={class:"col"},Fi={class:"col-3"},Oi={class:"col-3"},Ri=["value","onInput","disabled"],Ai={key:0,class:"mt-2"},Bi=L(()=>e("div",{class:"col-1"}," mm",-1)),Ni=L(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1)),Ti={class:"row p-3 m-1 priority-container"},Mi={class:"col-3"},Ei={class:"form-check"},Hi=["disabled"],Ui=L(()=>e("label",{class:"form-check-label"}," (P1) Immediate ",-1)),qi=L(()=>e("div",{class:"col-6 word-breaker"},"Shall shut machine down and undertake repairs.",-1)),ji=L(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Yi={class:"row p-3 m-1 priority-container"},Ki={class:"col-3"},Qi={class:"form-check"},Gi=["disabled"],Ji=L(()=>e("label",{class:"form-check-label"}," (P2) Urgent ",-1)),Wi=L(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 7 days.",-1)),zi=L(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Xi={class:"row p-3 m-1 priority-container"},Zi={class:"col-3"},eu={class:"form-check"},tu=["disabled"],au=L(()=>e("label",{class:"form-check-label"}," (P3) Routine ",-1)),su=L(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 60 days.",-1)),lu=L(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),ou={class:"row p-3 m-1 priority-container"},nu={class:"col-3"},ru={class:"form-check"},iu=["disabled"],uu=L(()=>e("label",{class:"form-check-label"}," (P4) Monitor ",-1)),cu=L(()=>e("div",{class:"col-6 word-breaker"},"Shall continue to inspect and monitor for 90 days.",-1)),du=L(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),vu=L(()=>e("div",{class:"mt-2"},null,-1)),mu=L(()=>e("div",{class:"row p-3 m-1 priority-container px-0",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Part Number"),e("div",{class:"col-5"},"Part Description"),e("div",{class:"col-1"},"Qty"),e("div",{class:"col"}),e("div",{class:"col"})],-1)),fu={class:"col-3 px-0"},pu={class:"d-flex flex-column"},hu=["value","disabled","onChange"],yu={key:0,class:"mt-2"},bu={class:"col-5"},gu={class:"d-flex flex-column"},_u=["value","onChange","disabled"],Du={key:0,class:"mt-2"},ku={class:"col-1 px-1 d-flex flex-column justify-content-start"},Cu={class:"row p-0 m-0 h-50 w-100"},wu={class:"p-0 col-12 d-flex"},Su=["onUpdate:modelValue","onInput","disabled","onFocusout"],Vu={key:0,class:"mt-2 flex-fill"},Pu={class:"col px-1 d-flex flex-column justify-content-start"},Iu={class:"row p-0 m-0 h-100 w-100 align-items-center"},$u={class:"col px-1 d-flex flex-column justify-content-start position-relative"},xu={class:"row p-0 m-0 h-100 w-100 align-items-center"},Lu=["onClick"],Fu={class:"d-flex justify-content-between align-items-center flex-row-reverse"},Ou={class:"fw-bolder"},Ru=["href"],Au=L(()=>e("img",{src:as},null,-1)),Bu=L(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Nu=L(()=>e("div",{class:"mt-2"},null,-1)),Tu=L(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-6"},"Labour Activity"),e("div",{class:"col-2"},"Qty"),e("div",{class:"col-2"},"Hours Each"),e("div",{class:"col-2"},"Total Hours")],-1)),Mu={class:"col-6 px-0"},Eu={class:"d-flex flex-column"},Hu={key:0,class:"mt-2"},Uu={class:"col-2 d-flex justify-content-start"},qu={class:"d-flex flex-column"},ju=["onUpdate:modelValue","onInput","disabled","onFocusout"],Yu={key:0,class:"mt-2"},Ku={class:"col-2 d-flex justify-content-start"},Qu={class:"d-flex flex-column"},Gu=["onUpdate:modelValue","onInput","disabled","onFocusout"],Ju={key:0,class:"mt-2"},Wu={class:"col-2 d-flex flex-column justify-content-start"},zu={class:"row p-0 m-0 h-50 w-100"},Xu={class:"p-0 col-12 d-flex"},Zu=["value"],ec=["onClick"],tc={key:0,class:"mt-2 flex-fill"},ac=L(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),sc=L(()=>e("div",{class:"mt-2"},null,-1)),lc={class:"d-flex flex-fill flex-column"},oc={class:"d-flex flex-row"},nc=["value","placeholder","onChange","disabled"],rc=["onClick"],ic={key:0,class:"mt-2"},uc=L(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),cc=L(()=>e("div",{class:"mt-2"},null,-1)),dc={class:"d-flex flex-row"},vc={class:"d-flex flex-fill flex-column"},mc={key:0,class:"mt-2"},fc=["onClick"],pc={key:0,class:"mt-2"},hc=L(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),yc=L(()=>e("div",{class:"mt-2"},null,-1)),bc={class:"d-flex flex-row"},gc={class:"d-flex flex-fill flex-column"},_c={key:0,class:"mt-2"},Dc=["onClick"],kc={key:0,class:"mt-2"},Cc=L(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),wc={key:2,class:"my-5 w-100 d-flex justify-content-around"},Sc=["disabled"],Vc={key:0,class:"my-5 w-100 d-flex justify-content-around"},Pc={key:1,class:"my-5 w-100 d-flex justify-content-around"},Ic=qe({__name:"CrackForm",props:{visibility:{required:!0,type:Boolean},crackData:{required:!0,type:Object},workOrder:{required:!1,type:String},headerId:{required:!1,type:String},taskId:{required:!1,type:String},status:{required:!0,type:String},viewOnly:{required:!1,type:Boolean,default:!1},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},isForm:{required:!1,type:Boolean,default:!1},isComplete:{required:!0,type:Boolean,default:!1}},emits:["closeForm","onRefreshData"],setup(i,{emit:f}){const s=i,g=f,D=Ue(),m=ss(),T=os(),q=ns(),V=Gt(),J=ls(),W=$r(),ce=ea(),le=hs(),ie=u(""),de=u(),fe=u("Priority"),_e=u("Parts"),I=u("Labour"),F=u("Other Resource (optional)"),oe=u("Symptom"),ne=u("Cause");let K=[];const Ce=u(),pe=u(!0),_=u(!0),Q=u(!1),k=u(!1),Z=u(!1),ve=u(""),ee=u(!1),De=u(!1),we=Re(s,"visibility"),r=Re(s,"crackData"),Ve=u(),me=u(""),o=u([""]),X=u([""]),Y=u([""]),z=u([""]),A=u([!0]),E=u([""]),M=u([!0]),te=u(!1),re=u(!0),ae=u(!1),Ae=u(!1),$e=u(!1),xe=u(!1),Le=u(Xt()),Se=u(!1),je=u(""),lt=u(""),ot=u(),nt=u(""),rt=u([""]),it=u([""]),ut=u([""]),ct=u([""]),dt=u([!0]),vt=u([""]),mt=u([!0]),Je=u(),ft=u(""),aa=U(()=>{var j;const t=Ze()=="Decline"?"Declined":"Approved",l=((j=ht.value[0])==null?void 0:j.role)??" ";return`Are you sure want to modify this crack that has already ${t.toLowerCase()} by the ${l.charAt(0).toUpperCase()+l.slice(1)}`}),pt=["images","description","priority","instruction","plannedDuration","parts","labours","resources","symptoms","causes","crackLength"],ht=U(()=>m.SelectedDefectHeaderHistory),yt=U(()=>m.VersionDate),bt=U(()=>p.isUndefined(W.images)?[]:W.images.ImageInfos),sa=()=>{var t,l;return((l=(t=m.SelectedDefectDetailVersion)==null?void 0:t.detail)==null?void 0:l.isComplete)??!0},la=U(()=>s.crackData.DefectRequirement!="Less than 30 minutes labour and less than $250 in parts"&&r.value.Parts.length==0),oa=U(()=>({images:bt.value,description:s.crackData.Description.value,priority:s.crackData.Priority,instruction:s.crackData.Instruction.value,plannedDuration:s.crackData.PlannedDuration.value,parts:s.crackData.Parts,labours:s.crackData.Labours,resources:s.crackData.Resources,symptoms:s.crackData.Symptoms,causes:s.crackData.Causes,crackLength:s.crackData.CrackLength})),na=U(()=>_.value?!1:ds(pt,Je.value,oa.value)),ra=()=>{ot.value=p.cloneDeep(Ve.value),nt.value=p.cloneDeep(me.value),rt.value=p.cloneDeep(o.value),it.value=p.cloneDeep(X.value),ut.value=p.cloneDeep(Y.value),ct.value=p.cloneDeep(z.value),dt.value=p.cloneDeep(A.value),vt.value=p.cloneDeep(E.value),mt.value=p.cloneDeep(M.value),lt.value=s.crackData.PlannedDuration.value},Rt=()=>{m.setCrackData(s.headerId??""),s.plannerApprove&&m.HeaderStatus!="Decline"&&m.updateHeaderCrack(s.headerId),Ve.value=p.cloneDeep(ot.value),me.value=p.cloneDeep(nt.value),o.value=p.cloneDeep(rt.value),X.value=p.cloneDeep(it.value),Y.value=p.cloneDeep(ut.value),z.value=p.cloneDeep(ct.value),A.value=p.cloneDeep(dt.value),E.value=p.cloneDeep(vt.value),M.value=p.cloneDeep(mt.value),je.value=lt.value},gt=u(!1),At=t=>{gt.value=t},ia=U(()=>V.SerialNumber),ua=U(()=>{const t=V.Ownership;return vs(t)}),Bt=async t=>{const l=Ot.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});s.plannerApprove?await m.updatePlannerCrackDecline(t):await m.updateCrackDecline(t),l.close(),At(!1),_t()},_t=()=>{Q.value=!0,setTimeout(async()=>{Q.value=!1,await ze()},1e3)},Dt=U(()=>{let t="Crack Information Successfully Submitted";return s.status=="Decline"?le.SelectedFitter.id?(t="Crack Identified Successfully Modified",t):(t="Crack Identified Successfully Submitted",t):(ae.value||(t="Crack Approved"),t)}),kt=()=>{const t=["Acknowledge","Decline"];t.includes(Ze()??"")||t.includes(s.status)?xe.value=!0:Ct()},Ct=()=>{xe.value=!1,Jt(Le.value),Ae.value=!0,ra(),Fa(),Je.value={images:p.cloneDeep(bt.value),description:p.cloneDeep(s.crackData.Description.value),priority:p.cloneDeep(s.crackData.Priority),instruction:p.cloneDeep(s.crackData.Instruction.value),plannedDuration:p.cloneDeep(s.crackData.PlannedDuration.value),parts:p.cloneDeep(s.crackData.Parts),labours:p.cloneDeep(s.crackData.Labours),resources:p.cloneDeep(s.crackData.Resources),symptoms:p.cloneDeep(s.crackData.Symptoms),causes:p.cloneDeep(s.crackData.Causes),crackLength:p.cloneDeep(s.crackData.CrackLength)}},wt=()=>{Ae.value=!1,Z.value=!1,Rt(),_.value=!0,Pt()},Ye=U({get:()=>je.value,set:t=>{je.value=t}}),Nt=t=>Ms(Es(t)),ca=U(()=>m.IsError),da=U(()=>"Crack Identified Description"),va=U(()=>"Crack Repair Instructions / Actions"),Ke=t=>{let l=t.keyCode?t.keyCode:t.which;(l<48||l>57)&&l!=46&&t.preventDefault()},ma=(t,l)=>{t.preventDefault(),t.target.value=Oe(t.target.value),r.value.setCurrentCrack(l,t.target.value),r.value.validateCurrentCrack(r.value.CrackLength[l])},We=t=>{r.value.setDescription(t.value),r.value.validateDescription()},Tt=t=>{t.preventDefault(),t.target.value=Oe(t.target.value),isNaN(Number(t.target.value))&&(r.value.setPlannedDuration(t.target.value),r.value.validatePlannedDuration()),r.value.setPlannedDuration(t.target.value),r.value.validatePlannedDuration()},fa=t=>{r.value.setInstruction(t.value),r.value.validateInstruction()},Qe=t=>{t.preventDefault(),r.value.Priority!=t.target.value&&(te.value=!0),r.value.setPriority(t.target.value)},pa=(t,l)=>{t.preventDefault(),r.value.setPartDescription(l,t.target.value),r.value.validatePartDescription(r.value.Parts[l])},ha=(t,l)=>{t.preventDefault(),r.value.setPartNumber(l,t.target.value)},Mt=(t,l)=>{t.preventDefault(),t.target.value=Oe(t.target.value),isNaN(Number(t.target.value))&&(r.value.setPartQty(l,t.target.value),r.value.validatePartQty(r.value.Parts[l])),r.value.setPartQty(l,t.target.value),r.value.validatePartQty(r.value.Parts[l])},ya=t=>{const{value:l,index:j}=t;r.value.setPartImage(j,l),K.push(p.last(l).filename)},ba=t=>{const{value:l,index:j}=t;r.value.setPartAttachment(j,l),K.push(p.last(l).url)},St=()=>{De.value=!1,Z.value=!0,is(Le.value,"parts-collapse")},Et=()=>{if(!r.value.Parts.every(l=>l.partDescription!==""&&l.qty!=="")){r.value.validateParts();return}r.value.addPart({partNumber:"",partDescription:"",qty:""})},Ht=t=>{r.value.removeParts(t)},Be=t=>{r.value.setLabourActivity(t,o.value[t]),r.value.validateLaboursActivity(r.value.Labours[t])},Ut=(t,l)=>{t.preventDefault(),t.target.value=Oe(t.target.value),isNaN(Number(t.target.value))&&(r.value.setLabourQty(l,t.target.value),r.value.validateLaboursQty(r.value.Labours[l]),r.value.Labours[l].position||Be(l),Ne(l)),r.value.setLabourQty(l,t.target.value),r.value.validateLaboursQty(r.value.Labours[l]),Ne(l)},qt=(t,l)=>{t.preventDefault(),t.target.value=Oe(t.target.value),isNaN(Number(t.target.value))&&(r.value.setLabourHireEach(l,t.target.value),r.value.validateLaboursHireEach(r.value.Labours[l]),r.value.Labours[l].position||Be(l),Ne(l)),r.value.setLabourHireEach(l,t.target.value),r.value.validateLaboursHireEach(r.value.Labours[l]),Ne(l)},Ne=t=>{if(!r.value.Labours[t].qty||!r.value.Labours[t].hireEach)return;r.value.Labours[t].totalHoursValidation.message="",r.value.Labours[t].totalHoursValidation.isValid=!0;const l=+r.value.Labours[t].qty,j=+r.value.Labours[t].hireEach;let ue=l*j;Number.isInteger(ue)||(ue=Number((Math.round(ue*100)/100).toFixed(2))),r.value.setLabourTotalHours(t,ue.toString())},ga=()=>{if(!r.value.Labours.every(l=>l.position!==""&&l.qty!==""&&l.hireEach!==""&&l.totalHours!=="")){r.value.validateLabours();return}r.value.addLabour({position:"",qty:"",hireEach:"",totalHours:""})},_a=t=>{o.value.splice(t,1),r.value.removeLabours(t)},Da=(t,l)=>{t.preventDefault(),r.value.setResources(l,t.target.value),!(l==0&&r.value.Resources[l].value=="")&&r.value.validateResource(r.value.Resources[l])},ka=()=>{if(!r.value.Resources.every(l=>l.value!=="")){r.value.validateResourcesAdd();return}r.value.addResource("")},Ca=t=>{r.value.removeResource(t),r.value.validateResourcesRemove()},wa=t=>{Y.value[t]==="Other"&&(E.value[t]="",M.value[t]=!0),r.value.setCauses(t,Y.value[t]),r.value.validateCause(r.value.Causes[t])},Sa=t=>{const l=t.index;typeof l>"u"||l<0||(M.value[l]=t.value!="",E.value[l]=t.value)},Va=()=>{for(const j in r.value.Causes)if(Object.hasOwn(r.value.Causes,j)&&!r.value.Causes[j].isValid)return;if(!r.value.Causes.every(j=>j.value!=="")){r.value.validateCauses();return}const l=Y.value.length-1;if(Y.value[l]==="Other")if(E.value[l])M.value[l]=!0;else{M.value[l]=!1;return}r.value.addCauses("")},Pa=t=>{Y.value.splice(t,1),E.value.splice(t,1),M.value.splice(t,1),r.value.removeCauses(t)},Ia=t=>{X.value[t]==="Other"&&(z.value[t]="",A.value[t]=!0),r.value.setSymptom(t,X.value[t]),r.value.validateSymptom(r.value.Symptoms[t])},$a=t=>{const l=t.index;typeof l>"u"||l<0||(A.value[l]=t.value!="",z.value[l]=t.value)},xa=()=>{for(const j in r.value.Symptoms)if(Object.hasOwn(r.value.Symptoms,j)&&!r.value.Symptoms[j].isValid)return;if(!r.value.Symptoms.every(j=>j.value!=="")){r.value.validateSymptoms();return}const l=X.value.length-1;if(X.value[l]==="Other")if(z.value[l])A.value[l]=!0;else{A.value[l]=!1;return}r.value.addSymptom("")},La=t=>{X.value.splice(t,1),z.value.splice(t,1),A.value.splice(t,1),r.value.removeSymptom(t)},Fa=()=>{_.value=!1,r.value.Resources.length==0&&r.value.addResource("")},Vt=async()=>{r.value.setAssetNumber(m.SelectedDefectDetailVersion.detail.assetNumber),r.value.setPriority(m.SelectedDefectDetailVersion.detail.priority),r.value.setRaisedBy(m.SelectedDefectDetailVersion.detail.raisedBy),r.value.setDate(m.SelectedDefectDetailVersion.detail.date),r.value.setTitle(m.SelectedDefectDetailVersion.detail.title),r.value.setDescription(m.SelectedDefectDetailVersion.detail.description),r.value.importParts(...Pe(m.SelectedDefectDetailVersion.detail.parts)),r.value.importLabours(...Pe(m.SelectedDefectDetailVersion.detail.labours)),r.value.importResources(...Pe(m.SelectedDefectDetailVersion.detail.resources)),r.value.importSymptoms(...Pe(m.SelectedDefectDetailVersion.detail.symptoms)),r.value.importCauses(...Pe(m.SelectedDefectDetailVersion.detail.causes)),r.value.setPlannedDuration(m.SelectedDefectDetailVersion.detail.plannedDuration??""),r.value.setInstruction(m.SelectedDefectDetailVersion.detail.instruction),r.value.importPreviousCrack(...Pe(m.SelectedDefectDetailVersion.detail.previousCracks)),X.value=[],z.value=[],A.value=[],r.value.Symptoms.forEach(t=>{if(t.value.indexOf(":")>-1){const l=t.value.split(":");X.value.push(l[0]),z.value.push(Ee(t.value)),A.value.push(!0)}else X.value.push(t.value),z.value.push(""),A.value.push(!0)}),Y.value=[],E.value=[],M.value=[],r.value.Causes.forEach(t=>{if(t.value.indexOf(":")>-1){const l=t.value.split(":");Y.value.push(l[0]),E.value.push(Ee(t.value)),M.value.push(!0)}else Y.value.push(t.value),E.value.push(""),M.value.push(!0)}),Ye.value=m.SelectedDefectDetailVersion.detail.plannedDuration??"",me.value=m.SelectedDefectDetailVersion.detail.priority,o.value=r.value.Labours.map(t=>t.position),await m.setCrackImages(m.SelectedDefectDetailVersion.detail.images)},Oa=t=>{m.setDetailVersion(t.versionDate)&&(ft.value=t.versionDate,Qt(),Vt())},Pt=()=>{r.value.Resources.length==1&&r.value.Resources[0].value==""&&r.value.removeResource(0)},jt=()=>{for(const l in r.value.Symptoms)if(Object.hasOwn(r.value.Symptoms,l)&&!r.value.Symptoms[l].isValid)return!1;const t=X.value.length-1;return X.value[t]==="Other"?z.value[t]?A.value[t]=!0:A.value[t]=!1:A.value[t]=!0,A.value[t]},Ra=()=>{for(const l in r.value.Causes)if(Object.hasOwn(r.value.Causes,l)&&!r.value.Causes[l].isValid)return!1;const t=Y.value.length-1;return Y.value[t]==="Other"?E.value[t]?M.value[t]=!0:M.value[t]=!1:M.value[t]=!0,M.value[t]},Yt=async()=>{var t;r.value.validateDefectForm(),(p.isUndefined(W.images)||W.images.ImageInfos.length<1)&&(Se.value=!0),(t=r.value)!=null&&t.IsValid&&jt()&&Ra()&&!Se.value?De.value=!0:us()},Aa=()=>{r.value.Symptoms.forEach((t,l)=>{t.value=t.value.includes("Other")?`Other:${z.value[l]}`:t.value})},Ba=()=>{r.value.Causes.forEach((t,l)=>{t.value=t.value.includes("Other")?`Other:${E.value[l]}`:t.value})},It=async t=>{De.value=!1;const l=Ot.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});Aa(),Ba(),r.value.setIsComplete(t.isComplete);const j=s.fitterId==""?JSON.stringify(le.SelectedFitter):s.fitterId,ue=await m.updateCrackFitter(j);if(ca.value){ve.value=ue,l.close(),k.value=!0;return}te.value===!0?(await m.getDefectsData(s.workOrder??""),m.setNewDefectKey()):m.setCrackNewData(),m.setDefectData(s.headerId??""),l.close(),_t()},Kt=()=>{De.value=!1},ze=async()=>{ee.value=!1,k.value=!1,Xe(),Pt(),g("onRefreshData")},Fe=t=>_.value||t==0?"hidden":"",Xe=()=>{m.setDetailVersion(""),Ae.value=!1,Se.value=!1,D.clearCurrent(),me.value="",o.value=[""],X.value=[""],Y.value=[""],z.value=[""],A.value=[!0],E.value=[""],M.value=[!0],_.value=!0,Z.value=!1,g("closeForm")},Qt=(t=!1)=>{$t.value=Ze(),pe.value=t?s.crackData.IsComplete:sa()},Na=()=>{window.location.href.includes("e-form")&&(s.viewOnly?re.value=!0:s.status=="Submited"?(re.value=!1,ae.value=!0):re.value=!0)},Ze=()=>{var t;return ft.value?(t=ht.value.find(l=>l.createdDate==ft.value))==null?void 0:t.action:s.status},$t=u(Ze()),Ta=()=>{Qt(!0),D.addLocalImageInfo({taskKey:s.taskId,workOrder:s.workOrder,type:"defect",updatedBy:s.fitterId,email:ce.user.Email}),de.value=m.referencePhoto.title,D.setShowCloseButton(!0),Jt(Le.value),re.value=s.viewOnly,Na(),me.value=s.crackData.Priority,je.value=s.crackData.PlannedDuration.value,o.value=s.crackData.Labours.map(t=>t.position),Pt(),X.value=[],z.value=[],A.value=[],s.crackData.Symptoms.forEach(t=>{if(t.value.indexOf(":")>-1){const l=t.value.split(":");X.value.push(l[0]),z.value.push(Ee(t.value)),A.value.push(!0)}else X.value.push(t.value),z.value.push(""),A.value.push(!0)}),Y.value=[],E.value=[],M.value=[],s.crackData.Causes.forEach(t=>{if(t.value.indexOf(":")>-1){const l=t.value.split(":");Y.value.push(l[0]),E.value.push(Ee(t.value)),M.value.push(!0)}else Y.value.push(t.value),E.value.push(""),M.value.push(!0)}),ms(Ve.value)},a=()=>{m.resetDetailVersion(),D.setShowCloseButton(!1),_.value?g("closeForm"):na.value?$e.value=!0:g("closeForm")},n=()=>{$e.value=!1},O=()=>{if($e.value=!1,g("closeForm"),K.length==0)return;const t=Ie.pendingTaskFile.where("filename").anyOf(K);t&&t.delete()};return Ft(bt,t=>{t.length>0&&(Se.value=!1)},{deep:!0}),(t,l)=>{const j=be("el-collapse-item"),ue=be("el-collapse"),ke=be("Label"),et=be("el-image"),tt=be("el-option"),b=be("el-select"),$=be("el-dialog");return c(),v(G,null,[d($,{modelValue:we.value,"onUpdate:modelValue":l[15]||(l[15]=C=>we.value=C),"custom-class":`crackform el-defect-crack-form-custom edit-crack-yes ${Le.value}`,width:"90%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1,onClosed:Xe,"before-close":a,onOpened:Ta,"destroy-on-close":!0},{title:y(()=>[e("div",xr,[e("div",null,[Lr,e("span",{class:"el-dialog__title task-title",innerHTML:H(rs)(r.value.Title),ref_key:"defectDetailRef",ref:Ve},null,8,Fr)]),e("div",Or,[e("div",{class:se(["rounded d-flex justify-content-center align-items-center header-badge text-badge mx-2",[i.crackData.Type=="YES"?"yellowish yellowish-text":"blueish blueish-text"]])},[e("div",null,N(i.crackData.Type=="YES"?"Repair required":"Monitor"),1)],2),$t.value=="Decline"?(c(),v("div",Rr,Br)):$t.value=="Acknowledge"?(c(),v("div",Nr,Mr)):w("",!0),e("div",{class:se(["rounded d-flex justify-content-center align-items-center header-badge",pe.value?"green":"red"])},[Er,e("div",Hr,N(pe.value?"Completed":"Incomplete"),1)],2)])])]),default:y(()=>{var C,qa;return[e("div",null,[d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:ie.value,"onUpdate:modelValue":l[0]||(l[0]=h=>ie.value=h)},{default:y(()=>[d(j,{title:"Changes and Approval History",name:"History"},{default:y(()=>[e("div",Ur,[d(Xa,{activities:ht.value},null,8,["activities"]),qr,d(Za,{"version-dates":yt.value,onChangeVersion:Oa,ref_key:"defectVersion",ref:Ce},null,8,["version-dates"])])]),_:1})]),_:1},8,["modelValue"]),jr,e("div",Yr,[e("div",Kr,[e("div",Qr,[e("div",Gr,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:r.value.AssetNumber},null,8,Jr),Wr])]),e("div",zr,[e("div",Xr,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:ia.value},null,8,Zr),ei])]),e("div",ti,[e("div",ai,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:ua.value},null,8,si),li])])])]),e("div",oi,[d(gs,{id:"crack",disabled:_.value,"allow-delete":!_.value,"is-mandatory":!0,"has-submitted":Se.value},null,8,["disabled","allow-delete","has-submitted"])]),Se.value?(c(),ge(ke,{key:0,class:"error-label"},{default:y(()=>[x("Required")]),_:1})):w("",!0),H(m).referencePhoto.blob&&H(m).referencePhoto.blob!=""?(c(),ge(ue,{key:1,class:"task-group general-accordion py-1 px-5",modelValue:de.value,"onUpdate:modelValue":l[1]||(l[1]=h=>de.value=h)},{default:y(()=>[d(j,{title:H(m).referencePhoto.title,name:H(m).referencePhoto.title},{default:y(()=>[e("div",ni,[d(et,{src:H(m).referencePhoto.blob},null,8,["src"])])]),_:1},8,["title","name"])]),_:1},8,["modelValue"])):w("",!0),e("div",ri,[d(He,{value:(qa=(C=r.value)==null?void 0:C.Description)==null?void 0:qa.value,label:da.value,name:"defectPlaceholder",errorMessage:r.value.Description.errorMessage,"is-valid":r.value.Description.isValid,max:255,disabled:_.value,onHandleChange:We},null,8,["value","label","errorMessage","is-valid","disabled"])]),e("div",ii,[e("div",ui,[e("div",ci,[e("div",di,[e("input",{type:"text",class:"form-control",disabled:"",value:r.value.RaisedBy},null,8,vi),mi])])])]),e("div",fi,[e("div",pi,[e("div",hi,[e("div",yi,[e("input",{type:"text",class:"form-control",disabled:"",value:r.value.Date},null,8,bi),gi])]),e("div",_i,[e("div",Di,[e("div",ki,[he(e("input",{type:"text",class:"form-control",onInput:R(Tt,["prevent"]),"onUpdate:modelValue":l[2]||(l[2]=h=>Ye.value=h),disabled:_.value,onKeypress:Ke,pattern:"[0-9]*",inputmode:"numeric",onFocusout:Tt},null,40,Ci),[[Te,Ye.value]]),wi]),r.value.PlannedDuration.isValid?w("",!0):(c(),v("div",Si,[d(ke,{class:"error-label"},{default:y(()=>[x(N(r.value.PlannedDuration.errorMessage),1)]),_:1})]))]),e("div",Vi,[d(ke,null,{default:y(()=>[x("Hours")]),_:1})])])])]),e("div",Pi,[d(He,{value:r.value.Instruction.value,label:va.value,name:"InstructionPlaceholder",errorMessage:r.value.Instruction.errorMessage,"is-valid":r.value.Instruction.isValid,max:255,disabled:_.value,onHandleChange:fa},null,8,["value","label","errorMessage","is-valid","disabled"])]),e("div",Ii,[$i,xi,(c(!0),v(G,null,ye(i.crackData.CrackLength,(h,P)=>(c(),v("div",{key:h,class:"row my-1 d-flex align-items-center"},[e("div",Li,N(H(Ls)(h)),1),e("div",Fi,N(Nt(h.previousCrack))+" "+N(h.previousCrack!="-"?"mm":"-"),1),e("div",Oi,[e("input",{type:"text",class:"form-control",value:Nt(h.currentCrack),onInput:S=>ma(S,P),onKeypress:Ke,pattern:"[0-9]*",inputmode:"numeric",disabled:_.value},null,40,Ri),r.value.CrackLength[P].isValid?w("",!0):(c(),v("div",Ai,[d(ke,{class:"error-label"},{default:y(()=>[x(N(r.value.CrackLength[P].errorMessage),1)]),_:2},1024)]))]),Bi]))),128))]),d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:fe.value,"onUpdate:modelValue":l[7]||(l[7]=h=>fe.value=h)},{default:y(()=>[d(j,{title:"Priority",name:"Priority"},{default:y(()=>[Ni,e("div",Ti,[e("div",Mi,[e("div",Ei,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":l[3]||(l[3]=h=>me.value=h),value:"P1",onChange:R(Qe,["prevent"]),disabled:_.value},null,40,Hi),[[Me,me.value]]),Ui])]),qi,ji]),e("div",Yi,[e("div",Ki,[e("div",Qi,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":l[4]||(l[4]=h=>me.value=h),value:"P2",onChange:R(Qe,["prevent"]),disabled:_.value},null,40,Gi),[[Me,me.value]]),Ji])]),Wi,zi]),e("div",Xi,[e("div",Zi,[e("div",eu,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":l[5]||(l[5]=h=>me.value=h),value:"P3",onChange:R(Qe,["prevent"]),disabled:_.value},null,40,tu),[[Me,me.value]]),au])]),su,lu]),e("div",ou,[e("div",nu,[e("div",ru,[he(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":l[6]||(l[6]=h=>me.value=h),value:"P4",onChange:R(Qe,["prevent"]),disabled:_.value},null,40,iu),[[Me,me.value]]),uu])]),cu,du])]),_:1})]),_:1},8,["modelValue"]),vu,d(ue,{class:"task-group general-accordion py-1 px-5 parts-collapse",modelValue:_e.value,"onUpdate:modelValue":l[8]||(l[8]=h=>_e.value=h)},{default:y(()=>[d(j,{title:"Parts",name:"Parts"},{default:y(()=>[Z.value?(c(),ge(es,{key:0})):w("",!0),mu,(c(!0),v(G,null,ye(r.value.Parts,(h,P)=>(c(),v("div",{class:"row p-3 m-1 priority-container ps-0",key:h.partNumber},[e("div",fu,[e("div",pu,[e("input",{type:"text",class:"form-control",value:r.value.Parts[P].partNumber,disabled:_.value,onChange:S=>ha(S,P)},null,40,hu),h.partNumberValidation.isValid?w("",!0):(c(),v("div",yu,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.partNumberValidation.message),1)]),_:2},1024)]))])]),e("div",bu,[e("div",gu,[e("input",{type:"text",class:"form-control",value:h.partDescription,onChange:S=>pa(S,P),disabled:_.value},null,40,_u),h.descriptionValidation.isValid?w("",!0):(c(),v("div",Du,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.descriptionValidation.message),1)]),_:2},1024)]))])]),e("div",ku,[e("div",Cu,[e("div",wu,[he(e("input",{class:"form-control","onUpdate:modelValue":S=>h.qty=S,onInput:R(S=>Mt(S,P),["prevent"]),disabled:_.value,pattern:"[0-9]*",inputmode:"numeric",onKeypress:Ke,onFocusout:S=>Mt(S,P)},null,40,Su),[[Te,h.qty]])])]),h.qtyValidation.isValid?w("",!0):(c(),v("div",Vu,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.qtyValidation.message),1)]),_:2},1024)]))]),e("div",Pu,[e("div",Iu,[d(_s,{index:P,"item-value":h.images||[],onHandleChangeImage:ya,"is-disabled":_.value},null,8,["index","item-value","is-disabled"])])]),e("div",$u,[e("div",xu,[d(ks,{index:P,"item-value":h.attachment||[],onHandleChangeAttachment:ba,"is-disabled":_.value},null,8,["index","item-value","is-disabled"])]),e("div",{class:se(["position-absolute",_.value?"hidden":""]),style:{top:"10px",right:"0px"}},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(S=>Ht(P),["prevent"])},null,8,Lu)],2)])]))),128)),e("div",Fu,[e("div",Ou,[x(" Check Partbook "),e("a",{href:H(J).statePartReference.linkAddress,target:"_blank",class:"fw-bolder",style:{color:"#18AF4A"}},[Au,x(" "+N(H(J).statePartReference.brand),1)],8,Ru)]),he(e("button",{class:"my-3 btn-add-new",onClick:Et},[Bu,x(" Add more parts ")],512),[[Wa,!_.value]])])]),_:1})]),_:1},8,["modelValue"]),Nu,d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:I.value,"onUpdate:modelValue":l[10]||(l[10]=h=>I.value=h)},{default:y(()=>[d(j,{title:"Labour",name:"Labour"},{default:y(()=>[Tu,(c(!0),v(G,null,ye(r.value.Labours,(h,P)=>(c(),v("div",{key:h,class:"row p-3 m-1 priority-container px-0"},[e("div",Mu,[e("div",Eu,[d(b,{modelValue:o.value[P],"onUpdate:modelValue":S=>o.value[P]=S,filterable:"",placeholder:"Select Labour",onChange:S=>Be(P),class:"w-100",disabled:_.value},{default:y(()=>[(c(!0),v(G,null,ye(H(T).positionOption,S=>(c(),ge(tt,{key:S.value,label:S.label,value:S.label},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),h.positionValidation.isValid?w("",!0):(c(),v("div",Hu,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.positionValidation.message),1)]),_:2},1024)]))])]),e("div",Uu,[e("div",qu,[he(e("input",{class:"form-control","onUpdate:modelValue":S=>h.qty=S,pattern:"[0-9]*",inputmode:"numeric",onKeypress:l[9]||(l[9]=(...S)=>H(Wt)&&H(Wt)(...S)),onInput:R(S=>Ut(S,P),["prevent"]),disabled:_.value,onFocusout:S=>Ut(S,P)},null,40,ju),[[Te,h.qty]]),h.qtyValidation.isValid?w("",!0):(c(),v("div",Yu,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.qtyValidation.message),1)]),_:2},1024)]))])]),e("div",Ku,[e("div",Qu,[he(e("input",{class:"form-control","onUpdate:modelValue":S=>h.hireEach=S,pattern:"[0-9]*",inputmode:"numeric",onKeypress:Ke,onInput:R(S=>qt(S,P),["prevent"]),disabled:_.value,onFocusout:S=>qt(S,P)},null,40,Gu),[[Te,h.hireEach]]),h.hireEachValidation.isValid?w("",!0):(c(),v("div",Ju,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.hireEachValidation.message),1)]),_:2},1024)]))])]),e("div",Wu,[e("div",zu,[e("div",Xu,[e("input",{class:"form-control",value:h.totalHours,disabled:""},null,8,Zu),e("div",{class:se(["ms-4 d-flex align-items-center",Fe(P)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(S=>_a(P),["prevent"])},null,8,ec)],2)])]),h.totalHoursValidation.isValid?w("",!0):(c(),v("div",tc,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.totalHoursValidation.message),1)]),_:2},1024)]))])]))),128)),_.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:ga},[ac,x(" Add more labour ")]))]),_:1})]),_:1},8,["modelValue"]),sc,d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:F.value,"onUpdate:modelValue":l[11]||(l[11]=h=>F.value=h)},{default:y(()=>[d(j,{title:"Other Resource (optional)",name:"Other Resource (optional)"},{default:y(()=>[(c(!0),v(G,null,ye(r.value.Resources,(h,P)=>(c(),v("div",{class:"p-2 d-flex",key:h.value},[e("div",lc,[e("div",oc,[e("input",{type:"text",class:"form-control",value:h.value,placeholder:`Resource ${Number(P)+1}`,onChange:S=>Da(S,P),disabled:_.value},null,40,nc),e("div",{class:se(["ms-4 d-flex align-items-center",Fe(P)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(S=>Ca(P),["prevent"])},null,8,rc)],2)]),h.isValid?w("",!0):(c(),v("div",ic,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.errorMessage),1)]),_:2},1024)]))])]))),128)),_.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:ka},[uc,x(" Add new resource ")]))]),_:1})]),_:1},8,["modelValue"]),cc,d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:oe.value,"onUpdate:modelValue":l[12]||(l[12]=h=>oe.value=h)},{default:y(()=>[d(j,{title:"Symptom",name:"Symptom"},{default:y(()=>[(c(!0),v(G,null,ye(r.value.Symptoms,(h,P)=>(c(),v("div",{class:"p-2 d-flex flex-column",key:h.value},[e("div",dc,[e("div",vc,[d(b,{modelValue:X.value[P],"onUpdate:modelValue":S=>X.value[P]=S,placeholder:"Select Symptom",filterable:"",onChange:S=>Ia(P),class:"w-100",disabled:_.value},{default:y(()=>[(c(!0),v(G,null,ye(H(q).Symptoms,S=>(c(),ge(tt,{key:S.id,label:S.symptom,value:S.symptom},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),X.value[P]==="Other"?(c(),v("div",mc,[d(He,{value:z.value[P],label:"Description",name:"Description",errorMessage:"Required","is-valid":A.value[P],index:P,disabled:_.value,onHandleChange:$a},null,8,["value","is-valid","index","disabled"])])):w("",!0)]),e("div",{class:se(["ms-4 d-flex align-items-center",Fe(P)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(S=>La(P),["prevent"])},null,8,fc)],2)]),h.isValid?w("",!0):(c(),v("div",pc,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.errorMessage),1)]),_:2},1024)]))]))),128)),_.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:R(xa,["prevent"])},[hc,x(" Add another symptom ")]))]),_:1})]),_:1},8,["modelValue"]),yc,d(ue,{class:"task-group general-accordion py-1 px-5",modelValue:ne.value,"onUpdate:modelValue":l[13]||(l[13]=h=>ne.value=h)},{default:y(()=>[d(j,{title:"Cause",name:"Cause"},{default:y(()=>[(c(!0),v(G,null,ye(r.value.Causes,(h,P)=>(c(),v("div",{class:"p-2 d-flex flex-column",key:h.value},[e("div",bc,[e("div",gc,[d(b,{modelValue:Y.value[P],"onUpdate:modelValue":S=>Y.value[P]=S,placeholder:"Select Cause",filterable:"",onChange:S=>wa(P),class:"w-100",disabled:_.value},{default:y(()=>[(c(!0),v(G,null,ye(H(q).Causes,S=>(c(),ge(tt,{key:S.id,label:S.causes,value:S.causes},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),Y.value[P]==="Other"?(c(),v("div",_c,[d(He,{value:E.value[P],label:"Description",name:"Description",errorMessage:"Required","is-valid":M.value[P],index:P,disabled:_.value,onHandleChange:Sa},null,8,["value","is-valid","index","disabled"])])):w("",!0)]),e("div",{class:se(["ms-4 d-flex align-items-center",Fe(P)])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:R(S=>Pa(P),["prevent"])},null,8,Dc)],2)]),h.isValid?w("",!0):(c(),v("div",kc,[d(ke,{class:"error-label"},{default:y(()=>[x(N(h.errorMessage),1)]),_:2},1024)]))]))),128)),_.value?w("",!0):(c(),v("button",{key:0,class:"my-3 btn-add-new",onClick:Va},[Cc,x(" Add another cause ")]))]),_:1})]),_:1},8,["modelValue"]),i.isForm?(c(),v("div",wc,[Ae.value?(c(),v(G,{key:1},[e("button",{class:"btn btn-light w-100",onClick:R(wt,["prevent"]),style:{background:"#FFFFFF",border:"1px solid rgba(145, 158, 171, 0.24)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Cancel"),e("button",{class:"ms-3 btn btn-success w-100",onClick:R(Yt,["prevent"]),disabled:!Ae.value,style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Submit",8,Sc)],64)):(c(),v("button",{key:0,class:"btn btn-warning w-100",onClick:R(kt,["prevent"]),style:{background:"#FFC107","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Modify"))])):(c(),v(G,{key:3},[H(le).SelectedFitter.name?(c(),v(G,{key:0},[Ae.value?(c(),v("div",Pc,[e("button",{class:"btn btn-light w-100",onClick:R(wt,["prevent"]),style:{background:"#FFFFFF",border:"1px solid rgba(145, 158, 171, 0.24)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Cancel"),e("button",{class:"ms-3 btn btn-success w-100",onClick:R(Yt,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Submit")])):(c(),v("div",Vc,[e("button",{class:"ms-3 btn btn-warning w-100",onClick:R(kt,["prevent"]),style:{background:"#FFC107","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Modify")]))],64)):w("",!0)],64))]),d(ts,{show:De.value,"parts-warning":la.value,onAddParts:St,onClose:Kt,onSubmit:It},null,8,["show","parts-warning"]),d(st,{visibility:$e.value,caption:"Are you sure want to close the crack form? <br /> Note: By closing the crack form, you will lose your crack data that you have already inputted.",onOnNoConfirm:n,onOnYesConfirm:O},null,8,["visibility"]),d(st,{visibility:xe.value,caption:aa.value,onOnNoConfirm:l[14]||(l[14]=()=>{xe.value=!1}),onOnYesConfirm:Ct},null,8,["visibility","caption"]),d(Zt,{show:ee.value,onClose:ze,message:Dt.value},null,8,["show","message"]),d(Zt,{show:k.value,onClose:ze,message:ve.value,icon:"/media/svg/dma/alert.svg"},null,8,["show","message"]),d(cs,{visibility:gt.value,formTitle:"Are you sure want to decline this defect information?","task-title":r.value.Title,onCloseForm:At,onSubmitDecline:Bt},null,8,["visibility","task-title"])]}),_:1},8,["modelValue","custom-class"]),d(fs,{show:Q.value,message:Dt.value},null,8,["show","message"])],64)}}}),yd=ta(Ic,[["__scopeId","data-v-914ed2d0"]]);export{yd as C,hd as D,gs as L,_s as _,ks as a,Zt as b,ol as c,$r as u};
