import{u as We}from"./useMenuStore-CD5Gmvif.js";import{u as Ae}from"./vue-router-iNp9kJ0K.js";import{c as K,a as ve,K as Fe,j as xe,J as $e,I as Me,A as Ke}from"./index-BuVmIl8K.js";import{F as Pe}from"./file-saver-CwTBvle_.js";import{P as Je}from"./Pagination-D-xfdYmn.js";import{A as Te}from"./MetronicAlert-CahvwpSR.js";import{P as Be}from"./Pagination-BiobnanQ.js";import{d as Ee}from"./pinia-BjOS2_Ao.js";import{c as ge}from"./mapOption-CeGMwmH0.js";import{x as Re,y as Se,B as Le}from"./date-format-8-IvfSl3.js";import{k as de,r as F,R as I,Y as we,p as c,aa as b,s,x as a,aB as o,B as H,C as R,A as U,u as i,y as oe,q as S,F as z,$ as Q,bd as ye,bb as qe,c as ee,b4 as re,d as Ge,L as ze,T as je,a5 as Xe,a0 as Qe,a7 as Ze}from"./@vue-BypzYtbH.js";import{_ as ue}from"./nw-img-vue-CR837WER.js";import{a as et}from"./table-sort-Bpdq_Uwn.js";import{b as Ce}from"./element-plus-BeWdvTRa.js";import{E as tt}from"./ErrorAlert-CMKGfwAi.js";import{a as ot}from"./vee-validate-C_msoaAA.js";import{c as Ve,a as ae}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./lodash-DrHMlsdo.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";const Ne="https://digital-bumaau-dev-apm-001.azure-api.net/ironlake-asset",X=`${Ne}/api/ironlake/equipment`,Ye=`${Ne}/api/ironlake/equipment_hmoffset`,ie=Ee({id:"allEquipmentBulk",state:()=>({statePagination:new Be,stateUploadLoading:!1,stateUploadProgress:null,stateTotalUploaded:0,stateDraftData:[],stateAlert:{show:!1,variant:"",desc:""},stateIsNewForm:!1,stateIsError:!1,stateError:"",stateLoading:!1,stateLoadingMsg:""}),getters:{progressPercentage:n=>n.stateUploadProgress!==null?`${n.stateUploadProgress}%`:"",alertVariant:n=>n.stateAlert.variant,alertDesc:n=>n.stateAlert.desc,pagination:n=>n.statePagination,error:n=>n.stateError,isError:n=>n.stateIsError,loading:n=>n.stateLoading,loadingMessage:n=>n.stateLoadingMsg,uploadLoading:n=>n.stateUploadLoading},actions:{async downloadBulkTemplate(n){const l=new URLSearchParams({ver:"v1"}).toString();try{return(await K.postBlob(`${X}/export/true/${n}?${l}`,{})).data}catch(e){console.log(e)}},setAlert(n,l,e){n===0&&l===0?this.stateAlert={show:!0,variant:"info",desc:"No record has been submitted, please check your file"}:n===0&&l>0?this.stateAlert={show:!0,variant:"success",desc:`${l} of
          ${l} ${e} submitted successfully`}:n>0&&l>0&&(this.stateAlert={show:!0,variant:"warning",desc:`${n} of
          ${l} ${e} failed to upload`})},async upload(n,l){this.stateUploadLoading=!0,this.stateLoading=!0,this.stateLoadingMsg="Uploading Data";const e=new URLSearchParams({ver:"v1"}).toString(),t=l?`${X}/bulk?${e}`:`${Ye}/bulk?${e}`,p=new FormData;p.append("fileUpload",n);const u=q=>{const M=Math.round(q.loaded*100/q.total);this.stateUploadProgress=M};try{this.stateIsError=!1,this.stateError="";const q=await K.postWithProgress(t,p,u);if(q.data.statusCode==200)if(q.data.result.isError)this.stateIsError=!0,this.stateError=q.data.result.message,this.stateLoading=!1;else{const M=q.data.result.content;this.stateTotalUploaded=M.totalData;const D=M.equipmentList.filter(A=>A.isValid===!1).length,_=M.totalData>1?"records":"record";this.setAlert(D,M.totalData,_),this.stateLoading=!1}else this.stateAlert={show:!0,variant:"warning",desc:q.data.result.message},this.stateIsError=q.data.result.isError,this.stateError=q.data.result.message,this.stateLoading=!1}catch(q){this.stateIsError=!0,this.stateError=q.response.data.result.message}finally{this.stateUploadProgress=null,this.stateLoading=!1}this.stateUploadLoading=!1,this.stateLoading=!1,this.stateLoadingMsg=""},removeDraftItemById(n){const l=this.stateDraftData.findIndex(t=>t.equipmentNoDraftId===n);this.stateDraftData.splice(l,1);const e=this.stateDraftData.length;if(e===0)this.stateAlert.show=!1;else{const t=this.stateTotalUploaded>1?"records":"record";this.stateTotalUploaded--;const p=this.stateTotalUploaded;this.stateAlert.desc=`${e} of ${p} ${t} failed to submit`}},async deleteDraft(n){const l={ver:"v1"},e=[{equipmentDraftId:n}];this.stateLoading=!0,this.stateLoadingMsg="Removing Data";try{const t=await K.post(`${X}/delete_draft?${new URLSearchParams(l).toString()}`,e);return this.stateAlert.show=!1,this.removeDraftItemById(n),t.data}catch(t){console.log(t)}finally{this.stateLoading=!1,this.stateLoadingMsg=""}},async deleteBulkDraft(n){const l=new URLSearchParams({ver:"v1"}).toString();this.stateLoading=!0,this.stateLoadingMsg="Removing Data";try{const e=await K.post(`${X}/delete_draft?${l}`,n);return this.stateAlert.show=!1,e.data}catch(e){console.log(e)}finally{this.stateLoading=!1,this.stateLoadingMsg=""}}}}),ke=ve();class Ue{constructor(l){this.equipmentUnitId=null,this.siteName=l&&l.isHO===1?"":l.Location,this.ownership="",this.equipmentUnit="",this.group="",this.brandName="",this.model="",this.engineHourMeterOffset=null,this.serialNo="",this.componentCode="",this.componentName="",this.resetDate="",this.isActive=!0}}const ce=Ee({id:"allEquipmentForm",state:()=>({stateLoading:!1,stateFormToggle:!1,stateIsNewForm:!0,stateIsDraftForm:!1,stateFormItem:[new Ue(ke.user)],stateComponentTable:[],stateIsError:!1,stateError:"",stateErrors:[],stateIsFocusEqp:null,stateIsFocusComp:null,stateSiteOption:[],stateOwnershipOption:[],stateEqpNoOption:[],stateEqpGroupOption:[],stateEqpBrandOption:[],stateEqpModelOption:[],stateCompTypeOption:[],stateComponentOption:[]}),getters:{formToggle:n=>n.stateFormToggle,isNewForm:n=>n.stateIsNewForm,isDraftForm:n=>n.stateIsDraftForm,error:n=>n.stateError,errors:n=>n.stateErrors,isError:n=>n.stateIsError,loading:n=>n.stateLoading,siteOption:n=>n.stateSiteOption,ownershipOption:n=>{const l=n.stateOwnershipOption.map(e=>e);return l.unshift({label:"Add Other Ownership",value:9999}),l},ownershipFilterOption:n=>n.stateOwnershipOption,eqpNoOption:n=>n.stateEqpNoOption,eqpGroupOption:n=>{const l=n.stateEqpGroupOption.map(e=>e);return l.unshift({label:"Add Other Group",value:9999}),l},eqpGroupFilterOption:n=>n.stateEqpGroupOption,eqpBrandOption:n=>{const l=n.stateEqpBrandOption.map(e=>e);return l.unshift({label:"Add Other Brand",value:9999}),l},eqpBrandFilterOption:n=>n.stateEqpBrandOption,eqpModelOption:n=>{const l=n.stateEqpModelOption.map(e=>e);return l.unshift({label:"Add Other Model",value:9999}),l},eqpModelFilterOption:n=>n.stateEqpModelOption,componentOption:n=>{const l=n.stateComponentOption.map(e=>e);return l.unshift({componentCode:"Others",componentName:"Others"}),l},componentFilterOption:n=>n.stateComponentOption,componentsTable:n=>n.stateComponentTable},actions:{async getLookupSite(){const n=`${X}/lookup_site`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l),t=u=>u.siteName,p=u=>u.siteId;this.stateSiteOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupOwnership(){const n=`${X}/lookup_ownership`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l),t=u=>u.ownership,p=u=>u.ownershipId;this.stateOwnershipOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupEqpNo(){const n=`${X}/lookup_equipment_no`,l=new URLSearchParams({ver:"v1",siteId:ke.user.isHO===1?"":ke.user.SiteId}).toString();try{const e=await K.get(n,"",l),t=u=>u.equipmentNo,p=u=>u.equipmentNoId;this.stateEqpNoOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupEqpGroup(){const n=`${X}/lookup_equipment_group`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l),t=u=>u.equipmentGroup,p=u=>u.equipmentGroupId;this.stateEqpGroupOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupEqpBrand(){const n=`${X}/lookup_brand`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l),t=u=>u.brand,p=u=>u.brandId;this.stateEqpBrandOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupEqpModel(){const n=`${X}/lookup_equipment_model`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l),t=u=>u.equipmentModel,p=u=>u.equipmentModelId;this.stateEqpModelOption=ge(e.data.result.content,t,p)}catch(e){console.log(e)}},async getLookupComponent(){const n=`${X}/lookup_component`,l=new URLSearchParams({ver:"v1"}).toString();try{const e=await K.get(n,"",l);this.stateComponentOption=e.data.result.content}catch(e){console.log(e)}},getAllLookup(){this.getLookupSite(),this.getLookupOwnership(),this.getLookupEqpNo(),this.getLookupEqpGroup(),this.getLookupEqpBrand(),this.getLookupEqpModel(),this.getLookupComponent()},async upsertDataDraft(n){const l={ver:"v1"};ie().stateAlert.show=!1;const e=this.stateFormItem[0];e.resetDate=e.resetDate===null?"":e.resetDate;const t=[{equipmentDraftId:e.equipmentDraftId,equipmentUnit:e.equipmentUnit,siteName:e.siteName,serialNo:e.serialNo,group:e.group,brandName:e.brandName,model:e.model,ownership:e.ownership,resetDate:e.resetDate,engineHourMeterOffset:e.engineHourMeterOffset,componentCode:e.componentCode,componentName:e.componentName,isActive:e.isActive}],p=[{equipmentDraftId:e.equipmentDraftId,equipmentUnit:e.equipmentUnit,siteName:e.siteName,engineHourMeterOffset:e.engineHourMeterOffset,resetDate:e.resetDate,isActive:e.isActive}],u=n?t:p,q=`${X}/upsert?${new URLSearchParams(l).toString()}`,M=`${Ye}/upsert?${new URLSearchParams(l).toString()}`,D=n?q:M,_=await K.post(D,u);return this.stateLoading=!1,_.data.result.isError?(this.setErrors(_.data.result.content.equipmentList[0].validationReason.split(",")),xe("Failed to Submit","","Ok"),_):(Fe("Record has been submitted successfully","","Ok"),ie().removeDraftItemById(e.equipmentDraftId),ie().stateAlert.show=!1,_)},async insertData(n){this.stateLoading=!0;try{const l={ver:"v1"};if(this.stateIsDraftForm)return this.upsertDataDraft(n);const e=[];if(this.stateComponentTable.length>0)this.stateComponentTable.forEach(p=>{const u=this.stateFormItem[0],{componentCode:q,componentName:M}=p,D={equipmentUnitId:u.equipmentUnitId,equipmentUnit:u.equipmentUnit,siteName:u.siteName,serialNo:u.serialNo,group:u.group,brandName:u.brandName,model:u.model,ownership:u.ownership,engineHourMeterOffset:u.engineHourMeterOffset,resetDate:u.resetDate,isActive:u.isActive,isWarning:u.isWarning,componentCode:q,componentName:M};e.push(D)});else{const p=this.stateFormItem[0];p.componentCode="",p.componentName="",e.push(p)}const t=await K.post(`${X}/upsert?${new URLSearchParams(l).toString()}`,e);return this.stateLoading=!1,t.data.result.isError?(this.setErrors(t.data.result.content.equipmentList[0].validationReason.split(",")),xe("Failed to Submit","","Ok"),t):(Fe("Record has been submitted successfully","","Ok"),t)}catch(l){this.stateErrors.push(l.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(n){this.stateErrors=n,this.stateIsError=this.stateErrors.length>0},resetFormItem(){this.stateFormItem=[new Ue(ke.user)],this.stateComponentTable=[],this.stateIsNewForm=!0,this.stateIsDraftForm=!1}}}),le=ce(),nt=ie();class He{constructor(l){this.siteId=l&&l.isHO===1?null:l.SiteId,this.ownershipId=null,this.equipmentNoId=null,this.equipmentGroupId=null,this.brandId=null,this.equipmentModelId=null,this.engineHourMeter=null,this.engineHourMeterOffset=null,this.component="",this.status=null,this.onlyEquipment=!0,this.page=1,this.pageSize=20}}const pe=Ee({id:"allEquipmentList",state:()=>({stateFilterForm:new He(ve().user),stateList:[],stateOnlyEquipment:!0,statePageName:"all-equipment",statePagination:new Be,stateLoading:!1,stateCompListLoading:!1,statePaginationLoading:!1}),getters:{pageName:n=>n.statePageName,pagination:n=>n.statePagination,isEqpMode:n=>n.stateOnlyEquipment,siteOption:()=>le.siteOption,eqpNoOption:()=>le.eqpNoOption,eqpGroupOption:()=>le.eqpGroupFilterOption,eqpBrandOption:()=>le.eqpBrandFilterOption,eqpModelOption:()=>le.eqpModelFilterOption,ownershipOption:()=>le.ownershipFilterOption,list:n=>n.stateList,loading:n=>n.stateLoading,paginationLoading:n=>n.statePaginationLoading},actions:{setTotalPage(n){this.pagination.totalPage=n,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},setOnlyEqpLocal(n){localStorage.setItem("isNotHMO",JSON.stringify(n));const l=localStorage.getItem("isNotHMO");l!==null&&(this.stateOnlyEquipment=JSON.parse(l))},checkEmptyString(n){return n===""?null:n},async getList(){this.stateLoading=!0;const n={ver:"v1"},l=this.stateFilterForm,e=localStorage.getItem("isNotHMO");e!==null&&(this.stateOnlyEquipment=JSON.parse(e)),l.siteId=this.checkEmptyString(l.siteId),l.ownershipId=this.checkEmptyString(l.ownershipId),l.equipmentNoId=this.checkEmptyString(l.equipmentNoId),l.equipmentGroupId=this.checkEmptyString(l.equipmentGroupId),l.brandId=this.checkEmptyString(l.brandId),l.equipmentModelId=this.checkEmptyString(l.equipmentModelId),l.engineHourMeter=this.checkEmptyString(l.engineHourMeter),l.engineHourMeterOffset=this.checkEmptyString(l.engineHourMeterOffset),l.onlyEquipment=this.stateOnlyEquipment,l.status=this.checkEmptyString(l.status);try{const p=(await K.post(`${X}?${new URLSearchParams(n).toString()}`,l)).data.result.content;this.stateList=p.equipmentList,p.equipmentDraftList&&(nt.stateDraftData=p.equipmentDraftList),this.setTotalPage(p.totalData)}catch(t){console.log(t)}this.stateLoading=!1},async setPage(n){this.statePaginationLoading=!0,this.statePagination.totalPageSize=this.stateFilterForm.pageSize,this.statePagination.handleCurrentPageChange(n),this.stateFilterForm.page=this.statePagination.currentPage,await this.getList(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setAppliedFilter(n){this.stateFilterForm=n,await this.setPage(1)},async getComponentByEqp(n){const l={ver:"v1"},e=`${Ne}/api/ironlake/component_by_equipment?${new URLSearchParams(l).toString()}`,t=this.stateFilterForm;let p;le.stateIsNewForm?p={equipmentNoId:t.equipmentNoId===null?n:t.equipmentNoId,siteId:t.siteId,component:t.component}:p={equipmentNoId:t.equipmentNoId===null?n:t.equipmentNoId,siteId:t.siteId};try{this.stateCompListLoading=!0;const u=await K.post(e,p);if(this.stateCompListLoading=!1,!u.data.result.isError){const q=this.stateList.findIndex(M=>M.equipmentNoId===n);this.stateList[q].component=u.data.result.content.componentList}}catch(u){return this.stateCompListLoading=!1,u}},resetListComp(n){const l=this.stateList.findIndex(e=>e.equipmentNoId===n);this.stateList[l].component=[]},async export(){const n=new URLSearchParams({ver:"v1"}).toString(),{siteId:l,ownershipId:e,equipmentNoId:t,equipmentGroupId:p,brandId:u,equipmentModelId:q,engineHourMeter:M,engineHourMeterOffset:D,component:_,status:A}=this.stateFilterForm,J={siteId:l,ownershipId:e,equipmentNoId:t,equipmentGroupId:p,brandId:u,equipmentModelId:q,engineHourMeter:M,engineHourMeterOffset:D,component:_,status:A};try{return(await K.postBlob(`${X}/export/false/false?${n}`,J)).data}catch(P){console.log(P)}},resetFilter(){this.stateFilterForm=new He(ve().user)}}}),st=n=>(ye("data-v-a4a7bcde"),n=n(),qe(),n),at={key:0,class:"d-flex justify-content-end"},lt={class:"svg-icon svg-icon-btech-danger-500 d-inline-block mr-2"},rt={key:1,style:{height:"100px"}},it={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},dt=["onClick"],ut={class:"m-0",style:{"line-height":"1.25rem"}},ct={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},pt={class:"m-0",style:{"line-height":"1.25rem"}},mt={key:0},ht={key:1},ft={key:0},gt={key:1},vt={class:"d-flex justify-content-center gap-6"},_t=["onClick"],bt=["onClick"],wt={class:"m-0"},yt={class:"m-0 invalid-reason"},qt=st(()=>o("span",{class:"dialog-footer"},null,-1)),It=de({__name:"DraftTable",props:{listData:{required:!0,type:Array}},emits:["show-form","load-page","close-expand"],setup(n,{emit:l}){const e=n,t=pe(),p=ie(),u=ce(),q=l,M=E=>{u.stateIsNewForm=!1,u.stateIsDraftForm=!0,u.setErrors(E.row.validationReason.split(","));const w={equipmentDraftId:E.row.equipmentNoDraftId,equipmentUnit:E.row.equipmentNo,siteName:E.row.siteName,serialNo:E.row.serialNo,group:E.row.equipmentGroup,brandName:E.row.equipmentBrand,model:E.row.equipmentModel,ownership:E.row.ownership,engineHourMeterOffset:E.row.engineHourMeterOffset,resetDate:E.row.resetDate,componentCode:E.row.componentCode,componentName:E.row.componentName,isActive:!0};u.stateComponentTable=[{componentCode:E.row.componentCode,componentName:E.row.componentName}],u.stateFormItem=[w],q("show-form")},D=async E=>{$e("Remove this record from Need Review?","Remove").then(async w=>{w.isConfirmed&&await p.deleteDraft(E.row.equipmentNoDraftId).then(()=>{q("load-page"),q("close-expand"),Me("Record have been successfully deleted!","Ok")})})},_=F([]),A=E=>{_.value=E.map(w=>({equipmentDraftId:w.equipmentNoDraftId}))},J=()=>{$e("Remove all selected records from Need Review?","Remove").then(async E=>{E.isConfirmed&&await p.deleteBulkDraft(_.value).then(()=>{q("load-page"),q("close-expand"),Me("Records have been successfully deleted!","Ok"),_.value=[]})})},P=F(!1),V=F(""),T=F([]),G=E=>{V.value=E.equipmentNo,T.value=E.validationReason.split(",").map(w=>w),P.value=!0};return(E,w)=>{const O=I("inline-svg"),j=I("el-button"),L=I("el-tooltip"),d=I("el-table-column"),v=I("el-table"),g=I("el-dialog"),C=we("loading");return c(),b(z,null,[_.value.length>0?(c(),b("section",at,[s(j,{class:"btn btn-outline btn-outline-btech-danger btn-active-light-btech-danger btech-md mb-4",onClick:J},{default:a(()=>[o("span",lt,[s(O,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})]),H(" Delete ("+R(_.value.length)+") ",1)]),_:1})])):U("",!0),i(p).loading||i(t).loading?oe((c(),b("div",rt,null,512)),[[C,i(p).loading||i(t).loading]]):(c(),S(v,{key:2,data:e.listData,style:{width:"100%"},"empty-text":"No Data to Display","max-height":400,"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSelect:A,onSelectAll:A},{default:a(()=>[s(d,{prop:"siteName",label:"Site",width:"226",sortable:"","sort-orders":["ascending","descending"]},{default:a(N=>[o("div",it,[s(L,{class:"box-item",effect:"dark",placement:"top",content:"Click to see errors"},{default:a(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 me-1",style:{cursor:"pointer"},onClick:B=>G(N.row)},[s(O,{src:"/media/icons/bumaau/info.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,dt)]),_:2},1024),o("p",ut,R(N.row.siteName),1)])]),_:1}),s(d,{prop:"equipmentNo",label:"Equipment No",width:"178",sortable:"","sort-orders":["ascending","descending"]},{default:a(N=>[o("div",ct,[o("p",pt,R(N.row.equipmentNo),1)])]),_:1}),i(t).stateOnlyEquipment?(c(),S(d,{key:0,prop:"equipmentGroup",label:"Group",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),i(t).stateOnlyEquipment?(c(),S(d,{key:1,prop:"equipmentBrand",label:"Brand",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),i(t).stateOnlyEquipment?(c(),S(d,{key:2,prop:"equipmentModel",label:"Model",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),i(t).stateOnlyEquipment?(c(),S(d,{key:3,prop:"ownership",label:"Ownership",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),i(t).stateOnlyEquipment?(c(),S(d,{key:4,prop:"serialNo",label:"Serial No",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),s(d,{prop:"engineHourMeterOffset",label:"Hour Meter Offset",width:"178",align:"center",sortable:"","sort-orders":["ascending","descending"]},{default:a(N=>[N.row.engineHourMeterOffset?(c(),b("div",mt,R(N.row.engineHourMeterOffset),1)):(c(),b("span",ht,"-"))]),_:1}),s(d,{label:"Hour Meter Offset Reset Date",sortable:"",width:i(t).stateOnlyEquipment?240:"","sort-orders":["ascending","descending"]},{default:a(N=>[N.row.resetDate?(c(),b("span",ft,R(i(Re)(N.row.resetDate)),1)):(c(),b("span",gt,"-"))]),_:1},8,["width"]),i(t).stateOnlyEquipment?(c(),S(d,{key:5,prop:"componentCode",label:"Component Code",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),i(t).stateOnlyEquipment?(c(),S(d,{key:6,prop:"componentName",label:"Component Name",width:"178",sortable:"","sort-orders":["ascending","descending"]})):U("",!0),s(d,{label:"Action","header-align":"center",fixed:"right",width:"80"},{default:a(N=>[o("div",vt,[s(L,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:a(()=>[o("span",{class:"svg-icon svg-icon-btech-secondary-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:B=>M(N)},[s(O,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,_t)]),_:2},1024),s(L,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:a(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:B=>D(N)},[s(O,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,bt)]),_:2},1024)])]),_:1}),s(d,{type:"selection",fixed:"right",width:"40",align:"center","header-align":"center"})]),_:1},8,["data"])),s(g,{modelValue:P.value,"onUpdate:modelValue":w[0]||(w[0]=N=>P.value=N),title:`Errors for Equipment No. ${V.value}`,"modal-class":"ironlake-dialog",width:"40%","align-center":""},{footer:a(()=>[qt]),default:a(()=>[o("ul",wt,[(c(!0),b(z,null,Q(T.value,N=>(c(),b("li",{key:T.value.indexOf(N)},[o("p",yt,R(N),1)]))),128))])]),_:1},8,["modelValue","title"])],64)}}}),Ot=ue(It,[["__scopeId","data-v-a4a7bcde"]]),te=n=>(ye("data-v-b0018e9c"),n=n(),qe(),n),kt={key:0,class:"mb-3 d-flex justify-content-between"},Ct=te(()=>o("p",{class:"m-0 card-table-title"},"Equipment List",-1)),$t=[Ct],Et={class:"align-self-center d-flex gap-2 ironlake-table-toolbar"},Nt={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block mr-2"},Dt={class:"p-2 d-flex flex-column gap-8"},Ft=te(()=>o("section",null,[o("p",{class:"m-0 popover-title"},"Filters")],-1)),xt={class:"d-flex flex-column gap-6"},Mt={class:"container p-0"},St={class:"row m-0 gap-4"},Lt={class:"col p-0"},Vt={class:"col p-0"},Ut=te(()=>o("div",{class:"col p-0"},null,-1)),Ht=te(()=>o("div",{class:"col p-0"},null,-1)),At={class:"container p-0"},Pt={class:"row m-0 gap-4"},Tt={class:"col p-0"},Bt={class:"col p-0"},Rt={class:"col p-0"},Gt={class:"col p-0"},zt={class:"container p-0"},jt={class:"row m-0 gap-4"},Yt={class:"col p-0"},Wt=te(()=>o("p",{class:"m-0"},[H(" Engine Hour Meter/ "),o("br"),H("Service Meter (SMU) ")],-1)),Kt={class:"col p-0"},Jt=te(()=>o("span",null,"Hour Meter Offset",-1)),Xt={class:"col p-0"},Qt=te(()=>o("div",{class:"col p-0"},null,-1)),Zt={class:"container p-0"},eo={class:"row m-0 gap-4"},to={class:"col p-0"},oo=te(()=>o("span",null,"Status",-1)),no=te(()=>o("div",{class:"col p-0"},null,-1)),so=te(()=>o("div",{class:"col p-0"},null,-1)),ao=te(()=>o("div",{class:"col p-0"},null,-1)),lo={class:"d-flex justify-content-end gap-3"},ro={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block mr-2"},io=de({__name:"ListTableFilter",emits:["close-expand"],setup(n,{expose:l,emit:e}){const t=pe(),p=ie(),u=ve(),q=ee(()=>u.user),M=[{label:"All",value:null},{label:"Active",value:!0},{label:"Inactive",value:!1}],D=F(!1),_=F({siteId:q.value.isHO===1?null:q.value.SiteId,ownershipId:null,equipmentNoId:null,equipmentGroupId:null,brandId:null,equipmentModelId:null,engineHourMeter:null,engineHourMeterOffset:null,component:"",componentTypeId:null,componentLifeHour:null,status:null,onlyEquipment:t.stateOnlyEquipment,page:1,pageSize:20});l({dataFilter:_});const A=()=>{const w=t.stateFilterForm;_.value={siteId:w.siteId,ownershipId:w.ownershipId,equipmentNoId:w.equipmentNoId,equipmentGroupId:w.equipmentGroupId,brandId:w.brandId,equipmentModelId:w.equipmentModelId,engineHourMeter:w.engineHourMeter,engineHourMeterOffset:w.engineHourMeterOffset,component:w.component,componentTypeId:w.componentTypeId,componentLifeHour:w.componentLifeHour===null?void 0:w.componentLifeHour,status:w.status,onlyEquipment:w.onlyEquipment,page:w.page,pageSize:w.pageSize}},J=()=>{_.value={siteId:q.value.isHO===1?null:q.value.SiteId,ownershipId:null,equipmentNoId:null,equipmentGroupId:null,brandId:null,equipmentModelId:null,engineHourMeter:null,engineHourMeterOffset:null,component:"",componentTypeId:null,componentLifeHour:null,status:null,onlyEquipment:t.stateOnlyEquipment,page:1,pageSize:20}},P=e,V=()=>{P("close-expand"),t.setAppliedFilter(_.value),D.value=!1},T=()=>{if(typeof _.value.engineHourMeter=="string"){_.value.engineHourMeter=_.value.engineHourMeter.replace(/\D/g,"");const w=parseInt(_.value.engineHourMeter);_.value.engineHourMeter=isNaN(w)?null:w}},G=()=>{if(typeof _.value.engineHourMeterOffset=="string"){_.value.engineHourMeterOffset=_.value.engineHourMeterOffset.replace(/\D/g,"");const w=parseInt(_.value.engineHourMeterOffset);_.value.engineHourMeterOffset=isNaN(w)?null:w}},E=async()=>{const w=await t.export();Pe.saveAs(new Blob([w],{type:"application/octet-stream"}),"Master Data Equipment.xlsx")};return(w,O)=>{const j=I("inline-svg"),L=I("el-button"),d=I("el-option"),v=I("el-select"),g=I("el-form-item"),C=I("el-input"),N=I("el-form"),B=I("el-popover");return c(),b("section",{id:"table-actions",class:re(["mb-6 d-flex",i(p).stateDraftData.length>0?"justify-content-between":"justify-content-end"])},[i(p).stateDraftData.length>0?(c(),b("section",kt,$t)):U("",!0),o("div",Et,[s(B,{placement:"bottom-end",visible:D.value,width:800,onAfterLeave:A},{reference:a(()=>[s(L,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:O[0]||(O[0]=r=>D.value=!D.value)},{default:a(()=>[o("span",Nt,[s(j,{src:"/media/icons/bumaau/filter_list.svg",style:{width:"1.25rem",height:"1.25rem"}})]),H(" Filter ")]),_:1})]),default:a(()=>[o("div",Dt,[Ft,o("section",xt,[s(N,{model:_.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:a(()=>[o("section",Mt,[o("div",St,[o("div",Lt,[s(g,{label:"Site"},{default:a(()=>[s(v,{modelValue:_.value.siteId,"onUpdate:modelValue":O[1]||(O[1]=r=>_.value.siteId=r),placeholder:"eg. Blackwater",clearable:"",filterable:"",disabled:q.value.isHO===0},{default:a(()=>[(c(!0),b(z,null,Q(i(t).siteOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),o("div",Vt,[s(g,{label:"Ownership"},{default:a(()=>[s(v,{modelValue:_.value.ownershipId,"onUpdate:modelValue":O[2]||(O[2]=r=>_.value.ownershipId=r),placeholder:"eg. Hired",clearable:"",filterable:""},{default:a(()=>[(c(!0),b(z,null,Q(i(t).ownershipOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),Ut,Ht])]),o("section",At,[o("div",Pt,[o("div",Tt,[s(g,{label:"Equipment No"},{default:a(()=>[s(v,{modelValue:_.value.equipmentNoId,"onUpdate:modelValue":O[3]||(O[3]=r=>_.value.equipmentNoId=r),placeholder:"eg. DT0700",clearable:"",filterable:""},{default:a(()=>[(c(!0),b(z,null,Q(i(t).eqpNoOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",Bt,[s(g,{label:"Equipment Group"},{default:a(()=>[s(v,{modelValue:_.value.equipmentGroupId,"onUpdate:modelValue":O[4]||(O[4]=r=>_.value.equipmentGroupId=r),placeholder:"eg. Dozer",clearable:"",filterable:""},{default:a(()=>[(c(!0),b(z,null,Q(i(t).eqpGroupOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",Rt,[s(g,{label:"Equipment Brand"},{default:a(()=>[s(v,{modelValue:_.value.brandId,"onUpdate:modelValue":O[5]||(O[5]=r=>_.value.brandId=r),placeholder:"eg. KOMATSU",clearable:"",filterable:""},{default:a(()=>[(c(!0),b(z,null,Q(i(t).eqpBrandOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",Gt,[s(g,{label:"Equipment Model"},{default:a(()=>[s(v,{modelValue:_.value.equipmentModelId,"onUpdate:modelValue":O[6]||(O[6]=r=>_.value.equipmentModelId=r),placeholder:"eg. 623F",clearable:"",filterable:""},{default:a(()=>[(c(!0),b(z,null,Q(i(t).eqpModelOption,r=>(c(),S(d,{key:r.value,label:r.label!==""?r.label:" ",value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),o("section",zt,[o("div",jt,[o("div",Yt,[s(g,{class:"h-100 d-flex flex-column justify-content-end"},{label:a(()=>[Wt]),default:a(()=>[s(C,{modelValue:_.value.engineHourMeter,"onUpdate:modelValue":O[7]||(O[7]=r=>_.value.engineHourMeter=r),placeholder:"eg. 20",maxlength:"20",minlength:"3",onInput:O[8]||(O[8]=r=>T())},null,8,["modelValue"])]),_:1})]),o("div",Kt,[s(g,{class:"h-100 d-flex flex-column justify-content-end"},{label:a(()=>[Jt]),default:a(()=>[s(C,{modelValue:_.value.engineHourMeterOffset,"onUpdate:modelValue":O[9]||(O[9]=r=>_.value.engineHourMeterOffset=r),placeholder:"eg. 10",maxlength:"20",minlength:"3",onInput:O[10]||(O[10]=r=>G())},null,8,["modelValue"])]),_:1})]),o("div",Xt,[s(g,{label:"Component",class:"h-100 d-flex flex-column justify-content-end"},{default:a(()=>[s(C,{modelValue:_.value.component,"onUpdate:modelValue":O[11]||(O[11]=r=>_.value.component=r),placeholder:"eg. HYDCY-CCYLCRX",maxlength:"20"},null,8,["modelValue"])]),_:1})]),Qt])]),o("section",Zt,[o("div",eo,[o("div",to,[s(g,null,{label:a(()=>[oo]),default:a(()=>[s(v,{modelValue:_.value.status,"onUpdate:modelValue":O[12]||(O[12]=r=>_.value.status=r),placeholder:"eg. Active",clearable:"",filterable:""},{default:a(()=>[(c(),b(z,null,Q(M,r=>s(d,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),no,so,ao])])]),_:1},8,["model"])]),o("section",lo,[o("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md me-auto",onClick:J}," Reset "),o("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md",onClick:O[13]||(O[13]=r=>D.value=!1)}," Close "),o("button",{class:"btn btn-btech-secondary btech-md",onClick:V}," Apply ")])])]),_:1},8,["visible"]),s(L,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:E},{default:a(()=>[o("span",ro,[s(j,{src:"/media/icons/bumaau/download.svg",style:{width:"1.25rem",height:"1.25rem"}})]),H(" Export ")]),_:1})])],2)}}}),uo=ue(io,[["__scopeId","data-v-b0018e9c"]]),co={key:0,style:{height:"100px"}},po={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},mo={class:"m-0",style:{"line-height":"1.25rem"}},ho={style:{width:"30%"}},fo={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},go={class:"m-0",style:{"line-height":"1.25rem"}},vo={key:0},_o={key:1},bo={key:0,class:"d-flex justify-content-center"},wo={class:"badge badge-circle badge-success mx-auto rounded-badge-success"},yo={key:1,class:"d-flex justify-content-center"},qo={class:"badge badge-circle badge-success mx-auto rounded-badge-error"},Io={key:0},Oo={key:1},ko={key:0},Co={key:1},$o={class:"d-flex justify-content-center"},Eo=["onClick"],No=de({__name:"ListTable",emits:["show-form"],setup(n,{expose:l,emit:e}){const t=e,p=pe(),u=ce(),q=ee(()=>p.stateList),M=F(),D=F(""),_=d=>{D.value=d.order},A=(d,v,g)=>et(d[g],v[g],D.value),J=(d,v)=>{const g=d.equipmentNo.toLowerCase(),C=v.equipmentNo.toLowerCase(),N=g.match(/[A-Za-z]+/)[0],B=C.match(/[A-Za-z]+/)[0];if(N!==B)return N.localeCompare(B);const r=parseInt(g.match(/\d+/)[0]),h=parseInt(C.match(/\d+/)[0]);return r-h},P=(d,v)=>{const g=d.ownership.toLowerCase(),C=v.ownership.toLowerCase();return g===null?1:C===null?-1:g===null&&C===null?0:g.localeCompare(C)},V=(d,v)=>{if(d.resetDate===null)return 1;if(v.resetDate===null)return-1;const g=Date.parse(d.resetDate),C=Date.parse(v.resetDate);return g-C},T=(d,v)=>{if(d.modifiedOn===null)return 1;if(v.modifiedOn===null)return-1;const g=Date.parse(d.modifiedOn),C=Date.parse(v.modifiedOn);return g-C},G=(d,v)=>{if(d.ehmOffsetModifiedOn===null)return 1;if(v.ehmOffsetModifiedOn===null)return-1;const g=Date.parse(d.ehmOffsetModifiedOn),C=Date.parse(v.ehmOffsetModifiedOn);return g-C},E=d=>d.equipmentNoId,w=F([]),O=(d,v)=>{(d.component===void 0||d.component.length===0)&&p.getComponentByEqp(d.equipmentNoId);const g=d.equipmentNoId,C=w.value[0];return w.value=g===C?[]:[g],v};l({closeExpandedRow:()=>(w.value=[],w.value)});const L=async d=>{u.stateIsNewForm=!1,t("show-form"),p.getComponentByEqp(d.row.equipmentNoId).then(()=>{const g=d.row.component.map(C=>C);u.stateComponentTable=g});const v={equipmentUnitId:d.row.equipmentNoId,equipmentUnit:d.row.equipmentNo,siteName:d.row.siteName,serialNo:d.row.serialNo,group:d.row.equipmentGroup,brandName:d.row.equipmentBrand,model:d.row.equipmentModel,ownership:d.row.ownership,engineHourMeter:d.row.engineHourMeter,engineHourMeterOffset:d.row.engineHourMeterOffset,resetDate:d.row.resetDate,isActive:d.row.isActive,isWarning:d.row.isWarning};u.stateFormItem=[v]};return(d,v)=>{const g=I("el-table-column"),C=I("inline-svg"),N=I("el-tooltip"),B=we("loading");return i(p).loading?oe((c(),b("div",co,null,512)),[[B,i(p).loading]]):oe((c(),S(i(Ce),{key:1,ref_key:"eqpTableList",ref:M,data:q.value,"default-sort":{prop:"dateService",order:"ascending"},"empty-text":"No Data",style:{width:"100%"},"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSortChange:_,"row-key":E,"expand-row-keys":w.value,onExpandChange:O},{default:a(()=>[s(g,{prop:"siteName",label:"Site",width:"178",sortable:"","sort-orders":["ascending","descending"],"sort-method":(r,h)=>A(r,h,"siteName")},{default:a(r=>[o("div",po,[o("p",mo,R(r.row.siteName),1)])]),_:1},8,["sort-method"]),s(g,{type:"expand"},{default:a(r=>[o("div",ho,[oe((c(),S(i(Ce),{data:r.row.component,border:!0,"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell","max-height":400,style:{width:"100%"}},{default:a(()=>[s(g,{width:240,label:"Component Code",prop:"componentCode"}),s(g,{label:"Component Name",prop:"componentName"})]),_:2},1032,["data"])),[[B,i(p).stateCompListLoading]])])]),_:1}),s(g,{prop:"equipmentNo",label:"Equipment No",width:"178",sortable:"","sort-method":J,"sort-orders":["ascending","descending"]},{default:a(r=>[o("div",fo,[o("p",go,R(r.row.equipmentNo),1)])]),_:1}),s(g,{prop:"equipmentGroup",label:"Group",width:"178",sortable:"","sort-orders":["ascending","descending"],"sort-method":(r,h)=>A(r,h,"equipmentGroup")},null,8,["sort-method"]),s(g,{prop:"equipmentBrand",label:"Brand",width:"178",sortable:"","sort-orders":["ascending","descending"],"sort-method":(r,h)=>A(r,h,"equipmentBrand")},null,8,["sort-method"]),s(g,{prop:"equipmentModel",label:"Model",width:"178",sortable:"","sort-orders":["ascending","descending"],"sort-method":(r,h)=>A(r,h,"equipmentModel")},null,8,["sort-method"]),s(g,{prop:"ownership",label:"Ownership",width:"178",sortable:"","sort-orders":["ascending","descending"],"sort-method":P}),s(g,{prop:"engineHourMeter",label:"Engine Hour Meter/ Service Meter (SMU)",width:"178",align:"center",sortable:"","sort-orders":["ascending","descending"]},{default:a(r=>[r.row.engineHourMeter?(c(),b("div",vo,R(r.row.engineHourMeter),1)):(c(),b("span",_o,"-"))]),_:1}),s(g,{prop:"isActive",label:"Status",width:"90",sortable:"","sort-orders":["ascending","descending"]},{default:a(r=>[r.row.isActive?(c(),b("div",bo,[o("div",wo,[s(C,{src:"/media/svg/tables/rows/check-light.svg"})])])):(c(),b("div",yo,[o("div",qo,[s(C,{src:"/media/svg/tables/rows/valid-false-light.svg"})])]))]),_:1}),s(g,{prop:"modifiedBy",label:"Modified By",width:"320",sortable:"","sort-orders":["ascending","descending"],"sort-method":T},{default:a(r=>[o("span",null,R(i(Se)(r.row.modifiedOn))+", by "+R(r.row.modifiedBy),1)]),_:1}),s(g,{prop:"engineHourMeterOffset",label:"Hour Meter Offset",width:"178",align:"center",sortable:"","sort-orders":["ascending","descending"]},{default:a(r=>[r.row.engineHourMeterOffset?(c(),b("div",Io,R(r.row.engineHourMeterOffset),1)):(c(),b("span",Oo,"-"))]),_:1}),s(g,{prop:"resetDate",label:"Hour Meter Offset Reset Date",width:"320",sortable:"","sort-orders":["ascending","descending"],"sort-method":V},{default:a(r=>[r.row.resetDate?(c(),b("span",ko,R(i(Re)(r.row.resetDate))+", by "+R(r.row.ehmOffsetModifiedBy),1)):(c(),b("span",Co,"-"))]),_:1}),s(g,{prop:"ehmOffsetModifiedOn",label:"Last Offset Entry",width:"320",sortable:"","sort-orders":["ascending","descending"],"sort-method":G},{default:a(r=>[o("span",null,R(i(Se)(r.row.ehmOffsetModifiedOn))+", by "+R(r.row.ehmOffsetModifiedBy),1)]),_:1}),s(g,{label:"Action","header-align":"center",fixed:"right",width:"80"},{default:a(r=>[o("div",$o,[s(N,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:a(()=>[o("span",{class:"svg-icon svg-icon-btech-secondary-500",style:{cursor:"pointer"},onClick:h=>L(r)},[s(C,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,Eo)]),_:2},1024)])]),_:1})]),_:1},8,["data","expand-row-keys"])),[[B,i(p).loading]])}}}),Do=ue(No,[["__scopeId","data-v-d2da538d"]]),W=n=>(ye("data-v-ea0f423c"),n=n(),qe(),n),Fo={class:"card-body p-4"},xo=W(()=>o("h2",{class:"text-btech-info-500 mb-8"},"Equipment",-1)),Mo={class:"container p-0"},So={class:"row m-0 gap-4"},Lo={class:"col p-0"},Vo=W(()=>o("span",{class:"required"},"Site",-1)),Uo={key:0,class:"col p-0"},Ho=W(()=>o("span",{class:"required"},"Ownership",-1)),Ao={key:1,class:"col p-0"},Po={class:"container p-0"},To={class:"row m-0 gap-4"},Bo={class:"col p-0"},Ro=W(()=>o("span",{class:"required"}," Equipment No. ",-1)),Go={key:0,class:"col p-0"},zo=W(()=>o("span",{class:"required"}," Equipment Group ",-1)),jo={key:1,class:"col p-0"},Yo=W(()=>o("span",{class:"required"}," Equipment Brand ",-1)),Wo={key:0,class:"container p-0"},Ko={class:"row m-0 gap-4"},Jo={class:"col p-0"},Xo=W(()=>o("span",{class:"required"}," Equipment Model ",-1)),Qo={class:"col p-0"},Zo=W(()=>o("span",null,"Serial No.",-1)),en=W(()=>o("div",{class:"col p-0"},null,-1)),tn={class:"container p-0"},on={class:"row m-0 gap-4"},nn={class:"m-0"},sn=W(()=>o("br",null,null,-1)),an=W(()=>o("u",null,"Counter Reading",-1)),ln=[an],rn={class:"svg-icon svg-icon-btech-secondary-500 me-1",style:{cursor:"pointer"}},dn={class:"col p-0"},un=W(()=>o("p",{class:"m-0"},[H("Hour Meter Offset "),o("br")],-1)),cn={class:"col p-0"},pn=W(()=>o("span",null,"Hour Meter Offset Reset Date",-1)),mn={key:1,class:"container p-0"},hn={class:"row m-0 gap-4"},fn={class:"col p-0"},gn=W(()=>o("span",null,"Status",-1)),vn=W(()=>o("div",{class:"col p-0"},null,-1)),_n=W(()=>o("div",{class:"col p-0"},null,-1)),bn=W(()=>o("div",{class:"col p-0"},null,-1)),wn={key:0,class:"overlay-layer bg-dark bg-opacity-25",style:{"z-index":"9999"}},yn={class:"dialog-footer"},qn=de({__name:"FormEquipment",setup(n,{expose:l}){const e=ce(),t=ee({get(){return e.stateFormItem[0]},set(h){e.stateFormItem[0]=h}}),p=pe(),u=()=>p.stateOnlyEquipment&&!e.stateIsDraftForm||!p.stateOnlyEquipment&&!e.stateIsDraftForm||p.stateOnlyEquipment&&e.stateIsDraftForm,M=ve().user,D=()=>{if(typeof t.value.engineHourMeter=="string"){t.value.engineHourMeter=t.value.engineHourMeter.replace(/\D/g,"");const h=parseInt(t.value.engineHourMeter);t.value.engineHourMeter=isNaN(h)?null:h}},_=()=>{if(typeof t.value.engineHourMeterOffset=="string"){t.value.engineHourMeterOffset=t.value.engineHourMeterOffset.replace(/\D/g,"");const h=parseInt(t.value.engineHourMeterOffset);t.value.engineHourMeterOffset=isNaN(h)?null:h}},A=Ve().shape({siteName:ae().max(40,h=>`Site Name cannot be longer than ${h.max} characters`).required("Site is required"),ownership:ae().nullable().max(255,h=>`Ownership cannot be longer than ${h.max} characters`).required("Ownership is required"),equipmentUnit:ae().max(20,h=>`Equipment No. cannot be longer than ${h.max} characters`).required("Equipment No. is required"),group:ae().max(100,h=>`Equipment Group cannot be longer than ${h.max} characters`).required("Equipment Group is required"),brandName:ae().max(20,h=>`Equipment Brand Name cannot be longer than ${h.max} characters`).required("Equipment Brand Name is required"),model:ae().max(20,h=>`Equipment Model cannot be longer than ${h.max} characters`).required("Equipment Model is required")}),J=Ve().shape({siteName:ae().max(40,h=>`Site Name cannot be longer than ${h.max} characters`).required("Site is required"),equipmentUnit:ae().max(20,h=>`Equipment No. cannot be longer than ${h.max} characters`).required("Equipment No. is required")});l({inputValidation:A,inputValidationHMO:J});const P=F(!1),V=F(""),T=(h,m)=>{V.value=m,h.includes("Other")&&(P.value=!0)},G=F(""),E=h=>{t.value[h]=G.value,P.value=!1},w=h=>{t.value[h]="",P.value=!1},O=()=>{G.value=""},j=F(!1),L=()=>{e.stateIsFocusEqp=!0,j.value=!0},d=()=>{e.stateIsFocusEqp=null,j.value=!1},v=F(!1),g=()=>{e.stateIsFocusEqp=!0,v.value=!0},C=()=>{v.value=!1};Ge(()=>v.value,h=>{h===!1&&!j.value&&(e.stateIsFocusEqp=!1)});const N=Ae(),B=F(!0),r=()=>{B.value=!1,N.push({name:"counterreading"})};return ze(()=>{B.value=!0}),(h,m)=>{const k=I("el-option"),y=I("el-select"),x=I("el-form-item"),Y=I("el-input"),Z=I("inline-svg"),_e=I("el-tooltip"),be=I("el-date-picker"),me=I("el-switch"),he=I("el-form"),se=I("el-button"),fe=I("el-dialog");return c(),b("div",{class:re(["card border min-h-100",i(e).stateIsFocusComp===!0?"overlay overlay-block overflow-hidden":""])},[o("section",Fo,[o("div",{class:re(i(e).stateIsFocusComp===!0?"overlay-wrapper":"")},[xo,s(i(ot),null,{default:a(()=>[s(he,{ref:"ruleFormRef",model:t.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:a(()=>[o("section",Mo,[o("div",So,[o("div",Lo,[s(x,null,{label:a(()=>[Vo]),default:a(()=>[s(y,{modelValue:t.value.siteName,"onUpdate:modelValue":m[0]||(m[0]=f=>t.value.siteName=f),placeholder:"eg. Blackwater",clearable:"",filterable:"",disabled:i(M).isHO===0&&!i(e).stateIsDraftForm,onFocus:L,onBlur:d},{default:a(()=>[(c(!0),b(z,null,Q(i(e).siteOption,f=>(c(),S(k,{key:f.value,label:f.label,value:f.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),u()?(c(),b("div",Uo,[s(x,null,{label:a(()=>[Ho]),default:a(()=>[s(y,{modelValue:t.value.ownership,"onUpdate:modelValue":m[1]||(m[1]=f=>t.value.ownership=f),placeholder:"eg. Hired",clearable:"",filterable:"",onFocus:L,onBlur:d,onChange:m[2]||(m[2]=f=>T(f,"ownership"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).ownershipOption,f=>(c(),S(k,{key:f.value,label:f.label,value:f.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):U("",!0),u()?(c(),b("div",Ao)):U("",!0)])]),o("section",Po,[o("div",To,[o("div",Bo,[s(x,null,{label:a(()=>[Ro]),default:a(()=>[s(Y,{modelValue:t.value.equipmentUnit,"onUpdate:modelValue":m[3]||(m[3]=f=>t.value.equipmentUnit=f),placeholder:"eg. DT0700",maxlength:"20",disabled:!i(e).stateIsNewForm&&!i(e).stateIsDraftForm,clearable:"",onFocus:L,onBlur:d},null,8,["modelValue","disabled"])]),_:1})]),u()?(c(),b("div",Go,[s(x,null,{label:a(()=>[zo]),default:a(()=>[s(y,{modelValue:t.value.group,"onUpdate:modelValue":m[4]||(m[4]=f=>t.value.group=f),placeholder:"eg. Dozer",clearable:"",filterable:"",onFocus:L,onBlur:d,onChange:m[5]||(m[5]=f=>T(f,"group"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).eqpGroupOption,f=>(c(),S(k,{key:f.value,label:f.label,value:f.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):U("",!0),u()?(c(),b("div",jo,[s(x,null,{label:a(()=>[Yo]),default:a(()=>[s(y,{modelValue:t.value.brandName,"onUpdate:modelValue":m[6]||(m[6]=f=>t.value.brandName=f),placeholder:"eg. KOMATSU",clearable:"",filterable:"",onFocus:L,onBlur:d,onChange:m[7]||(m[7]=f=>T(f,"brandName"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).eqpBrandOption,f=>(c(),S(k,{key:f.value,label:f.label,value:f.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):U("",!0)])]),u()?(c(),b("section",Wo,[o("div",Ko,[o("div",Jo,[s(x,null,{label:a(()=>[Xo]),default:a(()=>[s(y,{modelValue:t.value.model,"onUpdate:modelValue":m[8]||(m[8]=f=>t.value.model=f),placeholder:"eg. 623F",clearable:"",filterable:"",onFocus:L,onBlur:d,onChange:m[9]||(m[9]=f=>T(f,"model"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).eqpModelOption,f=>(c(),S(k,{key:f.value,label:f.label,value:f.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",Qo,[s(x,null,{label:a(()=>[Zo]),default:a(()=>[s(Y,{modelValue:t.value.serialNo,"onUpdate:modelValue":m[10]||(m[10]=f=>t.value.serialNo=f),placeholder:"eg. 20",maxlength:"20",onFocus:L,onBlur:d},null,8,["modelValue"])]),_:1})]),en])])):U("",!0),o("section",tn,[o("div",on,[u()?(c(),b("div",{key:0,class:re(["col p-0 align-self-stretch",!i(e).isNewForm&&!i(e).stateIsDraftForm?"":"order-3"])},[!i(e).isNewForm&&!i(e).stateIsDraftForm?(c(),S(x,{key:0,class:"h-100 d-flex flex-column justify-content-end"},{label:a(()=>[o("div",null,[o("p",nn,[H(" Engine Hour Meter/ "),sn,H("Service Meter (SMU) "),s(_e,{class:"box-item",effect:"dark",placement:"top",visible:B.value},{content:a(()=>[H(" Data is from IronPortal Transactional → "),o("span",{class:"ironlake-redirect",style:{cursor:"pointer"},onClick:m[11]||(m[11]=f=>r())},ln)]),default:a(()=>[o("span",rn,[s(Z,{src:"/media/icons/bumaau/help.svg",style:{width:"1.25rem",height:"1.25rem"}})])]),_:1},8,["visible"])])])]),default:a(()=>[s(Y,{modelValue:t.value.engineHourMeter,"onUpdate:modelValue":m[12]||(m[12]=f=>t.value.engineHourMeter=f),placeholder:"eg. 20",maxlength:"20",disabled:!0,onFocus:L,onBlur:d,onInput:m[13]||(m[13]=f=>D())},null,8,["modelValue"])]),_:1})):U("",!0)],2)):U("",!0),o("div",dn,[s(x,{class:"h-100 d-flex flex-column justify-content-end"},{label:a(()=>[un]),default:a(()=>[s(Y,{modelValue:t.value.engineHourMeterOffset,"onUpdate:modelValue":m[14]||(m[14]=f=>t.value.engineHourMeterOffset=f),placeholder:"eg. 10",maxlength:"20",onFocus:L,onBlur:d,onInput:m[15]||(m[15]=f=>_())},null,8,["modelValue"])]),_:1})]),o("div",cn,[s(x,{class:"h-100 d-flex flex-column justify-content-end"},{label:a(()=>[pn]),default:a(()=>[s(be,{modelValue:t.value.resetDate,"onUpdate:modelValue":m[16]||(m[16]=f=>t.value.resetDate=f),type:"date",placeholder:"eg. 10.10.2023",format:"DD.MM.YYYY",onFocus:g,onBlur:C},null,8,["modelValue"])]),_:1})])])]),!i(e).isNewForm&&!i(e).isDraftForm?(c(),b("section",mn,[o("div",hn,[o("div",fn,[s(x,null,{label:a(()=>[gn]),default:a(()=>[s(me,{modelValue:t.value.isActive,"onUpdate:modelValue":m[17]||(m[17]=f=>t.value.isActive=f)},null,8,["modelValue"])]),_:1})]),vn,_n,bn])])):U("",!0)]),_:1},8,["model"])]),_:1})],2),i(e).stateIsFocusComp?(c(),b("div",wn)):U("",!0)]),s(fe,{modelValue:P.value,"onUpdate:modelValue":m[21]||(m[21]=f=>P.value=f),title:"Add Other Option",width:"30%","show-close":!1,"close-on-click-modal":!1,onClosed:O},{footer:a(()=>[o("span",yn,[s(se,{onClick:m[19]||(m[19]=f=>w(V.value))},{default:a(()=>[H(" Cancel ")]),_:1}),s(se,{type:"primary",onClick:m[20]||(m[20]=f=>E(V.value))},{default:a(()=>[H(" Add ")]),_:1})])]),default:a(()=>[s(x,{class:"m-0"},{default:a(()=>[s(Y,{modelValue:G.value,"onUpdate:modelValue":m[18]||(m[18]=f=>G.value=f),placeholder:"Write other option",maxlength:"20",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])],2)}}}),In=ue(qn,[["__scopeId","data-v-ea0f423c"]]),Ie=n=>(ye("data-v-623cb0c8"),n=n(),qe(),n),On={class:"card-body p-4"},kn=Ie(()=>o("h2",{class:"text-btech-info-500 mb-8"},"Component",-1)),Cn={key:0,class:"d-flex gap-2 justify-content-end mb-4"},$n=Ie(()=>o("i",{class:"fas fa-plus fs-6 pe-2 text-btech-secondary-500"},null,-1)),En=Ie(()=>o("i",{class:"fas fa-plus fs-6 pe-2 text-btech-secondary-500"},null,-1)),Nn={key:0},Dn={key:1},Fn={key:0},xn={key:1},Mn={class:"d-flex justify-content-center gap-6"},Sn=["onClick"],Ln={class:"container p-0"},Vn={class:"row m-0 gap-4"},Un={class:"col p-0"},Hn=Ie(()=>o("span",null,"Code",-1)),An={class:"col p-0"},Pn=Ie(()=>o("span",null,"Name",-1)),Tn={key:0,class:"overlay-layer bg-dark bg-opacity-25",style:{"z-index":"9999"}},Bn={class:"position-relative"},Rn={class:"input-wrapper"},Gn={key:0,style:{height:"100px"}},zn={class:"dialog-footer"},jn={class:"dialog-footer"},Yn=de({__name:"FormComponent",setup(n){const l=pe(),e=ce(),t=F(!1),p=F(""),u=ee(()=>e.componentsTable),q=ee({get(){return e.stateFormItem[0]},set(k){e.stateFormItem[0]=k}}),M=F(!1),D=F(""),_=F(!1),A=()=>{M.value=!0},J=()=>{_.value=!0;for(const k of e.stateComponentTable){const y=P.value.findIndex(x=>x.componentCode===k.componentCode&&x.componentName===k.componentName);y!==-1&&T.value&&T.value.toggleRowSelection(P.value[y],!0)}_.value=!1},P=ee(()=>e.componentFilterOption.filter(y=>!D.value||y.componentCode.toLowerCase().includes(D.value.toLowerCase())||y.componentName.toLowerCase().includes(D.value.toLowerCase()))),V=F([]),T=F(),G=()=>{var k;D.value="",(k=T.value)==null||k.clearSelection(),M.value=!1},E=()=>{D.value="",V.value.forEach(k=>e.stateComponentTable.some(x=>x.componentCode===k.componentCode&&x.componentName===k.componentName)?k:(e.stateComponentTable.push(k),e.stateComponentTable)),M.value=!1},w=k=>{V.value=k},O=k=>{var x;const y=e.stateComponentTable.findIndex(Y=>Y.componentCode===k.row.componentCode&&Y.componentName===k.row.componentName);y!==-1&&(e.stateComponentTable.splice(y,1),(x=T.value)==null||x.toggleRowSelection(e.componentFilterOption[y],!1)),V.value=e.stateComponentTable},j=()=>{const k={componentCode:"",componentName:"",componentIsOther:!0};e.stateComponentTable.unshift(k)},L=F(!1),d=F(""),v=F(""),g=(k,y)=>{v.value=y,k.includes("Other")&&(d.value=k,L.value=!0)},C=F(""),N=k=>{q.value[k]=C.value,L.value=!1},B=k=>{q.value[k]="",L.value=!1},r=()=>{C.value=""},h=()=>{e.stateIsFocusComp=!0},m=()=>{e.stateIsFocusComp=null};return(k,y)=>{const x=I("el-button"),Y=I("el-input"),Z=I("el-table-column"),_e=I("inline-svg"),be=I("el-tooltip"),me=I("el-option"),he=I("el-select"),se=I("el-form-item"),fe=I("el-form"),f=I("el-dialog"),De=we("loading");return c(),b(z,null,[o("div",{class:re(["card border min-h-100",i(e).stateIsFocusEqp===!0?"overlay overlay-block overflow-hidden":""])},[o("section",On,[o("div",{class:re(i(e).stateIsFocusEqp===!0?"overlay-wrapper":"")},[kn,s(je,{name:"fade"},{default:a(()=>[s(Te,{"show-alert":t.value,"onUpdate:showAlert":y[0]||(y[0]=$=>t.value=$),variant:"warning",desc:p.value},null,8,["show-alert","desc"])]),_:1}),i(e).stateIsDraftForm?U("",!0):(c(),b("div",Cn,[s(x,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:j},{default:a(()=>[$n,H(" Add Other Component ")]),_:1}),s(x,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:A},{default:a(()=>[En,H(" Add Component ")]),_:1})])),i(e).stateIsDraftForm?(c(),S(fe,{key:2,ref:"ruleFormRef",model:q.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:a(()=>[o("section",Ln,[o("div",Vn,[o("div",Un,[s(se,null,{label:a(()=>[Hn]),default:a(()=>[s(he,{modelValue:q.value.componentCode,"onUpdate:modelValue":y[1]||(y[1]=$=>q.value.componentCode=$),placeholder:"eg. HYDCY-CCYLCRX",clearable:"",filterable:"",onFocus:h,onBlur:m,onChange:y[2]||(y[2]=$=>g($,"componentCode"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).componentOption,$=>(c(),S(me,{key:$.componentCode,label:$.componentCode,value:$.componentCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",An,[s(se,null,{label:a(()=>[Pn]),default:a(()=>[s(he,{modelValue:q.value.componentName,"onUpdate:modelValue":y[3]||(y[3]=$=>q.value.componentName=$),placeholder:"eg. Hired",clearable:"",filterable:"",onFocus:h,onBlur:m,onChange:y[4]||(y[4]=$=>g($,"componentName"))},{default:a(()=>[(c(!0),b(z,null,Q(i(e).componentOption,$=>(c(),S(me,{key:$.componentName,label:$.componentName,value:$.componentName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])])]),_:1},8,["model"])):oe((c(),S(i(Ce),{key:1,data:u.value,"max-height":i(e).isNewForm?300:380,style:{width:"100%"},"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell"},{default:a(()=>[s(Z,{width:"160",label:"Code"},{default:a($=>[$.row.componentIsOther?(c(),b("section",Dn,[s(Y,{modelValue:$.row.componentCode,"onUpdate:modelValue":Oe=>$.row.componentCode=Oe,placeholder:"eg. HYDCY-CCYLCRX",maxlength:"20",size:"small",onFocus:h,onBlur:m},null,8,["modelValue","onUpdate:modelValue"])])):(c(),b("section",Nn,[o("span",null,R($.row.componentCode),1)]))]),_:1}),s(Z,{prop:"componentName",label:"Name"},{default:a($=>[$.row.componentIsOther?(c(),b("section",xn,[s(Y,{modelValue:$.row.componentName,"onUpdate:modelValue":Oe=>$.row.componentName=Oe,placeholder:"eg. Body Steel",maxlength:"20",size:"small",onFocus:h,onBlur:m},null,8,["modelValue","onUpdate:modelValue"])])):(c(),b("section",Fn,[o("span",null,R($.row.componentName),1)]))]),_:1}),s(Z,{"header-align":"center",fixed:"right",width:"40"},{default:a($=>[o("div",Mn,[s(be,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:a(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:Oe=>O($)},[s(_e,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,Sn)]),_:2},1024)])]),_:1})]),_:1},8,["data","max-height"])),[[De,i(l).stateCompListLoading]])],2),i(e).stateIsFocusEqp?(c(),b("div",Tn)):U("",!0)])],2),s(f,{modelValue:M.value,"onUpdate:modelValue":y[7]||(y[7]=$=>M.value=$),title:"Add Component","modal-class":"ironlake-dialog",width:"40%","align-center":!0,"close-on-click-modal":!1,"show-close":!1,onOpened:y[8]||(y[8]=$=>J())},{footer:a(()=>[o("div",zn,[s(x,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",onClick:G},{default:a(()=>[H(" Cancel ")]),_:1}),s(x,{class:"btn btn-btech-secondary",disabled:V.value.length<1,onClick:y[6]||(y[6]=$=>E())},{default:a(()=>[H(" Add ")]),_:1},8,["disabled"])])]),default:a(()=>[o("div",Bn,[o("div",Rn,[oe(o("input",{"onUpdate:modelValue":y[5]||(y[5]=$=>D.value=$),type:"text",class:"form-control mb-4",placeholder:"Search components"},null,512),[[Xe,D.value]])])]),_.value?oe((c(),b("div",Gn,null,512)),[[De,_.value]]):(c(),S(i(Ce),{key:1,ref_key:"componentTableRef",ref:T,data:P.value,style:{width:"100%"},"max-height":250,"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSelectionChange:w},{default:a(()=>[s(Z,{type:"selection",align:"center","header-align":"center"}),s(Z,{width:"170",label:"Component Code"},{default:a($=>[H(R($.row.componentCode),1)]),_:1}),s(Z,{prop:"componentName",label:"Component Name"})]),_:1},8,["data"]))]),_:1},8,["modelValue"]),s(f,{modelValue:L.value,"onUpdate:modelValue":y[12]||(y[12]=$=>L.value=$),title:"Add Other Option",width:"30%","modal-class":"ironlake-dialog","show-close":!1,"close-on-click-modal":!1,onClosed:r},{footer:a(()=>[o("span",jn,[s(x,{onClick:y[10]||(y[10]=$=>B(v.value))},{default:a(()=>[H(" Cancel ")]),_:1}),s(x,{type:"primary",onClick:y[11]||(y[11]=$=>N(v.value))},{default:a(()=>[H(" Add ")]),_:1})])]),default:a(()=>[s(se,{class:"m-0"},{default:a(()=>[s(Y,{modelValue:C.value,"onUpdate:modelValue":y[9]||(y[9]=$=>C.value=$),placeholder:"Write other option",maxlength:"20",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])],64)}}}),Wn=ue(Yn,[["__scopeId","data-v-623cb0c8"]]),Kn={class:"container-fluid p-0 m-0"},Jn={class:"row m-0"},Xn={key:0,class:"col-5 p-0"},Qn={class:"dialog-footer"},Zn=de({__name:"FormDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(n,{emit:l}){const e=pe(),t=ce(),p=ee({get(){return t.stateFormItem[0]},set(d){t.stateFormItem[0]=d}}),q=Qe(n,"visibility"),M=l,D=async(d=!1)=>{M("handle-close",d),t.stateFormItem[0].equipmentUnitId&&e.resetListComp(t.stateFormItem[0].equipmentUnitId)},_=()=>{V.value=!1,t.resetFormItem(),L(),O.value.showWarning=!1},A=ee(()=>t.errors),J=ee(()=>t.isError),P=()=>{D(!1)},V=F(!1),T=F(""),G=d=>{let v=0;for(let g=0;g<d.length;g++){const C=d[g];for(const N in C)N!=="componentIsOther"&&C.componentIsOther&&C[N]===""&&v++}return v>0},E=()=>{const d=G(t.stateComponentTable);return V.value=d,V.value&&(T.value="Component needs to have Component Code and Name"),d},w=()=>{const d={code:p.value.componentCode,name:p.value.componentName};let v=!1,g=0;for(const C in d)d[C]===""&&g++;return 0<g&&g<2&&(v=!0),V.value=v,V.value&&(T.value="Component needs to have Component Code and Name"),v},O=F(),j=async()=>{if(p.value.engineHourMeterOffset=p.value.engineHourMeterOffset===""||p.value.engineHourMeterOffset===null?"0":p.value.engineHourMeterOffset,t.isDraftForm?(t.stateIsError=!1,w()):E(),!e.stateOnlyEquipment&&t.stateIsDraftForm?await O.value.inputValidationHMO.validate(t.stateFormItem[0],{abortEarly:!1}).then(()=>{t.stateIsError=!1}).catch(v=>{t.setErrors(v.errors)}):await O.value.inputValidation.validate(t.stateFormItem[0],{abortEarly:!1}).then(()=>{t.stateIsError=!1}).catch(v=>{t.setErrors(v.errors)}),t.isError||E()||t.stateIsDraftForm&&e.stateOnlyEquipment&&w())return;const d={value:p.value.resetDate};if(typeof p.value.resetDate=="string")p.value.resetDate=Le(p.value.resetDate);else if(p.value.resetDate&&typeof p.value.resetDate=="object"){const v=new Date(p.value.resetDate).toString();p.value.resetDate=Le(v)}t.insertData(e.stateOnlyEquipment).then(v=>{if(!(v!=null&&v.data.result.isError))return t.resetFormItem(),D(!0);p.value.resetDate=d.value})},L=()=>{t.setErrors([])};return(d,v)=>{const g=I("el-button"),C=I("el-dialog"),N=we("loading");return oe((c(),S(C,{modelValue:q.value,"onUpdate:modelValue":v[0]||(v[0]=B=>q.value=B),title:`${i(t).isNewForm?"New":"Edit"} Equipment`,"modal-class":"ironlake-dialog",width:i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||!i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||i(e).stateOnlyEquipment&&i(t).stateIsDraftForm?1240:480,"align-center":!0,"close-on-click-modal":!1,"show-close":!1,onClose:v[1]||(v[1]=B=>D()),onClosed:v[2]||(v[2]=B=>_())},{default:a(()=>[s(je,{name:"fade"},{default:a(()=>[J.value?(c(),S(tt,{key:0,errorMessages:A.value,onResetForm:L},null,8,["errorMessages"])):U("",!0)]),_:1}),o("section",Kn,[o("div",Jn,[o("div",{class:re(["p-0 pe-4",i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||!i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||i(e).stateOnlyEquipment&&i(t).stateIsDraftForm?"col-7":"col"])},[s(In,{ref_key:"formEqpRef",ref:O},null,512)],2),i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||!i(e).stateOnlyEquipment&&!i(t).stateIsDraftForm||i(e).stateOnlyEquipment&&i(t).stateIsDraftForm?(c(),b("div",Xn,[s(Wn)])):U("",!0)])])]),footer:a(()=>[o("span",Qn,[s(g,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",onClick:P,disabled:i(t).loading},{default:a(()=>[H(" Cancel ")]),_:1},8,["disabled"]),s(g,{class:"btn btn-btech-secondary",onClick:j,disabled:i(t).loading},{default:a(()=>[H(" Submit ")]),_:1},8,["disabled"])])]),_:1},8,["modelValue","title","width"])),[[N,i(t).loading]])}}}),es=ue(Zn,[["__scopeId","data-v-ba3b86fe"]]),ne=n=>(ye("data-v-60270871"),n=n(),qe(),n),ts={"element-loading-text":"Submitting Data","element-loading-background":"rgba(0, 0, 0, 0.5)"},os=["element-loading-text"],ns={class:"px-3 py-8 d-flex"},ss=ne(()=>o("div",{class:"flex-grow-1"},[o("h5",{class:"m-0 header-title"},"Equipment")],-1)),as={class:"align-self-start d-flex gap-2"},ls={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block p-0"},rs=ne(()=>o("i",{class:"fas fa-file-upload text-btech-secondary-500 fs-4 pe-2"},null,-1)),is=ne(()=>o("i",{class:"fas fa-file-upload text-btech-secondary-500 fs-4 pe-2"},null,-1)),ds=ne(()=>o("span",{style:{color:"#01a3ff"}},"Upload Equipment / HM Offset",-1)),us=ne(()=>o("i",{class:"fas fa-file-upload text-btech-secondary-500 fs-4 pe-2"},null,-1)),cs=ne(()=>o("span",{style:{color:"#01a3ff"}},"Upload Counter Reading",-1)),ps=ne(()=>o("i",{class:"fas fa-plus fs-4 pe-2"},null,-1)),ms={key:0,class:"ironlake-upload-progress mb-6 d-flex"},hs=ne(()=>o("p",{class:"mb-0 me-2"},"Uploading",-1)),fs={key:2,class:"card mb-6"},gs={class:"m-0"},vs={class:"text-btech-danger-500"},_s=ne(()=>o("section",{class:"mb-6"},null,-1)),bs={class:"card mb-10"},ws={class:"card-body p-3"},ys={class:"m-0 ironlake-pagination"},qs={class:"container p-0 pb-8"},Is={class:"row m-0 gap-4"},Os={class:"col p-0"},ks={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block p-0"},Cs={class:"col p-0"},$s={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block p-0"},Es=ne(()=>o("section",{class:"row m-0 mt-6"},[o("div",{class:"col p-0"},[o("span",{style:{"word-break":"break-word"}},[o("strong",null,"Note:"),H(" When you upload the Hour Meter Offset template, please make sure file name contains the word 'Offset'")])])],-1)),Ns=de({__name:"Index",setup(n){const l=Ae(),e=We(),t=pe(),p=ce(),u=ie(),q=ve(),M=h=>{const m=h.isHO===1?"":h.SiteId,k=h.isHO===1?"":h.Location;D.value&&(D.value.dataFilter.siteId=m),p.stateFormItem[0].siteName=k,t.stateFilterForm.siteId=m},D=F();Ge(()=>q.user,async h=>{M(h),V()});const _=F(""),A=ee(()=>t.pagination),J=h=>{t.stateFilterForm.pageSize=h,t.setPage(1)},P=h=>{_.value="",t.setPage(h)},V=async()=>{await t.setPage(1),p.getAllLookup()},T=F(),G=()=>{var h;(h=T.value)==null||h.closeExpandedRow()},E=F(!1),w=()=>{E.value=!0},O=async h=>{E.value=!1,G(),h&&await V()},j=F(!1),L=()=>{j.value=!0},d=async h=>{const m=await u.downloadBulkTemplate(h),k=h?"Hour Meter Offset.xlsx":"Equipment.xlsx";Pe.saveAs(new Blob([m],{type:"application/octet-stream"}),k)},v=F(null),g=()=>{var h;(h=v.value)==null||h.click()},C=async h=>{u.stateAlert.show=!1;const m=h.target.files[0],k=!m.name.toLowerCase().includes("offset"),y=m.name.toLowerCase().includes("offset"),x=k&&!t.stateOnlyEquipment,Y=y&&t.stateOnlyEquipment;(x||Y)&&u.stateDraftData.length>0?$e("The following file has a different format from Need Review. Continue to upload this will cause you to remove all current data in Need Review.","Continue").then(async Z=>{Z.isConfirmed&&(t.setOnlyEqpLocal(k),await u.upload(m,t.stateOnlyEquipment),t.resetFilter(),V())}):(t.setOnlyEqpLocal(k),await u.upload(m,t.stateOnlyEquipment),t.resetFilter(),V()),v.value&&(v.value.value="")},N=ee(()=>u.stateUploadProgress),B=F(["draftPanel"]),r=h=>{h==="toCounterReading"?l.push({name:"counterreading"}):g()};return Ze(async()=>{e[Ke.ACTIVE_PAGE]("IronLake"),t.stateLoading=!0,q.user.Location!==void 0&&(t.statePaginationLoading=!0,t.resetFilter(),M(q.user),V())}),ze(()=>{t.$reset(),p.$reset(),u.$reset()}),(h,m)=>{const k=I("inline-svg"),y=I("el-button"),x=I("el-tooltip"),Y=I("el-dropdown-item"),Z=I("el-dropdown-menu"),_e=I("el-dropdown"),be=I("el-progress"),me=I("el-collapse-item"),he=I("el-collapse"),se=I("el-dialog"),fe=we("loading");return c(),b(z,null,[o("template",null,[oe(o("div",ts,null,512),[[fe,i(p).loading,void 0,{fullscreen:!0,lock:!0}]]),oe(o("div",{"element-loading-text":i(u).loadingMessage,"element-loading-background":"rgba(0, 0, 0, 0.5)"},null,8,os),[[fe,i(u).loading,void 0,{fullscreen:!0,lock:!0}]])]),o("section",ns,[ss,o("div",as,[s(x,{class:"box-item",effect:"dark",content:"Download Template",placement:"top"},{default:a(()=>[s(y,{class:"btn btn-icon btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",onClick:L},{default:a(()=>[o("span",ls,[s(k,{src:"/media/icons/bumaau/excel.svg",style:{width:"1.25rem",height:"1.25rem"}})])]),_:1})]),_:1}),s(_e,{onCommand:r},{dropdown:a(()=>[s(Z,null,{default:a(()=>[s(Y,{class:"ironlake-dropdown-item",command:"uploadTemplate"},{default:a(()=>[is,ds]),_:1}),s(Y,{class:"ironlake-dropdown-item",command:"toCounterReading"},{default:a(()=>[us,cs]),_:1})]),_:1})]),default:a(()=>[s(y,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",style:{height:"100%"}},{default:a(()=>[rs,H(" Upload ")]),_:1})]),_:1}),o("input",{ref_key:"uploadBulk",ref:v,type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",hidden:"",onChange:C},null,544),s(y,{class:"btn btn-btech-secondary btech-lg m-0",onClick:w},{default:a(()=>[ps,H(" Add New ")]),_:1})])]),N.value?(c(),b("section",ms,[hs,s(be,{percentage:N.value,width:500},null,8,["percentage"])])):U("",!0),i(u).stateDraftData.length>0?(c(),S(Te,{key:1,"show-alert":i(u).stateAlert.show,"onUpdate:showAlert":m[0]||(m[0]=f=>i(u).stateAlert.show=f),variant:i(u).alertVariant,desc:i(u).alertDesc},null,8,["show-alert","variant","desc"])):U("",!0),i(u).stateDraftData.length>0?(c(),b("section",fs,[s(he,{modelValue:B.value,"onUpdate:modelValue":m[1]||(m[1]=f=>B.value=f),class:"card-body p-3 ironlake-draft-collapse"},{default:a(()=>[s(me,{name:"draftPanel"},{title:a(()=>[o("p",gs,[H(" Need Review "),o("span",vs," ("+R(i(u).stateDraftData.length)+") ",1)])]),default:a(()=>[_s,s(Ot,{class:"mb-6","list-data":i(u).stateDraftData,onShowForm:w,onLoadPage:V,onCloseExpand:G},null,8,["list-data"])]),_:1})]),_:1},8,["modelValue"])])):U("",!0),o("section",bs,[o("div",ws,[s(uo,{ref_key:"tableFilterRef",ref:D,"search-data":_.value,"onUpdate:searchData":m[2]||(m[2]=f=>_.value=f),onCloseExpand:G},null,8,["search-data"]),s(Do,{ref_key:"listTableRef",ref:T,class:"mb-6",onShowForm:w},null,512),o("div",ys,[i(t).paginationLoading?U("",!0):(c(),S(Je,{key:0,currentPage:A.value.currentPage,totalPage:A.value.totalPage,totalPageSize:A.value.totalPageSize,startPaginationIndex:A.value.startPaginationIndex,endPaginationIndex:A.value.endPaginationIndex,isPageSizeChange:!0,onRaiseSizeChange:m[3]||(m[3]=f=>J(f)),onRaisePageChange:m[4]||(m[4]=f=>P(f))},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))])])]),s(es,{visibility:E.value,onHandleClose:O},null,8,["visibility"]),s(se,{modelValue:j.value,"onUpdate:modelValue":m[7]||(m[7]=f=>j.value=f),title:"Download Template","modal-class":"ironlake-dialog",width:500},{default:a(()=>[o("div",qs,[o("section",Is,[o("div",Os,[s(x,{class:"box-item",effect:"dark",content:"Download Equipment Template",placement:"top"},{default:a(()=>[s(y,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0 w-100",onClick:m[5]||(m[5]=f=>d(!1))},{default:a(()=>[o("span",ks,[s(k,{src:"/media/icons/bumaau/excel.svg",style:{width:"1.25rem",height:"1.25rem"}}),H(" Equipment.xlsx ")])]),_:1})]),_:1})]),o("div",Cs,[s(x,{class:"box-item",effect:"dark",content:"Download Equipment Hour Meter Offset Template",placement:"top"},{default:a(()=>[s(y,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0 w-100",onClick:m[6]||(m[6]=f=>d(!0))},{default:a(()=>[o("span",$s,[s(k,{src:"/media/icons/bumaau/excel.svg",style:{width:"1.25rem",height:"1.25rem"}}),H(" Hour Meter Offset.xlsx ")])]),_:1})]),_:1})])]),Es])]),_:1},8,["modelValue"])],64)}}}),ka=ue(Ns,[["__scopeId","data-v-60270871"]]);export{ka as default};
