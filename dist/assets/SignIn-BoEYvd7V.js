import{k as b,r as d,o as S,p as h,aa as w,aB as s,y as x,u as k,s as l,P as C,B as A,F as O,R as N,Y as U}from"./@vue-BypzYtbH.js";import{u as B}from"./vue-router-iNp9kJ0K.js";import{a as E,f as L,l as _,H as m,y as M}from"./index-BuVmIl8K.js";import{X as T}from"./dexie-CWyjz2Lo.js";import{b as V}from"./@vueuse-DFoNmIyu.js";import{i as v}from"./internet-connection-CnLQPjRt.js";import{u as D}from"./useMsal-BbsBYoof.js";import{b as F}from"./get-user-info-DjfNX8-X.js";import{_ as P}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{_ as R}from"./nw-img-vue-CR837WER.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./vuex-BbOKrtVp.js";import"./element-plus-BeWdvTRa.js";import"./dayjs-D0x2Df_K.js";import"./lodash-DrHMlsdo.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./useBodyStore-L-idhAYV.js";import"./useMasterStore-CzSO06fn.js";const j={class:"row"},q={class:"shadow-lg p-4 pb-10 mb-5 bg-white rounded border border-light rounded text-center"},J={class:"row justify-content-center"},X={class:"w-100 justify-content-center",style:{"margin-right":"5px"}},z={style:{display:"none"}},H=b({__name:"SignIn",setup(Y){const{instance:a}=D(),c=E(),r=B(),u=d(0),p=d(!1),{isOnline:g}=V(),y=async()=>{if(v()){if(!await F()){p.value=!0;return}r.push({name:"ironforms"});return}await f()};S(async()=>{await T.exists("DexieSchema").then(async function(){await L.open()});let o=!0;localStorage.setItem("lang","en");const t=a.getActiveAccount();if(t)try{a.acquireTokenSilent(_)}catch(e){console.log(e),o=!1}else o=!1;if(o&&(localStorage.setItem("account-info-cache",JSON.stringify(t)),r.push({name:"mydashboard"})),v()){const e=m.getInstance(),n=m.getMSALInstance();let i;if(i=await e.getActiveUser(n),i&&(localStorage.getItem("account-info-cache")||localStorage.getItem("account-info-cache")!=="undefined")){r.push({name:"ironforms"});return}}});const f=async()=>{const o=m.getInstance(),t=m.getMSALInstance();let e;if(e=await o.getActiveUser(t),e&&(localStorage.getItem("account-info-cache")||localStorage.getItem("account-info-cache")!=="undefined")){r.push({name:"mydashboard"});return}let n=!1;try{if(console.log("step 1 msal login"),await a.loginPopup(_),await c.signIn(a),!c.loggedIn)return;localStorage.setItem("login-tracked","false"),console.log("step 2 redirect to ironforms"),r.push({name:"mydashboard"})}catch(i){if(console.log("step error",i),!i){n=!1;return}if(i.errorCode=="user_cancelled")return;if(i.errorCode=="interaction_in_progress"){if(u.value<4){I(),await f(),u.value++;return}return}g.value||(console.log("isOnline:",g.value),M("Unable to sign in. Offline connection detected. Please check your internet connection and try signing in again.","Close"))}finally{console.log("step error final",n),c.setLoading(!1),n||r.push({name:"mydashboard"})}},I=()=>{const o=document.cookie.split(";");for(var t=1;t<=o.length;t++){var e=o[t-1],n=e.split("=");document.cookie=n[0]+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}window.localStorage.clear(),window.sessionStorage.clear()};return(o,t)=>{const e=N("NwImg"),n=U("loading");return h(),w(O,null,[s("div",j,[x((h(),w("div",q,[l(e,{class:"w-300px my-7",src:"/media/logos/bumaau/buma-logo.png",style:{height:"auto"},alt:"logo"}),s("div",J,[s("div",X,[s("button",{onClick:C(y,["prevent"]),href:"#",class:"w-100 btn btn-lg text-white btn-big",style:{"font-size":"12px","font-weight":"600"}},[l(e,{src:"/media/logos/bumaau/microsoft.png",alt:"microsoft",width:"24"}),A(" Sign in Microsoft ")])])]),s("div",z,[l(e,{src:"/media/icons/bumaau/danger.png"})])])),[[n,k(c).loading]])]),l(P,{visibility:p.value,caption:"Failed to sign in, you need to sign in when you have internet connection first",onOnClose:t[0]||(t[0]=()=>{p.value=!1})},null,8,["visibility"])],64)}}}),Te=R(H,[["__scopeId","data-v-57d297fd"]]);export{Te as default};
