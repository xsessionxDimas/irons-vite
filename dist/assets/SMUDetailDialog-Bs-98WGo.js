import{k as Ne,c as D,r as f,d as Oe,p as n,aa as i,s as y,x as w,F as N,R as $,aB as t,B as Y,A as v,C as u,u as x,b4 as fe,$ as ve,y as me,a5 as pe,P as he,bd as Ce,bb as Le}from"./@vue-BypzYtbH.js";import{f as Ee,c as Be}from"./index-BuVmIl8K.js";import{s as ge}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{e as g}from"./lodash-DrHMlsdo.js";import{a as Pe}from"./element-plus-BeWdvTRa.js";import{_ as Te}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as je}from"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import{_ as qe}from"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import{_ as $e}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{E as M}from"./helpers-wUOLw-dU.js";import{N as He,i as Ge}from"./number-format-BdMuQVyW.js";import{M as C}from"./MachineSMUEnum-CgiCo9nf.js";import{_ as Ve}from"./nw-img-vue-CR837WER.js";const b=l=>(Ce("data-v-ce6dfff7"),l=l(),Le(),l),Ke={class:"title-dialog"},We={key:0,class:"ms-1 status-badge-dialog-header approved-badge p-1"},ze={key:0,class:"py-2"},Je={class:"row mb-1"},Ye={class:"col"},Qe={class:"form-floating approved-text-box"},Xe={class:"form-control",style:{"white-space":"break-spaces"}},Ze=b(()=>t("label",null,"Approved",-1)),et={class:"d-flex flex-column"},tt={class:"d-flex flex-column"},st=b(()=>t("p",{class:"text-bold"},"Asset Number - Serial Number - Ownership",-1)),at={class:"d-flex flex-row"},lt=["innerHTML"],ot={key:0,class:"d-flex flex-column mt-3"},nt={class:"text-bold"},it={key:1,class:"d-flex flex-column mt-3"},rt={key:2,class:"d-flex flex-column mt-3"},ct=b(()=>t("p",{class:"text-bold"},"Machine SMU should be in range",-1)),ut={key:3,class:"d-flex flex-column mt-3"},dt=b(()=>t("p",{class:"text-bold"},"SMU Due (Service)",-1)),ft={class:"d-flex flex-column mt-3"},vt=b(()=>t("p",{class:"text-bold"},"Hour Meter Offset",-1)),mt={class:"d-flex flex-column mt-3"},pt=b(()=>t("p",{class:"text-bold"},"Machine SMU Photo Taken",-1)),ht={class:"row my-4"},gt={class:"bg-secondary"},bt=["src","onClick"],_t={class:"d-flex flex-row justify-content-between"},yt={class:"py-2 d-flex flex-row flex-grow-1"},xt={class:"flex-fill"},kt={class:"form-floating"},St={type:"text",class:"form-control asset-number-disabled-div d-flex"},Dt=["innerHTML"],wt=b(()=>t("label",{for:"floatingInput"},"Asset Number",-1)),Mt={class:"mt-1 py-2"},It={class:"row"},At={class:"col pe-0"},Ut={class:"form-floating"},Rt=["value"],Ft=b(()=>t("label",{class:"text-nowrap"},"Previous Machine SMU",-1)),Nt={class:"col pe-0"},Ot={class:"form-floating"},Ct={class:"text-nowrap"},Lt={key:0,class:"mt-2"},Et={key:0,class:"mt-1 py-2"},Bt={class:"row"},Pt={class:"col pe-0"},Tt={class:"form-floating"},jt=["value"],qt=b(()=>t("label",null,"Machine SMU should be in range",-1)),$t={key:1,class:"mt-1 py-2"},Ht={class:"row"},Gt={class:"col pe-0"},Vt={class:"form-floating"},Kt=["value"],Wt=b(()=>t("label",null,"SMU Due (Service)",-1)),zt={class:"mt-1 py-2"},Jt={class:"row"},Yt={class:"col pe-0"},Qt={class:"form-floating"},Xt=["value"],Zt={class:"text-nowrap"},es={key:0,class:"col pe-0"},ts={class:"form-floating"},ss=b(()=>t("label",{class:"text-nowrap"},"Revised Hour Meter Offset. (If Required)",-1)),as={key:0,class:"mt-2"},ls={class:"d-flex flex-column mt-3"},os={class:"d-flex justify-content-between align-items-center"},ns=b(()=>t("p",{class:"text-bold"},"Machine SMU Photo Taken",-1)),is={class:"row my-4"},rs={class:"bg-secondary"},cs=["src","onClick"],us={key:2,class:"my-5 w-100 d-flex justify-content-around"},ds=Ne({__name:"SMUDetailDialog",props:{show:{required:!0,type:Boolean,default:!1},detailDefect:{required:!0,type:Object,default:()=>({title:"",machineSMU:"",machineSMURange:"",minRange:"",maxRange:"",smuDue:"",assetNumber:"",serialNumber:"",images:"",hmOffset:"",key:"",type:"",reason:""})},ownership:{required:!0,type:String},viewOnly:{required:!1,type:Boolean,default:!1},plannerApprove:{required:!1,type:Boolean,default:!1},plannerData:{required:!1,type:Object},isFitter:{default:!1},approvalSPVData:{required:!1,type:Object,default:{}},errorStatus:{required:!0,type:Object,default:{}},camerasImage:{required:!1,type:Object},isIntevention:{required:!1,type:Boolean,default:!1}},emits:["update:show","onRefreshData","updateDefectDetailSMU","updatePlannerDefectAcknowledge","updateDefectAcknowledge","resetErrorStatus","retakePhoto","resetPhoto"],setup(l,{emit:be}){const r=l,k=be,S=D(()=>r.camerasImage||void 0),_e=()=>{k("retakePhoto")},ye=D(()=>S.value&&S.value.ImageInfos&&S.value.ImageInfos.length>0?S.value.ImageInfos:E.value),H=D({get:()=>r.show,set:e=>{ae(e)}}),L=f(!1),I=f([]),E=f([]),A=f([]),T=f([]),U=f(!1),m=f({value:"",isValid:!0,errorMessage:""}),R=f({value:"",isValid:!0,errorMessage:""}),Q=e=>{Ge(e.target.value)&&(m.value=e.target.value.replaceAll(".","")),ee(m.value)},j=D(()=>{try{const e=JSON.parse(r.detailDefect.images);return g.isUndefined(e)?[]:e==""?[]:ge(e)}catch{return[]}}),G=f(""),V=f(!1),X=(e,s=!1)=>{let a=F.value;s&&(a=O.value);const o=a.find(d=>d.imgBlob==e);G.value=o.url,V.value=!0},xe=()=>{G.value="",V.value=!1},K=D(()=>{var e,s,a;if((e=r.detailDefect)!=null&&e.minRange)return(s=r.detailDefect)==null?void 0:s.minRange;if((a=r.detailDefect)!=null&&a.machineSMURange){const o=r.detailDefect.machineSMURange.split(" ");if(!isNaN(parseFloat(o[0])))return parseFloat(o[0])}return 0}),W=D(()=>{var e,s,a;if((e=r.detailDefect)!=null&&e.maxRange)return(s=r.detailDefect)==null?void 0:s.maxRange;if((a=r.detailDefect)!=null&&a.machineSMURange){const o=r.detailDefect.machineSMURange.split(" ");if(o.length>=3&&!isNaN(parseFloat(o[2])))return parseFloat(o[2])}return 0}),Z=D(()=>{var e,s;return`${K.value-Number((e=r.detailDefect)==null?void 0:e.hmOffset)} to ${W.value-Number((s=r.detailDefect)==null?void 0:s.hmOffset)}`}),B=D(()=>{var e,s;return(e=r.detailDefect)!=null&&e.title?!((s=r.detailDefect)!=null&&s.title.toLocaleLowerCase().includes("not")):!0}),ee=e=>{r.plannerApprove||(e.value==""?(e.isValid=!1,e.errorMessage="Required"):(e.isValid=!0,e.errorMessage=""))},te=()=>{if(U.value){let e=!1;ee(m.value),m.value.isValid||(m.value.isValid=!1,m.value.errorMessage="Required",e=!0),e||(L.value=!0)}else L.value=!0},ke=()=>{P.value=!1,r.errorStatus.messages!=He.NO_NETWORK_VIEW&&(k("resetErrorStatus"),le())},P=f(!1),se=()=>{var e;P.value=(e=r.errorStatus)==null?void 0:e.isError},z=f(!1),Se=()=>{z.value=!0,setTimeout(()=>{z.value=!1,le()},1e3)},ae=e=>{k("update:show",e)},le=()=>{H.value=!1,ae(!1),k("onRefreshData")},q=(e,s=!1)=>{var d;let a=A.value;if(s&&(a=T.value),a.length<1)return;let o;do o=(d=a.find(_=>_.key==e))==null?void 0:d.value;while(!o);return o},oe=f(0),F=f([]),O=f([]),De=()=>{const e=j.value;F.value=e==null?void 0:e.map(s=>({imgBlob:s.filename,url:"",description:s.description}))},ne=async()=>{if(k("resetErrorStatus"),De(),oe.value=0,A.value=[],U.value=!1,re(),!j.value)return;E.value=ge(j.value),I.value=Array.apply(null,Array(j.value.length)).map(function(){return!0});const e=E.value.length;for(let s=oe.value;s<e;s++){const a=E.value[s].filename,o=await Ee.pendingTaskFile.where({filename:a}).first();try{if(!o)await we(a,s);else{const d=g.cloneDeep(o);let _=window.URL||window.webkitURL;A.value.push({key:a,value:_.createObjectURL(d.blob)}),I.value[s]=!1,F.value.forEach(p=>{p.imgBlob==a&&(p.url=_.createObjectURL(d.blob))})}}catch(d){console.log(d)}}},we=async(e,s)=>{const a={fileUrl:e,ver:"v1"};try{const o=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(a).toString()}`,d=await Be.getBlob(o),_=new Blob([d.data]);let p=window.URL||window.webkitURL;A.value.push({key:e,value:p.createObjectURL(_)}),F.value.forEach(h=>{h.imgBlob==e&&(h.url=p.createObjectURL(_))}),I.value[s]=!1}catch(o){console.log("image",o)}},ie=e=>{U.value=e},re=()=>{T.value=g.cloneDeep(A.value),O.value=g.cloneDeep(F.value);const e={value:"",isValid:!0,errorMessage:""};m.value=g.cloneDeep(e),R.value=g.cloneDeep(e),I.value=Array.apply(null,Array(A.value.length)).map(function(){return!1}),k("resetPhoto")},Me=()=>{ie(!1),re()},Ie=()=>{ie(!0),T.value=g.cloneDeep(A.value),O.value=g.cloneDeep(F.value)};Oe(S,e=>{if(!g.isUndefined(e)&&(e==null?void 0:e.ImageInfos.length)>0){const s=URL.createObjectURL(e==null?void 0:e.ImageBlobs[0]);T.value=[{key:(e==null?void 0:e.ImageInfos[0]).filename,value:s}],O.value=[{imgBlob:(e==null?void 0:e.ImageInfos[0]).filename,url:s,description:(e==null?void 0:e.ImageInfos[0]).description}],I.value=Array.apply(null,Array(O.value.length)).map(function(){return!1})}},{deep:!0});const Ae=D(()=>r.isFitter?"Changes Successfully Saved":"Machine SMU Approved"),Ue=()=>{L.value=!1},Re=async()=>{L.value=!1;const e=Pe.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});let s=r.detailDefect.title;if(U.value){const a=g.cloneDeep(r.detailDefect);S.value&&S.value.ImageInfos&&S.value.ImageInfos.length>0&&(a.images=JSON.stringify(S.value.ImageInfos)),a.machineSMU=r.plannerApprove&&m.value.value===""?a.machineSMU:m.value.value,R.value.value!==""&&(a.hmOffset=R.value.value),g.isUndefined(a.minRange)&&(a.minRange=K.value),g.isUndefined(a.maxRange)&&(a.maxRange=W.value);const o=a.machineSMU,d=Number(o)+Number(a.hmOffset)>=K.value,_=Number(o)+Number(a.hmOffset)<=W.value;let p=C.STATUS_NOT_IN_RANGE;d&&_&&(p=C.STATUS_IN_RANGE),s=C.TITLE(p),a.title=C.TITLE(p),await new Promise(h=>{k("updateDefectDetailSMU",{newDetail:a,callback:h})}),se()}if(P.value){e.close();return}r.isFitter||(r.plannerApprove?await new Promise(a=>{k("updatePlannerDefectAcknowledge",{newTitle:s,callback:a})}):await new Promise(a=>{k("updateDefectAcknowledge",{newTitle:s,callback:a})})),e.close(),se(),!P.value&&Se()};return(e,s)=>{var p;const a=$("el-skeleton-item"),o=$("el-skeleton"),d=$("Label"),_=$("el-dialog");return n(),i(N,null,[y(_,{modelValue:H.value,"onUpdate:modelValue":s[6]||(s[6]=h=>H.value=h),"custom-class":"el-defect-crack-form-custom",center:"","destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,onOpened:ne,onOpen:ne,width:"90%"},{title:w(()=>{var h;return[t("label",Ke,[Y(" Detailed Information Machine SMU "),((h=l.approvalSPVData)==null?void 0:h.status)=="Acknowledge"?(n(),i("span",We,"Approved")):v("",!0)])]}),default:w(()=>{var h,ce,ue,de;return[((h=l.approvalSPVData)==null?void 0:h.status)=="Acknowledge"?(n(),i("div",ze,[t("div",Je,[t("div",Ye,[t("div",Qe,[t("div",Xe,u((ce=l.approvalSPVData)==null?void 0:ce.approvedDate)+" — "+u((de=(ue=l.approvalSPVData)==null?void 0:ue.approvedBy)==null?void 0:de.name),1),Ze])])])])):v("",!0),t("div",et,[U.value?(n(),i(N,{key:1},[t("div",_t,[t("div",yt,[t("div",xt,[t("div",kt,[t("div",St,[t("p",null,u(l.detailDefect.assetNumber)+" - "+u(l.detailDefect.serialNumber)+" -",1),t("span",{class:"ms-1 asset-number-disabled-div",innerHTML:l.ownership},null,8,Dt)]),wt])])])]),t("div",Mt,[t("div",It,[t("div",At,[t("div",Ut,[t("input",{type:"text",class:"form-control",disabled:"",value:l.detailDefect.machineSMU},null,8,Rt),Ft])]),t("div",Nt,[t("div",Ot,[me(t("input",{inputmode:"numeric",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=c=>m.value.value=c),onKeypress:s[1]||(s[1]=(...c)=>x(M)&&x(M)(...c)),onChange:s[2]||(s[2]=(...c)=>x(M)&&x(M)(...c)),onBlur:Q},null,544),[[pe,m.value.value]]),t("label",Ct,u(l.plannerApprove?"Revised Machine SMU. (If Required)":"Revised Machine SMU"),1)]),m.value.isValid?v("",!0):(n(),i("div",Lt,[y(d,{class:"error-label"},{default:w(()=>[Y(u(m.value.errorMessage),1)]),_:1})]))])])]),!B.value&&!l.isIntevention?(n(),i("div",Et,[t("div",Bt,[t("div",Pt,[t("div",Tt,[t("input",{type:"text",class:"form-control",disabled:"",value:Z.value},null,8,jt),qt])])])])):v("",!0),l.isIntevention?v("",!0):(n(),i("div",$t,[t("div",Ht,[t("div",Gt,[t("div",Vt,[t("input",{type:"text",class:"form-control",disabled:"",value:l.detailDefect.smuDue},null,8,Kt),Wt])])])])),t("div",zt,[t("div",Jt,[t("div",Yt,[t("div",Qt,[t("input",{type:"text",class:"form-control",disabled:"",value:l.detailDefect.hmOffset},null,8,Xt),t("label",Zt,u(l.plannerApprove?"Previous ":"")+" Hour Meter Offset",1)])]),l.plannerApprove?(n(),i("div",es,[t("div",ts,[me(t("input",{inputmode:"numeric",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=c=>R.value.value=c),onKeypress:s[4]||(s[4]=(...c)=>x(M)&&x(M)(...c)),onChange:s[5]||(s[5]=(...c)=>x(M)&&x(M)(...c)),onBlur:Q},null,544),[[pe,R.value.value]]),ss]),R.value.isValid?v("",!0):(n(),i("div",as,[y(d,{class:"error-label"},{default:w(()=>[Y(u(R.value.errorMessage),1)]),_:1})]))])):v("",!0)])]),t("div",ls,[t("div",os,[ns,l.isFitter?(n(),i("button",{key:0,class:"btn btn-light",onClick:_e,style:{background:"#FFFFFF",border:"1px solid #18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"#18AF4A",padding:"4px"}},"Retake Photo")):v("",!0)]),t("div",is,[(n(!0),i(N,null,ve(ye.value,(c,J)=>(n(),i("div",{key:c.filename,class:"col-md-6 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[y(o,{loading:I.value[J],animated:""},{template:w(()=>[y(a,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:w(()=>[t("div",rs,[q(c.filename,!0)!=null?(n(),i("img",{key:0,src:q(c.filename,!0),class:"w-100",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:Fe=>X(c.filename,!0)},null,8,cs)):v("",!0)])]),_:2},1032,["loading"])]))),128))])])],64)):(n(),i(N,{key:0},[t("div",tt,[st,t("div",at,[t("p",null,u(l.detailDefect.assetNumber)+" - "+u(l.detailDefect.serialNumber)+" -",1),t("div",{class:"ms-1 asset-number-disabled-div",innerHTML:l.ownership},null,8,lt)])]),l.isIntevention?(n(),i("div",ot,[t("p",nt,u(x(C).VIEW_DIALOG_LABEL(!0)),1),t("p",null,u(l.detailDefect.machineSMU),1)])):(n(),i("div",it,[t("p",{class:fe(["text-bold",[B.value?"":"text-red"]])},u(x(C).VIEW_DIALOG_LABEL(B.value)),3),t("p",{class:fe([B.value?"":"text-red"])},u(l.detailDefect.machineSMU),3)])),!B.value&&!l.isIntevention?(n(),i("div",rt,[ct,t("p",null,u(Z.value),1)])):v("",!0),l.isIntevention?v("",!0):(n(),i("div",ut,[dt,t("p",null,u(l.detailDefect.smuDue),1)])),t("div",ft,[vt,t("p",null,u(l.detailDefect.hmOffset),1)]),t("div",mt,[pt,t("div",ht,[(n(!0),i(N,null,ve(E.value,(c,J)=>(n(),i("div",{key:c.filename,class:"col-md-6 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[y(o,{loading:I.value[J],animated:""},{template:w(()=>[y(a,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:w(()=>[t("div",gt,[q(c.filename)!=null?(n(),i("img",{key:0,src:q(c.filename),class:"w-100",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:Fe=>X(c.filename)},null,8,bt)):v("",!0)])]),_:2},1032,["loading"])]))),128))])])],64)),l.viewOnly?v("",!0):(n(),i("div",us,[U.value?(n(),i(N,{key:0},[t("button",{class:"btn btn-light w-100",onClick:Me,style:{background:"#FFFFFF",border:"1px solid #18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"#18AF4A"}},"Cancel"),t("button",{class:"ms-3 btn btn-success w-100",onClick:he(te,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},u(l.isFitter?"Submit":"Submit & Approve"),1)],64)):(n(),i(N,{key:1},[t("button",{class:"btn btn-light w-100",onClick:Ie,style:{background:"#FFFFFF",border:"1px solid #18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"#18AF4A"}},"Revise"),l.isFitter?v("",!0):(n(),i("button",{key:0,class:"ms-3 btn btn-success w-100",onClick:he(te,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Approve"))],64))]))])]}),_:1},8,["modelValue"]),y(Te,{visibility:L.value,"no-label":"Cancel",caption:"Are you sure this Machine SMU information is correct?",onOnNoConfirm:Ue,onOnYesConfirm:Re},null,8,["visibility"]),y(qe,{show:z.value,message:Ae.value},null,8,["show","message"]),y(je,{images:U.value?O.value:F.value,visibility:V.value,image:G.value,onHandleClose:xe},null,8,["images","visibility","image"]),y($e,{visibility:P.value,caption:(p=l.errorStatus)==null?void 0:p.messages,onOnClose:ke},null,8,["visibility","caption"])],64)}}}),ws=Ve(ds,[["__scopeId","data-v-ce6dfff7"]]);export{ws as S};
