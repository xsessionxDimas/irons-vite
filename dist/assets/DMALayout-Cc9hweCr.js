import{k as $,bL as R,a7 as j,p as v,aa as f,aB as n,u as d,s as e,C as h,P as se,R as O,r as D,c as p,d as x,o as ne,y as ae,F as ie,aG as re,Y as ce}from"./@vue-BypzYtbH.js";import{a as E,b as me,l as le,d as ue,e as de,f as pe}from"./index-BuVmIl8K.js";import{e as ge}from"./lodash-DrHMlsdo.js";import{O as ve}from"./OnlineStatus-Bhk3CA8-.js";import{u as U}from"./@vueuse-DFoNmIyu.js";import{i as m,r as M}from"./internet-connection-CnLQPjRt.js";import{_ as fe}from"./nw-img-vue-CR837WER.js";import{_ as be}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{u as _e}from"./vue-router-iNp9kJ0K.js";import{a as ye}from"./get-user-info-DjfNX8-X.js";import{u as Se}from"./useCronStore-CDY_CiV6.js";import{u as he}from"./useSyncStore-DsLBNjEA.js";import{u as we,a as ke}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{u as Ie,a as N,b as B}from"./useEFormStore-DtkLPope.js";import{u as De}from"./useMasterStore-CzSO06fn.js";import{d as C}from"./cron-De-pTz2b.js";import{u as xe}from"./usePositionListStore-BsprGHwA.js";import{u as Me}from"./useDailyScheduleStore-B3ZQzhxq.js";import{u as Ce}from"./useComponentInterventionStore-Cc_xw-uu.js";import{u as Oe}from"./useMsal-BbsBYoof.js";import{c as Te}from"./helpers-wUOLw-dU.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./element-plus-BeWdvTRa.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./luxon-C_T8jI2d.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./useBodyStore-L-idhAYV.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./urls-RITu66bD.js";import"./urls-CvqtYZA-.js";import"./number-format-BdMuQVyW.js";import"./urls-hWHEBXep.js";import"./authentication-handler-Pueb_EI7.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./prev-val-handler-DvA3D_kF.js";import"./list-pcxkCnQg.js";import"./urls-B0Rq9QQ3.js";import"./urls-CPQ2HRXU.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./CrackYesClass-COntz77m.js";import"./IronformConfig-BWypCgSI.js";import"./urls-D8F5Tyyp.js";import"./disabled-state-O9W-ZY8y.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./useComponentInterventionEformStore-CMy33xkJ.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";const Ae={class:"row justify-content-between",style:{"padding-right":"0"}},Fe={class:"col-6"},Je={class:"m-2 p-3 rounded d-flex flex-row",style:{background:"#F9FAFB",width:"fit-content","border-radius":"12px"}},Le={key:0,class:"symbol symbol-circle"},Pe={key:1,class:"symbol symbol-circle firstname-placeholder text-center d-flex flex-row justify-content-center align-items-center"},Re={class:"ml-1 d-flex flex-column",style:{"margin-left":"10px"}},Ne={style:{"font-size":"12px","font-weight":"700","margin-bottom":"0"}},Be={style:{"font-size":"12px","font-weight":"400"}},$e={style:{"font-size":"12px","font-weight":"400"}},je={class:"col-6"},Ee={class:"p-6 d-flex flex-row-reverse",style:{"text-align":"end"}},Ue={class:"d-flex align-items-center"},He=$({__name:"UserInfo",props:{loading:{required:!1,type:Boolean}},emits:["onSignOut"],setup(H,{emit:w}){const g=w;U();const a=E(),l=R(()=>a.userPic),s=R(()=>ge.isUndefined(a.user.Name)?"":a.user.Name[0]),c=()=>{g("onSignOut",null)};return j(async()=>{a.userPic==""&&await a.setUserProfilePic(!m())}),(T,i)=>{const r=O("NwImg");return v(),f("div",Ae,[n("div",Fe,[n("div",Je,[d(l)!=""?(v(),f("div",Le,[e(r,{class:"menu-avatar-img",src:d(l),alt:"metronic"},null,8,["src"])])):(v(),f("div",Pe,[n("span",null,h(d(s)),1)])),n("div",Re,[n("h6",Ne,h(d(a).user.Name),1),n("label",Be,h(d(a).user.Position),1),n("label",$e,h(d(a).user.Location),1)])])]),n("div",je,[n("div",Ee,[e(r,{src:"/media/logos/bumaau/logout.png",onClick:se(c,["prevent"]),alt:"logout button",width:"40",height:"40",style:{cursor:"pointer","margin-left":"10px"}}),n("div",Ue,[e(ve)])])])])}}}),qe=fe(He,[["__scopeId","data-v-5525aa2e"]]),ze={class:"container h-100 p-0"},Ge={class:"row mx-0"},Ve={class:"px-6"},We={style:{display:"none"}},Ye=re('<button type="button" class="el-carousel__arrow el-carousel__arrow--right"><i class="el-icon-arrow-right"></i></button><button type="button" class="el-carousel__arrow el-carousel__arrow--left"><i class="el-icon-arrow-left"></i></button><button aria-label="close" class="el-dialog__headerbtn" type="button"><i class="el-dialog__close el-icon el-icon-close"></i></button><button class="btn btn-outline-secondary border" type="button"><em class="fa fa-chevron-up"></em></button><button class="btn btn-outline-secondary border" type="button"><em class="fa fa-chevron-down"></em></button><button class="p-5 btn btn-outline-secondary border-right-0 border" type="button"><em class="fa fa-search"></em></button><button aria-label="close" class="el-dialog__headerbtn" type="button"><i class="el-dialog__close el-icon el-icon-close"></i></button>',7),wo=$({__name:"DMALayout",setup(H){const w=U(),g=D(!1),a=_e(),l=D(!1),s=E(),c=we(),T=Se(),i=he(),r=ke(),k=Ie();N();const q=B(),b=me(),z=D(!1),I=De(),G=xe(),A=Me(),F=N(),V=Ce(),J=B(),{instance:u}=Oe(),W=p(()=>s.loggedIn),_=p(()=>i.jobRenewToken),y=p(()=>i.jobSyncTask),S=p(()=>i.jobSyncTaskImage);p(()=>r.LastSync==""?"":`Last Updated ${r.LastSync}`);const Y=()=>{g.value=!0},K=async()=>{try{await u.logoutPopup()}catch(o){console.log(o)}finally{localStorage.clear(),sessionStorage.clear(),s.reset(),b.reset(),T.releaseCronJob(),i.reset();try{const o=ue();o.provider&&o.provider.resetUser()}catch(o){console.log(o)}finally{await de(pe,"validTokenNew"),a.push({name:"signin"})}}},Q=async()=>{try{await b.getOutstandingMenuDMA(s.user.EmployeeId)}catch(o){console.log(o)}},X=()=>{g.value=!1},Z=p(()=>b.loadingDMA&&l.value);x(W,o=>{o||M(u)});const ee=()=>{if(!(_.value&&_.value.running))if(_.value)_.value.start();else{const o=new C.CronJob("*/10 * * * *",async function(){M(u)},null,!0);i.setJobRenewTokenRunning(o)}},L=()=>{if(!(y.value&&y.value.running))if(y.value)c.SyncData(),y.value.start();else{c.SyncData();const o=new C.CronJob("*/3 * * * * *",function(){c.SyncData()},null,!0);i.setJobSyncTaskRunning(o)}},P=()=>{if(!(S.value&&S.value.running))if(S.value)m()||c.SyncImage(),S.value.start();else{m()||c.SyncImage();const o=new C.CronJob("*/3 * * * * *",function(){m()||c.SyncImage()},null,!0);i.setJobSyncTaskImageRunning(o)}};return x(w,o=>{o?(console.log("Cron renew token called after back online at : ",new Date().toLocaleString()),M(u),L(),P()):i.stopAllJob()}),j(async()=>{l.value=!0,await ye(!m(),u),l.value=!1,m()?k.getDailyScheduleFromLocalDB():(await u.acquireTokenSilent(le),s.user.SiteId&&(G.getPositionDMA(),s.user.SiteId&&(b.isMenuDMASet&&Q(),A.getDailySchedules(s.user.SiteId),A.getDailySchedulesInterim(s.user.SiteId),k.getDailySchedules(s.user.SiteId),k.getHmOffset(s.user.SiteId)),F.getSMUTolerance(),F.getShiftListData(),J.getOilTolerance(),V.getParamDaysBeforeEst(),I.getCBMMappingDataFromServer(),I.getMasterDataFromServer(),I.getMasterDataFitterFromServer(),q.updateSkipPreServiceReasonOptions(),J.updateSkipPreServiceReasonOptions()))}),ne(()=>{m()?(i.stopAllJob(),Te()):(ee(),L(),P(),r.syncWithIronPortalData(),r.getLatestSyncDate(),s.user.SiteId&&r.getWorkOrders(s.user.SiteId))}),x(()=>s.user.SiteId,o=>{o&&r.getWorkOrders(s.user.SiteId)}),(o,Ke)=>{const t=O("NwImg"),te=O("router-view"),oe=ce("loading");return v(),f(ie,null,[ae((v(),f("div",ze,[n("div",Ge,[e(qe,{onOnSignOut:Y,loading:z.value},null,8,["loading"]),n("div",Ve,[e(t,{src:"/media/logos/bumaau/bumaau-home.png",alt:"DMA",class:"w-99",style:{height:"auto","border-radius":"2.475rem"}})]),e(te)]),n("div",We,[e(t,{src:"/media/svg/dma/camera/photo_camera.svg",alt:"DMA"}),e(t,{src:"/media/svg/dma/camera/image-collections.svg",alt:"DMA"}),e(t,{src:"/media/svg/dma/camera/flip_camera.svg",alt:"DMA"}),e(t,{src:"/media/svg/dma/camera/e-form/png/cam-user.png"}),e(t,{src:"/media/svg/dma/camera/e-form/png/cam-read.png"}),e(t,{src:"/media/svg/dma/camera/e-form/png/cam-active.png"}),e(t,{src:"/media/icons/bumaau/available.png"}),e(t,{src:"/media/icons/bumaau/not-available.png"}),e(t,{src:"/media/logos/bumaau/buma-logo.png"}),e(t,{src:"/media/logos/logo-whitebg.png"}),e(t,{src:"/media/logos/bumaau/cautions.png"}),e(t,{src:"/media/logos/bumaau/defect.png"}),e(t,{src:"/media/logos/bumaau/na.png"}),e(t,{src:"/media/svg/dma/icons/Repair.png"}),e(t,{src:"/media/icons/bumaau/danger.png"}),e(t,{src:"/media/icons/bumaau/caution.png"}),e(t,{src:"/media/svg/dma/image-close-button-red.png"}),e(t,{src:"/media/svg/dma/green-checklist.png"}),e(t,{src:"/media/icons/bumaau/rotate.png"}),e(t,{src:"/media/icons/bumaau/sync.png"}),e(t,{src:"/media/logos/bumaau/detail.png"}),e(t,{src:"/media/icons/bumaau/download-arrow-down.png"}),e(t,{src:"/media/logos/bumaau/ok.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/approval.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/change-pin.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/component-intervention-forms.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/defects-planner.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/defects.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/e-Form.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/help.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/interim-engine-service.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/logout.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/monitoring_status.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/monitoring-status.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/sos-print-label.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/version-history.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/sos-print-label.png"}),e(t,{src:"/media/svg/dma/side-menu/inactive/sync.png"}),e(t,{src:"/media/svg/dma/side-menu/active/approval.png"}),e(t,{src:"/media/svg/dma/side-menu/active/sync.png"}),e(t,{src:"/media/svg/dma/side-menu/active/change-pin.png"}),e(t,{src:"/media/svg/dma/side-menu/active/component-intervention-forms.png"}),e(t,{src:"/media/svg/dma/side-menu/active/defects-planner.png"}),e(t,{src:"/media/svg/dma/side-menu/active/defects.png"}),e(t,{src:"/media/svg/dma/side-menu/active/e-form.png"}),e(t,{src:"/media/svg/dma/side-menu/active/interim-engine-service.png"}),e(t,{src:"/media/svg/dma/side-menu/active/monitoring-status.png"}),e(t,{src:"/media/svg/dma/side-menu/active/sos-print-label.png"}),e(t,{src:"/media/svg/dma/side-menu/active/version-history.png"}),e(t,{src:"/media/svg/dma/icons/Check.png"}),e(t,{src:"/media/svg/dma/icons/Check.png"}),e(t,{src:"/media/icons/bumaau/check_circle.png"}),e(t,{src:"/media/icons/bumaau/error.png"}),e(t,{src:"/media/icons/bumaau/close-success.png"}),e(t,{src:"/media/icons/bumaau/close-danger.png"}),e(t,{src:"/media/icons/bumaau/warning.png"}),e(t,{src:"/media/svg/dma/attachment/blue.png"}),e(t,{src:"/media/svg/dma/attachment/green.png"}),e(t,{src:"/media/svg/dma/attachment/pdf.png"}),e(t,{src:"/media/icons/bumaau/person-circle.png"}),e(t,{src:"/media/icons/bumaau/icon-edit.png"}),Ye])])),[[oe,Z.value]]),e(be,{visibility:g.value,caption:"Are you sure want to log out?",onOnNoConfirm:X,onOnYesConfirm:K},null,8,["visibility"])],64)}}});export{wo as default};
