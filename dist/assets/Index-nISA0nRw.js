import{u as _t}from"./vuex-BbOKrtVp.js";import{a as St}from"./breadcrumb-D-Q4Tk9w.js";import{b as O,u as et,i as j,h as at,j as z,A as Et}from"./index-BCnwA6yE.js";import{P as ct}from"./Pagination-CVDIvnOM.js";import{F as Pt}from"./FilterIconButton-Bj0WTbms.js";import{h as yt,A as bt,U as Lt}from"./excel-generator-CRLIz6fw.js";import{D as wt}from"./DownloadIconButton-CIQp-YG7.js";import{_ as b,b as ut}from"./element-plus-C5R56mia.js";import{f as C,n as B,a as H,b as Ft}from"./date-format-BASVuupi.js";import{P as G,d as Tt,a as Ct}from"./table-sort-VnBD5Hfa.js";import{C as ht,L as kt,E as Ut,U as It,B as xt,a as $t}from"./urls-CWQmf-Uk.js";import{d as st}from"./pinia-BjOS2_Ao.js";import{a as it}from"./mapOption-sP4IrA4W.js";import{k as R,bL as At,r as q,u as s,y as N,p as w,aa as M,q as k,x as h,Y as Q,R as I,s as a,aB as l,C as V,a0 as W,c as x,B as U,A as Z,T as pt,bd as Bt,bb as Vt,a7 as Ot,L as Rt,F as Ht}from"./@vue-BypzYtbH.js";import{a as Dt}from"./vee-validate-C_msoaAA.js";import{c as mt,a as K,b as X,d as gt}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as vt}from"./ErrorAlert-CMKGfwAi.js";import{_ as Y}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as J}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{e as Nt}from"./lodash-Cr9vlq0V.js";import{_ as qt}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as zt}from"./map-anything-abi6NY2Z.js";import{_ as Mt}from"./nw-img-vue-CR837WER.js";import{_ as lt}from"./AutoComplete.vue_vue_type_style_index_0_lang-CRR6Z--K.js";import{_ as dt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as jt}from"./file-saver-DhbZvGod.js";import"./vue-router-iNp9kJ0K.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const ot=st({id:"levelList",state:()=>({stateFilterData:{Level:"",Parent:"",StartDate:"",EndDate:"",LevelTo:"",ParentTo:"",StartDateTo:"",EndDateTo:"",ver:"v1",Page:1,PageSize:10,Order:""},stateLastUsedFilterData:{Level:"",Parent:"",StartDate:"",EndDate:"",LevelTo:"",ParentTo:"",StartDateTo:"",EndDateTo:"",ver:"v1",Page:1,PageSize:10,Order:""},statePageName:"level",stateDisplayData:[],statePagination:new G,stateLoading:!1,statePaginationLoading:!1,stateLevelOption:[],stateParentOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,levelOption:t=>t.stateLevelOption,parentOption:t=>t.stateParentOption},actions:{async getData(t=!0){const d={Level:this.stateFilterData.Level,Parent:this.stateFilterData.Parent,LevelTo:this.stateFilterData.LevelTo,ParentTo:this.stateFilterData.ParentTo,StartDate:this.stateFilterData.StartDate?C(this.stateFilterData.StartDate.toLocaleString()):"",EndDate:this.stateFilterData.EndDate?C(this.stateFilterData.EndDate.toLocaleString()):"",StartDateTo:this.stateFilterData.StartDateTo?C(this.stateFilterData.StartDateTo.toLocaleString()):"",EndDateTo:this.stateFilterData.EndDateTo?C(this.stateFilterData.EndDateTo.toLocaleString()):"",Page:this.stateFilterData.Page.toString(),PageSize:this.stateFilterData.PageSize.toString(),Order:this.stateFilterData.Order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await O.get(ht,"",new URLSearchParams(d).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const d=await O.get(kt,"",new URLSearchParams(t).toString());this.stateLevelOption=it(d.data.result.content.level),this.stateParentOption=it(d.data.result.content.parent)}catch(d){console.log(d)}},async export(){const t={Level:this.stateFilterData.Level,Parent:this.stateFilterData.Parent,LevelTo:this.stateFilterData.LevelTo,ParentTo:this.stateFilterData.ParentTo,StartDate:this.stateFilterData.StartDate?C(this.stateFilterData.StartDate.toLocaleString()):"",EndDate:this.stateFilterData.EndDate?C(this.stateFilterData.EndDate.toLocaleString()):"",StartDateTo:this.stateFilterData.StartDateTo?C(this.stateFilterData.StartDateTo.toLocaleString()):"",EndDateTo:this.stateFilterData.EndDateTo?C(this.stateFilterData.EndDateTo.toLocaleString()):"",ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await O.getBlob(Ut,"",new URLSearchParams(t).toString())).data}catch(d){console.log(d)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:d}){if(!t&&!d)this.stateFilterData.Order="";else{const e=d=="ascending"?"asc":"desc";this.stateFilterData.Order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1)},setLevel(t){this.stateFilterData.Level=t},setParent(t){this.stateFilterData.Parent=t},setLevelTo(t){this.stateFilterData.LevelTo=t},setParentTo(t){this.stateFilterData.ParentTo=t},setStartDate(t){this.stateFilterData.StartDate=t},setStartDateTo(t){this.stateFilterData.StartDateTo=t},setEndDate(t){this.stateFilterData.EndDate=t},setEndDateTo(t){this.stateFilterData.EndDateTo=t},async resetFilter(){this.stateFilterData.Level="",this.stateFilterData.Parent="",this.stateFilterData.StartDate="",this.stateFilterData.EndDate="",this.stateFilterData.LevelTo="",this.stateFilterData.ParentTo="",this.stateFilterData.StartDateTo="",this.stateFilterData.EndDateTo="";const t=this.stateLastUsedFilterData.Level!=="",d=this.stateLastUsedFilterData.Parent!=="",e=this.stateLastUsedFilterData.LevelTo!=="",f=this.stateLastUsedFilterData.Parent!=="",o=this.stateLastUsedFilterData.StartDate!=="",n=this.stateLastUsedFilterData.EndDate!=="",p=this.stateLastUsedFilterData.StartDateTo!=="",c=this.stateLastUsedFilterData.EndDateTo!=="";(t||d||e||f||o||n||p||c)&&await this.getData()},resetState(){this.stateFilterData={Level:"",Parent:"",StartDate:"",EndDate:"",LevelTo:"",ParentTo:"",StartDateTo:"",EndDateTo:"",ver:"v1",Page:1,PageSize:10,Order:""},this.stateDisplayData=[],this.statePagination=new G,this.stateLoading=!1,this.statePaginationLoading=!1}}}),tt=st({id:"levelForm",state:()=>({stateFormData:{LevelId:0,StartDate:B(new Date),EndDate:B(new Date("12/31/9999"))},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading},actions:{async insertData(t){this.stateFormData.StartDate=C(B(new Date(this.stateFormData.StartDate))),this.stateFormData.EndDate=C(B(new Date(this.stateFormData.EndDate)));try{this.stateLoading=!0;const d={userAccount:t,ver:"v1"},e=await O.post(`${ht}?${new URLSearchParams(d).toString()}`,this.stateFormData);e.data.title==="Error"?(this.stateErrors.push(e.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(d){this.stateError=d,this.stateErrors.push(d.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},async updateData(t){this.stateFormData.StartDate=C(B(new Date(this.stateFormData.StartDate))),this.stateFormData.EndDate=C(B(new Date(this.stateFormData.EndDate)));try{this.stateLoading=!0;const d={userAccount:t,ver:"v1"},e=await O.post(`${It}?${new URLSearchParams(d).toString()}`,this.stateFormData);e.data.title==="Error"?(this.stateErrors.push(e.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(d){this.stateError=d,this.stateErrors.push(d.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.LevelId=t.levelId||0,this.stateFormData.Level=t.level||"",this.stateFormData.Parent=t.parent||"",this.stateFormData.StartDate=t.startDate||"",this.stateFormData.EndDate=t.endDate||""},resetState(){this.stateFormData={LevelId:0,StartDate:B(new Date),EndDate:B(new Date("12/31/9999"))},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),Gt={key:0,style:{height:"100px"}},Kt={key:0,class:"row justify-content-center"},Xt={key:1,class:"row justify-content-center"},Yt={class:"row justify-content-center"},Jt=["onClick"],Qt=R({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog"],setup(t,{emit:d}){const e=t,f=ot(),o=tt(),n=d,p=At(()=>(e.page-1)*10+1),c=q(""),m=_=>{c.value=_.order;const g={prop:_.prop,order:_.order};f.setSort(g)},E=(_,g,P)=>Tt(_[P],g[P],c.value),y=_=>{o.setFormData(_),n("show-dialog",null)};return(_,g)=>{const P=I("inline-svg"),T=I("el-tooltip"),F=Q("loading");return s(f).loading?N((w(),M("div",Gt,null,512)),[[F,s(f).loading]]):N((w(),k(s(ut),{key:1,data:e.listData,style:{width:"100%"},onSortChange:m,"empty-text":"No Data"},{default:h(()=>[a(s(b),{label:"No",width:"90",align:"center"},{default:h(r=>[l("span",null,V(s(p)+r.$index),1)]),_:1}),a(s(b),{prop:"level",label:"Level","min-width":"170",sortable:"","sort-method":(r,D)=>E(r,D,"level")},null,8,["sort-method"]),a(s(b),{prop:"parent",label:"Parent","min-width":"170",sortable:"","sort-method":(r,D)=>E(r,D,"parent")},null,8,["sort-method"]),a(s(b),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:h(r=>[l("span",null,V(s(H)(r.row.startDate)),1)]),_:1}),a(s(b),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""},{default:h(r=>[l("span",null,V(s(H)(r.row.endDate)),1)]),_:1}),a(s(b),{prop:"isActive",label:"Is Active",width:"100",sortable:""},{default:h(r=>[r.row.isActive?(w(),M("div",Kt,[a(P,{src:"/media/svg/tables/rows/check.svg"})])):(w(),M("div",Xt,[a(P,{src:"/media/svg/tables/rows/minus.svg"})]))]),_:1}),a(s(b),{prop:"changedOn",label:"Changed on",align:"center",width:"170",sortable:""},{default:h(r=>[l("span",null,V(s(Ft)(r.row.changedOn)),1)]),_:1}),a(s(b),{prop:"changedBy",label:"Changed by",sortable:"",width:"300","sort-method":(r,D)=>E(r,D,"changedBy")},null,8,["sort-method"]),a(s(b),{label:"",width:"80"},{default:h(r=>[l("div",Yt,[a(T,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:h(()=>[l("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:D=>y(r.row)},[a(P,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Jt)]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[F,s(f).loading]])}}}),Wt={class:"row g-4 my-4"},Zt={class:"col-md-6 fv-row fv-plugins-icon-container"},te={class:"col-md-6 fv-row fv-plugins-icon-container"},ee={class:"col-md-6 fv-row fv-plugins-icon-container"},ae={class:"col-md-6 fv-row fv-plugins-icon-container"},se={class:"dialog-footer"},oe=R({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:d}){const e=t,f=d,o=tt(),n=et(),p=W(e,"visibility"),c=x(()=>o.formData),m=x(()=>o.errors),E=x(()=>o.isError),y=mt().shape({Level:K().required("Level is mandatory"),Parent:K().required("Parent is mandatory"),StartDate:X().required("Start Date is mandatory").typeError("Start Date is mandatory"),EndDate:X().required("End Date is mandatory").min(gt("StartDate"),"End date must be later than start date").typeError("End date must be later than start date").typeError("End Date is mandatory")}),_=()=>{P(""),T(""),F(""),r("")},g=(u=!1)=>{i(),_(),o.resetState(),f("handle-close",u)},P=u=>{c.value.Level=u},T=u=>{c.value.Parent=u},F=u=>{c.value.StartDate=u},r=u=>{c.value.EndDate=u},D=async()=>{i(),await y.validate(c.value,{abortEarly:!1}).catch(u=>{o.setErrors(u.errors)}),!E.value&&j("Are you sure you want to submit ?").then(async u=>{u.isConfirmed&&o.insertData(n.user.Name).then(()=>{o.isError||at("Form has been successfully submitted!","Ok").then(()=>{g(!0)})})})},i=()=>{o.setErrors([])};return(u,S)=>{const L=I("el-button"),v=I("el-dialog"),$=Q("loading");return N((w(),k(v,{modelValue:p.value,"onUpdate:modelValue":S[0]||(S[0]=A=>p.value=A),title:"New Data",width:"40%",onClose:S[1]||(S[1]=A=>g())},{footer:h(()=>[l("span",se,[a(L,{type:"primary",onClick:D,disabled:s(o).loading},{default:h(()=>[U("Submit")]),_:1},8,["disabled"]),a(L,{type:"secondary",onClick:g,disabled:s(o).loading},{default:h(()=>[U("Close")]),_:1},8,["disabled"])])]),default:h(()=>[a(pt,{name:"fade"},{default:h(()=>[E.value?(w(),k(vt,{key:0,errorMessages:m.value,onResetForm:i},null,8,["errorMessages"])):Z("",!0)]),_:1}),N((w(),k(s(Dt),{id:"kt_filter_form",class:"row g-9 my-4"},{default:h(()=>[l("div",Wt,[l("div",Zt,[a(Y,{value:c.value.Level,margin:!1,placeholder:"Add Level",label:"Level",name:"Level",max:6,onHandleChange:P},null,8,["value"])]),l("div",te,[a(Y,{value:c.value.Parent,placeholder:"Add Parent",label:"Parent",name:"Parent",max:6,onHandleChange:T},null,8,["value"])]),l("div",ee,[a(J,{value:c.value.StartDate?c.value.StartDate.toString():"",placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:F},null,8,["value"])]),l("div",ae,[a(J,{value:c.value.EndDate?c.value.EndDate.toString():"",placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:r},null,8,["value"])])])]),_:1})),[[$,s(o).loading]])]),_:1},8,["modelValue"])),[[$,s(o).loading]])}}}),re={class:"row g-4 my-4"},ne={class:"col-md-6 fv-row fv-plugins-icon-container"},ie={class:"col-md-6 fv-row fv-plugins-icon-container"},le={class:"col-md-6 fv-row fv-plugins-icon-container"},de={class:"col-md-6 fv-row fv-plugins-icon-container"},ce={class:"dialog-footer"},ue=R({__name:"FormEditDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:d}){const e=t,f=d,o=tt(),n=et(),p=W(e,"visibility"),c=x(()=>o.formData),m=x(()=>o.errors),E=x(()=>o.isError),y=mt().shape({Level:K().required("Level is mandatory"),Parent:K().required("Parent is mandatory"),StartDate:X().required("Start Date is mandatory").typeError("Start Date is mandatory"),EndDate:X().required("End Date is mandatory").min(gt("StartDate"),"End date must be later than start date").typeError("End date must be later than start date").typeError("End Date is mandatory")}),_=()=>{c.value.LevelId=0,c.value.Level="",c.value.Parent="",F(""),r("")},g=(u=!1)=>{_(),i(),o.resetState(),f("handle-close",u)},P=u=>{c.value.Level=u},T=u=>{c.value.Parent=u},F=u=>{c.value.StartDate=u},r=u=>{c.value.EndDate=u},D=async()=>{i(),await y.validate(c.value,{abortEarly:!1}).catch(u=>{o.setErrors(u.errors)}),!E.value&&j("Are you sure you want to submit ?").then(async u=>{u.isConfirmed&&o.updateData(n.user.Name).then(()=>{o.isError||at("Form has been successfully submitted!","Ok").then(()=>{g(!0)})})})},i=()=>{o.setErrors([])};return(u,S)=>{const L=I("el-button"),v=I("el-dialog"),$=Q("loading");return N((w(),k(v,{modelValue:p.value,"onUpdate:modelValue":S[0]||(S[0]=A=>p.value=A),title:"Update Data",width:"40%",onClose:S[1]||(S[1]=A=>g())},{footer:h(()=>[l("span",ce,[a(L,{type:"primary",onClick:D,disabled:s(o).loading},{default:h(()=>[U("Submit")]),_:1},8,["disabled"]),a(L,{type:"secondary",onClick:g,disabled:s(o).loading},{default:h(()=>[U("Close")]),_:1},8,["disabled"])])]),default:h(()=>[a(pt,{name:"fade"},{default:h(()=>[E.value?(w(),k(vt,{key:0,errorMessages:m.value,onResetForm:i},null,8,["errorMessages"])):Z("",!0)]),_:1}),a(s(Dt),{id:"kt_filter_form",class:"row g-9 my-4"},{default:h(()=>[l("div",re,[l("div",ne,[a(Y,{value:c.value.Level,margin:!1,placeholder:"Add Level",label:"Level",name:"Level",max:6,onHandleChange:P},null,8,["value"])]),l("div",ie,[a(Y,{value:c.value.Parent,placeholder:"Add Parent",label:"Parent",name:"Parent",max:6,onHandleChange:T},null,8,["value"])]),l("div",le,[a(J,{value:c.value.StartDate?c.value.StartDate.toString():"",placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:F},null,8,["value"])]),l("div",de,[a(J,{value:c.value.EndDate?c.value.EndDate.toString():"",placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:r},null,8,["value"])])])]),_:1})]),_:1},8,["modelValue"])),[[$,s(o).loading]])}}}),rt=st({id:"levelBulk",state:()=>({statePagination:new G,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const d={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await O.post(`${xt}?${new URLSearchParams(d).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:d}){const e={userAccount:t,ver:"v1"},f=`${$t}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const o=await O.postImages(f,d);o.data.statusCode==200?o.data.result.isError?(this.stateIsError=!0,this.stateError=o.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=o.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=Nt.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=o.data.result.isError,this.stateError=o.data.result.message)}catch(o){console.log(o),this.stateIsError=!0,this.stateError=o.response.data.result.message}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(Ct(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new G,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),he={class:"icon"},pe=R({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const d=t,e=rt(),f=x(()=>(d.page-1)*10+1),o=n=>{const p={prop:n.prop,order:n.order};e.setSort(p)};return(n,p)=>{const c=I("inline-svg");return w(),k(s(ut),{data:d.listData,style:{width:"100%"},onSortChange:o,"empty-text":"No Data"},{default:h(()=>[a(s(b),{label:"No",width:"60",align:"center"},{default:h(m=>[l("span",null,V(f.value+m.$index),1)]),_:1}),a(s(b),{prop:"level",label:"Level",width:"170",sortable:""}),a(s(b),{prop:"parent",label:"Parent",width:"170",sortable:""}),a(s(b),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:h(m=>[l("span",null,V(s(H)(m.row.startDate)),1)]),_:1}),a(s(b),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""},{default:h(m=>[l("span",null,V(s(H)(m.row.endDate)),1)]),_:1}),a(s(b),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),a(s(b),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:h(m=>[l("div",he,[a(c,{src:m.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),nt=t=>(Bt("data-v-1d591d40"),t=t(),Vt(),t),De=nt(()=>l("div",{class:"text-center"},null,-1)),me=nt(()=>l("div",{class:"mb-3"},[l("span",null,[U(" Download template "),l("a",{href:"documents/MasterDataLevel.xlsx",target:"_blank",id:"link-download"},"here"),U(" before uploading file ")])],-1)),ge=nt(()=>l("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[l("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),ve={class:"card"},fe={class:"card-body grid-padding"},_e={class:"dialog-footer"},Se=R({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:d}){const e=t,f=d,o=et(),n=rt(),p=W(e,"visibility"),c=()=>{const r=zt(n.validatedData,D=>{const i=D;return{levelId:0,level:i.level,parent:i.parent,startDate:i.startDate,endDate:i.endDate}});return Object.values(r)},m=()=>{const r=document.getElementById("link-download");r&&r.click()},E=()=>{n.validatedData.length>0?j("Cancel Upload Data?","Confirm").then(D=>{D.isConfirmed&&_()}):_()},y=async r=>{await n.upload({userAccount:o.user.Name,excelFile:r}),n.stateError&&z(n.error)},_=(r=!1)=>{n.resetState(),f("handle-close",r)},g=r=>{n.setIsUploadedState(r)},P=r=>{n.setPage(r)},T=()=>{if(n.validatedData.length<1){m();return}const r=["LEVEL","PARENT","START DATE","END DATE","REMARK","STATUS"],D=n.validatedData.map(i=>({level:i.level,parent:i.parent,startDate:H(i.startDate),endDate:H(i.endDate),remark:i.validationReason,status:i.isValid?"OK":"Error"}));yt("Level",r,D)},F=async()=>{if(n.displayData.length<1){z("There is no data to submit");return}if(n.isError){z("There is still invalid row(s)");return}j("Are you sure you want to submit ?").then(async r=>{if(r.isConfirmed){const D=c();if(n.setBulkData(D),await n.bulkInsert(o.user.Name),n.isError){z(n.stateError);return}at("Form has been successfully submitted!","Ok").then(()=>{_(!0)})}})};return(r,D)=>{const i=I("el-button"),u=I("el-dialog"),S=Q("loading");return w(),k(u,{title:"Upload Bulk Data",modelValue:p.value,"onUpdate:modelValue":D[1]||(D[1]=L=>p.value=L),"before-close":E,width:"70%","custom-class":"upload-modal"},{footer:h(()=>[l("div",null,[l("span",_e,[a(i,{type:"success",onClick:T},{default:h(()=>[U("Download")]),_:1}),a(i,{type:"primary",onClick:F},{default:h(()=>[U("Upload")]),_:1}),a(i,{type:"success",onClick:E},{default:h(()=>[U("Cancel")]),_:1})])])]),default:h(()=>[De,me,N(a(qt,{isSubmissionUploadSuccess:s(n).isUploaded,onHandleCloseUploadedFile:E,onHandleUpload:y,onHandleSetIsExcelFileUploaded:g},null,8,["isSubmissionUploadSuccess"]),[[S,s(n).uploadLoading]]),ge,l("div",ve,[l("div",fe,[a(pe,{"list-data":s(n).displayData,page:s(n).pagination.currentPage},null,8,["list-data","page"])])]),s(n).displayData.length>0?(w(),k(ct,{key:0,onRaisePageChange:D[0]||(D[0]=L=>P(L)),currentPage:s(n).pagination.currentPage,totalPage:s(n).pagination.totalPage,totalPageSize:s(n).pagination.totalPageSize,startPaginationIndex:s(n).pagination.startPaginationIndex,endPaginationIndex:s(n).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):Z("",!0)]),_:1},8,["modelValue"])}}}),Ee=Mt(Se,[["__scopeId","data-v-1d591d40"]]),Pe={class:"row g-9 my-4"},ye={class:"w-100 fv-row fv-plugins-icon-container"},be={class:"w-100 fv-row fv-plugins-icon-container"},Le={class:"w-100 fv-row fv-plugins-icon-container"},we={class:"w-100 fv-row fv-plugins-icon-container"},Fe={class:"dialog-footer"},Te=R({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:d}){const e=ot(),f=t,o=d,n=W(f,"visibility"),p=x(()=>e.filterData),c=()=>{m(),e.resetFilter()},m=()=>{o("handle-close",!1)},E=i=>{e.setLevel(i)},y=i=>{e.setParent(i)},_=i=>{e.setLevelTo(i)},g=i=>{e.setParentTo(i)},P=i=>{e.setStartDate(i)},T=i=>{e.setStartDateTo(i)},F=i=>{e.setEndDate(i)},r=i=>{e.setEndDateTo(i)},D=()=>{const i=e.lastUsedFilterData.Level!==e.filterData.Level,u=e.lastUsedFilterData.Parent!==e.filterData.Parent,S=e.lastUsedFilterData.LevelTo!==e.filterData.LevelTo,L=e.lastUsedFilterData.ParentTo!==e.filterData.ParentTo,v=e.lastUsedFilterData.StartDate!==e.filterData.StartDate,$=e.lastUsedFilterData.StartDateTo!==e.filterData.StartDateTo,A=e.lastUsedFilterData.EndDate!==e.filterData.EndDate,ft=e.lastUsedFilterData.EndDateTo!==e.filterData.EndDateTo;o("handle-close",i||u||S||L||v||$||A||ft)};return(i,u)=>{const S=I("el-button"),L=I("el-dialog");return w(),k(L,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=v=>n.value=v),title:"Filter",width:"60%",onClose:u[1]||(u[1]=v=>m())},{footer:h(()=>[l("span",Fe,[a(S,{type:"secondary",onClick:c},{default:h(()=>[U("Reset")]),_:1}),a(S,{type:"primary",onClick:D},{default:h(()=>[U("Filter")]),_:1})])]),default:h(()=>[l("div",Pe,[l("div",ye,[a(lt,{"value-from":p.value.Level,"value-to":p.value.LevelTo,label:"Level",name:"Level",options:s(e).levelOption,onHandleChangeFrom:E,onHandleChangeTo:_},null,8,["value-from","value-to","options"])]),l("div",be,[a(lt,{"value-from":p.value.Parent,"value-to":p.value.ParentTo,label:"Parent",name:"Parent",options:s(e).parentOption,onHandleChangeFrom:y,onHandleChangeTo:g},null,8,["value-from","value-to","options"])]),l("div",Le,[a(dt,{"value-from":p.value.StartDate,"value-to":p.value.StartDateTo,label:"Start Date",onHandleChangeFrom:P,onHandleChangeTo:T},null,8,["value-from","value-to"])]),l("div",we,[a(dt,{"value-from":p.value.EndDate,"value-to":p.value.EndDateTo,label:"End Date",onHandleChangeFrom:F,onHandleChangeTo:r},null,8,["value-from","value-to"])])])]),_:1},8,["modelValue"])}}}),Ce={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},ke=l("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),Ue={class:"d-flex justify-content-between align-items-center"},Ie={class:"card"},xe={class:"card-body grid-padding"},$e={class:"my-5"},Na=R({__name:"Index",setup(t){const d=_t(),e=ot(),f=tt(),o=rt(),n=q(!1),p=q(!1),c=q(!1),m=q(!1),E=x(()=>e.displayData),y=x(()=>e.pagination),_=v=>{e.setPage(v)};Ot(async()=>{d.dispatch(Et.ACTIVE_PAGE,"IronLake"),St("Level",[{pageName:"Iron Lake",pageRoute:"ironlake"},{pageName:"Equipment",pageRoute:"level"},{pageName:"Level",pageRoute:"level"}]),e.setPage(1),await e.getLookup()}),Rt(()=>{e.resetState(),f.resetState(),o.resetState()});const g=async()=>{await e.setPage(1),await e.getLookup()},P=()=>{n.value=!0},T=async v=>{n.value=!1,v&&await g()},F=()=>{p.value=!0},r=async v=>{p.value=!1,v&&await g()},D=()=>{c.value=!0},i=async v=>{c.value=!1,v&&await g()},u=async()=>{const v=await e.export();jt.saveAs(new Blob([v],{type:"application/octet-stream"}),"Level.xlsx")},S=()=>{m.value=!0},L=async v=>{m.value=!1,v&&await g()};return(v,$)=>(w(),M(Ht,null,[l("div",Ce,[ke,l("div",Ue,[a(bt,{onShowDialog:P}),a(Pt,{onShowDialog:D}),a(wt,{onHandleDownload:u}),a(Lt,{onShowDialog:S})])]),l("div",Ie,[l("div",xe,[a(Qt,{"list-data":E.value,page:y.value.currentPage,onShowDialog:F},null,8,["list-data","page"])])]),l("div",$e,[s(e).paginationLoading?Z("",!0):(w(),k(ct,{key:0,onRaisePageChange:$[0]||($[0]=A=>_(A)),currentPage:y.value.currentPage,totalPage:y.value.totalPage,totalPageSize:y.value.totalPageSize,startPaginationIndex:y.value.startPaginationIndex,endPaginationIndex:y.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),a(oe,{visibility:n.value,onHandleClose:T},null,8,["visibility"]),a(ue,{visibility:p.value,onHandleClose:r},null,8,["visibility"]),a(Te,{visibility:c.value,onHandleClose:i},null,8,["visibility"]),a(Ee,{visibility:m.value,onHandleClose:L},null,8,["visibility"])],64))}});export{Na as default};
