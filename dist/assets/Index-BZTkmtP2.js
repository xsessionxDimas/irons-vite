import{b as ye,s as Ve,u as Ae,e as Wt,p as $a,a as xa,g as Qe,k as La,q as Na,i as Ua,h as Ba,v as ja,c as Fa,G as Ha}from"./index-BCnwA6yE.js";import{k as re,r as _,p as n,aa as h,aB as e,O as fa,u as K,b5 as qa,aU as Ka,bL as ct,q as ee,x as F,K as ze,R as G,C as g,$ as Ne,F as de,s as f,B as he,c as S,b6 as bt,v as Ga,P as xe,bd as Je,bb as We,y as ue,z as ut,b4 as be,a0 as it,d as Ze,o as St,L as jt,Y as He,A as Z,l as Ot,M as Rt,aG as Ft,T as za,a7 as ya}from"./@vue-BypzYtbH.js";import{A as Ja,M as Wa}from"./PbiEmbeddedEnums-BaTTPSF0.js";import{p as pt}from"./powerbi-client-BGzjSA60.js";import{u as ba}from"./vuex-BbOKrtVp.js";import{f as Xt,n as Yt,A as Za,k as Xa,d as Ya}from"./date-format-BASVuupi.js";import{o as Qa}from"./vue-router-iNp9kJ0K.js";import{a as es,g as ta,b as aa}from"./utils-CryoXyYA.js";import{d as Ht}from"./pinia-BjOS2_Ao.js";import{a as Nt}from"./mapOption-sP4IrA4W.js";import{_ as ts,u as It,a as as,b as ss,s as Pt,c as _a,d as Ca,e as qt,m as _t}from"./ImagePreview.vue_vue_type_style_index_0_lang-BRUqW0pM.js";import{d as os,i as is,b as ls,e as Ct,f as wt,h as kt}from"./helpers-Cten3vIM.js";import{u as ns}from"./vue3-dropzone-DPWU9yJt.js";import{C as rs}from"./simple-vue-camera-DOdFkPrQ.js";import{a as sa,_ as ot,b as cs}from"./element-plus-C5R56mia.js";import{V as us}from"./vue-drawing-canvas-CzCJUKem.js";import{_ as Be}from"./nw-img-vue-CR837WER.js";import{e as ht,_ as wa}from"./lodash-Cr9vlq0V.js";import{b as ka}from"./@vueuse-MfruhCTE.js";import{_ as ds}from"./image-close-button-red-B1UxWyBV.js";import{i as oa}from"./internet-connection-B91-AJht.js";import{c as ms,b as ps,a as hs}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{_ as Mt}from"./ElementTextInput.vue_vue_type_style_index_0_lang-kzHysIyZ.js";import{_ as gs}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as vs}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{E as fs}from"./ErrorAlert-CMKGfwAi.js";import{G as ys,a as bs,b as _s,P as Cs}from"./urls-De-ebYNz.js";import{_ as Ut}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./moment-C5S46NFB.js";import"./urls-Cljsxeb-.js";import"./authentication-handler-B3K6P3Fb.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-DhbZvGod.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./vue-PpIDhVd-.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";const Bt="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/3dp_hornet/lookup",ws="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_3dp_hornet/get_3dp_sensor",ks="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_3dp_hornet/submit_intervention",ia={site:"",model:"",equipment:"",component:[],ver:"v1"},Ss={site:!1,model:!1,equipment:!1,component:!1},Qt=Ht({id:"summaryIntervention",state:()=>({stateIsFromEquipment:!1,stateIsFromIntervention:!1,stateFilter:ia,stateFilterLoading:{...Ss},stateIsError:!1,stateErrors:[],stateSiteOption:[],stateModelOption:[],stateEquipmentOption:[],stateComponentOption:[],stateSensorDataTotal:-1,stateIsSensorSelectAll:!0,stateRerenderSensorList:!0,stateSensorPaginate:{page:1,pagesize:20,lastPage:-1,list:[]},stateLoadingSensor:!1,stateLoadingUpdate:!1}),getters:{filter:t=>t.stateFilter,errors:t=>t.stateErrors,isError:t=>t.stateIsError,filterLoading:t=>t.stateFilterLoading,siteOption:t=>t.stateSiteOption,modelOption:t=>t.stateModelOption,equipmentOption:t=>t.stateEquipmentOption,componentOption:t=>t.stateComponentOption,rerenderSensorList:t=>t.stateRerenderSensorList,sensorDataList:t=>t.stateSensorPaginate.list,sensorDataLastPage:t=>t.stateSensorPaginate.lastPage,sensorDataCurrentPage:t=>t.stateSensorPaginate.page,loadingSensor:t=>t.stateLoadingSensor,isSensorSelectAll:t=>t.stateIsSensorSelectAll,loadingUpdate:t=>t.stateLoadingUpdate},actions:{setFilterSite(t){this.stateFilter.site=t},setFilterModel(t){this.stateFilter.model=t},setFilterEquipment(t){this.stateFilter.equipment=t},setFilterComponent(t){this.stateFilter.component=t},setLoadingSensor(t){this.stateLoadingSensor=t},async getSiteLookup(){this.stateFilterLoading.site=!0;const t={ver:"v1"};try{const s=await ye.get(Bt,"",new URLSearchParams(t).toString());this.stateSiteOption=Nt(s.data.result.content.site.siteDescription)}catch(s){Ve("IRONS",s),console.log(s)}this.stateFilterLoading.site=!1},async getModelLookup(){this.stateFilterLoading.model=!0;const t={ver:"v1",site:this.stateFilter.site};try{const s=await ye.get(Bt,"",new URLSearchParams(t).toString());this.stateModelOption=Nt(s.data.result.content.model.equipmentModel)}catch(s){Ve("IRONS",s),console.log(s)}this.stateFilterLoading.model=!1},async getEquipmentLookup(){this.stateFilterLoading.equipment=!0;const t={ver:"v1",site:this.stateFilter.site,model:this.stateFilter.model};try{const s=await ye.get(Bt,"",new URLSearchParams(t).toString());this.stateEquipmentOption=Nt(s.data.result.content.equipment.equipmentNumber)}catch(s){Ve("IRONS",s),console.log(s)}this.stateFilterLoading.equipment=!1},async getComponentLookup(){this.stateFilterLoading.component=!0;const t={ver:"v1",site:this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment};try{const s=await ye.get(Bt,"",new URLSearchParams(t).toString());this.stateComponentOption=Nt(s.data.result.content.component.componentDescription)}catch(s){Ve("IRONS",s),console.log(s)}this.stateFilterLoading.component=!1},async getSensorDataListPaginate(t=void 0){if(!t)this.stateSensorPaginate.page=0;else{if(t=="prev"&&this.stateSensorPaginate.page==1)return;if(t=="next"&&this.stateSensorPaginate.lastPage!=-1&&this.stateSensorDataTotal!=-1&&this.stateSensorPaginate.page==this.stateSensorPaginate.lastPage){console.warn("[summary intervention state]: nextpage is unavailable");return}}return t=="prev"?this.stateSensorPaginate.page--:this.stateSensorPaginate.page++,this.stateRerenderSensorList=!1,this.getSensorDataList({page:this.stateSensorPaginate.page,pagesize:this.stateSensorPaginate.pagesize}).then(s=>{console.log("[sensor-data]:",this.stateSensorPaginate.page,s);let a=s;return!this.stateIsSensorSelectAll&&this.stateSensorPaginate.list.length!=0&&(a=s.map(i=>{const o=i;return o.isCheck=!1,o})),t=="next"?this.stateSensorPaginate.list.push(...a):this.stateSensorPaginate.list.unshift(...a),this.stateSensorPaginate.lastPage=Math.ceil(this.stateSensorDataTotal/this.stateSensorPaginate.pagesize)||-1,s}).finally(()=>{this.stateRerenderSensorList=!0})},async getSensorDataList(t){this.stateLoadingSensor=!0;const s={ver:"v1"},a={site:(t==null?void 0:t.site)||this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment,component:this.stateFilter.component,page:String((t==null?void 0:t.page)||1),pagesize:String((t==null?void 0:t.pagesize)||100)};return ye.post(`${ws}?${new URLSearchParams(s).toString()}`,a).then(i=>{const o=i.data.result.content;return this.stateSensorDataTotal=i.data.result.total,o}).catch(i=>(Ve("IRONS",i),console.error(i),Promise.reject(i))).finally(()=>{this.stateLoadingSensor=!1})},setReRenderSensorSelection(t){this.stateRerenderSensorList=t},updateSensorDataList(t){this.stateSensorPaginate.list.forEach(s=>{const a=t.findIndex(i=>i.sensorId==s.sensorId);s.isCheck=a!=-1})},async updateIntervention(t){this.stateLoadingUpdate=!0;try{const s={userAccount:t,ver:"v1"},a={site:this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment,component:this.stateFilter.component,sensor:this.generatePayloadSensor(),isCheckAllSensor:this.isSensorSelectAll},i=await ye.post(`${ks}?${new URLSearchParams(s).toString()}`,a);i.data.title==="Error"?(this.stateErrors.push(i.data.result.message),this.stateIsError=!0):(this.stateErrors=[],this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&Ae().setLoggedIn(!1),Ve("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}this.stateLoadingUpdate=!1},generatePayloadSensor(){let t;return this.stateIsSensorSelectAll?t=this.stateSensorPaginate.list.filter(s=>s.isCheck==!1):t=this.stateSensorPaginate.list.filter(s=>s.isCheck==!0),t.map(s=>s.sensorId)},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setParam(t){this.stateFilter.site=t.site,this.stateFilter.model=t.model,this.stateFilter.equipment=t.equipment,this.stateFilter.component=t.component},setIsSensorSelectAll(t){this.stateIsSensorSelectAll=t},resetParam(){this.stateFilter={...ia}},resetList(){this.stateRerenderSensorList=!1,this.stateSensorPaginate={page:1,pagesize:20,list:[],lastPage:-1},this.stateRerenderSensorList=!0},resetErrors(){this.stateErrors=[],this.stateIsError=!1}}}),Is=["accept"],Ds=re({__name:"DropzoneUploader",props:{isMultiple:{type:Boolean,required:!0,default:!0},acceptedFile:{required:!1,type:String,default:"*/*"}},emits:["onFileDropped","onFileCancelled"],setup(t,{expose:s,emit:a}){const i=t,o=_(os(15)),l=a,c=async V=>{l("onFileDropped",V);const b=document.getElementsByClassName(o.value)[0];b.value=null},r=()=>{l("onFileCancelled",null)},{getRootProps:d,getInputProps:p}=ns({onDrop:c,onFileDialogCancel:r,multiple:i.isMultiple});return s({openUploadDialog:()=>{const V=document.getElementsByClassName(o.value)[0];V==null||V.click()}}),(V,b)=>(n(),h("div",qa(Ka(K(d)())),[e("input",fa({class:o.value},K(p)(),{accept:t.acceptedFile}),null,16,Is)],16))}}),Es={class:"row pt-3 pb-3 text-dark modal-title"},Ms={class:"row text-center pt-5"},As=re({__name:"UploadImageFailureDialog",props:{show:{type:Boolean,required:!0},imageList:{default:()=>[]},fileType:{default:"image",type:String}},emits:["close"],setup(t,{emit:s}){const a=t,i=s,o=ct(()=>a.show),l=ct(()=>a.fileType?a.fileType:"image"),c=()=>{i("close")},r=ct(()=>is(l.value)?"an":"a");return(d,p)=>{const C=G("el-button"),V=G("el-dialog");return n(),ee(V,{modelValue:K(o),"onUpdate:modelValue":p[0]||(p[0]=b=>ze(o)?o.value=b:null),width:"40%","show-close":!1,"custom-class":"oil-not-in-range__header",top:"30vh",center:!0,"close-on-click-modal":!1,"close-on-press-escape":!1},{default:F(()=>[e("div",Es,[e("h3",null,"Cannot Upload these following files, make sure the uploaded file is "+g(K(r))+" "+g(K(l))+" file",1),(n(!0),h(de,null,Ne(t.imageList,b=>(n(),h("h4",{class:"pt-2",key:b},"â— "+g(b),1))),128))]),e("div",Ms,[f(C,{type:"success",class:"ok-button",onClick:c},{default:F(()=>[he("Ok")]),_:1})])]),_:1},8,["modelValue"])}}}),Ps=e("span",{class:"el-dialog__title",style:{"word-break":"break-word !important"}},"Are you sure want to add description on this photo?",-1),Os={class:"mt-1 py-2",style:{"word-break":"break-word !important"}},Rs={class:"d-flex flex-column"},Vs={class:"row pt-5 justify-content-end"},Ts={class:"col-md-2 col-2"},$s={class:"row px-0 justify-content-end px-1"},xs={class:"col-md-3 col-lg-2 col-3"},Ls={class:"row px-0 justify-content-end px-1"},Ns=re({__name:"PhotoDescription",props:{isVisible:{type:Boolean,required:!0},description:{type:String,required:!0}},emits:["onClose","onSaveDesc"],setup(t,{emit:s}){const a=t,i=s,o=_(""),l=S(()=>a.isVisible),c=C=>{o.value=C.value},r=()=>{i("onSaveDesc",o.value)},d=()=>{i("onClose")},p=()=>{console.log(a.description),o.value=a.description};return(C,V)=>{const b=G("el-button"),x=G("el-dialog");return n(),ee(x,{modelValue:l.value,"onUpdate:modelValue":V[0]||(V[0]=w=>l.value=w),width:"50%",center:"","custom-class":"outer-dialog","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,onOpen:p,"destroy-on-close":""},{title:F(()=>[Ps]),default:F(()=>[e("div",null,[e("div",Os,[e("div",Rs,[f(ts,{value:o.value,label:"Description",name:"Description",onHandleChange:c},null,8,["value"])])]),e("div",Vs,[e("div",Ts,[e("div",$s,[f(b,{style:{"background-color":"white",color:"black",border:"1px solid gainsboro"},onClick:d},{default:F(()=>[he("No")]),_:1})])]),e("div",xs,[e("div",Ls,[f(b,{disabled:o.value=="",type:"success",class:"ok-button",onClick:r},{default:F(()=>[he("Submit")]),_:1},8,["disabled"])])])])])]),_:1},8,["modelValue"])}}}),Us={class:"button-ring"},Bs=re({__name:"CameraCircleButton",props:{bgColor:{}},emits:["buttonClick"],setup(t,{emit:s}){const a=s,i=()=>{a("buttonClick")};return(o,l)=>(n(),h("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(i,["prevent"])},[e("div",Us,[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center tools-camera",style:bt([{width:"100%",height:"100%"},`
        background-color: ${o.bgColor};
      `])},[Ga(o.$slots,"default",{},void 0,!0)],4)])]))}}),At=Be(Bs,[["__scopeId","data-v-30406573"]]),la=[15,10,5,0],Sa="orange",js=t=>(Je("data-v-f2caf9cb"),t=t(),We(),t),Fs={class:"d-flex jusitfy-content-between gap-2 timer-option-container"},Hs={key:0,xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"-4 -2 30 30",fill:"none"},qs=js(()=>e("path",{fill:"white",d:"M24 12c0 6.627-5.373 12-12 12s-12-5.373-12-12h2c0 5.514 4.486 10 10 10s10-4.486 10-10-4.486-10-10-10c-2.777 0-5.287 1.141-7.099 2.977l2.061 2.061-6.962 1.354 1.305-7.013 2.179 2.18c2.172-2.196 5.182-3.559 8.516-3.559 6.627 0 12 5.373 12 12zm-13-6v8h7v-2h-5v-6h-2z"},null,-1)),Ks=[qs],Gs={key:1,class:"text-white timer-label"},zs=re({__name:"CameraTimerOption",props:{timerOption:{},selectedTimer:{}},emits:["selectTimer"],setup(t,{emit:s}){const a=s,i=o=>{a("selectTimer",o)};return(o,l)=>(n(),h("div",Fs,[(n(!0),h(de,null,Ne(o.timerOption,c=>(n(),ee(At,{key:c,onClick:r=>i(c),bgColor:c!=0&&o.selectedTimer==c?K(Sa):""},{default:F(()=>[c==0?(n(),h("svg",Hs,Ks)):(n(),h("div",Gs,g(c),1))]),_:2},1032,["onClick","bgColor"]))),128))]))}}),na=Be(zs,[["__scopeId","data-v-f2caf9cb"]]),Js=["innerHTML"],Ws={class:"dialog-footer",style:{display:"block","text-align":"right"}},Ia=re({__name:"CameraConfirmation",props:{visibility:{required:!0,type:Boolean},caption:{required:!0,type:String},yesLabel:{default:"Yes"},noLabel:{default:"No"},yesButtonBackroundColor:{default:"#18AF4A"},showCancelButton:{default:!0},isReplacement:{default:!1},btnColorNo:{required:!1,default:""},btnColorYes:{required:!1,default:""}},emits:["onNoConfirm","onYesConfirm"],setup(t,{emit:s}){const a=t,i=s,o=S(()=>a.visibility),l=S(()=>a.btnColorNo?a.btnColorNo:"background-color: #18AF4A; color: white;"),c=S(()=>a.btnColorYes?a.btnColorYes:""),r=()=>{i("onNoConfirm")},d=()=>{i("onYesConfirm")};return(p,C)=>{const V=G("el-button"),b=G("el-dialog");return n(),ee(b,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=x=>o.value=x),center:"",top:"30vh","close-on-click-modal":!1,"show-close":!1,"custom-class":"confirmation","append-to-body":""},{footer:F(()=>[e("span",Ws,[ue(f(V,{onClick:r,style:bt([{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"},[l.value]])},{default:F(()=>[he(g(t.noLabel),1)]),_:1},8,["style"]),[[ut,a.showCancelButton]]),f(V,{onClick:xe(d,["prevent"]),style:bt([{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"},[c.value]])},{default:F(()=>[he(g(t.yesLabel),1)]),_:1},8,["style"])])]),default:F(()=>[e("span",{class:be(["caption",[t.isReplacement?"text-normal":""]]),innerHTML:t.caption},null,10,Js)]),_:1},8,["modelValue"])}}}),Ie=t=>(Je("data-v-fea7bbf3"),t=t(),We(),t),Zs={"element-loading-text":"Opening Camera","element-loading-background":"rgba(0, 0, 0, 0.7)",class:"d-flex",style:{position:"fixed",top:"0",left:"0","z-index":"11",width:"100%",height:"100%",background:"rgba(22, 28, 36, 1)"}},Xs={key:0,class:"d-flex flex-column justify-content-center align-items-end camera-container",style:{height:"100%"}},Ys={key:0,class:"h-100 text-center d-flex align-items-center justify-content-center timer-container"},Qs={class:"timer-label"},eo={key:1,class:"d-flex flex-column justify-content-center align-items-center camera-tools-container",style:{position:"relative"}},to=Ie(()=>e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M24.4 7.61334C23.88 7.09334 23.04 7.09334 22.52 7.61334L16 14.12L9.48 7.60001C8.96 7.08001 8.12 7.08001 7.6 7.60001C7.08 8.12001 7.08 8.96001 7.6 9.48001L14.12 16L7.6 22.52C7.08 23.04 7.08 23.88 7.6 24.4C8.12 24.92 8.96 24.92 9.48 24.4L16 17.88L22.52 24.4C23.04 24.92 23.88 24.92 24.4 24.4C24.92 23.88 24.92 23.04 24.4 22.52L17.88 16L24.4 9.48001C24.9067 8.97334 24.9067 8.12001 24.4 7.61334Z",fill:"white"})],-1)),ao={key:2,class:"d-flex flex-column justify-content-center align-items-center camera-tools-container",style:{position:"relative"}},so=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center close-camera",style:{width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M24.4 7.61334C23.88 7.09334 23.04 7.09334 22.52 7.61334L16 14.12L9.48 7.60001C8.96 7.08001 8.12 7.08001 7.6 7.60001C7.08 8.12001 7.08 8.96001 7.6 9.48001L14.12 16L7.6 22.52C7.08 23.04 7.08 23.88 7.6 24.4C8.12 24.92 8.96 24.92 9.48 24.4L16 17.88L22.52 24.4C23.04 24.92 23.88 24.92 24.4 24.4C24.92 23.88 24.92 23.04 24.4 22.52L17.88 16L24.4 9.48001C24.9067 8.97334 24.9067 8.12001 24.4 7.61334Z",fill:"white"})])])],-1)),oo=[so],io=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center tools-camera",style:{background:"rgba(255, 72, 66, 1)",width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M26.6667 6.66667H22.44L20 4H12L9.56 6.66667H5.33333C3.86667 6.66667 2.66667 7.86667 2.66667 9.33333V25.3333C2.66667 26.8 3.86667 28 5.33333 28H26.6667C28.1333 28 29.3333 26.8 29.3333 25.3333V9.33333C29.3333 7.86667 28.1333 6.66667 26.6667 6.66667ZM26.6667 25.3333H5.33333V9.33333H10.7333L13.1733 6.66667H18.8267L21.2667 9.33333H26.6667V25.3333ZM16 10.6667C12.32 10.6667 9.33333 13.6533 9.33333 17.3333C9.33333 21.0133 12.32 24 16 24C19.68 24 22.6667 21.0133 22.6667 17.3333C22.6667 13.6533 19.68 10.6667 16 10.6667ZM16 21.3333C13.8 21.3333 12 19.5333 12 17.3333C12 15.1333 13.8 13.3333 16 13.3333C18.2 13.3333 20 15.1333 20 17.3333C20 19.5333 18.2 21.3333 16 21.3333Z",fill:"white"})])])],-1)),lo=[io],no=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center tools-camera",style:{width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M29.3333 21.3334V5.33335C29.3333 3.86669 28.1333 2.66669 26.6667 2.66669H10.6667C9.2 2.66669 8 3.86669 8 5.33335V21.3334C8 22.8 9.2 24 10.6667 24H26.6667C28.1333 24 29.3333 22.8 29.3333 21.3334ZM15.2 16.7067L17.3733 19.6134L20.8133 15.32C21.08 14.9867 21.5867 14.9867 21.8533 15.32L25.8 20.2534C26.1467 20.6934 25.84 21.3334 25.28 21.3334H12C11.4533 21.3334 11.1333 20.7067 11.4667 20.2667L14.1333 16.7067C14.4 16.36 14.9333 16.36 15.2 16.7067ZM2.66667 9.33335V26.6667C2.66667 28.1334 3.86667 29.3334 5.33333 29.3334H22.6667C23.4 29.3334 24 28.7334 24 28C24 27.2667 23.4 26.6667 22.6667 26.6667H6.66667C5.93333 26.6667 5.33333 26.0667 5.33333 25.3334V9.33335C5.33333 8.60002 4.73333 8.00002 4 8.00002C3.26667 8.00002 2.66667 8.60002 2.66667 9.33335Z",fill:"white"})])])],-1)),ro=[no],co=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center tools-camera",style:{width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M26.6667 6.66667H22.44L20.7867 4.86667C20.2933 4.32 19.5733 4 18.8267 4H13.1733C12.4267 4 11.7067 4.32 11.2 4.86667L9.56 6.66667H5.33333C3.86667 6.66667 2.66667 7.86667 2.66667 9.33333V25.3333C2.66667 26.8 3.86667 28 5.33333 28H26.6667C28.1333 28 29.3333 26.8 29.3333 25.3333V9.33333C29.3333 7.86667 28.1333 6.66667 26.6667 6.66667ZM18.2267 23.6C17.5333 23.8533 16.7867 24 16 24C12.32 24 9.33333 21.0133 9.33333 17.3333H6.66667L10 14L13.3333 17.3333H10.6667C10.6667 20.28 13.0533 22.6667 16 22.6667C16.6133 22.6667 17.2133 22.56 17.76 22.36C18.0133 22.2667 18.28 22.32 18.4667 22.5067C18.8133 22.8533 18.68 23.4267 18.2267 23.6ZM22 20.6667L18.6667 17.3333H21.3333C21.3333 14.3867 18.9467 12 16 12C15.3867 12 14.7867 12.1067 14.24 12.3067C13.9867 12.4 13.72 12.3467 13.5333 12.16C13.1867 11.8133 13.32 11.24 13.7733 11.0667C14.4667 10.8133 15.2133 10.6667 16 10.6667C19.68 10.6667 22.6667 13.6533 22.6667 17.3333H25.3333L22 20.6667Z",fill:"white"})])])],-1)),uo=[co],mo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"-4 -2 30 30",fill:"none"},po=Ie(()=>e("path",{fill:"white",d:"M24 12c0 6.627-5.373 12-12 12s-12-5.373-12-12h2c0 5.514 4.486 10 10 10s10-4.486 10-10-4.486-10-10-10c-2.777 0-5.287 1.141-7.099 2.977l2.061 2.061-6.962 1.354 1.305-7.013 2.179 2.18c2.172-2.196 5.182-3.559 8.516-3.559 6.627 0 12 5.373 12 12zm-13-6v8h7v-2h-5v-6h-2z"},null,-1)),ho=[po],go={key:1,class:"text-white timer-label"},vo={key:1,class:"preview-container"},fo={class:"d-flex justify-content-center align-items-center",style:{height:"100%"}},yo={key:0,class:"d-flex flex-row gap-4 preview-button-tools"},bo=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center",style:{"background-color":"rgba(157, 154, 154, 0.9)",width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("g",{"clip-path":"url(#clip0_3476_147612)"},[e("path",{d:"M21.3333 9.33334H19.9999L18.6666 8H13.3333L11.9999 9.33334H10.6666C9.19994 9.33334 7.99994 10.5333 7.99994 12V20C7.99994 21.4667 9.19994 22.6667 10.6666 22.6667H21.3333C22.7999 22.6667 23.9999 21.4667 23.9999 20V12C23.9999 10.5333 22.7999 9.33334 21.3333 9.33334ZM15.9999 18.6667C14.5333 18.6667 13.3333 17.4667 13.3333 16C13.3333 14.5333 14.5333 13.3333 15.9999 13.3333C17.4666 13.3333 18.6666 14.5333 18.6666 16C18.6666 17.4667 17.4666 18.6667 15.9999 18.6667Z",fill:"white"}),e("path",{d:"M12.5999 0.373336C12.0666 0.480003 11.8666 1.12 12.2533 1.49334L16.2666 5.50667C16.6933 5.92 17.3999 5.62667 17.3999 5.04V2.72C23.3333 3.30667 28.1466 7.81334 29.1866 13.6133C29.2933 14.2267 29.8533 14.6533 30.4799 14.6533C31.3066 14.6533 31.9333 13.8933 31.7866 13.08C30.1466 3.85334 21.0533 -1.49333 12.5999 0.373336Z",fill:"white"}),e("path",{d:"M15.7333 26.4933C15.3066 26.0667 14.5999 26.3733 14.5999 26.96V29.28C8.66661 28.6933 3.85327 24.1867 2.81327 18.3867C2.70661 17.7733 2.14661 17.3467 1.51994 17.3467C0.693273 17.3467 0.0666066 18.1067 0.213273 18.92C1.86661 28.1467 10.9599 33.4933 19.4133 31.6267C19.9333 31.5067 20.1466 30.88 19.7599 30.4933L15.7333 26.4933Z",fill:"white"})]),e("defs",null,[e("clipPath",{id:"clip0_3476_147612"},[e("rect",{width:"32",height:"32",fill:"white"})])])])])],-1)),_o=Ie(()=>e("div",{class:"text-white"},"Retake Photo",-1)),Co=[bo,_o],wo=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center",style:{"background-color":"rgba(33, 43, 54, 1)",width:"100%",height:"100%"}},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",fill:"white"},[e("path",{d:"M27.1666 2.66669H5.83329C4.36663 2.66669 3.17996 3.86669 3.17996 5.33335L3.16663 29.3334L8.49996 24H27.1666C28.6333 24 29.8333 22.8 29.8333 21.3334V5.33335C29.8333 3.86669 28.6333 2.66669 27.1666 2.66669ZM27.1666 21.3334H7.39329L5.83329 22.8934V5.33335H27.1666V21.3334ZM14.5 18.6667H24.5V16H17.1666L14.5 18.6667ZM19.6466 10.84C19.9133 10.5734 19.9133 10.16 19.6466 9.89335L17.2866 7.53335C17.02 7.26669 16.6066 7.26669 16.34 7.53335L8.49996 15.3734V18.6667H11.7933L19.6466 10.84Z",fill:"white"})])])],-1)),ko=Ie(()=>e("div",{class:"text-white"},"Add Description",-1)),So=[wo,ko],Io=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center",style:{"background-color":"rgba(33, 43, 54, 1)",width:"100%",height:"100%"}},[e("svg",{viewBox:"0 0 32 32",fill:"white",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32"},[e("path",{d:"M25.47 13.8533L26.8833 12.44C27.9233 11.4 27.9233 9.70667 26.8833 8.66667L25.0033 6.78667C23.9633 5.74667 22.27 5.74667 21.23 6.78667L19.8167 8.2L25.47 13.8533ZM19.8167 15.7467L10.2167 25.3333H8.33667V23.4533L17.9233 13.8667L19.8167 15.7467ZM17.9233 10.08L5.67 22.3467V28H11.3233L23.5767 15.7467L17.9233 10.08ZM25.67 23.3333C25.67 26.2533 22.2833 28 19.0033 28C18.27 28 17.67 27.4 17.67 26.6667C17.67 25.9333 18.27 25.3333 19.0033 25.3333C21.0567 25.3333 23.0033 24.36 23.0033 23.3333C23.0033 22.7067 22.3633 22.1733 21.3633 21.7333L23.3367 19.76C24.7633 20.6 25.67 21.72 25.67 23.3333ZM6.44334 17.8C5.15 17.0533 4.33667 16.08 4.33667 14.6667C4.33667 12.2667 6.85667 11.16 9.08334 10.1867C10.4567 9.57333 12.3367 8.74667 12.3367 8C12.3367 7.45333 11.2967 6.66667 9.67 6.66667C7.99 6.66667 7.27 7.48 7.23 7.52C6.76334 8.06667 5.92334 8.13333 5.36334 7.68C4.81667 7.22667 4.71 6.41333 5.16334 5.84C5.31 5.65333 6.68334 4 9.67 4C12.6567 4 15.0033 5.76 15.0033 8C15.0033 10.4933 12.43 11.6267 10.15 12.6267C8.89667 13.1733 7.00334 14 7.00334 14.6667C7.00334 15.08 7.57667 15.4667 8.43 15.8133L6.44334 17.8Z",fill:"white"})])])],-1)),Do=Ie(()=>e("div",{class:"text-white"},"Draw Photo",-1)),Eo=[Io,Do],Mo=Ie(()=>e("div",{class:"button-ring"},[e("section",{class:"rounded-circle d-flex justify-content-center align-items-center",style:{"background-color":"rgba(24, 175, 74, 1)",width:"100%",height:"100%"}},[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11.7266 21.1666L7.09996 16.54C6.57996 16.02 5.73996 16.02 5.21996 16.54C4.69996 17.06 4.69996 17.9 5.21996 18.42L10.7933 23.9933C11.3133 24.5133 12.1533 24.5133 12.6733 23.9933L26.78 9.88664C27.3 9.36664 27.3 8.52664 26.78 8.00664C26.26 7.48664 25.42 7.48664 24.9 8.00664L11.7266 21.1666Z",fill:"white"})])])],-1)),Ao=[Mo],Po={key:1,id:"config-wrapper"},Oo={class:"rounded-circle d-flex justify-content-center align-items-center",style:{"background-color":"#18AF4A",width:"100%",height:"100%"}},Ro={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"24",height:"24"},Vo=Ie(()=>e("path",{d:"m12 6.586-8.707 8.707 1.414 1.414L12 9.414l7.293 7.293 1.414-1.414L12 6.586z"},null,-1)),To=[Vo],$o={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"24",height:"24"},xo=Ie(()=>e("path",{d:"M12 17.414 3.293 8.707l1.414-1.414L12 14.586l7.293-7.293 1.414 1.414L12 17.414z"},null,-1)),Lo=[xo],No={class:"flex-fill d-flex flex-row justify-content-between align-items-center"},Uo=Ie(()=>e("p",{class:"m-0 draw-title"},"Draw Photo",-1)),Bo={class:"flex-fill d-flex flex-row justify-content-between align-items-center"},jo={class:"d-flex gap-4"},Fo=Ie(()=>e("svg",{width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"me-1"},[e("path",{d:"M8.31055 5.72211C6.54388 5.72211 4.94388 6.38211 3.71055 7.45544L2.45055 6.19544C2.03055 5.77544 1.31055 6.06877 1.31055 6.66211V10.3888C1.31055 10.7554 1.61055 11.0554 1.97721 11.0554H5.70388C6.29721 11.0554 6.59721 10.3354 6.17721 9.91544L4.90388 8.64211C5.83055 7.86877 7.01055 7.38877 8.31721 7.38877C10.4239 7.38877 12.2439 8.61544 13.1105 10.3888C13.2905 10.7621 13.7172 10.9488 14.1105 10.8154C14.5839 10.6621 14.8239 10.1221 14.6105 9.66877C13.4639 7.33544 11.0772 5.72211 8.31055 5.72211Z",fill:"white"})],-1)),Ho=Ie(()=>e("svg",{width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"me-1"},[e("path",{d:"M12.2857 7.45544C11.0524 6.38211 9.4524 5.72211 7.68574 5.72211C4.9124 5.72211 2.52574 7.33544 1.3924 9.67544C1.17907 10.1221 1.41907 10.6554 1.8924 10.8154C2.28574 10.9488 2.7124 10.7621 2.8924 10.3888C3.75907 8.61544 5.57907 7.38877 7.68574 7.38877C8.98574 7.38877 10.1724 7.86877 11.0991 8.64211L9.82574 9.91544C9.40574 10.3354 9.69907 11.0554 10.2924 11.0554H14.0191C14.3857 11.0554 14.6857 10.7554 14.6857 10.3888V6.66211C14.6857 6.06877 13.9657 5.76877 13.5457 6.18877L12.2857 7.45544Z",fill:"white"})],-1)),qo={class:"d-flex gap-4"},Ko=Ie(()=>e("svg",{width:"16",height:"17",xmlns:"http://www.w3.org/2000/svg",class:"me-1"},[e("path",{d:"M5 9.723c-1.107 0-2 .893-2 2 0 .873-.774 1.333-1.334 1.333.613.814 1.66 1.334 2.667 1.334a2.666 2.666 0 0 0 2.666-2.667c0-1.107-.893-2-2-2Zm9.14-6.247-.894-.893a.664.664 0 0 0-.94 0L6.333 8.556l1.833 1.834 5.973-5.974c.26-.26.26-.68 0-.94Z"})],-1)),Go=Ie(()=>e("svg",{width:"16",height:"17",viewBox:"0 0 16 17",xmlns:"http://www.w3.org/2000/svg",class:"me-1"},[e("path",{d:"M13.5365 4.4888L13.8632 3.78214L14.5699 3.45547C14.8299 3.33547 14.8299 2.9688 14.5699 2.8488L13.8632 2.52214L13.5365 1.82214C13.4165 1.56214 13.0499 1.56214 12.9299 1.82214L12.6032 2.5288L11.9032 2.85547C11.6432 2.97547 11.6432 3.34214 11.9032 3.46214L12.6099 3.7888L12.9365 4.4888C13.0499 4.7488 13.4232 4.7488 13.5365 4.4888Z"}),e("path",{d:"M11.7099 6.5688L9.8232 4.68214C9.5632 4.42214 9.1432 4.42214 8.8832 4.68214L1.42986 12.1288C1.16986 12.3888 1.16986 12.8088 1.42986 13.0688L3.31653 14.9555C3.57653 15.2155 3.99653 15.2155 4.25653 14.9555L11.7032 7.5088C11.9699 7.25547 11.9699 6.8288 11.7099 6.5688ZM9.37653 7.96214L8.43653 7.02214L9.35653 6.10214L10.2965 7.04214L9.37653 7.96214Z"})],-1)),zo={class:"flex-fill d-flex flex-row align-items-center"},Jo={class:"m-0 me-4",style:{color:"white"}},Wo={class:"m-0 ms-4"},Zo={class:"flex-fill d-flex flex-row justify-content-start gap-4 position-relative"},Xo={style:{display:"none"}},Yo={key:0,class:"d-flex flex-column justify-content-center align-items-end camera-container",style:{height:"100%"}},Qo={key:0,class:"h-100 text-center d-flex align-items-center justify-content-center timer-container"},ei={"data-testid":"timer-countdown",class:"timer-label"},ti={key:1,class:"d-flex flex-column justify-content-center align-items-center camera-tools-container",style:{position:"relative"}},ai=Ie(()=>e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M24.4 7.61334C23.88 7.09334 23.04 7.09334 22.52 7.61334L16 14.12L9.48 7.60001C8.96 7.08001 8.12 7.08001 7.6 7.60001C7.08 8.12001 7.08 8.96001 7.6 9.48001L14.12 16L7.6 22.52C7.08 23.04 7.08 23.88 7.6 24.4C8.12 24.92 8.96 24.92 9.48 24.4L16 17.88L22.52 24.4C23.04 24.92 23.88 24.92 24.4 24.4C24.92 23.88 24.92 23.04 24.4 22.52L17.88 16L24.4 9.48001C24.9067 8.97334 24.9067 8.12001 24.4 7.61334Z",fill:"white"})],-1)),si={key:2,class:"d-flex flex-column justify-content-center align-items-center camera-tools-container",style:{position:"relative"}},oi={key:0,xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"-4 -2 30 30",fill:"none"},ii=Ie(()=>e("path",{fill:"white",d:"M24 12c0 6.627-5.373 12-12 12s-12-5.373-12-12h2c0 5.514 4.486 10 10 10s10-4.486 10-10-4.486-10-10-10c-2.777 0-5.287 1.141-7.099 2.977l2.061 2.061-6.962 1.354 1.305-7.013 2.179 2.18c2.172-2.196 5.182-3.559 8.516-3.559 6.627 0 12 5.373 12 12zm-13-6v8h7v-2h-5v-6h-2z"},null,-1)),li=[ii],ni={key:1,class:"text-white timer-label"},ra=50,ri=re({__name:"Cameras",props:{visibility:{type:Boolean,required:!0}},setup(t){const s=t,a=It(),i=Ae(),o=as(),l=ss(),c=_(),r=_([]),d=_(!1),p=_(""),C=_(null),V=_(!1),b=_(!1),x=_(""),w=_(0),I=_(),R=it(s,"visibility"),$=_(!1),P=_(!1),E=_(0),q=_(0),J=_(null),M=_(!1),v=_(!1),y=_(null),u=_(!1),k=_(!1),U=S(()=>a.ShowCloseButton),O=()=>{V.value=!1,a.toggleIsVisible(!0)},T=S(()=>a.currentImage),m=S(()=>$.value?"collapsed":"expanded"),D=()=>{z.value=!1},Q=Y=>{console.log("camera err",Y),a.setIsCameraError(!0),we.value=!1,k.value=!0},W=()=>{we.value=!1,l.stateConnectionStatus?setTimeout(()=>{z.value=!0},1e3):(se(),l.setSubmitConnectionError(!0))},z=_(!1),ae=S(()=>l.stateSubmitConnectionError),ne=()=>{l.setSubmitConnectionError(!1)},we=_(!1),ke=S(()=>a.isVisible);Ze(ke,Y=>{Y&&(we.value=!0)});const X=()=>{se(),setTimeout(()=>{a.toggleIsVisible(!0)},100)},Pe=()=>{b.value&&(ce(),Oe.value.redraw())};Ze(T,Y=>{Y?(b.value=!0,x.value=Y):(b.value=!1,x.value="")}),St(()=>{window.addEventListener("resize",Pe)}),jt(()=>{window.removeEventListener("resize",Pe)});const qe=_(!1),A=()=>{qe.value=!0,N(),qe.value=!1},N=async()=>{var oe,Me,Re;if(!qe.value)return;const Y=await((oe=c.value)==null?void 0:oe.devices(["videoinput"]));if(!Y)return;const L=Y[w.value];((Me=c.value)==null?void 0:Me.currentDeviceID())!=L.deviceId&&((Re=c.value)==null||Re.changeCamera(L.deviceId)),w.value+1==(Y==null?void 0:Y.length)?w.value=0:w.value=w.value+1},ie=()=>{we.value=!0,b.value=!1,p.value="",a.setImage(""),a.setBlob(void 0),Fe.value=window.innerWidth,at.value=window.innerHeight,P.value=!1,E.value=0};_(0),_(0);let _e,Te;const B=(Y,L,oe,Me)=>{const Re=Math.min(oe/Y,Me/L);return{width:Y*Re,height:L*Re}},ce=()=>{console.log("screen available width",window.innerWidth),console.log("screen available height",window.innerHeight),console.log("picture width on as param",Te),console.log("picture height on as param",_e);const{width:Y,height:L}=B(Te,_e,window.innerWidth,window.innerHeight);console.log("computed width",Y),console.log("computed height",L),console.log("======================================"),Fe.value=Math.floor(Y),at.value=Math.floor(L)},ve=(Y,L)=>{const oe=new Image;oe.src=Y,oe.onload=()=>{window.screen.height>window.screen.width?(console.log("image is taken by camera",L),console.log("original take photo result's height",oe.height),console.log("original take photo result's width",oe.width),_e=L?oe.width:oe.height,Te=L?oe.height:oe.width,ce()):(_e=oe.height,Te=oe.width,ce()),Oe.value.setBackground()}},Ke=(Y,L=!0)=>{const oe=new FileReader;oe.readAsDataURL(Y),oe.onload=()=>{const Me=oe.result;typeof Me=="string"&&ve(Me,L)}},et=async Y=>{r.value=[];const L=sa.service({lock:!0,text:"Uploading",background:"rgba(0, 0, 0, 0.7)"});let oe=!0;if(["image/gif","image/jpeg","image/jpg","image/png"].includes(Y[0].type)||(oe=!1,r.value.push(Y[0].name)),!oe)r.value.length>0&&(V.value=!0);else{Ke(Y[0],!1),I.value=Y[0];const Re=URL.createObjectURL(Y[0]);a.setImage(Re),a.setBlob(Y[0])}L.close()},Xe=()=>{},je=async()=>{z.value&&(E.value>0&&(u.value=!0),H(!1),q.value=E.value,M.value=!0,vt(),y.value=setTimeout(async()=>{var oe;M.value=!1,b.value=!1;const Y=await((oe=c.value)==null?void 0:oe.snapshot());u.value=!1,I.value=Y,Ke(Y);const L=URL.createObjectURL(Y);a.setImage(L),a.setBlob(Y),P.value=!0},E.value*1e3))},vt=()=>{J.value&&clearInterval(J.value),J.value=setInterval(()=>{q.value>0?q.value--:clearInterval(J.value)},1e3)},mt=Y=>{E.value=Y,H(!1)},H=Y=>{v.value=Y},te=()=>{clearTimeout(y.value),clearInterval(J.value),M.value=!1,E.value=0,u.value=!1,q.value=0},me=(Y,L="",oe=512)=>{const Me=atob(Y),Re=[];for(let yt=0;yt<Me.length;yt+=oe){const Et=Me.slice(yt,yt+oe),ge=new Array(Et.length);for(let Lt=0;Lt<Et.length;Lt++)ge[Lt]=Et.charCodeAt(Lt);const Ta=new Uint8Array(ge);Re.push(Ta)}return new Blob(Re,{type:L})},j=async()=>{ft();const Y=sa.service({lock:!0,text:"Uploading Picture",background:"rgba(0, 0, 0, 0.7)"}),L=pe(15),oe=new FormData;let Me=I.value;try{const Ye=await ls(Me);oe.append("files",Ye.file,`${L}.webp`),Me=Ye.file}catch(Ye){console.error(Ye.message),oe.append("files",Me,`${L}.png`)}oe.append("userAccount",i.user.Email);const Re=await o.uploadAttachment(oe,i.user.Email);Re&&Promise.all([Re]).then(()=>{const Ye={filename:L,description:encodeURI(p.value)};a.isReplacementCamera&&(Ye.type=a.replacementPhotoLength==0?"cab side":a.replacementPosition,a.replacementPosition=="cab side"?a.setReplacementPosition("off cab side"):a.setReplacementPosition("cab side"),a.setReplacementPhotoLength(a.replacementPhotoLength+1)),p.value="",a.IsFromActionDelete?a.definePhoto(I.value,Ye):a.addPhoto(I.value,Ye)}),Y.close(),a.setImage(""),a.setBlob(void 0),w.value=0,P.value=!1,le()},pe=Y=>{let L="";const oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Me=oe.length;for(let Re=0;Re<Y;Re++)L+=oe.charAt(Math.floor(Math.random()*Me));return L},fe=()=>{z.value&&C.value&&C.value.openUploadDialog()},Le=()=>{d.value=!0},Ge=()=>{d.value=!1},Ce=Y=>{p.value=Y,d.value=!1},se=(Y=!0)=>{k.value=!1,Y&&a.setIsActionFromDelete(!1),a.toggleIsVisible(!1),E.value=0},le=()=>{se(!1)},Oe=_(),Ue=_(!0),Se=_(""),De=_(!1),tt=_(10),$e=_("rgba(242, 24, 24, 1)"),Ee=_([]),Fe=_(window.innerWidth),at=_(window.innerHeight),nt=S(()=>Fe.value*ra/100),rt=S(()=>at.value*ra/100),zt=()=>{Ue.value=!1},st=Y=>{$e.value=Y},Jt=()=>{Ue.value=!0,Oe.value.reset()},ft=()=>{Ue.value=!0,I.value=me(Se.value.split(",")[1],"image/png")};return(Y,L)=>{const oe=G("el-button"),Me=G("el-slider"),Re=G("el-color-picker"),Ye=G("el-dialog"),yt=G("InformationPopUp"),Et=He("loading");return n(),h(de,null,[f(Ye,{modelValue:R.value,"onUpdate:modelValue":L[21]||(L[21]=ge=>R.value=ge),fullscreen:"","custom-class":"outer-dialog","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},{default:F(()=>[ue((n(),h("div",Zs,[K(a).isVisible&&!b.value?(n(),ee(K(rs),{key:0,ref_key:"cam",ref:c,autoplay:"",onLoading:D,onStarted:W,onCameraChange:N,onError:Q},{default:F(()=>[z.value?(n(),h("div",Xs,[M.value&&q.value!=0?(n(),h("div",Ys,[e("h1",Qs,g(q.value),1)])):Z("",!0),u.value?(n(),h("div",eo,[f(At,{onClick:L[0]||(L[0]=ge=>te())},{default:F(()=>[to]),_:1})])):(n(),h("div",ao,[U.value?(n(),h("div",{key:0,class:"d-flex flex-column align-items-center gap-4",style:{"margin-bottom":"80px"},onClick:L[1]||(L[1]=xe(ge=>se(!0),["prevent"]))},oo)):Z("",!0),e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(je,["prevent"])},lo),e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(fe,["prevent"])},ro),e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(A,["prevent"])},uo),e("div",{style:bt(`visibility: ${v.value?"hidden":"visible"}`)},[f(At,{onClick:L[2]||(L[2]=ge=>H(!v.value)),bgColor:E.value==0?"":K(Sa)},{default:F(()=>[E.value==0?(n(),h("svg",mo,ho)):(n(),h("div",go,g(E.value),1))]),_:1},8,["bgColor"])],4),v.value?(n(),ee(na,{key:1,selectedTimer:E.value,timerOption:K(la),onSelectTimer:mt},null,8,["selectedTimer","timerOption"])):Z("",!0)]))])):Z("",!0)]),_:1},512)):Z("",!0),K(a).isVisible&&b.value?(n(),h("div",vo,[e("div",fo,[f(K(us),{ref_key:"VueCanvasDrawing",ref:Oe,image:Se.value,"onUpdate:image":L[3]||(L[3]=ge=>Se.value=ge),width:Fe.value,height:at.value,"stroke-type":"dash","line-cap":"round","line-join":"round",eraser:De.value,lineWidth:tt.value,color:$e.value,"background-image":x.value,"initial-image":Ee.value,saveAs:"png",lock:Ue.value,"output-width":nt.value,"output-height":rt.value},null,8,["image","width","height","eraser","lineWidth","color","background-image","initial-image","lock","output-width","output-height"])]),e("div",{class:"d-flex flex-row justify-content-center align-items-center button-container",style:bt({backgroundColor:Ue.value?"":"black",bottom:Ue.value?"16px":"0"})},[Ue.value?(n(),h("div",yo,[e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(ie,["prevent"])},Co),e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(Le,["prevent"])},So),e("div",{class:"d-flex flex-column align-items-center gap-4",onClick:xe(zt,["prevent"])},Eo),e("div",{class:"ms-auto d-flex flex-column align-items-center gap-4",onClick:xe(j,["prevent"])},Ao)])):(n(),h("div",Po,[e("button",{class:"collapsible-button small-button-ring",onClick:L[4]||(L[4]=xe(()=>{$.value=!$.value},["stop"]))},[e("section",Oo,[$.value?(n(),h("svg",Ro,To)):(n(),h("svg",$o,Lo))])]),e("div",{class:be(["d-flex flex-column gap-4 draw-image-tools",m.value])},[e("section",No,[f(oe,{class:"btn btn-outline btn-outline-btech-default btech-lg m-0",onClick:xe(Jt,["prevent"])},{default:F(()=>[he(" Cancel ")]),_:1}),Uo,f(oe,{class:"btn btn-btech-primary btech-lg m-0",onClick:xe(ft,["prevent"])},{default:F(()=>[he("Done")]),_:1})]),e("section",Bo,[e("div",jo,[e("p",{class:"tools-item tools-active d-flex align-items-center m-0 px-3 py-2",onClick:L[5]||(L[5]=xe(ge=>Oe.value.undo(),["prevent"]))},[Fo,he(" Undo ")]),e("p",{class:"tools-item tools-active d-flex align-items-center m-0 px-3 py-2",onClick:L[6]||(L[6]=xe(ge=>Oe.value.redo(),["prevent"]))},[Ho,he(" Redo ")])]),e("div",qo,[e("p",{class:be(["tools-item m-0 d-flex align-items-center m-0 px-3 py-2",De.value?"":"tools-active"]),onClick:L[7]||(L[7]=xe(ge=>De.value=!1,["prevent"]))},[Ko,he(" Brush ")],2),e("p",{class:be(["tools-item m-0 d-flex align-items-center m-0 px-3 py-2",De.value?"tools-active":""]),onClick:L[8]||(L[8]=xe(ge=>De.value=!0,["prevent"]))},[Go,he(" Eraser ")],2)])]),e("section",zo,[e("p",Jo,g(De.value?"Eraser Size":"Brush Size"),1),f(Me,{modelValue:tt.value,"onUpdate:modelValue":L[9]||(L[9]=ge=>tt.value=ge),class:"flex-fill",min:1},null,8,["modelValue"]),e("p",Wo,g(tt.value),1)]),e("section",Zo,[f(Re,{modelValue:$e.value,"onUpdate:modelValue":L[10]||(L[10]=ge=>$e.value=ge),"show-alpha":"",class:"tools-color"},null,8,["modelValue"]),e("div",{class:"tools-color",style:{"background-color":"white"},onClick:L[11]||(L[11]=ge=>st("rgba(255, 255, 255, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"black"},onClick:L[12]||(L[12]=ge=>st("rgba(0, 0, 0, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(255, 72, 66, 1)"},onClick:L[13]||(L[13]=ge=>st("rgba(255, 72, 66, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(24, 175, 74, 1)"},onClick:L[14]||(L[14]=ge=>st("rgba(24, 175, 74, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(1, 163, 255, 1)"},onClick:L[15]||(L[15]=ge=>st("rgba(1, 163, 255, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(255, 165, 0, 1)"},onClick:L[16]||(L[16]=ge=>st("rgba(255, 165, 0, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(0, 0, 255, 1)"},onClick:L[17]||(L[17]=ge=>st("rgba(0, 0, 255, 1)"))}),e("div",{class:"tools-color",style:{"background-color":"rgba(255, 231, 0, 1)"},onClick:L[18]||(L[18]=ge=>st("rgba(255, 231, 0, 1)"))})])],2)]))],4)])):Z("",!0),f(Ds,{ref_key:"singleUploader",ref:C,"is-multiple":!1,onOnFileDropped:et,onOnFileCancelled:Xe},null,512),e("div",Xo,[z.value?(n(),h("div",Yo,[M.value&&q.value!=0?(n(),h("div",Qo,[e("h1",ei,g(q.value),1)])):Z("",!0),u.value?(n(),h("div",ti,[f(At,{onClick:L[19]||(L[19]=ge=>te())},{default:F(()=>[ai]),_:1})])):(n(),h("div",si,[f(At,{"data-testid":"timer-button",onClick:L[20]||(L[20]=ge=>H(!v.value))},{default:F(()=>[E.value==0?(n(),h("svg",oi,li)):(n(),h("div",ni,g(E.value),1))]),_:1}),v.value?(n(),ee(na,{key:0,"data-testid":"timer-option",timerOption:K(la),onSelectTimer:mt},null,8,["timerOption"])):Z("",!0)]))])):Z("",!0)])])),[[Et,we.value,void 0,{fullscreen:!0,lock:!0}]])]),_:1},8,["modelValue"]),f(Ns,{"is-visible":d.value,description:p.value,onOnClose:Ge,onOnSaveDesc:Ce},null,8,["is-visible","description"]),f(As,{show:V.value,onClose:O,imageList:r.value},null,8,["show","imageList"]),f(yt,{show:ae.value,onClose:ne,"title-pop-up":"no internet connection"},null,8,["show"]),f(Ia,{visibility:k.value,caption:"Your device camera cannot be opened, please retry or contact your administrator!",onOnNoConfirm:se,onOnYesConfirm:X,yesLabel:"Retry",noLabel:"Close",btnColorNo:"background-color: #FFFFFF; color: black;",btnColorYes:"background-color: #18AF4A; color: white;"},null,8,["visibility"])],64)}}}),ci=Be(ri,[["__scopeId","data-v-fea7bbf3"]]),ui={class:"table table-bordered"},di=e("caption",null,null,-1),mi=e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"No"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Measurement Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating")])],-1),pi={scope:"row",class:"ps-3 align-middle"},hi={scope:"row",class:"align-middle"},gi={scope:"row",class:"align-middle"},vi={scope:"row",class:"align-middle"},fi={scope:"row",class:"align-middle"},yi={class:"input-eform-status"},bi={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},_i=re({__name:"CurrentConditionAutTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=Ot({...s.itemService}),{measurement:i,rating:o}=Rt(a);return Ze(()=>s.itemService,l=>{Object.assign(a,l)},{deep:!0}),(l,c)=>{const r=G("el-input"),d=He("loading");return ue((n(),h("table",ui,[di,mi,e("tbody",null,[e("tr",null,[e("th",pi,g(t.itemService.number),1),e("th",hi,g(t.itemService.text),1),e("th",gi,[f(r,{modelValue:K(i),"onUpdate:modelValue":c[0]||(c[0]=p=>ze(i)?i.value=p:null),placeholder:"Measurement Value",readonly:""},null,8,["modelValue"])]),e("th",vi,g(t.itemService.uom),1),e("th",fi,[e("div",yi,[f(r,{modelValue:K(o),"onUpdate:modelValue":c[1]||(c[1]=p=>ze(o)?o.value=p:null),class:be(`pe-3 ${t.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),e("tr",null,[e("td",bi,g(t.itemService.timestamp.name)+", "+g(t.itemService.timestamp.date),1)])])])),[[d,t.loading]])}}}),Ci={class:"table table-bordered"},wi=e("caption",null,null,-1),ki=e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"No"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Measurement Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating")])],-1),Si={scope:"row",class:"ps-3 align-middle"},Ii={scope:"row",class:"align-middle"},Di={scope:"row",class:"align-middle"},Ei={scope:"row",class:"align-middle"},Mi={scope:"row",class:"align-middle"},Ai={class:"input-eform-status"},Pi={class:"timestamp-task text-end m-auto px-3 pt-0 pb-0",colspan:"9"},Oi=e("th",{scope:"row",class:"ps-3 align-middle"},null,-1),Ri={scope:"row",class:"align-middle"},Vi={scope:"row",class:"align-middle"},Ti={scope:"row",class:"align-middle"},$i={scope:"row",class:"align-middle"},xi={class:"input-eform-status"},Li=re({__name:"CurrentConditionCaliperTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=Ot({...s.itemService}),{measurement:i,rating:o,previousRating:l}=Rt(a);Ze(()=>s.itemService,r=>{Object.assign(a,r)},{deep:!0});const c=S(()=>s.itemService.text?s.itemService.text.includes("Disc")?"Disc":"Lining":"");return(r,d)=>{const p=G("el-input"),C=He("loading");return ue((n(),h("table",Ci,[wi,ki,e("tbody",null,[e("tr",null,[e("th",Si,g(t.itemService.number),1),e("th",Ii,g(t.itemService.text),1),e("th",Di,[f(p,{modelValue:K(i),"onUpdate:modelValue":d[0]||(d[0]=V=>ze(i)?i.value=V:null),placeholder:"Measurement Value",readonly:""},null,8,["modelValue"])]),e("th",Ei,g(t.itemService.uom),1),e("th",Mi,[e("div",Ai,[f(p,{modelValue:K(o),"onUpdate:modelValue":d[1]||(d[1]=V=>ze(o)?o.value=V:null),class:be(`pe-3 ${t.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),e("tr",null,[e("td",Pi,g(t.itemService.timestamp.name)+", "+g(t.itemService.timestamp.date),1)]),e("tr",null,[Oi,e("th",Ri," Previous "+g(c.value),1),e("th",Vi,g(t.itemService.previousMeasurement),1),e("th",Ti,g(t.itemService.uom),1),e("th",$i,[e("div",xi,[f(p,{modelValue:K(l),"onUpdate:modelValue":d[2]||(d[2]=V=>ze(l)?l.value=V:null),class:be(`pe-3 ${t.itemService.previousColor}`),disabled:""},null,8,["modelValue","class"])])])])])])),[[C,t.loading]])}}}),Vt=t=>(Je("data-v-36c50414"),t=t(),We(),t),Ni={class:"table table-bordered"},Ui=Vt(()=>e("caption",null,null,-1)),Bi=Vt(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"No"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Previous Value"),e("th",{scope:"col",class:"table-header"},"Current Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating")])],-1)),ji={scope:"row",class:"ps-3 align-middle"},Fi={scope:"row",class:"align-middle"},Hi={scope:"row",class:"align-middle"},qi={scope:"row",class:"align-middle"},Ki={scope:"row",class:"align-middle"},Gi={scope:"row",class:"align-middle"},zi={class:"input-eform-status"},Ji={class:"timestamp-task text-end m-auto pe-3 pt-0 pb-3",colspan:"9"},Wi={key:0},Zi=Vt(()=>e("th",{scope:"row"},null,-1)),Xi=Vt(()=>e("th",{scope:"row",class:"align-middle"},"Replacement",-1)),Yi=Vt(()=>e("th",{scope:"row"},null,-1)),Qi={scope:"row",class:"align-middle"},el={scope:"row",class:"align-middle"},tl={scope:"row",class:"align-middle"},al={class:"input-eform-status"},sl={key:1},ol={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},il=re({__name:"CurrentConditionAutRepTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=Ot({...s.itemService}),{measurement:i,rating:o,previousMeasurement:l,replacementMeasurement:c,replacementRating:r}=Rt(a);return Ze(()=>s.itemService,d=>{Object.assign(a,d)},{deep:!0}),(d,p)=>{const C=G("el-input"),V=He("loading");return ue((n(),h("table",Ni,[Ui,Bi,e("tbody",null,[e("tr",null,[e("th",ji,g(t.itemService.number),1),e("th",Fi,g(t.itemService.text),1),e("th",Hi,[f(C,{modelValue:K(l),"onUpdate:modelValue":p[0]||(p[0]=b=>ze(l)?l.value=b:null),placeholder:"Previous Value",class:"input-previous_value",readonly:""},null,8,["modelValue"])]),e("th",qi,[f(C,{modelValue:K(i),"onUpdate:modelValue":p[1]||(p[1]=b=>ze(i)?i.value=b:null),placeholder:"Current Value",class:"input-current_value",readonly:""},null,8,["modelValue"])]),e("th",Ki,g(t.itemService.uom),1),e("th",Gi,[e("div",zi,[f(C,{modelValue:K(o),"onUpdate:modelValue":p[2]||(p[2]=b=>ze(o)?o.value=b:null),class:be(`pe-3 ${t.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),e("tr",null,[e("td",Ji,g(t.itemService.timestamp.name)+", "+g(t.itemService.timestamp.date),1)]),t.itemService.isReplacementAdjustment?(n(),h("tr",Wi,[Zi,Xi,Yi,e("th",Qi,[f(C,{modelValue:K(c),"onUpdate:modelValue":p[3]||(p[3]=b=>ze(c)?c.value=b:null),placeholder:"Current Value",class:"input-current_value",readonly:""},null,8,["modelValue"])]),e("th",el,g(t.itemService.uom),1),e("th",tl,[e("div",al,[f(C,{modelValue:K(r),"onUpdate:modelValue":p[4]||(p[4]=b=>ze(r)?r.value=b:null),class:be(`pe-3 ${t.itemService.colorReplacementRating}`),disabled:""},null,8,["modelValue","class"])])])])):Z("",!0),t.itemService.isReplacementAdjustment?(n(),h("tr",sl,[e("td",ol,g(t.itemService.replacementTimestamp.name)+", "+g(t.itemService.replacementTimestamp.date),1)])):Z("",!0)])])),[[V,s.loading]])}}}),ll=Be(il,[["__scopeId","data-v-36c50414"]]),nl={class:"table table-bordered"},rl=e("caption",null,null,-1),cl=e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",style:{width:"5%"},class:"table-header ps-3"},"No"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Measurement Location"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Tool"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"A"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"B"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Piston Movement (B-A)"),e("th",{scope:"col",style:{width:"5%"},class:"table-header"},"UoM"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Percent Worn"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Rating")])],-1),ul={scope:"row",class:"ps-3 align-middle"},dl={scope:"row",class:"align-middle"},ml={scope:"row",class:"align-middle"},pl={scope:"row",class:"align-middle"},hl={scope:"row",class:"align-middle"},gl={scope:"row",class:"align-middle"},vl={scope:"row",class:"align-middle"},fl={scope:"row",class:"align-middle"},yl={scope:"row",class:"align-middle"},bl={class:"input-eform-status"},_l={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},Cl=re({__name:"CurrentConditionOilCooledTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=Ot({...s.itemService}),{measurement:i,rating:o}=Rt(a);Ze(()=>s.itemService,r=>{Object.assign(a,r)},{deep:!0});const l=S(()=>s.itemService.tool=="BIRRANA"?"Birrana Gauge":"CAT Gauge"),c=S(()=>parseFloat(s.itemService.pistonPercentageValue)*100);return(r,d)=>{const p=G("el-option"),C=G("el-select"),V=G("el-input"),b=He("loading");return ue((n(),h("table",nl,[rl,cl,e("tbody",null,[e("tr",null,[e("th",ul,g(t.itemService.number),1),e("th",dl,g(t.itemService.text),1),e("th",ml,[f(C,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=x=>l.value=x),readonly:""},{default:F(()=>[f(p,{value:"BIRRANA"},{default:F(()=>[he("Birrana Gauge")]),_:1}),f(p,{value:"CAT_GAUGE"},{default:F(()=>[he("CAT Gauge")]),_:1})]),_:1},8,["modelValue"])]),e("th",pl,[f(V,{modelValue:t.itemService.pistonAValue,"onUpdate:modelValue":d[1]||(d[1]=x=>t.itemService.pistonAValue=x),readonly:""},null,8,["modelValue"])]),e("th",hl,[f(V,{modelValue:t.itemService.pistonBValue,"onUpdate:modelValue":d[2]||(d[2]=x=>t.itemService.pistonBValue=x),readonly:""},null,8,["modelValue"])]),e("th",gl,[f(V,{modelValue:t.itemService.pistonResultValue,"onUpdate:modelValue":d[3]||(d[3]=x=>t.itemService.pistonResultValue=x),readonly:""},null,8,["modelValue"])]),e("th",vl,g(t.itemService.uom),1),e("th",fl,g(c.value)+"% ",1),e("th",yl,[e("div",bl,[f(V,{modelValue:K(o),"onUpdate:modelValue":d[4]||(d[4]=x=>ze(o)?o.value=x:null),class:be(`pe-3 ${t.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),e("tr",null,[e("td",_l,g(t.itemService.timestamp.name)+", "+g(t.itemService.timestamp.date),1)])])])),[[b,t.loading]])}}}),dt="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api",Da="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api",wl=`${dt}/service_sheet_detail/get_data_detail_cbm`,kl=`${dt}/interim_engine_detail/get_data_detail_cbm`,Sl=`${dt}/intervention/get_intervention_revise`,ca=`${dt}/service_sheet_detail/update_task_revise`,Il=`${dt}/interim_engine_detail/update_task_revise`,Dl=`${Da}/intervention_header/update_task_revise`,El=`${dt}/service_sheet_detail/update_task_with_defect_revise`,Ml=`${Da}/intervention_header/update_task_with_defect_revise`,Al=`${dt}/interim_engine_detail/update_task_with_defect_revise`,Pl=`${dt}/attachment/download_by_url`,ua="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/history_cbm_change/cbm_change",da={workOrder:"",taskKey:"",component:"",ver:"v1"},Ol={model:"",psType:"",ver:"v1"},ma={measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}},Rl={pistonA:{errorMessage:"",isShowError:!1},pistonB:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}},Zt=[{measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}}],gt=Ht({id:"overwriteCbm",state:()=>({stateParamGetDetailCbm:da,stateParamGetMappingCbm:Ol,stateDetailCbm:{},stateIsError:!1,stateError:"",stateModifiedObjectAvg:{},stateModifiedObjectAut:{taskNo:"",measurementLocation:"",uom:"",measurementValue:"",measurementRating:"",images:""},stateModifiedObjectMan:{taskNo:"",measurementLocation:"",uom:"",measurementRating:"",images:""},stateModifiedObjectOilCooled:{taskNo:"",measurementLocation:"",tool:"",pistonMovementA:"",pistonMovementB:"",pistonMovementResult:"",uom:"",pistonMovementRating:"",rating:"",images:""},stateCbmType:"",stateErrors:[],stateLoading:!1,stateIsUserCanRevise:!1,stateItemKey:{camera:"",rating:"",measurement:""},stateItemKeyAvg:[],stateItemKeyOilCooled:{},stateEmployeeData:{id:"",name:""},stateInputErrorList:[...Zt],stateInputError:{...ma},stateInputErrorOilCooled:{...Rl},stateCbmTypeAutomatic:["AUTOMATIC","AUTOMATIC_PREVIOUS","DROPDOWN_TOOL","BIRANA"],stateCbmTypeManual:["MANUAL","NORMAL"]}),getters:{detailCbm:t=>t.stateDetailCbm,cbmType:t=>t.stateCbmType,cbmTypeAutomatic:t=>t.stateCbmTypeAutomatic,cbmTypeManual:t=>t.stateCbmTypeManual,modifiedObjectAvg:t=>t.stateModifiedObjectAvg,modifiedObjAut:t=>t.stateModifiedObjectAut,modifiedObjMan:t=>t.stateModifiedObjectMan,modifiedObjOilCooled:t=>t.stateModifiedObjectOilCooled,loading:t=>t.stateLoading,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,inputErrorList:t=>t.stateInputErrorList,inputError:t=>t.stateInputError,inputErrorOilCooled:t=>t.stateInputErrorOilCooled,isUserCanRevise:t=>t.stateIsUserCanRevise,itemKey:t=>t.stateItemKey,itemKeyOilCooled:t=>t.stateItemKeyOilCooled,isReplacementAdjustment:t=>t.stateDetailCbm.isReplacementAdjustment?t.stateDetailCbm.isReplacementAdjustment:!1},actions:{setCbmType(t="serviceSheet"){const s=this.stateDetailCbm.historyModifiedDefault[this.stateDetailCbm.historyModifiedDefault.length-1];if(s.rating=="AUTOMATIC"){const a=s.items.find(i=>i.categoryItemType=="resultParamRating");this.stateCbmType=a?"AVERAGE":"AUTOMATIC";return}t=="intervention"&&(s.rating=="AUTOMATIC_REPLACEMENT"||s.rating=="AUTOMATIC_REPLACEMENT_GAP")?this.stateCbmType="AUTOMATIC":this.stateCbmType=s.rating},setAverageForms(){this.stateInputErrorList=[],this.stateModifiedObjectAvg.value=[];for(let t=0;t<this.stateDetailCbm.historyModifiedDefault.length;t++)this.stateModifiedObjectAvg.value.push({measurementValue:"",measurementRating:"",uom:this.stateDetailCbm.currentCondition.uom,images:[]}),this.stateInputErrorList.push({measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}})},setModifiedObject(t){this.cbmType=="AUTOMATIC"||this.cbmType.includes("PREVIOUS")||this.cbmType=="CALIPER"?this.stateModifiedObjectAut={taskNo:t.value.currentCondition.taskNo,measurementLocation:t.value.currentCondition.measurementLocation,uom:t.value.currentCondition.uom,measurementValue:"",measurementRating:"",images:""}:this.cbmType=="NORMAL"||this.cbmType=="MANUAL"?this.stateModifiedObjectMan={taskNo:t.value.currentCondition.taskNo,measurementLocation:t.value.currentCondition.measurementLocation,uom:t.value.currentCondition.uom,measurementRating:"",images:""}:this.cbmType=="AVERAGE"?this.setAverageForms():this.cbmType=="AUTOMATIC_REPLACEMENT"||this.cbmType=="AUTOMATIC_REPLACEMENT_GAP"?this.stateModifiedObjectAut={taskNo:t.value.currentCondition.taskNo,measurementLocation:t.value.currentCondition.measurementLocation,uom:t.value.currentCondition.uom,measurementValue:"",measurementRating:"",images:""}:this.cbmType=="OIL_COOLED"&&(this.stateModifiedObjectOilCooled={taskNo:t.value.currentCondition.taskNo,measurementLocation:t.value.currentCondition.measurementLocation,tool:t.value.currentCondition.pistonTool,pistonMovementA:"",pistonMovementB:"",pistonMovementResult:"",uom:t.value.currentCondition.pistonUom,pistonMovementRating:"",rating:"",images:""})},setIsUserCanRevise(t){this.stateIsUserCanRevise=t},async getDetailCbm(){const t={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{this.stateLoading=!0;const s=await ye.post(`${wl}?ver=v1`,t);this.stateDetailCbm=s.data.result.content,this.setCbmType(),this.stateCbmType=="AVERAGE"&&this.setAverageForms()}catch(s){console.log(s),Ve("IRONS",s)}finally{this.stateLoading=!1}},async getDetailIntervention(){this.stateLoading=!0;const t={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{const s=await ye.post(`${Sl}?ver=v1`,t);this.stateDetailCbm=s.data.result.content,this.setCbmType("intervention")}catch(s){console.log(s)}finally{this.stateLoading=!1}},async getDetailCbmInterim(){const t={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{this.stateLoading=!0;const s=await ye.post(`${kl}?ver=v1`,t);this.stateDetailCbm=s.data.result.content,this.setCbmType()}catch(s){console.log(s),Ve("IRONS",s)}finally{this.stateLoading=!1}},async getImage(t){if(!t)return null;const s={fileUrl:`${t.filename}`,ver:"v1"};try{const a=`${Pl}?${new URLSearchParams(s).toString()}`,o=(await ye.getBlob(a)).data,l=new Blob([o]),r=(window.URL||window.webkitURL).createObjectURL(l);return{key:t.filename,value:r,blob:l}}catch(a){return console.log("image",a),null}},defineItemKey(t="serviceSheet"){if((this.stateCbmType=="AUTOMATIC_REPLACEMENT"||this.stateCbmType=="AUTOMATIC_REPLACEMENT_GAP")&&t=="serviceSheet"){if(this.stateItemKey.camera=this.stateDetailCbm.replacementPhoto[0].items[2].key,this.isReplacementAdjustment){this.stateItemKey.measurement=this.stateDetailCbm.historyModifiedDefault[0].items[0].key,this.stateItemKey.rating=this.stateDetailCbm.historyModifiedDefault[0].items[0].key;return}this.stateItemKey.measurement=this.stateDetailCbm.beforeReplacementItems[4].key,this.stateItemKey.rating=this.stateDetailCbm.beforeReplacementItems[6].key;return}for(const s in this.stateDetailCbm.historyModifiedDefault[0].items)if(Object.hasOwnProperty.call(this.stateDetailCbm.historyModifiedDefault[0].items,s)){const a=this.stateDetailCbm.historyModifiedDefault[0].items[s];this.cbmType=="MANUAL"||this.cbmType=="NORMAL"&&a.categoryItemType=="resultRating"?this.stateItemKey.rating=a.key:a.itemType=="smallCamera"?this.stateItemKey.camera=a.key:a.categoryItemType=="paramRating"||a.categoryItemType=="paramRatingDynamic"?this.stateItemKey.measurement=a.key:a.categoryItemType=="targetRating"||a.itemType=="dropDown"&&a.categoryItemType!="resultStatus"?this.stateItemKey.rating=a.key:a.description=="Adjustment"&&(this.stateItemKey.rating=a.key,this.stateItemKey.measurement=a.key,this.stateItemKey.camera=a.key)}},defineItemMan(){for(const t in this.stateDetailCbm.historyModifiedDefault[0].items)if(Object.hasOwnProperty.call(this.stateDetailCbm.historyModifiedDefault[0].items,t)){const s=this.stateDetailCbm.historyModifiedDefault[0].items[t];s.itemType=="smallCamera"?this.stateItemKey.camera=s.key:s.itemType=="dropDown"&&(s!=null&&s.isTaskValue)&&s.categoryItemType!="resultStatus"&&(this.stateItemKey.rating=s.key)}},defineItemKeyAvg(){this.stateDetailCbm.historyModifiedDefault.forEach(t=>{const s={};for(const a in t.items)if(Object.hasOwnProperty.call(t.items,a)){const i=t.items[a];i.categoryItemType=="resultParamRating"?s.value=i.key:i.itemType=="smallCamera"?s.camera=i.key:i.itemType=="paramRating"?s.rating=i.key:i.category=="cbmCalculateAvg"?s.value=i.key:(i.categoryItemType=="targetRating"||i.itemType=="dropDown"&&i.categoryItemType!="resultStatus")&&(s.rating=i.key)}this.stateItemKeyAvg.push(s)})},defineItemKeyOilCooled(){this.stateDetailCbm.historyModifiedDefault.forEach(t=>{for(const s in t.items)if(Object.hasOwnProperty.call(t.items,s)){const a=t.items[s];a.categoryItemType=="pistonMovementA"?this.stateItemKeyOilCooled.pistonMovementA=a.key:a.categoryItemType=="pistonMovementB"?this.stateItemKeyOilCooled.pistonMovementB=a.key:a.categoryItemType=="pistonMovementResult"?this.stateItemKeyOilCooled.pistonMovementResult=a.key:a.categoryItemType=="targetTool"?this.stateItemKeyOilCooled.uom=a.key:a.categoryItemType=="pistonMovementRating"?this.stateItemKeyOilCooled.pistonMovementRating=a.key:a.categoryItemType=="targetRating"?this.stateItemKeyOilCooled.rating=a.key:a.itemType=="smallCamera"&&(this.stateItemKeyOilCooled.camera=a.key)}})},getUrlApiUpdate(t){switch(t){case"interim":return Il;case"intervention":return Dl;default:return ca}},getUrlApiDefectUpdate(t){switch(t){case"interim":return Al;case"intervention":return Ml;default:return El}},getBeforeValue(t){const s=t.find(r=>r.categoryItemType=="targetRating");let a="";s&&(a=s.value);const i=t.find(r=>r.categoryItemType=="targetTool");let o="";if(i)o=i.value;else if(!i){const r=t.findIndex(d=>d.categoryItemType=="paramRating"||d.categoryItemType=="paramRatingDynamic");o=t[r+1].value}const l=t.find(r=>r.categoryItemType=="paramRating"||r.categoryItemType=="paramRatingDynamic");let c="";return l&&(c=l.value),{rating:a,measurement:c,uom:o}},async postDefectHistory(t,s,a,i="serviceSheet",o=!1){const l=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",c=this.stateDetailCbm.beforeAdjustmentItems,r=this.stateDetailCbm.beforeReplacementItems,d={updateParams:[{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:t}]}],headerId:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,id:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,employee:this.stateEmployeeData,defectHeader:{workorder:this.stateDetailCbm.workOrder,form:this.stateDetailCbm.form,category:"CBM",taskId:this.stateDetailCbm.taskKey,taskNo:a,taskDesc:this.stateDetailCbm.currentCondition.measurementLocation,defectWorkorder:"",formDefect:"",defectType:"",cbmMeasurement:s||"",cbmUom:s?this.stateDetailCbm.currentCondition.uom:"",cbmImageKey:this.itemKey.camera,cbmImageProp:i=="intervention"?"images":"value",isCbmAdjusment:l?"true":"false",taskValue:t,repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.stateEmployeeData,status:"Submit"}};c&&(d.defectHeader.correctedValue=t,d.defectHeader.correctedMeasurement=s||"",d.defectHeader.correctedUom=s?this.stateDetailCbm.currentCondition.uom:"",d.defectHeader.taskValue=this.getBeforeValue(c).rating,d.defectHeader.cbmMeasurement=this.getBeforeValue(c).measurement,d.defectHeader.cbmUom=this.getBeforeValue(c).uom),r&&(d.defectHeader.correctedValue=t,d.defectHeader.correctedMeasurement=s||"",d.defectHeader.correctedUom=s?this.stateDetailCbm.currentCondition.uom:"",d.defectHeader.taskValue=this.getBeforeValue(r).rating,d.defectHeader.cbmMeasurement=this.getBeforeValue(r).measurement,d.defectHeader.cbmUom=this.getBeforeValue(r).uom),i=="intervention"?(d.defectHeader.interventionHeaderId=this.stateDetailCbm.interventionHeaderId,d.defectHeader.interventionId=this.stateDetailCbm.id):d.defectHeader.serviceSheetDetailId=this.stateDetailCbm.serviceSheetDetailId,o&&(d.defectHeader.cbmUom=this.stateModifiedObjectOilCooled.uom,d.defectHeader.pistonUom=this.stateModifiedObjectOilCooled.uom,d.defectHeader.cbmPistonA=this.stateModifiedObjectOilCooled.pistonMovementA,d.defectHeader.cbmPistonB=this.stateModifiedObjectOilCooled.pistonMovementB,d.defectHeader.cbmPistonResult=this.stateModifiedObjectOilCooled.pistonMovementResult,d.defectHeader.cbmPistonTool=this.getPistonToolLabel(this.stateModifiedObjectOilCooled.tool));try{const p={ver:"v1"},C=await ye.post(`${this.getUrlApiDefectUpdate(i)}?${new URLSearchParams(p).toString()}`,d);C.data.title==="Error"?(this.stateErrors.push(C.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(p){p.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=p,console.log(p),Ve("IRONS",p),this.stateErrors.push(p.response.data.result.message),this.stateIsError=!0}},getPistonToolLabel(t){const s=this.stateDetailCbm.historyModifiedDefault[0].items.find(a=>a.categoryItemType=="dropdownTool");if(s){let a=[];const i=s.caption.replace("[","").replace("]","").split("; "),o=s.itemValue.replace("[","").replace("]","").split(", ");a=i.map((c,r)=>({label:c.replaceAll("'",""),value:o[r].replaceAll("'","")})),a.forEach(c=>{c.value==s.value&&c.label});const l=a.find(c=>c.value==t);return l==null?void 0:l.label}return""},async updateTaskReviseManual(t,s,a,i){this.defineItemMan(),(this.modifiedObjMan.measurementRating=="X"||this.modifiedObjMan.measurementRating=="C")&&this.postDefectHistory(this.modifiedObjMan.measurementRating,null,this.modifiedObjMan.taskNo,i);const l={headerId:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.rating,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjMan.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};i=="intervention"&&(l.component=t),this.modifiedObjMan.images.length!=0&&(l.isUpdatePhoto=!0,l.updateParams.push({keyValue:i=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:i=="intervention"?"images":"value",propertyValue:JSON.stringify(this.modifiedObjMan.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})),(this.modifiedObjMan.measurementRating=="A"||this.modifiedObjMan.measurementRating=="B")&&l.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjMan.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]});const c={measurementRating:this.modifiedObjMan.measurementRating,measurementValue:null};try{this.stateLoading=!0;const r={ver:"v1"},d=await ye.post(`${this.getUrlApiUpdate(i)}?${new URLSearchParams(r).toString()}`,l);return d.data.title==="Error"?(this.stateErrors.push(d.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(c,t,new Date(s),a),d}catch(r){r.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=r,Ve("IRONS",r),console.log(r),this.stateErrors.push(r.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAutomatic(t,s,a,i="serviceSheet"){var x;this.defineItemKey();const o=this.modifiedObjAut.measurementRating=="X"||this.modifiedObjAut.measurementRating=="C",l=(x=this.stateDetailCbm)==null?void 0:x.historyModifiedDefault[0].description;if(!l)throw Error("Object is incorrect, invalid description");const[c,r,d]=l.split(";"),p=c+";"+r;o&&this.postDefectHistory(this.modifiedObjAut.measurementRating,this.modifiedObjAut.measurementValue,p,i);const C=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",V={headerId:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.rating,propertyParams:[{propertyName:C?"rating":"value",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};C||V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),i=="intervention"&&(V.component=t),this.itemKey.measurement!==""&&V.updateParams.push({keyValue:this.itemKey.measurement,propertyParams:[{propertyName:C?"measurement":"value",propertyValue:this.modifiedObjAut.measurementValue},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),(this.modifiedObjAut.measurementRating=="A"||this.modifiedObjAut.measurementRating=="B")&&V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjAut.images.length!=0&&(V.isUpdatePhoto=!0,V.updateParams.push({keyValue:i=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:i=="intervention"?"images":C?"pictures":"value",propertyValue:JSON.stringify(this.modifiedObjAut.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const b={measurementRating:this.modifiedObjAut.measurementRating,measurementValue:this.modifiedObjAut.measurementValue};try{this.stateLoading=!0;const w={ver:"v1"};console.log("payload",V);const I=await ye.post(`${this.getUrlApiUpdate(i)}?${new URLSearchParams(w).toString()}`,V);return I.data.title==="Error"?(this.stateErrors.push(I.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(b,t,new Date(s),a),I}catch(w){w.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=w,Ve("IRONS",w),console.log(w),this.stateErrors.push(w.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAutomaticReplacementAndGap(t,s,a,i="serviceSheet"){var b;this.defineItemKey(i);const o=this.modifiedObjAut.measurementRating=="X"||this.modifiedObjAut.measurementRating=="C",l=(b=this.stateDetailCbm)==null?void 0:b.historyModifiedDefault[0].description;if(!l)throw Error("Object is incorrect, invalid description");const[c,r,d]=l.split(";"),p=c+";"+r;o&&this.postDefectHistory(this.modifiedObjAut.measurementRating,this.modifiedObjAut.measurementValue,p,i);const C={headerId:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.measurement,propertyParams:[{propertyName:this.isReplacementAdjustment?"measurement":"value",propertyValue:this.modifiedObjAut.measurementValue},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKey.rating,propertyParams:[{propertyName:this.isReplacementAdjustment?"rating":"value",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};(this.modifiedObjAut.measurementRating=="A"||this.modifiedObjAut.measurementRating=="B")&&C.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),(this.modifiedObjAut.measurementRating=="C"||this.modifiedObjAut.measurementRating=="X")&&C.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjAut.images.length>0&&(C.isUpdatePhoto=!0,C.updateParams.push({keyValue:i=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:i=="intervention"?"images":"value",propertyValue:JSON.stringify(this.modifiedObjAut.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})),i=="intervention"&&(C.component=t);const V={measurementRating:this.modifiedObjAut.measurementRating,measurementValue:this.modifiedObjAut.measurementValue};try{this.stateLoading=!0;const x={ver:"v1"};console.log("payload",C);const w=await ye.post(`${this.getUrlApiUpdate(i)}?${new URLSearchParams(x).toString()}`,C);return w.data.title==="Error"?(this.stateErrors.push(w.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(V,t,new Date(s),a),w}catch(x){x.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=x,Ve("IRONS",x),console.log(x),this.stateErrors.push(x.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAverage(){this.stateLoading=!0,this.defineItemKeyAvg();const t=[];this.modifiedObjectAvg.value.forEach((s,a)=>{t.push(new Promise(i=>{this.avgReviseSingle(s,a).then(i)}))}),this.stateItemKeyAvg=[],await Promise.allSettled(t).then(s=>{const i=s.map(o=>{if(o.status==="fulfilled")return o.value}).find(o=>o.data.title==="Error");i&&(this.stateErrors.push(i.data.result.message),this.stateIsError=!0)}).finally(()=>{this.stateLoading=!1})},async updateTaskReviseOilCooled(t,s,a,i="serviceSheet"){var x;this.defineItemKeyOilCooled();const o=this.modifiedObjOilCooled.rating=="X"||this.modifiedObjOilCooled.rating=="C",l=(x=this.stateDetailCbm)==null?void 0:x.historyModifiedDefault[0].description;if(!l)throw Error("Object is incorrect, invalid description");const[c,r,d]=l.split(";"),p=c+";"+r;o&&this.postDefectHistory(this.modifiedObjOilCooled.rating,Number(this.modifiedObjOilCooled.pistonMovementRating)/100,p,i,!0);const C=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",V={headerId:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:i=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKeyOilCooled.pistonMovementA,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementA},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementB,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementB},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementResult,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementResult},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.uom,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.uom},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementRating,propertyParams:[{propertyName:"value",propertyValue:Number(this.modifiedObjOilCooled.pistonMovementRating)/100},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.rating,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.rating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};(this.modifiedObjOilCooled.rating=="A"||this.modifiedObjOilCooled.rating=="B")&&V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjOilCooled.rating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjOilCooled.images.length!=0&&(V.isUpdatePhoto=!0,V.updateParams.push({keyValue:i=="intervention"?this.stateDetailCbm.taskKey:this.itemKeyOilCooled.camera,propertyParams:[{propertyName:i=="intervention"?"images":C?"pictures":"value",propertyValue:JSON.stringify(this.modifiedObjOilCooled.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const b={ratingOri:this.stateDetailCbm.currentCondition.pistonRating,ratingUpdate:this.modifiedObjOilCooled.rating,valueOri:this.stateDetailCbm.currentCondition.pistonPercentageValue,valueUpdate:`${Number(this.modifiedObjOilCooled.pistonMovementRating)/100}`};try{this.stateLoading=!0;const w={ver:"v1"};console.log("payload",V);const I=await ye.post(`${this.getUrlApiUpdate(i)}?${new URLSearchParams(w).toString()}`,V);return I.data.title==="Error"?(this.stateErrors.push(I.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBMNew(b,t,new Date(s),a),I}catch(w){w.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=w,Ve("IRONS",w),console.log(w),this.stateErrors.push(w.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async avgReviseSingle(t,s){var P,E;const a=this.stateItemKeyAvg[s],i=(P=this.stateDetailCbm.historyModifiedDefault[s])==null?void 0:P.key,o=(E=this.stateDetailCbm)==null?void 0:E.historyModifiedDefault[s].description;if(!o)throw Error("Object is incorrect, invalid description");const[l,c,r]=o.split(";"),d=l+";"+c,p=t.measurementRating,C=t.measurementValue;!!p&&["C","X"].includes(p)&&await this.postDefectHistory(p,C,d).catch(()=>{throw Error("Defect history is failed to update")}),console.log("index:",s);const b={headerId:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:i,id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[],employee:this.stateEmployeeData};s==3&&(console.log("ok"),b.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const x={keyValue:a.rating,propertyParams:[{propertyName:"value",propertyValue:p},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},w={keyValue:a.value,propertyParams:[{propertyName:"value",propertyValue:C},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},I={keyValue:a.camera,propertyParams:[{propertyName:"value",propertyValue:JSON.stringify(t.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]};(p=="A"||p=="B")&&b.updateParams.push({keyValue:i,propertyParams:[{propertyName:"taskValue",propertyValue:p},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),t.images.length!=0&&(b.isUpdatePhoto=!0,b.updateParams.push(I)),a.value&&b.updateParams.push(w),a.rating&&b.updateParams.push(x);const R={ver:"v1"};return await ye.post(`${ca}?${new URLSearchParams(R).toString()}`,b)},async changeHistoryCBM(t,s,a,i){const o={equipment:this.stateDetailCbm.equipment,component:s,taskKey:this.stateDetailCbm.taskKey,sampleDate:a?Xt(Yt(a)):"",ratingOri:this.stateDetailCbm.currentCondition.rating,ratingUpdate:t.measurementRating,valueOri:this.stateDetailCbm.currentCondition.value||this.stateDetailCbm.currentCondition.measurementValue||null,valueUpdate:t.measurementValue||null,interventionReason:this.stateDetailCbm.currentCondition.measurementLocation,workOrder:this.stateDetailCbm.workOrder};try{const l={userAccount:i,ver:"v1"},c=await ye.post(`${ua}?${new URLSearchParams(l).toString()}`,o);return c.data.title==="Error"&&console.log("error",c),c}catch(l){l.response.data.statusCode==401&&Ae().setLoggedIn(!1),Ve("IRONS",l),console.log(l)}},async changeHistoryCBMNew(t,s,a,i){const o={equipment:this.stateDetailCbm.equipment,component:s,taskKey:this.stateDetailCbm.taskKey,sampleDate:a?Xt(Yt(a)):"",ratingOri:t.ratingOri,ratingUpdate:t.ratingUpdate,valueOri:t.valueOri,valueUpdate:t.valueUpdate,interventionReason:this.stateDetailCbm.currentCondition.measurementLocation,workOrder:this.stateDetailCbm.workOrder};try{const l={userAccount:i,ver:"v1"},c=await ye.post(`${ua}?${new URLSearchParams(l).toString()}`,o);return c.data.title==="Error"&&console.log("error",c),c}catch(l){l.response.data.statusCode==401&&Ae().setLoggedIn(!1),console.log(l)}},setImagePerRowAverage(t,s){if(!this.stateModifiedObjectAvg.value[t])throw Error("never found index row");typeof this.stateModifiedObjectAvg.value[t].images=="string"&&(this.stateModifiedObjectAvg.value[t].images=[]);const i=s;this.stateModifiedObjectAvg.value[t].images=i},setImageManual(t){this.stateModifiedObjectMan.images=t},setImageAutomatic(t){this.stateModifiedObjectAut.images=t},setImageOilCooled(t){this.stateModifiedObjectOilCooled.images=t},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setInputErrorCbmAutomatic(t,s){this.stateInputError.measurementValue.errorMessage=t,this.stateInputError.measurementValue.isShowError=s},setInputErrorCbmManual(t,s){this.stateInputError.measurementRating.errorMessage=t,this.stateInputError.measurementRating.isShowError=s},setInputErrorCbmOilCooledPistonA(t,s){this.stateInputErrorOilCooled.pistonA.errorMessage=t,this.stateInputErrorOilCooled.pistonA.isShowError=s},setInputErrorCbmOilCooledPistonB(t,s){this.stateInputErrorOilCooled.pistonB.errorMessage=t,this.stateInputErrorOilCooled.pistonB.isShowError=s},initErrorInputCbmAverage(){this.stateInputErrorList=[],Array.from(this.stateDetailCbm.historyModifiedDefault).forEach(()=>{this.stateInputErrorList.push(Zt[0])})},setInputErrorCbmAverage(t,s,a){this.stateInputErrorList[t].measurementValue.errorMessage=s,this.stateInputErrorList[t].measurementValue.isShowError=a},setParamGetDetailCbm(t){this.stateParamGetDetailCbm.taskKey=t.taskKey,this.stateParamGetDetailCbm.workOrder=t.workOrder,this.stateParamGetDetailCbm.component=t.component},setAutomaticRating(t){this.stateModifiedObjectAut.measurementRating=t},setOilCooledPercentWorn(t){this.stateModifiedObjectOilCooled.pistonMovementRating=t},setOilCooledRating(t){this.stateModifiedObjectOilCooled.rating=t},setModifiedData(t,s,a){this.stateModifiedObjectAvg.value[t][s]=a},resetParamGetDetailCbm(){this.stateParamGetDetailCbm={...da}},resetList(){this.stateDetailCbm={},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1,this.stateIsUserCanRevise=!1},resetErrors(){this.stateErrors=[],this.stateIsError=!1,this.stateInputError={...ma},this.stateInputErrorList=[...Zt]}}}),Vl={class:"input-eform-status"},Kt=re({__name:"InputHistory",props:{item:{type:Object,required:!0}},setup(t){const s=t,a=it(s,"item"),i=S({get:()=>a.value.value,set:c=>{const r=c;a.value.value=r}}),o=S(()=>{const c=a.value.value.toString().replaceAll("'","");let r;return(a.value.categoryItemType=="targetRating"||a.value.itemType=="dropDown")&&(c=="A"?r="a":c=="B"?r="b":c=="C"?r="c":c=="X"&&(r="x")),r}),l=_();return St(async()=>{i.value=a.value.value}),jt(()=>{a.value={}}),Ze(s.item,c=>{a.value=c},{deep:!0}),(c,r)=>{const d=G("el-input");return n(),h("div",Vl,[f(d,{ref_key:"cbmInput",ref:l,class:be(o.value),modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=p=>i.value=p),size:"small",readonly:!0,disabled:!0},null,8,["class","modelValue"])])}}}),Tl={class:"input-eform-status"},Ea=re({__name:"InputHistoryAdjustment",props:{item:{type:String,required:!0}},setup(t){const s=t,a=it(s,"item"),i=S({get:()=>a.value,set:c=>{a.value=c}}),o=S(()=>{const c=s.item;let r;return c=="A"?r="a":c=="B"?r="b":c=="C"?r="c":c=="X"&&(r="x"),r}),l=_();return(c,r)=>{const d=G("el-input");return n(),h("div",Tl,[f(d,{ref_key:"cbmInput",ref:l,class:be([o.value]),modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=p=>i.value=p),size:"small",disabled:!0},null,8,["class","modelValue"])])}}}),$l={class:"pt-2"},xl={class:"d-flex justify-content-center"},Ll={class:"d-flex justify-content-center"},Nl={class:"btn btn-sm btn-icon btn-bg-light",disabled:""},Ul=["src"],Bl={key:0,id:"image-count",class:"d-flex justify-content-center ms-3"},Tt=re({__name:"SmallCamera",props:{item:{type:Object,required:!0},isUpdatedByCurrentUser:{type:Boolean,required:!0}},emits:["showPreviewImages"],setup(t,{emit:s}){const a=t,i=s,o=it(a,"item"),l=S(()=>o.value?Pt(o.value):[]),c=()=>{let d="/media/svg/dma/camera/e-form/png/cam-active.png";return a.isUpdatedByCurrentUser&&l.value.length>0?d="/media/svg/dma/camera/e-form/png/cam-user.png":a.isUpdatedByCurrentUser&&l.value.length==0?d="/media/svg/dma/camera/e-form/png/cam-active.png":!a.isUpdatedByCurrentUser&&l.value.length>0?d="/media/svg/dma/camera/e-form/png/cam-read.png":d="/media/svg/dma/camera/e-form/png/cam-active.png",d},r=()=>{i("showPreviewImages",l.value)};return(d,p)=>(n(),h("div",$l,[e("div",xl,[e("div",Ll,[e("button",Nl,[e("img",{src:c(),id:"icon-camera",style:{height:"12px",width:"14px"},alt:"camera"},null,8,Ul)])]),l.value&&l.value.length>0?(n(),h("div",Bl,[e("button",{class:"btn btn-sm btn-icon btn-bg-success text-white",onClick:r,style:{"background-color":"#18AF4A"}}," +"+g(l.value.length),1)])):Z("",!0)])]))}}),Gt=t=>(Je("data-v-068512db"),t=t(),We(),t),jl=Gt(()=>e("span",{class:"el-dialog__title",style:{"word-break":"break-word !important","font-size":"18px !important"}},"Detailed picture of Cab Side & Off Cab Side",-1)),Fl={class:"row d-flex flex-column"},Hl={key:0,class:"photo-wrapper"},ql=Gt(()=>e("span",{class:"sub-title"},[e("strong",null,"Cab Side")],-1)),Kl={class:"my-2",style:{"object-fit":"contain",cursor:"pointer","text-align":"center"}},Gl={class:"d-flex justify-content-center"},zl={style:{position:"relative",width:"fit-content"}},Jl=["src"],Wl=Gt(()=>e("div",{class:"my-2"},null,-1)),Zl={key:1,class:"photo-wrapper"},Xl=Gt(()=>e("span",{class:"sub-title"},[e("strong",null,"Off Cab Side")],-1)),Yl={class:"my-2",style:{"object-fit":"contain",cursor:"pointer","text-align":"center",position:"relative"}},Ql={class:"d-flex justify-content-center"},en={style:{position:"relative",width:"fit-content"}},tn=["src"],an=re({__name:"ImagePreviewCabSide",props:{visibility:{type:Boolean,required:!1},images:{type:Array,required:!0},viewOnly:{type:Boolean,default:!0}},emits:["onClose","onDelete"],setup(t,{expose:s,emit:a}){const i=t,o=a,l=_([]),c=it(i,"visibility"),r=_(0),d=_(!1),p=_(!1),C=ka("(min-width: 1000px)"),V=_(!1),b=_(""),x=_(!1),w=_(),I=_(),R=_(),$=_([]),P=S(()=>C.value?"70%":"90%"),E=async()=>{I.value=i.images.find(z=>z.type=="cab side"),I.value||(I.value=i.images.find(z=>!z.type)),I.value&&await u(I.value.filename)},q=async()=>{R.value=i.images.find(z=>z.type=="off cab side"),!R.value&&i.images.length>0&&(R.value=i.images.find(z=>{var ae;return z.filename!=((ae=I.value)==null?void 0:ae.filename)})),R.value&&await k(R.value.filename)},J=z=>{var ne;if(l.value.length<1)return;let ae;do ae=(ne=l.value.find(we=>we.key==z))==null?void 0:ne.value;while(!ae);return ae},M=()=>{c.value=!1,o("onClose",null)},v=()=>{$.value=i.images.map(z=>({imgBlob:z.filename,url:"",description:z.description}))},y=()=>{v(),r.value=0,l.value=[],i.images&&(E(),q())},u=async z=>{d.value=!0,await U(z),d.value=!1},k=async z=>{p.value=!0,await U(z),p.value=!1},U=async z=>{const ae={fileUrl:z,ver:"v1"};try{const ne=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(ae).toString()}`,we=await ye.getBlob(ne),ke=new Blob([we.data]);let X=window.URL||window.webkitURL;l.value.push({key:z,value:X.createObjectURL(ke)}),$.value.forEach(Pe=>{Pe.imgBlob==z&&(Pe.url=X.createObjectURL(ke))})}catch(ne){console.log("image",ne)}},O=z=>{const ae=$.value.findIndex(we=>we.imgBlob==z),ne=$.value[ae];if(ae>0){const we=$.value.slice(ae),ke=$.value.slice(0,ae);$.value=[...we,...ke]}b.value=ne.url,V.value=!0},T=()=>{b.value="",V.value=!1},m=z=>{x.value=!0,w.value=z},D=()=>{x.value=!1},Q=()=>{if(!w.value)return;const z={filename:w.value.filename,type:w.value.type};o("onDelete",z),w.value.type=="front"?I.value=void 0:R.value=void 0,w.value=void 0,x.value=!1};return s({openFirstReRender:()=>{y()}}),(z,ae)=>{const ne=G("el-skeleton-item"),we=G("NwImg"),ke=G("el-skeleton"),X=G("el-dialog");return n(),h(de,null,[f(X,{modelValue:c.value,"onUpdate:modelValue":ae[4]||(ae[4]=Pe=>c.value=Pe),title:"Detailed picture of Cab Side & Off Cab Side",width:P.value,onOpened:y,onClose:M},{title:F(()=>[jl]),default:F(()=>[e("div",Fl,[I.value?(n(),h("div",Hl,[ql,f(ke,{loading:d.value,animated:""},{template:F(()=>[f(ne,{variant:"image",class:"w-100 rounded",style:{height:"450px",width:"auto"}})]),default:F(()=>[e("div",Kl,[e("div",Gl,[e("div",zl,[t.viewOnly?Z("",!0):(n(),ee(we,{key:0,onClick:ae[0]||(ae[0]=Pe=>m(I.value)),class:"delete-image-button",src:"/media/svg/dma/image-close-button-red.png"})),J(I.value.filename)!=null?(n(),h("img",{key:1,src:J(I.value.filename),style:{height:"auto","max-width":"700px","max-height":"300px"},alt:"images",onClick:ae[1]||(ae[1]=Pe=>O(I.value.filename)),class:"front"},null,8,Jl)):Z("",!0)])])])]),_:1},8,["loading"])])):Z("",!0),Wl,R.value?(n(),h("div",Zl,[Xl,f(ke,{loading:p.value,animated:""},{template:F(()=>[f(ne,{variant:"image",class:"w-100 rounded",style:{height:"450px",width:"auto"}})]),default:F(()=>[e("div",Yl,[e("div",Ql,[e("div",en,[t.viewOnly?Z("",!0):(n(),ee(we,{key:0,onClick:ae[2]||(ae[2]=Pe=>m(R.value)),class:"delete-image-button",src:"/media/svg/dma/image-close-button-red.png"})),J(R.value.filename)!=null?(n(),h("img",{key:1,src:J(R.value.filename),style:{height:"auto","max-width":"700px","max-height":"300px"},alt:"images",class:"back",onClick:ae[3]||(ae[3]=Pe=>O(R.value.filename))},null,8,tn)):Z("",!0)])])])]),_:1},8,["loading"])])):Z("",!0)])]),_:1},8,["modelValue","width"]),f(_a,{visibility:x.value,caption:"Are you sure want to delete this image?",onOnNoConfirm:D,onOnYesConfirm:Q},null,8,["visibility"]),f(Ca,{images:$.value,visibility:V.value,image:b.value,onHandleClose:T},null,8,["images","visibility","image"])],64)}}}),sn=Be(an,[["__scopeId","data-v-068512db"]]),on={class:"row fullscreen-dialog-image-preview"},ln=e("div",{class:"bg-secondary"},null,-1),nn=["src","alt"],rn={class:"image-carousel-description"},cn=e("div",{class:"description-title"},"Description",-1),un={class:"description-text"},dn={style:{"font-family":"'Public sans' !important","font-size":"12px","text-wrap":"unset"}},mn=re({__name:"OfflineFullScreenDialog",props:{visibility:{type:Boolean,default:!1},image:{type:String,required:!0},images:{required:!0,type:Array},newVersion:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const a=t,i=s,o=ka("(min-width: 1000px)"),l=_(),c=_(""),r=it(a,"visibility"),d=_([]),p=_(),C=_(0),V=_(!1),b=_("0px"),x=_(0),w=_(0),I=_(0),R=_(0),$=_(0),P=async()=>{C.value=0,d.value=[],!(a.images.length<1)&&(V.value=!0,b.value="300px",window.setTimeout(()=>{V.value=!1;const v=a.images.findIndex(u=>u.url==a.image),y=v<0?0:v;$.value=y;do window.setTimeout(()=>{l.value&&l.value.setActiveItem(y)},500);while(!l.value);c.value=decodeURI(a.images[y].description),p.value=document.getElementsByClassName("carousel-image")[y],I.value=p.value.height,R.value=p.value.width,x.value=600,w.value=600,b.value=o.value?"600px":"450px",R.value<500&&I.value<250?(p.value.style.width=R.value+"px",p.value.style.height=I.value+"px",b.value="300px"):R.value>600&&I.value<250?(p.value.style.width=R.value+"px",p.value.style.height="auto",b.value="300px"):(p.value.style.height=o.value?"600px":"450px",p.value.style.width="auto",b.value=o.value?"600px":"450px")},500))},E=v=>{var u;C.value=0,(u=a.images[v])!=null&&u.imgBlob&&(c.value=decodeURI(a.images[v].description),p.value=document.getElementsByClassName("carousel-image")[v],p.value.style.transform=`rotate(${C.value}deg)`,R.value<500&&I.value<250?(p.value.style.width=R.value+"px",p.value.style.height=I.value+"px",b.value="300px"):R.value>600&&I.value<250?(p.value.style.width=R.value+"px",p.value.style.height="auto",b.value="300px"):(p.value.style.height=o.value?"600px":"450px",p.value.style.width="auto",b.value=o.value?"600px":"450px"))},q=()=>{d.value=[],i("handle-close")},J=()=>{C.value==360&&(C.value=0),C.value=C.value+90;const v=p.value;C.value==90||C.value==270?M(v):R.value<500&&I.value<250?(v.style.width=R.value+"px",v.style.height=I.value+"px",b.value="300px"):R.value>600&&I.value<250?(v.style.width=R.value+"px",v.style.height="auto",b.value="300px"):(v.style.height=o.value?"600px":"450px",v.style.width="auto",b.value=o.value?"600px":"450px"),v.style.transform=`rotate(${C.value}deg)`},M=v=>{const y=w.value/R.value;v.style.width=`${w.value}px`,v.style.height=`${I.value*y+300}px`,b.value=`${R.value*y+50}px`};return Ze(o,()=>{const v=document.getElementsByClassName("carousel-image")[$.value];if(C.value==90||C.value==270)M(v);else{if(!v)return;R.value<500&&I.value<250?(v.style.width=R.value+"px",v.style.height=I.value+"px",b.value="300px"):R.value>600&&I.value<250?(v.style.width=R.value+"px",v.style.height="auto",b.value="300px"):(v.style.height=o.value?"600px":"450px",v.style.width="auto",b.value=o.value?"600px":"450px")}}),(v,y)=>{const u=G("el-carousel-item"),k=G("el-carousel"),U=G("NwImg"),O=G("el-dialog");return n(),ee(O,{modelValue:r.value,"onUpdate:modelValue":y[0]||(y[0]=T=>r.value=T),title:"Detailed picture",width:"90%",onClosed:y[1]||(y[1]=T=>q()),top:"2vh",onOpened:P,"destroy-on-close":""},{default:F(()=>[e("div",on,[ln,f(k,{ref_key:"carousel",ref:l,"indicator-position":"none",trigger:"click",height:b.value,interval:2147483647,arrow:"always",onChange:E,loop:"false"},{default:F(()=>[(n(!0),h(de,null,Ne(t.images,T=>(n(),ee(u,{key:T.imgBlob},{default:F(()=>[e("img",{src:T.url,class:"carousel-image",alt:T.imgBlob},null,8,nn)]),_:2},1024))),128))]),_:1},8,["height"]),e("div",{class:"rotate-button",onClick:J},[f(U,{src:"/media/icons/bumaau/rotate.png",width:"60"})]),e("div",rn,[cn,e("div",un,[e("pre",dn,g(c.value),1)])])])]),_:1},8,["modelValue"])}}}),pn=Ht({id:"offline-camera",state:()=>({stateIsVisible:!1,stateImageObjects:[],stateCurrentObject:{},stateShowCloseButton:!0,stateIsCameraError:!1,stateDumpToLocalInfo:{},stateImage:"",stateBlob:void 0,stateIsActionFromDelete:!1,stateIsReplacement:!1,stateReplacementTool:"",stateReplacementPhotoLength:0,stateReplacementPosition:"cab side"}),getters:{isVisible:t=>t.stateIsVisible,currentImage:t=>t.stateImage,currentBlob:t=>t.stateBlob,ImageObjects:t=>t.stateImageObjects,Current:t=>t.stateCurrentObject,ShowCloseButton:t=>t.stateShowCloseButton,IsFromActionDelete:t=>t.stateIsActionFromDelete,isReplacementCamera:t=>t.stateIsReplacement,replacementTool:t=>t.stateReplacementTool,replacementPhotoLength:t=>t.stateReplacementPhotoLength,replacementPosition:t=>t.stateReplacementPosition},actions:{setImage(t){this.stateImage=t},setBlob(t){this.stateBlob=t},resetImage(){this.stateImage="s"},setCameraVisible(t){this.stateIsVisible=t},setIsCameraError(t){this.stateIsCameraError=t},setShowCloseButton(t){this.stateShowCloseButton=t},setIsActionFromDelete(t){this.stateIsActionFromDelete=t},setCurrent(t){this.stateImageObjects.find(a=>a.Id===t)||this.stateImageObjects.push({Id:t,ImageInfos:[],ImageBlobs:[]}),this.stateCurrentObject=this.stateImageObjects.find(a=>a.Id===t)},toggleIsVisible(t,s=null){s&&this.setCurrent(s),t&&(this.stateIsCameraError=!1),this.stateIsVisible=t},setUploadedFiles(t,s,a=null){a&&this.setCurrent(a),this.stateCurrentObject.ImageInfos=Pt(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageInfos=this.stateCurrentObject.ImageInfos.concat(t),this.stateCurrentObject.ImageBlobs=this.stateCurrentObject.ImageBlobs.concat(s)},addPhoto(t,s){this.stateCurrentObject.ImageInfos=Pt(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageBlobs.push(t),this.stateCurrentObject.ImageInfos.push(s)},definePhoto(t,s){this.stateCurrentObject.ImageInfos=Pt(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageBlobs=[t],this.stateCurrentObject.ImageInfos=[s]},clearCurrent(){this.stateCurrentObject.ImageBlobs=[],this.stateCurrentObject.ImageInfos=[]},addLocalImageInfo(t){this.stateDumpToLocalInfo=t},clearImageById(t){const s=this.stateImageObjects.find(a=>a.Id===t);s&&(s.ImageBlobs=[],s.ImageInfos=[])},reset(){this.stateIsVisible=!1,this.stateImageObjects=[],this.stateCurrentObject={},this.stateDumpToLocalInfo={},this.stateIsActionFromDelete=!1},setIsReplacementCamera(t){this.stateIsReplacement=t},setReplacementTool(t){this.stateReplacementTool=t},setReplacementPhotoLength(t){this.stateReplacementPhotoLength=t},setReplacementPosition(t){this.stateReplacementPosition=t}}}),hn={key:0,class:"text-center"},gn={style:{height:"100px"}},vn={key:0},fn={class:"row my-4"},yn={key:0,class:"bg-secondary"},bn=["src","onClick"],_n=["onClick"],Cn={key:0,class:"row mt-7 mb-0"},wn=e("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),kn=[wn],Sn=re({__name:"ImageListModal",props:{visibility:{type:Boolean,default:!1},images:{type:Array,required:!0},showDeleteButton:{type:Boolean,default:!0},showRemainingPhotosMessage:{default:!1,type:Boolean}},emits:["handle-close","handle-delete"],setup(t,{emit:s}){const a=t,i=s,o=_(!1),l=_(!1),c=_(""),r=pn(),d=y=>{const u=$.value.findIndex(U=>U.imgBlob==y),k=$.value[u];if(u>0){const U=$.value.slice(u),O=$.value.slice(0,u);$.value=[...U,...O]}c.value=k.url,l.value=!0},p=()=>{c.value="",l.value=!1},C=it(a,"visibility"),V=S(()=>ht.cloneDeep(a.images)),b=_([]),x=_(!1),w=_(""),I=_(!1),R=async()=>{var y;if(P(),o.value=!0,b.value=[],((y=V.value)==null?void 0:y.length)>0){let u=0;$.value.forEach(async k=>{var O;const U={fileUrl:`${k.imgBlob}`,ver:"v1"};try{const T=await Wt.pendingTaskFile.where({filename:k.imgBlob}).first(),m=window.URL||window.webkitURL;if(!T&&!oa()){const D=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(U).toString()}`,W=(await ye.getBlob(D)).data,z=new Blob([W]);await $a(Wt,"pendingTaskFile",{key:r.stateDumpToLocalInfo.taskKey,module:"serviceForm",workorder:r.stateDumpToLocalInfo.workOrder,type:z.type,fileType:"webp",createdBy:r.stateDumpToLocalInfo.updatedBy,email:r.stateDumpToLocalInfo.email,filename:k.imgBlob,originalFilename:k.imgBlob,blob:z,syncStatus:"Sync",syncDate:Za()}),k.url=m.createObjectURL(z)}else ht.isUndefined(T)?k.url="":k.url=m.createObjectURL(T.blob);u++,u==((O=V.value)==null?void 0:O.length)&&(o.value=!1)}catch(T){console.log("image",T)}})}},$=_([]),P=()=>{const y=a.images;$.value=y==null?void 0:y.map(u=>({imgBlob:u.filename,url:"",description:u.description}))},E=y=>{!a.images||a.images.length==0||(w.value=a.images[y],x.value=!0)},q=()=>{x.value=!1},J=()=>{x.value=!1,M()},M=async()=>{var U;const y={ver:"v1",fileUrl:w.value},u={},k=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/delete_by_url?${new URLSearchParams(y).toString()}`;try{o.value=!0,I.value=!0,oa()?await Wt.pendingTaskFile.filter(O=>O.filename==w.value).delete():await ye.post(`${k}?${new URLSearchParams(y).toString()}`,u),i("handle-delete",w.value)}catch(O){console.log("delete image",O)}finally{o.value=!1,I.value=!1,((U=a.images)==null?void 0:U.length)==0&&v()}};St(async()=>{R()}),Ze(V,async(y,u)=>{(y==null?void 0:y.length)==0&&v(),(y==null?void 0:y.length)!=(u==null?void 0:u.length)&&await R()},{deep:!0});const v=()=>{i("handle-close",!1)};return(y,u)=>{const k=G("el-skeleton-item"),U=G("el-dialog"),O=He("loading");return n(),h(de,null,[f(U,{modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=T=>C.value=T),title:"Detailed picture",width:"80%",onClose:u[1]||(u[1]=T=>v())},{default:F(()=>[o.value?(n(),h("div",hn,[ue(e("div",gn,null,512),[[O,o.value]]),I.value?(n(),h("span",vn,"deleting image...")):Z("",!0)])):(n(),h(de,{key:1},[e("div",fn,[(n(!0),h(de,null,Ne($.value,(T,m)=>(n(),h("div",{key:T.imgBlob,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[T.url?(n(),h("div",yn,[e("img",{src:T.url,alt:"img",class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:D=>d(T.imgBlob)},null,8,bn),t.showDeleteButton?(n(),h("img",{key:0,onClick:D=>E(m),alt:"delete",class:"delete-image-button",src:ds},null,8,_n)):Z("",!0)])):(n(),ee(k,{key:1,variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}}))]))),128))]),t.showRemainingPhotosMessage?(n(),h("div",Cn,kn)):Z("",!0)],64))]),_:1},8,["modelValue"]),f(_a,{visibility:x.value,caption:"Are you sure want to delete this image?",onOnNoConfirm:q,onOnYesConfirm:J},null,8,["visibility"]),l.value?(n(),ee(mn,{key:0,images:$.value,visibility:l.value,image:c.value,onHandleClose:p},null,8,["images","visibility","image"])):Z("",!0)],64)}}}),In={class:"m-0 p-0",style:{"font-weight":"normal"}},Dn={class:"dialog-footer"},Ma=re({__name:"TakeReplacementPhoto",props:{show:{type:Boolean,required:!0},item:{type:Object,required:!0},tool:{type:String,required:!0},side:{type:String,required:!0}},emits:["close"],setup(t,{emit:s}){const a=t,i=S({get(){return a.show},set(c){return c}}),o=s,l=()=>{o("close")};return(c,r)=>{const d=G("el-button"),p=G("el-dialog");return n(),ee(p,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=C=>i.value=C),width:480,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"replacement-dialog"},{footer:F(()=>[e("span",Dn,[f(d,{class:"replacement-button",onClick:l},{default:F(()=>[he(" Take a Photo ")]),_:1})])]),default:F(()=>[e("p",In,[he(" Please take a photo of the "),e("b",null,g(t.tool),1),he(" from the "),e("b",null,g(t.side),1),he(" with the cover removed ")])]),_:1},8,["modelValue"])}}}),En=["disabled"],Mn=["src"],An={class:"text-white"},Dt=re({__name:"SmallCamera",props:{itemkey:{default:"modifiedCBM"},images:{type:Object,required:!0},isMandatory:{type:Boolean,required:!1,default:!1},isReplacement:{type:Boolean,required:!1,default:!1},item:{type:Object,required:!1},sectionData:{type:String}},emits:["onHandleImages"],setup(t,{emit:s}){const a=t,i=s,o=_(!1),l=it(a,"images"),c=_(!1),r=It(),d=ct(()=>l.value?l.value:[]),p=(v=!1)=>{r.setIsReplacementCamera(a.isReplacement),r.toggleIsVisible(!0,a.itemkey),r.setIsActionFromDelete(v),a.isReplacement?r.setShowCloseButton(!a.isMandatory):r.setShowCloseButton(a.isMandatory?l.value.length>0:!a.isMandatory),o.value=!1},C=ct(()=>ht.cloneDeep(r.ImageObjects.find(v=>v.Id===a.itemkey))),V=ct(()=>{let v="";switch(a.sectionData){case"HV Alternator":v="alternator";break;case"Retarder Grid Box 1":case"Retarder Grid Box 2":v="blower motor";break}return v}),b=()=>{let v="/media/svg/dma/camera/e-form/png/cam-active.png";return d.value.length>0&&(v="/media/svg/dma/camera/e-form/png/cam-user.png"),v},x=ct(()=>a.isMandatory&&d.value.length>1?!0:!a.isMandatory),w=()=>{c.value=!0},I=()=>{c.value=!1},R=async v=>{const y=l.value,u=v.filename?v.filename:v,k=y.filter(U=>U.filename!=u);r.setCurrent(a.itemkey),i("onHandleImages",k),r.clearCurrent(),a.isReplacement&&(r.setIsReplacementCamera(a.isReplacement),k.length<2&&(r.setReplacementPosition(v.type),E())),k.length==0&&I()},$=_(!1),P=()=>{$.value=!1},E=()=>{$.value=!1,p()},q=async()=>{o.value=!1;const v=r.ImageObjects.find(u=>u.Id===a.itemkey),y=v?[...l.value,...v.ImageInfos]:[];r.clearCurrent(),i("onHandleImages",y),a.isReplacement&&y.length<=1&&(o.value=!0,r.setReplacementPhotoLength(y.length),r.setIsActionFromDelete(!1))},J=ct(()=>{let v=!1;return a.isReplacement&&d.value.length===2&&(v=!0),v});Ze(C,async(v,y)=>{v&&v.ImageInfos.length>0&&v.ImageInfos.length!=(y==null?void 0:y.ImageInfos.length)&&(await q(),I())},{deep:!0});const M=ct(()=>{var y;let v="pb-2";return(y=a.task)!=null&&y.updatedBy&&a.task.updatedBy.name&&(v=""),v});return(v,y)=>(n(),h("div",{class:be([[K(M)],"pt-2"])},[e("div",{class:be(["row",!K(ht.isUndefined)(l.value)&&l.value.length>0?"d-flex":""])},[e("button",{class:"btn btn-sm btn-icon btn-bg-light me-5",onClick:y[0]||(y[0]=u=>p()),disabled:K(J)},[e("img",{src:b(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,Mn)],8,En),K(d)&&K(d).length>0?(n(),h("button",{key:0,class:"btn btn-sm btn-icon btn-bg-success",onClick:w,style:{"background-color":"#18af4a"}},[e("label",An,"+"+g(K(d).length),1)])):Z("",!0)],2),c.value?(n(),h(de,{key:0},[t.isReplacement?(n(),ee(sn,{key:0,ref:"preview",images:K(d),visibility:c.value,"view-only":!1,onOnClose:I,onOnDelete:R},null,8,["images","visibility"])):(n(),ee(Sn,{key:1,images:K(d),visibility:c.value,showDeleteButton:K(x),onHandleClose:I,onHandleDelete:R,showRemainingPhotosMessage:t.isMandatory},null,8,["images","visibility","showDeleteButton","showRemainingPhotosMessage"]))],64)):Z("",!0),f(Ma,{show:o.value,item:a.item,tool:K(V),side:"off cab side",onClose:E},null,8,["show","item","tool"]),f(Ia,{visibility:$.value,caption:"The photo successfully taken, would you like to take another photo?",onOnNoConfirm:P,onOnYesConfirm:E},null,8,["visibility"])],2))}}),Aa=t=>(Je("data-v-ca4d3b64"),t=t(),We(),t),Pn={key:0,class:"condition-modified my-5"},On={class:"table table-bordered"},Rn=Aa(()=>e("caption",null,null,-1)),Vn=Aa(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"Task"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Measurement Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating"),e("th",{scope:"col",class:"table-header"})])],-1)),Tn={scope:"row",class:"ps-3 align-middle"},$n={scope:"row",class:"align-middle"},xn={scope:"row",class:"align-middle"},Ln={scope:"row",class:"align-middle"},Nn={scope:"row",class:"align-middle"},Un={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Bn={scope:"row",class:"align-middle"},jn={key:1,class:"history-modified"},Fn={class:"row w-100 table table-bordered"},Hn=Ft('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-ca4d3b64><div class="col-1 py-3 table-header" data-v-ca4d3b64>Task</div><div class="col-3 py-3 table-header" data-v-ca4d3b64>Measurement Location</div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Measurement Value</div><div class="col-1 py-3 table-header" data-v-ca4d3b64>UoM</div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Rating</div><div class="col-1 py-3 table-header" data-v-ca4d3b64></div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Action</div></div>',1),qn={key:0},Kn={class:"d-flex align-items-center col-1 table-value"},Gn={class:"d-flex align-items-center col-3 table-value"},zn={class:"d-flex align-items-center col-2 table-value"},Jn={class:"d-flex align-items-center col-1 table-value"},Wn={class:"d-flex align-items-center col-2 table-value"},Zn={class:"col-1 table-value"},Xn={class:"d-flex align-items-center col-2 table-value"},Yn={key:0,class:"row px-0 mx-0"},Qn={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},er={key:1,class:"row px-0 mx-0"},tr={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},ar={key:1,class:"col-12 table-header text-center py-8"},sr=re({__name:"CbmAutomaticTable",props:{isModifying:{type:Boolean,required:!0,default:!1},detailCbm:{type:Object,required:!0},source:{type:String,required:!1,default:"serviceSheet"}},setup(t){const s=t,a=Ae(),i=gt(),o=S(()=>s.detailCbm.historyModifiedDefault[0].items[0].description=="Adjustment"),l=S(()=>i.inputError),c=S(()=>s.source=="intervention"&&s.detailCbm&&s.detailCbm.historyModified&&s.detailCbm.historyModified.detail.history.length>1?!0:!!(s.source!="intervention"&&s.detailCbm&&s.detailCbm.historyModified&&s.detailCbm.historyModified.detail.history.length>0)),r=S(()=>s.detailCbm.historyModifiedDefault[0].rating=="CALIPER"),d=S(()=>i.modifiedObjAut),p=S(()=>s.detailCbm.currentCondition.taskNo),C=S(()=>{let m=s.detailCbm.historyModifiedDefault[0].description.split(";")[0];return s.detailCbm.historyModifiedDefault[0].description.split(";")[1]!=""&&(m+=s.detailCbm.historyModifiedDefault[0].description.split(";")[1]),p.value==""?m:p.value.replace(/[^a-z]/gi,"").length>1?p.value.replace(";","").replace(/\D/g,""):p.value.replace(";","")}),V=m=>{const D=m.items[0].value;let Q=m.description.split(";")[0];return m.description.split(";")[1]!=""&&(Q+=m.description.split(";")[1]),D==""?Q:D},b=S(()=>{if(r.value)return x();let m="";for(const D of s.detailCbm.historyModifiedDefault[0].items)D.itemType==="html"&&(m=D.value);return m!=""?m:s.detailCbm.currentCondition.measurementLocation}),x=()=>{let m="";return s.detailCbm.historyModifiedDefault&&(m+=s.detailCbm.historyModifiedDefault[0].description.split(";")[1],m+=". ",m+=s.detailCbm.historyModifiedDefault[0].description.split(";")[2]),m},w=S({get:()=>i.modifiedObjAut.measurementValue,set:m=>{if(!isNaN(Number(m))){{if(m.length>8)return;if((`${m}`.split(".")||[]).length-1>1)return;if(m.includes(".")){if(`${m}`.split(".")[1].length>2)return;d.value.measurementValue=m}}if(m.length>5&&m.length>=6&&m.length<=6){if(m[5]!=".")return;d.value.measurementValue=m}d.value.measurementValue=m}}}),I=m=>r.value?x():m.items[2].itemType!="input"?m.items[2].value:m.items.find(Q=>Q.itemType=="html").value,R=m=>{if(o.value&&m.cbmAdjustmentReplacementValue)return m.cbmAdjustmentReplacementValue.measurement;const D=m.items.find(Q=>Q.categoryItemType=="paramRating"||Q.categoryItemType=="paramRatingDynamic");return D?D.value:""},$=m=>{if(o.value&&m.cbmAdjustmentReplacementValue)return m.cbmAdjustmentReplacementValue.uom;const D=m.items.find(Q=>Q.categoryItemType=="targetTool");if(D)return D.value;if(D)return"";{const Q=m.items.findIndex(W=>W.categoryItemType=="paramRating"||W.categoryItemType=="paramRatingDynamic");return m.items[Q+1].value}},P=m=>{const D=m.find(Q=>Q.categoryItemType=="targetRating");return D||{}},E=m=>m.cbmAdjustmentReplacementValue.rating,q=m=>{if(m.isUpdatePhoto!=null&&!m.isUpdatePhoto)return[];if(o.value&&m.cbmAdjustmentReplacementValue)return m.cbmAdjustmentReplacementValue.pictures;if(s.source=="intervention")return m.pictures;const D=m.items.find(Q=>Q.itemType=="smallCamera");return D?D.value:[]},J=m=>{let D=m.keyCode?m.keyCode:m.which;D!=46&&(D<48||D>57)&&m.preventDefault()},M=m=>{let D;return m=="A"?D="a":m=="B"?D="b":m=="C"?D="c":m=="X"&&(D="x"),D},v=m=>{i.setImageAutomatic(m)},y=()=>{i.resetErrors(),i.setInputErrorCbmAutomatic("",!1);let m;if(m=parseFloat(w.value),w.value=String(m),d.value.measurementValue==""){i.setInputErrorCbmAutomatic("This field is Required",!0),i.setErrors(["Please Check the form again"]);return}if(!_t(d.value.measurementValue)){i.setInputErrorCbmAutomatic("Max. 2 decimal digits",!0),i.setErrors(["Please Check the form again"]);return}let D=u();if(!D){i.setInputErrorCbmAutomatic("Out of range",!0),i.setErrors(["Please Check the form again"]);return}i.setAutomaticRating(D)},u=()=>{let m;const Q=s.detailCbm.detailSpec.filter(W=>W.uom==d.value.uom);if(Q.length>0)return d.value.measurementValue===""?void 0:(Q.every(W=>{const z=Ct(W,d.value.measurementValue),ae=wt(W,d.value.measurementValue);return m=kt(z,ae,W),!m}),m)},k=_(!1),U=_([]),O=()=>{k.value=!1},T=m=>{U.value=m,k.value=!0};return(m,D)=>{const Q=G("el-input");return n(),h(de,null,[s.isModifying?(n(),h("div",Pn,[e("table",On,[Rn,Vn,e("tbody",null,[e("tr",null,[e("th",Tn,g(C.value),1),e("th",$n,g(b.value),1),e("th",xn,[f(Q,{modelValue:w.value,"onUpdate:modelValue":D[0]||(D[0]=W=>w.value=W),class:"mb-0",onKeypress:J,onFocusout:y},null,8,["modelValue"]),ue(e("span",{class:"text-danger font-weight-bold"},g(l.value.measurementValue.errorMessage),513),[[ut,l.value.measurementValue.isShowError]])]),e("th",Ln,g(d.value.uom),1),e("th",Nn,[e("div",Un,[f(Q,{modelValue:d.value.measurementRating,"onUpdate:modelValue":D[1]||(D[1]=W=>d.value.measurementRating=W),placeholder:"Rating",class:be(M(d.value.measurementRating)),disabled:"",readonly:""},null,8,["modelValue","class"])])]),e("th",Bn,[f(Dt,{images:d.value.images,"is-mandatory":!1,onOnHandleImages:v},null,8,["images"])])])])])])):(n(),h("div",jn,[e("div",Fn,[Hn,c.value?(n(),h("div",qn,[(n(!0),h(de,null,Ne(t.detailCbm.historyModified.detail.history,(W,z)=>(n(),h("div",{key:z,class:"row px-0 mx-0 row-histories"},[e("div",Kn,[e("span",null,g(V(W)),1)]),e("div",Gn,[e("span",null,g(I(W)),1)]),e("div",zn,[e("span",null,g(R(W)),1)]),e("div",Jn,[e("span",null,g($(W)),1)]),e("div",Wn,[o.value&&W.cbmAdjustmentReplacementValue?(n(),ee(Ea,{key:0,item:E(W),task:W},null,8,["item","task"])):(n(),ee(Kt,{key:1,item:P(W.items)},null,8,["item"]))]),e("div",Zn,[f(Tt,{item:q(W),"is-updated-by-current-user":W.updatedBy.id==K(a).user.EmployeeId,onShowPreviewImages:T},null,8,["item","is-updated-by-current-user"])]),e("div",Xn,g(t.detailCbm.historyModified.detail.history.length-1==z?"IronForms":"IronPortal"),1),o.value&&W.cbmAdjustmentReplacementValue?(n(),h("div",Yn,[e("div",Qn,g(W.cbmAdjustmentReplacementValue.updatedBy.name)+", "+g(W.cbmAdjustmentReplacementValue.updatedDate),1)])):W.updatedBy.name?(n(),h("div",er,[e("div",tr,g(W.updatedBy.name)+", "+g(W.updatedDate),1)])):Z("",!0)]))),128))])):(n(),h("div",ar,"No Data Recorded"))])])),k.value?(n(),ee(qt,{key:2,type:"task","re-render":!1,images:U.value,"show-delete-button":!1,"is-mandatory":!1,visibility:k.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:O},null,8,["images","visibility"])):Z("",!0)],64)}}}),or=Be(sr,[["__scopeId","data-v-ca4d3b64"]]),$t=t=>(Je("data-v-cc221bfc"),t=t(),We(),t),ir={key:0,class:"condition-modified my-5"},lr={class:"table table-bordered"},nr=$t(()=>e("caption",null,null,-1)),rr=$t(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"Task"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Measurement Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating"),e("th",{scope:"col",class:"table-header"})])],-1)),cr=["textContent"],ur=["textContent"],dr={scope:"row",class:"align-middle"},mr=["textContent"],pr=["textContent"],hr={scope:"row",class:"align-middle"},gr={key:0,class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},vr={scope:"row",class:"align-middle"},fr={key:1,class:"history-modified"},yr={class:"table table-bordered"},br=$t(()=>e("caption",null,null,-1)),_r=$t(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header px-4"},"Task"),e("th",{scope:"col",class:"table-header px-4"},"Measurement Location"),e("th",{scope:"col",class:"table-header px-4"},"Measurement Value"),e("th",{scope:"col",class:"table-header px-4"},"UoM"),e("th",{scope:"col",class:"table-header px-4"},"Rating"),e("th",{scope:"col",class:"table-header px-4",colspan:"2"},"Action")])],-1)),Cr={key:0},wr=["textContent"],kr=["textContent"],Sr={class:"p-4 align-middle"},Ir=["textContent"],Dr={class:"p-4 align-middle input-eform-status"},Er={class:"p-4 align-middle"},Mr=["textContent"],Ar={key:0},Pr={class:"timestamp-task text-end m-auto px-5 py-0",colspan:"9"},Or={key:1},Rr=$t(()=>e("tr",null,[e("td",{colspan:"6",class:"table-header text-center py-8"},"No Data Recorded")],-1)),Vr=[Rr],Tr=re({__name:"CbmAvgTable",props:{isModifying:{type:Boolean,required:!0,default:!1}},setup(t){const s=It(),a=Ae(),i=gt(),o=t,l=S(()=>i.modifiedObjectAvg),c=S(()=>i.detailCbm),r=S(()=>i.inputErrorList),d=u=>{const k=c.value.historyModifiedDefault[0].description.split(";")[0];return u==""?k:u},p=u=>{if(u.isUpdatePhoto!=null&&!u.isUpdatePhoto)return[];const k=u.items.find(U=>U.itemType=="smallCamera");return k?k.value:[]},C=()=>{const u=l.value.value.findIndex(O=>O.measurementValue==""),k=l.value.value.length-1;if(u!=-1&&u!=k){i.stateIsError=!0;return}let U=0;for(let O=0;O<k;O++){if(isNaN(Number(l.value.value[O].measurementValue))){i.setModifiedData(k,"measurementValue",""),i.setModifiedData(k,"measurementRating","");return}U+=Number(l.value.value[O].measurementValue)}i.setModifiedData(k,"measurementValue",parseFloat((U/(l.value.value.length-1)).toString()).toFixed(2).toString()),x(k)},V=u=>{let k=u.keyCode?u.keyCode:u.which;k!=46&&(k<48||k>57)&&u.preventDefault()},b=u=>{if(i.resetErrors(),i.stateInputErrorList.length!=c.value.historyModifiedDefault.length&&i.initErrorInputCbmAverage(),l.value.value[u].measurementValue==""){i.setInputErrorCbmAverage(u,"This field is required",!0),i.setErrors(["Please Check the form again"]);return}if(!w(u)){i.setInputErrorCbmAverage(u,"Max. 2 decimal digits",!0),i.setErrors(["Please Check the form again"]);return}i.setInputErrorCbmAverage(u,"",!1),q(u),C()},x=u=>{const k=c.value.detailSpec,U=l.value.value[u];if(!(k.length>0)||U.measurementValue==="")return;let m;k.every(D=>{const Q=Ct(D,U.measurementValue),W=wt(D,U.measurementValue);return m=kt(Q,W,D),!m}),i.setModifiedData(u,"measurementRating",m||"")},w=u=>_t(l.value.value[u].measurementValue),I=_(),R=u=>{const k=I.value;!k&&k!==0||i.setImagePerRowAverage(k,u)},$=u=>{let k;return u=="A"?k="a":u=="B"?k="b":u=="C"?k="c":u=="X"&&(k="x"),k},P=u=>{const k=c.value.historyModifiedDefault[u].items[3].customValidation;if(!k)return!1;let U=l.value.value[u].measurementValue;return k=="cbmTakePhotoAllRating"?!0:k=="cbmDefectTakePhoto"&&(U=="C"||U=="X")},E=u=>{s.toggleIsVisible(!0,"modifiedCBM"),s.setShowCloseButton(u)},q=u=>{l.value.value[u].images.length<1&&P(u)&&E(!1)},J=_(!1),M=_([]),v=()=>{J.value=!1},y=u=>{M.value=u,J.value=!0};return(u,k)=>{var O,T;const U=G("el-input");return n(),h(de,null,[o.isModifying?(n(),h("div",ir,[e("table",lr,[nr,rr,e("tbody",null,[(n(!0),h(de,null,Ne(c.value.historyModifiedDefault,(m,D)=>{var Q,W,z,ae;return n(),h("tr",{key:`cbm-avg-table-edit-${D}`},[e("th",{scope:"row",class:"ps-3 align-middle",textContent:g(m.items[1].value)},null,8,cr),e("th",{scope:"row",class:"align-middle",textContent:g(m.items[2].value)},null,8,ur),e("th",dr,[f(U,{modelValue:l.value.value[D].measurementValue,"onUpdate:modelValue":ne=>l.value.value[D].measurementValue=ne,onKeypress:V,onChange:ne=>b(D),disabled:m.items[3].categoryItemType=="resultParamRating"},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),(W=(Q=r.value[D])==null?void 0:Q.measurementValue)!=null&&W.isShowError?(n(),h("span",{key:0,class:"text-danger font-weight-bold",textContent:g((ae=(z=r.value[D])==null?void 0:z.measurementValue)==null?void 0:ae.errorMessage)},null,8,mr)):Z("",!0)]),e("th",{scope:"row",class:"align-middle",textContent:g(l.value.value[D].uom)},null,8,pr),e("th",hr,[m.items[5].itemType!="label"?(n(),h("div",gr,[f(U,{modelValue:l.value.value[D].measurementRating,"onUpdate:modelValue":ne=>l.value.value[D].measurementRating=ne,placeholder:"Rating",class:be($(l.value.value[D].measurementRating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):Z("",!0)]),e("th",vr,[f(Dt,{itemkey:`avg-img-${D}`,onClick:ne=>I.value=D,images:K(i).modifiedObjectAvg.value[D].images,onOnHandleImages:k[0]||(k[0]=ne=>R(ne))},null,8,["itemkey","onClick","images"])])])}),128))])])])):(n(),h("div",fr,[e("table",yr,[br,_r,c.value.historyModified&&((O=c.value.historyModified.detail)==null?void 0:O.history.length)>0?(n(),h("tbody",Cr,[(n(!0),h(de,null,Ne((T=c.value.historyModified.detail)==null?void 0:T.history,(m,D)=>{var Q,W;return n(),h(de,{key:D},[e("tr",null,[e("td",{class:"p-4 align-middle",textContent:g(d(m.items[0].value))},null,8,wr),e("td",{class:"p-4 align-middle",textContent:g(m.items[2].value)},null,8,kr),e("td",Sr,[f(U,{class:"input-overwrite-cbm",modelValue:m.items[3].value,"onUpdate:modelValue":z=>m.items[3].value=z,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),e("td",{class:"p-4 align-middle",textContent:g(m.items[4].value)},null,8,Ir),e("td",Dr,[f(U,{class:be(["input-overwrite-cbm",$(m.items[5].value)]),modelValue:m.items[5].value,"onUpdate:modelValue":z=>m.items[5].value=z,placeholder:"Measurement Value",disabled:""},null,8,["class","modelValue","onUpdate:modelValue"])]),e("td",Er,[f(Tt,{item:p(m),"is-updated-by-current-user":m.updatedBy.id==K(a).user.EmployeeId,onShowPreviewImages:y},null,8,["item","is-updated-by-current-user"])]),e("td",{class:"p-4 align-middle",textContent:g(c.value.historyModified.detail.history.length-1==D?"IronForms":"IronPortal")},null,8,Mr)]),(Q=m.updatedBy)!=null&&Q.name?(n(),h("tr",Ar,[e("td",Pr,g((W=m==null?void 0:m.updatedBy)==null?void 0:W.name)+", "+g(m==null?void 0:m.updatedDate),1)])):Z("",!0)],64)}),128))])):(n(),h("tbody",Or,Vr))])])),J.value?(n(),ee(qt,{key:2,type:"task","re-render":!1,images:M.value,"show-delete-button":!1,"is-mandatory":!1,visibility:J.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:v},null,8,["images","visibility"])):Z("",!0)],64)}}}),$r=Be(Tr,[["__scopeId","data-v-cc221bfc"]]),Pa=t=>(Je("data-v-4b2a6092"),t=t(),We(),t),xr={key:0,class:"condition-modified my-5"},Lr={class:"table table-bordered"},Nr=Pa(()=>e("caption",null,null,-1)),Ur=Pa(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-2"},"Task"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Rating"),e("th",{scope:"col",class:"table-header"})])],-1)),Br={scope:"row",class:"ps-2"},jr={scope:"row"},Fr={scope:"row"},Hr={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},qr={class:"text-danger font-weight-bold"},Kr={scope:"row"},Gr={key:1,class:"history-modified"},zr={class:"row w-100 table table-bordered"},Jr=Ft('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-4b2a6092><div class="col-1 py-3 table-header" data-v-4b2a6092>Task</div><div class="col-4 py-3 table-header" data-v-4b2a6092>Measurement Location</div><div class="col-4 py-3 table-header" data-v-4b2a6092>Rating</div><div class="col-1 py-3 table-header" data-v-4b2a6092></div><div class="col-2 py-3 table-header" data-v-4b2a6092>Action</div></div>',1),Wr={key:0},Zr={class:"row px-0 mx-0 row-histories"},Xr={class:"d-flex align-items-center col-1 table-value"},Yr={class:"d-flex align-items-center col-4 table-value"},Qr={class:"d-flex align-items-center col-4 table-value"},ec={class:"col-1 table-value"},tc={class:"d-flex align-items-center col-2 table-value"},ac={key:0,class:"row px-0 mx-0"},sc={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},oc={key:1,class:"col-12 table-header text-center py-8"},ic=re({__name:"CbmNormalTable",props:{isModifying:{type:Boolean,required:!0,default:!1},source:{type:String,required:!1,default:"serviceSheet"}},setup(t){const s=t,a=gt(),i=Ae(),o=S(()=>a.inputError),l=S(()=>a.modifiedObjMan),c=S(()=>a.detailCbm),r=()=>{a.resetErrors(),a.setInputErrorCbmManual("",!1),l.value.measurementRating==""&&(a.setInputErrorCbmManual("This field is Required",!0),a.setErrors(["Please Check the form again"]))},d=P=>{let E;return P=="A"?E="a":P=="B"?E="b":P=="C"?E="c":P=="X"&&(E="x"),E},p=S(()=>{let P="";for(const E of c.value.historyModifiedDefault[0].items)E.itemType==="html"&&(P=E.value);return P!=""?P:c.value.currentCondition.measurementLocation}),C=P=>P.items[2].itemType!="input"?P.items[2].value:P.items.find(q=>q.itemType=="html").value,V=P=>{const E=P.find(J=>J.categoryItemType=="resultRating"),q=P.find(J=>J.itemType=="dropDown");return E||q||{}},b=P=>{if(P.isUpdatePhoto!=null&&!P.isUpdatePhoto)return[];if(s.source=="intervention")return P.pictures;const E=P.items.find(q=>q.itemType=="smallCamera");return E?E.value:[]},x=P=>{a.setImageManual(P)},w=_(!1),I=_([]),R=()=>{w.value=!1},$=P=>{I.value=P,w.value=!0};return(P,E)=>{const q=G("el-option"),J=G("el-select");return n(),h(de,null,[s.isModifying?(n(),h("div",xr,[e("table",Lr,[Nr,Ur,e("tbody",null,[e("tr",null,[e("th",Br,g(l.value.taskNo),1),e("th",jr,g(p.value),1),e("th",Fr,[e("div",Hr,[f(J,{modelValue:l.value.measurementRating,"onUpdate:modelValue":E[0]||(E[0]=M=>l.value.measurementRating=M),placeholder:"Rating",class:be(d(l.value.measurementRating)),onChange:r},{default:F(()=>[(n(),h(de,null,Ne(["A","B","C","X"],M=>f(q,{key:M,label:M,value:M},null,8,["label","value"])),64))]),_:1},8,["modelValue","class"]),e("div",null,[ue(e("span",qr,"This field is required",512),[[ut,o.value.measurementRating.isShowError]])])])]),e("th",Kr,[f(Dt,{images:l.value.images,"is-mandatory":!1,onOnHandleImages:x},null,8,["images"])])])])])])):(n(),h("div",Gr,[e("div",zr,[Jr,c.value&&c.value.historyModified&&c.value.historyModified.detail.history.length>0?(n(),h("div",Wr,[(n(!0),h(de,null,Ne(c.value.historyModified.detail.history,(M,v)=>(n(),h(de,{key:v},[e("div",Zr,[e("div",Xr,[e("span",null,g(M.items[0].value),1)]),e("div",Yr,[e("span",null,g(C(M)),1)]),e("div",Qr,[f(Kt,{item:V(M.items)},null,8,["item"])]),e("div",ec,[f(Tt,{item:b(M),"is-updated-by-current-user":M.updatedBy.id==K(i).user.EmployeeId,onShowPreviewImages:$},null,8,["item","is-updated-by-current-user"])]),e("div",tc,g(c.value.historyModified.detail.history.length-1==v?"IronForms":"IronPortal"),1)]),M.updatedBy.name?(n(),h("div",ac,[e("div",sc,g(M.updatedBy.name)+", "+g(M.updatedDate),1)])):Z("",!0)],64))),128))])):(n(),h("div",oc,"No Data Recorded"))])])),w.value?(n(),ee(qt,{key:2,type:"task","re-render":!1,images:I.value,"show-delete-button":!1,"is-mandatory":!1,visibility:w.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:R},null,8,["images","visibility"])):Z("",!0)],64)}}}),lc=Be(ic,[["__scopeId","data-v-4b2a6092"]]),xt=t=>(Je("data-v-95e59e34"),t=t(),We(),t),nc={key:0,class:"condition-modified my-5"},rc={class:"table table-bordered"},cc=xt(()=>e("caption",null,null,-1)),uc=xt(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"Task"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Adjusted Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating"),e("th",{scope:"col",class:"table-header"})])],-1)),dc=["textContent"],mc=["textContent"],pc={scope:"row",class:"align-middle"},hc=["textContent"],gc=["textContent"],vc={scope:"row",class:"align-middle"},fc={key:0,class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},yc={scope:"row",class:"align-middle"},bc={key:1,class:"history-modified"},_c={class:"table table-bordered"},Cc=xt(()=>e("caption",null,null,-1)),wc=xt(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header px-4"},"Task"),e("th",{scope:"col",class:"table-header px-4"},"Measurement Location"),e("th",{scope:"col",class:"table-header px-4"},"Measurement Value"),e("th",{scope:"col",class:"table-header px-4"},"UoM"),e("th",{scope:"col",class:"table-header px-4"},"Status"),e("th",{scope:"col",class:"table-header px-4",colspan:"2"},"Action")])],-1)),kc={key:0},Sc=["textContent"],Ic=["textContent"],Dc={class:"p-4 align-middle"},Ec={class:"p-4 align-middle"},Mc=["textContent"],Ac={class:"p-4 align-middle"},Pc=["textContent"],Oc={key:0},Rc={class:"timestamp-task text-end m-auto px-5 py-0",colspan:"9"},Vc={key:1},Tc=xt(()=>e("tr",null,[e("td",{colspan:"6",class:"table-header text-center py-8"}," No Data Recorded ")],-1)),$c=[Tc],xc=re({__name:"CbmSuspensionTable",props:{isModifying:{type:Boolean,required:!0,default:!1}},setup(t){const s=It(),a=gt(),i=t,o=S(()=>a.modifiedObjectAvg),l=S(()=>a.detailCbm),c=S(()=>a.inputErrorList),r=()=>{const P=o.value.value.findIndex(J=>J.measurementValue==""),E=o.value.value.length-1;if(P!=-1&&P!=E)return;let q=0;for(let J=0;J<E;J++)q+=Number(o.value.value[J].measurementValue);a.setModifiedData(E,"measurementValue",(q/(o.value.value.length-1)).toString()),C(E)},d=P=>{let E=P.keyCode?P.keyCode:P.which;E!=46&&(E<48||E>57)&&P.preventDefault()},p=P=>{if(a.resetErrors(),a.setInputErrorCbmAverage(P,"",!1),o.value.value[P].measurementValue==""){a.setInputErrorCbmAverage(P,"This field is required",!0),a.setErrors(["Please Check the form again"]);return}if(!V(P)){a.setInputErrorCbmAverage(P,"Max. 2 decimal digits",!0),a.setErrors(["Please Check the form again"]);return}a.setInputErrorCbmAverage(P,"",!1),$(P),r()},C=P=>{const E=l.value.detailSpec,q=o.value.value[P];if(!(E.length>0)||q.measurementValue==="")return;let v;E.every(y=>{const u=Ct(y,q.measurementValue),k=wt(y,q.measurementValue);return v=kt(u,k,y),!v}),a.setModifiedData(P,"measurementRating",v||"")},V=P=>_t(o.value.value[P].measurementValue),b=_(),x=P=>{const E=b.value;E&&(o.value.value[E].images=P)},w=P=>{let E;return P=="A"?E="a":P=="B"?E="b":P=="C"?E="c":P=="X"&&(E="x"),E},I=P=>{const E=l.value.historyModifiedDefault[P].items[3].customValidation;if(!E)return!1;let q=o.value.value[P].measurementValue;return E=="cbmTakePhotoAllRating"?!0:E=="cbmDefectTakePhoto"&&(q=="C"||q=="X")},R=P=>{s.toggleIsVisible(!0,"modifiedCBM"),s.setShowCloseButton(P)},$=P=>{o.value.value[P].images.length<1&&I(P)&&R(!1)};return(P,E)=>{var J,M;const q=G("el-input");return i.isModifying?(n(),h("div",nc,[e("table",rc,[cc,uc,e("tbody",null,[(n(!0),h(de,null,Ne(l.value.historyModifiedDefault,(v,y)=>(n(),h("tr",{key:`cbm-avg-table-edit-${y}`},[e("th",{scope:"row",class:"ps-3 align-middle",textContent:g(v.items[1].value)},null,8,dc),e("th",{scope:"row",class:"align-middle",textContent:g(v.items[2].value)},null,8,mc),e("th",pc,[f(q,{modelValue:o.value.value[y].measurementValue,"onUpdate:modelValue":u=>o.value.value[y].measurementValue=u,onKeypress:d,onChange:u=>p(y),disabled:v.items[3].categoryItemType=="resultParamRating"},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),c.value[y].measurementValue.isShowError?(n(),h("span",{key:0,class:"text-danger font-weight-bold",textContent:g(c.value[y].measurementValue.errorMessage)},null,8,hc)):Z("",!0)]),e("th",{scope:"row",class:"align-middle",textContent:g(o.value.value[y].uom)},null,8,gc),e("th",vc,[v.items[5].itemType!="label"?(n(),h("div",fc,[f(q,{modelValue:o.value.value[y].measurementRating,"onUpdate:modelValue":u=>o.value.value[y].measurementRating=u,placeholder:"Rating",class:be(w(o.value.value[y].measurementRating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):Z("",!0)]),e("th",yc,[f(Dt,{onClick:u=>b.value=y,images:o.value.value[y].images,onOnHandleImages:E[0]||(E[0]=u=>x(u))},null,8,["onClick","images"])])]))),128))])])])):(n(),h("div",bc,[e("table",_c,[Cc,wc,l.value.historyModified&&((J=l.value.historyModified.detail)==null?void 0:J.history.length)>0?(n(),h("tbody",kc,[(n(!0),h(de,null,Ne((M=l.value.historyModified.detail)==null?void 0:M.history,(v,y)=>{var u,k;return n(),h(de,{key:y},[e("tr",null,[e("td",{class:"p-4 align-middle",textContent:g(v.items[0].value)},null,8,Sc),e("td",{class:"p-4 align-middle",textContent:g(v.items[2].value)},null,8,Ic),e("td",Dc,[f(q,{class:"input-overwrite-cbm",modelValue:v.items[3].value,"onUpdate:modelValue":U=>v.items[3].value=U,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),e("td",Ec,[f(q,{class:"input-overwrite-cbm",modelValue:v.items[5].value,"onUpdate:modelValue":U=>v.items[5].value=U,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),e("td",{class:"p-4 align-middle",textContent:g(v.items[4].value)},null,8,Mc),e("td",Ac,[f(Tt,{item:v.items[6],task:v},null,8,["item","task"])]),e("td",{class:"p-4 align-middle",textContent:g(l.value.historyModified.detail.history.length-1==y?"IronForms":"IronPortal")},null,8,Pc)]),(u=v.updatedBy)!=null&&u.name?(n(),h("tr",Oc,[e("td",Rc,g((k=v==null?void 0:v.updatedBy)==null?void 0:k.name)+", "+g(v==null?void 0:v.updatedDate),1)])):Z("",!0)],64)}),128))])):(n(),h("tbody",Vc,$c))])]))}}}),Lc=Be(xc,[["__scopeId","data-v-95e59e34"]]),Oa=t=>(Je("data-v-37978c02"),t=t(),We(),t),Nc={key:0,class:"condition-modified my-5"},Uc={class:"table table-bordered"},Bc=Oa(()=>e("caption",null,null,-1)),jc=Oa(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"Task"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Current Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Rating")])],-1)),Fc={scope:"row",class:"ps-3 align-middle"},Hc={scope:"row",class:"align-middle"},qc={scope:"row",class:"align-middle"},Kc={scope:"row",class:"align-middle"},Gc={scope:"row",class:"pe-3 align-middle"},zc={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Jc={key:0},Wc={scope:"row",class:"px-3 align-middle",colspan:"5"},Zc={class:"d-flex align-items-center px-3 w-100",style:{border:"1px solid #e7eaee"}},Xc={class:"ms-auto me-3"},Yc={key:1,class:"history-modified"},Qc={class:"row w-100 table table-bordered"},eu=Ft('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-37978c02><div class="col-1 py-3 table-header" data-v-37978c02>Task</div><div class="col-3 py-3 table-header" data-v-37978c02>Measurement Location</div><div class="col-2 py-3 table-header" data-v-37978c02>Measurement Value</div><div class="col-1 py-3 table-header" data-v-37978c02>UoM</div><div class="col-2 py-3 table-header" data-v-37978c02>Rating</div><div class="col-2 py-3 table-header" data-v-37978c02>Action</div></div>',1),tu={key:0},au={class:"d-flex align-items-center col-1"},su={class:"d-flex align-items-center col-3"},ou={class:"d-flex align-items-center col-2"},iu={class:"d-flex align-items-center col-1"},lu={class:"d-flex align-items-center col-2"},nu={key:0,class:"input-eform-status"},ru={class:"d-flex align-items-center col-2"},cu={key:0,class:"row px-0 mx-0"},uu={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},du={key:1,class:"row px-0 mx-0"},mu={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},pu={key:1,class:"col-12 table-header text-center py-8"},hu=re({__name:"CbmAutomaticReplacementTable",props:{isModifying:{type:Boolean,required:!0,default:!1},normalFormula:{type:Array},gapFormula:{type:Array},isReplacement:{type:Boolean}},setup(t){const s=t,a=gt(),i=S(()=>a.cbmType),o=S(()=>a.detailCbm),l=S(()=>{const O=o.value.beforeReplacementItems.find(T=>T.categoryItemType=="previousParamRating");return O.value?O.value:""}),c=S(()=>a.inputError),r=S(()=>a.modifiedObjAut),d=S({get:()=>a.modifiedObjAut.measurementValue,set:O=>{if(!isNaN(Number(O))){{if(O.length>8)return;if((`${O}`.split(".")||[]).length-1>1)return;if(O.includes(".")){if(`${O}`.split(".")[1].length>2)return;r.value.measurementValue=O}}if(O.length>5&&O.length>=6&&O.length<=6){if(O[5]!=".")return;r.value.measurementValue=O}r.value.measurementValue=O}}}),p=S(()=>{if(o.value.historyModifiedDefault[0].items.length==1)return!0;const O=o.value.historyModifiedDefault[0].items.find(m=>m.categoryItemType=="paramRating"||m.categoryItemType=="paramRatingDynamic"),T=(O==null?void 0:O.customValidation)||"";return T?T=="cbmTakePhoto"||T=="cbmTakePhotoAllRating"||T=="cbmDefectTakePhoto"||T=="cbmReplaceDefectTakePhoto"&&(r.value.measurementRating=="C"||r.value.measurementRating=="X"):!1}),C=O=>O.items[2].itemType!="input"?O.items[2].value:O.items.find(m=>m.itemType=="html").value,V=O=>{const T=O.items.find(m=>m.categoryItemType=="paramRating"||m.categoryItemType=="paramRatingDynamic");return T?T.value:""},b=O=>{const T=O.items.find(m=>m.categoryItemType=="targetTool");if(T)return T.value;if(T)return"";{const m=O.items.findIndex(D=>D.categoryItemType=="paramRating"||D.categoryItemType=="paramRatingDynamic");return O.items[m+1].value}},x=O=>{const T=O.find(m=>m.categoryItemType=="targetRating");return T||{}},w=O=>{let T=O.keyCode?O.keyCode:O.which;T!=46&&(T<48||T>57)&&O.preventDefault()},I=O=>{let T;return O=="A"?T="a":O=="B"?T="b":O=="C"?T="c":O=="X"&&(T="x"),T},R=O=>{a.setImageAutomatic(O)},$=()=>{a.resetErrors(),a.setInputErrorCbmAutomatic("",!1);let O;if(O=parseFloat(d.value),d.value=String(O),r.value.measurementValue==""){a.setInputErrorCbmAutomatic("This field is Required",!0),a.setErrors(["Please Check the form again"]);return}if(i.value=="AUTOMATIC_REPLACEMENT_GAP"&&l.value&&(Number(r.value.measurementValue)<0||Number(r.value.measurementValue)>52)){a.setInputErrorCbmAutomatic("Must be 0-52",!0),a.setErrors(["Please Check the form again"]);return}if(!_t(r.value.measurementValue)){a.setInputErrorCbmAutomatic("Max. 2 decimal digits",!0),a.setErrors(["Please Check the form again"]);return}let T=P();if(!T){a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]);return}a.setAutomaticRating(T)},P=()=>i.value=="AUTOMATIC_REPLACEMENT"?q():l.value?J():E(s.normalFormula,r.value.measurementValue)?"A":(a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]),""),E=(O,T)=>{let m;return O.every(D=>{const Q=Ct(D,T),W=wt(D,T);return m=kt(Q,W,D),!m}),m},q=()=>{if(s.normalFormula&&s.normalFormula.length>0)return r.value.measurementValue===""?void 0:E(s.normalFormula,r.value.measurementValue)},J=()=>{const O=Number(d.value),T=Number(l.value),m=Math.abs(O-T).toFixed(2);return T<O?(a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]),""):E(s.gapFormula,m)},M=It(),v=_(""),y=_(!1),u=_(""),k=()=>{u.value.length<2&&M.toggleIsVisible(!0,o.value.replacementPhoto[0].items[2].key),U(o.value.currentCondition.section),M.setReplacementTool(v.value),y.value=!1},U=O=>{switch(v.value="",O){case"HV Alternator":v.value="alternator";break;case"Retarder Grid Box 1":case"Retarder Grid Box 2":v.value="blower motor";break}};return(O,T)=>{const m=G("el-input");return n(),h(de,null,[s.isModifying?(n(),h("div",Nc,[e("table",Uc,[Bc,jc,e("tbody",null,[e("tr",null,[e("th",Fc,g(r.value.taskNo),1),e("th",Hc,g(r.value.measurementLocation),1),e("th",qc,[f(m,{modelValue:d.value,"onUpdate:modelValue":T[0]||(T[0]=D=>d.value=D),class:"mb-0",onKeypress:w,onFocusout:$},null,8,["modelValue"]),ue(e("span",{class:"text-danger font-weight-bold"},g(c.value.measurementValue.errorMessage),513),[[ut,c.value.measurementValue.isShowError]])]),e("th",Kc,g(r.value.uom),1),e("th",Gc,[e("div",zc,[f(m,{modelValue:r.value.measurementRating,"onUpdate:modelValue":T[1]||(T[1]=D=>r.value.measurementRating=D),placeholder:"Rating",class:be(I(r.value.measurementRating)),disabled:"",readonly:""},null,8,["modelValue","class"])])])]),o.value.replacementPhoto?(n(),h("tr",Jc,[e("th",Wc,[e("div",Zc,[e("span",null,g(o.value.replacementPhoto[0].items[1].value),1),e("span",Xc,[f(Dt,{images:r.value.images,"is-mandatory":p.value,item:o.value.replacementPhoto[0].items[2],itemkey:o.value.replacementPhoto[0].items[2].key,"section-data":o.value.currentCondition.section,"is-replacement":!0,onOnHandleImages:R},null,8,["images","is-mandatory","item","itemkey","section-data"])])])])])):Z("",!0)])])])):(n(),h("div",Yc,[e("div",Qc,[eu,o.value.historyModified&&o.value.historyModified.detail.history.length>0?(n(),h("div",tu,[(n(!0),h(de,null,Ne(o.value.historyModified.detail.history,(D,Q)=>(n(),h("div",{key:Q,class:"row px-0 mx-0"},[e("div",au,[e("span",null,g(D.items[0].value),1)]),e("div",su,[e("span",null,g(C(D)),1)]),e("div",ou,[e("span",null,g(s.isReplacement?D.cbmAdjustmentReplacementValue.measurement:V(D)),1)]),e("div",iu,[e("span",null,g(b(D)),1)]),e("div",lu,[s.isReplacement?(n(),h("div",nu,[f(m,{modelValue:D.cbmAdjustmentReplacementValue.rating,"onUpdate:modelValue":W=>D.cbmAdjustmentReplacementValue.rating=W,placeholder:"Rating",class:be(I(D.cbmAdjustmentReplacementValue.rating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):(n(),ee(Kt,{key:1,item:x(D.items)},null,8,["item"]))]),e("div",ru,g(o.value.historyModified.detail.history.length-1==Q?"IronForms":"IronPortal"),1),s.isReplacement&&D.cbmAdjustmentReplacementValue?(n(),h("div",cu,[e("div",uu,g(D.cbmAdjustmentReplacementValue.updatedBy.name)+", "+g(D.cbmAdjustmentReplacementValue.updatedDate),1)])):D.updatedBy.name?(n(),h("div",du,[e("div",mu,g(D.updatedBy.name)+", "+g(D.updatedDate),1)])):Z("",!0)]))),128))])):(n(),h("div",pu,"No Data Recorded"))])])),o.value.replacementPhoto?(n(),ee(Ma,{key:2,show:y.value,item:o.value.replacementPhoto[0].items[2],tool:v.value,side:K(M).replacementPosition,onClose:k},null,8,["show","item","tool","side"])):Z("",!0)],64)}}}),gu=Be(hu,[["__scopeId","data-v-37978c02"]]),Ra=t=>(Je("data-v-3e6c1f90"),t=t(),We(),t),vu={key:0,class:"condition-modified my-5"},fu={class:"table table-bordered"},yu=Ra(()=>e("caption",null,null,-1)),bu=Ra(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",style:{width:"5%"},class:"table-header ps-3"},"Task"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Measurement Location"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Tool"),e("th",{scope:"col",style:{width:"8%"},class:"table-header"},"A"),e("th",{scope:"col",style:{width:"8%"},class:"table-header"},"B"),e("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Piston Movement (B-A)"),e("th",{scope:"col",style:{width:"5%"},class:"table-header"},"UoM"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Percent Worn"),e("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Rating"),e("th",{scope:"col",style:{width:"9%"},class:"table-header"})])],-1)),_u={scope:"row",class:"ps-3 align-middle"},Cu={scope:"row",class:"align-middle"},wu={scope:"row",class:"align-middle"},ku={scope:"row",class:"align-middle"},Su={scope:"row",class:"align-middle"},Iu={scope:"row",class:"align-middle"},Du={class:"text-danger font-weight-bold"},Eu={scope:"row",class:"align-middle"},Mu={scope:"row",class:"align-middle"},Au={scope:"row",class:"align-middle"},Pu={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Ou={scope:"row",class:"align-middle"},Ru={key:1,class:"history-modified"},Vu={class:"row w-100 table table-bordered"},Tu=Ft('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-3e6c1f90><div class="col py-3 table-header" data-v-3e6c1f90>Task</div><div class="col-2 py-3 table-header" data-v-3e6c1f90>Measurement Location</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Tool</div><div class="col py-3 table-header" data-v-3e6c1f90>A</div><div class="col py-3 table-header" data-v-3e6c1f90>B</div><div class="col-2 py-3 table-header" data-v-3e6c1f90>Piston Movement (B-A)</div><div class="col py-3 table-header" data-v-3e6c1f90>UoM</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Percent Worn</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Rating</div><div class="col-1 py-3 table-header" data-v-3e6c1f90></div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Action</div></div>',1),$u={key:0},xu={class:"d-flex align-items-center col"},Lu={class:"d-flex align-items-center col-2"},Nu={class:"d-flex align-items-center col-1"},Uu={class:"d-flex align-items-center col"},Bu={class:"d-flex align-items-center col"},ju={class:"d-flex align-items-center col-2"},Fu={class:"d-flex align-items-center col"},Hu={class:"d-flex align-items-center col-1"},qu={class:"d-flex align-items-center col-1"},Ku={class:"col-1"},Gu={class:"d-flex align-items-center col-1"},zu={key:0,class:"row px-0 mx-0"},Ju={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},Wu={key:1,class:"row px-0 mx-0"},Zu={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},Xu={key:1,class:"col-12 table-header text-center py-8"},Yu=re({__name:"CbmOilCooledTable",props:{isModifying:{type:Boolean,required:!0,default:!1},source:{type:String,required:!1,default:"serviceSheet"}},emits:["openCamera"],setup(t,{emit:s}){const a=t,i=Ae(),o=gt(),l=S(()=>o.detailCbm),c=S(()=>l.value.historyModifiedDefault[0].items[0].description=="Adjustment"),r=S(()=>o.inputErrorOilCooled),d=S(()=>a.source=="intervention"&&l.value.historyModified&&l.value.historyModified.detail.history.length>1?!0:!!(a.source!="intervention"&&l.value.historyModified&&l.value.historyModified.detail.history.length>0)),p=S(()=>o.modifiedObjOilCooled),C=S(()=>l.value.currentCondition.taskNo),V=S(()=>{let A=l.value.historyModifiedDefault[0].description.split(";")[0];return l.value.historyModifiedDefault[0].description.split(";")[1]!=""&&(A+=l.value.historyModifiedDefault[0].description.split(";")[1]),C.value==""?A:C.value.replace(/[^a-z]/gi,"").length>1?C.value.replace(";","").replace(/\D/g,""):C.value.replace(";","")}),b=A=>{const N=A.items[0].value;let ie=A.description.split(";")[0];return A.description.split(";")[1]!=""&&(ie+=A.description.split(";")[1]),N==""?ie:N},x=S(()=>{let A="";for(const N of l.value.historyModifiedDefault[0].items)N.itemType==="html"&&(A=N.value);return A!=""?A:l.value.currentCondition.measurementLocation}),w=S(()=>p.value.tool=="BIRRANA"?"Birrana Gauge":"CAT Gauge"),I=S({get:()=>p.value.pistonMovementA,set:A=>{p.value.pistonMovementA=P(A)}}),R=S({get:()=>p.value.pistonMovementB,set:A=>{p.value.pistonMovementB=P(A)}}),$=S(()=>p.value.pistonMovementResult),P=A=>{let N=A;if(!isNaN(Number(A))){{if(A.length>8)return;if((`${A}`.split(".")||[]).length-1>1)return;if(A.includes(".")){if(`${A}`.split(".")[1].length>2)return;N=A}}if(A.length>5&&A.length>=6&&A.length<=6){if(A[5]!=".")return;N=A}return N}},E=A=>A.items[2].itemType!="input"?A.items[2].value:A.items.find(ie=>ie.itemType=="html").value,q=A=>{const N=A.find(ie=>ie.categoryItemType=="dropdownTool");return N?N.value=="BIRRANA"?"Birrana Gauge":"CAT Gauge":""},J=A=>{const N=A.find(ie=>ie.categoryItemType=="pistonMovementA");return N?N.value:""},M=A=>{const N=A.find(ie=>ie.categoryItemType=="pistonMovementB");return N?N.value:""},v=A=>{const N=A.find(ie=>ie.categoryItemType=="pistonMovementResult");return N?N.value:""},y=A=>{const N=A.find(ie=>ie.categoryItemType=="pistonMovementRating");return N&&N.value!="-"?`${parseFloat(N.value)*100}%`:"-"},u=A=>{const N=A.find(ie=>ie.categoryItemType=="targetTool");return N?N.value:""},k=A=>{const N=A.find(ie=>ie.categoryItemType=="targetRating");return N||{}},U=A=>A.cbmAdjustmentReplacementValue.rating,O=A=>{if(A.isUpdatePhoto!=null&&!A.isUpdatePhoto)return[];if(c.value&&A.cbmAdjustmentReplacementValue)return A.cbmAdjustmentReplacementValue.pictures;if(a.source=="intervention")return A.pictures;const N=A.items.find(ie=>ie.itemType=="smallCamera");return N?N.value:[]},T=A=>{let N=A.keyCode?A.keyCode:A.which;N!=46&&(N<48||N>57)&&A.preventDefault()},m=A=>{let N;return A=="A"?N="a":A=="B"?N="b":A=="C"?N="c":A=="X"&&(N="x"),N},D=A=>{o.setImageOilCooled(A)},Q=()=>{o.resetErrors(),o.setInputErrorCbmOilCooledPistonA("",!1);let A;if(A=parseFloat(I.value),I.value=String(A),!p.value.pistonMovementA){o.setInputErrorCbmOilCooledPistonA("This field is Required",!0),o.setErrors(["Please Check the form again"]);return}if(!_t(p.value.pistonMovementA)){o.setInputErrorCbmOilCooledPistonA("Max. 2 decimal digits",!0),o.setErrors(["Please Check the form again"]);return}R.value&&ae()},W=()=>{o.resetErrors(),o.setInputErrorCbmOilCooledPistonB("",!1);let A;if(A=parseFloat(R.value),R.value=String(A),!p.value.pistonMovementB){o.setInputErrorCbmOilCooledPistonB("This field is Required",!0),o.setErrors(["Please Check the form again"]);return}if(!_t(p.value.pistonMovementB)){o.setInputErrorCbmOilCooledPistonB("Max. 2 decimal digits",!0),o.setErrors(["Please Check the form again"]);return}if(A<parseFloat(I.value)){o.setInputErrorCbmOilCooledPistonB("Piston B must be greater than Piston A",!0),o.setErrors(["Please Check the form again"]);return}I.value&&ae()},z=_(!1),ae=()=>{z.value=!1,R.value&&I.value&&(p.value.pistonMovementResult=(parseFloat(R.value)-parseFloat(I.value)).toFixed(2).toString());let A=ne();o.setOilCooledPercentWorn(A);let N=we();if(!A){z.value=!0,o.setErrors(["Please Check the form again"]);return}o.setOilCooledRating(N)},ne=()=>{let A;const ie=l.value.detailSpec.filter(_e=>!["A","B","C","X"].includes(_e.cbmRating));if(ie.length>0)return p.value.pistonMovementResult?(ie.every(_e=>{const Te=Ct(_e,p.value.pistonMovementResult),B=wt(_e,p.value.pistonMovementResult);return A=kt(Te,B,_e),!A}),A):void 0},we=()=>{let A;const ie=l.value.detailSpec.filter(_e=>["A","B","C","X"].includes(_e.cbmRating));if(ie.length>0)return p.value.pistonMovementRating?(ie.every(_e=>{const Te=Ct(_e,p.value.pistonMovementRating),B=wt(_e,p.value.pistonMovementRating);return A=kt(Te,B,_e),!A}),A):void 0},ke=_(!1),X=_([]),Pe=()=>{ke.value=!1},qe=A=>{X.value=A,ke.value=!0};return(A,N)=>{const ie=G("el-option"),_e=G("el-select"),Te=G("el-input");return n(),h(de,null,[a.isModifying?(n(),h("div",vu,[e("table",fu,[yu,bu,e("tbody",null,[e("tr",null,[e("th",_u,g(V.value),1),e("th",Cu,g(x.value),1),e("th",wu,[f(_e,{modelValue:w.value,"onUpdate:modelValue":N[0]||(N[0]=B=>w.value=B),readonly:""},{default:F(()=>[f(ie,{value:"BIRRANA"},{default:F(()=>[he("Birrana Gauge")]),_:1}),f(ie,{value:"CAT_GAUGE"},{default:F(()=>[he("CAT Gauge")]),_:1})]),_:1},8,["modelValue"])]),e("th",ku,[f(Te,{modelValue:I.value,"onUpdate:modelValue":N[1]||(N[1]=B=>I.value=B),class:"mb-0",onKeypress:T,onFocusout:Q},null,8,["modelValue"]),ue(e("p",{class:"text-danger font-weight-bold"},g(r.value.pistonA.errorMessage),513),[[ut,r.value.pistonA.isShowError]])]),e("th",Su,[f(Te,{modelValue:R.value,"onUpdate:modelValue":N[2]||(N[2]=B=>R.value=B),class:"mb-0",onKeypress:T,onFocusout:W,disabled:I.value==""},null,8,["modelValue","disabled"]),ue(e("p",{class:"text-danger font-weight-bold"},g(r.value.pistonB.errorMessage),513),[[ut,r.value.pistonB.isShowError]])]),e("th",Iu,[f(Te,{modelValue:$.value,"onUpdate:modelValue":N[3]||(N[3]=B=>$.value=B),readonly:""},null,8,["modelValue"]),ue(e("p",Du,"Out of range",512),[[ut,z.value]])]),e("th",Eu,g(p.value.uom),1),e("th",Mu,g(p.value.pistonMovementRating?`${p.value.pistonMovementRating}%`:"-"),1),e("th",Au,[e("div",Pu,[f(Te,{modelValue:p.value.rating,"onUpdate:modelValue":N[4]||(N[4]=B=>p.value.rating=B),placeholder:"Rating",class:be(m(p.value.rating)),disabled:"",readonly:""},null,8,["modelValue","class"])])]),e("th",Ou,[f(Dt,{images:p.value.images,"is-mandatory":!1,onOnHandleImages:D},null,8,["images"])])])])])])):(n(),h("div",Ru,[e("div",Vu,[Tu,d.value?(n(),h("div",$u,[(n(!0),h(de,null,Ne(l.value.historyModified.detail.history,(B,ce)=>(n(),h("div",{key:ce,class:"row px-0 mx-0"},[e("div",xu,[e("span",null,g(b(B)),1)]),e("div",Lu,[e("span",null,g(E(B)),1)]),e("div",Nu,[e("span",null,g(q(B.items)),1)]),e("div",Uu,[e("span",null,g(J(B.items)),1)]),e("div",Bu,[e("span",null,g(M(B.items)),1)]),e("div",ju,[e("span",null,g(v(B.items)),1)]),e("div",Fu,[e("span",null,g(u(B.items)),1)]),e("div",Hu,[e("span",null,g(y(B.items)),1)]),e("div",qu,[c.value&&B.cbmAdjustmentReplacementValue?(n(),ee(Ea,{key:0,item:U(B),task:B},null,8,["item","task"])):(n(),ee(Kt,{key:1,item:k(B.items),task:B},null,8,["item","task"]))]),e("div",Ku,[f(Tt,{item:O(B),"is-updated-by-current-user":B.updatedBy.id==K(i).user.EmployeeId,onShowPreviewImages:qe},null,8,["item","is-updated-by-current-user"])]),e("div",Gu,g(l.value.historyModified.detail.history.length-1==ce?"IronForms":"IronPortal"),1),c.value&&B.cbmAdjustmentReplacementValue?(n(),h("div",zu,[e("div",Ju,g(B.cbmAdjustmentReplacementValue.updatedBy.name)+", "+g(B.cbmAdjustmentReplacementValue.updatedDate),1)])):B.updatedBy.name?(n(),h("div",Wu,[e("div",Zu,g(B.updatedBy.name)+", "+g(B.updatedDate),1)])):Z("",!0)]))),128))])):(n(),h("div",Xu,"No Data Recorded"))])])),ke.value?(n(),ee(qt,{key:2,type:"task","re-render":!1,images:X.value,"show-delete-button":!1,"is-mandatory":!1,visibility:ke.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:Pe},null,8,["images","visibility"])):Z("",!0)],64)}}}),Qu=Be(Yu,[["__scopeId","data-v-3e6c1f90"]]),ed={class:"table table-bordered"},td=e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"No"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Rating")])],-1),ad={scope:"row",class:"ps-3 align-middle"},sd={scope:"row",class:"align-middle"},od={scope:"row",class:"align-middle"},id={class:"input-eform-status"},ld={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},nd=re({__name:"CurrentConditionManTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=Ot({...s.itemService}),{rating:i}=Rt(a);return Ze(()=>s.itemService,o=>{Object.assign(a,o)},{deep:!0}),(o,l)=>{const c=G("el-input"),r=He("loading");return ue((n(),h("table",ed,[td,e("tbody",null,[e("tr",null,[e("th",ad,g(t.itemService.number),1),e("th",sd,g(t.itemService.text),1),e("th",od,[e("div",id,[f(c,{modelValue:K(i),"onUpdate:modelValue":l[0]||(l[0]=d=>ze(i)?i.value=d:null),class:be(`pe-3 ${t.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),e("tr",null,[e("td",ld,g(t.itemService.timestamp.name)+", "+g(t.itemService.timestamp.date),1)])])])),[[r,t.loading]])}}}),Va=t=>(Je("data-v-eab9e928"),t=t(),We(),t),rd={class:"table table-bordered"},cd=Va(()=>e("caption",null,null,-1)),ud=Va(()=>e("thead",null,[e("tr",{style:{background:"#f4f6f8"}},[e("th",{scope:"col",class:"table-header ps-3"},"No"),e("th",{scope:"col",class:"table-header"},"Measurement Location"),e("th",{scope:"col",class:"table-header"},"Measurement Value"),e("th",{scope:"col",class:"table-header"},"UoM"),e("th",{scope:"col",class:"table-header"},"Status"),e("th",{scope:"col",class:"table-header"})])],-1)),dd={key:0},md={scope:"row",class:"ps-3 align-middle"},pd={scope:"row",class:"align-middle"},hd={scope:"row",class:"align-middle"},gd={scope:"row",class:"align-middle"},vd={scope:"row",class:"align-middle"},fd={class:"px-0 py-0 mx-0 my-0 d-flex align-items-center"},yd={scope:"row",class:"align-bottom"},bd={key:0,class:"row px-0 mx-0"},_d={class:"pb-1 pt-0 my-0 timestamp-task text-end"},Cd=re({__name:"CurrentConditionSuspensionTable",props:{currentCondition:{type:Object,required:!0},loading:{type:Boolean}},setup(t){const s=t,a=i=>{let o="";switch(i){case"Out Spec":o="red";break;case"Out of spec":o="red";break;case"In spec":o="green";break}return o};return(i,o)=>{const l=G("el-input"),c=He("loading");return ue((n(),h("table",rd,[cd,ud,t.currentCondition?(n(),h("tbody",dd,[e("tr",null,[e("th",md,g(t.currentCondition.taskNo),1),e("th",pd,g(t.currentCondition.measurementLocation),1),e("th",hd,[f(l,{modelValue:t.currentCondition.measurementValue,"onUpdate:modelValue":o[0]||(o[0]=r=>t.currentCondition.measurementValue=r),placeholder:"Measurement Value",class:"input-measurement_value",readonly:""},null,8,["modelValue"])]),e("th",gd,g(t.currentCondition.uom),1),e("th",vd,[e("div",fd,[e("div",{class:be(["little-box p-3 me-2",[a(t.currentCondition.rating)]])},null,2),he(" "+g(t.currentCondition.rating),1)])]),e("th",yd,[t.currentCondition.updatedBy.name?(n(),h("div",bd,[e("div",_d,g(t.currentCondition.updatedBy.name)+", "+g(t.currentCondition.updatedDate),1)])):Z("",!0)])])])):Z("",!0)])),[[c,s.loading]])}}}),wd=Be(Cd,[["__scopeId","data-v-eab9e928"]]),lt=t=>(Je("data-v-2ce7fc98"),t=t(),We(),t),kd={key:0,class:"text-center py-10 my-10"},Sd={key:1},Id={class:"d-flex justify-content-between my-4"},Dd={class:"grey-box p-3"},Ed=lt(()=>e("h5",null,"Work Order",-1)),Md={class:"grey-box p-3 mx-3"},Ad=lt(()=>e("h5",null,"Asset Number",-1)),Pd={class:"grey-box p-3"},Od=lt(()=>e("h5",null,"Component",-1)),Rd={class:"my-4"},Vd=lt(()=>e("h3",{class:"my-7"},"Current Condition",-1)),Td={key:6,class:"my-3"},$d={key:7,class:"my-3"},xd={key:8,class:"table table-bordered",style:{width:"500px"}},Ld=lt(()=>e("caption",null,null,-1)),Nd=lt(()=>e("thead",null,[e("tr",{style:{background:"#18af4a",color:"#fff"}},[e("th",{scope:"col",class:"table-header table-border-right-white ps-2"}," Rating "),e("th",{scope:"col",class:"table-header table-border-right-white"},"Value Min"),e("th",{scope:"col",class:"table-header table-border-right-white"},"Value Max"),e("th",{scope:"col",class:"table-header table-border-right-white"},"UoM")])],-1)),Ud={scope:"row",class:"ps-2"},Bd={scope:"row"},jd={scope:"row"},Fd={scope:"row"},Hd={key:9,class:"table table-bordered",style:{width:"500px"}},qd=lt(()=>e("caption",null,null,-1)),Kd=lt(()=>e("thead",null,[e("tr",{style:{background:"#18af4a",color:"#fff"}},[e("th",{scope:"col",class:"table-header table-border-right-white ps-2"}," Rating "),e("th",{scope:"col",class:"table-header table-border-right-white"},"Value Min"),e("th",{scope:"col",class:"table-header table-border-right-white"},"Value Max"),e("th",{scope:"col",class:"table-header table-border-right-white"},"UoM")])],-1)),Gd={scope:"row",class:"ps-2"},zd={scope:"row"},Jd={scope:"row"},Wd={scope:"row"},Zd=lt(()=>e("h4",null,"Detailed Picture",-1)),Xd=lt(()=>e("span",null,"No Picture.",-1)),Yd={key:1,class:"w-100 d-flex flex-wrap"},Qd={key:0},em={class:"bg-secondary cursor-pointer"},tm=["src","onClick","alt"],am={class:"mt-20"},sm={class:"my-7"},om={key:0,class:"dialog-footer"},im={key:0,class:"dialog-footer"},lm=re({__name:"Modal",props:{visibility:{type:Boolean,required:!1},type:{type:String,required:!0,default:"cbm"},workOrder:{type:String,required:!0},taskKey:{type:String,required:!0},assetNumber:{type:String,required:!0},component:{type:String,required:!0},sampleDate:{type:String,required:!0},source:{type:String,required:!1,default:"serviceSheet"}},emits:["onClose","onDelete","onDownloaded"],setup(t,{emit:s}){const a=t,i=s,o=gt(),l=Ae(),c=It(),r=_(!1),d=_([]),p=it(a,"visibility"),C=_([]),V=_(0),b=_([]),x=_(!1),w=_(!1),I=S(()=>o.isUserCanRevise),R=S(()=>o.loading||w.value),$=S(()=>o.detailCbm),P=S(()=>$.value.component!=""?$.value.component:a.component),E=S(()=>o.isError),q=S(()=>{if(!$.value.detailSpec)return;const H=$.value.detailSpec.filter(te=>te.cbmType!="CBM_GAP");return ht.orderBy(H,["uom","cbmRating","minValue"])}),J=S(()=>{if(!$.value.detailSpec)return;const H=$.value.detailSpec.filter(te=>te.cbmType=="CBM_GAP");return ht.orderBy(H,["uom","cbmRating","minValue"])});S(()=>!!($.value.beforeReplacementItems&&$.value.beforeReplacementItems[3].value));const M=S(()=>$.value&&$.value.currentCondition?$.value.currentCondition:{}),v=S(()=>$.value?$.value.historyModifiedDefault:[]),y=S(()=>{var H,te,me;return v.value&&v.value[0].items[0].description=="Adjustment"&&$.value.historyModified!=null&&$.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue?{name:$.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue.updatedBy.name,date:$.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue.updatedDate}:{name:((te=(H=M.value)==null?void 0:H.updatedBy)==null?void 0:te.name)||"",date:((me=M.value)==null?void 0:me.updatedDate)||""}}),u=S(()=>{var te,me;let H="";return v.value&&(H=(te=v.value[0])==null?void 0:te.description.split(";")[0],v.value[0].description.split(";")[1]!=""&&(H+=(me=v.value[0])==null?void 0:me.description.split(";")[1])),M.value&&M.value.taskNo==""?H:M.value&&M.value.taskNo&&M.value.taskNo.replace(/[^a-z]/gi,"").length>1?M.value.taskNo.replace(";","").replace(/\D/g,""):M.value&&M.value.taskNo&&M.value.taskNo!=""&&M.value.taskNo.replace(/[^a-z]/gi,"").length<=1?M.value.taskNo.replace(";",""):""}),k=S(()=>{let H="";if(v.value)for(const te of v.value[0].items)te.itemType==="html"&&(H=te.value);return H!=""?H:M.value?M.value.measurementLocation:""}),U=S(()=>o.detailCbm.beforeReplacementItems!=null?o.detailCbm.beforeReplacementItems:[]),O=S(()=>o.isReplacementAdjustment?U.value[4].value:M.value.measurementValue),T=S(()=>o.isReplacementAdjustment?U.value[6].value:M.value.rating),m=S(()=>o.isReplacementAdjustment?{name:U.value[6].updatedBy.name,date:U.value[6].updatedDate}:y.value),D=S(()=>U.value&&U.value[3]?U.value[3].value:"-"),Q=S(()=>({number:u.value,text:k.value,uom:M.value?M.value.uom:"",measurement:O.value,rating:T.value,timestamp:m.value,color:ke(T.value),previousMeasurement:D.value,replacementMeasurement:M.value?M.value.measurementValue:"",replacementRating:M.value?M.value.rating:"",colorReplacementRating:ke(M.value?M.value.rating:""),replacementTimestamp:y.value,isReplacementAdjustment:o.isReplacementAdjustment})),W=S(()=>{let H="";return v.value&&(H+=v.value[0].description.split(";")[1],H+=". ",H+=v.value[0].description.split(";")[2]),H!=""?H:M.value?M.value.measurementLocation:""}),z=S(()=>{let H="-";if(v.value)for(const te of v.value[0].items)te.categoryItemType==="previousParamRating"&&(H=te.value);return H}),ae=S(()=>{let H="-";if(v.value)for(const te of v.value[0].items)te.categoryItemType==="previousTargetRating"&&(H=te.value?te.value:"-");return H}),ne=S(()=>({number:u.value,text:W.value,uom:M.value?M.value.uom:"",measurement:O.value,rating:T.value,timestamp:m.value,color:ke(T.value),previousMeasurement:z.value,previousRating:ae.value,previousColor:ae.value!="-"?ke(ae.value):""})),we=S(()=>({number:u.value,text:W.value,uom:M.value?M.value.pistonUom:"",tool:M.value?M.value.pistonTool:"",pistonAValue:M.value?M.value.pistonAValue:"",pistonBValue:M.value?M.value.pistonBValue:"",pistonResultValue:M.value?M.value.pistonResultValue:"",pistonPercentageValue:M.value?M.value.pistonPercentageValue:0,rating:M.value?M.value.pistonRating:"",timestamp:m.value,color:ke(M.value?M.value.pistonRating:"")})),ke=H=>H==null?void 0:H.toLocaleLowerCase(),X=S(()=>o.cbmType),Pe=S(()=>[...o.cbmTypeAutomatic,...o.cbmTypeManual,"AVERAGE","CALIBRATION","AUTOMATIC_REPLACEMENT","AUTOMATIC_REPLACEMENT_GAP","AUTOMATIC_PREVIOUS_GROUP","OIL_COOLED","CALIPER"]),qe=async()=>{w.value=!0,!E.value&&(o.stateEmployeeData={id:l.user.EmployeeId,name:l.user.Name},X.value=="MANUAL"||X.value=="NORMAL"?await o.updateTaskReviseManual(a.component,a.sampleDate,l.user.Name,a.source).then(()=>{E.value?Qe(o.errors[0],"Ok"):A()}).catch(H=>{console.log(H),Qe("Error when revising. Please check your input.","Ok")}):X.value=="AUTOMATIC"||X.value.includes("PREVIOUS")||X.value=="CALIPER"?await o.updateTaskReviseAutomatic(a.component,a.sampleDate,l.user.Name,a.source).then(()=>{E.value?Qe(o.errors[0],"Ok"):A()}).catch(H=>{console.log(H),Qe("Error when revising. Please check your input.","Ok")}):X.value=="AVERAGE"?(await o.updateTaskReviseAverage(),E.value?Qe(o.errors[0],"Ok"):A()):X.value=="AUTOMATIC_REPLACEMENT"||X.value=="AUTOMATIC_REPLACEMENT_GAP"?await o.updateTaskReviseAutomaticReplacementAndGap(a.component,a.sampleDate,l.user.Name,a.source).then(()=>{E.value?Qe(o.errors[0],"Ok"):A()}).catch(H=>{console.log(H),Qe("Error when revising. Please check your input.","Ok")}):X.value=="OIL_COOLED"&&await o.updateTaskReviseOilCooled(a.component,a.sampleDate,l.user.Name,a.source).then(()=>{E.value?Qe(o.errors[0],"Ok"):A()}).catch(H=>{console.log(H),Qe("Error when revising. Please check your input.","Ok")}),w.value=!1)},A=()=>{La("Revision Successfully Submitted","Please allow up to 30 minutes for IronPortal to update visualisations.","Ok").then(()=>{B()})},N=H=>{c.setIsReplacementCamera(X.value==="AUTOMATIC_REPLACEMENT"||X.value==="AUTOMATIC_REPLACEMENT_GAP"),c.toggleIsVisible(!0,"modifiedCBM"),c.setShowCloseButton(H)},ie=_(""),_e=_(!1),Te=H=>{var me;if(d.value.length<1)return;let te;do te=(me=d.value.find(j=>j.key==H))==null?void 0:me.value;while(!te);return te},B=()=>{ce(),i("onClose")},ce=()=>{x.value=!1,r.value=!1,c.reset(),o.resetList(),o.resetErrors(),o.setInputErrorCbmAutomatic("",!1)},ve=()=>{if(X.value=="AVERAGE"&&o.initErrorInputCbmAverage(),ht.get($.value,"historyModified.detail.history.length",0)>=3){Qe("Cannot revise the data, you have limit for revising 2 times.","Ok");return}r.value=!0,o.setModifiedObject($)},Ke=async()=>{o.stateIsError=!0;const H=xa();console.log(H.menu.allMenu);const te=H.menu.allMenu.findIndex(j=>j.MenuId==224);o.setIsUserCanRevise(te!=-1),await et(),console.log("ðŸ“¦ detailCbm.value",$.value);const me=(X.value=="AUTOMATIC_REPLACEMENT"||X.value=="AUTOMATIC_REPLACEMENT_GAP")&&a.source=="serviceSheet"?$.value.replacementPhoto[0].items[2].value:$.value.detailedPicture;if(!me){b.value=[];return}C.value=Array.apply(null,Array(me)).map(function(){return!0}),V.value=0,d.value=[],console.log("ðŸ“¦ imagesFromCurrentCbm",me),b.value=Array.isArray(me)?Pt(me):me,console.log("ðŸ“¦ imageArray.value",b.value),await Xe()},et=async()=>{const H={taskKey:a.taskKey,workOrder:a.workOrder,component:a.component||""};switch(o.setParamGetDetailCbm(H),a.source){case"interim":await o.getDetailCbmInterim();break;case"intervention":await o.getDetailIntervention();break;default:await o.getDetailCbm();break}},Xe=async()=>{if(!(b.value&&b.value.length<1))for(const[H,te]of b.value.entries()){const me=await o.getImage(te);me&&(d.value.push({key:me.key,value:me.value}),b.value[H]={...b.value[H],imgBlob:me.blob,url:Te(b.value[H].filename)},C.value[H]=!1)}},je=_(),vt=H=>{const te=b.value.findIndex(j=>j.filename==H),me=b.value[te];if(te>0){const j=b.value.slice(te),pe=b.value.slice(0,te);je.value=[...j,...pe]}else je.value=b.value;ie.value=me.url,_e.value=!0},mt=()=>{ie.value="",_e.value=!1};return(H,te)=>{const me=G("inline-svg"),j=G("el-empty"),pe=G("el-skeleton-item"),fe=G("el-skeleton"),Le=G("el-alert"),Ge=G("el-button"),Ce=G("el-dialog"),se=He("loading");return n(),h(de,null,[f(Ce,{modelValue:p.value,"onUpdate:modelValue":te[2]||(te[2]=le=>p.value=le),title:"Detailed Information",width:"80%",onOpen:Ke,onClose:B},{footer:F(()=>[I.value&&Pe.value.includes(X.value)?ue((n(),h("div",om,[X.value!="CALIBRATION"?ue((n(),h("div",im,[f(Ge,{onClick:B},{default:F(()=>[he("Cancel")]),_:1}),r.value?(n(),ee(Ge,{key:0,disabled:E.value,onClick:qe,type:"primary"},{default:F(()=>[he(" Submit ")]),_:1},8,["disabled"])):(n(),ee(Ge,{key:1,onClick:ve,type:"primary"},{default:F(()=>[he("Revise")]),_:1}))])),[[se,R.value]]):Z("",!0)])),[[se,R.value]]):Z("",!0)]),default:F(()=>[!Pe.value.includes(X.value)&&!R.value?(n(),h("div",kd," Overwrite will be available soon ")):(n(),h("div",Sd,[e("div",Id,[ue((n(),h("div",Dd,[Ed,e("span",null,g($.value.workOrder),1)])),[[se,R.value]]),ue((n(),h("div",Md,[Ad,e("span",null,g($.value.equipment),1)])),[[se,R.value]]),ue((n(),h("div",Pd,[Od,e("span",null,g(P.value),1)])),[[se,R.value]])]),e("div",Rd,[Vd,M.value&&(X.value==="AUTOMATIC"||X.value.includes("PREVIOUS")||X.value==="AVERAGE")?(n(),ee(_i,{key:0,"item-service":Q.value,loading:R.value},null,8,["item-service","loading"])):M.value&&(X.value==="MANUAL"||X.value==="NORMAL")?(n(),ee(nd,{key:1,"item-service":Q.value,loading:R.value},null,8,["item-service","loading"])):X.value==="CALIBRATION"?(n(),ee(wd,{key:2,currentCondition:M.value,loading:R.value},null,8,["currentCondition","loading"])):X.value==="AUTOMATIC_REPLACEMENT"||X.value==="AUTOMATIC_REPLACEMENT_GAP"?(n(),ee(ll,{key:3,"item-service":Q.value,loading:R.value},null,8,["item-service","loading"])):X.value==="OIL_COOLED"?(n(),ee(Cl,{key:4,"item-service":we.value,loading:R.value},null,8,["item-service","loading"])):Z("",!0),M.value&&X.value==="CALIPER"?(n(),ee(Li,{key:5,"item-service":ne.value,loading:R.value},null,8,["item-service","loading"])):Z("",!0),X.value!="AUTOMATIC_REPLACEMENT_GAP"?(n(),h("h4",Td,"Detail Spec")):(n(),h("h4",$d,"Detail Spec Gap")),X.value!="AUTOMATIC_REPLACEMENT_GAP"?ue((n(),h("table",xd,[Ld,Nd,e("tbody",null,[(n(!0),h(de,null,Ne(q.value,(le,Oe)=>(n(),h("tr",{key:Oe,class:be(Oe%2==0?"even":"odd")},[e("th",Ud,g(le.cbmRating),1),e("th",Bd,g(le.minValueComplete),1),e("th",jd,g(le.maxValueComplete),1),e("th",Fd,g(le.uom),1)],2))),128))])])),[[se,R.value]]):ue((n(),h("table",Hd,[qd,Kd,e("tbody",null,[(n(!0),h(de,null,Ne(J.value,(le,Oe)=>(n(),h("tr",{key:Oe,class:be(Oe%2==0?"even":"odd")},[e("th",Gd,g(le.cbmRating),1),e("th",zd,g(le.minValueComplete),1),e("th",Jd,g(le.maxValueComplete),1),e("th",Wd,g(le.uom),1)],2))),128))])])),[[se,R.value]]),Zd,ue((n(),h("div",null,[!b.value||b.value.length===0?(n(),ee(j,{key:0},{image:F(()=>[f(me,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"30",height:"30"})]),description:F(()=>[Xd]),_:1})):(n(),h("div",Yd,[(n(!0),h(de,null,Ne(b.value,(le,Oe)=>(n(),h("div",{key:le.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[f(fe,{loading:C.value[Oe],animated:""},{template:F(()=>[f(pe,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},onClick:Ue=>vt(le.filename),alt:le.filename},null,8,["onClick","alt"])]),default:F(()=>[le.type&&(X.value==="AUTOMATIC_REPLACEMENT"||X.value==="AUTOMATIC_REPLACEMENT_GAP")?(n(),h("h4",Qd,g(le.type),1)):Z("",!0),e("div",em,[e("img",{src:le.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:Ue=>vt(le.filename),alt:le.filename},null,8,tm)])]),_:2},1032,["loading"])]))),128))]))])),[[se,R.value]])]),ue((n(),h("div",am,[e("h3",sm,g(r.value?"Condition Modified":"History Modified"),1),$.value.historyModified&&$.value.historyModified.detail.history.length>=3?(n(),ee(Le,{key:0,title:"You have reached the maximum limit for revising 2 times.",type:"info","show-icon":"",closable:!1,class:"mb-10 alert-revise"})):Z("",!0),X.value==="AUTOMATIC"||X.value.includes("PREVIOUS")||X.value==="CALIPER"?(n(),ee(or,{key:1,"detail-cbm":$.value,"is-modifying":r.value,source:t.source},null,8,["detail-cbm","is-modifying","source"])):X.value==="MANUAL"||X.value==="NORMAL"?(n(),ee(lc,{key:2,"is-modifying":r.value,source:t.source},null,8,["is-modifying","source"])):X.value==="AVERAGE"?(n(),ee($r,{key:3,"is-modifying":r.value},null,8,["is-modifying"])):X.value==="CALIBRATION"?(n(),ee(Lc,{key:4,"is-modifying":r.value},null,8,["is-modifying"])):Z("",!0),X.value==="AUTOMATIC_REPLACEMENT"||X.value==="AUTOMATIC_REPLACEMENT_GAP"?(n(),ee(gu,{key:5,"is-modifying":r.value,"normal-formula":q.value,"gap-formula":J.value,"is-replacement":$.value.isReplacementAdjustment,onOpenCamera:te[0]||(te[0]=le=>N(le))},null,8,["is-modifying","normal-formula","gap-formula","is-replacement"])):Z("",!0),X.value==="OIL_COOLED"?(n(),ee(Qu,{key:6,"is-modifying":r.value,source:t.source,onOpenCamera:te[1]||(te[1]=le=>N(le))},null,8,["is-modifying","source"])):Z("",!0)])),[[se,R.value]])]))]),_:1},8,["modelValue"]),f(Ca,{images:je.value,visibility:_e.value,image:ie.value,onHandleClose:mt},null,8,["images","visibility","image"]),f(ci,{visibility:K(c).isVisible},null,8,["visibility"])],64)}}}),nm=Be(lm,[["__scopeId","data-v-2ce7fc98"]]),rm={class:"row justify-content-center"},cm=["onClick","disabled"],um=re({__name:"Grid",props:["data","loading","loadingMapping"],emits:["showFormEdit"],setup(t,{emit:s}){const a=t,i=s,o=r=>r<2,l=r=>{console.log(r),i("showFormEdit",r)},c=()=>{i("showFormEdit",null)};return(r,d)=>{const p=G("el-button"),C=G("el-table-column"),V=G("inline-svg"),b=G("el-tooltip"),x=G("el-table"),w=He("loading");return n(),h(de,null,[f(p,{disabled:a.loadingMapping,type:"primary",class:"mb-5",size:"small",onClick:c},{default:F(()=>[he(" Add New ")]),_:1},8,["disabled"]),ue((n(),ee(x,{data:a.data,class:"table_dark-row table-dark","header-row-class-name":"table_dark-header","row-class-name":"table_dark-row text-white","element-loading-background":"#2d2b39b3"},{default:F(()=>[f(C,{prop:"model",label:"Model"}),f(C,{prop:"replacementSmu",label:"SMU"}),f(C,{prop:"replacementDate",label:"Replacement Date"},{default:F(I=>[e("span",null,g(K(Xa)(I.row.replacementDate)),1)]),_:1}),f(C,{label:"",width:"80"},{default:F(I=>[f(b,{class:"box-item",effect:"dark",content:o(I.row.transactionCount)?"Edit":"Data has been edited twice",placement:"top"},{default:F(()=>[e("div",rm,[e("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:R=>l(I.row),disabled:!o(I.row.transactionCount)},[f(V,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,cm)])]),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])),[[w,a.loading]])],64)}}}),pa={site:"",model:"",equipment:"",component:"",Page:1,PageSize:1,ver:"v1"},ha={componentReplacementId:0,site:"",model:"",equipment:"",component:"",componentAssignmentId:0,replacementDate:"",replacementSmu:0,hmoffset:0,frameHours:0,transactionCount:0},dm=Ht({id:"componentReplacement",state:()=>({stateGetParam:pa,stateComponentReplacementList:[],stateFormEdit:{...ha},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateLoadingMapping:!1,stateHmoffsetDefault:0,stateHmOffsetOption:[]}),getters:{componentReplacementList:t=>t.stateComponentReplacementList,formEdit:t=>t.stateFormEdit,loading:t=>t.stateLoading,loadingMapping:t=>t.stateLoadingMapping,hmoffsetDefault:t=>t.stateHmoffsetDefault,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError},actions:{async getAndSetComponentReplacementMapping(t,s){const a={equipment:t,component:s,ver:"v1"};try{this.stateLoadingMapping=!0,this.stateLoading=!0;const i=await ye.get(ys,"",new URLSearchParams(a).toString());this.setParam(i.data.result.content)}catch(i){Ve("IRONS",i),console.log(i)}finally{this.stateLoadingMapping=!1,this.stateLoading=!1}},async getComponentReplacementList(){const t={site:this.stateGetParam.site||"",model:this.stateGetParam.model||"",equipment:this.stateGetParam.equipment||"",component:this.stateGetParam.component||"",Page:this.stateGetParam.Page.toString(),PageSize:this.stateGetParam.PageSize.toString(),ver:"v1"};try{this.stateLoading=!0;const s=await ye.get(bs,"",new URLSearchParams(t).toString());this.stateComponentReplacementList=s.data.result.content}catch(s){Ve("IRONS",s),console.log(s)}finally{this.stateLoading=!1}},async getHmOffset(t,s){const a={equipment:t,ver:"v1"};try{this.stateLoading=!0;const i=await ye.get(_s,"",new URLSearchParams(a).toString());this.stateHmoffsetDefault=i.data.result.content.hmoffset||0,s||(this.stateFormEdit.frameHours=this.stateHmoffsetDefault)}catch(i){Ve("IRONS",i),console.log(i)}finally{this.stateLoading=!1}},async updateData(t){try{this.stateLoading=!0;const s={userAccount:t,ver:"v1"},a={componentReplacementId:this.stateFormEdit.componentReplacementId,site:this.stateFormEdit.site,model:this.stateFormEdit.model,equipment:this.stateFormEdit.equipment,component:this.stateFormEdit.component,componentAssignmentId:this.stateFormEdit.componentAssignmentId,replacementDate:Xt(Yt(new Date(this.stateFormEdit.replacementDate))),replacementSmu:this.stateFormEdit.replacementSmu,hmoffset:this.stateFormEdit.hmoffset,frameHours:this.stateFormEdit.frameHours,transactionCount:this.stateFormEdit.transactionCount},i=await ye.post(`${Cs}?${new URLSearchParams(s).toString()}`,a);i.data.title==="Error"?(this.stateErrors.push(i.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&Ae().setLoggedIn(!1),this.stateError=s,Ve("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setParam(t){this.stateGetParam.site=t.site,this.stateGetParam.model=t.model,this.stateGetParam.equipment=t.equipment,this.stateGetParam.component=t.component},setFormEditFromGetParam(){this.stateFormEdit.site=this.stateGetParam.site,this.stateFormEdit.model=this.stateGetParam.model,this.stateFormEdit.equipment=this.stateGetParam.equipment,this.stateFormEdit.component=this.stateGetParam.component},setFormEditFromRow(t){this.stateFormEdit.componentReplacementId=t.componentReplacementId,this.stateFormEdit.site=t.site,this.stateFormEdit.model=t.model,this.stateFormEdit.equipment=t.equipment,this.stateFormEdit.component=t.component,this.stateFormEdit.componentAssignmentId=t.componentAssignmentId,this.stateFormEdit.replacementDate=t.replacementDate,this.stateFormEdit.replacementSmu=t.replacementSmu,this.stateFormEdit.hmoffset=t.hmoffset,this.stateFormEdit.frameHours=t.frameHours,this.stateFormEdit.transactionCount=t.transactionCount},resetParam(){this.stateGetParam={...pa}},resetFormEdit(){this.stateFormEdit={...ha}},resetList(){this.stateComponentReplacementList=[]},resetErrors(){this.stateErrors=[],this.stateIsError=!1}}}),mm={key:0},pm={key:1,class:"form-component_replacement"},hm={class:"px-8 py-10","element-loading-background":"#2d2b39b3"},gm={key:0,class:"dialog-footer"},vm=re({__name:"Modal",props:{visibility:{type:Boolean,required:!1},equipment:{type:String,required:!0},component:{type:String,required:!0}},emits:["onClose"],setup(t,{emit:s}){const a=t,i=s,o=_(!1),l=Ae(),c=dm(),r=S(()=>c.loading),d=S(()=>c.loadingMapping),p=S(()=>c.hmoffsetDefault),C=S(()=>c.formEdit),V=S(()=>c.componentReplacementList),b=S(()=>c.errors),x=S(()=>c.isError),w=ms().shape({replacementDate:ps().required("Replacement Date is mandatory").typeError("Replacement Date is mandatory"),replacementSmu:hs().required("Replacement SMU is mandatory").typeError("Replacement SMU is mandatory")}),I=async u=>{c.resetFormEdit(),u?c.setFormEditFromRow(u):c.setFormEditFromGetParam(),await c.getHmOffset(C.value.equipment,!!u),o.value=!0},R=u=>{C.value.replacementDate=u},$=u=>{C.value.replacementSmu=u,C.value.frameHours=(parseInt(u)||0)+p.value},P=async()=>{if(E(),await w.validate(C.value,{abortEarly:!1}).catch(u=>{c.setErrors(u.errors)}),!x.value)try{await c.updateData(l.user.Name).then(()=>{if(!c.isError)Na("Please wait 30 minutes for the dashboard to update this change","Component Replacement has been logged in IronPortal!"),c.resetFormEdit(),o.value=!1;else{c.setErrors(c.errors);return}}),await c.getComponentReplacementList()}catch(u){console.log(u),c.setErrors(["There is something wrong. Please try again"])}},E=()=>{c.setErrors([])},q=()=>{c.resetFormEdit(),c.resetErrors(),o.value=!1},J=async()=>{await c.getAndSetComponentReplacementMapping(a.equipment,a.component),await c.getComponentReplacementList()},M=()=>{o.value=!1,c.resetFormEdit(),c.resetParam(),c.resetList(),c.resetErrors()},v=()=>{M(),i("onClose")},y=it(a,"visibility");return(u,k)=>{const U=G("el-col"),O=G("el-row"),T=G("el-button"),m=G("el-dialog"),D=He("loading");return n(),ee(m,{modelValue:y.value,"onUpdate:modelValue":k[0]||(k[0]=Q=>y.value=Q),"modal-class":"modal-component_replacement",title:"Component Replacement",width:"50%",onOpen:J,onClose:v},{footer:F(()=>[o.value?(n(),h("div",gm,[f(T,{onClick:q,disabled:r.value},{default:F(()=>[he("Cancel")]),_:1},8,["disabled"]),f(T,{type:"primary",onClick:P,disabled:r.value},{default:F(()=>[he(g(C.value.componentReplacementId==0?"Add":"Save"),1)]),_:1},8,["disabled"])])):Z("",!0)]),default:F(()=>[o.value?(n(),h("div",pm,[ue((n(),h("div",hm,[f(O,{gutter:50},{default:F(()=>[f(U,{span:12},{default:F(()=>[f(Mt,{labelClass:"text-white",value:C.value.site,label:"Site",name:"Site",disabled:!0},null,8,["value"]),f(Mt,{labelClass:"text-white",value:C.value.equipment,label:"Equipment",name:"Equipment",disabled:!0},null,8,["value"]),f(vs,{class:"custom-text-input",labelClass:"text-white",value:C.value.replacementDate,label:"Replacement Date",name:"ReplacementDate","format-date":"DD/MM/YYYY",onHandleChange:R},null,8,["value"]),f(Mt,{labelClass:"text-white",value:C.value.frameHours,label:"Frame Hours",name:"FrameHours",disabled:!0},null,8,["value"])]),_:1}),f(U,{span:12},{default:F(()=>[f(Mt,{labelClass:"text-white",value:C.value.model,label:"Model",name:"Model",disabled:!0},null,8,["value"]),f(Mt,{labelClass:"text-white",value:C.value.component,label:"Component",name:"Component",disabled:!0},null,8,["value"]),f(gs,{labelClass:"text-white",value:C.value.replacementSmu,label:"Replacement SMU",name:"ReplacementSmu",onHandleChange:$},null,8,["value"])]),_:1})]),_:1})])),[[D,r.value]])])):(n(),h("div",mm,[f(um,{data:V.value,loading:r.value,loadingMapping:d.value,onShowFormEdit:I},null,8,["data","loading","loadingMapping"])])),f(za,{name:"fade"},{default:F(()=>[x.value?(n(),ee(fs,{key:0,errorMessages:b.value,onResetForm:E},null,8,["errorMessages"])):Z("",!0)]),_:1})]),_:1},8,["modelValue"])}}}),fm={class:"text-bold"},ym={key:0,"element-loading-background":"#2d2b39b3","element-loading-text":"Loading",class:"mb-5 py-10"},bm=re({__name:"SensorList",props:{listData:{required:!0,type:Array},reRender:{default:!1},selectAll:{type:Boolean,required:!0},lastPage:{type:Number,required:!0},currentPage:{type:Number,required:!0},tableHeight:{type:Number,required:!0}},emits:["infiniteScroll_lastDataSearch","changeSelectAll"],setup(t,{emit:s}){const a=s,i=t,o=Qt(),l=_(),c=async w=>{o.updateSensorDataList(w)},r=wa.debounce(w=>{console.log("emit debounce"),a("infiniteScroll_lastDataSearch",w)},1e3),d=S(()=>{const w=l.value;return w?w.$el.querySelector(".el-table__body-wrapper"):void 0}),p=S(()=>o.loadingSensor),C=()=>{const w=d.value;console.log("scrollableEl",w),w&&w.addEventListener("scroll",I=>{if(console.log(w.scrollHeight,w.scrollTop),w.scrollHeight-w.scrollTop<=500){r("next");return}})},V=w=>{a("changeSelectAll",w.length>0)},b=()=>{if(i.listData.length>0){const w=i.listData.filter(I=>I.isCheck==!0);w.length==i.listData.length&&a("changeSelectAll",!0),w.forEach(I=>{l.value.toggleRowSelection(I,!0)})}else console.log("ELSE CLEAR SELECTION"),l.value.clearSelection(),a("changeSelectAll",!1)};Ze(()=>i.reRender===!0,()=>{b()});const x=w=>{if(w=="A")return"background: #54D62C;";if(w=="B")return"background: blue;";if(w=="C")return"background: orange;";if(w=="X")return"background: #FF4842;"};return St(()=>{const w=d.value;w&&w.addEventListener("scroll",C)}),jt(()=>{const w=d.value;w&&w.removeEventListener("scroll",C)}),(w,I)=>{const R=He("loading");return ue((n(),ee(K(cs),{ref_key:"tableSensorListRef",ref:l,data:i.listData,"element-loading-background":"#2d2b39b3","empty-text":"No Data",height:"320",class:"table-row table-dark sensor-table","header-row-class-name":"table-header","row-class-name":"table-row text-white",onSelectionChange:c,onSelectAll:V,"row-key":"sensorId","select-on-indeterminate":""},{append:F(()=>[i.currentPage!=i.lastPage&&i.listData.length>0?ue((n(),h("div",ym,null,512)),[[R,!0]]):Z("",!0)]),default:F(()=>[f(K(ot),{prop:"componentName",label:"Component","min-width":"125"}),f(K(ot),{prop:"sensorParameter",label:"Sensor Parameter","min-width":"125"}),f(K(ot),{prop:"occurence",label:"Occurence",align:"center","min-width":"100"}),f(K(ot),{prop:"aggregate",label:"Agregate",align:"center"}),f(K(ot),{prop:"uom",label:"UoM",align:"center"}),f(K(ot),{prop:"value",label:"Value",align:"center"}),f(K(ot),{prop:"rating",label:"Rating",align:"center"},{default:F($=>[e("div",{style:bt(x($.row.rating))},[e("span",fm,g($.row.rating),1)],4)]),_:1}),f(K(ot),{prop:"cautionThreshold",label:"Caution Threshold",align:"center"}),f(K(ot),{prop:"criticalThreshold",label:"Critical Threshold",align:"center"}),f(K(ot),{"reserve-selection":"",class:"table-selection","class-name":"table-selection",type:"selection",align:"center"})]),_:1},8,["data"])),[[R,p.value&&i.listData.length==0]])}}}),ea=t=>(Je("data-v-414f1348"),t=t(),We(),t),_m={class:"w-95 mx-auto section-summary-intervantion"},Cm={class:"div-dark-rounded my-3 pt-5 px-10"},wm={class:"d-flex align-items-top mt-3"},km=ea(()=>e("p",{class:"text-white w-5 me-3"}," Filter by: ",-1)),Sm={class:"div-dark-rounded py-7 px-10 w-100 d-flex align-items-start flex-column",style:{"flex-grow":"1",height:"100%"}},Im=ea(()=>e("h3",{class:"text-white mb-3"},"Summary Caution & Critical List",-1)),Dm=ea(()=>e("h4",{class:"text-white"},"Sensor",-1)),Em={class:"d-flex justify-content-end mt-3 mt-auto w-100"},Mm=re({__name:"Index",emits:["onBack","onSubmitSummaryIntervention"],setup(t,{emit:s}){const a=S({get(){return l.rerenderSensorList},set(y){l.setReRenderSensorSelection(y)}}),i=s,o=Ae(),l=Qt(),c=S(()=>l.isSensorSelectAll),r=S(()=>l.filter),d=S(()=>l.filterLoading),p=S(()=>l.sensorDataList),C=S(()=>l.sensorDataLastPage),V=S(()=>l.sensorDataCurrentPage),b=S(()=>l.isError),x=S(()=>l.errors),w=y=>{l.getSensorDataListPaginate(y)},I=async y=>{r.value.site=y,sessionStorage.setItem("IronPortalDashboardFilter-Site",JSON.stringify([y])),y!=""&&await l.getModelLookup(),await R("")},R=async y=>{r.value.model=y,sessionStorage.setItem("IronPortalDashboardFilter-Model",JSON.stringify([y])),y!=""&&await l.getEquipmentLookup(),await $("")},$=async y=>{r.value.equipment=y,sessionStorage.setItem("IronPortalDashboardFilter-Equipment",JSON.stringify([y])),y!=""&&await l.getComponentLookup(),await P([])},P=y=>{console.log(y);let u=[];y.length==0&&r.value.equipment!=""?u=["All"]:(y.includes("All")&&y.splice(0,1),u=y),l.setFilterComponent(u),sessionStorage.setItem("IronPortalDashboardFilter-Component",JSON.stringify(y.length!=0?u:[])),l.setIsSensorSelectAll(!1),a.value=!1,l.resetList(),a.value=!0,r.value.site!=""&&r.value.model!=""&&r.value.equipment!=""&&r.value.component.length>0&&E()},E=wa.debounce(()=>{l.getSensorDataListPaginate()},1500),q=()=>{i("onBack")},J=async()=>{Ua("Are you sure you want to submit?").then(async y=>{y.isConfirmed&&l.updateIntervention(o.user.Name).then(()=>{b.value?Qe(x.value[0],"OK",!1):Ba("Form has been successfully submitted!","OK").then(()=>{i("onSubmitSummaryIntervention")})})})},M=y=>{const u=sessionStorage.getItem(y);return u?JSON.parse(u):[]},v=y=>{const u=sessionStorage.getItem(y);return u&&u.length>0?JSON.parse(u)[0]:""};return ya(async()=>{const y=v("IronPortalDashboardFilter-Site"),u=v("IronPortalDashboardFilter-Model"),k=v("IronPortalDashboardFilter-Equipment"),U=M("IronPortalDashboardFilter-Component");y&&await I(y),u&&await R(u),k&&await $(k),U&&await P(U)}),(y,u)=>{const k=G("inline-svg"),U=G("el-button"),O=He("loading");return n(),h("div",_m,[e("div",Cm,[f(U,{text:"",class:"dark-btn",onClick:q},{default:F(()=>[f(k,{src:"/media/icons/bootstrap-icon/arrow-left-short.svg",width:"36",height:"36",fill:"white"}),he(" Back to Component Condition Summary (Medium-Long Term) Item selected ")]),_:1}),e("div",wm,[km,f(Ut,{class:"custom-text-input me-3 w-15",value:r.value.site,isLoading:d.value.site,placeholder:"Select Site",name:"Site",max:200,onHandleChange:I,options:K(l).siteOption},null,8,["value","isLoading","options"]),f(Ut,{class:"custom-text-input me-3 w-15",value:r.value.model,isLoading:d.value.model,placeholder:"Select Equipment Model",name:"EquipmentModel",max:200,onHandleChange:R,"is-disabled":!r.value.site,options:K(l).modelOption},null,8,["value","isLoading","is-disabled","options"]),f(Ut,{class:"custom-text-input me-3 w-15",value:r.value.equipment,isLoading:d.value.equipment,placeholder:"Select Equipment Number",name:"EquipmentNumber",max:200,onHandleChange:$,"is-disabled":!r.value.model,options:K(l).equipmentOption},null,8,["value","isLoading","is-disabled","options"]),f(Ut,{class:"custom-text-input me-3 w-50",value:r.value.component,isLoading:d.value.component,placeholder:"Select Component",name:"Component",max:200,isMultiple:!0,onHandleChange:P,"is-disabled":!r.value.equipment,options:K(l).componentOption},null,8,["value","isLoading","is-disabled","options"])])]),e("div",Sm,[Im,Dm,f(bm,{reRender:a.value,listData:p.value,selectAll:c.value,lastPage:C.value,currentPage:V.value,onInfiniteScroll_lastDataSearch:w,onChangeSelectAll:u[0]||(u[0]=T=>K(l).setIsSensorSelectAll(T))},null,8,["reRender","listData","selectAll","lastPage","currentPage"]),e("div",Em,[ue((n(),ee(U,{disabled:p.value.length==0,onClick:J,type:"success"},{default:F(()=>[he(" Submit for Intervention Form ")]),_:1},8,["disabled"])),[[O,K(l).loadingUpdate]])])])])}}}),Am=Be(Mm,[["__scopeId","data-v-414f1348"]]);function Pm(){return{getDataSelection:(s,a)=>{const i=s.toLowerCase();if(a.length<1)return[""];const o=[""];return i=="engine"?o[0]=ga(a,"Blow-By Press Max")?"Blow-By Press Max":a[0]:i=="transmission"?o[0]=ga(a,"Trn Slip Gear Change: 2-3 Ave")?"Trn Slip Gear Change: 2-3 Ave":a[0]:o[0]=a[0],console.log(o),o}}}const ga=(t,s)=>!!t.find(i=>i==s),Om=async t=>{const s=[];try{(await t.bookmarksManager.getBookmarks()).forEach(function(i){s.push({key:i.displayName,value:i.name})})}catch(a){console.log("get bookmark failed",a)}return s},Rm=(t,s,a,i)=>{let o="";if(!a.includes(s))return o;const l=i[0].identity;if(Array.isArray(l)&&l.length>2){const c=l[0].equals.replaceAll(" ",""),r=l[2].equals,d=`${c}_${r}`,p=t.find(C=>C.key==d);p&&(o=p.value)}return o},va=(t,s)=>{let a="";const i=s.find(o=>o.key==t);return i&&(a=i.value),a},Vm={"element-loading-background":"#2d2b39b3",style:{height:"90vh"}},Tm=5,$m=3e5,xm=re({__name:"PbiReportEquipment",props:["reportName","visibletab","isPublic","pbiReportId","pbiWorkspaceId","isHideVisualHeaders","isTransparent","filterEquipment"],emits:["handle-click"],setup(t,{emit:s}){const{getDataSelection:a}=Pm(),i=t,o=ba(),l=Ae(),c=Qt(),r=_(""),d=_(""),p=_(""),C=_(""),V=_(""),b=_("serviceSheet"),x=_(!1),w=_([]),I=_([]),R=_(),$=_(0),P=_(""),E=_(!0),q=_(!1),J=_(!1),M=_(!1),v=_({site:"",component:"",model:"",equipment:""}),y=_(!1);let u;const k=[{slicerTitle:"Parameter OMS site",column:"site_description",table:"vw_dim_site",btnClearTitles:["clear_site"],sessionStorageName:"IronPortalDashboardFilter-Site"},{slicerTitle:"Parameter OMS model unit",column:"model_unit",table:"vw_dim_equipment",btnClearTitles:["clear_model"],sessionStorageName:"IronPortalDashboardFilter-Model"},{slicerTitle:"Parameter OMS equipment",column:"equipment",table:"vw_dim_equipment",btnClearTitles:["clear_equipment"],sessionStorageName:"IronPortalDashboardFilter-Equipment"},{slicerTitle:"Parameter OMS component name",column:"component_name",table:"vw_dim_component",btnClearTitles:["clear_component"],sessionStorageName:"IronPortalDashboardFilter-Component"},{slicerTitle:"Group_Parameter",column:"sample_group",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Group_Parameter"},{slicerTitle:"Parameter",column:"parameter_to",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Parameter"},{slicerTitle:"Time_Slicer",column:"Sranking",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Time_Slicer"}],U=["S1_exportPDF","S2_exportPDF","S3_exportPDF","S4_exportPDF","S5_exportPDF","S6_exportPDF","S7_exportPDF","S8_exportPDF"],O=["btn_s1_back","btn_s2_back","btn_s3_back","btn_s4_back","btn_s5_back","btn_s6_back","btn_s7_back","btn_s8_back"],T=S(()=>o.getters.getIsDashboardConfigLoading),m=S(()=>o.getters.getDashboardConfigPbi),D=()=>{const B={type:"report",tokenType:pt.models.TokenType.Embed||"",accessToken:m.value.embedToken.token||"",embedUrl:m.value.embedReport[0].embedUrl||"",id:m.value.embedReport[0].reportId||"",permissions:pt.models.Permissions.All,settings:{panes:{filters:{visible:!1},pageNavigation:{visible:typeof i.visibletab>"u"?!0:i.visibletab}}}};if(i.isTransparent&&(B.settings.background=pt.models.BackgroundType.Transparent),sessionStorage.getItem("PbiEquipment_DetailInfo")=="true"){const ce=sessionStorage.getItem("PbiEquipment-Page_Map_Fullscreen");B.pageName=ce||"ReportSectiond46a3f7350de24c93ad7"}return B},Q=B=>{switch(B){case"Parameter OMS component name":return!0;case"Parameter OMS equipment":return!0;case"Parameter OMS model unit":return!0;case"Parameter OMS site":return!0;default:return!1}},W=_("S1"),z=()=>{try{if(typeof m.value<"u"){const B=D();let ce=new pt.service.Service(pt.factories.hpmFactory,pt.factories.wpmpFactory,pt.factories.routerFactory);R.value&&(u=ce.embed(R.value,B)),u.off("loaded"),u.on("loaded",async()=>{I.value=await Om(u);let ve=[],Ke=[];await u.getPages().then(j=>{ve=j}).catch(j=>{console.log("error get pages",j)}),await ve.find(j=>j.isActive).getVisuals().then(j=>{Ke=j}).catch(j=>{console.log("error get visuals",j)});const Xe=await es(l.user.EmployeeId);if(Xe&&Xe!=="AU02"){const j={$schema:"http://powerbi.com/product/schema#basic",target:{table:k[0].table,column:k[0].column},operator:"In",values:[l.user.Location]};let pe;pe=document.getElementById("equimentContainer"),u=ce.get(pe);try{await u.setFilters([j])}catch(fe){console.log(fe)}}const je=ae(k[0].sessionStorageName);P.value=Xe=="AU02"?"Blackwater":l.user.Location;const vt=[P.value],mt=je&&je.length>0?je:vt,H={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[...mt],target:{table:k[0].table,column:k[0].column},filterType:1,requireSingleSelection:!0}]};let te=Ke.filter(j=>j.type==="slicer"&&j.title==="Parameter OMS site")[0];try{Xe!=="AU02"&&(await te.setSlicerState(H),console.log("success set slicer site"))}catch(j){console.log(j)}qe(k[0].slicerTitle,"In",[...mt],[]);const me=async j=>{let pe=Ke.filter(fe=>fe.title==="slicer data trend")[0];try{let fe=await pe.exportData();fe=ta(fe?fe.data:"");const Le={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[...a(j,fe)],target:{table:"vw_b0_pm_ehms_omsstatus",column:"parameter_to"},filterType:1,requireSingleSelection:!0}]};await pe.setSlicerState(Le),console.log("success set slicer data trend")}catch(fe){console.error("error set slicer data trend",fe)}};u.off("bookmarkApplied"),u.on("bookmarkApplied",async j=>{if(console.log(`Event - bookmarkApplied:
`,j.detail),j.detail.bookmarkName=="Bookmarka04d85905eb7cbd75ae4"){const pe=ne(k[3].sessionStorageName);await me(pe)}}),u.off("dataSelected"),u.on("dataSelected",async function(j){var se,le,Oe,Ue;console.log("event.detail",j.detail);let pe=j.detail;const fe=pe.dataPoints,Le=["matrix_condition_summary","Matrix_3dp&vims"];try{J.value=!0;const Se=Rm(I.value,pe.visual.title,Le,fe);if(Se){fe[0].values.length!=0&&(W.value=fe[0].values[2].value),await u.bookmarksManager.apply(Se);return}}catch(Se){console.log(Se)}finally{J.value=!1}if(j.detail.visual.title=="Matrix_3dp&vims"){const Se="ReportSectione5ba9be2aabce8d119d9";try{let Ee=await(await ve.find(rt=>rt.displayName==="Detail Information").getVisuals()).find(rt=>rt.title==="hide_ranking").exportData();const Fe=aa(Ee.data);await u.setPage(Se);const nt=await ve.find(rt=>rt.displayName==="Pop-up Chart").getVisuals();if(nt){let rt=nt.find(ft=>ft.title==="parameter_slicer"),zt=nt.find(ft=>ft.title==="ranking_slicer");const st={filters:[{$schema:"http://powerbi.com/product/schema#basic",target:{table:"vw_b0_pm_ehms_oms_3dphornet_map",column:"parameter_to"},filterType:1,operator:"In",values:[Fe[1]],requireSingleSelection:!1}]};await rt.setSlicerState(st),console.log("Succes set slicer param");const Jt={filters:[{$schema:"http://powerbi.com/product/schema#basic",target:{table:"vw_b0_pm_ehms_oms_3dphornet_map",column:"sample_ranking"},filterType:1,operator:"In",values:[Fe[0]],requireSingleSelection:!1}]};await zt.setSlicerState(Jt),console.log("Succes set slicer ranking")}}catch(De){console.log(De)}}if(pe.visual.title==="ironforms_matrix"&&fe.length>0){x.value=!1;try{C.value=(se=fe[0].values)==null?void 0:se.find(De=>De.target.column==="task_key").formattedValue,p.value=(le=fe[0].values)==null?void 0:le.find(De=>De.target.column==="work_order").formattedValue,V.value=(Oe=fe[0].values)==null?void 0:Oe.find(De=>De.target.column==="sample_date").value,((Ue=fe[0].values)==null?void 0:Ue.find(De=>De.target.column==="sample_type_from").value)=="INTERVENTION"?b.value="intervention":b.value="serviceSheet",r.value=ne(k[2].sessionStorageName),d.value=ne(k[3].sessionStorageName),_e()}catch(Se){w.value=[],console.error("error get image",Se)}}if(pe.visual.title=="matrix_condition_summary"&&fe.length>0){x.value=!1;try{const $e=await(await(await u.getActivePage()).getVisuals()).filter(Fe=>Fe.title==="wo_taskkey_matrix")[0].exportData(),Ee=aa($e.data);if(Ee.length<6)return;C.value=Ee[1],p.value=Ee[2],V.value=new Date(Ee[4]),Ee[3]=="INTERIM"?b.value="interim":Ee[3]=="INTERVENTION"?b.value="intervention":b.value="serviceSheet",r.value=ne(k[2].sessionStorageName),d.value=ne(k[3].sessionStorageName),_e()}catch(Se){w.value=[],console.error("error get image",Se)}}const Ce=["Parameter OMS site","Parameter OMS model unit","Parameter OMS equipment","Parameter OMS component name","Group_Parameter","Time_Slicer"].includes(pe.visual.title);if(pe.visual.type=="slicer")try{if(J.value=!0,q.value){q.value=!1;const Ee=va(`IronFormsCBM_${W.value}`,I.value);if(Ee)try{await u.bookmarksManager.apply(Ee)}catch(Fe){console.log(Fe)}}let tt=(await(await u.getActivePage()).getVisuals()).filter(Ee=>Ee.type==="slicer"&&Ee.title===pe.visual.title)[0];const $e=await tt.getSlicerState();if($e){let Ee=[],Fe="",at=[];if($e.filters.length>0){at=Ce?[$e.filters[0].values[$e.filters[0].values.length-1]]:$e.filters[0].values,Fe=$e.filters[0].operator;const nt={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:at,target:{table:$e.filters[0].target.table,column:$e.filters[0].target.column},filterType:1,requireSingleSelection:!Ce}]};await tt.setSlicerState(nt)}if(at.length==0||$e.filters[0].operator=="NotIn"){let nt=await tt.exportData();Ee=ta(nt.data)}qe(pe.visual.title,Fe,at,Ee)}}catch(Se){console.log(Se)}finally{J.value=!1}if(Q(pe.visual.title)&&!sessionStorage.getItem("PbiEquipment_DetailInfo")){const Se=ne(k[3].sessionStorageName);await me(Se)}if(pe.visual.title=="table_intervention"){if(j.detail.dataPoints.length==0)return;const Se={keyPbi:j.detail.dataPoints[0].identity[0].equals};try{sessionStorage.setItem("formFilter",JSON.stringify(Se)),A("#/ironportal-dashboard/intervention","intervention")}catch(De){console.log(De)}}}),u.off("buttonClicked"),u.on("buttonClicked",async j=>{var Le,Ge;if(console.log(j.detail),j.detail.title=="IF_graph_s1")q.value=!0;else if(j.detail.title=="IF_table_s1"){q.value=!1;const Ce=va(`IronFormsCBM_${W.value}`,I.value);if(Ce)try{await u.bookmarksManager.apply(Ce)}catch(se){console.log(se)}}if(U.includes(j.detail.title)){Pe();return}if(j.detail.title=="btn_back_equipment"){sessionStorage.removeItem("PbiEquipment_DetailInfo");return}if(j.detail.title.includes("fullscreen")){const Ce=ve.filter(se=>se.displayName==`S${j.detail.title[1]}_Map`)[0];sessionStorage.setItem("PbiEquipment-Page_Map_Fullscreen",Ce.name);try{await Ce.setActive(),console.log(`succes set S${j.detail.title[1]}_Map`)}catch(se){console.log(se)}return}if(O.includes(j.detail.title)){sessionStorage.removeItem("PbiEquipment-Page_Map_Fullscreen");return}if(j.detail.title=="component_replacement"){v.value.equipment=ne(k[2].sessionStorageName),v.value.component=ne(k[3].sessionStorageName),v.value.equipment&&v.value.component?M.value=!0:ja("Please select Equipment and Component first","Ok");return}if(j.detail.title=="summary_intervention"){localStorage.setItem("PbiEquipment_ShowPbi","false"),A("#/ironportal-dashboard/equipment","summary intervention");return}if(j.detail.title=="detail information"){localStorage.setItem("PbiEquipment_DetailInfo","true"),A("#/ironportal-dashboard/equipment","detail information");return}if(!((Le=j.detail.title)!=null&&Le.includes("clear"))&&!((Ge=j.detail.title)!=null&&Ge.includes("clr")))return;const pe=k.findIndex(Ce=>{var se;return(se=Ce.btnClearTitles)==null?void 0:se.includes(j.detail.title)});if(pe==-1)return;for(let Ce=pe;Ce<k.length;Ce++){const se=k[Ce];qe(se.slicerTitle,"",[],[])}if(k[0].btnClearTitles.findIndex(Ce=>j.detail.title.includes(Ce))!=-1){const Ce={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[P.value],target:{table:k[0].table,column:k[0].column},filterType:1,requireSingleSelection:!0}]};try{await(await(await u.getActivePage()).getVisuals()).filter(Ue=>Ue.type==="slicer"&&Ue.title===k[0].slicerTitle)[0].setSlicerState(Ce),console.log("success set site again")}catch(se){console.log(se)}qe(k[0].slicerTitle,"In",[],[])}}),k.forEach(async j=>{let Le=(await(await u.getActivePage()).getVisuals()).filter(se=>se.type==="slicer"&&se.title===j.slicerTitle)[0];const Ge=ne(j.sessionStorageName);let Ce=[Ge];if((sessionStorage.getItem("PbiEquipment_DetailInfo")&&j.slicerTitle=="Parameter OMS component name"||j.slicerTitle=="Parameter")&&(Ce=ae(j.sessionStorageName)),!!Le)if(Ge){const se={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:Ce,target:{column:j.column,table:j.table},filterType:1,requireSingleSelection:!1}]};try{await Le.setSlicerState(se)}catch(le){console.log(le)}j.slicerTitle==="Parameter OMS component name"&&await me(Ge)}else try{const le=(await(Le==null?void 0:Le.getSlicerState())).filters[0].values;le&&le.length>0&&qe(j.slicerTitle,"In",le,[])}catch(se){console.log(se)}})}),u.off("rendered"),u.on("error",async function(ve){ve.detail=="TokenExpired"&&await we(()=>{ke()}),u.off("error")})}}catch(B){console.log(B)}},ae=B=>{const ce=sessionStorage.getItem(B);return ce?JSON.parse(ce):[]},ne=B=>{const ce=sessionStorage.getItem(B);return console.log(ce),ce&&ce.length>0?JSON.parse(ce)[0]:""},we=async B=>{await o.dispatch(Ja.GET_PBI_CONFIG,{reportName:i.reportName,isPublic:i.isPublic,reportId:i.pbiReportId,workspaceId:i.pbiWorkspaceId}),B()},ke=async()=>{await u.setAccessToken(m.value.embedToken.token),await u.refresh()},X=()=>{const ce=Ya(new Date),Ke=Date.parse(m.value.embedToken.expiration)-ce,et=Tm*60*1e3;Ke<=et&&we(function(){ke()})},Pe=()=>{u&&u.print()},qe=async(B,ce,ve,Ke)=>{let et=[];ve.length>0&&ce=="In"?et=[...ve]:ve.length>0&&ce=="NotIn"&&(et=Ke.filter(je=>je!=""&&ve.indexOf(je)==-1));const Xe=k.find(je=>je.slicerTitle==B);Xe&&sessionStorage.setItem(Xe.sessionStorageName,JSON.stringify(et))},A=(B,ce)=>{const ve=window.open(B,"_blank");(!ve||ve.closed||typeof ve.closed>"u")&&Fa(`Please allow pop-up permission on your browser if ${ce} page is not opened in a new tab.`,"OK")},N=()=>{E.value=!0,sessionStorage.removeItem("PbiEquipment_ShowPbi")},ie=async()=>{sessionStorage.removeItem("PbiEquipment_ShowPbi"),sessionStorage.removeItem("PbiEquipment_DetailInfo"),E.value=!0,u&&u.on("loaded",async()=>{try{const ce=(await u.getPages()).find(ve=>ve.displayName=="Equipment");console.log(ce)}catch(B){console.log(B)}})},_e=()=>{y.value=!0},Te=()=>{b.value="serviceSheet",y.value=!1};return St(async()=>{localStorage.getItem("PbiEquipment_DetailInfo")=="true"&&(sessionStorage.setItem("PbiEquipment_DetailInfo","true"),localStorage.removeItem("PbiEquipment_DetailInfo")),(localStorage.getItem("PbiEquipment_ShowPbi")=="false"||sessionStorage.getItem("PbiEquipment_ShowPbi")=="false")&&(sessionStorage.setItem("PbiEquipment_ShowPbi","false"),localStorage.removeItem("PbiEquipment_ShowPbi"),E.value=!1,await c.getSiteLookup()),await we(()=>{z()}),$.value=setInterval(()=>{X()},$m)}),Qa(()=>{$.value&&clearInterval($.value)}),(B,ce)=>{const ve=He("loading");return ue((n(),h("div",Vm,[ue(e("div",{id:"equimentContainer",ref_key:"reportContainer",ref:R,style:{height:"100%"}},null,512),[[ut,E.value],[ve,T.value]]),E.value?Z("",!0):(n(),ee(Am,{key:0,onOnBack:N,onOnSubmitSummaryIntervention:ie})),f(nm,{visibility:y.value,taskKey:C.value,workOrder:p.value,"asset-number":r.value,component:d.value,"sample-date":V.value,source:b.value,onOnClose:Te},null,8,["visibility","taskKey","workOrder","asset-number","component","sample-date","source"]),f(vm,{visibility:M.value,equipment:v.value.equipment,component:v.value.component,onOnClose:ce[0]||(ce[0]=Ke=>M.value=!1)},null,8,["visibility","equipment","component"])])),[[ve,J.value]])}}}),Lm="AM-EHM-Equipment",Nm=re({__name:"Index",setup(t){const s=_(!1),a=_(!1),i=Ae(),o=ba(),l=S(()=>({reportName:Lm,visibletab:!1,isPublic:!1,isTransparent:!0,isHideVisualHeaders:!0,pbiReportId:"a9befe6f-7bc4-4d4a-91c1-8715b01416c5",pbiWorkspaceId:"d90b69f1-3a2e-423e-9e27-e341dc02a972"})),r=setInterval(()=>{a.value&&(s.value=!0,d())},1*60*1e3);ya(()=>{o.commit(Wa.SET_PBI_URL,"https://digital-bumaau-dev-apm-001.azure-api.net/amadm")});const d=async()=>{const C={email:i.user.Email,ver:"v1"};if(s.value){try{await ye.get(Ha,"",new URLSearchParams(C).toString())}catch(V){console.log(V)}s.value=!1}};return St(()=>{a.value=!0}),jt(()=>{a.value=!1,clearInterval(r)}),(p,C)=>(n(),ee(xm,fa(l.value,{class:"equipment-dashboard"}),null,16))}}),Gp=Be(Nm,[["__scopeId","data-v-af555c8e"]]);export{Gp as default};
