import{d as ee}from"./pinia-BjOS2_Ao.js";import{u as J}from"./authentication-handler-B3K6P3Fb.js";import{b as Y,s as X,p as ue,e as oe}from"./index-BCnwA6yE.js";import{A as ce}from"./date-format-BASVuupi.js";import{k as H,c as P,p as b,aa as O,aB as v,b4 as Z,A as R,y as de,a5 as me,C as D,F as z,r as h,a0 as ne,d as ie,q as U,x as w,R as A,s as L,$ as re,_ as fe,B as V,b6 as _,P as se}from"./@vue-BypzYtbH.js";import{e as he}from"./lodash-Cr9vlq0V.js";import{b as ge}from"./@vueuse-MfruhCTE.js";const Je=e=>/^\d{1,5}(\.\d{1,2})?$/.test(e),Xe=e=>{let a=!0;return e.length>5&&(a=!1),a},Ze=e=>{if(e.indexOf(".")>0)return e.indexOf(".")==e.length-1},ve=e=>e.indexOf(".")>0?e.length-e.indexOf("."):-1,et=(e,a=0)=>{if(e){e=String(e).replaceAll(",","");const t=String(e);if(t=="0"||t[1]==".")return t;const d=t.slice(-1)==".";let s=Number(t).toLocaleString("en-AU");if(s=="NaN"&&(s=""),d&&(s=`${s}.`),a&&ve(s)>a+1){const o=s.split(".");s=o[0]+"."+o[1].slice(0,a)}return s}else return e},M=e=>{if(!e||typeof e=="string")return[];const a=[];return e.forEach(t=>{typeof t=="string"?a.push({filename:t,description:t.split("%5E")[1]??""}):a.push(t)}),a.filter((t,d,s)=>d===s.findIndex(p=>p.filename===t.filename&&p.description===t.description))},tt=ee({id:"camera",state:()=>({stateIsVisible:!1,stateImageObjects:[],stateCurrentObject:{},stateShowCloseButton:!0,stateIsCameraError:!1,stateImage:"",stateBlob:void 0,stateIsActionFromDelete:!1,stateIsReplacement:!1,stateReplacementTool:"",stateReplacementPhotoLength:0,stateReplacementPosition:"cab side"}),getters:{isVisible:e=>e.stateIsVisible,currentImage:e=>e.stateImage,currentBlob:e=>e.stateBlob,ImageObjects:e=>e.stateImageObjects,Current:e=>e.stateCurrentObject,ShowCloseButton:e=>e.stateShowCloseButton,IsFromActionDelete:e=>e.stateIsActionFromDelete,isReplacementCamera:e=>e.stateIsReplacement,replacementTool:e=>e.stateReplacementTool,replacementPhotoLength:e=>e.stateReplacementPhotoLength,replacementPosition:e=>e.stateReplacementPosition},actions:{setImage(e){this.stateImage=e},setBlob(e){this.stateBlob=e},resetImage(){this.stateImage="s"},setIsCameraError(e){this.stateIsCameraError=e},setShowCloseButton(e){this.stateShowCloseButton=e},setCurrent(e){this.stateImageObjects.find(t=>t.Id===e)||this.stateImageObjects.push({Id:e,ImageInfos:[],ImageBlobs:[]}),this.stateCurrentObject=this.stateImageObjects.find(t=>t.Id===e)},setIsActionFromDelete(e){this.stateIsActionFromDelete=e},toggleIsVisible(e,a=null){a&&this.setCurrent(a),e&&(this.stateIsCameraError=!1),this.stateIsVisible=e},setUploadedFiles(e,a,t=null){t&&this.setCurrent(t),this.stateCurrentObject.ImageInfos=M(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageInfos=this.stateCurrentObject.ImageInfos.concat(e),this.stateCurrentObject.ImageBlobs=this.stateCurrentObject.ImageBlobs.concat(a)},setIsReplacementCamera(e){this.stateIsReplacement=e},setReplacementTool(e){this.stateReplacementTool=e},setReplacementPhotoLength(e){this.stateReplacementPhotoLength=e},setReplacementPosition(e){this.stateReplacementPosition=e},addPhoto(e,a){this.stateCurrentObject.ImageInfos=M(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageBlobs.push(e),this.stateCurrentObject.ImageInfos.push(a)},definePhoto(e,a){this.stateCurrentObject.ImageInfos=M(this.stateCurrentObject.ImageInfos),this.stateCurrentObject.ImageBlobs=[e],this.stateCurrentObject.ImageInfos=[a]},clearCurrent(){this.stateCurrentObject.ImageBlobs=[],this.stateCurrentObject.ImageInfos=[]},clearImageById(e){const a=this.stateImageObjects.find(t=>t.Id===e);a&&(a.ImageBlobs=[],a.ImageInfos=[])},reset(){this.stateIsVisible=!1,this.stateImageObjects=[],this.stateCurrentObject={},this.stateIsActionFromDelete=!1}}}),pe="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/upload",le="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url",be=ee({id:"globalConnection",state:()=>({stateIsConnectionError:!1,stateSubmitConnectionError:!1,stateConnectionStatus:!0}),getters:{isConnectionError:e=>e.stateIsConnectionError},actions:{setIsConnectionErrorState(e){this.stateIsConnectionError=e},checkIsErrorNoNetwork(e){let a=!1;try{a=e.message.includes("Network Error"),a=`${e}`.includes("Network Error")}catch(t){return console.log("catch on error checkIsErrorNoNetwork - useGlobalConnectionStore",t),a}return a},setSubmitConnectionError(e){this.stateSubmitConnectionError=e},setConnectionStatus(e){this.stateConnectionStatus=e}}}),at=ee({id:"Attachment",state:()=>({stateLoading:!1,stateCurrentKey:"",stateMode:""}),getters:{globalConnectionStore:()=>be(),currentKey:e=>e.stateCurrentKey,mode:e=>e.stateMode},actions:{async uploadAttachment(e,a,t=void 0){const d={ver:"v1",userAccount:a};let s="",p;try{const o=await Y.post(`${pe}?${new URLSearchParams(d).toString()}`,e);return s="Sync",o.data.result.content}catch(o){const g=this.globalConnectionStore.checkIsErrorNoNetwork(o);return this.globalConnectionStore.setSubmitConnectionError(g),J(o),console.log(o),s="Failed",p=typeof o=="object"?o.message:o,X("IRONS",o),!1}finally{t&&(t.errorMessage=p,t.syncStatus=s,t.syncDate=ce(),await ue(oe,"pendingTaskFile",t))}},async downloadAttachment(e){const a={ver:"v1",fileUrl:e};try{return(await Y.get(le,"",new URLSearchParams(a).toString())).data}catch(t){J(t),X("IRONS",t),console.log(t)}return""},async downloadAttachmentPDF(e){const a={ver:"v1",fileUrl:e};try{return(await Y.getBlob(le,"",new URLSearchParams(a).toString())).data}catch(t){J(t),X("IRONS",t),console.log(t)}return""},setCurrentKey(e){this.stateCurrentKey=e},setMode(e){this.stateMode=e}}}),ye=["innerHTML"],xe=["name","placeholder","disabled"],we={key:0,class:"mt-2"},Ce={class:"error-label"},st=H({__name:"Textarea",props:{labelClass:{type:String,default:"dma--textarea-label"},textClass:{type:String,default:"dma--textarea-input h-100px"},gridClass:{required:!1,type:String,default:""},max:{type:Number,default:524288},index:{type:Number},value:{required:!0,type:String},errorMessage:{required:!1,type:String,default:""},isValid:{required:!1,type:Boolean},name:{required:!0,type:String},label:{required:!1,type:String},placeholder:{required:!1,type:String,default:""},disabled:{default:!1},isLoading:{required:!1,type:Boolean,default:!1},disableFloating:{required:!1,type:Boolean,default:!1}},emits:["handleChange"],setup(e,{emit:a}){const t=a,d=e,s=P({get:()=>d.value,set:o=>{const g={};d.index!=null&&(g.index=d.index),g.value=o,t("handleChange",g)}}),p=P(()=>d.disableFloating?"dma--textarea-input-disable":"");return(o,g)=>(b(),O(z,null,[v("div",{class:Z(`dma--textarea-wrapper ${e.disabled&&"disabled"} form-control avoid prevent-split`)},[e.disableFloating?R("",!0):(b(),O("label",{key:0,class:Z(e.labelClass),innerHTML:e.label},null,10,ye)),de(v("textarea",{ref:"dmaTextarea",name:e.name,class:Z([e.textClass,p.value]),placeholder:e.placeholder,"onUpdate:modelValue":g[0]||(g[0]=N=>s.value=N),disabled:e.disabled},null,10,xe),[[me,s.value]])],2),!e.isValid&&!e.disabled?(b(),O("div",we,[v("label",Ce,D(e.errorMessage),1)])):R("",!0)],64))}}),Ie={class:"row fullscreen-dialog-image-preview"},ke=v("div",{class:"bg-secondary"},null,-1),Se=["src"],Be={class:"image-carousel-description"},Oe=v("div",{class:"description-title"},"Description",-1),Re={class:"description-text"},Le={style:{"font-family":"'Public sans', sans-serif !important","font-size":"12px","text-wrap":"unset"}},Ae=H({__name:"FullScreenDialog",props:{visibility:{type:Boolean,default:!1},image:{type:String,required:!0},images:{required:!0,type:Array},newVersion:{type:Boolean,default:!1}},emits:["handle-close"],setup(e,{emit:a}){const t=e,d=a,s=ge("(min-width: 1000px)"),p=h(),o=h(""),g=ne(t,"visibility"),N=h([]),n=h(),m=h(0),I=h(!1),f=h("0px"),B=h(0),S=h(0),r=h(0),c=h(0),F=h(0),K=async()=>{m.value=0,N.value=[],!(t.images.length<1)&&(I.value=!0,f.value="300px",window.setTimeout(()=>{F.value=0,o.value=decodeURI(t.images[0].description),n.value=document.getElementsByClassName("carousel-image")[0],r.value=n.value.height,c.value=n.value.width,B.value=600,S.value=600,c.value<500&&r.value<250?(n.value.style.width=c.value+"px",n.value.style.height=r.value+"px",f.value="300px"):c.value>600&&r.value<250?(n.value.style.width=c.value+"px",n.value.style.height="auto",f.value="300px"):(n.value.style.height=s.value?"600px":"450px",n.value.style.width="auto",f.value=s.value?"600px":"450px"),I.value=!1},500))},W=i=>{m.value=0,o.value=decodeURI(t.images[i].description),n.value=document.getElementsByClassName("carousel-image")[i],r.value=n.value.height,c.value=n.value.width,n.value.style.transform=`rotate(${m.value}deg)`,c.value<500&&r.value<250?(n.value.style.width=c.value+"px",n.value.style.height=r.value+"px",f.value="300px"):c.value>600&&r.value<250?(n.value.style.width=c.value+"px",n.value.style.height="auto",f.value="300px"):(n.value.style.height=s.value?"600px":"450px",n.value.style.width="auto",f.value=s.value?"600px":"450px")},G=()=>{N.value=[],d("handle-close")},Q=()=>{m.value==360&&(m.value=0),m.value=m.value+90;const i=n.value;m.value==90||m.value==270?q(i):c.value<500&&r.value<250?(i.style.width=c.value+"px",i.style.height=r.value+"px",f.value="300px"):c.value>600&&r.value<250?(i.style.width=c.value+"px",i.style.height="auto",f.value="300px"):(i.style.height=s.value?"600px":"450px",i.style.width="auto",f.value=s.value?"600px":"450px"),i.style.transform=`rotate(${m.value}deg)`},q=i=>{const $=S.value/c.value;i.style.width=`${S.value}px`,i.style.height=`${r.value*$+300}px`,f.value=`${c.value*$+50}px`};return ie(s,()=>{const i=document.getElementsByClassName("carousel-image")[F.value];if(m.value==90||m.value==270)q(i);else{if(!i)return;c.value<500&&r.value<250?(i.style.width=c.value+"px",i.style.height=r.value+"px",f.value="300px"):c.value>600&&r.value<250?(i.style.width=c.value+"px",i.style.height="auto",f.value="300px"):(i.style.height=s.value?"600px":"450px",i.style.width="auto",f.value=s.value?"600px":"450px")}}),(i,$)=>{const l=A("el-carousel-item"),u=A("el-carousel"),k=A("NwImg"),C=A("el-dialog");return b(),U(C,{modelValue:g.value,"onUpdate:modelValue":$[0]||($[0]=y=>g.value=y),title:"Detailed picture",width:"90%",onClosed:$[1]||($[1]=y=>G()),top:"2vh",onOpened:K,"destroy-on-close":""},{default:w(()=>[v("div",Ie,[ke,L(u,{ref_key:"carousel",ref:p,"indicator-position":"none",trigger:"click",height:f.value,interval:2147483647,arrow:"always",onChange:W,loop:"false"},{default:w(()=>[(b(!0),O(z,null,re(e.images,y=>(b(),U(l,{key:y.imgBlob},{default:w(()=>[v("img",{src:y.url,class:"carousel-image",alt:"photo"},null,8,Se)]),_:2},1024))),128))]),_:1},8,["height"]),v("div",{class:"rotate-button",onClick:Q},[L(k,{src:"/media/icons/bumaau/rotate.png",width:"60"})]),v("div",Be,[Oe,v("div",Re,[v("pre",Le,D(o.value),1)])])])]),_:1},8,["modelValue"])}}}),Ne=["innerHTML"],$e={key:0,class:"confirmation-text"},Ee={class:"dialog-footer",style:{display:"flex","justify-content":"space-between"}},je={style:{display:"flex",gap:"10px"}},De={class:"dialog-footer",style:{display:"block","text-align":"right"}},Fe={class:"dialog-footer",style:{display:"flex","justify-content":"space-around"}},Pe=H({__name:"Confirmation",props:{visibility:{required:!0,type:Boolean},caption:{required:!0,type:String},showClose:{default:!1},yesLabel:{default:"Yes"},noLabel:{default:"No"},hideNo:{default:!1},hideYes:{default:!1},disableYes:{default:!1},disableNo:{default:!1},yesButtonBackroundColor:{default:"#18AF4A"},widthDialog:{default:0},footerTemplate:{default:"default"},addPartLabel:{default:"Add part"},disableAddPart:{default:!1},addPartButtonBackroundColor:{default:"#18AF4A"},partsExist:{required:!1,type:Boolean,default:!1}},emits:["onNoConfirm","onYesConfirm","onClose","onAddPart"],setup(e,{emit:a}){const t=e,d=a,s=P(()=>t.visibility),p=()=>{d("onNoConfirm")},o=()=>{d("onYesConfirm")},g=()=>{d("onClose")},N=()=>{d("onAddPart")},n=P(()=>{const B={background:"white",color:"#18AF4A",border:"2px solid #18AF4A",boxShadow:""},S={background:t.yesButtonBackroundColor,color:"white",border:"",boxShadow:"0px 8px 16px rgba(0, 171, 85, 0.24)"};return t.partsExist?S:B}),m=P(()=>({background:"white",color:"black",boxShadow:"0px 24px 48px rgba(145, 158, 171, 0.2)"})),I=P(()=>{const B={width:"25%",background:t.addPartButtonBackroundColor,color:"white",boxShadow:"0px 8px 16px rgba(0, 171, 85, 0.24)",border:""},S={width:"35%",background:"white",color:"#18AF4A",boxShadow:"",border:"2px solid #18AF4A"};return t.partsExist?S:B}),f=P(()=>t.partsExist?"Add more part":t.addPartLabel);return(B,S)=>{const r=A("el-button"),c=A("el-dialog");return b(),U(c,{modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=F=>s.value=F),center:"",top:"30vh","close-on-click-modal":!1,"show-close":e.showClose,width:e.widthDialog?`${e.widthDialog}% !important`:"","custom-class":"Confirmation","append-to-body":"",onClosed:g,"close-on-press-escape":!1},fe({default:w(()=>[v("span",{class:"caption",innerHTML:e.caption},null,8,Ne),e.footerTemplate==="defect"||e.footerTemplate==="crack"?(b(),O("p",$e," Please confirm this "+D(e.footerTemplate)+" information is correct. ",1)):R("",!0)]),_:2},[e.footerTemplate==="defect"||e.footerTemplate==="crack"?{name:"footer",fn:w(()=>[v("span",Ee,[L(r,{disabled:e.disableAddPart,onClick:N,style:_(I.value)},{default:w(()=>[V(D(f.value),1)]),_:1},8,["disabled","style"]),v("div",je,[L(r,{disabled:e.disableNo,onClick:p,style:_(m.value)},{default:w(()=>[V("Cancel")]),_:1},8,["disabled","style"]),L(r,{disabled:e.disableYes,onClick:o,style:_(n.value)},{default:w(()=>[V(D(e.yesLabel),1)]),_:1},8,["disabled","style"])])])]),key:"0"}:e.footerTemplate==="default"?{name:"footer",fn:w(()=>[v("span",De,[e.hideNo?R("",!0):(b(),U(r,{key:0,disabled:e.disableNo,onClick:p,style:{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"}},{default:w(()=>[V(D(e.noLabel),1)]),_:1},8,["disabled"])),e.hideYes?R("",!0):(b(),U(r,{key:1,disabled:e.disableYes,class:"button-OK-confirmation",type:"success",onClick:se(o,["prevent"]),style:_(`background:${e.yesButtonBackroundColor}; box-shadow: 0px 8px 16px rgba(0, 171, 85, 0.24); color: white`)},{default:w(()=>[V(D(e.yesLabel),1)]),_:1},8,["disabled","style"]))])]),key:"1"}:e.footerTemplate==="50-50"?{name:"footer",fn:w(()=>[v("span",Fe,[e.hideNo?R("",!0):(b(),U(r,{key:0,disabled:e.disableNo,onClick:p,style:{width:"50%","box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"}},{default:w(()=>[V(D(e.noLabel),1)]),_:1},8,["disabled"])),e.hideYes?R("",!0):(b(),U(r,{key:1,disabled:e.disableYes,class:"button-OK-confirmation",type:"success",onClick:se(o,["prevent"]),style:_(`background:${e.yesButtonBackroundColor}; box-shadow: 0px 8px 16px rgba(0, 171, 85, 0.24); color: white; width: 50%;`)},{default:w(()=>[V(D(e.yesLabel),1)]),_:1},8,["disabled","style"]))])]),key:"2"}:void 0]),1032,["modelValue","show-close","width"])}}}),Ue={class:"row my-4"},Ve={class:"bg-secondary"},Te=["src","onClick"],_e={key:0,class:"row mt-7 mb-0"},Me=v("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),qe=[Me],lt=H({__name:"ImagePreview",props:{visibility:{type:Boolean,required:!1},index:{required:!1,type:Number,default:-1},images:{type:Array,required:!0},showDeleteButton:{type:Boolean,required:!0,default:!0},type:{type:String,required:!0},reRender:{type:Boolean,default:!1},showMandatoryCaption:{type:Boolean,default:!1},isMonitoring:{type:Boolean,default:!1},isMandatory:{required:!1,type:Boolean,default:!0},oldVersion:{required:!1,type:Boolean,default:!0}},emits:["onClose","onDelete","onDownloaded"],setup(e,{emit:a}){const t=e,d=a,s=h([]),p=ne(t,"visibility"),o=h(!1),g=h(""),N=h(0),n=h([]),m=h([]),I=h([]),f=h(""),B=h(!1),S=P(()=>{let l=!1;return t.showDeleteButton&&(l=!0),t.isMonitoring&&(l=!1),l}),r=l=>{var k;if(s.value.length<1)return;let u;do u=(k=s.value.find(C=>C.key==l))==null?void 0:k.value;while(!u);return u},c=()=>{p.value=!1,d("onClose",null)};ie(()=>t.reRender,async()=>{await F()});const F=async()=>{if(K(),N.value=0,s.value=[],!t.images)return;m.value=M(t.images),n.value=Array.apply(null,Array(t.images.length)).map(function(){return!0});const l=m.value.length;for(let u=N.value;u<l;u++){const k=m.value[u].filename,C=await oe.pendingTaskFile.where({filename:k}).first();try{if(!C)await W(k,u);else{const y=he.cloneDeep(C);let E=window.URL||window.webkitURL;s.value.push({key:k,value:E.createObjectURL(y.blob)}),n.value[u]=!1,I.value.forEach(x=>{x.imgBlob==k&&(x.url=E.createObjectURL(y.blob))})}}catch(y){console.log(y)}}},K=()=>{const l=M(t.images);I.value=l==null?void 0:l.map(u=>({imgBlob:u.filename,url:"",description:u.description}))},W=async(l,u)=>{const k={fileUrl:l,ver:"v1"};try{const C=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(k).toString()}`,y=await Y.getBlob(C);if(t.isMonitoring){const E=new Blob([y.data]);let x=window.URL||window.webkitURL;s.value.push({key:l,value:x.createObjectURL(E)}),I.value.forEach(j=>{j.imgBlob==l&&(j.url=x.createObjectURL(E))}),n.value[u]=!1}else{const E=y.data,x=new Blob([E]),j={};j.filename=l,j.blob=x,j.type=t.type;const T={};T.image=j,T.index=u,T.length=t.images.length,d("onDownloaded",T),window.setTimeout(async()=>{let te=window.URL||window.webkitURL;s.value.push({key:l,value:te.createObjectURL(x)}),I.value.forEach(ae=>{ae.imgBlob==l&&(ae.url=te.createObjectURL(x))}),n.value[u]=!1},1e3)}}catch(C){console.log("image",C)}},G=l=>{const u=I.value.findIndex(C=>C.imgBlob==l),k=I.value[u];if(u>0){const C=I.value.slice(u),y=I.value.slice(0,u);I.value=[...C,...y]}f.value=k.url,B.value=!0},Q=()=>{f.value="",B.value=!1},q=l=>{o.value=!0,g.value=l},i=()=>{o.value=!1},$=()=>{o.value=!1,s.value=s.value.filter(l=>l.key!=g.value),m.value=m.value.filter(l=>l.filename!=g.value),t.index>=0?d("onDelete",{index:t.index,filename:g.value}):d("onDelete",g.value),g.value=""};return(l,u)=>{const k=A("el-skeleton-item"),C=A("NwImg"),y=A("el-skeleton"),E=A("el-dialog");return b(),O(z,null,[L(E,{modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=x=>p.value=x),title:"Detailed picture",width:"80%",onOpened:F,onOpen:F,onClose:c},{default:w(()=>[v("div",Ue,[(b(!0),O(z,null,re(m.value,(x,j)=>(b(),O("div",{key:x.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[L(y,{loading:n.value[j],animated:""},{template:w(()=>[L(k,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:w(()=>[v("div",Ve,[r(x.filename)!=null?(b(),O("img",{key:0,src:r(x.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:T=>G(x.filename)},null,8,Te)):R("",!0),S.value?(b(),U(C,{key:1,onClick:T=>q(x.filename),class:"delete-image-button",src:"/media/svg/dma/image-close-button-red.png"},null,8,["onClick"])):R("",!0)])]),_:2},1032,["loading"])]))),128))]),e.showMandatoryCaption?(b(),O("div",_e,qe)):R("",!0)]),_:1},8,["modelValue"]),L(Pe,{visibility:o.value,caption:"Are you sure want to delete this image?",onOnNoConfirm:i,onOnYesConfirm:$},null,8,["visibility"]),L(Ae,{images:I.value,visibility:B.value,image:f.value,onHandleClose:Q},null,8,["images","visibility","image"])],64)}}});export{st as _,at as a,be as b,Pe as c,Ae as d,lt as e,Xe as f,et as g,Ze as i,Je as m,M as s,tt as u};
