import{u as ht}from"./vuex-BbOKrtVp.js";import{a as gt}from"./breadcrumb-D-Q4Tk9w.js";import{b as O,u as Z,i as W,h as tt,j as T,A as Pt}from"./index-BCnwA6yE.js";import{P as it}from"./Pagination-CVDIvnOM.js";import{F as Dt}from"./FilterIconButton-Bj0WTbms.js";import{h as ft,A as vt,U as _t}from"./excel-generator-CRLIz6fw.js";import{D as yt}from"./DownloadIconButton-CIQp-YG7.js";import{_ as k,b as rt}from"./element-plus-C5R56mia.js";import{b as bt}from"./date-format-BASVuupi.js";import{P as q,d as Ct,a as St}from"./table-sort-VnBD5Hfa.js";import{d as et}from"./pinia-BjOS2_Ao.js";import{a as Y}from"./mapOption-sP4IrA4W.js";import{e as lt}from"./lodash-Cr9vlq0V.js";import{k as V,bL as wt,r as N,u as o,y as R,p as M,aa as H,q as I,x as d,Y as j,R as F,s,aB as u,C as Q,a0 as K,c as A,o as ct,B as L,A as G,T as dt,bd as Et,bb as Mt,a7 as kt,L as At,F as It}from"./@vue-BypzYtbH.js";import{a as ut}from"./vee-validate-C_msoaAA.js";import{c as mt,a as z}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as pt}from"./ErrorAlert-CMKGfwAi.js";import{_ as B}from"./AutoComplete.vue_vue_type_script_setup_true_lang-D4CTLiQF.js";import{_ as Lt}from"./SwitchInput.vue_vue_type_script_setup_true_lang-BosisL7w.js";import{_ as Ft}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as Ot}from"./map-anything-abi6NY2Z.js";import{_ as Ut}from"./nw-img-vue-CR837WER.js";import{F as $t}from"./file-saver-DhbZvGod.js";import"./vue-router-iNp9kJ0K.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const U="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/customer_assignment",xt=`${U}/bulk`,Bt=`${U}/validate_upload`,Rt=`${U}/export`,Vt=`${U}/lookup`,Nt=`${U}/lookup_maintenance_plant`,Tt=`${U}/lookup_customer`,Ht=`${U}/update`,J={MaintenancePlant:"",MaintenancePlantDescription:"",Customer:"",ver:"v1",Page:1,PageSize:10,Order:""},at=et({id:"customerAssignmentList",state:()=>({stateFilterData:{...J},stateLastUsedFilterData:{...J},statePageName:"customerAssignment",stateDisplayData:[],statePagination:new q,stateLoading:!1,statePaginationLoading:!1,stateMaintenancePlantOption:[],stateMaintenancePlantDescOption:[],stateCustomerOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,maintenancePlantOption:t=>t.stateMaintenancePlantOption,maintenancePlantDescOption:t=>t.stateMaintenancePlantDescOption,customerOption:t=>t.stateCustomerOption},actions:{async getData(t=!0){const a={MaintenancePlant:this.stateFilterData.MaintenancePlant,MaintenancePlantDescription:this.stateFilterData.MaintenancePlantDescription,Customer:this.stateFilterData.Customer,Page:this.stateFilterData.Page.toString(),PageSize:this.stateFilterData.PageSize.toString(),Order:this.stateFilterData.Order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await O.get(U,"",new URLSearchParams(a).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const a=await O.get(Vt,"",new URLSearchParams(t).toString());this.stateMaintenancePlantOption=Y(a.data.result.content.maintenancePlant),this.stateMaintenancePlantDescOption=Y(a.data.result.content.maintenancePlantDescription),this.stateCustomerOption=Y(a.data.result.content.customer)}catch(a){console.log(a)}},async export(){const t={ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await O.getBlob(Rt,"",new URLSearchParams(t).toString())).data}catch(a){console.log(a)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:a}){if(!t&&!a)this.stateFilterData.Order="";else{const e=a=="ascending"?"asc":"desc";this.stateFilterData.Order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1)},setMaintenancePlant(t){this.stateFilterData.MaintenancePlant=t},setMaintenancePlantDescription(t){this.stateFilterData.MaintenancePlantDescription=t},setCustomer(t){this.stateFilterData.Customer=t},async resetFilter(){this.stateFilterData.MaintenancePlant="",this.stateFilterData.MaintenancePlantDescription="",this.stateFilterData.Customer="";const t=this.stateLastUsedFilterData.MaintenancePlant!=="",a=this.stateLastUsedFilterData.MaintenancePlantDescription!=="",e=this.stateLastUsedFilterData.Customer!=="";(t||a||e)&&await this.getData()},resetState(){this.stateFilterData={...J},this.stateDisplayData=[],this.statePagination=new q,this.stateLoading=!1,this.statePaginationLoading=!1}}}),X=et({id:"customerAssignmentForm",state:()=>({stateFormData:{CustomerAssignmentId:0,IsActive:!0},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateMaintenancePlantOption:[],stateMaintenancePlantDescOption:[],stateCustomerOption:[],stateCustomerWithDescOption:[],stateMaintenancePlantWithDescOption:[],maintenancePlantLookupArr:[],customerLookupArr:[]}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading,maintenancePlantOption:t=>t.stateMaintenancePlantOption,maintenancePlantDescOption:t=>t.stateMaintenancePlantDescOption,customerOption:t=>t.stateCustomerOption,customerWithDescOption:t=>t.stateCustomerWithDescOption,maintenancePlantWithDescOption:t=>t.stateMaintenancePlantWithDescOption},actions:{async insertData(t){try{this.stateLoading=!0;const a={userAccount:t,ver:"v1"},e=await O.post(`${U}?${new URLSearchParams(a).toString()}`,this.stateFormData);e.data.title==="Error"?(this.stateErrors.push(e.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(a){this.stateError=a,this.stateErrors.push(a.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},async updateData(t){try{this.stateLoading=!0;const a={userAccount:t,ver:"v1"},e=await O.post(`${Ht}?${new URLSearchParams(a).toString()}`,this.stateFormData);e.data.title==="Error"?(this.stateErrors.push(e.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(a){this.stateError=a,this.stateErrors.push(a.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.CustomerAssignmentId=t.customerAssignmentId||0,this.stateFormData.MaintenancePlant=t.maintenancePlant||"",this.stateFormData.MaintenancePlantDescription=t.maintenancePlantDescription||"",this.stateFormData.Customer=t.customer||"",this.stateFormData.IsActive=t.isActive||!1},resetState(){this.stateFormData={CustomerAssignmentId:0,IsActive:!0},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1},async getMaintenancePlantLookup(){const t={ver:"v1"};try{const a=await O.get(Nt,"",new URLSearchParams(t).toString());this.maintenancePlantLookupArr=a.data.result.content,this.stateMaintenancePlantOption=a.data.result.content.map(e=>({label:e.maintenancePlant,value:e.maintenancePlant})),this.stateMaintenancePlantDescOption=a.data.result.content.map(e=>({label:e.maintenancePlantDescription,value:e.maintenancePlantDescription})),this.stateMaintenancePlantWithDescOption=a.data.result.content.map(e=>({label:`${e.maintenancePlant} | ${e.maintenancePlantDescription}`,value:`${e.maintenancePlant}`}))}catch(a){console.log(a)}},async getCustomerLookup(){const t={ver:"v1"};try{const a=await O.get(Tt,"",new URLSearchParams(t).toString());this.customerLookupArr=a.data.result.content,this.stateCustomerOption=a.data.result.content.map(e=>({label:e.customer,value:e.customer})),this.stateCustomerWithDescOption=a.data.result.content.map(e=>({value:`${e.customer}`,label:`${e.customer} | ${e.customerDescription}`}))}catch(a){console.log(a)}},syncMaintenancePlantAndDescriptionAnswer(t){const a=this.stateFormData[t],e=this.maintenancePlantLookupArr.find(P=>P[lt.camelCase(t)]==a);this.stateFormData.MaintenancePlant=e.maintenancePlant,this.stateFormData.MaintenancePlantDescription=e.maintenancePlantDescription}}}),Wt={key:0,style:{height:"100px"}},qt={key:0,class:"row justify-content-center"},zt={key:1,class:"row justify-content-center"},jt={class:"row justify-content-center"},Kt=["onClick"],Gt=V({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog"],setup(t,{emit:a}){const e=t,P=at(),n=X(),r=a,h=wt(()=>(e.page-1)*10+1),l=N(""),y=D=>{l.value=D.order;const C={prop:D.prop,order:D.order};P.setSort(C)},b=(D,C,p)=>Ct(D[p],C[p],l.value),E=D=>{n.setFormData(D),r("show-dialog",null)};return(D,C)=>{const p=F("inline-svg"),f=F("el-tooltip"),S=j("loading");return o(P).loading?R((M(),H("div",Wt,null,512)),[[S,o(P).loading]]):R((M(),I(o(rt),{key:1,data:e.listData,style:{width:"100%"},onSortChange:y,"empty-text":"No Data"},{default:d(()=>[s(o(k),{label:"No",width:"90",align:"center"},{default:d(i=>[u("span",null,Q(o(h)+i.$index),1)]),_:1}),s(o(k),{prop:"maintenancePlant",label:"Maintenance Plant",width:"170",sortable:"","sort-method":(i,c)=>b(i,c,"maintenancePlant")},null,8,["sort-method"]),s(o(k),{prop:"maintenancePlantDescription",label:"Maintenance Plant Desc.","min-width":"220",sortable:"","sort-method":(i,c)=>b(i,c,"maintenancePlantDescription")},null,8,["sort-method"]),s(o(k),{prop:"customer",label:"Customer",width:"170",sortable:"","sort-method":(i,c)=>b(i,c,"customer")},null,8,["sort-method"]),s(o(k),{prop:"isActive",label:"Is Active",width:"100",sortable:""},{default:d(i=>[i.row.isActive?(M(),H("div",qt,[s(p,{src:"/media/svg/tables/rows/check.svg"})])):(M(),H("div",zt,[s(p,{src:"/media/svg/tables/rows/minus.svg"})]))]),_:1}),s(o(k),{prop:"changedOn",label:"Changed on",align:"center",width:"170",sortable:""},{default:d(i=>[u("span",null,Q(o(bt)(i.row.changedOn)),1)]),_:1}),s(o(k),{prop:"changedBy",label:"Changed by",sortable:"",width:"300","sort-method":(i,c)=>b(i,c,"changedBy")},null,8,["sort-method"]),s(o(k),{label:"",width:"80"},{default:d(i=>[u("div",jt,[s(f,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:d(()=>[u("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:c=>E(i.row)},[s(p,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Kt)]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[S,o(P).loading]])}}}),Xt={class:"dialog-footer"},Yt=V({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:a}){const e=t,P=a,n=X(),r=Z(),h=K(e,"visibility"),l=A(()=>n.formData),y=A(()=>n.errors),b=A(()=>n.isError),E=A(()=>n.maintenancePlantWithDescOption),D=A(()=>n.customerWithDescOption),C=mt().shape({MaintenancePlant:z().required("Maintenance Plant is mandatory"),Customer:z().required("Customer is mandatory")}),p=()=>{S(""),i("")},f=(v=!1)=>{g(),p(),P("handle-close",v)},S=v=>{if(l.value.MaintenancePlant=v,v){const m=n.maintenancePlantLookupArr.find(w=>w.maintenancePlant===v);l.value.MaintenancePlantDescription=m.maintenancePlantDescription}else l.value.MaintenancePlant="",l.value.MaintenancePlantDescription=""},i=v=>{l.value.Customer=v},c=async()=>{g(),await C.validate(l.value,{abortEarly:!1}).catch(v=>{n.setErrors(v.errors)}),!b.value&&W("Are you sure you want to submit ?").then(async v=>{v.isConfirmed&&n.insertData(r.user.Name).then(()=>{n.isError||tt("Form has been successfully submitted!","Ok").then(()=>{f(!0)})})})},g=()=>{n.setErrors([])};return ct(()=>{n.getMaintenancePlantLookup(),n.getCustomerLookup()}),(v,m)=>{const w=F("el-button"),_=F("el-dialog"),$=j("loading");return R((M(),I(_,{modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=x=>h.value=x),title:"New Data",width:"40%",onClose:m[1]||(m[1]=x=>f())},{footer:d(()=>[u("span",Xt,[s(w,{type:"primary",onClick:c,disabled:o(n).loading},{default:d(()=>[L("Submit")]),_:1},8,["disabled"]),s(w,{type:"secondary",onClick:f,disabled:o(n).loading},{default:d(()=>[L("Close")]),_:1},8,["disabled"])])]),default:d(()=>[s(dt,{name:"fade"},{default:d(()=>[b.value?(M(),I(pt,{key:0,errorMessages:y.value,onResetForm:g},null,8,["errorMessages"])):G("",!0)]),_:1}),R((M(),I(o(ut),{id:"kt_filter_form",class:"row g-9 my-4"},{default:d(()=>[s(B,{value:l.value.MaintenancePlant,label:"Maintenance Plant",name:"MaintenancePlant",options:E.value,placeholder:"Add Maintenance Plant",onHandleChange:S},null,8,["value","options"]),s(B,{value:l.value.Customer,label:"Customer",name:"Customer",placeholder:"Add Customer",options:D.value,onHandleChange:i},null,8,["value","options"])]),_:1})),[[$,o(n).loading]])]),_:1},8,["modelValue"])),[[$,o(n).loading]])}}}),Jt={class:"dialog-footer"},Qt=V({__name:"FormEditDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:a}){const e=t,P=a,n=X(),r=Z(),h=K(e,"visibility"),l=A(()=>n.formData),y=A(()=>n.errors),b=A(()=>n.isError),E=A(()=>n.maintenancePlantWithDescOption),D=A(()=>n.customerWithDescOption),C=mt().shape({MaintenancePlant:z().required("Maintenance Plant is mandatory"),Customer:z().required("Customer is mandatory")}),p=()=>{l.value.CustomerAssignmentId=0,S(""),i(""),l.value.IsActive=!0},f=(m=!1)=>{v(),p(),P("handle-close",m)},S=m=>{if(l.value.MaintenancePlant=m,m){const w=n.maintenancePlantLookupArr.find(_=>_.maintenancePlant===m);l.value.MaintenancePlantDescription=w.maintenancePlantDescription}else l.value.MaintenancePlant="",l.value.MaintenancePlantDescription=""},i=m=>{l.value.Customer=m},c=m=>{l.value.IsActive=m},g=async()=>{v(),await C.validate(l.value,{abortEarly:!1}).catch(m=>{n.setErrors(m.errors)}),!b.value&&W("Are you sure you want to submit ?").then(async m=>{m.isConfirmed&&n.updateData(r.user.Name).then(()=>{n.isError||tt("Form has been successfully submitted!","Ok").then(()=>{f(!0)})})})},v=()=>{n.setErrors([])};return ct(()=>{n.getMaintenancePlantLookup(),n.getCustomerLookup()}),(m,w)=>{const _=F("el-button"),$=F("el-dialog"),x=j("loading");return R((M(),I($,{modelValue:h.value,"onUpdate:modelValue":w[0]||(w[0]=ot=>h.value=ot),title:"Update Data",width:"40%",onClose:w[1]||(w[1]=ot=>f())},{footer:d(()=>[u("span",Jt,[s(_,{type:"primary",onClick:g,disabled:o(n).loading},{default:d(()=>[L("Submit")]),_:1},8,["disabled"]),s(_,{type:"secondary",onClick:f,disabled:o(n).loading},{default:d(()=>[L("Close")]),_:1},8,["disabled"])])]),default:d(()=>[s(dt,{name:"fade"},{default:d(()=>[b.value?(M(),I(pt,{key:0,errorMessages:y.value,onResetForm:v},null,8,["errorMessages"])):G("",!0)]),_:1}),R((M(),I(o(ut),{id:"kt_filter_form",class:"row g-9 my-4"},{default:d(()=>[s(B,{value:l.value.MaintenancePlant,label:"Maintenance Plant",name:"MaintenancePlant",options:E.value,placeholder:"Add Maintenance Plant",onHandleChange:S},null,8,["value","options"]),s(B,{value:l.value.Customer,label:"Customer",name:"Customer",placeholder:"Add Customer",options:D.value,onHandleChange:i},null,8,["value","options"]),s(Lt,{value:l.value.IsActive,label:"Is Active",name:"IsActive",onHandleChange:c},null,8,["value"])]),_:1})),[[x,o(n).loading]])]),_:1},8,["modelValue"])),[[x,o(n).loading]])}}}),nt=et({id:"customerAssignmentBulk",state:()=>({statePagination:new q,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const a={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await O.post(`${xt}?${new URLSearchParams(a).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:a}){const e={userAccount:t,ver:"v1"},P=`${Bt}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const n=await O.postImages(P,a);n.data.statusCode==200?n.data.result.isError?(this.stateIsError=!0,this.stateError=n.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=n.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=lt.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=n.data.result.isError,this.stateError=n.data.result.message)}catch(n){console.log(n),this.stateIsError=!0,this.stateError=n.response.data.result.message}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(St(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new q,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),Zt={class:"icon"},te=V({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const a=t,e=nt(),P=A(()=>(a.page-1)*10+1),n=r=>{const h={prop:r.prop,order:r.order};e.setSort(h)};return(r,h)=>{const l=F("inline-svg");return M(),I(o(rt),{data:a.listData,style:{width:"100%"},onSortChange:n,"empty-text":"No Data"},{default:d(()=>[s(o(k),{label:"No",width:"60",align:"center"},{default:d(y=>[u("span",null,Q(P.value+y.$index),1)]),_:1}),s(o(k),{prop:"maintenancePlant",label:"Maintenance Plant",width:"170",sortable:""}),s(o(k),{prop:"maintenancePlantDescription",label:"Maintenance Plant Desc.","min-width":"170",sortable:""}),s(o(k),{prop:"customer",label:"Customer",width:"150",sortable:""}),s(o(k),{prop:"customerDescription",label:"Customer Desc.","min-width":"170",sortable:""}),s(o(k),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),s(o(k),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:d(y=>[u("div",Zt,[s(l,{src:y.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),st=t=>(Et("data-v-26e64af7"),t=t(),Mt(),t),ee=st(()=>u("div",{class:"text-center"},null,-1)),ae=st(()=>u("div",{class:"mb-3"},[u("span",null,[L(" Download template "),u("a",{href:"documents/MasterDataCustomerAssignment.xlsx",target:"_blank",id:"link-download"},"here"),L(" before uploading file ")])],-1)),ne=st(()=>u("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[u("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),se={class:"card"},oe={class:"card-body grid-padding"},ie={class:"dialog-footer"},re=V({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:a}){const e=t,P=a,n=Z(),r=nt(),h=K(e,"visibility"),l=()=>{const i=Ot(r.validatedData,c=>{const g=c;return{customerAssignmentId:0,maintenancePlant:g.maintenancePlant,maintenancePlantDescription:g.maintenancePlantDescription,customer:g.customer,customerDescription:g.customerDescription,isActive:!0}});return Object.values(i)},y=()=>{const i=document.getElementById("link-download");i&&i.click()},b=()=>{r.validatedData.length>0?W("Cancel Upload Data?","Confirm").then(c=>{c.isConfirmed&&D()}):D()},E=async i=>{await r.upload({userAccount:n.user.Name,excelFile:i}),r.stateError&&T(r.error)},D=(i=!1)=>{r.resetState(),P("handle-close",i)},C=i=>{r.setIsUploadedState(i)},p=i=>{r.setPage(i)},f=()=>{if(r.validatedData.length<1){y();return}const i=["MAINTENANCE PLANT","CUSTOMER","REMARK","STATUS"],c=r.validatedData.map(g=>({maintenancePlant:g.maintenancePlant,customer:g.customer,remark:g.validationReason,status:g.isValid?"OK":"Error"}));ft("Customer Assignment",i,c)},S=async()=>{if(r.displayData.length<1){T("There is no data to submit");return}if(r.isError){T("There is still invalid row(s)");return}W("Are you sure you want to submit ?").then(async i=>{if(i.isConfirmed){const c=l();if(r.setBulkData(c),await r.bulkInsert(n.user.Name),r.isError){T(r.stateError);return}tt("Form has been successfully submitted!","Ok").then(()=>{D(!0)})}})};return(i,c)=>{const g=F("el-button"),v=F("el-dialog"),m=j("loading");return M(),I(v,{title:"Upload Bulk Data",modelValue:h.value,"onUpdate:modelValue":c[1]||(c[1]=w=>h.value=w),"before-close":b,width:"70%","custom-class":"upload-modal"},{footer:d(()=>[u("div",null,[u("span",ie,[s(g,{type:"success",onClick:f},{default:d(()=>[L("Download")]),_:1}),s(g,{type:"primary",onClick:S},{default:d(()=>[L("Upload")]),_:1}),s(g,{type:"success",onClick:b},{default:d(()=>[L("Cancel")]),_:1})])])]),default:d(()=>[ee,ae,R(s(Ft,{isSubmissionUploadSuccess:o(r).isUploaded,onHandleCloseUploadedFile:b,onHandleUpload:E,onHandleSetIsExcelFileUploaded:C},null,8,["isSubmissionUploadSuccess"]),[[m,o(r).uploadLoading]]),ne,u("div",se,[u("div",oe,[s(te,{"list-data":o(r).displayData,page:o(r).pagination.currentPage},null,8,["list-data","page"])])]),o(r).displayData.length>0?(M(),I(it,{key:0,onRaisePageChange:c[0]||(c[0]=w=>p(w)),currentPage:o(r).pagination.currentPage,totalPage:o(r).pagination.totalPage,totalPageSize:o(r).pagination.totalPageSize,startPaginationIndex:o(r).pagination.startPaginationIndex,endPaginationIndex:o(r).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):G("",!0)]),_:1},8,["modelValue"])}}}),le=Ut(re,[["__scopeId","data-v-26e64af7"]]),ce={class:"row g-9 my-4"},de={class:"col-md-6 fv-row fv-plugins-icon-container"},ue={class:"col-md-6 fv-row fv-plugins-icon-container"},me={class:"col-md-6 fv-row fv-plugins-icon-container"},pe={class:"dialog-footer"},he=V({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:a}){const e=at(),P=t,n=a,r=K(P,"visibility"),h=A(()=>e.filterData),l=()=>{y(),e.resetFilter()},y=()=>{n("handle-close",!1)},b=p=>{e.setMaintenancePlant(p)},E=p=>{e.setMaintenancePlantDescription(p)},D=p=>{e.setCustomer(p)},C=()=>{const p=e.lastUsedFilterData.MaintenancePlant!==e.filterData.MaintenancePlant,f=e.lastUsedFilterData.MaintenancePlantDescription!==e.filterData.MaintenancePlantDescription,S=e.lastUsedFilterData.Customer!==e.filterData.Customer;n("handle-close",p||f||S)};return(p,f)=>{const S=F("el-button"),i=F("el-dialog");return M(),I(i,{modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=c=>r.value=c),title:"Filter",width:"60%",onClose:f[1]||(f[1]=c=>y())},{footer:d(()=>[u("span",pe,[s(S,{type:"secondary",onClick:l},{default:d(()=>[L("Reset")]),_:1}),s(S,{type:"primary",onClick:C},{default:d(()=>[L("Filter")]),_:1})])]),default:d(()=>[u("div",ce,[u("div",de,[s(B,{value:h.value.MaintenancePlant,label:"Maintenance Plant",name:"MaintenancePlant",options:o(e).maintenancePlantOption,onHandleChange:b},null,8,["value","options"])]),u("div",ue,[s(B,{value:h.value.MaintenancePlantDescription,label:"Maintenance Plant Description",name:"MaintenancePlantDescription",options:o(e).maintenancePlantDescOption,onHandleChange:E},null,8,["value","options"])]),u("div",me,[s(B,{value:h.value.Customer,label:"Customer",name:"Customer",options:o(e).customerOption,onHandleChange:D},null,8,["value","options"])])])]),_:1},8,["modelValue"])}}}),ge={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},Pe=u("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),De={class:"d-flex justify-content-between align-items-center"},fe={class:"card"},ve={class:"card-body grid-padding"},_e={class:"my-5"},Ca=V({__name:"Index",setup(t){const a=ht(),e=at(),P=X(),n=nt(),r=N(!1),h=N(!1),l=N(!1),y=N(!1),b=A(()=>e.displayData),E=A(()=>e.pagination),D=_=>{e.setPage(_)};kt(async()=>{a.dispatch(Pt.ACTIVE_PAGE,"IronLake"),gt("Customer Assignment",[{pageName:"Iron Lake",pageRoute:"ironlake"},{pageName:"Business Partner",pageRoute:"customerassignment"},{pageName:"Customer Assignment",pageRoute:"customerassignment"}]),e.setPage(1),await e.getLookup()}),At(()=>{e.resetState(),P.resetState(),n.resetState()});const C=async()=>{await e.setPage(1),await e.getLookup()},p=()=>{r.value=!0},f=async _=>{r.value=!1,_&&await C()},S=()=>{h.value=!0},i=async _=>{h.value=!1,_&&await C()},c=()=>{l.value=!0},g=async _=>{l.value=!1,_&&await C()},v=async()=>{const _=await e.export();$t.saveAs(new Blob([_],{type:"application/octet-stream"}),"Customer Assignment.xlsx")},m=()=>{y.value=!0},w=async _=>{y.value=!1,_&&await C()};return(_,$)=>(M(),H(It,null,[u("div",ge,[Pe,u("div",De,[s(vt,{onShowDialog:p}),s(Dt,{onShowDialog:c}),s(yt,{onHandleDownload:v}),s(_t,{onShowDialog:m})])]),u("div",fe,[u("div",ve,[s(Gt,{"list-data":b.value,page:E.value.currentPage,onShowDialog:S},null,8,["list-data","page"])])]),u("div",_e,[o(e).paginationLoading?G("",!0):(M(),I(it,{key:0,onRaisePageChange:$[0]||($[0]=x=>D(x)),currentPage:E.value.currentPage,totalPage:E.value.totalPage,totalPageSize:E.value.totalPageSize,startPaginationIndex:E.value.startPaginationIndex,endPaginationIndex:E.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),s(Yt,{visibility:r.value,onHandleClose:f},null,8,["visibility"]),s(Qt,{visibility:h.value,onHandleClose:i},null,8,["visibility"]),s(he,{visibility:l.value,onHandleClose:g},null,8,["visibility"]),s(le,{visibility:y.value,onHandleClose:w},null,8,["visibility"])],64))}});export{Ca as default};
