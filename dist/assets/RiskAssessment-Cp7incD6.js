import{c as H}from"./index-BuVmIl8K.js";import{_ as M}from"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import{s as L,a as G}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{k as D,r as i,a0 as q,p as _,aa as y,s as b,x as $,F as S,R as C,aB as c,$ as O,A as E,o as W,b4 as J,B as N,C as V,c as K,bd as Q,bb as X}from"./@vue-BypzYtbH.js";import{_ as Y}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{a as Z}from"./manipulate-html-string-DqTEGh-F.js";import{e as z}from"./lodash-DrHMlsdo.js";import{_ as ee}from"./nw-img-vue-CR837WER.js";const te="/media/logos/bumaau/cautions.png",ae={class:"row my-4"},se={class:"bg-secondary"},le=["src","onClick"],Ue=D({__name:"ImagePreviewSimple",props:{visibility:{type:Boolean,required:!1},images:{type:Array,required:!0}},emits:["onClose","onDelete","onDownloaded"],setup(p,{emit:B}){const l=p,A=B,r=i([]),w=q(l,"visibility"),I=i(0),o=i([]),v=i([]),s=i([]),f=i(""),n=i(!1),h=d=>{var e;if(r.value.length<1)return;let t;do t=(e=r.value.find(a=>a.key==d))==null?void 0:e.value;while(!t);return t},x=()=>{w.value=!1,A("onClose",null)},F=()=>{l.images&&(s.value=L(l.images).map(d=>({imgBlob:d.filename,url:"",description:d.description})))},P=async()=>{if(F(),I.value=0,r.value=[],!l.images)return;v.value=L(l.images),o.value=Array.apply(null,Array(l.images.length)).map(function(){return!0});const d=v.value.length;for(let t=I.value;t<d;t++){const e=v.value[t].filename;await U(e,t)}},U=async(d,t)=>{const e={fileUrl:d,ver:"v1"};try{const a=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(e).toString()}`,m=await H.getBlob(a),u=new Blob([m.data]);let g=window.URL||window.webkitURL;r.value.push({key:d,value:g.createObjectURL(u)}),s.value.forEach(k=>{k.imgBlob==d&&(k.url=g.createObjectURL(u))}),o.value[t]=!1}catch(a){console.log("image",a)}},R=d=>{const t=s.value.findIndex(e=>e.imgBlob==d);if(t>0){const e=s.value.slice(t),a=s.value.slice(0,t);s.value=[...e,...a]}f.value=d,n.value=!0},T=()=>{f.value="",n.value=!1};return(d,t)=>{const e=C("el-skeleton-item"),a=C("el-skeleton"),m=C("el-dialog");return _(),y(S,null,[b(m,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=u=>w.value=u),title:"Detailed picture",width:"80%",onOpened:P,onOpen:P,onClose:x},{default:$(()=>[c("div",ae,[(_(!0),y(S,null,O(v.value,(u,g)=>(_(),y("div",{key:u.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[b(a,{loading:o.value[g],animated:""},{template:$(()=>[b(e,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:$(()=>[c("div",se,[h(u.filename)!=null?(_(),y("img",{key:0,src:h(u.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:k=>R(u.filename)},null,8,le)):E("",!0)])]),_:2},1032,["loading"])]))),128))])]),_:1},8,["modelValue"]),b(M,{images:s.value,visibility:n.value,"new-version":!0,image:f.value,onHandleClose:T},null,8,["images","visibility","image"])],64)}}}),oe={class:"mt-5 ps-0"},ne=c("div",{class:"p-2"},[c("img",{src:te,alt:"cautions"})],-1),ie={class:"p-2 bg-green flex-fill"},re=["innerHTML"],Re=D({__name:"SafetyPrecautions",props:{data:{required:!0,type:Array}},setup(p){const B=i("Safety Precautions"),l=i(null),A=i(""),r=i(!1),w=()=>{r.value=!1},I=o=>Z(o).replaceAll("{BLOB_URL}","https://digitaldevbumaausta001.blob.core.windows.net");return W(()=>{try{l.value&&Array.from(l.value).forEach(o=>{Array.from(o.getElementsByClassName("show-pdf")).forEach(s=>{s.onclick=f=>{f.preventDefault(),r.value=!0,A.value=s.href}})})}catch(o){console.log(o)}}),(o,v)=>{const s=C("el-collapse-item"),f=C("el-collapse");return _(),y(S,null,[c("div",oe,[b(f,{modelValue:B.value,"onUpdate:modelValue":v[0]||(v[0]=n=>B.value=n),class:"task-group general-accordion py-1 px-5 mb-3"},{default:$(()=>[b(s,{title:"Safety Precautions",name:"Safety Precautions"},{default:$(()=>[(_(!0),y(S,null,O(p.data,(n,h)=>(_(),y("div",{key:n.key,class:J(["d-flex justify-content-start",h==p.data.length-1?"mb-5":""])},[ne,c("div",ie,[n.items[1].taskType!="html"?(_(),y(S,{key:0},[N(V(n.items[1].value),1)],64)):(_(),y("span",{key:1,ref_for:!0,ref_key:"safetyPrecautinsHtml",ref:l,innerHTML:I(n.items[1].value)},null,8,re))])],2))),128))]),_:1})]),_:1},8,["modelValue"])]),b(Y,{show:r.value,onHandleCloseModal:w,"blob-url":A.value},null,8,["show","blob-url"])],64)}}}),ce={class:"row my-4"},ue={style:{"font-size":"10px","font-weight":"600"}},de={class:"bg-secondary"},me=["src","onClick"],pe={style:{"font-size":"10px",display:"block","text-align":"right"}},ve=D({__name:"ImagePreviewWithTimestamp",props:{visibility:{type:Boolean,required:!1},images:{type:Array,required:!0}},emits:["onClose","onDelete","onDownloaded"],setup(p,{emit:B}){const l=p,A=B,r=i([]),w=q(l,"visibility"),I=i(0),o=i([]),v=i([]),s=i([]),f=i(""),n=i(!1),h=(t,e)=>{let a=l.images.filter(u=>u.updatedBy.id==t);return a=z.orderBy(a,["imageType","updatedDate"],["desc","asc"]),a.findIndex(u=>u.image.filename==e)==0?"Front Page":"Back Page"},x=()=>{f.value="",n.value=!1},F=t=>{var a;if(r.value.length<1)return;let e;do e=(a=r.value.find(m=>m.key==t))==null?void 0:a.value;while(!e);return e},P=()=>{w.value=!1,A("onClose",null)},U=()=>{if(!l.images)return;const t=l.images.map(e=>e.image);s.value=L(t).map(e=>({imgBlob:e.filename,url:"",description:e.description}))},R=async()=>{if(U(),I.value=0,r.value=[],!l.images)return;const t=l.images.map(a=>a.image);v.value=L(t),o.value=Array.apply(null,Array(l.images.length)).map(function(){return!0});const e=v.value.length;for(let a=I.value;a<e;a++){const m=v.value[a].filename;await T(m,a)}},T=async(t,e)=>{const a={fileUrl:t,ver:"v1"};try{const m=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(a).toString()}`,u=await H.getBlob(m),g=new Blob([u.data]);let k=window.URL||window.webkitURL;r.value.push({key:t,value:k.createObjectURL(g)}),s.value.forEach(j=>{j.imgBlob==t&&(j.url=k.createObjectURL(g))}),o.value[e]=!1}catch(m){console.log("image",m)}},d=t=>{const e=s.value.findIndex(a=>a.imgBlob==t);if(e>0){const a=s.value.slice(e),m=s.value.slice(0,e);s.value=[...a,...m]}f.value=t,n.value=!0};return(t,e)=>{const a=C("el-skeleton-item"),m=C("el-skeleton"),u=C("el-dialog");return _(),y(S,null,[b(u,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=g=>w.value=g),title:"Detailed picture",width:"80%",onOpened:R,onOpen:R,onClose:P},{default:$(()=>[c("div",ce,[(_(!0),y(S,null,O(v.value,(g,k)=>(_(),y("div",{key:g.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[b(m,{loading:o.value[k],animated:""},{template:$(()=>[b(a,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:$(()=>[c("span",ue,V(h(p.images[k].updatedBy.id,g.filename)),1),c("div",de,[F(g.filename)!=null?(_(),y("img",{key:0,src:F(g.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:j=>d(g.filename)},null,8,me)):E("",!0)]),c("span",pe,V(`${p.images[k].updatedBy.name}, ${p.images[k].updatedDate}`),1)]),_:2},1032,["loading"])]))),128))])]),_:1},8,["modelValue"]),b(M,{images:s.value,visibility:n.value,"new-version":!0,image:f.value,onHandleClose:x},null,8,["images","visibility","image"])],64)}}}),fe=p=>(Q("data-v-444ef6ab"),p=p(),X(),p),ge={class:"mt-5 ps-0"},_e={class:"row vcp mx-0 py-4 d-flex justify-content-between risk-assessment-title"},ye=fe(()=>c("div",{class:"col title ps-6"},[N("Take photo of completed Pre-Task Risk Assessment Form "),c("span",{class:"text-danger"},"(required)")],-1)),he={class:"col-2 col-md-1"},be={class:"row justify-content-center"},we={key:0,class:"col-6 ps-0 pe-1"},ke={class:"text-white"},Be=D({__name:"RiskAssessment",props:{ready:{required:!0,type:Boolean},data:{required:!0,type:Array}},setup(p){const B=p,l=i(!1),A=()=>{console.log("call this",B.data);let o=[];if(!Array.isArray(B.data[0].value))return o;o=G(B.data[0].value).filter((n,h,x)=>h===x.findIndex(F=>{const P=F.image,U=n.image;return P.filename===U.filename}));const s=[];let f=o.map(n=>n.updatedBy.id);return f=[...new Set(f)],f.forEach(n=>{let h=o.filter(x=>x.updatedBy.id==n);h=z.orderBy(h,x=>x.updatedDate).slice(0,2),s.push(...h)}),s},r=K(()=>A()),w=()=>{l.value=!0},I=()=>{l.value=!1};return(o,v)=>(_(),y(S,null,[c("div",ge,[c("div",_e,[ye,c("div",he,[c("div",be,[r.value&&r.value.length>0?(_(),y("div",we,[c("button",{class:"btn btn-sm btn-icon btn-bg-success",onClick:w,style:{"background-color":"#18AF4A"}},[c("label",ke,"+"+V(r.value.length),1)])])):E("",!0)])])])]),b(ve,{images:r.value,visibility:l.value,onOnClose:I},null,8,["images","visibility"])],64))}}),Le=ee(Be,[["__scopeId","data-v-444ef6ab"]]);export{Le as R,Ue as _,Re as a,te as b};
