import{u as Pt}from"./useMenuStore-CD5Gmvif.js";import{a as vt}from"./breadcrumb-BYmEOf4C.js";import{c as $,a as et,J as K,I as nt,z,A as St}from"./index-BuVmIl8K.js";import{P as ut}from"./Pagination-D-xfdYmn.js";import{F as _t}from"./FilterIconButton-Bj0WTbms.js";import{h as Et,A as yt,U as bt}from"./excel-generator-DMHRo93s.js";import{D as wt}from"./DownloadIconButton-CIQp-YG7.js";import{_,b as mt}from"./element-plus-BeWdvTRa.js";import{w as x,q as C,x as dt,y as Ft}from"./date-format-8-IvfSl3.js";import{a as A}from"./urls-Co2bUkFd.js";import{d as st}from"./pinia-BjOS2_Ao.js";import{P as G}from"./Pagination-BiobnanQ.js";import{a as Ct}from"./mapOption-CeGMwmH0.js";import{a as Mt,d as It}from"./table-sort-Bpdq_Uwn.js";import{k as B,c as L,r as N,u as o,y as R,p as b,aa as j,q as M,x as m,Y as Q,R as T,s as n,aB as d,C as O,a0 as W,B as k,A as X,T as pt,bd as kt,bb as Tt,a7 as Lt,L as xt,F as Ut}from"./@vue-BypzYtbH.js";import{_ as V}from"./TextInput.vue_vue_type_script_setup_true_lang-oAh_qqu1.js";import{_ as J}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-CCwjwK39.js";import{a as ht}from"./vee-validate-C_msoaAA.js";import{c as Dt,a as H,b as Y,d as gt}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{E as ft}from"./ErrorAlert-CMKGfwAi.js";import{e as $t}from"./lodash-DrHMlsdo.js";import{_ as At}from"./FileDropZone.vue_vue_type_style_index_0_lang-C5PyimC7.js";import{m as Bt}from"./map-anything-abi6NY2Z.js";import{_ as Vt}from"./nw-img-vue-CR837WER.js";import{_ as Nt}from"./AutoComplete.vue_vue_type_style_index_0_lang-DrAAOf71.js";import{_ as ct}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-CJ7rJST9.js";import{F as Ot}from"./file-saver-CwTBvle_.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./vue-router-iNp9kJ0K.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./PageEnum-DUtfSNQS.js";import"./xlsx-C4maHrMm.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";const Z=st({id:"maintenancePlantForm",state:()=>({stateFormData:{MaintenancePlantKeyId:0,StartDate:x(new Date),EndDate:x(new Date("12/31/9999"))},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading},actions:{async insertData(t){this.stateFormData.StartDate=C(x(new Date(this.stateFormData.StartDate))),this.stateFormData.EndDate=C(x(new Date(this.stateFormData.EndDate)));try{this.stateLoading=!0;const i={userAccount:t,ver:"v1"},a=await $.post(`${A.insertItem}?${new URLSearchParams(i).toString()}`,this.stateFormData);a.data.title==="Error"?(this.stateErrors.push(a.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(i){this.stateError=i,this.stateErrors.push(i.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},async updateData(t){this.stateFormData.StartDate=C(x(new Date(this.stateFormData.StartDate))),this.stateFormData.EndDate=C(x(new Date(this.stateFormData.EndDate)));try{this.stateLoading=!0;const i={userAccount:t,ver:"v1"},a=await $.post(`${A.updateItem}?${new URLSearchParams(i).toString()}`,this.stateFormData);a.data.title==="Error"?(this.stateErrors.push(a.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(i){this.stateError=i,this.stateErrors.push(i.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.MaintenancePlantKeyId=t.maintenancePlantKeyId||0,this.stateFormData.MaintenancePlantId=t.maintenancePlantId||"",this.stateFormData.MaintenancePlantCode=t.maintenancePlantCode||"",this.stateFormData.MaintenancePlantDescription=t.maintenancePlantDescription||"",this.stateFormData.StartDate=t.startDate||"",this.stateFormData.EndDate=t.endDate||""},resetState(){this.stateFormData={MaintenancePlantKeyId:0,StartDate:x(new Date),EndDate:x(new Date("12/31/9999"))},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),at={MaintenancePlant:"",StartDate:"",EndDate:"",MaintenancePlantTo:"",StartDateTo:"",EndDateTo:"",ver:"v1",Page:1,PageSize:10,Order:""},ot=st({id:"maintenancePlantList",state:()=>({stateFilterData:{...at},stateLastUsedFilterData:{...at},statePageName:"maintenancePlant",stateDisplayData:[],statePagination:new G,stateLoading:!1,statePaginationLoading:!1,stateMaintenancePlantOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,maintenancePlantOption:t=>t.stateMaintenancePlantOption},actions:{async getData(t=!0){const i={MaintenancePlantId:this.stateFilterData.MaintenancePlant,MaintenancePlantIdTo:this.stateFilterData.MaintenancePlantTo,StartDate:this.stateFilterData.StartDate?C(this.stateFilterData.StartDate.toLocaleString()):"",EndDate:this.stateFilterData.EndDate?C(this.stateFilterData.EndDate.toLocaleString()):"",StartDateTo:this.stateFilterData.StartDateTo?C(this.stateFilterData.StartDateTo.toLocaleString()):"",EndDateTo:this.stateFilterData.EndDateTo?C(this.stateFilterData.EndDateTo.toLocaleString()):"",Page:this.stateFilterData.Page.toString(),PageSize:this.stateFilterData.PageSize.toString(),Order:this.stateFilterData.Order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const a=await $.get(A.getList,"",new URLSearchParams(i).toString());this.stateDisplayData=a.data.result.content,this.setTotalPage(a.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(a){console.log(a)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const i=await $.get(A.getLookup,"",new URLSearchParams(t).toString());this.stateMaintenancePlantOption=Ct(i.data.result.content,"maintenancePlant",["maintenancePlantCode","maintenancePlantDescription"])}catch(i){console.log(i)}},async export(){const t={MaintenancePlantId:this.stateFilterData.MaintenancePlant,MaintenancePlantIdTo:this.stateFilterData.MaintenancePlantTo,StartDate:this.stateFilterData.StartDate?C(this.stateFilterData.StartDate.toLocaleString()):"",EndDate:this.stateFilterData.EndDate?C(this.stateFilterData.EndDate.toLocaleString()):"",StartDateTo:this.stateFilterData.StartDateTo?C(this.stateFilterData.StartDateTo.toLocaleString()):"",EndDateTo:this.stateFilterData.EndDateTo?C(this.stateFilterData.EndDateTo.toLocaleString()):"",ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await $.getBlob(A.exportData,"",new URLSearchParams(t).toString())).data}catch(i){console.log(i)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:i}){if(!t&&!i)this.stateFilterData.Order="";else{const a=i=="ascending"?"asc":"desc";this.stateFilterData.Order=`${t}_${a}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1)},setMaintenancePlant(t){this.stateFilterData.MaintenancePlant=t},setStartDate(t){this.stateFilterData.StartDate=t},setEndDate(t){this.stateFilterData.EndDate=t},setMaintenancePlantTo(t){this.stateFilterData.MaintenancePlantTo=t},setStartDateTo(t){this.stateFilterData.StartDateTo=t},setEndDateTo(t){this.stateFilterData.EndDateTo=t},async resetFilter(){this.stateFilterData.MaintenancePlant="",this.stateFilterData.StartDate="",this.stateFilterData.EndDate="",this.stateFilterData.MaintenancePlantTo="",this.stateFilterData.StartDateTo="",this.stateFilterData.EndDateTo="";const t=this.stateLastUsedFilterData.MaintenancePlant!=="",i=this.stateLastUsedFilterData.StartDate!=="",a=this.stateLastUsedFilterData.EndDate!=="",f=this.stateLastUsedFilterData.MaintenancePlantTo!=="",c=this.stateLastUsedFilterData.StartDateTo!=="",s=this.stateLastUsedFilterData.EndDateTo!=="";(t||i||a||f||c||s)&&await this.getData()},resetState(){this.stateFilterData={...at},this.stateDisplayData=[],this.statePagination=new G,this.stateLoading=!1,this.statePaginationLoading=!1,this.stateMaintenancePlantOption=[]}}}),Ht={key:0,style:{height:"100px"}},Rt={key:0,class:"row justify-content-center"},qt={key:1,class:"row justify-content-center"},zt={class:"row justify-content-center"},jt=["onClick"],Kt=B({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog"],setup(t,{emit:i}){const a=t,f=ot(),c=Z(),s=i,D=L(()=>(a.page-1)*10+1),r=N(""),v=P=>{r.value=P.order;const S={prop:P.prop,order:P.order};f.setSort(S)},g=(P,S,E)=>Mt(P[E],S[E],r.value),I=P=>{c.setFormData(P),s("show-dialog",null)};return(P,S)=>{const E=T("inline-svg"),F=T("el-tooltip"),w=Q("loading");return o(f).loading?R((b(),j("div",Ht,null,512)),[[w,o(f).loading]]):R((b(),M(o(mt),{key:1,data:a.listData,style:{width:"100%"},onSortChange:v,sortable:!0,"empty-text":"No Data",class:"fixed-height-table"},{default:m(()=>[n(o(_),{label:"No",width:"70",align:"center"},{default:m(e=>[d("span",null,O(D.value+e.$index),1)]),_:1}),n(o(_),{prop:"maintenancePlantId",label:"Maintenance Plant ID",width:"200",sortable:"","sort-method":(e,u)=>g(e,u,"maintenancePlantId")},null,8,["sort-method"]),n(o(_),{prop:"maintenancePlantCode",label:"Maintenance Plant Code",width:"200",sortable:"","sort-method":(e,u)=>g(e,u,"maintenancePlantCode")},null,8,["sort-method"]),n(o(_),{prop:"maintenancePlantDescription",label:"Maintenance Plant Desc.",width:"200",sortable:"","sort-method":(e,u)=>g(e,u,"maintenancePlantDescription")},null,8,["sort-method"]),n(o(_),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:m(e=>[d("span",null,O(o(dt)(e.row.startDate)),1)]),_:1}),n(o(_),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""},{default:m(e=>[d("span",null,O(o(dt)(e.row.endDate)),1)]),_:1}),n(o(_),{prop:"isActive",label:"Is Active",width:"100",sortable:""},{default:m(e=>[e.row.isActive?(b(),j("div",Rt,[n(E,{src:"/media/svg/tables/rows/check.svg"})])):(b(),j("div",qt,[n(E,{src:"/media/svg/tables/rows/minus.svg"})]))]),_:1}),n(o(_),{prop:"changedOn",label:"Changed on",width:"170",sortable:""},{default:m(e=>[d("span",null,O(o(Ft)(e.row.changedOn)),1)]),_:1}),n(o(_),{prop:"changedBy",label:"Changed by",width:"300",sortable:"","sort-method":(e,u)=>g(e,u,"changedBy")},null,8,["sort-method"]),n(o(_),{label:"",width:"80"},{default:m(e=>[d("div",zt,[n(F,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:m(()=>[d("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:u=>I(e.row)},[n(E,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,jt)]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[w,o(f).loading]])}}}),Gt={class:"col-md-6 fv-row fv-plugins-icon-container"},Jt={class:"col-md-6 fv-row fv-plugins-icon-container"},Yt={class:"w-100 fv-row fv-plugins-icon-container"},Qt={class:"col-md-6 fv-row fv-plugins-icon-container"},Wt={class:"col-md-6 fv-row fv-plugins-icon-container"},Xt={class:"dialog-footer"},Zt=B({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:i}){const a=t,f=i,c=Z(),s=et(),D=W(a,"visibility"),r=L(()=>c.formData),v=L(()=>c.errors),g=L(()=>c.isError),I=()=>{E(""),F(""),w(""),e(""),u("")},P=Dt().shape({MaintenancePlantId:H().required("Maintenance Plant is mandatory"),MaintenancePlantCode:H().required("Maintenance Plant Code is mandatory"),MaintenancePlantDescription:H().required("Maintenance Plant Description is mandatory"),StartDate:Y().required("Start Date is mandatory").typeError("Start Date is mandatory"),EndDate:Y().required("End Date is mandatory").min(gt("StartDate"),"End date must be later than start date").typeError("End date must be later than start date").typeError("End Date is mandatory")}),S=(l=!1)=>{h(),I(),f("handle-close",l)},E=l=>{r.value.MaintenancePlantId=l},F=l=>{r.value.MaintenancePlantDescription=l},w=l=>{r.value.MaintenancePlantCode=l},e=l=>{r.value.StartDate=l},u=l=>{r.value.EndDate=l},p=async()=>{h(),await P.validate(r.value,{abortEarly:!1}).catch(l=>{c.setErrors(l.errors)}),!g.value&&K("Are you sure you want to submit ?").then(async l=>{l.isConfirmed&&c.insertData(s.user.Name).then(()=>{c.isError||nt("Form has been successfully submitted!","Ok").then(()=>{S(!0)})})})},h=()=>{c.setErrors([])};return(l,y)=>{const U=T("el-button"),tt=T("el-dialog"),q=Q("loading");return b(),M(tt,{modelValue:D.value,"onUpdate:modelValue":y[0]||(y[0]=lt=>D.value=lt),title:"New Data",width:"40%",onClose:y[1]||(y[1]=lt=>S())},{footer:m(()=>[d("span",Xt,[n(U,{type:"primary",onClick:p,disabled:o(c).loading},{default:m(()=>[k("Submit")]),_:1},8,["disabled"]),n(U,{type:"secondary",onClick:S,disabled:o(c).loading},{default:m(()=>[k("Close")]),_:1},8,["disabled"])])]),default:m(()=>[n(pt,{name:"fade"},{default:m(()=>[g.value?(b(),M(ft,{key:0,errorMessages:v.value,onResetForm:h},null,8,["errorMessages"])):X("",!0)]),_:1}),R((b(),M(o(ht),{id:"kt_filter_form",class:"row g-9 my-4"},{default:m(()=>[d("div",Gt,[n(V,{value:r.value.MaintenancePlantId,margin:!1,placeholder:"Add Maintenance Plant ID",label:"Maintenance Plant ID",name:"MaintenancePlantId",max:4,onHandleChange:E},null,8,["value"])]),d("div",Jt,[n(V,{value:r.value.MaintenancePlantCode,placeholder:"Add Maintenance Plant Code",label:"Maintenance Plant Code",name:"MaintenancePlantCode",max:4,onHandleChange:w},null,8,["value"])]),d("div",Yt,[n(V,{value:r.value.MaintenancePlantDescription,placeholder:"Add Maintenance Plant Description",label:"Maintenance Plant Desc.",name:"MaintenancePlantDescription",max:30,onHandleChange:F},null,8,["value"])]),d("div",Qt,[n(J,{value:r.value.StartDate?r.value.StartDate.toString():"",placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:e},null,8,["value"])]),d("div",Wt,[n(J,{value:r.value.EndDate?r.value.EndDate.toString():"",placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:u},null,8,["value"])])]),_:1})),[[q,o(c).loading]])]),_:1},8,["modelValue"])}}}),ta={class:"col-md-6 fv-row fv-plugins-icon-container"},aa={class:"col-md-6 fv-row fv-plugins-icon-container"},ea={class:"w-100 fv-row fv-plugins-icon-container"},na={class:"col-md-6 fv-row fv-plugins-icon-container"},sa={class:"col-md-6 fv-row fv-plugins-icon-container"},oa={class:"dialog-footer"},ia=B({__name:"FormEditDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:i}){const a=t,f=i,c=Z(),s=et(),D=W(a,"visibility"),r=L(()=>c.formData),v=L(()=>c.errors),g=L(()=>c.isError),I=Dt().shape({MaintenancePlantDescription:H().required("Maintenance Plant Description is mandatory"),MaintenancePlantCode:H().required("Maintenance Plant Code is mandatory"),StartDate:Y().required("Start Date is mandatory").typeError("Start Date is mandatory"),EndDate:Y().required("End Date is mandatory").min(gt("StartDate"),"End date must be later than start date").typeError("End date must be later than start date").typeError("End Date is mandatory")}),P=()=>{r.value.MaintenancePlantKeyId=0,r.value.MaintenancePlantId="",r.value.MaintenancePlantDescription="",F(""),w(""),e("")},S=(h=!1)=>{P(),p(),f("handle-close",h)},E=h=>{r.value.MaintenancePlantDescription=h},F=h=>{r.value.MaintenancePlantCode=h},w=h=>{r.value.StartDate=h},e=h=>{r.value.EndDate=h},u=async()=>{p(),await I.validate(r.value,{abortEarly:!1}).catch(h=>{c.setErrors(h.errors)}),!g.value&&K("Are you sure you want to submit ?").then(async h=>{h.isConfirmed&&c.updateData(s.user.Name).then(()=>{c.isError||nt("Form has been successfully submitted!","Ok").then(()=>{S(!0)})})})},p=()=>{c.setErrors([])};return(h,l)=>{const y=T("el-button"),U=T("el-dialog"),tt=Q("loading");return b(),M(U,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=q=>D.value=q),title:"Update Data",width:"40%",onClose:l[1]||(l[1]=q=>S())},{footer:m(()=>[d("span",oa,[n(y,{type:"primary",onClick:u,disabled:o(c).loading},{default:m(()=>[k("Submit")]),_:1},8,["disabled"]),n(y,{type:"secondary",onClick:S,disabled:o(c).loading},{default:m(()=>[k("Close")]),_:1},8,["disabled"])])]),default:m(()=>[n(pt,{name:"fade"},{default:m(()=>[g.value?(b(),M(ft,{key:0,errorMessages:v.value,onResetForm:p},null,8,["errorMessages"])):X("",!0)]),_:1}),R((b(),M(o(ht),{id:"kt_filter_form",class:"row g-9 my-4"},{default:m(()=>[d("div",ta,[n(V,{value:r.value.MaintenancePlantId,margin:!1,placeholder:"Add Maintenance Plant ID",label:"Maintenance Plant ID",name:"MaintenancePlantId",max:4,disabled:!0},null,8,["value"])]),d("div",aa,[n(V,{value:r.value.MaintenancePlantCode,placeholder:"Add Maintenance Plant Code",label:"Maintenance Plant Code",name:"MaintenancePlantCode",max:4,onHandleChange:F},null,8,["value"])]),d("div",ea,[n(V,{value:r.value.MaintenancePlantDescription,placeholder:"Add Maintenance Plant Description",label:"Maintenance Plant Desc.",name:"MaintenancePlantDescription",max:30,onHandleChange:E},null,8,["value"])]),d("div",na,[n(J,{value:r.value.StartDate?r.value.StartDate.toString():"",placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:w},null,8,["value"])]),d("div",sa,[n(J,{value:r.value.EndDate?r.value.EndDate.toString():"",placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:e},null,8,["value"])])]),_:1})),[[tt,o(c).loading]])]),_:1},8,["modelValue"])}}}),it=st({id:"maintenancePlantBulk",state:()=>({statePagination:new G,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const i={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const a=await $.post(`${A.uploadBulk}?${new URLSearchParams(i).toString()}`,this.stateBulkData);this.stateError=a.data.result.isError?a.data.result.message:"",this.stateIsError=a.data.result.isError}catch(a){console.log(a)}this.stateLoading=!1},async upload({userAccount:t,excelFile:i}){var c;const a={userAccount:t,ver:"v1"},f=`${A.validateUpload}?${new URLSearchParams(a).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const s=await $.postImages(f,i);s.data.statusCode==200?s.data.result.isError?(this.stateIsError=!0,this.stateError=s.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=s.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=$t.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=s.data.result.isError??!1,this.stateError=(c=s.data.result)==null?void 0:c.message)}catch(s){console.log(s),this.stateIsError=!0,this.stateError=s.response.data.result.message}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(It(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new G,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),ra={class:"icon"},la=B({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const i=t,a=it(),f=L(()=>(i.page-1)*10+1),c=s=>{const D={prop:s.prop,order:s.order};a.setSort(D)};return(s,D)=>{const r=T("inline-svg");return b(),M(o(mt),{data:i.listData,style:{width:"100%"},onSortChange:c,"empty-text":"No Data"},{default:m(()=>[n(o(_),{label:"No",width:"60",align:"center"},{default:m(v=>[d("span",null,O(f.value+v.$index),1)]),_:1}),n(o(_),{prop:"maintenancePlantId",label:"Maintenance Plant ID",width:"170",sortable:""}),n(o(_),{prop:"maintenancePlantCode",label:"Maintenance Plant Code",width:"170",sortable:""}),n(o(_),{prop:"maintenancePlantDescription",label:"Maintenance Plant Desc.",width:"170",sortable:""}),n(o(_),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""}),n(o(_),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""}),n(o(_),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),n(o(_),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:m(v=>[d("div",ra,[n(r,{src:v.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),rt=t=>(kt("data-v-df4ab634"),t=t(),Tt(),t),da=rt(()=>d("div",{class:"text-center"},null,-1)),ca=rt(()=>d("div",{class:"mb-3"},[d("span",null,[k(" Download template "),d("a",{href:"/documents/MasterDataMaintenancePlant.xlsx",target:"_blank",id:"link-download"},"here"),k(" before uploading file ")])],-1)),ua=rt(()=>d("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[d("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),ma={class:"card"},pa={class:"card-body grid-padding"},ha={class:"dialog-footer"},Da=B({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:i}){const a=t,f=i,c=et(),s=it(),D=W(a,"visibility"),r=()=>{const e=Bt(s.validatedData,u=>{const p=u;return{maintenancePlantKeyId:0,maintenancePlantId:p.maintenancePlantId,maintenancePlantDescription:p.maintenancePlantDescription,maintenancePlantCode:p.maintenancePlantCode,startDate:p.startDate,endDate:p.endDate}});return Object.values(e)},v=()=>{const e=document.getElementById("link-download");e&&e.click()},g=()=>{s.validatedData.length>0?K("Cancel Upload Data?","Confirm").then(u=>{u.isConfirmed&&P()}):P()},I=async e=>{await s.upload({userAccount:c.user.Name,excelFile:e}),s.stateError&&z(s.error)},P=(e=!1)=>{s.resetState(),f("handle-close",e)},S=e=>{s.setIsUploadedState(e)},E=e=>{s.setPage(e)},F=()=>{if(s.validatedData.length<1){v();return}const e=["MAINTENANCE PLANT ID","MAINTENANCE PLANT CODE","MAINTENANCE PLANT DESC","START DATE","END DATE","REMARK","STATUS"],u=s.validatedData.map(p=>({maintenancePlant:p.maintenancePlantId,maintenancePlantCode:p.maintenancePlantCode,maintenancePlantDescription:p.maintenancePlantDescription,startDate:p.startDate,endDate:p.endDate,remark:p.validationReason,status:p.isValid?"OK":"Error"}));Et("Maintenance Plant",e,u)},w=async()=>{if(s.displayData.length<1){z("There is no data to submit");return}if(s.isError){z("There is still invalid row(s)");return}K("Are you sure you want to submit ?").then(async e=>{if(e.isConfirmed){const u=r();if(s.setBulkData(u),await s.bulkInsert(c.user.Name),s.isError){z(s.stateError);return}nt("Form has been successfully submitted!","Ok").then(()=>{P(!0)})}})};return(e,u)=>{const p=T("el-button"),h=T("el-dialog"),l=Q("loading");return b(),M(h,{title:"Upload Bulk Data",modelValue:D.value,"onUpdate:modelValue":u[1]||(u[1]=y=>D.value=y),"before-close":g,width:"70%","custom-class":"upload-modal"},{footer:m(()=>[d("div",null,[d("span",ha,[n(p,{type:"success",onClick:F},{default:m(()=>[k("Download")]),_:1}),n(p,{type:"primary",onClick:w},{default:m(()=>[k("Upload")]),_:1}),n(p,{type:"success",onClick:g},{default:m(()=>[k("Cancel")]),_:1})])])]),default:m(()=>[da,ca,R(n(At,{isSubmissionUploadSuccess:o(s).isUploaded,onHandleCloseUploadedFile:g,onHandleUpload:I,onHandleSetIsExcelFileUploaded:S},null,8,["isSubmissionUploadSuccess"]),[[l,o(s).uploadLoading]]),ua,d("div",ma,[d("div",pa,[n(la,{"list-data":o(s).displayData,page:o(s).pagination.currentPage},null,8,["list-data","page"])])]),o(s).displayData.length>0?(b(),M(ut,{key:0,onRaisePageChange:u[0]||(u[0]=y=>E(y)),currentPage:o(s).pagination.currentPage,totalPage:o(s).pagination.totalPage,totalPageSize:o(s).pagination.totalPageSize,startPaginationIndex:o(s).pagination.startPaginationIndex,endPaginationIndex:o(s).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):X("",!0)]),_:1},8,["modelValue"])}}}),ga=Vt(Da,[["__scopeId","data-v-df4ab634"]]),fa={class:"row g-9 my-4"},Pa={class:"w-100 fv-row fv-plugins-icon-container"},va={class:"w-100 fv-row fv-plugins-icon-container"},Sa={class:"w-100 fv-row fv-plugins-icon-container"},_a={class:"dialog-footer"},Ea=B({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:i}){const a=ot(),f=t,c=i,s=W(f,"visibility"),D=L(()=>a.filterData),r=()=>{v(),a.resetFilter()},v=()=>{c("handle-close",!1)},g=e=>{a.setMaintenancePlant(e)},I=e=>{a.setMaintenancePlantTo(e)},P=e=>{a.setStartDate(e)},S=e=>{a.setStartDateTo(e)},E=e=>{a.setEndDate(e)},F=e=>{a.setEndDateTo(e)},w=()=>{const e=a.lastUsedFilterData.MaintenancePlant!==a.filterData.MaintenancePlant,u=a.lastUsedFilterData.StartDate!==a.filterData.StartDate,p=a.lastUsedFilterData.EndDate!==a.filterData.EndDate,h=a.lastUsedFilterData.MaintenancePlantTo!==a.filterData.MaintenancePlantTo,l=a.lastUsedFilterData.StartDateTo!==a.filterData.StartDateTo,y=a.lastUsedFilterData.EndDateTo!==a.filterData.EndDateTo;c("handle-close",e||u||p||h||l||y)};return(e,u)=>{const p=T("el-button"),h=T("el-dialog");return b(),M(h,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=l=>s.value=l),title:"Filter",width:"60%",onClose:u[1]||(u[1]=l=>v())},{footer:m(()=>[d("span",_a,[n(p,{type:"secondary",onClick:r},{default:m(()=>[k("Reset")]),_:1}),n(p,{type:"primary",onClick:w},{default:m(()=>[k("Filter")]),_:1})])]),default:m(()=>[d("div",fa,[d("div",Pa,[n(Nt,{"value-from":D.value.MaintenancePlant,"value-to":D.value.MaintenancePlantTo,label:"Maintenance Plant",options:o(a).maintenancePlantOption,onHandleChangeFrom:g,onHandleChangeTo:I},null,8,["value-from","value-to","options"])]),d("div",va,[n(ct,{"value-from":D.value.StartDate,"value-to":D.value.StartDateTo,label:"Start Date",onHandleChangeFrom:P,onHandleChangeTo:S},null,8,["value-from","value-to"])]),d("div",Sa,[n(ct,{"value-from":D.value.EndDate,"value-to":D.value.EndDateTo,label:"End Date",onHandleChangeFrom:E,onHandleChangeTo:F},null,8,["value-from","value-to"])])])]),_:1},8,["modelValue"])}}}),ya={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},ba=d("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),wa={class:"d-flex justify-content-between align-items-center"},Fa={class:"card"},Ca={class:"card-body grid-padding"},Ma={class:"my-5"},Oe=B({__name:"Index",setup(t){const i=Pt(),a=ot(),f=Z(),c=it(),s=N(!1),D=N(!1),r=N(!1),v=N(!1);Lt(async()=>{i[St.ACTIVE_PAGE]("IronLake"),vt("Maintenance Plant",[{pageName:"Iron Lake",pageRoute:"ironlake"},{pageName:"Business Partner",pageRoute:"maintenanceplant"},{pageName:"Maintenance Plant",pageRoute:"maintenanceplant"}]),await a.setPage(1),await a.getLookup()}),xt(()=>{a.resetState(),f.resetState(),c.resetState()});const g=async()=>{await a.setPage(1),await a.getLookup()},I=l=>{a.setPage(l)},P=()=>{s.value=!0},S=async l=>{s.value=!1,l&&await g()},E=()=>{D.value=!0},F=async l=>{D.value=!1,l&&await g()},w=()=>{r.value=!0},e=async l=>{r.value=!1,l&&await g()},u=async()=>{const l=await a.export();Ot.saveAs(new Blob([l],{type:"application/octet-stream"}),"Maintenance Plant.xlsx")},p=()=>{v.value=!0},h=async l=>{v.value=!1,l&&await g()};return(l,y)=>(b(),j(Ut,null,[d("div",ya,[ba,d("div",wa,[n(yt,{onShowDialog:P}),n(_t,{onShowDialog:w}),n(wt,{onHandleDownload:u}),n(bt,{onShowDialog:p})])]),d("div",Fa,[d("div",Ca,[n(Kt,{"list-data":o(a).displayData,page:o(a).pagination.currentPage,onShowDialog:E},null,8,["list-data","page"])])]),d("div",Ma,[o(a).paginationLoading?X("",!0):(b(),M(ut,{key:0,onRaisePageChange:y[0]||(y[0]=U=>I(U)),currentPage:o(a).pagination.currentPage,totalPage:o(a).pagination.totalPage,totalPageSize:o(a).pagination.totalPageSize,startPaginationIndex:o(a).pagination.startPaginationIndex,endPaginationIndex:o(a).pagination.endPaginationIndex,isPageSizeChange:!1},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),n(Zt,{visibility:s.value,onHandleClose:S},null,8,["visibility"]),n(ia,{visibility:D.value,onHandleClose:F},null,8,["visibility"]),n(Ea,{visibility:r.value,onHandleClose:e},null,8,["visibility"]),n(ga,{visibility:v.value,onHandleClose:h},null,8,["visibility"])],64))}});export{Oe as default};
