import{u as Ot}from"./vuex-BbOKrtVp.js";import{b as it}from"./vue-router-iNp9kJ0K.js";import{a as At}from"./breadcrumb-D-Q4Tk9w.js";import{b as x,u as q,s as $,i as tt,h as dt,j as Y,A as xt}from"./index-BCnwA6yE.js";import{P as It}from"./Pagination-CVDIvnOM.js";import{F as $t}from"./FilterIconButton-Bj0WTbms.js";import{h as Rt,A as Bt,U as Nt}from"./excel-generator-CRLIz6fw.js";import{D as Ht}from"./DownloadIconButton-CIQp-YG7.js";import{k as Q,c as O,r as K,u as n,y as X,p as S,aa as U,s as o,x as c,T as bt,q as w,F as yt,Y as pt,R as V,A as nt,aB as m,C as j,P as ft,a0 as ct,B as H,bd as Vt,bb as jt,a7 as zt,L as Kt}from"./@vue-BypzYtbH.js";import{_ as F,b as Et}from"./element-plus-C5R56mia.js";import{P as et,b as J,a as Gt,d as Qt}from"./table-sort-VnBD5Hfa.js";import{d as mt}from"./pinia-BjOS2_Ao.js";import{b as at,m as Ct,a as Wt}from"./mapOption-sP4IrA4W.js";import{f as M,n as C,a as vt}from"./date-format-BASVuupi.js";import{L as Xt}from"./urls-DzqKjzQ_.js";import{c as Yt}from"./urls-DBLs_wGY.js";import{L as Jt}from"./urls-D--VoWL5.js";import{c as Ft,a as z,b as ot,d as wt}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as Tt}from"./ErrorAlert-CMKGfwAi.js";import{_ as W}from"./AutoComplete.vue_vue_type_script_setup_true_lang-D4CTLiQF.js";import{_ as st}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as lt}from"./TextInput.vue_vue_type_script_setup_true_lang-oAh_qqu1.js";import{a as Zt}from"./vee-validate-C_msoaAA.js";import{_ as te}from"./lodash-Cr9vlq0V.js";import{_ as ee}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as ae}from"./map-anything-abi6NY2Z.js";import{_ as oe}from"./nw-img-vue-CR837WER.js";import{_ as Z}from"./AutoComplete.vue_vue_type_style_index_0_lang-CRR6Z--K.js";import{_ as St}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as se}from"./file-saver-DhbZvGod.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const G="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_mapping_sos",ne=`${G}`,ie=`${G}/mapping_sos_bulk`,re=`${G}/validate_upload`,le=`${G}/export`,de=`${G}/lookup`,pe=`${G}/mapping_sos`,ce=`${G}/mapping_sos/update`,rt={site:"",siteTo:"",equipmentModel:"",equipmentModelTo:"",component:"",componentTo:"",compartId:"",compartIdTo:"",startDate:"",startDateTo:"",endDate:"",endDateTo:"",ver:"v1",page:1,pageSize:10,order:""},ut=mt({id:"mappingSosList",state:()=>({stateFilterData:{...rt},stateLastUsedFilterData:{...rt},statePageName:"mappingSos",stateDisplayData:[],statePagination:new et,stateLoading:!1,statePaginationLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateComponentOption:[],stateCompartIdOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,siteOption:t=>t.stateSiteOption,equipmentModelOption:t=>t.stateEquipmentModelOption,componentOption:t=>t.stateComponentOption,compartIdOption:t=>t.stateCompartIdOption},actions:{async getData(t=!0){const a={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,equipmentModel:this.stateFilterData.equipmentModel,equipmentModelTo:this.stateFilterData.equipmentModelTo,component:this.stateFilterData.component,componentTo:this.stateFilterData.componentTo,compartId:this.stateFilterData.compartId,compartIdTo:this.stateFilterData.compartIdTo,startDate:this.stateFilterData.startDate?M(C(new Date(this.stateFilterData.startDate))):"",startDateTo:this.stateFilterData.startDateTo?M(C(new Date(this.stateFilterData.startDateTo))):"",endDate:this.stateFilterData.endDate?M(C(new Date(this.stateFilterData.endDate))):"",endDateTo:this.stateFilterData.endDateTo?M(C(new Date(this.stateFilterData.endDateTo))):"",page:this.stateFilterData.page.toString(),pageSize:this.stateFilterData.pageSize.toString(),order:this.stateFilterData.order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await x.get(ne,"mapping_sos",new URLSearchParams(a).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){!e.response.data&&(e!=null&&e.includes("Request failed with status code 401"))&&q().setLoggedIn(!1),$("IRONS",e),console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const a=await x.get(de,"",new URLSearchParams(t).toString());this.stateSiteOption=at(a.data.result.content.site,"siteId","siteCode","siteDescription"),this.stateEquipmentModelOption=at(a.data.result.content.equipmentModel,"equipmentModel","brand","equipmentModelDescription"),this.stateComponentOption=Ct(a.data.result.content.component,"objectType","objectTypeDescription"),this.stateCompartIdOption=Wt(a.data.result.content.compartId)}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),$("IRONS",a),console.log(a)}},async export(){const t={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,equipmentModel:this.stateFilterData.equipmentModel,equipmentModelTo:this.stateFilterData.equipmentModelTo,component:this.stateFilterData.component,componentTo:this.stateFilterData.componentTo,compartId:this.stateFilterData.compartId,compartIdTo:this.stateFilterData.compartIdTo,startDate:this.stateFilterData.startDate?M(C(new Date(this.stateFilterData.startDate))):"",startDateTo:this.stateFilterData.startDateTo?M(C(new Date(this.stateFilterData.startDateTo))):"",endDate:this.stateFilterData.endDate?M(C(new Date(this.stateFilterData.endDate))):"",endDateTo:this.stateFilterData.endDateTo?M(C(new Date(this.stateFilterData.endDateTo))):"",order:this.stateFilterData.order,ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await x.getBlob(le,"",new URLSearchParams(t).toString())).data}catch(a){$("IRONS",a),console.log(a)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:a}){if(!t&&!a)this.stateFilterData.order="";else{const e=a=="ascending"?"asc":"desc";this.stateFilterData.order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1)},setSite(t){this.stateFilterData.site=t},setSiteTo(t){this.stateFilterData.siteTo=t},setComponent(t){this.stateFilterData.component=t},setComponentTo(t){this.stateFilterData.componentTo=t},setCompartId(t){this.stateFilterData.compartId=t},setCompartIdTo(t){this.stateFilterData.compartIdTo=t},setEquipmentModel(t){this.stateFilterData.equipmentModel=t},setEquipmentModelTo(t){this.stateFilterData.equipmentModelTo=t},setStartDate(t){this.stateFilterData.startDate=t},setStartDateTo(t){this.stateFilterData.startDateTo=t},setEndDate(t){this.stateFilterData.endDate=t},setEndDateTo(t){this.stateFilterData.endDateTo=t},async resetFilter(){this.stateFilterData.site="",this.stateFilterData.siteTo="",this.stateFilterData.equipmentModel="",this.stateFilterData.equipmentModelTo="",this.stateFilterData.component="",this.stateFilterData.componentTo="",this.stateFilterData.compartId="",this.stateFilterData.compartIdTo="",this.stateFilterData.startDate="",this.stateFilterData.startDateTo="",this.stateFilterData.endDate="",this.stateFilterData.endDateTo="";const t=this.stateLastUsedFilterData.site!=="",a=this.stateLastUsedFilterData.siteTo!=="",e=this.stateLastUsedFilterData.equipmentModel!=="",p=this.stateLastUsedFilterData.equipmentModelTo!=="",r=this.stateLastUsedFilterData.component!=="",s=this.stateLastUsedFilterData.componentTo!=="",l=this.stateLastUsedFilterData.compartId!=="",u=this.stateLastUsedFilterData.compartIdTo!=="",y=this.stateLastUsedFilterData.startDate!=="",b=this.stateLastUsedFilterData.startDateTo!=="",g=this.stateLastUsedFilterData.endDate!=="",_=this.stateLastUsedFilterData.endDateTo!=="";(t||a||e||p||r||s||l||u||y||b||g||_)&&await this.getData()},resetState(){this.stateFilterData={...rt},this.stateDisplayData=[],this.statePagination=new et,this.stateLoading=!1,this.statePaginationLoading=!1}}}),_t={mappingSosId:0,site:"",equipmentModel:"",component:"",compartId:"",startDate:C(new Date),endDate:C(new Date("12/31/9999"))},ht=mt({id:"mappingSosForm",state:()=>({stateFormData:{..._t},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateComponentOption:[],stateIsEdit:!1}),getters:{isEdit:t=>t.stateIsEdit,formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading,siteOption:t=>t.stateSiteOption,equipmentModelOption:t=>t.stateEquipmentModelOption,componentOption:t=>t.stateComponentOption},actions:{setIsEdit(t){this.stateIsEdit=t},async getLookupComponent(){const t={ver:"v1"};try{const a=await x.get(Jt,"",new URLSearchParams(t).toString());this.stateComponentOption=Ct(a.data.result.content,"component","componentDescription")}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),$("IRONS",a),console.log(a)}},async getLookupEquipmentModel(){const t={ver:"v1"};try{const a=await x.get(Yt,"",new URLSearchParams(t).toString());this.stateEquipmentModelOption=at(a.data.result.content,"equipmentModel","brand","equipmentModelDescription")}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),$("IRONS",a),console.log(a)}},async getLookupSite(){const t={ver:"v1"};try{const a=await x.get(Xt,"",new URLSearchParams(t).toString());this.stateSiteOption=at(a.data.result.content,"siteId","siteCode","siteDescription")}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),$("IRONS",a),console.log(a)}},async insertData(t){try{this.stateLoading=!0;const a={userAccount:t,ver:"v1"},e={mappingSosId:0,site:this.formData.site,equipmentModel:this.formData.equipmentModel,component:this.formData.component,compartId:this.formData.compartId,startDate:M(C(new Date(this.stateFormData.startDate))),endDate:M(C(new Date(this.stateFormData.endDate)))},p=await x.post(`${pe}?${new URLSearchParams(a).toString()}`,e);p.data.title==="Error"?(this.stateErrors.push(p.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),this.stateError=a,this.stateErrors.push(a.response.data.result.message),this.stateIsError=!0,$("IRONS",a)}this.stateLoading=!1},async updateData(t){try{this.stateLoading=!0;const a={userAccount:t,ver:"v1"},e={mappingSosId:this.formData.mappingSosId,site:this.formData.site,equipmentModel:this.formData.equipmentModel,component:this.formData.component,compartId:this.formData.compartId,startDate:M(C(new Date(this.stateFormData.startDate))),endDate:M(C(new Date(this.stateFormData.endDate)))},p=await x.post(`${ce}?${new URLSearchParams(a).toString()}`,e);p.data.title==="Error"?(this.stateErrors.push(p.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(a){a.response.data.statusCode==401&&q().setLoggedIn(!1),this.stateError=a,this.stateErrors.push(a.response.data.result.message),this.stateIsError=!0,$("IRONS",a)}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.mappingSosId=t.mappingSosId,this.stateFormData.site=t.site,this.stateFormData.equipmentModel=t.equipmentModel,this.stateFormData.component=t.component,this.stateFormData.compartId=t.compartId,this.stateFormData.startDate=t.startDate,this.stateFormData.endDate=t.endDate},resetState(){this.stateFormData={..._t},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),me={key:0,style:{height:"100px"}},ue={key:1},he={key:1},De={key:1},ge={key:1},fe={key:0,class:"d-flex align-items-center"},ve=m("span",{class:"mx-1 w-20"},"to",-1),Se={key:1,class:"row justify-content-center"},_e={key:0,class:"d-flex justify-content-end"},Ie=["disabled","onClick"],be=["onClick"],ye={key:1,class:"d-flex"},Ee=Q({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["fetch-data","duplicateData"],setup(t,{emit:a}){const e=t,p=q(),r=ut(),s=ht(),l=a,u=O(()=>(e.page-1)*10+1),y=K(""),b=I=>{y.value=I.order;const i={prop:I.prop,order:I.order};r.setSort(i)},g=O(()=>s.isEdit),_=K({mappingSosId:0,site:"",equipmentModel:"",component:"",compartId:"",startDate:C(new Date),endDate:C(new Date("12/31/9999"))}),h=K({mappingSosId:0,site:"",equipmentModel:"",component:"",compartId:"",startDate:C(new Date),endDate:C(new Date("12/31/9999"))}),R=Ft().shape({site:z().required("Site is mandatory"),equipmentModel:z().required("Equipment Model is mandatory"),component:z().required("Component is mandatory"),compartId:z().required("Compart is mandatory"),startDate:ot().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:ot().required("End Date is mandatory").min(wt("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),B=I=>{h.value={...I}},A=()=>{D(),setTimeout(()=>{h.value=Object.assign({},_.value)},300),s.resetState(),s.setIsEdit(!1)},D=()=>{s.setErrors([])},E=O(()=>s.isError),f=O(()=>s.errors),L=async()=>{s.setIsEdit(!0),D(),await R.validate(h.value,{abortEarly:!1}).catch(I=>{s.setErrors(I.errors),window&&window.scrollTo(0,0)}),!E.value&&tt("Are you sure you want to submit ?").then(async I=>{I.isConfirmed&&(s.setFormData(h.value),s.updateData(p.user.Name).then(()=>{s.isError||dt("Form has been successfully submitted!","Ok").then(()=>{A(),l("fetch-data",null)})}))})},d=async I=>{s.setFormData(I),l("duplicateData",!0)};return(I,i)=>{const T=V("inline-svg"),P=V("el-tooltip"),N=pt("loading");return n(r).loading?X((S(),U("div",me,null,512)),[[N,n(r).loading]]):(S(),U(yt,{key:1},[o(bt,{name:"fade"},{default:c(()=>[E.value&&g.value?(S(),w(Tt,{key:0,errorMessages:f.value,onResetForm:D},null,8,["errorMessages"])):nt("",!0)]),_:1}),X((S(),w(n(Et),{data:e.listData,style:{width:"100%"},onSortChange:b,"empty-text":"No Data"},{default:c(()=>[o(n(F),{label:"No",width:"90",align:"center"},{default:c(v=>[m("span",null,j(u.value+v.$index),1)]),_:1}),o(n(F),{prop:"site",label:"Site","min-width":"170",sortable:"","sort-method":()=>n(J)(y.value)},{default:c(({row:v})=>[v.mappingSosId===h.value.mappingSosId?(S(),w(W,{key:0,value:h.value.site,placeholder:"Add Site",name:"Site",onHandleChange:i[0]||(i[0]=k=>h.value.site=k),options:n(s).siteOption},null,8,["value","options"])):(S(),U("span",ue,j(v.site),1))]),_:1},8,["sort-method"]),o(n(F),{prop:"equipmentModel",label:"Equipment Model","min-width":"170",sortable:"","sort-method":()=>n(J)(y.value)},{default:c(({row:v})=>[v.mappingSosId===h.value.mappingSosId?(S(),w(W,{key:0,value:h.value.equipmentModel,placeholder:"Add Equipment Model",name:"EquipmentModel",onHandleChange:i[1]||(i[1]=k=>h.value.equipmentModel=k),options:n(s).equipmentModelOption},null,8,["value","options"])):(S(),U("span",he,j(v.equipmentModel),1))]),_:1},8,["sort-method"]),o(n(F),{prop:"compartId",label:"Compart","min-width":"170",sortable:"","sort-method":()=>n(J)(y.value)},{default:c(({row:v})=>[v.mappingSosId===h.value.mappingSosId?(S(),w(lt,{key:0,value:h.value.compartId,placeholder:"Add Compart",name:"CompartId",onHandleChange:i[2]||(i[2]=k=>h.value.compartId=k)},null,8,["value"])):(S(),U("span",De,j(v.compartId),1))]),_:1},8,["sort-method"]),o(n(F),{prop:"component",label:"Component","min-width":"190",sortable:"","sort-method":()=>n(J)(y.value)},{default:c(({row:v})=>[v.mappingSosId===h.value.mappingSosId?(S(),w(lt,{key:0,value:h.value.component,placeholder:"Add Component",name:"Component",options:n(s).componentOption,onHandleChange:i[3]||(i[3]=k=>h.value.component=k)},null,8,["value","options"])):(S(),U("span",ge,j(v.component),1))]),_:1},8,["sort-method"]),o(n(F),{prop:"isActive",label:"Is Active",width:h.value.mappingSosId!=0?350:100,sortable:"",align:"center"},{default:c(v=>[v.row.mappingSosId===h.value.mappingSosId?(S(),U("div",fe,[o(st,{value:h.value.startDate,placeholder:"Add Start Date",name:"StartDate",onHandleChange:i[4]||(i[4]=k=>h.value.startDate=k)},null,8,["value"]),ve,o(st,{value:h.value.endDate,placeholder:"Add End Date",name:"EndDate",onHandleChange:i[5]||(i[5]=k=>h.value.endDate=k)},null,8,["value"])])):(S(),U("div",Se,[v.row.isActive?(S(),w(T,{key:0,src:"/media/svg/tables/rows/check.svg"})):(S(),w(T,{key:1,src:"/media/svg/tables/rows/minus.svg"}))]))]),_:1},8,["width"]),o(n(F),{label:"",width:"100"},{default:c(v=>[v.row.mappingSosId!==h.value.mappingSosId?(S(),U("div",_e,[o(P,{class:"box-item",effect:"dark",content:v.row.isActive?"Edit":"Inactive data cannot be edited",placement:"top"},{default:c(()=>[m("div",null,[m("button",{disabled:!v.row.isActive,class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:k=>B(v.row)},[o(T,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Ie)])]),_:2},1032,["content"]),o(P,{class:"box-item",effect:"dark",content:"Add new data based on table rows",placement:"top"},{default:c(()=>[m("div",null,[m("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:k=>d(v.row)},[o(T,{src:"/media/svg/tables/rows/paste-icon-button-blue.svg",width:"12",height:"12"})],8,be)])]),_:2},1024)])):(S(),U("div",ye,[o(P,{class:"box-item",effect:"dark",content:"Save",placement:"top"},{default:c(()=>[m("button",{class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:ft(L,["prevent"])},[o(T,{src:"/media/svg/tables/rows/save.svg",width:"12",height:"12"})])]),_:1}),o(P,{class:"box-item",effect:"dark",content:"Cancel",placement:"top"},{default:c(()=>[m("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:ft(A,["prevent"])},[o(T,{src:"/media/svg/tables/rows/valid-false.svg",width:"12",height:"12"})])]),_:1})]))]),_:1})]),_:1},8,["data"])),[[N,n(r).loading]])],64))}}}),Ce={class:"col-md-6 fv-row fv-plugins-icon-container"},Fe={class:"col-md-6 fv-row fv-plugins-icon-container"},we={class:"dialog-footer"},Te=Q({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:a}){const e=t,p=a,r=ht(),s=q(),l=ct(e,"visibility"),u=O(()=>r.formData),y=O(()=>r.errors),b=O(()=>r.isError),g=Ft().shape({site:z().required("Site is mandatory"),equipmentModel:z().required("Equipment Model is mandatory"),component:z().required("Component is mandatory"),compartId:z().required("Compart is mandatory"),startDate:ot().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:ot().required("End Date is mandatory").min(wt("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),_=(d=!1)=>{L(),r.resetState(),p("handle-close",d)},h=d=>{u.value.site=d},R=d=>{u.value.equipmentModel=d},B=d=>{u.value.component=d},A=d=>{u.value.compartId=d},D=d=>{u.value.startDate=d},E=d=>{u.value.endDate=d},f=async()=>{L(),await g.validate(u.value,{abortEarly:!1}).catch(d=>{r.setErrors(d.errors)}),!b.value&&tt("Are you sure you want to submit ?").then(async d=>{d.isConfirmed&&r.insertData(s.user.Name).then(()=>{r.isError||dt("Form has been successfully submitted!","Ok").then(()=>{_(!0)})})})},L=()=>{r.setErrors([])};return(d,I)=>{const i=V("el-button"),T=V("el-dialog"),P=pt("loading");return X((S(),w(T,{modelValue:l.value,"onUpdate:modelValue":I[0]||(I[0]=N=>l.value=N),title:"New Data",width:"40%",onClose:I[1]||(I[1]=N=>_())},{footer:c(()=>[m("span",we,[o(i,{type:"primary",onClick:f,disabled:n(r).loading},{default:c(()=>[H("Submit")]),_:1},8,["disabled"]),o(i,{type:"secondary",onClick:_,disabled:n(r).loading},{default:c(()=>[H("Close")]),_:1},8,["disabled"])])]),default:c(()=>[o(bt,{name:"fade"},{default:c(()=>[b.value?(S(),w(Tt,{key:0,errorMessages:y.value,onResetForm:L},null,8,["errorMessages"])):nt("",!0)]),_:1}),X((S(),w(n(Zt),{id:"kt_filter_form",class:"row g-9 my-4"},{default:c(()=>[o(W,{value:u.value.site,placeholder:"Add Site",label:"Site",name:"Site",max:25,onHandleChange:h,options:n(r).siteOption},null,8,["value","options"]),o(W,{value:u.value.equipmentModel,placeholder:"Add Equipment Model",label:"Equipment Model",name:"EquipmentModel",max:25,onHandleChange:R,options:n(r).equipmentModelOption},null,8,["value","options"]),o(lt,{value:u.value.compartId,placeholder:"Add Compart",label:"Compart",name:"CompartId",max:25,onHandleChange:A},null,8,["value"]),o(W,{value:u.value.component,placeholder:"Add Component",label:"Component",name:"Component",max:25,onHandleChange:B,options:n(r).componentOption},null,8,["value","options"]),m("div",Ce,[o(st,{value:u.value.startDate,placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:D},null,8,["value"])]),m("div",Fe,[o(st,{value:u.value.endDate,placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:E},null,8,["value"])])]),_:1})),[[P,n(r).loading]])]),_:1},8,["modelValue"])),[[P,n(r).loading]])}}}),Dt=mt({id:"MappingSosBulk",state:()=>({statePagination:new et,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const a={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await x.post(`${ie}?${new URLSearchParams(a).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){e.response.data.statusCode==401&&q().setLoggedIn(!1),$("IRONS",e),console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:a}){const e={userAccount:t,ver:"v1"},p=`${re}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const r=await x.postImages(p,a);r.data.statusCode==200?r.data.result.isError?(this.stateIsError=!0,this.stateError=r.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=r.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=te.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=r.data.result.isError,this.stateError=r.data.result.message)}catch(r){r.response.data.statusCode==401?q().setLoggedIn(!1):(this.stateIsError=!0,this.stateError=r.response.data.result.message),$("IRONS",r)}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(Gt(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new et,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),ke={class:"icon"},Pe=Q({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const a=t,e=K(""),p=Dt(),r=O(()=>(a.page-1)*10+1),s=u=>{e.value=u.order;const y={prop:u.prop,order:u.order};p.setSort(y)},l=(u,y,b)=>Qt(u[b],y[b],e.value);return(u,y)=>{const b=V("inline-svg");return S(),w(n(Et),{data:a.listData,style:{width:"100%"},onSortChange:s,"empty-text":"No Data"},{default:c(()=>[o(n(F),{label:"No",width:"60",align:"center"},{default:c(g=>[m("span",null,j(r.value+g.$index),1)]),_:1}),o(n(F),{prop:"site",label:"Site",width:"300",sortable:"","sort-method":(g,_)=>l(g,_,"site")},null,8,["sort-method"]),o(n(F),{prop:"equipmentModel",label:"Equipment Model",width:"300",sortable:"","sort-method":(g,_)=>l(g,_,"equipmentModel")},null,8,["sort-method"]),o(n(F),{prop:"compartId",label:"Compart",width:"300",sortable:"","sort-method":(g,_)=>l(g,_,"compart")},null,8,["sort-method"]),o(n(F),{prop:"component",label:"Component",width:"300",sortable:"","sort-method":(g,_)=>l(g,_,"component")},null,8,["sort-method"]),o(n(F),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:c(g=>[m("span",null,j(n(vt)(g.row.startDate)),1)]),_:1}),o(n(F),{prop:"EndDate",label:"end Date",align:"center",width:"170",sortable:""},{default:c(g=>[m("span",null,j(n(vt)(g.row.endDate)),1)]),_:1}),o(n(F),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),o(n(F),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:c(g=>[m("div",ke,[o(b,{src:g.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),gt=t=>(Vt("data-v-a78697bb"),t=t(),jt(),t),Me=gt(()=>m("div",{class:"text-center"},null,-1)),qe=gt(()=>m("div",{class:"mb-3"},[m("span",null,[H(" Download template "),m("a",{href:"documents/MasterDataSourceOilDatatoBUMAComponent.xlsx",target:"_blank",id:"link-download"},"here"),H(" before uploading file ")])],-1)),Le=gt(()=>m("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[m("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),Ue={class:"card"},Oe={class:"card-body grid-padding"},Ae={class:"dialog-footer"},xe=Q({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:a}){const e=t,p=a,r=q(),s=Dt(),l=ct(e,"visibility"),u=()=>{const D=ae(s.validatedData,E=>{const f=E;return{mappingSosId:0,site:f.site,equipmentModel:f.equipmentModel,compartId:f.compartId,component:f.component,startDate:f.startDate,endDate:f.endDate}});return Object.values(D)},y=()=>{const D=document.getElementById("link-download");D&&D.click()},b=()=>{s.validatedData.length>0?tt("Cancel Upload Data?","Confirm").then(E=>{E.isConfirmed&&_()}):_()},g=async D=>{await s.upload({userAccount:r.user.Name,excelFile:D}),s.stateError&&Y(s.error)},_=(D=!1)=>{s.resetState(),p("handle-close",D)},h=D=>{s.setIsUploadedState(D)},R=D=>{s.setPage(D)},B=()=>{if(s.validatedData.length<1){y();return}const D=["SITE","EQUIPMENT MODEL","COMPART","COMPONENT","START DATE","END DATE","REMARK","STATUS"],E=s.validatedData.map(f=>({site:f.site,equipmentModel:f.equipmentModel,compart:f.compartId,component:f.component,startDate:f.startDate,endDate:f.endDate,remark:f.validationReason,status:f.isValid?"OK":"Error"}));Rt("SourceOilDatatoBUMAComponent",D,E)},A=async()=>{if(s.displayData.length<1){Y("There is no data to submit");return}if(s.isError){Y("There is still invalid row(s)");return}tt("Are you sure you want to submit ?").then(async D=>{if(D.isConfirmed){const E=u();if(s.setBulkData(E),await s.bulkInsert(r.user.Name),s.isError){Y(s.stateError);return}dt("Form has been successfully submitted!","Ok").then(()=>{_(!0)})}})};return(D,E)=>{const f=V("el-button"),L=V("el-dialog"),d=pt("loading");return S(),w(L,{title:"Upload Bulk Data",modelValue:l.value,"onUpdate:modelValue":E[1]||(E[1]=I=>l.value=I),"before-close":b,width:"70%","custom-class":"upload-modal"},{footer:c(()=>[m("div",null,[m("span",Ae,[o(f,{type:"success",onClick:B},{default:c(()=>[H("Download")]),_:1}),o(f,{type:"primary",onClick:A},{default:c(()=>[H("Upload")]),_:1}),o(f,{type:"success",onClick:b},{default:c(()=>[H("Cancel")]),_:1})])])]),default:c(()=>[Me,qe,X(o(ee,{isSubmissionUploadSuccess:n(s).isUploaded,onHandleCloseUploadedFile:b,onHandleUpload:g,onHandleSetIsExcelFileUploaded:h},null,8,["isSubmissionUploadSuccess"]),[[d,n(s).uploadLoading]]),Le,m("div",Ue,[m("div",Oe,[o(Pe,{"list-data":n(s).displayData,page:n(s).pagination.currentPage},null,8,["list-data","page"])])]),n(s).displayData.length>0?(S(),w(It,{key:0,onRaisePageChange:E[0]||(E[0]=I=>R(I)),currentPage:n(s).pagination.currentPage,totalPage:n(s).pagination.totalPage,totalPageSize:n(s).pagination.totalPageSize,startPaginationIndex:n(s).pagination.startPaginationIndex,endPaginationIndex:n(s).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):nt("",!0)]),_:1},8,["modelValue"])}}}),$e=oe(xe,[["__scopeId","data-v-a78697bb"]]),Re={class:"row g-9 my-4"},Be={class:"dialog-footer"},Ne=Q({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:a}){const e=ut(),p=t,r=a,s=ct(p,"visibility"),l=O(()=>e.filterData),u=()=>{y(),e.resetFilter()},y=()=>{r("handle-close",!1)},b=i=>{e.setSite(i)},g=i=>{e.setSiteTo(i)},_=i=>{e.setEquipmentModel(i)},h=i=>{e.setEquipmentModelTo(i)},R=i=>{e.setComponent(i)},B=i=>{e.setComponentTo(i)},A=i=>{e.setCompartId(i)},D=i=>{e.setCompartIdTo(i)},E=i=>{e.setStartDate(i)},f=i=>{e.setStartDateTo(i)},L=i=>{e.setEndDate(i)},d=i=>{e.setEndDateTo(i)},I=()=>{const i=e.lastUsedFilterData.site!==e.filterData.site,T=e.lastUsedFilterData.siteTo!==e.filterData.siteTo,P=e.lastUsedFilterData.equipmentModel!==e.filterData.equipmentModel,N=e.lastUsedFilterData.equipmentModelTo!==e.filterData.equipmentModelTo,v=e.lastUsedFilterData.component!==e.filterData.component,k=e.lastUsedFilterData.componentTo!==e.filterData.componentTo,kt=e.lastUsedFilterData.compartId!==e.filterData.compartId,Pt=e.lastUsedFilterData.compartIdTo!==e.filterData.compartIdTo,Mt=e.lastUsedFilterData.startDate!==e.filterData.startDate,qt=e.lastUsedFilterData.startDateTo!==e.filterData.startDateTo,Lt=e.lastUsedFilterData.endDate!==e.filterData.endDate,Ut=e.lastUsedFilterData.endDateTo!==e.filterData.endDateTo;r("handle-close",i||T||P||N||v||k||kt||Pt||Mt||qt||Lt||Ut)};return(i,T)=>{const P=V("el-button"),N=V("el-dialog");return S(),w(N,{modelValue:s.value,"onUpdate:modelValue":T[0]||(T[0]=v=>s.value=v),title:"Filter",width:"60%",onClose:T[1]||(T[1]=v=>y())},{footer:c(()=>[m("span",Be,[o(P,{type:"secondary",onClick:u},{default:c(()=>[H("Reset")]),_:1}),o(P,{type:"primary",onClick:I},{default:c(()=>[H("Filter")]),_:1})])]),default:c(()=>[m("div",Re,[o(Z,{"value-from":l.value.site,"value-to":l.value.siteTo,label:"Site",name:"Site",options:n(e).siteOption,onHandleChangeFrom:b,onHandleChangeTo:g},null,8,["value-from","value-to","options"]),o(Z,{"value-from":l.value.equipmentModel,"value-to":l.value.equipmentModelTo,label:"Equipment Model",name:"EquipmentModel",options:n(e).equipmentModelOption,onHandleChangeFrom:_,onHandleChangeTo:h},null,8,["value-from","value-to","options"]),o(Z,{"value-from":l.value.compartId,"value-to":l.value.compartIdTo,label:"Compart",name:"CompartId",options:n(e).compartIdOption,onHandleChangeFrom:A,onHandleChangeTo:D},null,8,["value-from","value-to","options"]),o(Z,{"value-from":l.value.component,"value-to":l.value.componentTo,label:"Component",name:"Component",options:n(e).componentOption,onHandleChangeFrom:R,onHandleChangeTo:B},null,8,["value-from","value-to","options"]),o(St,{"value-from":l.value.startDate?l.value.startDate.toString():"","value-to":l.value.startDateTo?l.value.startDateTo.toString():"",label:"Start Date",name:"StartDate",placeholder:"Pick a date",onHandleChangeFrom:E,onHandleChangeTo:f},null,8,["value-from","value-to"]),o(St,{"value-from":l.value.endDate?l.value.endDate.toString():"","value-to":l.value.endDateTo?l.value.endDateTo.toString():"",label:"End Date",name:"EndDate",placeholder:"Pick a date",onHandleChangeFrom:L,onHandleChangeTo:d},null,8,["value-from","value-to"])])]),_:1},8,["modelValue"])}}}),He={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},Ve=m("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),je={class:"d-flex justify-content-between align-items-center"},ze={class:"card"},Ke={class:"card-body grid-padding"},Ge={class:"my-5"},oo=Q({__name:"Index",setup(t){const a=Ot(),e=ut(),p=ht(),r=Dt(),s=K(!1),l=K(!1),u=K(!1),y=O(()=>e.displayData),b=O(()=>e.pagination),g=d=>{e.setPage(d)};zt(async()=>{a.dispatch(xt.ACTIVE_PAGE,it().meta.parentMenu),At("Source Oil Data to BUMA Component",[{pageName:it().meta.parentMenu,pageRoute:it().meta.parentMenu.toLowerCase()},{pageName:"IronPortal Configuration",pageRoute:"ironlake-config-mappingsos"},{pageName:"Source Oil Data to BUMA Component",pageRoute:"ironlake-config-mappingsos"}]),e.setPage(1),await e.getLookup(),await p.getLookupSite(),await p.getLookupComponent(),await p.getLookupEquipmentModel()}),Kt(async()=>{e.resetState(),p.resetState(),r.resetState()});const _=async()=>{await e.setPage(1),await e.getLookup(),await p.getLookupSite(),await p.getLookupComponent(),await p.getLookupEquipmentModel()},h=()=>{s.value=!0,p.setIsEdit(!1),p.setErrors([]),p.resetState()},R=async d=>{s.value=!1,d&&await _()},B=()=>{l.value=!0},A=async d=>{l.value=!1,d&&await _()},D=async()=>{const d=await e.export();se.saveAs(new Blob([d],{type:"application/octet-stream"}),"SourceOilDatatoBUMAComponent.xlsx")},E=()=>{u.value=!0},f=async d=>{u.value=!1,d&&await _()},L=()=>{s.value=!0,p.setErrors([])};return(d,I)=>(S(),U(yt,null,[m("div",He,[Ve,m("div",je,[o(Bt,{onShowDialog:h}),o($t,{onShowDialog:B}),o(Ht,{onHandleDownload:D}),o(Nt,{onShowDialog:E})])]),m("div",ze,[m("div",Ke,[o(Ee,{"list-data":y.value,page:b.value.currentPage,onFetchData:_,onDuplicateData:L},null,8,["list-data","page"])])]),m("div",Ge,[n(e).paginationLoading?nt("",!0):(S(),w(It,{key:0,onRaisePageChange:I[0]||(I[0]=i=>g(i)),currentPage:b.value.currentPage,totalPage:b.value.totalPage,totalPageSize:b.value.totalPageSize,startPaginationIndex:b.value.startPaginationIndex,endPaginationIndex:b.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),o(Te,{visibility:s.value,onHandleClose:R},null,8,["visibility"]),o(Ne,{visibility:l.value,onHandleClose:A},null,8,["visibility"]),o($e,{visibility:u.value,onHandleClose:f},null,8,["visibility"])],64))}});export{oo as default};
