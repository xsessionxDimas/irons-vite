import{l as A}from"./luxon-C_T8jI2d.js";import{b as j}from"./@popperjs-BaMZbQYT.js";const P={},$=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"})),W=j($);var U={},S={},I={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.RE_RANGE=s.RE_WILDCARDS=s.PRESETS=s.TIME_UNITS_LEN=s.TIME_UNITS=s.TIME_UNITS_MAP=s.ALIASES=s.PARSE_DEFAULTS=s.MONTH_CONSTRAINTS=s.CONSTRAINTS=void 0,s.CONSTRAINTS=Object.freeze({second:[0,59],minute:[0,59],hour:[0,23],dayOfMonth:[1,31],month:[1,12],dayOfWeek:[0,7]}),s.MONTH_CONSTRAINTS=Object.freeze({1:31,2:29,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31}),s.PARSE_DEFAULTS=Object.freeze({second:"0",minute:"*",hour:"*",dayOfMonth:"*",month:"*",dayOfWeek:"*"}),s.ALIASES=Object.freeze({jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}),s.TIME_UNITS_MAP=Object.freeze({SECOND:"second",MINUTE:"minute",HOUR:"hour",DAY_OF_MONTH:"dayOfMonth",MONTH:"month",DAY_OF_WEEK:"dayOfWeek"}),s.TIME_UNITS=Object.freeze(Object.values(s.TIME_UNITS_MAP)),s.TIME_UNITS_LEN=s.TIME_UNITS.length,s.PRESETS=Object.freeze({"@yearly":"0 0 0 1 1 *","@monthly":"0 0 0 1 * *","@weekly":"0 0 0 * * 0","@daily":"0 0 0 * * *","@hourly":"0 0 * * * *","@minutely":"0 * * * * *","@secondly":"* * * * * *","@weekdays":"0 0 0 * * 1-5","@weekends":"0 0 0 * * 0,6"}),s.RE_WILDCARDS=/\*/g,s.RE_RANGE=/^(\d+)(?:-(\d+))?(?:\/(\d+))?$/g})(I);var O={};Object.defineProperty(O,"__esModule",{value:!0});O.ExclusiveParametersError=O.CronError=void 0;class R extends Error{}O.CronError=R;class J extends R{constructor(e,n){super(`You can't specify both ${e} and ${n}`)}}O.ExclusiveParametersError=J;var D={};Object.defineProperty(D,"__esModule",{value:!0});D.getRecordKeys=void 0;const L=s=>Object.keys(s);D.getRecordKeys=L;Object.defineProperty(S,"__esModule",{value:!0});S.CronTime=void 0;const T=A,a=I,d=O,v=D;class x{constructor(e,n,i){if(this.realDate=!1,this.second={},this.minute={},this.hour={},this.dayOfMonth={},this.month={},this.dayOfWeek={},n!=null&&i!=null)throw new d.ExclusiveParametersError("timeZone","utcOffset");if(n){if(!T.DateTime.fromObject({},{zone:n}).isValid)throw new d.CronError("Invalid timezone.");this.timeZone=n}i!=null&&(this.utcOffset=i),e instanceof Date||e instanceof T.DateTime?(this.source=e instanceof Date?T.DateTime.fromJSDate(e):e,this.realDate=!0):(this.source=e,this._parse(this.source),this._verifyParse())}_getWeekDay(e){return e.weekday===7?0:e.weekday}_verifyParse(){const e=(0,v.getRecordKeys)(this.month),n=(0,v.getRecordKeys)(this.dayOfMonth);let i=!1,t=null;for(const o of e){const u=a.MONTH_CONSTRAINTS[o];for(const r of n)r<=u&&(i=!0);i||(t=o,console.warn(`Month '${o}' is limited to '${u}' days.`))}if(!i&&t!==null){const o=a.MONTH_CONSTRAINTS[t];for(const u of n)if(u>o){delete this.dayOfMonth[u];const r=u%o;this.dayOfMonth[r]=!0}}}sendAt(e){let n=this.realDate&&this.source instanceof T.DateTime?this.source:T.DateTime.local();if(this.timeZone&&(n=n.setZone(this.timeZone)),this.utcOffset!==void 0){const i=this.utcOffset<0?"-":"+",t=Math.trunc(this.utcOffset/60),o=String(Math.abs(t)).padStart(2,"0"),u=Math.abs(this.utcOffset-t*60),r=String(u).padStart(2,"0"),c=`UTC${i}${o}:${r}`;if(n=n.setZone(c),!n.isValid)throw new d.CronError("ERROR: You specified an invalid UTC offset.")}if(this.realDate){if(T.DateTime.local()>n)throw new d.CronError("WARNING: Date in past. Will never be fired.");return n}if(e===void 0||isNaN(e)||e<0)return this.getNextDateFrom(n);{const i=[];for(;e>0;e--)n=this.getNextDateFrom(n),i.push(n);return i}}getTimeout(){return Math.max(-1,this.sendAt().toMillis()-T.DateTime.local().toMillis())}toString(){return this.toJSON().join(" ")}toJSON(){return a.TIME_UNITS.map(e=>this._wcOrAll(e))}getNextDateFrom(e,n){var i;e instanceof Date&&(e=T.DateTime.fromJSDate(e));let t=e;const o=e.toMillis();if(n&&(t=t.setZone(n)),this.realDate||t.millisecond>0&&(t=t.set({millisecond:0,second:t.second+1})),!t.isValid)throw new d.CronError("ERROR: You specified an invalid date.");const u=T.DateTime.now().plus({years:8});for(;;){const r=t.toMillis()-e.toMillis();if(t>u)throw new d.CronError(`Something went wrong. No execution date was found in the next 8 years.
							Please provide the following string if you would like to help debug:
							Time Zone: ${(i=n==null?void 0:n.toString())!==null&&i!==void 0?i:'""'} - Cron String: ${this.source.toString()} - UTC offset: ${t.offset} - current Date: ${T.DateTime.local().toString()}`);if(!(t.month in this.month)&&Object.keys(this.month).length!==12){if(t=t.plus({months:1}),t=t.set({day:1,hour:0,minute:0,second:0}),this._forwardDSTJump(0,0,t)){const[c,l]=this._findPreviousDSTJump(t);if(t=l,c)break}continue}if(!(t.day in this.dayOfMonth)&&Object.keys(this.dayOfMonth).length!==31&&!(this._getWeekDay(t)in this.dayOfWeek&&Object.keys(this.dayOfWeek).length!==7)){if(t=t.plus({days:1}),t=t.set({hour:0,minute:0,second:0}),this._forwardDSTJump(0,0,t)){const[c,l]=this._findPreviousDSTJump(t);if(t=l,c)break}continue}if(!(this._getWeekDay(t)in this.dayOfWeek)&&Object.keys(this.dayOfWeek).length!==7&&!(t.day in this.dayOfMonth&&Object.keys(this.dayOfMonth).length!==31)){if(t=t.plus({days:1}),t=t.set({hour:0,minute:0,second:0}),this._forwardDSTJump(0,0,t)){const[c,l]=this._findPreviousDSTJump(t);if(t=l,c)break}continue}if(!(t.hour in this.hour)&&Object.keys(this.hour).length!==24){const c=t.hour===23&&r>864e5?0:t.hour+1,l=t.minute;if(t=t.set({hour:c}),t=t.set({minute:0,second:0}),this._forwardDSTJump(c,l,t)){const[f,h]=this._findPreviousDSTJump(t);if(t=h,f)break}continue}if(!(t.minute in this.minute)&&Object.keys(this.minute).length!==60){const c=t.minute===59&&r>36e5?0:t.minute+1,l=t.hour+(c===60?1:0);if(t=t.set({minute:c}),t=t.set({second:0}),this._forwardDSTJump(l,c,t)){const[f,h]=this._findPreviousDSTJump(t);if(t=h,f)break}continue}if(!(t.second in this.second)&&Object.keys(this.second).length!==60){const c=t.second===59&&r>6e4?0:t.second+1,l=t.minute+(c===60?1:0),f=t.hour+(l===60?1:0);if(t=t.set({second:c}),this._forwardDSTJump(f,l,t)){const[h,w]=this._findPreviousDSTJump(t);if(t=w,h)break}continue}if(t.toMillis()===o){const c=t.second+1,l=t.minute+(c===60?1:0),f=t.hour+(l===60?1:0);if(t=t.set({second:c}),this._forwardDSTJump(f,l,t)){const[h,w]=this._findPreviousDSTJump(t);if(t=w,h)break}continue}break}return t}_findPreviousDSTJump(e){var n;let i,t,o,u,r=e;const c=60*24;let l=0;do{if(++l>c)throw new d.CronError(`ERROR: This DST checking related function assumes the input DateTime (${(n=e.toISO())!==null&&n!==void 0?n:e.toMillis()}) is within 24 hours of a DST jump.`);i=r.minute-1,t=r.hour,i<0&&(i+=60,t=(t+24-1)%24),r=r.minus({minute:1}),o=r.minute,u=r.hour}while(i===o&&t===u);const f=r.plus({minute:1}).set({second:0,millisecond:0}),h=f.minus({second:1});return e.month+1 in this.month&&e.day in this.dayOfMonth&&this._getWeekDay(e)in this.dayOfWeek?[this._checkTimeInSkippedRange(h,f),f]:[!1,f]}_checkTimeInSkippedRange(e,n){const i=(e.minute+1)%60,t=(e.hour+(i===0?1:0))%24,o=n.hour-t+1,u=i===0&&n.minute===0;return o===2&&u?t in this.hour:o===1?t in this.hour&&this._checkTimeInSkippedRangeSingleHour(i,n.minute):this._checkTimeInSkippedRangeMultiHour(t,i,n.hour,n.minute)}_checkTimeInSkippedRangeSingleHour(e,n){for(let i=e;i<n;++i)if(i in this.minute)return!0;return n in this.minute&&0 in this.second}_checkTimeInSkippedRangeMultiHour(e,n,i,t){if(e>=i)throw new d.CronError(`ERROR: This DST checking related function assumes the forward jump starting hour (${e}) is less than the end hour (${i})`);const o=Array.from({length:60-n},(l,f)=>n+f),u=Array.from({length:t},(l,f)=>f),r=Array.from({length:60},(l,f)=>f),c=l=>l===e?o:l===i?u:r;for(let l=e;l<=i;++l){if(!(l in this.hour))continue;const f=c(l);for(const h of f)if(h in this.minute)return!0}return i in this.hour&&t in this.minute&&0 in this.second}_forwardDSTJump(e,n,i){const t=i.hour,o=i.minute,u=e%24<t,r=n%60<o;return u||r}_wcOrAll(e){if(this._hasAll(e))return"*";const n=[];for(const i in this[e])n.push(i);return n.join(",")}_hasAll(e){const n=a.CONSTRAINTS[e],i=n[0],t=e===a.TIME_UNITS_MAP.DAY_OF_WEEK?n[1]-1:n[1];for(let o=i,u=t;o<u;o++)if(!(o in this[e]))return!1;return!0}_parse(e){var n;e=e.toLowerCase(),Object.keys(a.PRESETS).includes(e)&&(e=a.PRESETS[e]),e=e.replace(/[a-z]{1,3}/gi,o=>{if(Object.keys(a.ALIASES).includes(o))return a.ALIASES[o].toString();throw new d.CronError(`Unknown alias: ${o}`)});const i=e.trim().split(/\s+/);if(i.length<a.TIME_UNITS_LEN-1)throw new d.CronError("Too few fields");if(i.length>a.TIME_UNITS_LEN)throw new d.CronError("Too many fields");const t=i.length;for(const o of a.TIME_UNITS){const u=a.TIME_UNITS.indexOf(o),r=(n=i[u-(a.TIME_UNITS_LEN-t)])!==null&&n!==void 0?n:a.PARSE_DEFAULTS[o];this._parseField(r,o)}}_parseField(e,n){const i=this[n];let t;const o=a.CONSTRAINTS[n],u=o[0],r=o[1];e.split(",").forEach(f=>{const h=f.indexOf("*");if(h!==-1&&h!==0)throw new d.CronError(`Field (${f}) has an invalid wildcard expression`)}),e=e.replace(a.RE_WILDCARDS,`${u}-${r}`);const l=e.split(",");for(const f of l){const h=[...f.matchAll(a.RE_RANGE)][0];if((h==null?void 0:h[1])!==void 0){const[,w,k,g]=h;let _=parseInt(w,10),m=k!==void 0?parseInt(k,10):void 0;const N=g!==void 0,p=parseInt(g??"1",10);if(p===0)throw new d.CronError(`Field (${n}) has a step of zero`);if(m!==void 0&&_>m)throw new d.CronError(`Field (${n}) has an invalid range`);if(_<u||m!==void 0&&m>r||m===void 0&&_>r)throw new d.CronError(`Field value (${e}) is out of range`);_=Math.min(Math.max(u,~~Math.abs(_)),r),m!==void 0?m=Math.min(r,~~Math.abs(m)):m=N?r:_,t=_;do i[t]=!0,t+=p;while(t<=m);n==="dayOfWeek"&&(!i[0]&&i[7]&&(i[0]=i[7]),delete i[7])}else throw new d.CronError(`Field (${n}) cannot be parsed`)}}}S.CronTime=x;var M={};Object.defineProperty(M,"__esModule",{value:!0});M.CronJob=void 0;const C=W,b=O,y=S;class E{constructor(e,n,i,t,o,u,r,c,l){if(this.running=!1,this.unrefTimeout=!1,this.lastExecution=null,this.runOnce=!1,this._callbacks=[],this.context=u??this,o!=null&&c!=null)throw new b.ExclusiveParametersError("timeZone","utcOffset");o!=null?this.cronTime=new y.CronTime(e,o,null):c!=null?this.cronTime=new y.CronTime(e,null,c):this.cronTime=new y.CronTime(e,o,c),l!=null&&(this.unrefTimeout=l),i!=null&&(this.onComplete=this._fnWrap(i)),this.cronTime.realDate&&(this.runOnce=!0),this.addCallback(this._fnWrap(n)),r&&(this.lastExecution=new Date,this.fireOnTick()),t&&this.start()}static from(e){if(e.timeZone!=null&&e.utcOffset!=null)throw new b.ExclusiveParametersError("timeZone","utcOffset");return e.timeZone!=null?new E(e.cronTime,e.onTick,e.onComplete,e.start,e.timeZone,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout):e.utcOffset!=null?new E(e.cronTime,e.onTick,e.onComplete,e.start,null,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout):new E(e.cronTime,e.onTick,e.onComplete,e.start,e.timeZone,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout)}_fnWrap(e){var n,i;switch(typeof e){case"function":return e;case"string":{const[t,...o]=e.split(" ");return C.spawn.bind(void 0,t??e,o,{})}case"object":return C.spawn.bind(void 0,e.command,(n=e.args)!==null&&n!==void 0?n:[],(i=e.options)!==null&&i!==void 0?i:{})}}addCallback(e){typeof e=="function"&&this._callbacks.push(e)}setTime(e){if(!(e instanceof y.CronTime))throw new b.CronError("time must be an instance of CronTime.");const n=this.running;this.stop(),this.cronTime=e,e.realDate&&(this.runOnce=!0),n&&this.start()}nextDate(){return this.cronTime.sendAt()}fireOnTick(){for(const e of this._callbacks)e.call(this.context,this.onComplete)}nextDates(e){return this.cronTime.sendAt(e??0)}start(){if(this.running)return;const e=2147483647;let n=this.cronTime.getTimeout(),i=0,t;const o=r=>{t=Date.now(),this._timeout=setTimeout(u,r),this.unrefTimeout&&typeof this._timeout.unref=="function"&&this._timeout.unref()},u=()=>{const r=t+n-Date.now();if(r>0){let c=this.cronTime.getTimeout();c>r&&(c=r),i+=c}i?(i>e?(i-=e,n=e):(n=i,i=0),o(n)):(this.lastExecution=new Date,this.running=!1,this.runOnce||this.start(),this.fireOnTick())};n>=0?(this.running=!0,n>e&&(i=n-e,n=e),o(n)):this.stop()}lastDate(){return this.lastExecution}stop(){this._timeout&&clearTimeout(this._timeout),this.running=!1,typeof this.onComplete=="function"&&this.onComplete.call(this.context)}}M.CronJob=E;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.timeout=s.sendAt=s.CronTime=s.CronJob=void 0;const e=S;var n=M;Object.defineProperty(s,"CronJob",{enumerable:!0,get:function(){return n.CronJob}});var i=S;Object.defineProperty(s,"CronTime",{enumerable:!0,get:function(){return i.CronTime}});const t=u=>new e.CronTime(u).sendAt();s.sendAt=t;const o=u=>new e.CronTime(u).getTimeout();s.timeout=o})(U);export{U as d,W as r};
