import{n as K}from"./navigator-D5io2Cca.js";import{u as fe}from"./@vueuse-DFoNmIyu.js";import{b as R,a as ye,g as ge}from"./index-BuVmIl8K.js";import{b as be,a as De}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{i as u}from"./internet-connection-CnLQPjRt.js";import{k as Y,r as D,c,a7 as Q,p as g,aa as M,F as he,$ as Ce,aB as H,C as G,A as E,b4 as Oe,L as Ie,d as J,y as ke,q as L,s as k,Y as Me}from"./@vue-BypzYtbH.js";import{_ as we}from"./nw-img-vue-CR837WER.js";import{_ as Ae}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{_ as z,a as W}from"./OfflineWorkOrderDialog.vue_vue_type_style_index_0_lang-Cz-mBkE7.js";import{_ as xe}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{u as Fe,a as _e}from"./useDefectsFormStore-41UTMhiG.js";import{u as Ee}from"./useDailyScheduleStore-B3ZQzhxq.js";import{u as Ne}from"./useComponentInterventionStore-Cc_xw-uu.js";import{u as Be}from"./useComponentInterventionEformStore-CMy33xkJ.js";import{b as $e,u as Pe,a as Te}from"./useEFormStore-DtkLPope.js";import{u as He}from"./useMasterStore-CzSO06fn.js";import{u as Le}from"./useGlobalConnectionStore-DV9B81de.js";import{u as We,a as qe}from"./useInterimEngineStore-Ctq4w8Oq.js";import{u as Ve}from"./useSosStore-DEF7qS5a.js";import{a as q}from"./element-plus-BeWdvTRa.js";import{e as je}from"./lodash-DrHMlsdo.js";import"./vue-router-iNp9kJ0K.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./urls-RITu66bD.js";import"./urls-CvqtYZA-.js";import"./number-format-BdMuQVyW.js";import"./urls-hWHEBXep.js";import"./authentication-handler-Pueb_EI7.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./SelectSearch-CnaDUnr3.js";import"./helpers-wUOLw-dU.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-CPQ2HRXU.js";import"./prev-val-handler-DvA3D_kF.js";import"./urls-B0Rq9QQ3.js";import"./urls-D8F5Tyyp.js";import"./useCameraStore-BwXVJhPe.js";import"./useAttachmentStore-DqM3autD.js";import"./list-pcxkCnQg.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./CrackYesClass-COntz77m.js";import"./IronformConfig-BWypCgSI.js";import"./disabled-state-O9W-ZY8y.js";import"./urls-COjrEEs1.js";const Ue={class:"row px-5 mt-5"},Ge=["onClick"],Je=["src","alt"],ze={class:"mt-5",style:{"font-weight":"600"}},Ke={key:0,class:"outstanding-notif"},Re=Y({__name:"HomeIconButton",props:{data:{required:!0,type:Array}},emits:["submitEForm","triggerCamera"],setup(N,{emit:v}){const f=N,a=v;fe();const r=R(),n=be(),{redirectByName:d}=K(),w=D(0),B=c(()=>f.data.map(i=>{if(u())return!(i.MenuName=="Digital Service Forms"||i.MenuName=="Component Intervention Forms"||i.MenuName=="Offline Sync Monitoring")})),m=c(()=>r.outstandingBadge);Q(async()=>{w.value=await n.getPendingWOCount()});const p=i=>{var l;return i==171?w.value:((l=m.value.find(o=>o.menuId==i))==null?void 0:l.outstanding)??0},$=i=>i==="e-Form"?"Digital Service Forms":i==="Approval"?"Digital Service Approvals":i,S=(i,l="")=>{var y;const o=i.split("/")[2].replaceAll(" ","").replaceAll("-","").toLowerCase(),O=["componentinterventionforms","eformoffline","eformv2","pendingtaskmonitor"];if(u()&&!O.includes(o))return;["componentinterventionforms","eform","eformoffline","eformv2","interimengineservice"].includes(o)||o=="sosprintlabel"?a("submitEForm",o):(l.includes("Guide")?(y=window.open(i,"_blank"))==null||y.focus():d(o),a("triggerCamera"))};return(i,l)=>(g(),M("div",Ue,[(g(!0),M(he,null,Ce(N.data,(o,O)=>(g(),M("div",{class:"d-flex flex-column col-sm-4 col-md-3 col-lg-2",key:o.Path,style:{cursor:"pointer"}},[H("div",{onClick:h=>S(o.Path,o.MenuName),class:Oe([[B.value[O]?"menu-button-disabled":""],"home-icon border border-1 rounded rounded-3 p-5 pr-1 mb-5 h-100 position-relative"]),style:{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"}},[H("img",{src:o.Icon?`/media/logos/bumaau/${o.Icon.toLowerCase()}`:"",class:"w-24px h-24px",style:{height:"43px"},alt:o.MenuName},null,8,Je),H("div",ze,G($(o.MenuName)),1),p(o.MenuId)>0?(g(),M("div",Ke,G(p(o.MenuId)),1)):E("",!0)],10,Ge)]))),128))]))}}),Ye=we(Re,[["__scopeId","data-v-bf951fa0"]]),Oo=Y({__name:"Home",setup(N){const v=R(),f=Fe(),a=$e(),r=Ee(),n=Pe(),d=Ne(),w=_e(),B=Te(),m=He(),p=Le(),$=Be(),S=De(),i=We(),l=Ve(),o=ye(),O=qe(),h=D(!1),y=D(!1),I=D(!1),A=D(!1),x=D(!1),F=D(!1),{redirectByName:C}=K(),X=c(()=>p.stateSubmitConnectionError),Z=c(()=>r.DailyScheduleOptions),ee=c(()=>{const e=je.cloneDeep(n.DailyScheduleOptions);return n.DailyScheduleOptions.filter(t=>e.some(s=>s.value===t.value)).slice().sort((t,s)=>{let b;return setTimeout(()=>{const _=e.findIndex(T=>T.value===t.value),P=e.findIndex(T=>T.value===s.value);b=_-P},15),b})}),V=c(()=>u()?!0:v.stateIsDMAMenuSet),te=c(()=>S.WorkOrder.map(e=>{var t,s;return{label:`<span class="break-word">${e.equipment} - ${e.equipmentDesc} - <span class="${((t=e.sampleStatus)==null?void 0:t.toLowerCase())=="caution"?"yellow":((s=e.sampleStatus)==null?void 0:s.toLowerCase())=="normal"?"green":"red"}">${e.sampleStatus} Intervention</span> - ${e.componentSystem} - ${e.sapWorkOrder}</span>`,value:e.id,icon:e.status=="Updated"?"Updated":"",labelPlain:`${e.equipment} - ${e.equipmentDesc} - ${e.sampleStatus} Intervention - ${e.sapWorkOrder}`,status:e.interventionExecution,progress:e.progress}})),oe=c(()=>r.DailyScheduleInterimOptions),ne=c(()=>l.SosHistoryOptions),re=c(()=>v.menuDMA),ie=e=>{const t=n.stateDailyScheduleOptions.length==0;switch(e){case"eform":u()||(h.value=!0);break;case"eformoffline":case"eformv2":u()&&t&&n.getDailyScheduleFromLocalDB(),y.value=!0;break;case"componentinterventionforms":I.value=!0;break;case"interimengineservice":x.value=!0;break;case"sosprintlabel":se();break}},se=async()=>{if(l.SosHistory.length==0){const e=q.service({lock:!0,text:"Loading SOS History",background:"rgba(0, 0, 0, 0.7)"});l.getSosHistory(o.user.SiteId),e.close()}A.value=!0},ae=async e=>{l.setSelectedSos(e),C("sosprintlabel")},le=async e=>{if(e.icon=="Updated"&&e.status!="Submitted-IronPortal"&&e.status!="Open"&&e.status!="Revised")return;if(!p.stateConnectionStatus){p.setSubmitConnectionError(!0);return}const t=S.WorkOrder.find(b=>b.id==e.value),s=q.service({lock:!0,text:"Please wait, we are downloading Component Intervention Form data to local device.",background:"rgba(0, 0, 0, 0.7)"});await S.handleSetInterventionAccessibleOffline(t),s.close()},ue=async e=>{if(e.icon=="Updated")return;if(!p.stateConnectionStatus){p.setSubmitConnectionError(!0);return}const t=n.stateDailySchedules.find(b=>b.id==e.value),s=q.service({lock:!0,text:"Please wait, we are downloading service sheet data to local device.",background:"rgba(0, 0, 0, 0.7)"});await n.handleServiceFormAccessibleOffline(t),s.close()},ce=()=>{p.setSubmitConnectionError(!1)},j=e=>{const t=e.label,s=t.split(" - ")[1],_=t.split(" - ")[2].match(/\d+/),P=_?_[0]:"";localStorage.setItem("currentModel",JSON.stringify({model:s,psType:P}))},de=async e=>{if(n.setSelectedDailySchedule(e.value),u()&&await n.getServiceSheetDetailFromLocalDB(n.SelectedDailySchedule.workOrder)==null){F.value=!0;return}n.setSelectedDailySchedule(e.value),B.setSMUActual(Number(n.SelectedDailySchedule.smuDue)),a.setModelAndPsTypeId(n.SelectedDailySchedule.equipmentModel,n.SelectedDailySchedule.psType,n.SelectedDailySchedule.workOrder,n.SelectedDailySchedule.equipmentModelName,n.SelectedDailySchedule.unitNumber),j(e),C("eformoffline")},me=async e=>{r.setSelectedDailySchedule(e.value),w.setSMUActual(Number(r.SelectedDailySchedule.smuDue)),f.setModelAndPsTypeId(r.SelectedDailySchedule.equipmentModel,r.SelectedDailySchedule.psType,r.SelectedDailySchedule.workOrder,r.SelectedDailySchedule.equipmentModelName,r.SelectedDailySchedule.unitNumber),j(e),C("eform")},pe=async e=>{d.setSelectedComponentIntervention(e.value),$.setComponentInterventionHeader(d.SelectedComponentIntervention.id,d.SelectedComponentIntervention.equipment,d.SelectedComponentIntervention.sapWorkOrder,d.SelectedComponentIntervention.equipmentDesc,d.SelectedComponentIntervention.sampleStatus,d.SelectedComponentIntervention.componentDescription),S.setSelectedWorkOrder(e.value),S.setSelectedShortWorkOrder(e.label),u()?await S.getWorkOrderDetailFromDB(e.value)!=null?C("componentinterventionforms"):F.value=!0:C("componentinterventionforms")},Se=async e=>{r.setSelectedDailyScheduleInterim(e.value),O.setSMUActual(Number(r.SelectedDailyScheduleInterim.smuDue)),i.setModelAndPsTypeId(r.SelectedDailyScheduleInterim.equipmentModel,r.SelectedDailyScheduleInterim.psType,r.SelectedDailyScheduleInterim.workOrder,r.SelectedDailyScheduleInterim.equipmentModelName,r.SelectedDailyScheduleInterim.unitNumber),C("interimengineservice")};Ie(()=>{}),Q(async()=>{ge.setAuthenticatedUserContext(o.user.Email),f.clearStoredBrakeTypeValue(),f.setFromHomePage(!0),f.updateStoredDisableKeyValue([]),f.pushDataToSuspensionCylinderStoredValue([]),f.updateStoredAdjustmentOptionValue(""),a.pushDataToAdjustedSuspensionCylinderStoredValue([]),a.clearStoredBrakeTypeValue(),a.setFromHomePage(!0),a.updateStoredDisableKeyValue([]),a.pushDataToSuspensionCylinderStoredValue([]),a.updateStoredAdjustmentOptionValue(""),a.pushDataToAdjustedSuspensionCylinderStoredValue([]),u()?(n.getDailyScheduleFromLocalDB(),v.setOutstandingBadgeFromDump(),m.getSymptoms(),m.getActions(),m.getCauses(),m.getNAConditions(),m.getCBMMappings(),m.getPositions(),m.getOwnership(),S.getWorkOrdersFromLocal()):ve()});const ve=()=>{},U=async()=>{try{v.getOutstandingMenuDMA(o.user.EmployeeId)}catch(e){console.log(e)}};return J(()=>o.user.SiteId,e=>{e&&(e&&v.isMenuDMASet&&U(),u()?n.getDailyScheduleFromLocalDB():(r.getDailySchedules(o.user.SiteId),r.getDailySchedulesInterim(o.user.SiteId),n.getDailySchedules(o.user.SiteId),n.getHmOffset(o.user.SiteId)))}),J(()=>v.isMenuDMASet,e=>{e&&o.user.SiteId&&(u()||U())}),(e,t)=>{const s=Me("loading");return ke((g(),M("div",null,[V.value?(g(),L(Ye,{key:0,data:re.value,onSubmitEForm:ie},null,8,["data"])):E("",!0),y.value?(g(),L(z,{key:1,title:"Commence Digital Service",placeholder:"Outstanding Services",visibility:y.value,data:ee.value,onOnSubmit:de,onOnDownload:ue,onOnClose:t[0]||(t[0]=()=>{y.value=!y.value})},null,8,["visibility","data"])):E("",!0),k(W,{title:"Commence Digital Service",placeholder:"Outstanding Services",visibility:h.value,data:Z.value,onOnSubmit:me,onOnClose:t[1]||(t[1]=()=>{h.value=!h.value})},null,8,["visibility","data"]),I.value?(g(),L(z,{key:2,title:"Commence Digital Component Intervention",placeholder:"Outstanding Component Intervention",visibility:I.value,data:te.value,onOnSubmit:pe,onOnDownload:le,onOnClose:t[2]||(t[2]=()=>{I.value=!I.value})},null,8,["visibility","data"])):E("",!0),k(W,{title:"Interim Engine Service",placeholder:"Outstanding Interim Engine Service",visibility:x.value,data:oe.value,onOnSubmit:Se,onOnClose:t[3]||(t[3]=()=>{x.value=!x.value})},null,8,["visibility","data"]),k(Ae,{show:X.value,onClose:ce,"title-pop-up":"No internet connection"},null,8,["show"]),k(W,{title:"SOS Print Label",placeholder:"Completed Services",visibility:A.value,data:ne.value,onOnSubmit:ae,onOnClose:t[4]||(t[4]=()=>{A.value=!A.value})},null,8,["visibility","data"]),k(xe,{visibility:F.value,caption:"Data is not available in offline mode",onOnClose:t[5]||(t[5]=()=>{F.value=!1})},null,8,["visibility"])])),[[s,!V.value]])}}});export{Oo as default};
