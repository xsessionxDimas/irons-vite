import{C as G}from"./Cameras-vtENZZzD.js";import{u as j}from"./useCameraStore-BwXVJhPe.js";import{D as K,C as W,N as z}from"./DefectSMUPanel-BcV_00Q9.js";import{C as J}from"./CommentPanel-D0ptrEBp.js";import{D as Q}from"./cbm-helper-BxJZ9NTc.js";import{u as X}from"./useInterimDefectsStore-DCjj_hjG.js";import{u as Z}from"./useInterimDefectSheetStore-BXQL839L.js";import{n as ee}from"./navigator-D5io2Cca.js";import{_ as te}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as oe}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{_ as re}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{a as b}from"./element-plus-BeWdvTRa.js";import{B as se}from"./BackNavigator-DUE8rWVW.js";import{u as ae,b as ie}from"./useDefectsFormStore-41UTMhiG.js";import{_ as ne}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as B}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{e as M}from"./lodash-DrHMlsdo.js";import{N as le}from"./NoDefect-DdL3mqty.js";import{u as pe}from"./vue-router-iNp9kJ0K.js";import{_ as me}from"./Toast.vue_vue_type_style_index_0_lang-OOgaHWFE.js";import{v as ce}from"./helpers-wUOLw-dU.js";import{A as ue,N as fe}from"./number-format-BdMuQVyW.js";import{k as de,r as i,c as p,d as ve,a7 as he,o as De,L as Se,p as g,aa as be,aB as y,s,u as n,q as O,A as ge,F as ye}from"./@vue-BypzYtbH.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./index-BuVmIl8K.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./nw-img-vue-CR837WER.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./simple-vue-camera-D9MGhAeE.js";import"./vue-BzYgrL08.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./useInterimEngineStore-Ctq4w8Oq.js";import"./urls-COjrEEs1.js";import"./urls-B0Rq9QQ3.js";import"./prev-val-handler-DvA3D_kF.js";import"./urls-CPQ2HRXU.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./disabled-state-O9W-ZY8y.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./@vueuse-DFoNmIyu.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./IronformConfig-BWypCgSI.js";import"./manipulate-html-string-DqTEGh-F.js";import"./Check-CTArJpdm.js";import"./NAForm-BdrJ0TGj.js";import"./useMasterStore-CzSO06fn.js";import"./SMUDetailDialog-Bs-98WGo.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./Repair-zyV2di4A.js";import"./CrackNoClass-0DSU7BAn.js";import"./urls-CvqtYZA-.js";import"./CrackYesClass-COntz77m.js";import"./DefectNoClass-BqGKOkzR.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";const we={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},Ae=["disabled"],fo=de({__name:"Detail",setup(_e){const t=X(),w=ae(),e=Z(),x=ie(),A=j(),c=pe(),u=i(!1),f=i(!1),d=i(!1),F=p(()=>t.DefectKey),I=p(()=>t.stateErrorByNetwork),{redirectByLink:_}=ee(),v=p(()=>{var o;return((o=e.SelectedDefectSheet)==null?void 0:o.eFormStatus)=="Submited"}),H=p(()=>t.Comments.slice().sort(U)),U=(o,a)=>{const r=parseInt(o.taskDesc.split(";;")[0]),l=parseInt(a.taskDesc.split(";;")[0]);return r-l},R=p(()=>{const o=t.ApprovalData.CBMHeaders.every(l=>l.cbmNAStatus==="Confirmed"),a=ce(t.ApprovalData.DefectNAHeaders);let r=!0;return t.DefectSMUHeader&&(r=t.DefectSMUHeader.status==="Acknowledge"),o&&a&&v.value&&r}),k=p(()=>e.stateSheetAlreadyApproved);ve(()=>k.value,o=>{o&&setTimeout(()=>{e.stateSheetAlreadyApproved=!1,c.push({name:"defects"})},3e3)});const C=async()=>{d.value=!1;const o=b.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(await e.approveDefectSheetBySupervisor(),o.close(),e.IsError){f.value=!0;return}e.reset(),u.value=!0},$=()=>{d.value=!1},V=()=>{u.value=!1,_("/ironforms/defects")},q=()=>{f.value=!1,e.Error!=ue.INCOMPLETE_DATA&&e.Error!=fe.NO_NETWORK_VIEW&&_("/ironforms/defects")},h=i(null),D=i(""),m=i(!1),N=i(!1),P=o=>{N.value=o};he(()=>{(!e.SelectedDefectSheet||M.isEmpty(e.SelectedDefectSheet))&&c.push({name:"defects"})});const T=i(0),E=()=>{T.value=window.scrollY},S=async()=>{const o=b.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await t.getDefectsData(e.SelectedDefectSheet.workOrder),o.close()},Y=()=>{t.toggleErrorByNetwork(!1),c.push({name:"defects"})};De(async()=>{const o=b.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(t.DataFetched===!1){await t.getDefectsData(e.SelectedDefectSheet.workOrder);const a=e.SelectedDefectSheet.equipmentModel.split(" ")[0].split("-");let r=[...new Set(a)].join("-");M.isUndefined(e.SelectedDefectSheet.equipmentModel.split(" ")[1])||(r=`${r} ${e.SelectedDefectSheet.equipmentModel.split(" ")[1]}`),w.setModelAndPsTypeId("",e.SelectedDefectSheet.psType,"",r,""),await w.getEhmsRating(),await x.getOwnershipDefectForm(e.SelectedDefectSheet.unitNumber)}try{Array.from(h.value.getElementsByClassName("show-pdf")).forEach(r=>{r.onclick=l=>{l.preventDefault(),m.value=!0,D.value=r.href}})}catch(a){console.log(a)}try{Array.from(h.value.getElementsByClassName("spv-print-pdf")).forEach(r=>{r.onclick=l=>{l.preventDefault(),m.value=!0,D.value=r.href,P(!0)}})}catch(a){console.log(a)}t.setCurrentUserGroup("Supervisor"),o.close()});const L=()=>{m.value=!1};return Se(()=>{A.reset()}),(o,a)=>{var r;return g(),be(ye,null,[y("div",{ref_key:"defectDetailRef",ref:h},[s(se,{title:`${(r=n(e).SelectedDefectSheet)==null?void 0:r.form}`,"component-router-push":"defects"},null,8,["title"]),s(Q),(g(),O(K,{key:F.value,"view-only":!1,supervisor:!0,onOnRefreshData:S,onOnGetPositionY:E})),s(W,{headers:n(t).ApprovalData.CBMHeaders,"is-disabled":!v.value,onOnRefreshData:S},null,8,["headers","is-disabled"]),s(z,{title:"Not Applicable Item Check",headers:n(t).ApprovalData.DefectNAHeaders,"is-defect":!0,"is-disabled":!v.value,onOnRefreshData:S,onOnGetPositionY:E},null,8,["headers","is-disabled"]),s(J,{headers:H.value},null,8,["headers"]),y("div",we,[n(t).ApprovalData.DefectNAHeaders.length==0&&n(t).ApprovalData.CBMHeaders.length==0&&n(t).DefectSMUHeader==null?(g(),O(le,{key:0,message:"Interim Engine Service sheet was completed in full and no issues were identified."})):ge("",!0),y("button",{class:"btn btn-success",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"},disabled:!R.value,onClick:C},"Approve",8,Ae)])],512),s(G,{visibility:n(A).isVisible},null,8,["visibility"]),s(te,{visibility:d.value,caption:"Please confirm this defect information is correct.",onOnNoConfirm:$,onOnYesConfirm:C},null,8,["visibility"]),s(oe,{show:u.value,onClose:V,message:"Data successfully approved"},null,8,["show"]),s(re,{visibility:f.value,caption:n(e).Error,onOnClose:q},null,8,["visibility","caption"]),s(ne,{show:m.value,onHandleCloseModal:L,"blob-url":D.value},null,8,["show","blob-url"]),s(B,{show:N.value,onClose:P,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),s(me,{visibility:k.value,caption:"You cannot approve this digital service sheet because another user already approved."},null,8,["visibility"]),s(B,{show:I.value,onClose:Y,"title-pop-up":"No internet connection"},null,8,["show"])],64)}}});export{fo as default};
