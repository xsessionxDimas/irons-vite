import{u as St,G as At,C as Me,_ as It,a as Nt,D as Pt,b as Ot,N as $t,c as Bt}from"./useInterventionNAStore-JmmvsR31.js";import{C as Ft}from"./CardPersonnelMonitoring-BNc2-LD9.js";import{C as Rt}from"./Cameras-vtENZZzD.js";import{u as Ne}from"./useCameraStore-BwXVJhPe.js";import{p as Qe,f as Xe,m as xe,r as Ze,b as et,D as Vt}from"./cbm-helper-BxJZ9NTc.js";import{c as tt,V as nt,o as Ce,D as Et,a as Ge,b as Ht,C as We,N as Le}from"./NAPanel-DsLwt-Yx.js";import{k as Pe,r as n,c as y,d as ot,o as Oe,p as u,aa as m,s as a,aB as e,x as Se,u as o,F as se,R as Ae,A as P,$ as $e,C as ce,b4 as q,P as at,bd as rt,bb as st,a7 as Tt,L as jt,q as qe}from"./@vue-BypzYtbH.js";import{_ as lt}from"./Repair-zyV2di4A.js";import{_ as it}from"./document_download-C1p7j0nJ.js";import{_ as ct}from"./ImagePreviews.vue_vue_type_style_index_0_lang-BJGkhvcB.js";import{u as Be}from"./useComponentInterventionDefectsStore-CA75rH_W.js";import{u as Fe}from"./useComponentInterventionDefectSheetStore-H9Ju8hNj.js";import{u as dt}from"./useHistoricalEformDmaStore-Fo4tKNgB.js";import{d as Mt}from"./manipulate-html-string-DqTEGh-F.js";import{c as Ue,a as Gt,d as Wt}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{e as Re}from"./lodash-DrHMlsdo.js";import{b as Ve}from"./useDefectsFormStore-41UTMhiG.js";import{I as ut}from"./DefectForm-eu6l4STx.js";import{_ as Ee}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{p as pt,c as mt,t as Lt}from"./helpers-BS1ZZpAr.js";import{o as ft,h as Ye,g as ke,i as Ke,v as qt}from"./helpers-wUOLw-dU.js";import{_ as vt}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{N as ht,A as Ut}from"./number-format-BdMuQVyW.js";import{_ as Dt}from"./nw-img-vue-CR837WER.js";import{C as Yt}from"./CommentPanel-D0ptrEBp.js";import{V as Kt}from"./ViewOnlyNAReasonDialog-DR-Uz59p.js";import{u as zt}from"./useInterventionDefectStore-CSZwjVeC.js";import{a as Jt}from"./index-BuVmIl8K.js";import{u as Qt}from"./useMasterStore-CzSO06fn.js";import{_ as Xt}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{a as Ie}from"./element-plus-BeWdvTRa.js";import{B as Zt}from"./BackNavigator-DxLlvPLq.js";import{_ as en}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as ze}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{u as tn}from"./useComponentInterventionEformStore-CMy33xkJ.js";import{N as nn}from"./NoDefect-DdL3mqty.js";import{u as on}from"./vue-router-iNp9kJ0K.js";import{u as an}from"./useMonitoringListStore-AIaGTQg8.js";import{s as rn}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{i as sn}from"./date-format-8-IvfSl3.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./@vueuse-DFoNmIyu.js";import"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import"./ReferenceInline.vue_vue_type_script_setup_true_lang-DqEUurUl.js";import"./reference-file-C1vLEEpf.js";import"./internet-connection-CnLQPjRt.js";import"./@azure-DwL0pga8.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./urls-CPQ2HRXU.js";import"./uuid-SoommWqA.js";import"./pdf-DNpyvVEz.js";import"./image-close-button-red-B1UxWyBV.js";import"./PDFViewerDialog.vue_vue_type_style_index_0_lang-DqiQYePb.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./pinia-BjOS2_Ao.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./simple-vue-camera-D9MGhAeE.js";import"./@popperjs-BaMZbQYT.js";import"./vue-BzYgrL08.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./SMUDetailDialog-Bs-98WGo.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./usePositionListStore-BsprGHwA.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./LargeCamera-BnWfLFAm.js";import"./NAForm-BdrJ0TGj.js";import"./manipulate-file-oif_A7gg.js";import"./usePreviewDefectFormStore-CVtftEdK.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-CvqtYZA-.js";import"./useDefectsStore-7BpSnT1n.js";import"./CrackNoClass-0DSU7BAn.js";import"./CrackYesClass-COntz77m.js";import"./prev-val-handler-DvA3D_kF.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./useEFormStore-DtkLPope.js";import"./list-pcxkCnQg.js";import"./urls-B0Rq9QQ3.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./IronformConfig-BWypCgSI.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./disabled-state-O9W-ZY8y.js";import"./Check-CTArJpdm.js";import"./urls-RITu66bD.js";import"./@progress-DBKeVTWA.js";import"./pdf-merger-js-DY3-eECH.js";import"./pdf-lib-DrnT2QV2.js";import"./@pdf-lib-CXIx2D9y.js";import"./pako-Dx2kwFQn.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./object-path-DPahbflh.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./urls-COjrEEs1.js";import"./moment-C5S46NFB.js";const j=g=>(rt("data-v-652abc96"),g=g(),st(),g),ln={class:"mt-5 ps-0"},cn={class:"row px-2 item mx-1 w-100 defect-panel-header"},dn=j(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),un=j(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),pn=j(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},"Priority",-1)),mn=j(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),fn=j(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),vn=j(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),hn={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Dn={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},yn=j(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),gn=[yn],wn={class:"row flex-nowrap px-2 my-2 item mx-1 w-100"},_n={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},bn={class:"col align-items-center d-flex text-break"},kn=["innerHTML"],xn={class:"col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex"},Cn={class:"text-center",style:{"font-weight":"600",color:"white"}},Sn={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},An=["onClick"],In=["onClick"],Nn={key:0,class:"row"},Pn={class:"col-8 col-md-8 d-flex flex-column pe-0"},On=["value","onChange","disabled"],$n={key:0,class:"ms-1 d-flex align-items-center"},Bn=j(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),Fn=j(()=>e("span",null,"Loading...",-1)),Rn=[Bn,Fn],Vn={class:"col-4 col-md-3 ps-0 pe-1"},En=["disabled","onClick"],Hn=j(()=>e("i",{class:"fa fa-save"},null,-1)),Tn=[Hn],jn={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Mn=j(()=>e("img",{src:lt,alt:""},null,-1)),Gn=[Mn],Wn={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Ln=["onClick"],qn={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Un=Pe({__name:"SupervisorDefectPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},plannerApprove:{required:!0,type:Boolean,default:!0},isAdditionalTask:{required:!1,type:Boolean,default:!1},viewIsDownload:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData"],setup(g,{emit:s}){const w=g,Y=s,v=Be(),_=Ne(),B=Fe(),Z=dt(),K=Ve(),M=n(w.isAdditionalTask?"Defect Approval By Supervisor (Additional Task)":"Defect Approval By Supervisor"),F=n(M.value),A=n(!1),ee=n(!1),G=n([]),I=n([]),te=n(""),W=n(""),z=n(""),R=n(!1),J=n(),O=n(""),V=n(!1),N=n(),ne=n(!1),C=(t,c)=>{const k=!!t.declineReason,H=!!c.declineReason;return k<H?-1:k>H?1:0},S=y(()=>{let t=v.ApprovalData.DefectHeaders.filter(c=>!["P3","P4"].includes(c.priority)).sort(C);return w.isAdditionalTask?t.filter(c=>Ue(c.taskDesc)):t.filter(c=>!Ue(c.taskDesc))}),Q=y(()=>v.DataFetched),le=y(()=>{var t;return(t=v.DefectPictures[te.value])==null?void 0:t.map(c=>({fileName:c,url:""}))});ot(Q,t=>{t===!0&&(I.value=[],S.value.forEach(c=>{I.value.push({id:c.id,wo:c.defectWorkorder})}))}),Oe(()=>{Q.value&&(I.value=[],S.value.forEach(t=>{I.value.push({id:t.id,wo:t.defectWorkorder})}))});const oe=t=>t.plannerStatus=="Decline"||t.status=="Decline",de=t=>{_.setCurrent("defect");const c=v.setDefectData(t);W.value=t,z.value=B.SelectedDefectSheet.interventionId,c!="NO"?A.value=!0:ee.value=!0},b=n(!1),ie=()=>{b.value=!0,ne.value=!1,v.stateErrorMessage!=ht.NO_NETWORK_VIEW&&(b.value=!1,v.resetErrorStatus(),fe())},ue=async(t,c)=>{const k=I.value.find(H=>H.id==t);if(k){if(k.wo==="")return;G.value[c]=!0,await v.updateDefectMO(t,k.wo),G.value[c]=!1,v.IsError&&(ne.value=!0)}},ve=t=>{var c;return(c=I.value.find(k=>k.id==t))==null?void 0:c.wo},pe=(t,c)=>{const k=I.value.findIndex(H=>H.id==c);k>=0&&(I.value[k].wo=t.target.value)},ae=t=>{t.preventDefault();const c=t.target,k=ft(c.value).replaceAll(".","");c.value=k},E=()=>{A.value=!1},he=()=>{ee.value=!1},me=()=>{R.value=!1},De=()=>{Z.setIsAttachmentIncludeDownload(!1),re(),d()},ye=()=>{Z.setIsAttachmentIncludeDownload(!0),re(),d()},re=()=>{V.value=!1},r=t=>{V.value=!0,N.value={headerId:t}},d=async()=>{O.value="";const{header:t,detail:c}=v.getDefectData(N.value.headerId),k=Re.cloneDeep(c);k&&t&&(Z.setIsIntervention(!0),pt({header:t,detail:k.detail,serialNumber:K.SerialNumber,approvalData:{approvedBy:t.approvedBy,approvedDate:t.approvedDate},ownership:K.Ownership,unitNumber:B.SelectedDefectSheet.equipment,form:B.DefectTitle})&&(O.value=N.value.headerId,J.value.handleDataFetch()))},h=t=>t?mt(t):!1,$=t=>t=="Acknowledge",i=()=>{v.updateDownloadHistory(O.value)},fe=()=>{Y("onRefreshData")};return(t,c)=>{const k=Ae("el-collapse-item"),H=Ae("el-collapse");return u(),m(se,null,[a(ut,{ref_key:"downloadPdfDefect",ref:J,onOnDownloadFinish:i},null,512),e("div",ln,[a(H,{class:"task-group general-accordion py-1 px-5 testing",modelValue:F.value,"onUpdate:modelValue":c[1]||(c[1]=p=>F.value=p)},{default:Se(()=>[a(k,{title:M.value,name:M.value},{default:Se(()=>[e("div",cn,[dn,un,pn,mn,fn,vn,g.viewIsDownload?(u(),m("div",hn)):P("",!0)]),S.value.length<1?(u(),m("div",Dn,gn)):(u(!0),m(se,{key:1},$e(S.value,(p,_e)=>(u(),m("div",{key:p.id,class:"item px-2 my-2 mx-1 defect-panel-task"},[e("div",wn,[e("div",_n,ce(p.taskNo),1),e("div",bn,[e("span",{class:"text-break defect-identified-task",innerHTML:o(Mt)(p.taskDesc,!0)},null,8,kn)]),e("div",xn,[oe(p)?P("",!0):(u(),m("div",{key:0,class:q(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",o(Qe)(p.priority)]),style:{"margin-top":"6px"}},[e("span",Cn,ce(p.priority),1)],2))]),e("div",Sn,[oe(p)?(u(),m("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:X=>de(p.id)}," Declined ",8,In)):(u(),m("div",{key:0,class:q(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",o(Xe)(p.id,S.value)]),onClick:X=>de(p.id)}," Detailed Information ",10,An))]),e("div",{class:q(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",p.priority===void 0?"invisible":""])},[oe(p)?P("",!0):(u(),m("div",Nn,[e("div",Pn,[e("input",{type:"text",class:"form-control mou-input",value:ve(p.id),onChange:X=>{pe(X,p.id)},autocomplete:"off",onInput:at(ae,["prevent"]),placeholder:"Input Work Order",onKeypress:c[0]||(c[0]=(...X)=>o(Ce)&&o(Ce)(...X)),disabled:o(xe)(p.id,S.value,g.plannerApprove)},null,40,On),G.value[_e]?(u(),m("div",$n,Rn)):P("",!0)]),e("div",Vn,[e("button",{disabled:o(xe)(p.id,S.value,g.plannerApprove),onClick:X=>ue(p.id,_e),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},Tn,8,En)])]))],2),e("div",jn,[oe(p)?P("",!0):(u(),m("div",{key:0,class:q(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[o(Ze)(p),o(et)(p.priority)]]),style:{"margin-top":"6px"}},Gn,2))]),g.viewIsDownload?(u(),m("div",Wn,[$(p.status)?(u(),m("img",{key:0,onClick:X=>r(p.id),class:q(["ms-4 me-2 download-icon",h(p.downloadHistory)?"icon-green":"icon-red"]),src:it,style:{height:"18px"},alt:""},null,10,Ln)):P("",!0)])):P("",!0)]),e("div",qn,ce(p.createdBy.name)+", "+ce(p.updatedDate!=""?p.updatedDate:p.createdDate),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),a(tt,{status:o(v).HeaderStatus,"planner-status":o(v).HeaderPlannerStatus,visibility:A.value,"defect-data":o(v).DefectFormData,"header-id":W.value,"work-order":z.value,"view-only":!0,"approved-by":o(v).ApprovedBy,"approved-date":o(v).ApprovedDate,"planner-approve":g.plannerApprove,"decline-reason":o(v).DeclineReason,onCloseForm:E},null,8,["status","planner-status","visibility","defect-data","header-id","work-order","approved-by","approved-date","planner-approve","decline-reason"]),a(nt,{visibility:ee.value,"is-intervention":!0,"defect-data":o(v).stateDefectNoFormData,onClose:he},null,8,["visibility","defect-data"]),a(ct,{images:le.value,visibility:R.value,onHandleClose:me},null,8,["images","visibility"]),a(Ee,{visibility:V.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:re,onOnNoConfirm:De,onOnYesConfirm:ye},null,8,["visibility"]),a(vt,{visibility:ne.value,caption:o(v).stateErrorMessage,onOnClose:ie},null,8,["visibility","caption"])],64)}}}),Je=Dt(Un,[["__scopeId","data-v-652abc96"]]),U=g=>(rt("data-v-cfab93d6"),g=g(),st(),g),Yn={class:"mt-5 ps-0"},Kn={class:"row px-2 item mx-1 w-100 defect-panel-header"},zn=U(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Jn=U(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},"Priority",-1)),Qn=U(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),Xn=U(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),Zn=U(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),eo={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},to={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},no=U(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),oo=[no],ao={class:"row flex-nowrap px-2 my-2 item mx-1 w-100"},ro={class:"col align-items-center d-flex text-break"},so=["innerHTML"],lo={class:"col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex"},io={class:"text-center",style:{"font-weight":"600",color:"white"}},co={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},uo=["onClick"],po=["onClick"],mo={key:0,class:"row"},fo={class:"col-8 col-md-8 d-flex flex-column pe-0"},vo=["value","onChange","disabled"],ho={key:0,class:"ms-1 d-flex align-items-center"},Do=U(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),yo=U(()=>e("span",null,"Loading...",-1)),go=[Do,yo],wo={class:"col-4 col-md-3 ps-0 pe-1"},_o=["disabled","onClick"],bo=U(()=>e("i",{class:"fa fa-save"},null,-1)),ko=[bo],xo={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Co=U(()=>e("img",{src:lt,alt:""},null,-1)),So=[Co],Ao={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Io=["onClick"],No={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Po=Pe({__name:"SupervisorGenericDefectPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},plannerApprove:{required:!0,type:Boolean,default:!0},viewIsDownload:{required:!1,type:Boolean,default:!1}},setup(g){const s=Be(),w=Ne(),Y=Fe(),v=dt(),_=Ve(),B=n("Generic Defect Identified By Supervisor"),Z=n(B.value),K=n(!1),M=n(!1),F=n([]),A=n([]),ee=n(""),G=n(""),I=n(""),te=n(!1),W=n(),z=n(""),R=n(""),J=n(!1),O=n(),V=(r,d)=>{const h=!!r.declineReason,$=!!d.declineReason;return h<$?-1:h>$?1:0},N=y(()=>s.ApprovalData.DefectGenericHeaders.filter(d=>!["P3","P4"].includes(d.priority)).sort(V)),ne=y(()=>s.DataFetched),C=y(()=>{var r;return(r=s.DefectPictures[ee.value])==null?void 0:r.map(d=>({fileName:d,url:""}))});ot(ne,r=>{r===!0&&(A.value=[],N.value.forEach(d=>{A.value.push({id:d.id,wo:d.defectWorkorder})}))}),Oe(()=>{ne.value&&(A.value=[],N.value.forEach(r=>{A.value.push({id:r.id,wo:r.defectWorkorder})}))});const S=r=>r.plannerStatus=="Decline"||r.status=="Decline",Q=r=>{w.setCurrent("defect");const d=s.setDefectGenericData(r);G.value=r,I.value=Y.SelectedDefectSheet.interventionId,d!="NO"?K.value=!0:M.value=!0},le=async(r,d)=>{const h=A.value.find($=>$.id==r);if(h){if(h.wo==="")return;F.value[d]=!0,await s.updateDefectMO(r,h.wo,!0),F.value[d]=!1}},oe=r=>{var d;return(d=A.value.find(h=>h.id==r))==null?void 0:d.wo},de=(r,d)=>{const h=A.value.findIndex($=>$.id==d);h>=0&&(A.value[h].wo=r.target.value)},b=r=>{r.preventDefault();const d=r.target,h=ft(d.value).replaceAll(".","");d.value=h},ie=()=>{K.value=!1},ue=()=>{M.value=!1},ve=()=>{te.value=!1},pe=()=>{v.setIsAttachmentIncludeDownload(!1),E(),me()},ae=()=>{v.setIsAttachmentIncludeDownload(!0),E(),me()},E=()=>{J.value=!1},he=r=>{J.value=!0,O.value={headerId:r}},me=async()=>{z.value="",R.value="";const{header:r,detail:d}=s.getDefectGenericData(O.value.headerId),h=Re.cloneDeep(d);h&&r&&(v.setIsIntervention(!0),pt({header:r,detail:h.detail,serialNumber:_.SerialNumber,approvalData:{approvedBy:r.approvedBy,approvedDate:r.approvedDate},ownership:_.Ownership,unitNumber:Y.SelectedDefectSheet.equipment,form:Y.DefectTitle})&&(z.value=O.value.headerId,W.value.handleDataFetch()))},De=r=>r?mt(r):!1,ye=r=>r=="Acknowledge",re=()=>{s.updateDownloadHistory(z.value,!0)};return(r,d)=>{const h=Ae("el-collapse-item"),$=Ae("el-collapse");return u(),m(se,null,[a(ut,{ref_key:"downloadPdfDefect",ref:W,onOnDownloadFinish:re},null,512),e("div",Yn,[a($,{class:"task-group general-accordion py-1 px-5 testing",modelValue:Z.value,"onUpdate:modelValue":d[1]||(d[1]=i=>Z.value=i)},{default:Se(()=>[a(h,{title:B.value,name:B.value},{default:Se(()=>[e("div",Kn,[zn,Jn,Qn,Xn,Zn,g.viewIsDownload?(u(),m("div",eo)):P("",!0)]),N.value.length<1?(u(),m("div",to,oo)):(u(!0),m(se,{key:1},$e(N.value,(i,fe)=>(u(),m("div",{key:i.id,class:"item px-2 my-2 mx-1 defect-panel-task"},[e("div",ao,[e("div",ro,[e("span",{class:"text-break",innerHTML:i.taskDesc},null,8,so)]),e("div",lo,[S(i)?P("",!0):(u(),m("div",{key:0,class:q(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",o(Qe)(i.priority)]),style:{"margin-top":"6px"}},[e("span",io,ce(i.priority),1)],2))]),e("div",co,[S(i)?(u(),m("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:t=>Q(i.id)}," Declined ",8,po)):(u(),m("div",{key:0,class:q(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",o(Xe)(i.id,N.value)]),onClick:t=>Q(i.id)}," Detailed Information ",10,uo))]),e("div",{class:q(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",i.priority===void 0?"invisible":""])},[S(i)?P("",!0):(u(),m("div",mo,[e("div",fo,[e("input",{type:"text",class:"form-control mou-input",value:oe(i.id),onChange:t=>{de(t,i.id)},autocomplete:"off",onInput:at(b,["prevent"]),placeholder:"Input Work Order",onKeypress:d[0]||(d[0]=(...t)=>o(Ce)&&o(Ce)(...t)),disabled:o(xe)(i.id,N.value,g.plannerApprove)},null,40,vo),F.value[fe]?(u(),m("div",ho,go)):P("",!0)]),e("div",wo,[e("button",{disabled:o(xe)(i.id,N.value,g.plannerApprove),onClick:t=>le(i.id,fe),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},ko,8,_o)])]))],2),e("div",xo,[S(i)?P("",!0):(u(),m("div",{key:0,class:q(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[o(Ze)(i),o(et)(i.priority)]]),style:{"margin-top":"6px"}},So,2))]),g.viewIsDownload?(u(),m("div",Ao,[ye(i.status)?(u(),m("img",{key:0,onClick:t=>he(i.id),class:q(["ms-4 me-2 download-icon",De(i.downloadHistory)?"icon-green":"icon-red"]),src:it,style:{height:"18px"},alt:""},null,10,Io)):P("",!0)])):P("",!0)]),e("div",No,ce(i.createdBy.name)+", "+ce(i.updatedDate!=""?i.updatedDate:i.createdDate),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),a(tt,{status:o(s).HeaderStatus,"planner-status":o(s).HeaderPlannerStatus,visibility:K.value,"defect-data":o(s).DefectFormData,"header-id":G.value,"work-order":I.value,"view-only":!0,"approved-by":o(s).ApprovedBy,"approved-date":o(s).ApprovedDate,"planner-approve":g.plannerApprove,"decline-reason":o(s).DeclineReason,generic:!0,onCloseForm:ie},null,8,["status","planner-status","visibility","defect-data","header-id","work-order","approved-by","approved-date","planner-approve","decline-reason"]),a(nt,{generic:!0,visibility:M.value,"defect-data":o(s).stateDefectNoFormData,onClose:ue},null,8,["visibility","defect-data"]),a(ct,{images:C.value,visibility:te.value,onHandleClose:ve},null,8,["images","visibility"]),a(Ee,{visibility:J.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:E,onOnNoConfirm:pe,onOnYesConfirm:ae},null,8,["visibility"])],64)}}}),Oo=Dt(Po,[["__scopeId","data-v-cfab93d6"]]),$o={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},Bo=["disabled"],os=Pe({__name:"Detail",setup(g){const s=Be(),w=Fe(),Y=tn(),v=Gt(),_=Wt(),B=zt(),Z=St(),K=an(),M=Ne(),F=on(),A=Ve(),ee=Jt(),G=Qt(),I=n(!1),te=n(!1),W=n(!1),z=n(!1),R=n(),J=n("Not-Confirm"),O=n(),V=n(""),N=n(""),ne=n(!1),C=n(),S=n(!1),Q=n(!1),le=n(!1),oe=n(0),de=y(()=>{var l;return`${(l=s.ApproveBy)==null?void 0:l.name}, ${s.ApproveDate}`}),b=y(()=>_.Intervention),ie=y(()=>_.serialNumber),ue=y(()=>v.Log),ve=y(()=>_.RiskAssessmentImages),pe=y(()=>_.Groups),ae=y(()=>_.Group),E=y(()=>_.Task),he=y(()=>E.value?B.DefectImages[E.value.key]:[]),me=y(()=>_.LoadingTask),De=y(()=>_.ItemTriggerDisabledValue),ye=y(()=>_.CountIdentifiedDefect),re=y(()=>v.GeneralSubmitted),r=y(()=>_.TaskProgress),d=y(()=>s.stateErrorByNetwork),h=y(()=>{const l=["P1","P2","P3","P4"];return!(!Ye(ke(s.ApprovalData.DefectHeaders,l))||!Ye(ke(s.ApprovalData.DefectGenericHeaders,l))||!Ke(ke(s.ApprovalData.DefectHeaders,l))||!Ke(ke(s.ApprovalData.DefectGenericHeaders,l))||!s.ApprovalData.CBMHeaders.every(we=>we.plannerCbmNAStatus==="Confirmed")||!qt(s.ApprovalData.DefectNAHeaders,!0)||s.ApprovalData.SMUDefectHeaders.length>0&&s.ApprovalData.SMUDefectHeaders[0].plannerStatus!=="Acknowledge")}),$=l=>{_.setSelectedGroup(l)},i=async l=>{var L;l.index==0&&(z.value=!1);const f=l.image,D={};D.id=b.value.id,f.type=="imageEquipment"?D.key=b.value.key:f.type=="value"?D.key=b.value.riskAssesment[0].key:D.key=(L=E.value)==null?void 0:L.key,D.type=f.type,D.employee={id:ee.user.EmployeeId,name:ee.user.Name};const x=rn([f.filename]);D.files=x,D.blobs=[f.blob],D.submitDate=sn(),await v.storeImageLocal(D),l.index==l.length-1&&(z.value=!0)},fe=async({param:l,task:f={}})=>{switch(l.key){case"na":t(l);break;case"defect":c(l),f&&_.setSelectedTask(f);break}},t=async l=>{const f=await Z.getNADetail(l.value,b.value.trInterventionHeaderId,b.value.sapWorkOrder);f&&(R.value=JSON.parse(f.defectData),J.value=f.cbmNAStatus,C.value={},C.value.declineReason=f.declineReason||"",C.value.declineDate=f.declineDate||"",C.value.declineBy=f.declineBy||{},O.value=f.approvedBy,V.value=f.approvedDate||"",S.value=!0)},c=async l=>{const f=await B.getDefectDetail(l.value,b.value.trInterventionHeaderId,b.value.sapWorkOrder,"taskId"),D=await B.getDefectHeader(l.value,b.value.trInterventionHeaderId,b.value.sapWorkOrder,"taskId");if(f.type=="NO")R.value=f,le.value=!0;else{C.value={},R.value=f;const x=await B.getDefectDecline(l.value);C.value.isDecline=x.isDecline,C.value.declineReason=x.declineReason,C.value.declineDate=x.declineDate,C.value.declineBy=x.declineBy,O.value=D.approvedBy,V.value=D.approvedDate??"",Q.value=!0}},k=()=>{S.value=!1,C.value={},O.value={},V.value=""},H=()=>{Q.value=!1},p=()=>{le.value=!1},_e=async()=>{W.value=!0},X=()=>{s.toggleErrorByNetwork(!1),F.push({name:"defectsplanner"})},T=async()=>{oe.value=window.scrollY;const l=Ie.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await s.getDefectsData(w.SelectedDefectSheet.interventionId),l.close()},yt=async()=>{W.value=!1;const l=Ie.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(await w.approveDefectSheetByPlanner(),l.close(),w.IsError){te.value=!0;return}w.reset(),I.value=!0},gt=()=>{W.value=!1},wt=()=>{I.value=!1,K.setDefaultFormTypeOpenFromApprovalPlanner("Component Intervention Forms"),F.push({name:"monitoringstatus"})},_t=()=>{te.value=!1,w.Error!=Ut.INCOMPLETE_DATA&&w.Error!=ht.NO_NETWORK_VIEW&&(K.setDefaultFormTypeOpenFromApprovalPlanner("Component Intervention Forms"),F.push({name:"monitoringstatus"}))},He=n(null),bt=n(""),Te=n(!1),je=n(!1),kt=l=>{je.value=l};Tt(()=>{!w.SelectedDefectSheet||Re.isEmpty(w.SelectedDefectSheet)?F.push({name:"defectsplanner"}):w.setDefectTitle(Lt(w.SelectedDefectSheet))});const xt=l=>{const f=G.Ownership.find(D=>D.equipmentNumber==l);N.value=(f==null?void 0:f.ownership)??""};Oe(async()=>{var f,D;const l=Ie.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(s.DataFetched===!1){await s.getDefectsData((f=w.SelectedDefectSheet)==null?void 0:f.interventionId),await Y.getInterventionDataCosmos((D=w.SelectedDefectSheet)==null?void 0:D.interventionId),_.initGroup(Y.intervention);const x=pe.value.find(L=>L.key=="Identified Defects");x&&_.setSelectedGroup(x),await A.getOwnershipDefectForm(Y.intervention.equipment),_.setSerialNumber(A.SerialNumber),xt(b.value.equipment),await _.getCountIdentifiedDefect()}try{const x=He.value,L=Array.from(x.getElementsByClassName("show-pdf")),ge=Array.from(x.getElementsByClassName("spv-print-pdf"));L.forEach(be=>{be.onclick=we=>{we.preventDefault()}}),ge.forEach(be=>{be.onclick=we=>{we.preventDefault()}})}catch(x){console.log(x)}s.setCurrentUserGroup("Planner"),l.close()});const Ct=()=>{Te.value=!1};return jt(()=>{M.reset()}),(l,f)=>{var D,x,L;return u(),m("div",{ref_key:"defectDetailRef",ref:He},[a(Zt,{title:`${(D=o(w).SelectedDefectSheet)==null?void 0:D.sampleStatus} Intervention ${(x=o(w).SelectedDefectSheet)==null?void 0:x.equipment} ${(L=o(w).SelectedDefectSheet)==null?void 0:L.sapWorkOrder}`,"component-router-push":"defectsplanner","approve-history":de.value},null,8,["title","approve-history"]),a(At,{groups:pe.value,"selected-group":ae.value,"general-submitted":re.value,"is-approval":!0,"task-progress":r.value,"count-identified-defect":ye.value,"is-monitoring":!0,onGroupChange:$},null,8,["groups","selected-group","general-submitted","task-progress","count-identified-defect"]),ae.value.group=="General"?(u(),m(se,{key:0},[a(Me,{intervention:b.value},null,8,["intervention"]),a(Ft,{intervention:b.value,"serial-number":ie.value},null,8,["intervention","serial-number"]),a(It,{tasks:b.value.safetyPrecaution},null,8,["tasks"]),a(Nt,{"general-submitted":re.value,intervention:b.value,fitter:ue.value.employee,"fitter-photos":ve.value,"is-monitoring":!0},null,8,["general-submitted","intervention","fitter","fitter-photos"])],64)):ae.value.group=="Identified Defects"?(u(),m(se,{key:1},[a(Vt),a(Et,{"view-only":!1,"planner-approve":!0,supervisor:!1,onOnRefreshData:T}),a(Ge,{"view-only":!1,supervisor:!1,"planner-approve":!0,onOnRefreshData:T,"view-is-download":!0}),a(Ge,{"view-only":!1,supervisor:!1,"planner-approve":!0,"is-additional-task":!0,onOnRefreshData:T,"view-is-download":!0}),a(Ht,{"view-only":!1,supervisor:!1,onOnRefreshData:T,"planner-approve":!0,"disable-add-generic":!0,"view-is-download":!0}),a(Je,{"view-only":!1,"planner-approve":!0,"view-is-download":!0,onOnRefreshData:T}),a(Je,{"view-only":!1,"planner-approve":!0,"is-additional-task":!0,"view-is-download":!0,onOnRefreshData:T}),a(Oo,{"view-only":!1,"planner-approve":!0,"view-is-download":!0,onOnRefreshData:T}),a(We,{headers:o(s).ApprovalData.CBMHeaders,"planner-approve":!0,onOnRefreshData:T},null,8,["headers"]),a(We,{headers:o(s).ApprovalData.CBMHeaders,"planner-approve":!0,"is-additional-task":!0,onOnRefreshData:T},null,8,["headers"]),a(Le,{title:"Not Applicable Item Check",headers:o(s).ApprovalData.DefectNAHeaders,"planner-approve":!0,onOnRefreshData:T},null,8,["headers"]),a(Le,{title:"Not Applicable Item Check (Additional Task)",headers:o(s).ApprovalData.DefectNAHeaders,"planner-approve":!0,"is-additional-task":!0,onOnRefreshData:T},null,8,["headers"]),a(Yt,{headers:o(s).Comments,"is-intervention":!0},null,8,["headers"]),e("div",$o,[o(s).ApprovalData.DefectHeaders.length==0&&o(s).ApprovalData.DefectNAHeaders.length==0&&o(s).ApprovalData.CBMHeaders.length==0?(u(),qe(nn,{key:0,message:"Component intervention sheet was completed in full and no issues were identified."})):P("",!0),e("button",{class:"btn btn-success",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"},disabled:!h.value,onClick:_e},"Approve",8,Bo)])],64)):(u(),m(se,{key:2},[a(Me,{intervention:b.value,"default-accordion-open":!1},null,8,["intervention"]),(u(!0),m(se,null,$e(ae.value.sections,ge=>(u(),qe(Bt,{key:ge.key,"re-render":!1,"defect-images":he.value,intervention:b.value,section:ge,"current-fitter":ue.value.employee,"general-submitted":!1,validation:"","loading-indicator":me.value,"item-trigger-disabled-value":De.value,currInputTyped:"","expand-all":!1,onOnImageDownloaded:i,onOnDefectView:fe},null,8,["defect-images","intervention","section","current-fitter","loading-indicator","item-trigger-disabled-value"]))),128))],64)),a(Rt,{visibility:o(M).isVisible},null,8,["visibility"]),a(Ee,{visibility:W.value,caption:"Please ensure you generate a PDF copy of the completed Component Intervention Form and attach it to the SAP work order.",onOnNoConfirm:gt,onOnYesConfirm:yt},null,8,["visibility"]),a(Xt,{show:I.value,onClose:wt,message:"Data successfully approved"},null,8,["show"]),a(vt,{visibility:te.value,caption:o(w).Error,onOnClose:_t},null,8,["visibility","caption"]),a(en,{show:Te.value,onHandleCloseModal:Ct,"blob-url":bt.value},null,8,["show","blob-url"]),a(ze,{show:je.value,onClose:kt,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),a(ze,{show:d.value,onClose:X,"title-pop-up":"No internet connection"},null,8,["show"]),a(Pt,{"re-render":!1,task:E.value,decline:C.value,visibility:Q.value,"approved-by":O.value,"approved-date":V.value,ownership:N.value,serialNumber:ie.value,data:R.value,onOnImageDownloaded:i,onOnClose:H,naReasonOptions:o(G).NAConditions},null,8,["task","decline","visibility","approved-by","approved-date","ownership","serialNumber","data","naReasonOptions"]),a(Ot,{"re-render":!1,task:E.value,generic:ne.value,visibility:le.value,data:R.value,ownership:N.value,serialNumber:ie.value,onOnImageDownloaded:i,onOnClose:p,naReasonOptions:o(G).NAConditions},null,8,["task","generic","visibility","data","ownership","serialNumber","naReasonOptions"]),a($t,{visibility:S.value,status:J.value,"approved-by":O.value,"approved-date":V.value,declineData:C.value,data:R.value,onOnClose:k},null,8,["visibility","status","approved-by","approved-date","declineData","data"]),a(Kt,{"is-intervention":!0})],512)}}});export{os as default};
