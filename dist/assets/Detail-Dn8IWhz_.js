import{D as ie}from"./cbm-helper-BxJZ9NTc.js";import{D as ne,a as U,b as q,C as I,c as le,N as $}from"./DefectPanelGeneric-BYVMPBe-.js";import{C as pe}from"./CommentPanel-D0ptrEBp.js";import{C as ce}from"./Cameras-vtENZZzD.js";import{u as me}from"./useCameraStore-BwXVJhPe.js";import{u as ue}from"./useDefectsStore-7BpSnT1n.js";import{u as de}from"./useDefectSheetStore-85RM-z1z.js";import{n as fe}from"./navigator-D5io2Cca.js";import{_ as ve}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as De}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{_ as he}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{a as g}from"./element-plus-BeWdvTRa.js";import{B as we}from"./BackNavigator-DUE8rWVW.js";import{u as Se,b as be}from"./useDefectsFormStore-41UTMhiG.js";import{_ as ke}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as V}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{e as T}from"./lodash-DrHMlsdo.js";import{N as ye}from"./NoDefect-DdL3mqty.js";import{u as ge}from"./vue-router-iNp9kJ0K.js";import{g as A,v as L}from"./helpers-wUOLw-dU.js";import{_ as Ae}from"./Toast.vue_vue_type_style_index_0_lang-OOgaHWFE.js";import{A as Ce,N as Ne}from"./number-format-BdMuQVyW.js";import{k as _e,r as p,c as v,d as Pe,a7 as Re,o as Oe,L as Be,p as l,aa as Ee,aB as C,s as o,u as a,q as c,A as Me,F as He}from"./@vue-BypzYtbH.js";import"./Repair-zyV2di4A.js";import"./nw-img-vue-CR837WER.js";import"./manipulate-html-string-DqTEGh-F.js";import"./SMUDetailDialog-Bs-98WGo.js";import"./index-BuVmIl8K.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./@vueuse-DFoNmIyu.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./document_download-C1p7j0nJ.js";import"./ImagePreviews.vue_vue_type_style_index_0_lang-BJGkhvcB.js";import"./prev-val-handler-DvA3D_kF.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./urls-CvqtYZA-.js";import"./useHistoricalEformDmaStore-Fo4tKNgB.js";import"./NAForm-BdrJ0TGj.js";import"./useMasterStore-CzSO06fn.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./defect-CAkPobhd.js";import"./authentication-handler-Pueb_EI7.js";import"./urls-CPQ2HRXU.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./usePreviewNaFormStore-C1MJT2RQ.js";import"./ImageListModal.vue_vue_type_style_index_0_lang-djt6-PkA.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./Check-CTArJpdm.js";import"./DefectForm-eu6l4STx.js";import"./manipulate-file-oif_A7gg.js";import"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import"./pdf-DNpyvVEz.js";import"./image-close-button-red-B1UxWyBV.js";import"./useAttachmentStore-DqM3autD.js";import"./@progress-DBKeVTWA.js";import"./vue-BzYgrL08.js";import"./pdf-merger-js-DY3-eECH.js";import"./pdf-lib-DrnT2QV2.js";import"./@pdf-lib-CXIx2D9y.js";import"./pako-Dx2kwFQn.js";import"./helpers-BS1ZZpAr.js";import"./CrackForm-CIiKEd4n.js";import"./usePositionListStore-BsprGHwA.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./LargeCamera-BnWfLFAm.js";import"./CrackNoClass-0DSU7BAn.js";import"./CrackYesClass-COntz77m.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./list-pcxkCnQg.js";import"./IronformConfig-BWypCgSI.js";import"./simple-vue-camera-D9MGhAeE.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-B0Rq9QQ3.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";const xe={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},Ge=["disabled"],zr=_e({__name:"Detail",setup(Fe){const e=ue(),N=Se(),t=de(),_=be(),P=me(),w=ge(),S=p(!1),b=p(!1),k=p(!1),j=p(0),K=v(()=>e.stateErrorByNetwork),m=v(()=>e.DefectKey),W=v(()=>e.Comments.slice().sort(z)),z=(r,d)=>{const s=parseInt(r.taskDesc.split(";;")[0]),f=parseInt(d.taskDesc.split(";;")[0]);return s-f},{redirectByLink:R}=fe(),D=v(()=>{var r;return((r=t.SelectedDefectSheet)==null?void 0:r.eFormStatus)=="Submited"}),J=v(()=>{const r=["P1","P2"],s=A(e.ApprovalData.DefectHeaders,r).every(n=>n.status=="Acknowledge"||n.status=="Decline"),h=A(e.ApprovalData.DefectGenericHeaders,r).every(n=>n.status=="Acknowledge"||n.status=="Decline"),re=A(e.ApprovalData.CrackHeaders,r).every(n=>n.status=="Acknowledge"||n.status=="Decline"),oe=e.ApprovalData.CBMHeaders.every(n=>n.cbmNAStatus==="Confirmed"),se=L(e.ApprovalData.DefectNAHeaders),ae=L(e.ApprovalData.CrackNAHeaders);let Y=!0;return Object.keys(e.DefectSMUHeader).length>0&&(Y=e.DefectSMUHeader.status==="Acknowledge"),s&&h&&re&&oe&&se&&ae&&D.value&&Y}),O=v(()=>t.stateSheetAlreadyApproved);Pe(()=>O.value,r=>{r&&setTimeout(()=>{t.stateSheetAlreadyApproved=!1,w.push({name:"defects"})},3e3)});const B=async()=>{k.value=!1;const r=g.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(await t.approveDefectSheetBySupervisor(),r.close(),t.IsError){b.value=!0;return}t.reset(),S.value=!0},Q=()=>{k.value=!1},X=()=>{S.value=!1,R("/ironforms/defects")},Z=()=>{b.value=!1,t.Error!=Ce.INCOMPLETE_DATA&&t.Error!=Ne.NO_NETWORK_VIEW&&R("/ironforms/defects")},E=p(null),M=p(""),y=p(!1),H=p(!1),x=r=>{H.value=r};Re(()=>{(!t.SelectedDefectSheet||T.isEmpty(t.SelectedDefectSheet))&&w.push({name:"defects"})});const u=()=>{j.value=window.scrollY},i=async()=>{const r=g.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await e.getDefectsData(t.SelectedDefectSheet.workOrder),r.close()},ee=()=>{e.toggleErrorByNetwork(!1),w.push({name:"defects"})};Oe(async()=>{const r=g.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(e.DataFetched===!1){await e.getDefectsData(t.SelectedDefectSheet.workOrder),console.log("defectSheetStore.SelectedDefectSheet",t.SelectedDefectSheet);const d=t.SelectedDefectSheet.equipmentModel.split(" ")[0].split("-");let s=[...new Set(d)].join("-");T.isUndefined(t.SelectedDefectSheet.equipmentModel.split(" ")[1])||(s=`${s} ${t.SelectedDefectSheet.equipmentModel.split(" ")[1]}`),N.setModelAndPsTypeId("",t.SelectedDefectSheet.psType,"",s,""),await N.getEhmsRating(),await _.getOwnershipDefectForm(t.SelectedDefectSheet.unitNumber)}G("show-pdf",!1),G("spv-print-pdf",!0),e.setCurrentUserGroup("Supervisor"),_.getPartReference(t.SelectedDefectSheet.unitNumber),r.close()});const G=(r,d)=>{var s;try{const f=Array.from((s=E.value)==null?void 0:s.getElementsByClassName(r));if(!f)return;f.forEach(h=>{h.onclick=F=>{F.preventDefault(),y.value=!0,M.value=h.href,d&&x(!0)}})}catch(f){console.error(f)}};Be(()=>{P.reset()});const te=()=>{y.value=!1};return(r,d)=>{var s;return l(),Ee(He,null,[C("div",{ref_key:"defectDetailRef",ref:E},[o(we,{title:`${(s=a(t).SelectedDefectSheet)==null?void 0:s.form}`,"component-router-push":"defects"},null,8,["title"]),o(ie),(l(),c(ne,{key:m.value,"view-only":!1,"planner-approve":!1,supervisor:!0,onOnRefreshData:i,onOnGetPositionY:u})),(l(),c(U,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,onOnGetPositionY:u,title:"Repairs Completed"})),(l(),c(U,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,onOnGetPositionY:u,title:"Further Action Required"})),(l(),c(q,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,"disable-add-generic":!0,title:"Repairs Completed"})),(l(),c(q,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,"disable-add-generic":!0,title:"Further Action Required"})),(l(),c(I,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,onOnGetPositionY:u,title:"Repairs Completed"})),(l(),c(I,{key:m.value,"view-only":!1,"is-approval":!0,supervisor:!0,onOnRefreshData:i,"view-is-download":!0,onOnGetPositionY:u,title:"Further Action Required"})),o(le,{headers:a(e).ApprovalData.CBMHeaders,"is-disabled":!D.value,onOnRefreshData:i},null,8,["headers","is-disabled"]),o($,{title:"Not Applicable Item Check",headers:a(e).ApprovalData.DefectNAHeaders,"is-defect":!0,onOnRefreshData:i,"is-disabled":!D.value,onOnGetPositionY:u},null,8,["headers","is-disabled"]),o($,{title:"Not Applicable Crack Check",headers:a(e).ApprovalData.CrackNAHeaders,"is-defect":!1,onOnRefreshData:i,"is-disabled":!D.value,onOnGetPositionY:u},null,8,["headers","is-disabled"]),o(pe,{headers:W.value},null,8,["headers"]),C("div",xe,[a(e).ApprovalData.DefectHeaders.length==0&&a(e).ApprovalData.CrackHeaders.length==0&&a(e).ApprovalData.CrackNAHeaders.length==0&&a(e).ApprovalData.DefectNAHeaders.length==0&&a(e).ApprovalData.CBMHeaders.length==0?(l(),c(ye,{key:0,message:"Service sheet was completed in full and no issues were identified."})):Me("",!0),C("button",{class:"btn btn-success",style:{background:"#18af4a","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"},disabled:!J.value,onClick:B}," Approve ",8,Ge)])],512),o(ce,{visibility:a(P).isVisible},null,8,["visibility"]),o(ve,{visibility:k.value,caption:"Please confirm this defect information is correct.",onOnNoConfirm:Q,onOnYesConfirm:B},null,8,["visibility"]),o(De,{show:S.value,onClose:X,message:"Data successfully approved"},null,8,["show"]),o(he,{visibility:b.value,caption:a(t).Error,onOnClose:Z},null,8,["visibility","caption"]),o(ke,{show:y.value,onHandleCloseModal:te,"blob-url":M.value},null,8,["show","blob-url"]),o(V,{show:H.value,onClose:x,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),o(Ae,{visibility:O.value,caption:"You cannot approve this digital service sheet because another user already approved."},null,8,["visibility"]),o(V,{show:K.value,onClose:ee,"title-pop-up":"No internet connection"},null,8,["show"])],64)}}});export{zr as default};
