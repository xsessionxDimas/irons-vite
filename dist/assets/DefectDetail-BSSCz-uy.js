import{D as pe}from"./cbm-helper-BxJZ9NTc.js";import{D as U,a as T,C as j,b as ce,N as K}from"./DefectPanelGeneric-DsEuK-C7.js";import{O as me}from"./OfflineCameras-Dy0B8KWw.js";import{u as ue}from"./useCameraStore-BwXVJhPe.js";import{u as fe}from"./useDefectsStore-j2gYF-8i.js";import{u as de}from"./useDefectsStore-7BpSnT1n.js";import{u as ve}from"./useDefectSheetStore-85RM-z1z.js";import{n as he}from"./navigator-D5io2Cca.js";import{_ as De}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as Se}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{_ as be}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{a as A}from"./element-plus-BeWdvTRa.js";import{B as we}from"./BackNavigator-DUE8rWVW.js";import{u as _e,b as ye}from"./useDefectsFormStore-41UTMhiG.js";import{_ as ge}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as W}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{e as J}from"./lodash-DrHMlsdo.js";import{N as ke}from"./NoDefect-DdL3mqty.js";import{u as Ce}from"./vue-router-iNp9kJ0K.js";import{_ as Ne}from"./Toast.vue_vue_type_style_index_0_lang-OOgaHWFE.js";import{A as Oe,N as Ae}from"./number-format-BdMuQVyW.js";import{u as Pe}from"./usePersonelLabourStore-BUmSURn2.js";import{S as Re}from"./SelectSearchWithLabel-CWBDKtLo.js";import{c as Fe}from"./useEFormStore-DtkLPope.js";import{k as Ee,r as s,c as h,d as Be,a7 as Me,o as xe,L as Ie,p,aa as qe,aB as v,s as o,u as i,x as P,q as c,A as He,F as Ve,R,bd as $e,bb as Ge}from"./@vue-BypzYtbH.js";import{_ as Le}from"./nw-img-vue-CR837WER.js";import"./Repair-zyV2di4A.js";import"./document_download-C1p7j0nJ.js";import"./CrackForm-CAm6DVbX.js";import"./CrackForm-CIiKEd4n.js";import"./@vueuse-DFoNmIyu.js";import"./manipulate-html-string-DqTEGh-F.js";import"./useHistoricalEformDmaStore-Fo4tKNgB.js";import"./pinia-BjOS2_Ao.js";import"./index-BuVmIl8K.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./manipulate-file-oif_A7gg.js";import"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./helpers-wUOLw-dU.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./pdf-DNpyvVEz.js";import"./image-close-button-red-B1UxWyBV.js";import"./@progress-DBKeVTWA.js";import"./vue-BzYgrL08.js";import"./pdf-merger-js-DY3-eECH.js";import"./pdf-lib-DrnT2QV2.js";import"./@pdf-lib-CXIx2D9y.js";import"./pako-Dx2kwFQn.js";import"./urls-CPQ2HRXU.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./usePositionListStore-BsprGHwA.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./useMasterStore-CzSO06fn.js";import"./NAForm-BdrJ0TGj.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./methods-bliey5hF.js";import"./urls-CvqtYZA-.js";import"./useAttachmentStore-CPMOf2aR.js";import"./CrackYesClass-COntz77m.js";import"./reference-file-C1vLEEpf.js";import"./prev-val-handler-DvA3D_kF.js";import"./internet-connection-CnLQPjRt.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./PDFViewerDialog.vue_vue_type_style_index_0_lang-DqiQYePb.js";import"./list-pcxkCnQg.js";import"./ImagePreviews.vue_vue_type_style_index_0_lang-BJGkhvcB.js";import"./simple-vue-camera-D9MGhAeE.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./CrackNoClass-0DSU7BAn.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-B0Rq9QQ3.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./IronformConfig-BWypCgSI.js";import"./disabled-state-O9W-ZY8y.js";const Ye=D=>($e("data-v-58d152c0"),D=D(),Ge(),D),Ue=Ye(()=>v("h4",{class:"subtitle ps-3"},"Service Labour Personnel",-1)),Te={class:"p-2 me-0"},je={class:"row",style:{width:"101%"}},Ke={class:"col-12 pe-0"},We={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},Je=Ee({__name:"DefectDetail",setup(D){const r=fe(),z=de(),F=_e(),e=ve(),E=ye(),B=ue(),_=Ce(),Q=Pe(),M=Fe(),y=s(!1),g=s(!1),k=s(!1),X=s(0),x=s(""),I=s("Equipment Information"),C=s(),Z=h(()=>r.stateErrorByNetwork),m=h(()=>r.DefectKey),u=h(()=>C.value?JSON.stringify(C.value):""),{redirectByLink:q}=he(),N=h(()=>{var t;return((t=e.SelectedDefectSheet)==null?void 0:t.eFormStatus)=="Submited"}),ee=()=>{x.value="relative-hidder"},te=()=>{x.value=""},oe=async t=>{const l={id:t.value,name:t.label};e.updateSelectedFitter(l)},H=h(()=>e.stateSheetAlreadyApproved);Be(()=>H.value,t=>{t&&setTimeout(()=>{e.stateSheetAlreadyApproved=!1,_.push({name:"defects"})},3e3)});const re=async()=>{k.value=!1;const t=A.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(await e.approveDefectSheetBySupervisor(),t.close(),e.IsError){g.value=!0;return}e.reset(),y.value=!0},ie=()=>{k.value=!1},se=()=>{y.value=!1,q("/ironforms/identified-defects")},ae=()=>{g.value=!1,e.Error!=Oe.INCOMPLETE_DATA&&e.Error!=Ae.NO_NETWORK_VIEW&&q("/ironforms/identified-defects")},V=s(null),$=s(""),O=s(!1),G=s(!1),L=t=>{G.value=t};Me(()=>{(!e.SelectedDefectSheet||J.isEmpty(e.SelectedDefectSheet))&&_.push({name:"identifieddefects"})});const f=()=>{X.value=window.scrollY},a=async()=>{const t=A.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await r.getDefectsData(e.SelectedDefectSheet.workOrder),t.close()},le=()=>{r.toggleErrorByNetwork(!1),_.push({name:"defects"})},Y=(t,l)=>{var n;try{const d=Array.from((n=V.value)==null?void 0:n.getElementsByClassName(t));if(!d)return;d.forEach(S=>{S.onclick=b=>{b.preventDefault(),O.value=!0,$.value=S.href,l&&L(!0)}})}catch(d){console.error(d)}};xe(async()=>{e.updateSelectedFitter({id:"",name:""});const t=A.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(r.DataFetched===!1){await r.getDefectsData(e.SelectedDefectSheet.workOrder);const l=e.SelectedDefectSheet.equipmentModel.split(" ")[0].split("-");let n=[...new Set(l)].join("-");J.isUndefined(e.SelectedDefectSheet.equipmentModel.split(" ")[1])||(n=`${n} ${e.SelectedDefectSheet.equipmentModel.split(" ")[1]}`),F.setModelAndPsTypeId("",e.SelectedDefectSheet.psType,"",n,""),await F.getEhmsRating(),await E.getOwnershipDefectForm(e.SelectedDefectSheet.unitNumber),M.getOwnershipDefectForm(e.SelectedDefectSheet.unitNumber)}Y("show-pdf",!1),Y("spv-print-pdf",!0),r.setCurrentUserGroup("Fitter"),z.setCurrentUserGroup("Fitter"),await E.getPartReference(e.SelectedDefectSheet.unitNumber),await M.getPartReference(e.SelectedDefectSheet.unitNumber),t.close()}),Ie(()=>{e.reset(),e.updateSelectedFitter({}),B.reset()});const ne=()=>{O.value=!1};return(t,l)=>{var b;const n=R("el-collapse-item"),d=R("el-collapse"),S=R("Cameras");return p(),qe(Ve,null,[v("div",{ref_key:"defectDetailRef",ref:V},[o(we,{title:`${(b=i(e).SelectedDefectSheet)==null?void 0:b.form}`,"component-router-push":"identifieddefects"},null,8,["title"]),o(d,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=w=>I.value=w),class:"general-accordion task-group py-1 px-5 mb-3"},{default:P(()=>[o(n,{name:"Equipment Information"},{title:P(()=>[Ue]),default:P(()=>{var w;return[v("div",Te,[v("div",je,[v("div",Ke,[o(Re,{ref:"selectFitter","field-label":"Labour Personnel Name",placeholder:"Select your name",data:i(Q).PersonelLabours,value:(w=C.value)==null?void 0:w.name,"display-label":!0,onOnFocus:ee,onOnLostFocus:te,onOnSelected:oe},null,8,["data","value"])])])])]}),_:1})]),_:1},8,["modelValue"]),o(pe),(p(),c(U,{key:m.value,"view-only":!1,"is-approval":!1,"fitter-id":u.value,supervisor:!0,"is-form":!1,onOnRefreshData:a,"view-is-download":!0,onOnGetPositionY:f,title:"Repairs Completed"},null,8,["fitter-id"])),(p(),c(U,{key:m.value,"view-only":!1,"is-approval":!1,"fitter-id":u.value,supervisor:!0,"is-form":!1,onOnRefreshData:a,"view-is-download":!0,onOnGetPositionY:f,title:"Further Action Required"},null,8,["fitter-id"])),(p(),c(T,{key:m.value,"view-only":!1,"fitter-id":u.value,"is-form":!1,"is-approval":!1,supervisor:!0,onOnRefreshData:a,"view-is-download":!0,"disable-add-generic":!0,title:"Repairs Completed"},null,8,["fitter-id"])),(p(),c(T,{key:m.value,"view-only":!1,"is-form":!1,"is-approval":!1,"fitter-id":u.value,supervisor:!0,onOnRefreshData:a,"view-is-download":!0,"disable-add-generic":!0,title:"Further Action Required"},null,8,["fitter-id"])),(p(),c(j,{key:m.value,"view-only":!1,"is-form":!1,"is-approval":!1,"fitter-id":u.value,supervisor:!0,onOnRefreshData:a,"view-is-download":!0,onOnGetPositionY:f,title:"Repairs Completed"},null,8,["fitter-id"])),(p(),c(j,{key:m.value,"view-only":!1,"is-form":!1,"is-approval":!1,"fitter-id":u.value,supervisor:!0,onOnRefreshData:a,"view-is-download":!0,onOnGetPositionY:f,title:"Further Action Required"},null,8,["fitter-id"])),o(ce,{headers:i(r).ApprovalData.CBMHeaders,"is-disabled":!N.value,onOnRefreshData:a},null,8,["headers","is-disabled"]),o(K,{title:"Not Applicable Item Check",headers:i(r).ApprovalData.DefectNAHeaders,"is-defect":!0,onOnRefreshData:a,"is-disabled":!N.value,onOnGetPositionY:f},null,8,["headers","is-disabled"]),o(K,{title:"Not Applicable Crack Check",headers:i(r).ApprovalData.CrackNAHeaders,"is-defect":!1,onOnRefreshData:a,"is-disabled":!N.value,onOnGetPositionY:f},null,8,["headers","is-disabled"]),v("div",We,[i(r).ApprovalData.DefectHeaders.length==0&&i(r).ApprovalData.CrackHeaders.length==0&&i(r).ApprovalData.CrackNAHeaders.length==0&&i(r).ApprovalData.DefectNAHeaders.length==0&&i(r).ApprovalData.CBMHeaders.length==0?(p(),c(ke,{key:0,message:"Service sheet was completed in full and no issues were identified."})):He("",!0)])],512),o(S,{visibility:i(B).isVisible},null,8,["visibility"]),o(De,{visibility:k.value,caption:"Please confirm this defect information is correct.",onOnNoConfirm:ie,onOnYesConfirm:re},null,8,["visibility"]),o(Se,{show:y.value,onClose:se,message:"Data successfully approved"},null,8,["show"]),o(be,{visibility:g.value,caption:i(e).Error,onOnClose:ae},null,8,["visibility","caption"]),o(ge,{show:O.value,onHandleCloseModal:ne,"blob-url":$.value},null,8,["show","blob-url"]),o(W,{show:G.value,onClose:L,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),o(Ne,{visibility:H.value,caption:"You cannot approve this digital service sheet because another user already approved."},null,8,["visibility"]),o(W,{show:Z.value,onClose:le,"title-pop-up":"No internet connection"},null,8,["show"]),o(me)],64)}}}),pr=Le(Je,[["__scopeId","data-v-58d152c0"]]);export{pr as default};
