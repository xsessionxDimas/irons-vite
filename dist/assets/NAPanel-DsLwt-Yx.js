import{u as Be}from"./useComponentInterventionDefectsStore-CA75rH_W.js";import{b as Ke}from"./useDefectsFormStore-41UTMhiG.js";import{u as Ye}from"./useCameraStore-BwXVJhPe.js";import{d as Qe,b as Yl,c as Ql}from"./manipulate-html-string-DqTEGh-F.js";import{e as E}from"./lodash-DrHMlsdo.js";import{S as Jl}from"./SMUDetailDialog-Bs-98WGo.js";import{l as ft,n as Xl,p as Lt,o as Ge,k as jt}from"./helpers-wUOLw-dU.js";import{b as Zl}from"./vue-router-iNp9kJ0K.js";import{k as Se,r as n,c as A,p as s,aa as o,aB as e,s as d,x as w,u as g,F as U,R as ae,$ as me,b4 as z,C,bd as Ve,bb as Ae,a0 as Ne,B as ue,A as y,y as je,a2 as tt,P as ce,a5 as ea,q as Ee,d as Et,o as Ht,Y as ta,b6 as qe}from"./@vue-BypzYtbH.js";import{_ as Ie}from"./nw-img-vue-CR837WER.js";import{_ as Ut}from"./Repair-zyV2di4A.js";import{_ as qt}from"./document_download-C1p7j0nJ.js";import{_ as Wt}from"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import{u as Gt}from"./useComponentInterventionDefectSheetStore-H9Ju8hNj.js";import{u as zt}from"./useHistoricalEformDmaStore-Fo4tKNgB.js";import{p as Kt,f as Yt,m as at,r as Qt,b as Jt,G as lt,c as Nt,d as ut,a as Bt}from"./cbm-helper-BxJZ9NTc.js";import{c as He}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{s as ht}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{I as Xt}from"./DefectForm-eu6l4STx.js";import{_ as ze}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{p as Zt,c as el}from"./helpers-BS1ZZpAr.js";import{_ as _t}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{h as st}from"./date-format-8-IvfSl3.js";import{f as la,r as We,N as Je}from"./number-format-BdMuQVyW.js";import{u as aa}from"./usePositionListStore-BsprGHwA.js";import{u as sa}from"./useMasterStore-CzSO06fn.js";import{L as tl}from"./LargeCamera-BnWfLFAm.js";import{_ as pt}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{a as vt}from"./element-plus-BeWdvTRa.js";import{_ as Oe}from"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import{D as oa,N as na}from"./NAForm-BdrJ0TGj.js";import{h as mt,s as Ft,a as ra,b as ca}from"./urls-CPQ2HRXU.js";import{_ as ll}from"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import{_ as ia,a as da}from"./manipulate-file-oif_A7gg.js";import{v as al}from"./uuid-SoommWqA.js";import{u as ua}from"./usePreviewDefectFormStore-CVtftEdK.js";import{f as Tt,c as pa}from"./index-BuVmIl8K.js";import{_ as va}from"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import{I as ma}from"./IronformConfig-BWypCgSI.js";import{_ as fa}from"./Check-CTArJpdm.js";const yt=a=>(Ve("data-v-ae3a7a71"),a=a(),Ae(),a),ha={class:"mt-0 ps-0"},_a=yt(()=>e("div",{class:"row px-2 item mx-1 w-100 defect-panel-header"},[e("div",{class:"col align-items-center d-flex text-break"},"Task Description"),e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Status"),e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status")],-1)),ya={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ba=yt(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),ga=[ba],xa={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Da={class:"col align-items-center d-flex text-break"},wa=["innerHTML"],ka=yt(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},null,-1)),Ca={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},$a=["onClick"],Sa={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Va=Se({__name:"DefectSMUPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData","onGetPositionY"],setup(a,{emit:ie}){const u=a,ee=Zl(),c=Be(),O=Ye(),G=Ke(),Y=ie,q=n("SMU Machine Acknowledgement"),F=n(""),Q=n(!1),f=A(()=>c.ApprovalData.SMUDefectHeaders),T=A(()=>c.DefectSMUHeader),se=A(()=>c.DefectSMUDetail),N=A(()=>{const D=G.Ownership;return ft(D)}),p=A(()=>({isError:c.stateErrorMessage!="",messages:c.stateErrorMessage})),de=A(()=>{if(T.value){const{plannerStatus:D,updatedBy:x,updatedDate:M}=T.value;return{plannerStatus:D,updatedBy:x,updatedDate:M}}}),te=A(()=>{if(T.value){const{approvedBy:D,approvedDate:x,status:M}=T.value;return{approvedBy:D,approvedDate:x,status:M}}}),W=(D,x)=>{let M="light-yellow color-dark-yellow";const H=x==null?void 0:x.find(K=>K.id===D);if(u.supervisor){if(H)switch(H.status){case"Submited":M="light-yellow color-dark-yellow";break;case"Acknowledge":M="light-green color-dark-green";break}}else!E.isUndefined(H.plannerStatus)&&H.plannerStatus&&(M="light-green color-dark-green");return M},b=async D=>{Y("onGetPositionY"),O.setCurrent("defect");const x=c.setSMUDefectData(D);u.plannerApprove&&c.HeaderStatus!="Decline"&&c.updateHeaderDefectSMU(D),F.value=D,x&&(Q.value=!0)},$=()=>{Y("onRefreshData")},I=async D=>{await c.updateDefectDetailSMU(D.newDetail),D.callback()},L=async D=>{await c.updateDefectAcknowledge(!0,!1,!0,D.newTitle),D.callback()},t=async D=>{await c.updateDefectAcknowledge(!1,!1,!0,D.newTitle),D.callback()},ne=()=>{c.resetErrorStatus()},P=A(()=>{var D;if(f.value.length>0){const x=c.ApprovalData.SMUDefectDetails.find(M=>M.defectHeaderId==f.value[0].id)??null;if(x)return`${((D=x.updatedBy)==null?void 0:D.name)||x.createdBy.name}, ${x.updatedDate!=""?x.updatedDate:x.createdDate}`}return""}),pe=D=>{const x=Qe(D);let M=x;return x.includes("-")&&(M=x.split(" - ")[0]),M};return(D,x)=>{var K,J;const M=ae("el-collapse-item"),H=ae("el-collapse");return s(),o(U,null,[e("div",ha,[d(H,{class:"task-group general-accordion py-1 px-5 testing",modelValue:q.value,"onUpdate:modelValue":x[0]||(x[0]=ve=>q.value=ve)},{default:w(()=>[d(M,{title:"SMU Machine Acknowledgement",name:"SMU Machine Acknowledgement"},{default:w(()=>[_a,f.value.length<1?(s(),o("div",ya,ga)):(s(!0),o(U,{key:1},me(f.value,ve=>(s(),o("div",{key:ve.id,class:"item px-2 my-2 mx-1"},[e("div",xa,[e("div",Da,[e("span",{class:"text-break defect-identified-task",innerHTML:pe(ve.taskDesc)},null,8,wa)]),ka,e("div",Ca,[e("div",{class:z(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",W(ve.id,f.value)]),onClick:ge=>b(ve.id)}," Detailed Information ",10,$a)])]),e("div",Sa,C(P.value),1)]))),128))]),_:1})]),_:1},8,["modelValue"])]),d(Jl,{show:Q.value,"onUpdate:show":x[1]||(x[1]=ve=>Q.value=ve),detailDefect:se.value,ownership:N.value,"view-only":!a.plannerApprove&&((K=T.value)==null?void 0:K.status)=="Acknowledge"||a.plannerApprove&&((J=T.value)==null?void 0:J.plannerStatus)=="Acknowledge"||g(ee).path=="/ironforms/e-form"||g(ee).path=="/ironforms/monitoring-status/preview",plannerApprove:a.plannerApprove,"error-status":p.value,"planner-data":de.value,"approval-s-p-v-data":te.value,onOnRefreshData:$,onUpdateDefectDetailSMU:I,onUpdatePlannerDefectAcknowledge:L,onUpdateDefectAcknowledge:t,onResetErrorStatus:ne,isIntevention:!0},null,8,["show","detailDefect","ownership","view-only","plannerApprove","error-status","planner-data","approval-s-p-v-data"])],64)}}}),jd=Ie(Va,[["__scopeId","data-v-ae3a7a71"]]),B=a=>(Ve("data-v-bff575e3"),a=a(),Ae(),a),Aa={class:"el-dialog__title"},Ia={key:0,class:"red-bg text-dark-red p-1"},Pa={key:1,class:"status-badge-dialog-header approved-badge p-1"},Ma=["innerHTML"],Ra={key:0,class:"mt-1 py-2"},Oa={class:"d-flex flex-column"},Na={class:"row mb-1"},Ba={class:"col"},Fa={class:"form-floating declined-text-box"},Ta={class:"form-control"},La=B(()=>e("label",null,"Declined Reason*",-1)),ja={key:0,class:"mb-2 text-end"},Ea={key:1,class:"mt-1 py-2"},Ha={class:"d-flex flex-column"},Ua={class:"row mb-1"},qa={class:"col"},Wa={key:0,class:"form-floating approved-text-box"},Ga={class:"form-control"},za=B(()=>e("label",null,"Approved",-1)),Ka={class:"d-flex flex-row justify-content-between"},Ya={class:"py-2 d-flex flex-row flex-grow-1"},Qa={class:"flex-fill"},Ja={class:"form-floating"},Xa=["innerHTML"],Za=B(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),es={class:"flex-fill ps-3"},ts={class:"form-floating"},ls=["innerHTML"],as=B(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),ss={class:"flex-fill ps-3"},os={class:"form-floating"},ns=["innerHTML"],rs=B(()=>e("label",{for:"floatingInput"},"Ownership",-1)),cs={class:"d-flex flex-row justify-content-between"},is={class:"mt-1 py-2"},ds={class:"mt-1 py-2"},us={class:"row"},ps={class:"col pe-0"},vs={class:"form-floating"},ms=["value"],fs=B(()=>e("label",null,"Raised By",-1)),hs={class:"mt-1 py-2"},_s={class:"row"},ys={class:"col-4 pe-0 date"},bs={class:"form-floating"},gs=["value"],xs=B(()=>e("label",null,"Date Raised",-1)),Ds={class:"col pe-0 d-flex"},ws={class:"d-flex flex-column flex-fill"},ks={class:"form-floating"},Cs=["value","disabled"],$s=B(()=>e("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Ss={key:0,class:"mt-2"},Vs={class:"ms-2 d-flex align-items-center"},As={class:"mt-1 py-2"},Is=B(()=>e("div",{class:"mt-2"},null,-1)),Ps=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1)),Ms={class:"row p-3 m-1 priority-container"},Rs={class:"col-3"},Os={class:"form-check"},Ns=["disabled"],Bs=B(()=>e("label",{class:"form-check-label text-nowrap"}," (P1) Immediate ",-1)),Fs=B(()=>e("div",{class:"col-6 word-breaker"},"Shall shut machine down and undertake repairs.",-1)),Ts=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Ls={class:"row p-3 m-1 priority-container"},js={class:"col-3"},Es={class:"form-check"},Hs=["disabled"],Us=B(()=>e("label",{class:"form-check-label text-nowrap"}," (P2) Urgent ",-1)),qs=B(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 7 days.",-1)),Ws=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Gs={class:"row p-3 m-1 priority-container"},zs={class:"col-3"},Ks={class:"form-check"},Ys=["disabled"],Qs=B(()=>e("label",{class:"form-check-label text-nowrap"}," (P3) Routine ",-1)),Js=B(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 60 days.",-1)),Xs=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),Zs={class:"row p-3 m-1 priority-container"},eo={class:"col-3"},to={class:"form-check"},lo=["disabled"],ao=B(()=>e("label",{class:"form-check-label text-nowrap"}," (P4) Monitor ",-1)),so=B(()=>e("div",{class:"col-6 word-breaker"},"Shall continue to inspect and monitor for 90 days.",-1)),oo=B(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),no=B(()=>e("div",{class:"mt-2"},null,-1)),ro=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Part Number"),e("div",{class:"col-5"},"Part Description"),e("div",{class:"col-1"},"Qty"),e("div",{class:"col"}),e("div",{class:"col"})],-1)),co={class:"col-3 ps-0"},io={class:"d-flex flex-column"},uo=["onUpdate:modelValue","disabled"],po={key:0,class:"mt-2"},vo={class:"col-5"},mo={class:"d-flex flex-column"},fo=["value","onChange","disabled"],ho={key:0,class:"mt-2"},_o={class:"col-1 px-1 d-flex justify-content-start"},yo={class:"d-flex flex-column"},bo=["value","onInput","disabled"],go={key:0,class:"mt-2"},xo={class:"col px-1 d-flex flex-column justify-content-start"},Do={class:"row p-0 m-0 h-100 w-100 align-items-center"},wo={class:"col px-1 d-flex flex-column justify-content-start position-relative"},ko={class:"row p-0 m-0 h-100 w-100 align-items-center"},Co=["onClick"],$o=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),So=B(()=>e("div",{class:"mt-2"},null,-1)),Vo=B(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-6"},"Labour Activity"),e("div",{class:"col-2"},"Qty"),e("div",{class:"col-2"},"Hours Each"),e("div",{class:"col-2"},"Total Hours")],-1)),Ao={class:"col-6 px-0"},Io={class:"d-flex flex-column"},Po={key:0,class:"mt-2"},Mo={class:"col-2 d-flex justify-content-start"},Ro={class:"d-flex flex-column"},Oo=["value","onInput","disabled"],No={key:0,class:"mt-2"},Bo={class:"col-2 d-flex justify-content-start"},Fo={class:"d-flex flex-column"},To=["value","onInput","disabled"],Lo={key:0,class:"mt-2"},jo={class:"col-2 d-flex justify-content-start"},Eo={class:"d-flex flex-column"},Ho=["value"],Uo={key:0,class:"mt-2"},qo=["onClick"],Wo=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Go=B(()=>e("div",{class:"mt-2"},null,-1)),zo={class:"d-flex flex-fill flex-column"},Ko=["value","onChange","disabled"],Yo={key:0,class:"mt-2"},Qo=["onClick"],Jo=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Xo=B(()=>e("div",{class:"mt-2"},null,-1)),Zo={class:"d-flex flex-fill flex-column"},en={key:0,class:"mt-2"},tn={key:1,class:"mt-2"},ln=["onClick"],an=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),sn=B(()=>e("div",{class:"mt-2"},null,-1)),on={class:"d-flex flex-fill flex-column"},nn={key:0,class:"mt-2"},rn={key:1,class:"mt-2"},cn=["onClick"],dn=B(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),un={key:0,class:"my-5 w-100 d-flex justify-content-around"},pn=["disabled"],vn=Se({__name:"DefectForm",props:{visibility:{required:!0,type:Boolean},defectData:{required:!0,type:Object},workOrder:{required:!1,type:String},headerId:{required:!1,type:String},status:{required:!0,type:String},plannerStatus:{required:!0,type:String},viewOnly:{required:!1,type:Boolean,default:!1},plannerApprove:{required:!1,type:Boolean,default:!1},declineReason:{required:!1,type:String,default:""},needConfirm:{required:!1,type:Boolean,default:!0},declineBy:{required:!1,type:Object,default:null},declineDate:{required:!1,type:String,default:""},approvedDate:{required:!1,type:String,default:""},approvedBy:{required:!1,type:Object,default:{}},generic:{required:!1,type:Boolean,default:!1}},emits:["closeForm","onRefreshData"],setup(a,{emit:ie}){const u=a,ee=ie,c=Ye(),O=Be(),G=Ke(),Y=aa(),q=sa(),F=n("Priority"),Q=n("Parts"),f=n("Labour"),T=n("Other Resource (optional)"),se=n("Symptom"),N=n("Cause"),p=n(!0),de=n(!1),te=n(!1),W=n(!1),b=n(""),$=n(!1),I=n(!1),L=Ne(u,"visibility"),t=Ne(u,"defectData"),ne=n(),P=n(""),pe=n([""]),D=n([""]),x=n([""]),M=n([""]),H=n([!0]),K=n([""]),J=n([!0]),ve=n(!1),ge=n(!1),ke=n("Defect Information Successfully Submitted"),X=n(!1),k=n(),le=["images","description","priority","instruction","plannedDuration","parts","labours","resources","symptoms","causes"],oe=A(()=>{var l;return((l=c.ImageObjects.find(i=>i.Id=="defect"))==null?void 0:l.ImageInfos)||[]}),ye=A(()=>({images:oe.value,description:u.defectData.Description.value,priority:u.defectData.Priority,instruction:u.defectData.Instruction.value,plannedDuration:u.defectData.PlannedDuration.value,parts:u.defectData.Parts,labours:u.defectData.Labours,resources:u.defectData.Resources,symptoms:u.defectData.Symptoms,causes:u.defectData.Causes})),xe=A(()=>p.value?!1:Xl(le,k.value,ye.value)),De=n(""),be=l=>la(We(l)),fe=A(()=>O.IsError),j=A(()=>"Defect Identified Description"),he=A(()=>"Defect Repair Instructions"),Pe=n(!1),Me=A(()=>u.status=="Decline"||u.plannerStatus=="Decline"),Te=A(()=>u.status=="Acknowledge"),r=l=>{Pe.value=l},v=()=>{ge.value=!1,cl(),p.value=!0,Re()},h=A(()=>{let l;u.plannerApprove?l=u.plannerStatus:l=u.status;const i=l=="Acknowledge",Z=Me.value;return!(i||Z)}),S=async l=>{const i=vt.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(u.plannerApprove?await O.updateDefectDecline(l,!0,u.generic):await O.updateDefectDecline(l,!1,u.generic),i.close(),r(!1),O.IsError){b.value=O.stateErrorMessage,W.value=!0;return}ke.value="Defect Identified Successfully Declined",m()},m=()=>{de.value=!0,setTimeout(()=>{de.value=!1,ct()},1e3)},Re=()=>{t.value.Resources.length==1&&t.value.Resources[0].value==""&&t.value.removeResource(0)},re=n(""),bt=n(),gt=n(""),xt=n([""]),Dt=n([""]),wt=n([""]),kt=n([""]),Ct=n([!0]),$t=n([""]),St=n([!0]),nt=n(al()),rl=()=>{bt.value=E.cloneDeep(ne.value),gt.value=E.cloneDeep(P.value),xt.value=E.cloneDeep(pe.value),Dt.value=E.cloneDeep(D.value),wt.value=E.cloneDeep(x.value),kt.value=E.cloneDeep(M.value),Ct.value=E.cloneDeep(H.value),$t.value=E.cloneDeep(K.value),St.value=E.cloneDeep(J.value),re.value=De.value},cl=()=>{O.setDefectData(u.headerId??""),ne.value=E.cloneDeep(bt.value),P.value=E.cloneDeep(gt.value),pe.value=E.cloneDeep(xt.value),D.value=E.cloneDeep(Dt.value),x.value=E.cloneDeep(wt.value),M.value=E.cloneDeep(kt.value),H.value=E.cloneDeep(Ct.value),K.value=E.cloneDeep($t.value),J.value=E.cloneDeep(St.value),De.value=re.value,t.value.PlannedDuration.isValid=!0,t.value.PlannedDuration.errorMessage=""},il=l=>{t.value.setDescription(l.value),t.value.validateDescription()},dl=l=>{l.target.value=Ge(l.target.value),t.value.setPlannedDuration(We(l.target.value)),t.value.validatePlannedDuration()},ul=l=>{t.value.setInstruction(l.value),t.value.validateInstruction()},Xe=l=>{l.preventDefault(),t.value.Priority!=l.target.value&&(ve.value=!0),t.value.setPriority(l.target.value)},pl=(l,i)=>{l.preventDefault(),t.value.setPartDescription(i,l.target.value),t.value.validatePartDescription(t.value.Parts[i])},vl=(l,i)=>{l.preventDefault(),t.value.setPartQty(i,We(l.target.value)),t.value.validatePartQty(t.value.Parts[i])},ml=l=>{const{value:i,index:Z}=l;t.value.setPartImage(Z,i)},fl=l=>{const{value:i,index:Z}=l;t.value.setPartAttachment(Z,i)},hl=()=>{if(!t.value.Parts.every(i=>i.partDescription!==""&&i.qty!=="")){t.value.validateParts();return}t.value.addPart({partNumber:"",partDescription:"",qty:""})},_l=l=>{t.value.removeParts(l)},yl=l=>{t.value.setLabourActivity(l,pe.value[l]),t.value.validateLaboursActivity(t.value.Labours[l])},bl=(l,i)=>{l.target.value=Ge(l.target.value),t.value.setLabourQty(i,We(l.target.value)),t.value.validateLaboursQty(t.value.Labours[i]),Vt(i)},gl=(l,i)=>{l.target.value=Ge(l.target.value),t.value.setLabourHireEach(i,We(l.target.value)),t.value.validateLaboursHireEach(t.value.Labours[i]),Vt(i)},Vt=l=>{if(!t.value.Labours[l].qty||!t.value.Labours[l].hireEach)return;const i=+t.value.Labours[l].qty,Z=+t.value.Labours[l].hireEach,$e=i*Z;t.value.Labours[l].qty.includes(".")||t.value.Labours[l].hireEach.includes(".")?t.value.setLabourTotalHours(l,$e.toFixed(2).toString()):t.value.setLabourTotalHours(l,$e.toString())},xl=()=>{if(!t.value.Labours.every(i=>i.position!==""&&i.qty!==""&&i.hireEach!==""&&i.totalHours!=="")){t.value.validateLabours();return}t.value.addLabour({position:"",qty:"",hireEach:"",totalHours:""})},Dl=l=>{t.value.removeLabours(l)},rt=l=>{const i=l.which?l.which:l.keyCode;(i<48||i>57)&&(i!==46||l.target.value.indexOf(".")!==-1)&&l.preventDefault()},wl=(l,i)=>{l.preventDefault(),t.value.setResources(i,l.target.value),t.value.validateResource(t.value.Resources[i])},kl=()=>{if(!t.value.Resources.every(i=>i.value!=="")){t.value.validateResources();return}t.value.addResource("")},Cl=l=>{t.value.removeResource(l)},$l=l=>{K.value[l]="",J.value[l]=!0,t.value.setCauses(l,x.value[l]),t.value.validateCause(t.value.Causes[l])},Sl=l=>{l.index!=null&&(K.value[l.index]=l.value)},Vl=()=>{if(!t.value.Causes.every(Z=>Z.value!=="")){t.value.validateCauses();return}const i=x.value.length-1;if(x.value[i]==="Other")if(K.value[i])J.value[i]=!0;else{J.value[i]=!1;return}t.value.addCauses(""),x.value.push(""),K.value.push(""),J.value.push(!0)},Al=l=>{t.value.removeCauses(l),x.value.pop(),K.value.pop(),J.value.pop()},Il=l=>{M.value[l]="",H.value[l]=!0,t.value.setSymptom(l,D.value[l]),t.value.validateSymptom(t.value.Symptoms[l])},Pl=l=>{l.index!=null&&(M.value[l.index]=l.value)},Ml=()=>{if(!t.value.Symptoms.every(Z=>Z.value!=="")){t.value.validateSymptoms();return}const i=D.value.length-1;if(D.value[i]==="Other")if(M.value[i])H.value[i]=!0;else{H.value[i]=!1;return}t.value.addSymptom(""),D.value.push(""),M.value.push(""),H.value.push(!0)},Rl=l=>{t.value.removeSymptom(l),D.value.pop(),M.value.pop(),H.value.pop()},At=l=>{l==="partsSection"?ra("partsSection"):mt(nt.value),p.value=!1,ge.value=!0,t.value.Resources.length==0&&t.value.addResource(""),k.value={images:E.cloneDeep(oe.value),description:E.cloneDeep(u.defectData.Description.value),priority:E.cloneDeep(u.defectData.Priority),instruction:E.cloneDeep(u.defectData.Instruction.value),plannedDuration:E.cloneDeep(u.defectData.PlannedDuration.value),parts:E.cloneDeep(u.defectData.Parts),labours:E.cloneDeep(u.defectData.Labours),resources:E.cloneDeep(u.defectData.Resources),symptoms:E.cloneDeep(u.defectData.Symptoms),causes:E.cloneDeep(u.defectData.Causes)}},Ol=()=>{const l=D.value.length-1;return D.value[l]==="Other"?M.value[l]?H.value[l]=!0:H.value[l]=!1:H.value[l]=!0,H.value[l]},Nl=()=>{const l=x.value.length-1;return x.value[l]==="Other"?K.value[l]?J.value[l]=!0:J.value[l]=!1:J.value[l]=!0,J.value[l]},Bl=()=>{F.value="Priority",Q.value="Parts",f.value="Labour",T.value="Other Resource (optional)",se.value="Symptom",N.value="Cause"},Fl=async()=>{var l;t.value.validateDefectForm(),(l=t.value)!=null&&l.IsValid&&Ol()&&Nl()?!Ze.value||!u.plannerApprove?I.value=!0:$.value=!0:(Bl(),ca())},Tl=()=>{t.value.Symptoms.forEach((l,i)=>{l.value=l.value.includes("Other")?`Other:${M.value[i]}`:l.value})},Ll=()=>{t.value.Causes.forEach((l,i)=>{l.value=l.value.includes("Other")?`Other:${K.value[i]}`:l.value})},It=async()=>{I.value=!1,$.value=!1;const l=vt.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});Tl(),Ll();const i=await O.updateDefectDetail(u.generic);if(fe.value){b.value=i,l.close(),W.value=!0;return}if(await O.updateDefectAcknowledge(u.plannerApprove,u.generic),O.IsError){l.close(),b.value=O.stateErrorMessage,W.value=!0;return}if(fe.value){l.close();return}ve.value===!0?(await O.getDefectsData(u.workOrder??""),O.setDefectData(u.headerId??""),O.setNewDefectKey()):O.setDefectNewData(),l.close(),ke.value="Defect Approved",m()},Pt=()=>{I.value=!1,$.value=!1},ct=()=>{te.value=!1,W.value=!1,b.value!=Je.NO_NETWORK_VIEW&&(Mt(),ee("onRefreshData"))},Mt=()=>{c.clearCurrent(),P.value="",pe.value=[""],D.value=[""],x.value=[""],M.value=[""],H.value=[!0],K.value=[""],J.value=[!0],p.value=!0,ge.value=!1,O.resetErrorStatus(),W.value=!1,b.value="",ee("closeForm")},jl=()=>{mt(nt.value),P.value=u.defectData.Priority,De.value=u.defectData.PlannedDuration.value,pe.value=u.defectData.Labours.map(l=>l.position),D.value=[],M.value=[],H.value=[],u.defectData.Symptoms.forEach(l=>{if(l.value.indexOf(":")>-1){const i=l.value.split(":");D.value.push(i[0]),M.value.push(Ft(l.value)),H.value.push(!0)}else D.value.push(l.value),M.value.push(""),H.value.push(!0)}),x.value=[],K.value=[],J.value=[],u.defectData.Causes.forEach(l=>{if(l.value.indexOf(":")>-1){const i=l.value.split(":");x.value.push(i[0]),K.value.push(Ft(l.value)),J.value.push(!0)}else x.value.push(l.value),K.value.push(""),J.value.push(!0)}),rl(),Lt(ne.value)},El=()=>{c.setShowCloseButton(!1),p.value?ee("closeForm"):xe.value?X.value=!0:ee("closeForm")},Hl=()=>{X.value=!1},Ul=()=>{X.value=!1,ee("closeForm")},ql=A(()=>G.SerialNumber),Wl=A(()=>{const l=G.Ownership;return ft(l)}),Gl=A(()=>{var l,i;return u.generic?(l=t.value)==null?void 0:l.Title:Qe((i=t.value)==null?void 0:i.Title,!0)}),Ze=A(()=>u.defectData.Parts&&u.defectData.Parts.length>0),Rt=A(()=>u.plannerApprove?Ze.value?"Please confirm this defect information is correct.":"Are you sure this defect doesn't require any parts?":Ze.value?"Are you sure all parts have been covered?":"Are you sure this defect doesn't require any parts?"),zl=()=>{I.value=!1,At("partsSection")};return(l,i)=>{const Z=ae("Label"),$e=ae("el-collapse-item"),Le=ae("el-collapse"),it=ae("el-option"),dt=ae("el-select"),Kl=ae("el-dialog");return s(),o(U,null,[d(Kl,{modelValue:L.value,"onUpdate:modelValue":i[11]||(i[11]=et=>L.value=et),"custom-class":`defectform el-defect-crack-form-custom form-defect-yes ${nt.value}`,width:"90%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":El,onClosed:Mt,onOpened:jl,"destroy-on-close":!0},{title:w(()=>[e("span",Aa,[ue("Detailed Information for Defect Identification "),Me.value?(s(),o("span",Ia,"Declined")):Te.value?(s(),o("span",Pa,"Approved")):y("",!0)]),e("span",{class:"el-dialog__title task-title",innerHTML:Gl.value,ref_key:"defectDetailRef",ref:ne},null,8,Ma)]),default:w(()=>{var et,Ot;return[e("div",null,[Me.value?(s(),o("div",Ra,[e("div",Oa,[e("div",Na,[e("div",Ba,[e("div",Fa,[e("div",Ta,C(a.declineReason),1),La])])]),a.declineBy&&a.declineDate?(s(),o("div",ja,C(a.declineBy.name)+", "+C(a.declineDate),1)):y("",!0)])])):Te.value?(s(),o("div",Ea,[e("div",Ha,[e("div",Ua,[e("div",qa,[a.approvedBy&&a.approvedDate?(s(),o("div",Wa,[e("div",Ga,C(a.approvedDate)+" â€” "+C(a.approvedBy.name),1),za])):y("",!0)])])])])):y("",!0),e("div",Ka,[e("div",Ya,[e("div",Qa,[e("div",Ja,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:t.value.AssetNumber},null,8,Xa),Za])]),e("div",es,[e("div",ts,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:ql.value},null,8,ls),as])]),e("div",ss,[e("div",os,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:Wl.value},null,8,ns),rs])])])]),e("div",cs,[d(tl,{id:"defect",disabled:p.value,"allow-delete":!p.value,"is-monitoring":a.viewOnly,"is-mandatory":!1},null,8,["disabled","allow-delete","is-monitoring"])]),e("div",is,[d(Oe,{value:(et=t.value.Description)==null?void 0:et.value,label:j.value,name:"defectPlaceholder",errorMessage:t.value.Description.errorMessage,"is-valid":t.value.Description.isValid,disabled:p.value,onHandleChange:il},null,8,["value","label","errorMessage","is-valid","disabled"])]),e("div",ds,[e("div",us,[e("div",ps,[e("div",vs,[e("input",{type:"text",class:"form-control",disabled:"",value:t.value.RaisedBy},null,8,ms),fs])])])]),e("div",hs,[e("div",_s,[e("div",ys,[e("div",bs,[e("input",{type:"text",class:"form-control",disabled:"",value:t.value.Date},null,8,gs),xs])]),e("div",Ds,[e("div",ws,[e("div",ks,[e("input",{type:"text",class:"form-control",pattern:"[0-9]*",inputmode:"numeric",value:be(t.value.PlannedDuration.value),onInput:dl,disabled:p.value,onKeypress:rt},null,40,Cs),$s]),t.value.PlannedDuration.isValid?y("",!0):(s(),o("div",Ss,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(t.value.PlannedDuration.errorMessage),1)]),_:1})]))]),e("div",Vs,[d(Z,null,{default:w(()=>[ue("Hours")]),_:1})])])])]),e("div",As,[d(Oe,{value:t.value.Instruction.value,label:he.value,name:"InstructionPlaceholder",errorMessage:t.value.Instruction.errorMessage,"is-valid":t.value.Instruction.isValid,disabled:p.value,onHandleChange:ul},null,8,["value","label","errorMessage","is-valid","disabled"])]),Is,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:F.value,"onUpdate:modelValue":i[4]||(i[4]=_=>F.value=_)},{default:w(()=>[d($e,{title:"Priority",name:"Priority"},{default:w(()=>[Ps,e("div",Ms,[e("div",Rs,[e("div",Os,[je(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":i[0]||(i[0]=_=>P.value=_),value:"P1",onChange:ce(Xe,["prevent"]),disabled:p.value},null,40,Ns),[[tt,P.value]]),Bs])]),Fs,Ts]),e("div",Ls,[e("div",js,[e("div",Es,[je(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":i[1]||(i[1]=_=>P.value=_),value:"P2",onChange:ce(Xe,["prevent"]),disabled:p.value},null,40,Hs),[[tt,P.value]]),Us])]),qs,Ws]),e("div",Gs,[e("div",zs,[e("div",Ks,[je(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":i[2]||(i[2]=_=>P.value=_),value:"P3",onChange:ce(Xe,["prevent"]),disabled:p.value},null,40,Ys),[[tt,P.value]]),Qs])]),Js,Xs]),e("div",Zs,[e("div",eo,[e("div",to,[je(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":i[3]||(i[3]=_=>P.value=_),value:"P4",onChange:ce(Xe,["prevent"]),disabled:p.value},null,40,lo),[[tt,P.value]]),ao])]),so,oo])]),_:1})]),_:1},8,["modelValue"]),no,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:Q.value,"onUpdate:modelValue":i[5]||(i[5]=_=>Q.value=_)},{default:w(()=>[d($e,{title:"Parts",name:"Parts",id:"partsSection"},{default:w(()=>[ro,(s(!0),o(U,null,me(t.value.Parts,(_,V)=>(s(),o("div",{class:"row p-3 m-1 priority-container px-0",key:_.partNumber},[e("div",co,[e("div",io,[je(e("input",{type:"text",class:"form-control","onUpdate:modelValue":R=>t.value.Parts[V].partNumber=R,disabled:p.value},null,8,uo),[[ea,t.value.Parts[V].partNumber]]),_.partNumberValidation.isValid?y("",!0):(s(),o("div",po,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.partNumberValidation.message),1)]),_:2},1024)]))])]),e("div",vo,[e("div",mo,[e("input",{type:"text",class:"form-control",value:_.partDescription,onChange:R=>pl(R,V),disabled:p.value},null,40,fo),_.descriptionValidation.isValid?y("",!0):(s(),o("div",ho,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.descriptionValidation.message),1)]),_:2},1024)]))])]),e("div",_o,[e("div",yo,[e("input",{class:"form-control",value:be(_.qty),onInput:R=>vl(R,V),disabled:p.value},null,40,bo),_.qtyValidation.isValid?y("",!0):(s(),o("div",go,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.qtyValidation.message),1)]),_:2},1024)]))])]),e("div",xo,[e("div",Do,[d(ia,{index:V,"item-value":_.images||[],onHandleChangeImage:ml,"is-disabled":p.value},null,8,["index","item-value","is-disabled"])])]),e("div",wo,[e("div",ko,[d(da,{index:V,"item-value":_.attachment||[],onHandleChangeAttachment:fl,"is-disabled":p.value},null,8,["index","item-value","is-disabled"])]),e("div",{class:z(["position-absolute",[p.value?"hidden":""]]),style:{top:"10px",right:"0px"}},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:ce(R=>_l(V),["prevent"])},null,8,Co)],2)])]))),128)),p.value?y("",!0):(s(),o("button",{key:0,class:"my-3 btn-add-new",onClick:hl},[$o,ue(" Add more parts ")]))]),_:1})]),_:1},8,["modelValue"]),So,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:f.value,"onUpdate:modelValue":i[6]||(i[6]=_=>f.value=_)},{default:w(()=>[d($e,{title:"Labour",name:"Labour"},{default:w(()=>[Vo,(s(!0),o(U,null,me(t.value.Labours,(_,V)=>(s(),o("div",{class:"row p-3 m-1 priority-container px-0",key:_.position},[e("div",Ao,[e("div",Io,[d(dt,{modelValue:pe.value[V],"onUpdate:modelValue":R=>pe.value[V]=R,filterable:"",placeholder:"Select Labour",onChange:R=>yl(V),class:"w-100",disabled:p.value},{default:w(()=>[(s(!0),o(U,null,me(g(Y).positionOption,R=>(s(),Ee(it,{key:R.value,label:R.label,value:R.label},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),_.positionValidation.isValid?y("",!0):(s(),o("div",Po,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.positionValidation.message),1)]),_:2},1024)]))])]),e("div",Mo,[e("div",Ro,[e("input",{class:"form-control",value:be(_.qty),onKeypress:rt,onInput:R=>bl(R,V),disabled:p.value},null,40,Oo),_.qtyValidation.isValid?y("",!0):(s(),o("div",No,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.qtyValidation.message),1)]),_:2},1024)]))])]),e("div",Bo,[e("div",Fo,[e("input",{class:"form-control",onKeypress:rt,value:be(_.hireEach),onInput:ce(R=>gl(R,V),["prevent"]),disabled:p.value},null,40,To),_.hireEachValidation.isValid?y("",!0):(s(),o("div",Lo,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.hireEachValidation.message),1)]),_:2},1024)]))])]),e("div",jo,[e("div",Eo,[e("input",{class:"form-control",value:_.totalHours,disabled:""},null,8,Ho),_.totalHoursValidation.isValid?y("",!0):(s(),o("div",Uo,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.totalHoursValidation.message),1)]),_:2},1024)]))]),e("div",{class:z(["ms-4 d-flex align-items-center",[V===0||p.value?"hidden":""]])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:ce(R=>Dl(V),["prevent"])},null,8,qo)],2)])]))),128)),p.value?y("",!0):(s(),o("button",{key:0,class:"my-3 btn-add-new",onClick:xl},[Wo,ue(" Add more labour ")]))]),_:1})]),_:1},8,["modelValue"]),Go,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:T.value,"onUpdate:modelValue":i[7]||(i[7]=_=>T.value=_)},{default:w(()=>[d($e,{title:"Other Resource (optional)",name:"Other Resource (optional)"},{default:w(()=>[(s(!0),o(U,null,me(t.value.Resources,(_,V)=>(s(),o("div",{class:"p-2 d-flex",key:_.value},[e("div",zo,[e("input",{type:"text",class:"form-control",value:_.value,placeholder:"Resource1",onChange:R=>wl(R,V),disabled:p.value},null,40,Ko),_.isValid?y("",!0):(s(),o("div",Yo,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.errorMessage),1)]),_:2},1024)]))]),e("div",{class:z(["ms-4 d-flex align-items-center",[V===0||p.value?"hidden":""]])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:ce(R=>Cl(V),["prevent"])},null,8,Qo)],2)]))),128)),p.value?y("",!0):(s(),o("button",{key:0,class:"my-3 btn-add-new",onClick:kl},[Jo,ue(" Add new resource ")]))]),_:1})]),_:1},8,["modelValue"]),Xo,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:se.value,"onUpdate:modelValue":i[8]||(i[8]=_=>se.value=_)},{default:w(()=>[d($e,{title:"Symptom",name:"Symptom"},{default:w(()=>[(s(!0),o(U,null,me(t.value.Symptoms,(_,V)=>(s(),o("div",{class:"p-2 d-flex",key:_.value},[e("div",Zo,[d(dt,{modelValue:D.value[V],"onUpdate:modelValue":R=>D.value[V]=R,placeholder:"Select Symptom",filterable:"",onChange:R=>Il(V),class:"w-100",disabled:p.value},{default:w(()=>[(s(!0),o(U,null,me(g(q).Symptoms,R=>(s(),Ee(it,{key:R.id,label:R.symptom,value:R.symptom},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),_.isValid?y("",!0):(s(),o("div",en,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.errorMessage),1)]),_:2},1024)])),D.value[V]==="Other"?(s(),o("div",tn,[d(Oe,{value:M.value[V],label:"Description",name:"Description",errorMessage:"Required",disabled:p.value,"is-valid":H.value[V],index:V,onHandleChange:Pl},null,8,["value","disabled","is-valid","index"])])):y("",!0)]),e("div",{class:z(["ms-4 d-flex align-items-center",V===0||p.value?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:ce(R=>Rl(V),["prevent"])},null,8,ln)],2)]))),128)),p.value?y("",!0):(s(),o("button",{key:0,class:"my-3 btn-add-new",onClick:ce(Ml,["prevent"])},[an,ue(" Add another symptom ")]))]),_:1})]),_:1},8,["modelValue"]),sn,d(Le,{class:"task-group general-accordion py-1 px-5",modelValue:N.value,"onUpdate:modelValue":i[9]||(i[9]=_=>N.value=_)},{default:w(()=>[d($e,{title:"Cause",name:"Cause"},{default:w(()=>[(s(!0),o(U,null,me(t.value.Causes,(_,V)=>(s(),o("div",{class:"p-2 d-flex",key:_.value},[e("div",on,[d(dt,{modelValue:x.value[V],"onUpdate:modelValue":R=>x.value[V]=R,placeholder:"Select Cause",filterable:"",onChange:R=>$l(V),class:"w-100",disabled:p.value},{default:w(()=>[(s(!0),o(U,null,me(g(q).Causes,R=>(s(),Ee(it,{key:R.id,label:R.causes,value:R.causes},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"]),_.isValid?y("",!0):(s(),o("div",nn,[d(Z,{class:"error-label"},{default:w(()=>[ue(C(_.errorMessage),1)]),_:2},1024)])),x.value[V]==="Other"?(s(),o("div",rn,[d(Oe,{value:K.value[V],label:"Description",name:"Description",errorMessage:"Required","is-valid":J.value[V],index:V,disabled:p.value,onHandleChange:Sl},null,8,["value","is-valid","index","disabled"])])):y("",!0)]),e("div",{class:z(["ms-4 d-flex align-items-center",V===0||p.value?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:ce(R=>Al(V),["prevent"])},null,8,cn)],2)]))),128)),p.value?y("",!0):(s(),o("button",{key:0,class:"my-3 btn-add-new",onClick:Vl},[dn,ue(" Add another cause ")]))]),_:1})]),_:1},8,["modelValue"]),a.viewOnly?y("",!0):(s(),o(U,{key:2},[h.value?(s(),o("div",un,[ge.value?y("",!0):(s(),o("button",{key:0,class:"btn btn-outline w-100",onClick:i[10]||(i[10]=ce(()=>r(!0),["prevent"])),style:{border:"1px solid #FF4842",background:"white","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"#FF4842"}},"Decline")),ge.value?(s(),o("button",{key:2,class:"btn btn-light w-100 ms-3",onClick:ce(v,["prevent"]),style:{background:"#FFFFFF",border:"1px solid rgba(145, 158, 171, 0.24)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Cancel")):(s(),o("button",{key:1,class:"btn btn-warning w-100 ms-3",onClick:ce(At,["prevent"]),disabled:!p.value,style:{background:"rgb(255, 193, 7)","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"black"}},"Modify",8,pn)),e("button",{class:"ms-3 btn btn-success w-100",onClick:ce(Fl,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Approve")])):y("",!0)],64))]),d(ze,{visibility:$.value,caption:Rt.value,onOnNoConfirm:Pt,onOnYesConfirm:It},null,8,["visibility","caption"]),d(ze,{visibility:I.value,caption:Rt.value,"parts-exist":Ze.value,footerTemplate:"defect",onOnNoConfirm:Pt,onOnYesConfirm:It,onOnAddPart:zl},null,8,["visibility","caption","parts-exist"]),d(ze,{visibility:X.value,caption:"Are you sure want to close the defect form? <br /> Note: By closing the defect form, you will lose your defect data that you have already inputted.",onOnNoConfirm:Hl,onOnYesConfirm:Ul},null,8,["visibility"]),d(pt,{show:te.value,onClose:ct,message:ke.value},null,8,["show","message"]),d(pt,{show:W.value,onClose:ct,message:b.value,icon:"/media/svg/dma/alert.svg"},null,8,["show","message"]),d(oa,{visibility:Pe.value,formTitle:"Are you sure want to decline this defect information?","task-title":(Ot=t.value)==null?void 0:Ot.Title,onCloseForm:r,onSubmitDecline:S,isIntervention:!0,isGeneric:a.generic},null,8,["visibility","task-title","isGeneric"])]}),_:1},8,["modelValue","custom-class"]),d(ll,{show:de.value,message:ke.value},null,8,["show","message"])],64)}}}),sl=Ie(vn,[["__scopeId","data-v-bff575e3"]]),Fe=a=>(Ve("data-v-bef51e50"),a=a(),Ae(),a),mn=Fe(()=>e("span",{class:"el-dialog__title"},"Detailed Information for Defect Identification",-1)),fn=["innerHTML"],hn={class:"d-flex flex-row justify-content-between"},_n={class:"p-2 d-flex flex-row flex-grow-1"},yn={class:"flex-fill"},bn={class:"form-floating"},gn=["innerHTML"],xn=Fe(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),Dn={class:"flex-fill ps-3"},wn={class:"form-floating"},kn=["innerHTML"],Cn=Fe(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),$n={class:"flex-fill ps-3"},Sn={class:"form-floating"},Vn=["innerHTML"],An=Fe(()=>e("label",{for:"floatingInput"},"Ownership",-1)),In={class:"d-flex flex-row justify-content-between"},Pn={class:"mt-1 p-2"},Mn={class:"d-flex flex-column"},Rn={class:"mt-1 p-2"},On={class:"row",style:{width:"101%"}},Nn={class:"col-6 pe-0"},Bn={class:"form-floating"},Fn=["value"],Tn=Fe(()=>e("label",null,"Raised By",-1)),Ln={class:"col-6 pe-0"},jn={class:"form-floating"},En=["value"],Hn=Fe(()=>e("label",null,"Date Raised",-1)),Un=Fe(()=>e("div",{class:"mt-2"},null,-1)),qn={class:"d-flex flex-fill flex-column"},Wn={class:"mt-2"},Gn=Se({__name:"ViewOnlyDefectNoForm",props:{visibility:{required:!0,type:Boolean},defectData:{required:!0,type:Object},isIntervention:{required:!1,type:Boolean,default:!1},generic:{required:!1,type:Boolean,default:!1}},emits:["close"],setup(a,{emit:ie}){const u=a,ee=ie,c=Ye(),O=Ke(),G=ua(),Y=n("Repairs Completed"),q=Ne(u,"visibility"),F=Ne(u,"defectData"),Q=n(),f=n(al()),T=async()=>{c.clearCurrent(),O.resetInstance(),G.resetInstance(),ee("close")},se=()=>{mt(f.value),Lt(Q.value)},N=A(()=>O.SerialNumber),p=A(()=>{const te=O.Ownership;return ft(te)}),de=A(()=>u.generic?F.value.Title:Qe(F.value.Title,u.isIntervention));return(te,W)=>{const b=ae("el-collapse-item"),$=ae("el-collapse"),I=ae("el-dialog");return s(),Ee(I,{modelValue:q.value,"onUpdate:modelValue":W[1]||(W[1]=L=>q.value=L),width:"90%",center:"",onClosed:T,onOpened:se,"destroy-on-close":!0,"custom-class":`el-defect-crack-form-custom form-defect-no-eform-view ${f.value}`},{title:w(()=>[mn,e("span",{class:"el-dialog__title task-title",innerHTML:de.value,ref_key:"defectDetailRef",ref:Q},null,8,fn)]),default:w(()=>[e("div",hn,[e("div",_n,[e("div",yn,[e("div",bn,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:F.value.AssetNumber},null,8,gn),xn])]),e("div",Dn,[e("div",wn,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:N.value},null,8,kn),Cn])]),e("div",$n,[e("div",Sn,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:p.value},null,8,Vn),An])])])]),e("div",In,[d(tl,{id:"defect",disabled:!0,"allow-delete":!1,"is-monitoring":!0,"is-mandatory":!1})]),e("div",Pn,[e("div",Mn,[d(Oe,{value:F.value.Description.value,label:"Defect Identified Description",name:"Defect Identified Description",disabled:!0},null,8,["value"])])]),e("div",Rn,[e("div",On,[e("div",Nn,[e("div",Bn,[e("input",{type:"text",class:"form-control",disabled:"",value:F.value.RaisedBy},null,8,Fn),Tn])]),e("div",Ln,[e("div",jn,[e("input",{type:"text",class:"form-control",disabled:"",value:F.value.Date},null,8,En),Hn])])])]),Un,d($,{class:"task-group general-accordion py-1 px-5",modelValue:Y.value,"onUpdate:modelValue":W[0]||(W[0]=L=>Y.value=L)},{default:w(()=>[d(b,{title:"Repairs Completed",name:"Repairs Completed"},{default:w(()=>[(s(!0),o(U,null,me(F.value.Actions,L=>(s(),o("div",{class:"p-2 d-flex",key:L.value},[e("div",qn,[e("div",Wn,[d(Oe,{value:L.value,label:"Description of Repairs Completed",name:"Description",disabled:!0},null,8,["value"])])])]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","custom-class"])}}}),ol=Ie(Gn,[["__scopeId","data-v-bef51e50"]]),ot=a=>{const ie=a.keyCode?a.keyCode:a.which;(ie<48||ie>57)&&ie!=46&&a.preventDefault()},we=a=>(Ve("data-v-36053860"),a=a(),Ae(),a),zn={class:"mt-5 ps-0"},Kn={class:"row px-2 item mx-1 w-100 defect-panel-header"},Yn=we(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Qn=we(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Jn=we(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},"Priority",-1)),Xn=we(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),Zn=we(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),er=we(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),tr={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},lr={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ar=we(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),sr=[ar],or={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},nr={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},rr={class:"col align-items-center d-flex text-break"},cr=["innerHTML"],ir={class:"col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},dr={class:"text-center",style:{"font-weight":"600",color:"white"}},ur={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},pr=["onClick"],vr=["onClick"],mr={class:"row"},fr={class:"col-8 col-md-8 d-flex flex-column pe-0"},hr=["value","onChange","disabled"],_r={key:0,class:"ms-1 d-flex align-items-center"},yr=we(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),br=we(()=>e("span",null,"Loading...",-1)),gr=[yr,br],xr={class:"col-4 col-md-3 ps-0 pe-1"},Dr=["disabled","onClick"],wr=we(()=>e("i",{class:"fa fa-save"},null,-1)),kr=[wr],Cr={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},$r=["onClick"],Sr=we(()=>e("img",{src:Ut,alt:""},null,-1)),Vr=[Sr],Ar={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Ir=["onClick"],Pr={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Mr=Se({__name:"DefectPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!0,type:Boolean,default:!0},plannerApprove:{required:!1,type:Boolean,default:!1},isAdditionalTask:{required:!1,type:Boolean,default:!1},needConfirm:{required:!1,type:Boolean,default:!0},viewIsDownload:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData"],setup(a,{emit:ie}){const u=a,ee=ie,c=Be(),O=Ye(),G=Gt(),Y=zt(),q=Ke(),F=n(!1),Q=n(u.isAdditionalTask?"Defect Identified (Additional Task)":"Defect Identified"),f=n(Q.value),T=n(!1),se=n(!1),N=n([]),p=n([]),de=n(""),te=n(""),W=n(""),b=n(!1),$=n(),I=n(""),L=n(!1),t=n(),ne=(r,v)=>{const h=!!r.declineReason,S=!!v.declineReason;return h<S?-1:h>S?1:0},P=A(()=>{const r=c.ApprovalData.DefectHeaders;let v=u.supervisor?r.sort(ne):r.filter(h=>["P3","P4"].includes(h.priority)).sort(ne);return u.isAdditionalTask?v.filter(h=>He(h.taskDesc)):v.filter(h=>!He(h.taskDesc))}),pe=A(()=>c.DataFetched),D=A(()=>ht(c.DefectPictures[de.value]));Et(pe,r=>{r===!0&&(p.value=[],P.value.forEach(v=>{p.value.push({id:v.id,wo:v.defectWorkorder})}))}),Ht(()=>{pe.value&&(p.value=[],P.value.forEach(r=>{p.value.push({id:r.id,wo:r.defectWorkorder})}))});const x=n(!1),M=()=>{x.value=!0,F.value=!1,c.stateErrorMessage!=Je.NO_NETWORK_VIEW&&(x.value=!1,c.resetErrorStatus(),xe())},H=r=>{let v=r.createdBy.name,h=r.updatedDate!=""?r.updatedDate:r.createdDate;console.log("data senua",c.ApprovalData);const S=c.ApprovalData.defectDetails.find(m=>m.defectHeaderId==r.id);return S&&S.otherFitterUpdatedBy&&(v=S.otherFitterUpdatedBy.name,st(S.updatedDate)>st(h)&&(h=S.updatedDate)),`${v}, ${h}`},K=r=>{O.setCurrent("defect");const v=c.setDefectData(r);te.value=r,W.value=G.SelectedDefectSheet.interventionId,v!="NO"?T.value=!0:se.value=!0},J=async(r,v)=>{const h=p.value.find(S=>S.id==r);if(h){if(h.wo==="")return;N.value[v]=!0,await c.updateDefectMO(r,h.wo),N.value[v]=!1,c.IsError&&(F.value=!0)}},ve=async(r,v)=>{if(!u.supervisor||!v)return;const h=c.ApprovalData.DefectHeaders.find(S=>S.id===r);if(h){const S=h.repairedStatus=="Repaired"?"Not-Repaired":"Repaired";await c.updateRepairedStatus(r,S)}},ge=r=>{var v;return(v=p.value.find(h=>h.id==r))==null?void 0:v.wo},ke=(r,v)=>{const h=p.value.findIndex(S=>S.id==v);h>=0&&(p.value[h].wo=r.target.value)},X=r=>{r.preventDefault();const v=r.target,h=Ge(v.value).replaceAll(".","");v.value=h},k=r=>r.plannerStatus=="Decline"||r.status=="Decline",le=()=>{T.value=!1},oe=()=>{se.value=!1},ye=()=>{b.value=!1},xe=()=>{ee("onRefreshData")},De=()=>{Y.setIsAttachmentIncludeDownload(!1),fe(),he()},be=()=>{Y.setIsAttachmentIncludeDownload(!0),fe(),he()},fe=()=>{L.value=!1},j=r=>{L.value=!0,t.value={headerId:r}},he=async()=>{I.value="";const{header:r,detail:v}=c.getDefectData(t.value.headerId),h=E.cloneDeep(v);h&&r&&(Y.setIsIntervention(!0),Zt({header:r,detail:h.detail,serialNumber:q.SerialNumber,approvalData:{approvedBy:r.approvedBy,approvedDate:r.approvedDate},ownership:q.Ownership,unitNumber:G.SelectedDefectSheet.equipment,form:G.DefectTitle})&&(I.value=t.value.headerId,$.value.handleDataFetch()))},Pe=r=>r?el(r):!1,Me=r=>r=="Acknowledge",Te=()=>{c.updateDownloadHistory(I.value)};return(r,v)=>{const h=ae("el-collapse-item"),S=ae("el-collapse");return s(),o(U,null,[d(Xt,{ref_key:"downloadPdfDefect",ref:$,onOnDownloadFinish:Te},null,512),e("div",zn,[d(S,{class:"task-group general-accordion py-1 px-5 testing",modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=m=>f.value=m)},{default:w(()=>[d(h,{title:Q.value,name:Q.value},{default:w(()=>[e("div",Kn,[Yn,Qn,Jn,Xn,Zn,er,a.viewIsDownload?(s(),o("div",tr)):y("",!0)]),P.value.length<1?(s(),o("div",lr,sr)):(s(!0),o(U,{key:1},me(P.value,(m,Re)=>(s(),o("div",{key:m.id,class:"item px-2 my-2 mx-1 defect-panel-task"},[e("div",or,[e("div",nr,C(m.taskNo),1),e("div",rr,[e("span",{class:"text-break defect-identified-task",innerHTML:g(Qe)(m.taskDesc,!0)},null,8,cr)]),e("div",ir,[k(m)?y("",!0):(s(),o("div",{key:0,class:z(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",g(Kt)(m.priority)]),style:{"margin-top":"6px"}},[e("span",dr,C(m.priority),1)],2))]),e("div",ur,[k(m)?(s(),o("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:re=>K(m.id)}," Declined ",8,vr)):(s(),o("div",{key:0,class:z(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",g(Yt)(m.id,P.value,!!a.plannerApprove)]),onClick:re=>K(m.id)}," Detailed Information ",10,pr))]),e("div",{class:z(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",m.priority===void 0?"invisible":""])},[e("div",mr,[k(m)?y("",!0):(s(),o(U,{key:0},[e("div",fr,[e("input",{type:"text",class:"form-control mou-input",value:ge(m.id),onChange:re=>{ke(re,m.id)},autocomplete:"off",onInput:ce(X,["prevent"]),placeholder:"Input Work Order",onKeypress:v[0]||(v[0]=(...re)=>g(ot)&&g(ot)(...re)),disabled:a.viewOnly?!0:g(at)(m.id,P.value,a.supervisor)},null,40,hr),N.value[Re]?(s(),o("div",_r,gr)):y("",!0)]),e("div",xr,[e("button",{disabled:a.viewOnly?!0:g(at)(m.id,P.value,a.supervisor),onClick:re=>J(m.id,Re),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},kr,8,Dr)])],64))])],2),e("div",Cr,[k(m)?y("",!0):(s(),o("div",{key:0,class:z(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[g(Qt)(m),g(Jt)(m.priority)]]),style:{"margin-top":"6px"},onClick:re=>ve(m.id,m.priority)},Vr,10,$r))]),a.viewIsDownload?(s(),o("div",Ar,[Me(a.plannerApprove?m.plannerStatus:m.status)?(s(),o("img",{key:0,onClick:re=>j(m.id),class:z(["ms-4 me-2 download-icon",Pe(m.downloadHistory)?"icon-green":"icon-red"]),src:qt,style:{height:"18px"},alt:""},null,10,Ir)):y("",!0)])):y("",!0)]),e("div",Pr,C(H(m)),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),d(sl,{status:g(c).HeaderStatus,"planner-status":g(c).HeaderPlannerStatus,visibility:T.value,"defect-data":g(c).DefectFormData,"header-id":te.value,"work-order":W.value,"view-only":a.viewOnly,"planner-approve":a.plannerApprove,"decline-reason":g(c).DeclineReason,"decline-by":g(c).DeclineBy,"decline-date":g(c).DeclineDate,"approved-by":g(c).ApprovedBy,"approved-date":g(c).ApprovedDate,"need-confirm":a.needConfirm,onCloseForm:le,onOnRefreshData:xe},null,8,["status","planner-status","visibility","defect-data","header-id","work-order","view-only","planner-approve","decline-reason","decline-by","decline-date","approved-by","approved-date","need-confirm"]),d(ol,{visibility:se.value,"is-intervention":!0,"defect-data":g(c).stateDefectNoFormData,onClose:oe},null,8,["visibility","defect-data"]),d(Wt,{type:"defect","re-render":!1,images:D.value,"show-delete-button":!1,visibility:b.value,"is-monitoring":!0,"show-mandatory-caption":!0,onHandleClose:ye},null,8,["images","visibility"]),d(ze,{visibility:L.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:fe,onOnNoConfirm:De,onOnYesConfirm:be},null,8,["visibility"]),d(_t,{visibility:F.value,caption:g(c).stateErrorMessage,onOnClose:M},null,8,["visibility","caption"])],64)}}}),Ed=Ie(Mr,[["__scopeId","data-v-36053860"]]),Ce=a=>(Ve("data-v-6f157ac9"),a=a(),Ae(),a),Rr={class:"mt-5 ps-0"},Or={class:"row px-2 item mx-1 w-100 defect-panel-header"},Nr=Ce(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Br=Ce(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"}," Priority",-1)),Fr=Ce(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"}," Review Status",-1)),Tr=Ce(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"}," Work Order",-1)),Lr=Ce(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),jr={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Er={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Hr=Ce(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),Ur=[Hr],qr={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Wr={class:"col align-items-center d-flex text-break"},Gr=["innerHTML"],zr={class:"col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},Kr={class:"text-center",style:{"font-weight":"600",color:"white"}},Yr={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},Qr=["onClick"],Jr=["onClick"],Xr={class:"row"},Zr={class:"col-8 col-md-8 d-flex flex-column pe-0"},ec=["value","onChange","disabled"],tc={key:0,class:"ms-1 d-flex align-items-center"},lc=Ce(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),ac=Ce(()=>e("span",null,"Loading...",-1)),sc=[lc,ac],oc={class:"col-4 col-md-3 ps-0 pe-1"},nc=["disabled","onClick"],rc=Ce(()=>e("i",{class:"fa fa-save"},null,-1)),cc=[rc],ic={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},dc=["onClick"],uc=Ce(()=>e("img",{src:Ut,alt:""},null,-1)),pc=[uc],vc={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},mc=["onClick"],fc={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},hc=Se({__name:"DefectPanelGeneric",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!0,type:Boolean,default:!0},plannerApprove:{required:!1,type:Boolean,default:!1},needConfirm:{required:!1,type:Boolean,default:!0},viewIsDownload:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData"],setup(a,{emit:ie}){const u=a,ee=ie,c=Be(),O=Ye(),G=Gt(),Y=zt(),q=Ke(),F=n("Generic Defect Identified"),Q=n(F.value),f=n(!1),T=n(!1),se=n([]),N=n([]),p=n(""),de=n(""),te=n(""),W=n(!1),b=n(),$=n(""),I=n(!1),L=n(),t=n(!1),ne=(r,v)=>{const h=!!r.declineReason,S=!!v.declineReason;return h<S?-1:h>S?1:0},P=A(()=>{const r=c.ApprovalData.DefectGenericHeaders;return u.supervisor?r.sort(ne):r.filter(h=>["P3","P4"].includes(h.priority)).sort(ne)}),pe=A(()=>c.DataFetched),D=A(()=>ht(c.DefectPictures[p.value]));Et(pe,r=>{r===!0&&(N.value=[],P.value.forEach(v=>{N.value.push({id:v.id,wo:v.defectWorkorder})}))}),Ht(()=>{pe.value&&(N.value=[],P.value.forEach(r=>{N.value.push({id:r.id,wo:r.defectWorkorder})}))});const x=r=>{let v=r.createdBy.name,h=r.updatedDate!=""?r.updatedDate:r.createdDate;const S=c.ApprovalData.DefectGenericDetails.find(m=>m.defectHeaderId==r.id);return S&&S.otherFitterUpdatedBy&&(v=S.otherFitterUpdatedBy.name,st(S.updatedDate)>st(h)&&(h=S.updatedDate)),`${v}, ${h}`},M=r=>{O.setCurrent("defect");const v=c.setDefectGenericData(r);de.value=r,te.value=G.SelectedDefectSheet.interventionId,v!="NO"?f.value=!0:T.value=!0},H=n(!1),K=()=>{H.value=!0,t.value=!1,c.stateErrorMessage!=Je.NO_NETWORK_VIEW&&(H.value=!1,c.resetErrorStatus(),xe())},J=async(r,v)=>{const h=N.value.find(S=>S.id==r);if(h){if(h.wo==="")return;se.value[v]=!0,await c.updateDefectMO(r,h.wo,!0),se.value[v]=!1,c.IsError&&(t.value=!0)}},ve=async(r,v)=>{if(!u.supervisor||!v)return;const h=c.ApprovalData.DefectGenericHeaders.find(S=>S.id===r);if(h){const S=h.repairedStatus=="Repaired"?"Not-Repaired":"Repaired";await c.updateRepairedStatus(r,S,!0)}},ge=r=>{var v;return(v=N.value.find(h=>h.id==r))==null?void 0:v.wo},ke=(r,v)=>{const h=N.value.findIndex(S=>S.id==v);h>=0&&(N.value[h].wo=r.target.value)},X=r=>{r.preventDefault();const v=r.target,h=Ge(v.value).replaceAll(".","");v.value=h},k=r=>r.plannerStatus=="Decline"||r.status=="Decline",le=()=>{f.value=!1},oe=()=>{T.value=!1},ye=()=>{W.value=!1},xe=()=>{ee("onRefreshData")},De=()=>{Y.setIsAttachmentIncludeDownload(!1),fe(),he()},be=()=>{Y.setIsAttachmentIncludeDownload(!0),fe(),he()},fe=()=>{I.value=!1},j=r=>{I.value=!0,L.value={headerId:r}},he=async()=>{$.value="";const{header:r,detail:v}=c.getDefectGenericData(L.value.headerId),h=E.cloneDeep(v);h&&r&&(Y.setIsIntervention(!0),Zt({header:r,detail:h.detail,serialNumber:q.SerialNumber,approvalData:{approvedBy:r.approvedBy,approvedDate:r.approvedDate},ownership:q.Ownership,unitNumber:G.SelectedDefectSheet.equipment,form:G.DefectTitle})&&($.value=L.value.headerId,b.value.handleDataFetch()))},Pe=r=>r?el(r):!1,Me=r=>r=="Acknowledge",Te=()=>{c.updateDownloadHistory($.value,!0)};return(r,v)=>{const h=ae("el-collapse-item"),S=ae("el-collapse");return s(),o(U,null,[d(Xt,{ref_key:"downloadPdfDefect",ref:b,onOnDownloadFinish:Te},null,512),e("div",Rr,[d(S,{class:"task-group general-accordion py-1 px-5 testing",modelValue:Q.value,"onUpdate:modelValue":v[1]||(v[1]=m=>Q.value=m)},{default:w(()=>[d(h,{title:F.value,name:F.value},{default:w(()=>[e("div",Or,[Nr,Br,Fr,Tr,Lr,a.viewIsDownload?(s(),o("div",jr)):y("",!0)]),P.value.length<1?(s(),o("div",Er,Ur)):(s(!0),o(U,{key:1},me(P.value,(m,Re)=>(s(),o("div",{key:m.id,class:"item px-2 my-2 mx-1 defect-panel-task"},[e("div",qr,[e("div",Wr,[e("span",{class:"text-break",innerHTML:m.taskDesc},null,8,Gr)]),e("div",zr,[k(m)?y("",!0):(s(),o("div",{key:0,class:z(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",g(Kt)(m.priority)]),style:{"margin-top":"6px"}},[e("span",Kr,C(m.priority),1)],2))]),e("div",Yr,[k(m)?(s(),o("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:re=>M(m.id)}," Declined ",8,Jr)):(s(),o("div",{key:0,class:z(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",g(Yt)(m.id,P.value,!!a.plannerApprove)]),onClick:re=>M(m.id)}," Detailed Information ",10,Qr))]),e("div",{class:z(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",m.priority===void 0?"invisible":""])},[e("div",Xr,[k(m)?y("",!0):(s(),o(U,{key:0},[e("div",Zr,[e("input",{type:"text",class:"form-control mou-input",value:ge(m.id),onChange:re=>{ke(re,m.id)},autocomplete:"off",onInput:ce(X,["prevent"]),placeholder:"Input Work Order",onKeypress:v[0]||(v[0]=(...re)=>g(ot)&&g(ot)(...re)),disabled:a.viewOnly?!0:g(at)(m.id,P.value,a.supervisor)},null,40,ec),se.value[Re]?(s(),o("div",tc,sc)):y("",!0)]),e("div",oc,[e("button",{disabled:a.viewOnly?!0:g(at)(m.id,P.value,a.supervisor),onClick:re=>J(m.id,Re),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},cc,8,nc)])],64))])],2),e("div",ic,[k(m)?y("",!0):(s(),o("div",{key:0,class:z(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[g(Qt)(m),g(Jt)(m.priority)]]),style:{"margin-top":"6px"},onClick:re=>ve(m.id,m.priority)},pc,10,dc))]),a.viewIsDownload?(s(),o("div",vc,[Me(a.plannerApprove?m.plannerStatus:m.status)?(s(),o("img",{key:0,onClick:re=>j(m.id),class:z(["ms-4 me-2 download-icon",Pe(m.downloadHistory)?"icon-green":"icon-red"]),src:qt,style:{height:"18px"},alt:""},null,10,mc)):y("",!0)])):y("",!0)]),e("div",fc,C(x(m)),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),d(sl,{status:g(c).HeaderStatus,"planner-status":g(c).HeaderPlannerStatus,visibility:f.value,"defect-data":g(c).DefectFormData,"header-id":de.value,"work-order":te.value,"view-only":a.viewOnly,"planner-approve":a.plannerApprove,"decline-reason":g(c).DeclineReason,"decline-by":g(c).DeclineBy,"decline-date":g(c).DeclineDate,"approved-by":g(c).ApprovedBy,"approved-date":g(c).ApprovedDate,"need-confirm":a.needConfirm,generic:!0,onCloseForm:le,onOnRefreshData:xe},null,8,["status","planner-status","visibility","defect-data","header-id","work-order","view-only","planner-approve","decline-reason","decline-by","decline-date","approved-by","approved-date","need-confirm"]),d(ol,{visibility:T.value,generic:!0,"defect-data":g(c).stateDefectNoFormData,onClose:oe},null,8,["visibility","defect-data"]),d(Wt,{type:"defect","re-render":!1,images:D.value,"show-delete-button":!1,visibility:W.value,"is-monitoring":!0,"show-mandatory-caption":!0,onHandleClose:ye},null,8,["images","visibility"]),d(ze,{visibility:I.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:fe,onOnNoConfirm:De,onOnYesConfirm:be},null,8,["visibility"]),d(_t,{visibility:t.value,caption:g(c).stateErrorMessage,onOnClose:K},null,8,["visibility","caption"])],64)}}}),Hd=Ie(hc,[["__scopeId","data-v-6f157ac9"]]),_e=a=>(Ve("data-v-52e937a1"),a=a(),Ae(),a),_c=_e(()=>e("span",{class:"el-dialog__title",style:{"text-align":"start"}},null,-1)),yc={class:"ps-3"},bc=_e(()=>e("h3",null,"Detailed Information",-1)),gc=_e(()=>e("div",{class:"d-flex flex-row justify-content-between"},[e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",{style:{}},"No")]),e("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",{style:{}},"Measurement Location")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",{style:{}},"Measurement Value")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",{style:{}},"UoM")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",{style:{}},"Rating")])],-1)),xc={class:"d-flex flex-row justify-content-between"},Dc={style:{}},wc=["innerHTML"],kc={style:{}},Cc={key:2,class:"d-flex flex-row justify-content-between"},$c=_e(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Sc=_e(()=>e("div",{class:"col text-start px-2 py-2",style:{}},[e("label",null,"Adjustment")],-1)),Vc=_e(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{}},[e("label")],-1)),Ac={class:"col-2 text-start px-2 py-2",style:{}},Ic={class:"col-1 text-start px-2 py-2",style:{}},Pc={class:"col-2 text-start px-2 py-2",style:{"border-right":"1px solid rgba(145, 158, 171, 0.24)"}},Mc={class:"d-flex flex-row justify-content-between"},Rc=_e(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Oc=_e(()=>e("div",{class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Comment")],-1)),Nc=_e(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Bc={class:"col-5 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Fc=_e(()=>e("h3",{class:"mt-3"},"Detail Spec",-1)),Tc={key:3},Lc={class:"table table-bordered",style:{width:"500px"}},jc=_e(()=>e("thead",null,[e("tr",{style:{background:"#70AD47"}},[e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),e("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Ec={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},Hc={scope:"row",style:{"border-right":"1px solid white"}},Uc={scope:"row",style:{"border-right":"1px solid white"}},qc={scope:"row"},Wc=_e(()=>e("h3",{class:"mt-3"},"Detail Spec Gap",-1)),Gc={class:"table table-bordered",style:{width:"500px"}},zc=_e(()=>e("thead",null,[e("tr",{style:{background:"#70AD47"}},[e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),e("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Kc={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},Yc={scope:"row",style:{"border-right":"1px solid white"}},Qc={scope:"row",style:{"border-right":"1px solid white"}},Jc={scope:"row"},Xc=_e(()=>e("h3",{class:"mt-3"},"Detailed picture",-1)),Zc={class:"row my-4"},ei={class:"bg-secondary"},ti=["src","onClick"],li={key:5,class:"mt-1 py-2",style:{"word-break":"break-word !important"}},ai=_e(()=>e("div",{class:"desc-label"},"Approval Comment",-1)),si={class:"d-flex flex-column"},oi="CBM Successfully Confirmed",ni=Se({__name:"CBMInfo",props:{visibility:{required:!0,type:Boolean},cbmData:{required:!0,type:Object},cbmIsConfirmed:{required:!1,type:Boolean,default:!0},viewOnly:{required:!1,type:Boolean,default:!1}},emits:["closeForm","onApproveCbm"],setup(a,{emit:ie}){const u=a,ee=ie,c=Be(),O=n(),G=n([]),Y=n([]),q=n(""),F=n(!1),Q=Ne(u,"visibility"),f=Ne(u,"cbmData"),T=n([]),se=n(!1),N=n([]),p=n([]),de=n([]),te=n(""),W=n(""),b=n(!0),$=n(!1),I=n(!1),L=n(""),t=A(()=>f.value.taskNo?f.value.taskNo.replace(/[^a-z]/gi,"").length>1?f.value.taskNo.replace(";","").replace(/\D/g,""):f.value.taskNo.replace(";",""):""),ne=A(()=>T.value.filter(k=>k.cbmType!="CBM_GAP")),P=A(()=>T.value.filter(k=>k.cbmType=="CBM_GAP")),pe=()=>{q.value="",F.value=!1},D=X=>{const k=p.value.findIndex(oe=>oe.imgBlob==X),le=p.value[k];if(k>0){const oe=p.value.slice(k),ye=p.value.slice(0,k);p.value=[...oe,...ye]}q.value=le.url,F.value=!0},x=X=>{const k=G.value.find(le=>le.key==X);return(k==null?void 0:k.value)??""},M=async()=>{if(de.value=[],!(N.value.length<1))for(const[X,k]of N.value.entries()){const le={fileUrl:`${k.filename}`,ver:"v1"};try{const oe=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(le).toString()}`,xe=(await pa.getBlob(oe)).data,De=new Blob([xe]),fe=(window.URL||window.webkitURL).createObjectURL(De);G.value.push({key:k.filename,value:fe}),p.value.forEach(j=>{j.imgBlob==k.filename&&(j.url=fe)}),Y.value[X]=!1}catch(oe){console.log("image",oe)}}},H=()=>{ee("closeForm")},K=async()=>{N.value=[],p.value=[],te.value="",W.value="",b.value=!0;const X=await Tt.interventionDetailView.where({id:f.value.interventionId}).first();if(X&&(X.details[0].tasks.every(oe=>(O.value=oe.tasks.find(ye=>ye.key==f.value.taskId),!O.value)),O.value)){const oe=await Tt.cbmMapping.where({model:X.equipmentModel,psType:O.value.psType}).first(),ye=oe==null?void 0:oe.detail.filter(xe=>xe.taskKey==f.value.taskId);T.value=E.orderBy(ye,["uom","cbmRating","minValue"])}const k=await c.getDefectImages(f.value.interventionId??"",f.value.taskId,f.value.cbmImageProp);N.value=ht(k),Y.value=Array.apply(null,Array(N.value.length)).map(function(){return!0}),p.value=N.value.map(le=>({imgBlob:le.filename,url:"",description:le.description})),await M(),se.value=!1},J=X=>{te.value=X.value,W.value="",b.value=!0},ve=()=>{if(ma.isSPVPlannerMandatoryInputCommentOnApproveCBM&&!te.value){W.value="Approval Comment is required",b.value=!1;return}const X=vt.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});ee("onApproveCbm",{headerId:u.cbmData.id,reason:te.value,callback:(k,le)=>{X.close(),k?(L.value=le,I.value=!0):ke()}})},ge=()=>{I.value=!1,L.value!=Je.NO_NETWORK_VIEW&&H()},ke=()=>{$.value=!0,setTimeout(()=>{$.value=!1,ge()},1e3)};return(X,k)=>{const le=ae("el-input"),oe=ae("el-skeleton-item"),ye=ae("el-skeleton"),xe=ae("el-dialog"),De=ta("loading");return s(),o(U,null,[d(xe,{modelValue:Q.value,"onUpdate:modelValue":k[5]||(k[5]=be=>Q.value=be),"custom-class":"crackform dialog-header-noborder",width:"90%",center:"",onClosed:H,onOpened:K,"destroy-on-close":!0},{title:w(()=>[_c]),default:w(()=>{var be,fe;return[e("div",null,[je((s(),o("div",yc,[bc,a.cbmData.appSPVBy?(s(),o(U,{key:0},[d(lt,{message:`${a.cbmData.appSPVDate} - ${a.cbmData.appSPVBy.name}`,"placeholder-message":"Approved by Supervisor"},null,8,["message"]),a.cbmData.approveReason?(s(),Ee(lt,{key:0,message:`${a.cbmData.approveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):y("",!0)],64)):y("",!0),a.cbmData.appPlannerBy?(s(),o(U,{key:1},[d(lt,{message:`${a.cbmData.appPlannerDate} - ${a.cbmData.appPlannerBy.name}`,"placeholder-message":"Approved by Planner"},null,8,["message"]),a.cbmData.plannerApproveReason?(s(),Ee(lt,{key:0,message:`${a.cbmData.plannerApproveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):y("",!0)],64)):y("",!0),gc,e("div",xc,[e("div",{class:"col-1 text-center px-2 py-2",style:qe([f.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);",{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}])},[e("label",Dc,C(t.value),1)],4),e("div",{class:"col text-start px-2 py-2",style:qe(f.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",{style:{},innerHTML:f.value.taskDesc.split(";").length>3?(be=f.value.taskDesc)==null?void 0:be.split(";")[2]:f.value.taskDesc},null,8,wc)],4),e("div",{class:"col-2 text-start px-2 py-2",style:qe(f.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[d(le,{size:"small",modelValue:f.value.cbmMeasurement,"onUpdate:modelValue":k[0]||(k[0]=j=>f.value.cbmMeasurement=j),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:qe(f.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",kc,C(((fe=T.value[0])==null?void 0:fe.uom)??f.value.cbmUom),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:qe([f.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);",{"border-right":"1px solid rgba(145, 158, 171, 0.24)"}])},[d(le,{size:"small",class:z(["dark-text-primary",f.value.taskValue==="C"?"c":"x"]),modelValue:f.value.taskValue,"onUpdate:modelValue":k[1]||(k[1]=j=>f.value.taskValue=j),disabled:!0},null,8,["modelValue","class"])],4)]),f.value.correctedValue?(s(),o("div",Cc,[$c,Sc,Vc,e("div",Ac,[d(le,{size:"small",class:"dark-text-primary",modelValue:f.value.correctedMeasurement,"onUpdate:modelValue":k[2]||(k[2]=j=>f.value.correctedMeasurement=j),disabled:!0},null,8,["modelValue"])]),e("div",Ic,[e("label",null,C(f.value.correctedUom),1)]),e("div",Pc,[d(le,{size:"small",class:z(["dark-text-primary",f.value.correctedValue.toLowerCase()]),modelValue:f.value.correctedValue,"onUpdate:modelValue":k[3]||(k[3]=j=>f.value.correctedValue=j),disabled:!0},null,8,["modelValue","class"])])])):y("",!0),e("div",Mc,[Rc,Oc,Nc,e("div",Bc,[d(le,{size:"small",class:"dark-text-primary",modelValue:f.value.commentValue,"onUpdate:modelValue":k[4]||(k[4]=j=>f.value.commentValue=j),disabled:!0},null,8,["modelValue"])])]),Fc,P.value.length==0?(s(),o("div",Tc,[e("table",Lc,[jc,e("tbody",null,[(s(!0),o(U,null,me(ne.value,(j,he)=>(s(),o("tr",{key:he,class:z(he%2==0?"even":"odd")},[e("th",Ec,C(j.cbmRating),1),e("th",Hc,C(j.minValueComplete),1),e("th",Uc,C(j.maxValueComplete),1),e("th",qc,C(j.uom),1)],2))),128))])])])):y("",!0),P.value.length>0?(s(),o(U,{key:4},[Wc,e("div",null,[e("table",Gc,[zc,e("tbody",null,[(s(!0),o(U,null,me(P.value,(j,he)=>(s(),o("tr",{key:he,class:z(he%2==0?"even":"odd")},[e("th",Kc,C(j.cbmRating),1),e("th",Yc,C(j.minValueComplete),1),e("th",Qc,C(j.maxValueComplete),1),e("th",Jc,C(j.uom),1)],2))),128))])])])],64)):y("",!0),Xc,e("div",Zc,[(s(!0),o(U,null,me(N.value,(j,he)=>(s(),o("div",{class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative",key:j.filename},[d(ye,{loading:Y.value[he],animated:""},{template:w(()=>[d(oe,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:w(()=>[e("div",ei,[x(j.filename)!=null?(s(),o("img",{key:0,src:x(j.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:Pe=>D(j.filename)},null,8,ti)):y("",!0)])]),_:2},1032,["loading"])]))),128))]),!a.cbmIsConfirmed&&!a.viewOnly?(s(),o("div",li,[ai,e("div",si,[d(Oe,{value:te.value??"","disable-floating":!0,name:"approveReason",max:255,"is-valid":b.value,"error-message":W.value,onHandleChange:J},null,8,["value","is-valid","error-message"])]),e("button",{class:"mt-2 btn btn-success w-100",onClick:ce(ve,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Approve")])):y("",!0)])),[[De,se.value]])])]}),_:1},8,["modelValue"]),d(va,{images:p.value,visibility:F.value,image:q.value,onHandleClose:pe},null,8,["images","visibility","image"]),d(ll,{show:$.value,message:oi},null,8,["show"]),d(pt,{show:I.value,onClose:ge,message:L.value,icon:"/media/svg/dma/alert.svg"},null,8,["show","message"])],64)}}}),ri=Ie(ni,[["__scopeId","data-v-52e937a1"]]),nl=a=>(Ve("data-v-9cf9df32"),a=a(),Ae(),a),ci={class:"mt-5 ps-0"},ii=nl(()=>e("div",{class:"row px-2 item mx-1 w-100 defect-panel-header"},[e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"}," Task"),e("div",{class:"col align-items-center d-flex text-break"},"Task Description"),e("div",{class:"col align-items-center d-flex text-break"},"Comments"),e("div",{class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"}," Rating"),e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"}," Review Status")],-1)),di={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ui=nl(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),pi=[ui],vi={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},mi={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},fi={class:"col align-items-center d-flex text-break"},hi=["innerHTML"],_i={class:"col align-items-center d-flex text-break"},yi={class:"text-break"},bi={class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},gi={style:{"font-weight":"600",color:"white"}},xi={style:{"font-weight":"600",color:"white"}},Di={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},wi=["onClick"],ki={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Ci=Se({__name:"CBMPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},plannerApprove:{required:!1,type:Boolean,default:!1},headers:{required:!0,type:[]},isDisabled:{required:!1,type:Boolean,default:!1},isAdditionalTask:{required:!1,type:Boolean,default:!1},defectStatus:{required:!1,type:String,default:""}},emits:["onRefreshData"],setup(a,{emit:ie}){const u=a,ee=ie,c=Be(),O=n([]),G=n(u.isAdditionalTask?"Component Condition Data (Additional Task)":"Component Condition Data"),Y=n(G.value),q=n(),F=n(!1),Q=Ne(u,"headers"),f=n(!1),T=A(()=>u.isAdditionalTask?Q.value.filter(b=>He(b.taskDesc)):Q.value.filter(b=>!He(b.taskDesc))),se=A(()=>{var b,$;return u.plannerApprove?((b=q.value)==null?void 0:b.plannerCbmNAStatus)==="Confirmed":(($=q.value)==null?void 0:$.cbmNAStatus)==="Confirmed"});T.value.forEach(()=>{O.value.push(!1)});const N=b=>{const $=T.value.find(I=>I.id===b);q.value=$,F.value=!0},p=async b=>{try{c.ApprovalData.CBMHeaders.find(I=>I.id===b.headerId)&&(await c.updateCBMConfirmedStatus(b.headerId,u.plannerApprove,b.reason),b.callback&&(ee("onRefreshData"),b.callback(c.IsError,c.ErrorMessage)))}catch($){console.log($)}},de=()=>{f.value=!1,c.stateErrorMessage!=Je.NO_NETWORK_VIEW&&(c.resetErrorStatus(),te())},te=()=>{ee("onRefreshData")},W=()=>{F.value=!1};return(b,$)=>{const I=ae("el-collapse-item"),L=ae("el-collapse");return s(),o(U,null,[e("div",ci,[d(L,{class:"task-group general-accordion py-1 px-5 testing",modelValue:Y.value,"onUpdate:modelValue":$[0]||($[0]=t=>Y.value=t)},{default:w(()=>[d(I,{title:G.value,name:G.value},{default:w(()=>[ii,T.value.length<1?(s(),o("div",di,pi)):(s(!0),o(U,{key:1},me(T.value,t=>{var ne;return s(),o("div",{key:t.id,class:"item px-2 my-2 mx-1"},[e("div",vi,[e("div",mi,C(g(Yl)(t.taskNo.replace(";",""))),1),e("div",fi,[e("span",{class:"text-break defect-identified-task",innerHTML:g(Ql)(t.taskDesc.split(";").length>3?(ne=t.taskDesc)==null?void 0:ne.split(";")[2]:t.taskDesc,t.taskNo.replace(";",""))},null,8,hi)]),e("div",_i,[e("span",yi,C(t.commentValue),1)]),e("div",bi,[e("div",{class:z(["little-box d-flex justify-content-center align-items-center px-2",g(Nt)(t.taskValue)])},[e("span",gi,C(t.taskValue),1)],2),t.correctedValue?(s(),o("div",{key:0,class:z(["little-box d-flex justify-content-center align-items-center px-2 ms-1",g(Nt)(t.correctedValue)])},[e("span",xi,C(t.correctedValue),1)],2)):y("",!0)]),e("div",Di,[e("div",{class:z(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",g(jt)(t.id,a.headers,!a.plannerApprove,"cbmNAStatus","plannerCbmNAStatus",a.isDisabled,a.defectStatus)]),onClick:ce(P=>N(t.id),["prevent"])}," Detailed Information ",10,wi)])]),e("div",ki,C(t.createdBy.name)+", "+C(t.updatedDate!=""?t.updatedDate:t.createdDate),1)])}),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),d(ri,{visibility:F.value,"cbm-data":q.value,"view-only":a.viewOnly,"cbm-is-confirmed":se.value,onCloseForm:W,onOnApproveCbm:p},null,8,["visibility","cbm-data","view-only","cbm-is-confirmed"]),d(_t,{visibility:f.value,caption:g(c).stateErrorMessage,onOnClose:de},null,8,["visibility","caption"])],64)}}}),Ud=Ie(Ci,[["__scopeId","data-v-9cf9df32"]]),Ue=a=>(Ve("data-v-17743664"),a=a(),Ae(),a),$i={class:"mt-5 ps-0"},Si={class:"row px-2 item mx-1 w-100 defect-panel-header"},Vi=Ue(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Ai=Ue(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Ii=Ue(()=>e("div",{class:"col align-items-center d-flex text-break"},"Comments",-1)),Pi={key:0,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},Mi={key:1,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},Ri={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Oi=Ue(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),Ni=[Oi],Bi={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Fi={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},Ti={class:"col align-items-center d-flex text-break"},Li=["innerHTML"],ji={class:"col align-items-center d-flex text-break"},Ei={class:"text-break"},Hi=["onClick"],Ui=["onClick"],qi={key:0,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},Wi={key:1,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent justify-content-center align-items-center d-flex"},Gi=["onClick"],zi={key:1,src:fa,style:{width:"28px"},alt:""},Ki={key:2,class:"ms-1 d-flex align-items-center"},Yi=Ue(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),Qi=Ue(()=>e("span",null,"Loading...",-1)),Ji=[Yi,Qi],Xi={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Zi=Se({__name:"NAPanel",props:{title:{required:!0,type:String},headers:{required:!0,type:[]},plannerApprove:{required:!1,type:Boolean,default:!1},isAdditionalTask:{required:!1,type:Boolean,default:!1},isDisabled:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData","onGetPositionY"],setup(a,{emit:ie}){const u=a,ee=ie,c=Be(),O=n(),G=n([]),Y=A(()=>u.title);u.headers.forEach(()=>{G.value.push(!1)});const q=A(()=>u.isAdditionalTask?u.headers.filter(b=>He(b.taskDesc)):u.headers.filter(b=>!He(b.taskDesc))),F=n(!1),Q=()=>{F.value=!1},f=A(()=>!u.plannerApprove),T=b=>{ee("onGetPositionY"),N.value=void 0,p.value=void 0;const $=b.id,I=c.ApprovalData.DefectNADetails.find(t=>t.defectHeaderId==$);let L=b;I&&(F.value=!0,N.value=L,p.value=I)},se=async(b,$)=>{if(!Bt()||u.isDisabled)return;const I=c.ApprovalData.DefectNAHeaders.find(L=>L.id===b);if(I){if(G.value[$]=!0,u.plannerApprove){if(I.plannerCbmNAStatus==="Confirmed")return;await c.updateDefectConfirmedStatus(b,!0),G.value[$]=!1}else{if(I.cbmNAStatus==="Confirmed")return;await c.updateDefectConfirmedStatus(b,!1)}O.value.handleErrorMessage(c.stateIsError,c.stateErrorMessage),G.value[$]=!1}},N=n(),p=n(),de=async b=>{await c.updateDefectDeclineStatus(b.headerId,u.plannerApprove,b.reason),b.afterSubmit(c.stateIsError,c.stateErrorMessage)},te=async b=>{const{headerId:$,reason:I="",afterSubmit:L}=b;await c.updateDefectConfirmedStatus($,u.plannerApprove,I),L(c.stateIsError,c.stateErrorMessage)},W=()=>{ee("onRefreshData")};return(b,$)=>{const I=ae("el-collapse-item"),L=ae("el-collapse");return s(),o(U,null,[e("div",$i,[d(L,{class:"task-group general-accordion py-1 px-5 testing",modelValue:Y.value,"onUpdate:modelValue":$[0]||($[0]=t=>Y.value=t)},{default:w(()=>[d(I,{title:a.title,name:a.title},{default:w(()=>[e("div",Si,[Vi,Ai,Ii,e("div",{class:z([[f.value?"col justify-content-end pe-16":"col-1 justify-content-center"],"column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex"])},"Review Status",2),f.value?y("",!0):(s(),o("div",Pi)),f.value?y("",!0):(s(),o("div",Mi,"Confirmed"))]),q.value.length<1?(s(),o("div",Ri,Ni)):(s(!0),o(U,{key:1},me(q.value,(t,ne)=>(s(),o("div",{key:t.id,class:"item px-2 my-2 mx-1"},[e("div",Bi,[e("div",Fi,C(t.taskNo.replace(";","")),1),e("div",Ti,[e("span",{class:"text-break defect-identified-task",innerHTML:g(Qe)(t.taskDesc,!0)},null,8,Li)]),e("div",ji,[e("span",Ei,C(t.commentValue),1)]),e("div",{class:z([[f.value?"col justify-content-end":"col-1 justify-content-center"],"column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex"])},[t.plannerCbmNAStatus=="Decline"||t.cbmNAStatus=="Decline"?(s(),o("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:P=>T(t)}," Declined ",8,Hi)):(s(),o("div",{key:1,class:z(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",g(jt)(t.id,a.headers,!0,"cbmNAStatus","plannerCbmNAStatus")]),onClick:ce(P=>T(t),["prevent"])}," Detailed Information ",10,Ui))],2),f.value?y("",!0):(s(),o("div",qi)),f.value?y("",!0):(s(),o("div",Wi,[t.cbmNAStatus!="Decline"?(s(),o("div",{key:0,class:z(["mx-10 little-box rounded-circle d-flex justify-content-center align-items-center flex-fill cbm-confirm-checkbox flex-column",g(ut)(t.id,a.headers,a.plannerApprove)&&g(Bt)()?a.isDisabled?"not-allowed":"dot":"not-allowed"])},[g(ut)(t.id,q.value,a.plannerApprove)?(s(),o("div",{key:0,class:"little-dot",onClick:P=>se(t.id,ne)},null,8,Gi)):y("",!0),g(ut)(t.id,q.value,a.plannerApprove)?y("",!0):(s(),o("img",zi)),G.value[ne]?(s(),o("div",Ki,Ji)):y("",!0)],2)):y("",!0)]))]),e("div",Xi,C(t.createdBy.name)+", "+C(t.updatedDate!=""?t.updatedDate:t.createdDate),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),d(na,{ref_key:"NAFormComponent",ref:O,"view-only":a.isDisabled||!f.value,visibility:F.value,"na-data-header":N.value,"na-data-detail":p.value,"is-intervention":!0,onOnSubmitDecline:de,onOnSubmitConfirm:te,onOnRefreshData:W,onClose:Q},null,8,["view-only","visibility","na-data-header","na-data-detail"])],64)}}}),qd=Ie(Zi,[["__scopeId","data-v-17743664"]]);export{Ud as C,jd as D,qd as N,ol as V,Ed as a,Hd as b,sl as c,ot as o};
