import{u as bt}from"./vuex-BbOKrtVp.js";import{b as st}from"./vue-router-iNp9kJ0K.js";import{a as Ct}from"./breadcrumb-D-Q4Tk9w.js";import{b as V,u as $,s as O,i as X,h as rt,j as Y,A as Et}from"./index-BCnwA6yE.js";import{P as yt}from"./Pagination-CVDIvnOM.js";import{F as wt}from"./FilterIconButton-Bj0WTbms.js";import{h as It,A as Pt,U as Ft}from"./excel-generator-CRLIz6fw.js";import{D as Lt}from"./DownloadIconButton-CIQp-YG7.js";import{k as j,c as I,r as N,u as r,y as G,p as T,aa as P,s,x as d,T as Tt,q as E,F as kt,Y as nt,R,A as at,aB as p,C as x,P as mt,a0 as it,B as A,bd as Ut,bb as xt,a7 as At,L as $t}from"./@vue-BypzYtbH.js";import{_ as b,b as ft}from"./element-plus-C5R56mia.js";import{f as M,n as w,a as J,b as Rt}from"./date-format-BASVuupi.js";import{P as Q,b as ht,a as Bt,d as Mt}from"./table-sort-VnBD5Hfa.js";import{d as lt}from"./pinia-BjOS2_Ao.js";import{m as Vt}from"./mapOption-sP4IrA4W.js";import{c as vt,a as W,b as Z,d as _t}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as St}from"./ErrorAlert-CMKGfwAi.js";import{_ as tt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as et}from"./ElementTextInput.vue_vue_type_style_index_0_lang-kzHysIyZ.js";import{a as Ot}from"./vee-validate-C_msoaAA.js";import{e as Nt}from"./lodash-Cr9vlq0V.js";import{_ as Ht}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as qt}from"./map-anything-abi6NY2Z.js";import{_ as zt}from"./nw-img-vue-CR837WER.js";import{_ as jt}from"./AutoComplete.vue_vue_type_style_index_0_lang-CRR6Z--K.js";import{_ as Dt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as Kt}from"./file-saver-DhbZvGod.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const H="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_risk_management_type_task",Gt=`${H}/risk_management_type_task`,Yt=`${H}/risk_management_type_task_bulk`,Xt=`${H}/validate_upload`,Jt=`${H}/export`,Qt=`${H}/lookup`,Wt=`${H}/risk_management_type_task`,Zt=`${H}/risk_management_type_task/update`,ot={taskTypeCode:"",taskTypeCodeTo:"",startDate:"",startDateTo:"",endDate:"",endDateTo:"",ver:"v1",page:1,pageSize:10,order:""},dt=lt({id:"managementTaskTypeList",state:()=>({stateFilterData:{...ot},stateLastUsedFilterData:{...ot},statePageName:"managementTaskType",stateDisplayData:[],statePagination:new Q,stateLoading:!1,statePaginationLoading:!1,stateTaskTypeCodeOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,taskTypeCodeOption:t=>t.stateTaskTypeCodeOption},actions:{async getData(t=!0){const o={taskTypeCode:this.stateFilterData.taskTypeCode,taskTypeCodeTo:this.stateFilterData.taskTypeCodeTo,startDate:this.stateFilterData.startDate?M(w(new Date(this.stateFilterData.startDate))):"",startDateTo:this.stateFilterData.startDateTo?M(w(new Date(this.stateFilterData.startDateTo))):"",endDate:this.stateFilterData.endDate?M(w(new Date(this.stateFilterData.endDate))):"",endDateTo:this.stateFilterData.endDateTo?M(w(new Date(this.stateFilterData.endDateTo))):"",page:this.stateFilterData.page.toString(),pageSize:this.stateFilterData.pageSize.toString(),order:this.stateFilterData.order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await V.get(Gt,"",new URLSearchParams(o).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){e.response.data.statusCode==401&&$().setLoggedIn(!1),O("IRONS",e),console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const o=await V.get(Qt,"",new URLSearchParams(t).toString());this.stateTaskTypeCodeOption=Vt(o.data.result.content,"taskTypeCode","taskTypeDescription")}catch(o){o.response.data.statusCode==401&&$().setLoggedIn(!1),O("IRONS",o),console.log(o)}},async export(){const t={ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await V.getBlob(Jt,"",new URLSearchParams(t).toString())).data}catch(o){O("IRONS",o),console.log(o)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:o}){if(!t&&!o)this.stateFilterData.order="";else{const e=o=="ascending"?"asc":"desc";this.stateFilterData.order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1)},setTaskTypeCode(t){this.stateFilterData.taskTypeCode=t},setTaskTypeCodeTo(t){this.stateFilterData.taskTypeCodeTo=t},setTaskTypeDescription(t){this.stateFilterData.taskTypeDescription=t},setTaskTypeDescriptionTo(t){this.stateFilterData.taskTypeDescriptionTo=t},setStartDate(t){this.stateFilterData.startDate=t},setStartDateTo(t){this.stateFilterData.startDateTo=t},setEndDate(t){this.stateFilterData.endDate=t},setEndDateTo(t){this.stateFilterData.endDateTo=t},async resetFilter(){this.stateFilterData.taskTypeCode="",this.stateFilterData.taskTypeCodeTo="",this.stateFilterData.startDate="",this.stateFilterData.startDateTo="",this.stateFilterData.endDate="",this.stateFilterData.endDateTo="";const t=this.stateLastUsedFilterData.taskTypeCode!=="",o=this.stateLastUsedFilterData.taskTypeCodeTo!=="",e=this.stateLastUsedFilterData.startDate!=="",g=this.stateLastUsedFilterData.startDateTo!=="",n=this.stateLastUsedFilterData.endDate!=="",a=this.stateLastUsedFilterData.endDateTo!=="";(t||o||e||g||n||a)&&await this.getData()},resetState(){this.stateFilterData={...ot},this.stateDisplayData=[],this.statePagination=new Q,this.stateLoading=!1,this.statePaginationLoading=!1}}}),gt={riskManagementTaskTypeId:0,taskTypeCode:"",taskTypeDescription:"",startDate:w(new Date),endDate:w(new Date("12/31/9999"))},pt=lt({id:"managementTaskTypeForm",state:()=>({stateFormData:{...gt},stateIsError:!1,stateError:"",stateErrors:[],stateIsEdit:!1,stateLoading:!1}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading,isEdit:t=>t.stateIsEdit},actions:{async insertData(t){try{this.stateLoading=!0;const o={userAccount:t,ver:"v1"},e={riskManagementTaskTypeId:0,taskTypeCode:this.stateFormData.taskTypeCode,taskTypeDescription:this.stateFormData.taskTypeDescription,startDate:M(w(new Date(this.stateFormData.startDate))),endDate:M(w(new Date(this.stateFormData.endDate)))},g=await V.post(`${Wt}?${new URLSearchParams(o).toString()}`,e);g.data.title==="Error"?(this.stateErrors.push(g.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(o){o.response.data.statusCode==401&&$().setLoggedIn(!1),this.stateError=o,this.stateErrors.push(o.response.data.result.message),this.stateIsError=!0,O("IRONS",o)}this.stateLoading=!1},async updateData(t){try{this.stateLoading=!0;const o={userAccount:t,ver:"v1"},e={riskManagementTaskTypeId:this.stateFormData.riskManagementTaskTypeId,taskTypeCode:this.stateFormData.taskTypeCode,taskTypeDescription:this.stateFormData.taskTypeDescription,startDate:M(w(new Date(this.stateFormData.startDate))),endDate:M(w(new Date(this.stateFormData.endDate)))},g=await V.post(`${Zt}?${new URLSearchParams(o).toString()}`,e);g.data.title==="Error"?(this.stateErrors.push(g.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(o){o.response.data.statusCode==401&&$().setLoggedIn(!1),this.stateError=o,this.stateErrors.push(o.response.data.result.message),this.stateIsError=!0,O("IRONS",o)}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.riskManagementTaskTypeId=t.riskManagementTaskTypeId,this.stateFormData.taskTypeCode=t.taskTypeCode,this.stateFormData.taskTypeDescription=t.taskTypeDescription,this.stateFormData.startDate=t.startDate,this.stateFormData.endDate=t.endDate},setIsEdit(t){this.stateIsEdit=t},resetState(){this.stateFormData={...gt},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),te={key:0,style:{height:"100px"}},ee={key:1},ae={key:1},se={key:1},oe={key:1},re={key:0,class:"row justify-content-center"},ne={key:1,class:"row justify-content-center"},ie={key:0,class:"d-flex justify-content-end"},le=["disabled","onClick"],de={key:1,class:"d-flex"},pe=j({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["fetch-data"],setup(t,{emit:o}){const e=t,g=$(),n=dt(),a=pt(),u=o,m=I(()=>a.isEdit),C=I(()=>(e.page-1)*10+1),k=N(""),f=y=>{k.value=y.order;const S={prop:y.prop,order:y.order};n.setSort(S)},_=N({riskManagementTaskTypeId:0,taskTypeCode:"",taskTypeDescription:"",startDate:w(new Date),endDate:w(new Date("12/31/9999"))}),h=N({riskManagementTaskTypeId:0,taskTypeCode:"",taskTypeDescription:"",startDate:w(new Date),endDate:w(new Date("12/31/9999"))}),L=y=>{i(),h.value={...y}},F=()=>{a.setIsEdit(!1),a.resetState(),i(),setTimeout(()=>{h.value=Object.assign({},_.value)},300)},U=vt().shape({taskTypeCode:W().required("Task Type Code is mandatory"),taskTypeDescription:W().required("Task Type Description is mandatory"),startDate:Z().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:Z().required("End Date is mandatory").min(_t("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),i=()=>{a.setErrors([])},D=I(()=>a.isError),c=I(()=>a.errors),l=async()=>{a.setIsEdit(!0),i(),await U.validate(h.value,{abortEarly:!1}).catch(y=>{a.setErrors(y.errors),window&&window.scrollTo(0,0)}),!D.value&&X("Are you sure you want to submit ?").then(async y=>{y.isConfirmed&&(a.setFormData(h.value),a.updateData(g.user.Name).then(()=>{a.isError||rt("Form has been successfully submitted!","Ok").then(()=>{F(),u("fetch-data",null)})}))})};return(y,S)=>{const B=R("inline-svg"),q=R("el-tooltip"),K=nt("loading");return r(n).loading?G((T(),P("div",te,null,512)),[[K,r(n).loading]]):(T(),P(kt,{key:1},[s(Tt,{name:"fade"},{default:d(()=>[D.value&&m.value?(T(),E(St,{key:0,errorMessages:c.value,onResetForm:i},null,8,["errorMessages"])):at("",!0)]),_:1}),G((T(),E(r(ft),{data:e.listData,style:{width:"100%"},onSortChange:f,"empty-text":"No Data"},{default:d(()=>[s(r(b),{label:"No",width:"90",align:"center"},{default:d(v=>[p("span",null,x(C.value+v.$index),1)]),_:1}),s(r(b),{prop:"taskTypeCode",label:"Task Type Code","min-width":"170",sortable:"","sort-method":r(ht)(k.value)},{default:d(v=>[v.row.riskManagementTaskTypeId===h.value.riskManagementTaskTypeId?(T(),E(et,{key:0,value:h.value.taskTypeCode,placeholder:"Add Task Type Code",name:"TaskTypeCode",disabled:!0},null,8,["value"])):(T(),P("span",ee,x(v.row.taskTypeCode),1))]),_:1},8,["sort-method"]),s(r(b),{prop:"taskTypeDescription",label:"Task Type Description","min-width":"170",sortable:"","sort-method":r(ht)(k.value)},{default:d(v=>[v.row.riskManagementTaskTypeId===h.value.riskManagementTaskTypeId?(T(),E(et,{key:0,value:h.value.taskTypeDescription,placeholder:"Add Task Type Description",name:"taskTypeDescription",max:80,onHandleChange:S[0]||(S[0]=z=>h.value.taskTypeDescription=z)},null,8,["value"])):(T(),P("span",ae,x(v.row.taskTypeDescription),1))]),_:1},8,["sort-method"]),s(r(b),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:d(v=>[v.row.riskManagementTaskTypeId===h.value.riskManagementTaskTypeId?(T(),E(tt,{key:0,value:h.value.startDate,placeholder:"Add Start Date",name:"StartDate",onHandleChange:S[1]||(S[1]=z=>h.value.startDate=z)},null,8,["value"])):(T(),P("span",se,x(r(J)(v.row.startDate)),1))]),_:1}),s(r(b),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""},{default:d(v=>[v.row.riskManagementTaskTypeId===h.value.riskManagementTaskTypeId?(T(),E(tt,{key:0,value:h.value.endDate,placeholder:"Add End Date",name:"EndDate",onHandleChange:S[2]||(S[2]=z=>h.value.endDate=z)},null,8,["value"])):(T(),P("span",oe,x(r(J)(v.row.endDate)),1))]),_:1}),s(r(b),{prop:"isActive",label:"Is Active",width:"100",sortable:""},{default:d(v=>[v.row.isActive?(T(),P("div",re,[s(B,{src:"/media/svg/tables/rows/check.svg"})])):(T(),P("div",ne,[s(B,{src:"/media/svg/tables/rows/minus.svg"})]))]),_:1}),s(r(b),{prop:"changedOn",label:"Changed on",align:"center",width:"170",sortable:""},{default:d(v=>[p("span",null,x(r(Rt)(v.row.changedOn)),1)]),_:1}),s(r(b),{prop:"changedBy",label:"Changed by",sortable:"",width:"300"}),s(r(b),{label:"",width:"100"},{default:d(v=>[v.row.riskManagementTaskTypeId!==h.value.riskManagementTaskTypeId?(T(),P("div",ie,[s(q,{class:"box-item",effect:"dark",content:v.row.isActive?"Edit":"Inactive data cannot be edited",placement:"top"},{default:d(()=>[p("div",null,[p("button",{disabled:!v.row.isActive,class:"btn btn-sm btn-icon btn-bg-light",onClick:z=>L(v.row)},[s(B,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,le)])]),_:2},1032,["content"])])):(T(),P("div",de,[s(q,{class:"box-item",effect:"dark",content:"Save",placement:"top"},{default:d(()=>[p("button",{class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:mt(l,["prevent"])},[s(B,{src:"/media/svg/tables/rows/save.svg",width:"12",height:"12"})])]),_:1}),s(q,{class:"box-item",effect:"dark",content:"Cancel",placement:"top"},{default:d(()=>[p("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:mt(F,["prevent"])},[s(B,{src:"/media/svg/tables/rows/valid-false.svg",width:"12",height:"12"})])]),_:1})]))]),_:1})]),_:1},8,["data"])),[[K,r(n).loading]])],64))}}}),ce={class:"col-md-6 fv-row fv-plugins-icon-container"},ue={class:"col-md-6 fv-row fv-plugins-icon-container"},me={class:"dialog-footer"},he=j({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:o}){const e=t,g=o,n=pt(),a=$(),u=it(e,"visibility"),m=I(()=>n.formData),C=I(()=>n.errors),k=I(()=>n.isError),f=I(()=>n.isEdit),_=vt().shape({taskTypeCode:W().required("Task Type Code is mandatory"),taskTypeDescription:W().required("Task Type Description is mandatory"),startDate:Z().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:Z().required("End Date is mandatory").min(_t("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),h=(l=!1)=>{c(),n.resetState(),g("handle-close",l)},L=l=>{m.value.taskTypeCode=l},F=l=>{m.value.taskTypeDescription=l},U=l=>{m.value.startDate=l},i=l=>{m.value.endDate=l},D=async()=>{c(),await _.validate(m.value,{abortEarly:!1}).catch(l=>{n.setErrors(l.errors)}),!k.value&&X("Are you sure you want to submit ?").then(async l=>{l.isConfirmed&&n.insertData(a.user.Name).then(()=>{n.isError||rt("Form has been successfully submitted!","Ok").then(()=>{h(!0)})})})},c=()=>{n.setErrors([])};return(l,y)=>{const S=R("el-button"),B=R("el-dialog"),q=nt("loading");return G((T(),E(B,{modelValue:u.value,"onUpdate:modelValue":y[0]||(y[0]=K=>u.value=K),title:"New Data",width:"40%",onClose:y[1]||(y[1]=K=>h())},{footer:d(()=>[p("span",me,[s(S,{type:"primary",onClick:D,disabled:r(n).loading},{default:d(()=>[A("Submit")]),_:1},8,["disabled"]),s(S,{type:"secondary",onClick:h,disabled:r(n).loading},{default:d(()=>[A("Close")]),_:1},8,["disabled"])])]),default:d(()=>[s(Tt,{name:"fade"},{default:d(()=>[k.value&&!f.value?(T(),E(St,{key:0,errorMessages:C.value,onResetForm:c},null,8,["errorMessages"])):at("",!0)]),_:1}),G((T(),E(r(Ot),{id:"kt_filter_form",class:"row g-9 my-4"},{default:d(()=>[s(et,{value:m.value.taskTypeCode,placeholder:"Add Task Type Code",label:"Task Type Code",name:"TaskTypeCode",max:10,onHandleChange:L},null,8,["value"]),s(et,{value:m.value.taskTypeDescription,placeholder:"Add Type Description",label:"Type Description",name:"TypeDescription",max:80,onHandleChange:F},null,8,["value"]),p("div",ce,[s(tt,{value:m.value.startDate,placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:U},null,8,["value"])]),p("div",ue,[s(tt,{value:m.value.endDate,placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:i},null,8,["value"])])]),_:1})),[[q,r(n).loading]])]),_:1},8,["modelValue"])),[[q,r(n).loading]])}}}),ct=lt({id:"managementTaskTypeBulk",state:()=>({statePagination:new Q,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const o={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await V.post(`${Yt}?${new URLSearchParams(o).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){e.response.data.statusCode==401&&$().setLoggedIn(!1),O("IRONS",e),console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:o}){const e={userAccount:t,ver:"v1"},g=`${Xt}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const n=await V.postImages(g,o);n.data.statusCode==200?n.data.result.isError?(this.stateIsError=!0,this.stateError=n.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=n.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=Nt.some(this.stateValidatedData,{IsValid:!1}),this.setPage(1)):(this.stateIsError=n.data.result.isError,this.stateError=n.data.result.message)}catch(n){n.response.data.statusCode==401&&$().setLoggedIn(!1),console.log(n),this.stateIsError=!0,this.stateError=n.response.data.result.message,O("IRONS",n)}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(Bt(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new Q,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),De={class:"icon"},ge=j({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const o=t,e=ct(),g=I(()=>(o.page-1)*10+1),n=N(""),a=m=>{n.value=m.order;const C={prop:m.prop,order:m.order};e.setSort(C)},u=(m,C,k)=>Mt(m[k],C[k],n.value);return(m,C)=>{const k=R("inline-svg");return T(),E(r(ft),{data:o.listData,style:{width:"100%"},onSortChange:a,"empty-text":"No Data"},{default:d(()=>[s(r(b),{label:"No",width:"60",align:"center"},{default:d(f=>[p("span",null,x(g.value+f.$index),1)]),_:1}),s(r(b),{prop:"TaskTypeCode",label:"Task Type Code",width:"300",sortable:"","sort-method":(f,_)=>u(f,_,"TaskTypeCode")},null,8,["sort-method"]),s(r(b),{prop:"TaskTypeDescription",label:"Task Type Description",width:"300",sortable:"","sort-method":(f,_)=>u(f,_,"TaskTypeDescription")},null,8,["sort-method"]),s(r(b),{prop:"StartDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:d(f=>[p("span",null,x(r(J)(f.row.StartDate)),1)]),_:1}),s(r(b),{prop:"EndDate",label:"End Date",align:"center",width:"170",sortable:""},{default:d(f=>[p("span",null,x(r(J)(f.row.EndDate)),1)]),_:1}),s(r(b),{prop:"ValidationReason",label:"Remark","min-width":"300",sortable:"","sort-method":(f,_)=>u(f,_,"ValidationReason")},null,8,["sort-method"]),s(r(b),{prop:"IsValid",label:"Status",width:"100",sortable:""},{default:d(f=>[p("div",De,[s(k,{src:f.row.IsValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),ut=t=>(Ut("data-v-af8b223f"),t=t(),xt(),t),ye=ut(()=>p("div",{class:"text-center"},null,-1)),Te=ut(()=>p("div",{class:"mb-3"},[p("span",null,[A(" Download template "),p("a",{href:"documents/MasterDataManagementTaskType.xlsx",target:"_blank",id:"link-download"},"here"),A(" before uploading file ")])],-1)),ke=ut(()=>p("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[p("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),fe={class:"card"},ve={class:"card-body grid-padding"},_e={class:"dialog-footer"},Se=j({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:o}){const e=t,g=o,n=$(),a=ct(),u=it(e,"visibility"),m=()=>{const i=qt(a.validatedData,D=>{const c=D;return{riskManagementTaskTypeId:0,taskTypeCode:c.TaskTypeCode,taskTypeDescription:c.TaskTypeDescription,startDate:c.StartDate,endDate:c.EndDate}});return Object.values(i)},C=()=>{const i=document.getElementById("link-download");i&&i.click()},k=()=>{a.validatedData.length>0?X("Cancel Upload Data?","Confirm").then(D=>{D.isConfirmed&&_()}):_()},f=async i=>{await a.upload({userAccount:n.user.Name,excelFile:i}),a.stateError&&Y(a.error)},_=(i=!1)=>{a.resetState(),g("handle-close",i)},h=i=>{a.setIsUploadedState(i)},L=i=>{a.setPage(i)},F=()=>{if(a.validatedData.length<1){C();return}const i=["TASK TYPE CODE","TASK TYPE DESCRIPTION","START DATE","END DATE","REMARK","STATUS"],D=a.validatedData.map(c=>({taskTypeCode:c.taskTypeCode,taskTypeDescription:c.taskTypeDescription,startDate:c.StartDate,endDate:c.EndDate,remark:c.ValidationReason,status:c.IsValid?"OK":"Error"}));It("Type",i,D)},U=async()=>{if(a.displayData.length<1){Y("There is no data to submit");return}if(a.isError){Y("There is still invalid row(s)");return}X("Are you sure you want to submit ?").then(async i=>{if(i.isConfirmed){const D=m();if(a.setBulkData(D),await a.bulkInsert(n.user.Name),a.isError){Y(a.stateError);return}rt("Form has been successfully submitted!","Ok").then(()=>{_(!0)})}})};return(i,D)=>{const c=R("el-button"),l=R("el-dialog"),y=nt("loading");return T(),E(l,{title:"Upload Bulk Data",modelValue:u.value,"onUpdate:modelValue":D[1]||(D[1]=S=>u.value=S),"before-close":k,width:"70%","custom-class":"upload-modal"},{footer:d(()=>[p("div",null,[p("span",_e,[s(c,{type:"success",onClick:F},{default:d(()=>[A("Download")]),_:1}),s(c,{type:"primary",onClick:U},{default:d(()=>[A("Upload")]),_:1}),s(c,{type:"success",onClick:k},{default:d(()=>[A("Cancel")]),_:1})])])]),default:d(()=>[ye,Te,G(s(Ht,{isSubmissionUploadSuccess:r(a).isUploaded,onHandleCloseUploadedFile:k,onHandleUpload:f,onHandleSetIsExcelFileUploaded:h},null,8,["isSubmissionUploadSuccess"]),[[y,r(a).uploadLoading]]),ke,p("div",fe,[p("div",ve,[s(ge,{"list-data":r(a).displayData,page:r(a).pagination.currentPage},null,8,["list-data","page"])])]),r(a).displayData.length>0?(T(),E(yt,{key:0,onRaisePageChange:D[0]||(D[0]=S=>L(S)),currentPage:r(a).pagination.currentPage,totalPage:r(a).pagination.totalPage,totalPageSize:r(a).pagination.totalPageSize,startPaginationIndex:r(a).pagination.startPaginationIndex,endPaginationIndex:r(a).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):at("",!0)]),_:1},8,["modelValue"])}}}),be=zt(Se,[["__scopeId","data-v-af8b223f"]]),Ce={class:"row g-9 my-4"},Ee={class:"dialog-footer"},we=j({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:o}){const e=dt(),g=t,n=o,a=it(g,"visibility"),u=I(()=>e.filterData),m=()=>{C(),e.resetFilter()},C=()=>{n("handle-close",!1)},k=i=>{e.setTaskTypeCode(i)},f=i=>{e.setTaskTypeCodeTo(i)},_=i=>{e.setStartDate(i)},h=i=>{e.setStartDateTo(i)},L=i=>{e.setEndDate(i)},F=i=>{e.setEndDateTo(i)},U=()=>{const i=e.lastUsedFilterData.taskTypeCode!==e.filterData.taskTypeCode,D=e.lastUsedFilterData.taskTypeCodeTo!==e.filterData.taskTypeCodeTo,c=e.lastUsedFilterData.startDate!==e.filterData.startDate,l=e.lastUsedFilterData.startDateTo!==e.filterData.startDateTo,y=e.lastUsedFilterData.endDate!==e.filterData.endDate,S=e.lastUsedFilterData.endDateTo!==e.filterData.endDateTo;n("handle-close",i||D||c||l||y||S)};return(i,D)=>{const c=R("el-button"),l=R("el-dialog");return T(),E(l,{modelValue:a.value,"onUpdate:modelValue":D[0]||(D[0]=y=>a.value=y),title:"Filter",width:"60%",onClose:D[1]||(D[1]=y=>C())},{footer:d(()=>[p("span",Ee,[s(c,{type:"secondary",onClick:m},{default:d(()=>[A("Reset")]),_:1}),s(c,{type:"primary",onClick:U},{default:d(()=>[A("Filter")]),_:1})])]),default:d(()=>[p("div",Ce,[s(jt,{"value-from":u.value.taskTypeCode,"value-to":u.value.taskTypeCodeTo,label:"Task Type Code",name:"TaskTypeCode",options:r(e).taskTypeCodeOption,onHandleChangeFrom:k,onHandleChangeTo:f},null,8,["value-from","value-to","options"]),s(Dt,{"value-from":u.value.startDate?u.value.startDate.toString():"","value-to":u.value.startDateTo?u.value.startDateTo.toString():"",label:"Start Date",name:"StartDate",placeholder:"Pick a date",onHandleChangeFrom:_,onHandleChangeTo:h},null,8,["value-from","value-to"]),s(Dt,{"value-from":u.value.endDate?u.value.endDate.toString():"","value-to":u.value.endDateTo?u.value.endDateTo.toString():"",label:"End Date",name:"EndDate",placeholder:"Pick a date",onHandleChangeFrom:L,onHandleChangeTo:F},null,8,["value-from","value-to"])])]),_:1},8,["modelValue"])}}}),Ie={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},Pe=p("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),Fe={class:"d-flex justify-content-between align-items-center"},Le={class:"card"},Ue={class:"card-body grid-padding"},xe={class:"my-5"},Ma=j({__name:"Index",setup(t){const o=bt(),e=dt(),g=pt(),n=ct(),a=N(!1),u=N(!1),m=N(!1),C=I(()=>e.displayData),k=I(()=>e.pagination),f=l=>{e.setPage(l)};At(async()=>{o.dispatch(Et.ACTIVE_PAGE,st().meta.parentMenu),Ct("Task Type",[{pageName:st().meta.parentMenu,pageRoute:st().meta.parentMenu.toLowerCase()},{pageName:"IronPortal Configuration",pageRoute:"ironlake-config-managementtasktype"},{pageName:"Task Type",pageRoute:"ironlake-config-managementtasktype"}]),e.setPage(1),await e.getLookup()}),$t(async()=>{e.resetState(),g.resetState(),n.resetState()});const _=async()=>{await e.setPage(1),await e.getLookup()},h=()=>{a.value=!0,g.setIsEdit(!1),g.setErrors([])},L=async l=>{a.value=!1,l&&await _()},F=()=>{u.value=!0},U=async l=>{u.value=!1,l&&await _()},i=async()=>{const l=await e.export();Kt.saveAs(new Blob([l],{type:"application/octet-stream"}),"ManagementTaskType.xlsx")},D=()=>{m.value=!0},c=async l=>{m.value=!1,l&&await _()};return(l,y)=>(T(),P(kt,null,[p("div",Ie,[Pe,p("div",Fe,[s(Pt,{onShowDialog:h}),s(wt,{onShowDialog:F}),s(Lt,{onHandleDownload:i}),s(Ft,{onShowDialog:D})])]),p("div",Le,[p("div",Ue,[s(pe,{"list-data":C.value,page:k.value.currentPage,onFetchData:_},null,8,["list-data","page"])])]),p("div",xe,[r(e).paginationLoading?at("",!0):(T(),E(yt,{key:0,onRaisePageChange:y[0]||(y[0]=S=>f(S)),currentPage:k.value.currentPage,totalPage:k.value.totalPage,totalPageSize:k.value.totalPageSize,startPaginationIndex:k.value.startPaginationIndex,endPaginationIndex:k.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),s(he,{visibility:a.value,onHandleClose:L},null,8,["visibility"]),s(we,{visibility:u.value,onHandleClose:U},null,8,["visibility"]),s(be,{visibility:m.value,onHandleClose:c},null,8,["visibility"])],64))}});export{Ma as default};
