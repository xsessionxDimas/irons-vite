import{_ as ht}from"./Repair-zyV2di4A.js";import{_ as It}from"./document_download-C1p7j0nJ.js";import{u as ot}from"./useDefectsStore-j2gYF-8i.js";import{L as Fl,_ as Ll,a as jl,b as Ul,D as sl,C as Ml}from"./CrackForm-CAm6DVbX.js";import{u as At}from"./useDefectSheetStore-85RM-z1z.js";import{d as dt,b as Bl,c as ql}from"./manipulate-html-string-DqTEGh-F.js";import{p as yt,G as mt,c as Xt}from"./cbm-helper-BxJZ9NTc.js";import{c as Pt,b as Tt,a as _t,s as Hl,m as El}from"./useEFormStore-DtkLPope.js";import{a as xt,f as ct,i as Gl,c as zl}from"./index-BuVmIl8K.js";import{A as Wl,g as kt,h as at}from"./date-format-8-IvfSl3.js";import{e as re}from"./lodash-DrHMlsdo.js";import{l as Jl,t as Kl,n as Yl,p as Ql,A as el,o as ft,a as Zl,d as Xl,k as al}from"./helpers-wUOLw-dU.js";import{i as Te}from"./internet-connection-CnLQPjRt.js";import{k as Ee,r as n,bL as bt,p as a,q as ge,x as _,u as L,K as He,R as ie,aB as e,s as p,B as W,P as xe,y as De,a2 as je,a0 as gt,c as K,d as Le,aa as r,a5 as st,C as k,A,$ as we,F as te,b4 as F,bd as Je,bb as Ke,o as Nt,Y as es,b6 as be}from"./@vue-BypzYtbH.js";import{_ as Ye}from"./nw-img-vue-CR837WER.js";import{u as Ot}from"./useOfflineCameraStore-BBsMm6DV.js";import{P as ts,C as ls,a as ss,I as as}from"./CrackForm-CIiKEd4n.js";import{b as ol}from"./useDefectsFormStore-41UTMhiG.js";import{_ as os}from"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import{f as ns}from"./number-format-BdMuQVyW.js";import{s as rs}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{T as lt,J as tl}from"./prev-val-handler-DvA3D_kF.js";import{C as Vt}from"./list-pcxkCnQg.js";import{N as is}from"./NAForm-BdrJ0TGj.js";import{a as ll}from"./@vueuse-DFoNmIyu.js";import{_ as cs}from"./ImagePreviews.vue_vue_type_style_index_0_lang-BJGkhvcB.js";import{u as ds}from"./usePositionListStore-BsprGHwA.js";import{u as us}from"./useMasterStore-CzSO06fn.js";import{_ as ps}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{a as ms}from"./element-plus-BeWdvTRa.js";import{h as nl,b as fs,i as vs}from"./urls-CPQ2HRXU.js";import{_ as vt}from"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import{v as ys}from"./uuid-SoommWqA.js";const bs={class:"row pt-3 pb-3 text-dark modal-title"},gs={class:"p-3 m-1 d-flex"},hs={class:"form-check"},_s=e("div",{class:"d-flex flex-column"},[e("div",null,[e("span",null,[e("b",null,"Less than"),W(" 30 minutes labour "),e("b",null,[e("u",null,"and"),W(" less than")]),W(" $250 in parts")])])],-1),xs={class:"p-3 m-1 d-flex"},ks={class:"form-check"},Ds=e("div",{class:"d-flex flex-column"},[e("div",null,[e("span",null,[e("b",null,"More than"),W(" 30 minutes labour "),e("b",null,[e("u",null,"and"),W(" less than")]),W(" $250 in parts")])])],-1),ws={class:"p-3 m-1 d-flex"},Cs={class:"form-check"},$s=e("div",{class:"d-flex flex-column"},[e("div",null,[e("span",null,[e("b",null,"More than"),W(" 30 minutes labour "),e("b",null,[e("u",null,"and"),W(" more than")]),W(" $250 in parts")])])],-1),Ss={class:"dialog-footer",style:{display:"block","text-align":"right"}},Vs=Ee({__name:"DefectConfirmationDialog",props:["show"],emits:["close","submit"],setup(o,{emit:oe}){const m=o,y=oe,f=n("Less than 30 minutes labour and less than $250 in parts"),u=ll("(min-width: 1100px)"),R=ll("(min-width: 767px) and (max-width: 900px)"),E=bt(()=>R.value?"70%":u.value?"40%":"55%"),j=()=>{y("submit",{type:f.value,callback:void 0})},Z=bt(()=>m.show),Y=()=>{y("close")},le=()=>{f.value="Less than 30 minutes labour and less than $250 in parts"};return(x,P)=>{const M=ie("el-button"),g=ie("el-dialog");return a(),ge(g,{modelValue:L(Z),"onUpdate:modelValue":P[3]||(P[3]=X=>He(Z)?Z.value=X:null),title:"Does the defect identified require","custom-class":"defect-requires-dialog",width:L(E),"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"30vh",center:!0,onClosed:le},{footer:_(()=>[e("span",Ss,[p(M,{onClick:Y,style:{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"}},{default:_(()=>[W("Cancel")]),_:1}),p(M,{class:"button-OK-confirmation",type:"success",onClick:xe(j,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},{default:_(()=>[W("Submit")]),_:1})])]),default:_(()=>[e("div",bs,[e("div",gs,[e("div",hs,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":P[0]||(P[0]=X=>He(f)?f.value=X:null),value:"Less than 30 minutes labour and less than $250 in parts"},null,512),[[je,L(f)]])]),_s]),e("div",xs,[e("div",ks,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":P[1]||(P[1]=X=>He(f)?f.value=X:null),value:"More than 30 minutes labour and less than $250 in parts"},null,512),[[je,L(f)]])]),Ds]),e("div",ws,[e("div",Cs,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":P[2]||(P[2]=X=>He(f)?f.value=X:null),value:"More than 30 minutes labour and more than $250 in parts"},null,512),[[je,L(f)]])]),$s])])]),_:1},8,["modelValue","width"])}}}),Is={id:"priority-wrapper"},As=e("div",{class:"row p-3 m-1 priority-container",style:{background:"#f4f6f8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1),Ps={class:"row p-3 m-1 priority-container"},Ts={class:"col-3"},Ns={class:"form-check"},Os=e("label",{class:"form-check-label"}," (P1) Immediate ",-1),Rs=e("div",{class:"col-6 word-breaker"}," Shall shut machine down and undertake repairs. ",-1),Fs=e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1),Ls={class:"row p-3 m-1 priority-container"},js={class:"col-3"},Us={class:"form-check"},Ms=e("label",{class:"form-check-label"}," (P2) Urgent ",-1),Bs=e("div",{class:"col-6 word-breaker"},"Shall complete within 7 days.",-1),qs=e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1),Hs={class:"row p-3 m-1 priority-container"},Es={class:"col-3"},Gs={class:"form-check"},zs=e("label",{class:"form-check-label"}," (P3) Routine ",-1),Ws=e("div",{class:"col-6 word-breaker"},"Shall complete within 60 days.",-1),Js=e("div",{class:"col-3 text-break"},"Maintenance Planner",-1),Ks={class:"row p-3 m-1 priority-container"},Ys={class:"col-3"},Qs={class:"form-check"},Zs=e("label",{class:"form-check-label"}," (P4) Monitor ",-1),Xs=e("div",{class:"col-6 word-breaker"}," Shall continue to inspect and monitor for 90 days. ",-1),ea=e("div",{class:"col-3 text-break"},"Maintenance Planner",-1),ta={class:"dialog-footer",style:{display:"block","text-align":"right"}},la=Ee({__name:"PriorityModal",props:["show"],emits:["close","submit"],setup(o,{emit:oe}){const m=o,y=oe,f=n("P1"),u=bt(()=>"70%"),R=bt(()=>m.show),E=()=>{y("submit",{priority:f.value,callback:void 0})},j=le=>{f.value=le.target.value},Z=()=>{y("close")},Y=()=>{f.value="P1"};return(le,x)=>{const P=ie("el-button"),M=ie("el-dialog");return a(),ge(M,{modelValue:L(R),"onUpdate:modelValue":x[4]||(x[4]=g=>He(R)?R.value=g:null),title:"Select defect priority","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"defect-priority-dialog",width:L(u),"show-close":!1,onClosed:Y,top:"30vh",center:!0},{footer:_(()=>[e("span",ta,[p(P,{onClick:Z,style:{"box-shadow":"0px 24px 48px rgba(145, 158, 171, 0.2)"}},{default:_(()=>[W("Cancel")]),_:1}),p(P,{class:"button-OK-confirmation",type:"success",onClick:xe(E,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},{default:_(()=>[W("Continue")]),_:1})])]),default:_(()=>[e("div",Is,[As,e("div",Ps,[e("div",Ts,[e("div",Ns,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":x[0]||(x[0]=g=>He(f)?f.value=g:null),value:"P1",onChange:xe(j,["prevent"])},null,544),[[je,L(f)]]),Os])]),Rs,Fs]),e("div",Ls,[e("div",js,[e("div",Us,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":x[1]||(x[1]=g=>He(f)?f.value=g:null),value:"P2",onChange:xe(j,["prevent"])},null,544),[[je,L(f)]]),Ms])]),Bs,qs]),e("div",Hs,[e("div",Es,[e("div",Gs,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":x[2]||(x[2]=g=>He(f)?f.value=g:null),value:"P3",onChange:xe(j,["prevent"])},null,544),[[je,L(f)]]),zs])]),Ws,Js]),e("div",Ks,[e("div",Ys,[e("div",Qs,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":x[3]||(x[3]=g=>He(f)?f.value=g:null),value:"P4",onChange:xe(j,["prevent"])},null,544),[[je,L(f)]]),Zs])]),Xs,ea])])]),_:1},8,["modelValue","width"])}}}),sa=xt(),aa=async(o,oe,m,y,f,u)=>{const R=await ct.pendingTaskFile.where({filename:o}).first();R&&ct.pendingTaskFile.delete(R.id),await Gl(ct,"pendingTaskFile",{key:y,module:"serviceForm",workorder:oe,type:f,fileType:(R==null?void 0:R.fileType)??"webp",createdBy:u,email:sa.user.Email,filename:o,originalFile:(R==null?void 0:R.originalFilename)??o,blob:m,syncStatus:"Sync",syncDate:Wl()})},oa=async o=>{let oe="";const m=window.URL||window.webkitURL,y=await ct.pendingTaskFile.where({filename:o}).first();return y&&(oe=m.createObjectURL(y.blob)),oe},na=async o=>{const oe={fileUrl:o,ver:"v1"},f=(await zl.getBlob("https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url","",new URLSearchParams(oe).toString())).data;return new Blob([f])},J=o=>(Je("data-v-939b16c8"),o=o(),Ke(),o),ra=J(()=>e("span",{class:"el-dialog__title"},"Detailed Information for Defect Identification",-1)),ia=["innerHTML"],ca={key:0,class:"d-flex flex-column justify-content-between"},da={class:"py-2 d-flex flex-row flex-grow-1"},ua={class:"flex-fill"},pa={class:"form-floating"},ma=J(()=>e("label",{for:"floatingInput"},"Task Description",-1)),fa={key:0,class:"mt-1"},va={class:"d-flex flex-row justify-content-between"},ya={class:"py-2 d-flex flex-row flex-grow-1"},ba={class:"flex-fill"},ga={class:"form-floating"},ha=["innerHTML"],_a=J(()=>e("label",{for:"floatingInput"},"Asset Number",-1)),xa={class:"flex-fill ps-3"},ka={class:"form-floating"},Da=["innerHTML"],wa=J(()=>e("label",{for:"floatingInput"},"Serial Number",-1)),Ca={class:"flex-fill ps-3"},$a={class:"form-floating"},Sa=["innerHTML"],Va=J(()=>e("label",{for:"floatingInput"},"Ownership",-1)),Ia={class:"d-flex flex-row justify-content-between"},Aa={class:"mt-1 py-2"},Pa={class:"d-flex flex-column"},Ta={class:"mt-1 py-2"},Na={class:"row"},Oa={class:"col pe-0"},Ra={class:"form-floating"},Fa=["value"],La=J(()=>e("label",null,"Raised By",-1)),ja={class:"mt-1 py-2"},Ua={class:"row"},Ma={class:"col-4 pe-0 date"},Ba={class:"form-floating"},qa=["value"],Ha=J(()=>e("label",null,"Date Raised",-1)),Ea={class:"col pe-0 d-flex"},Ga={class:"d-flex flex-column flex-fill"},za={class:"form-floating"},Wa=J(()=>e("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Ja={key:0,class:"mt-2"},Ka={class:"ms-2 d-flex align-items-center"},Ya={class:"mt-1 py-2"},Qa=J(()=>e("div",{class:"mt-2"},null,-1)),Za=J(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Priority"),e("div",{class:"col-6"},"Action"),e("div",{class:"col-3 text-break"},"Person Responsible")],-1)),Xa={class:"row p-3 m-1 priority-container"},eo={class:"col-3"},to={class:"form-check"},lo=J(()=>e("label",{class:"form-check-label"}," (P1) Immediate ",-1)),so=J(()=>e("div",{class:"col-6 word-breaker"},"Shall shut machine down and undertake repairs.",-1)),ao=J(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),oo={class:"row p-3 m-1 priority-container"},no={class:"col-3"},ro={class:"form-check"},io=J(()=>e("label",{class:"form-check-label"}," (P2) Urgent ",-1)),co=J(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 7 days.",-1)),uo=J(()=>e("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),po={class:"row p-3 m-1 priority-container"},mo={class:"col-3"},fo={class:"form-check"},vo=J(()=>e("label",{class:"form-check-label"}," (P3) Routine ",-1)),yo=J(()=>e("div",{class:"col-6 word-breaker"},"Shall complete within 60 days.",-1)),bo=J(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),go={class:"row p-3 m-1 priority-container"},ho={class:"col-3"},_o={class:"form-check"},xo=J(()=>e("label",{class:"form-check-label"}," (P4) Monitor ",-1)),ko=J(()=>e("div",{class:"col-6 word-breaker"},"Shall continue to inspect and monitor for 90 days.",-1)),Do=J(()=>e("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),wo=J(()=>e("div",{class:"mt-2"},null,-1)),Co=J(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-3"},"Part Number"),e("div",{class:"col-5"},"Part Description"),e("div",{class:"col-1"},"Qty"),e("div",{class:"col"}),e("div",{class:"col"})],-1)),$o={class:"col-3 px-0"},So={class:"d-flex flex-column"},Vo=["value","onChange"],Io={key:0,class:"mt-2"},Ao={class:"col-5"},Po={class:"d-flex flex-column"},To=["value","onChange"],No={key:0,class:"mt-2"},Oo={class:"col-1 px-1 mb-0 d-flex flex-column justify-content-start"},Ro={class:"row p-0 m-0 h-50 w-100"},Fo={class:"p-0 col-12 d-flex"},Lo=["onUpdate:modelValue","onInput","onFocusout"],jo={key:0,class:"mt-2 flex-fill"},Uo={class:"col px-1 d-flex flex-column justify-content-start"},Mo={class:"row p-0 m-0 h-100 w-100 align-items-center"},Bo={class:"col px-1 d-flex flex-column justify-content-start position-relative"},qo={class:"row p-0 m-0 h-100 w-100 align-items-center"},Ho={class:"position-absolute",style:{top:"10px",right:"0px"}},Eo=["onClick"],Go={class:"d-flex justify-content-between align-items-center flex-row-reverse"},zo={class:"fw-bolder"},Wo=["href"],Jo=J(()=>e("img",{src:ss},null,-1)),Ko=J(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Yo=J(()=>e("div",{class:"mt-2"},null,-1)),Qo=J(()=>e("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[e("div",{class:"col-6"},"Labour Activity"),e("div",{class:"col-2"},"Qty"),e("div",{class:"col-2 word-breaker"},"Hours Each"),e("div",{class:"col-2 word-breaker"},"Total Hours")],-1)),Zo={class:"col-6 px-0"},Xo={class:"d-flex flex-column"},en={key:0,class:"mt-2"},tn={class:"col-2 d-flex justify-content-start"},ln={class:"d-flex flex-column"},sn=["onUpdate:modelValue","onInput","onFocusout"],an={key:0,class:"mt-2"},on={class:"col-2 d-flex justify-content-start"},nn={class:"d-flex flex-column"},rn=["onUpdate:modelValue","onInput","onFocusout"],cn={key:0,class:"mt-2"},dn={class:"col-2 d-flex flex-column justify-content-start"},un={class:"row p-0 m-0 h-50 w-100"},pn={class:"p-0 col-12 d-flex"},mn=["value"],fn=["onClick"],vn={key:0,class:"mt-2 flex-fill"},yn=J(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),bn=J(()=>e("div",{class:"mt-2"},null,-1)),gn={class:"d-flex flex-fill flex-column"},hn={class:"d-flex flex-row"},_n=["value","placeholder","onChange"],xn=["onClick"],kn={key:0,class:"mt-2"},Dn=J(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),wn=J(()=>e("div",{class:"mt-2"},null,-1)),Cn={class:"d-flex flex-row"},$n={class:"d-flex flex-fill flex-column"},Sn={key:0,class:"mt-2"},Vn=["onClick"],In={key:0,class:"mt-2"},An=J(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Pn=J(()=>e("div",{class:"mt-2"},null,-1)),Tn={class:"d-flex flex-row"},Nn={class:"d-flex flex-fill flex-column"},On={key:0,class:"mt-2"},Rn=["onClick"],Fn={key:0,class:"mt-2"},Ln=J(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),jn={class:"my-5 w-100"},Un=Ee({__name:"DefectsYesForm",props:{visibility:{required:!0,type:Boolean},predefinedPriority:{required:!0,type:String,default:"P1"},assetNumber:{required:!0,type:String},defectData:{required:!0,type:Object},generic:{required:!1,type:Boolean,default:!1},workorder:{required:!1,type:String,default:""},form:{required:!1,type:String,default:""}},emits:["addAnotherDefect"],setup(o,{emit:oe}){const m=o,y=oe,f=Ot(),u=Pt(),R=ol(),E=Tt(),j=ds(),Z=us(),Y=ot(),le=n(),x=n(!1),P=n(!1),M=n(!0),g=n(!1),X=gt(m,"visibility"),l=gt(m,"defectData"),me=n(""),he=n([""]),se=n([""]),de=n([""]),ue=n([""]),ee=n([!0]),ve=n([""]),i=n([!0]),Se=n(!1),_e=n(!1),Ne=n(ys());let Ae=[];const Oe=n("Priority"),$e=n("Parts Required"),Pe=n("Labour Required"),Ve=n("Other Resources Required (optional)"),Re=n("Defect Symptom"),B=n("Defect Cause"),d=n(""),S=n(),q=K(()=>re.isUndefined(u.images)?[]:u.images.ImageInfos),ye=K(()=>{var t,s;return m.defectData.DefectRequirement!="Less than 30 minutes labour and less than $250 in parts"&&((s=(t=l.value)==null?void 0:t.Parts)==null?void 0:s.length)==0}),D=K(()=>({images:q.value,description:m.defectData.Description.value,priority:m.defectData.Priority,instruction:m.defectData.Instruction.value,plannedDuration:m.defectData.PlannedDuration.value,parts:m.defectData.Parts,labours:m.defectData.Labours,resources:m.defectData.Resources,symptoms:m.defectData.Symptoms,causes:m.defectData.Causes})),z=t=>{t==""?(U.value.isValid=!1,U.value.errorMessage="Required"):(U.value.isValid=!0,U.value.errorMessage=""),d.value=t},U=n({isValid:!0,errorMessage:""}),G=n(""),V=K({get:()=>{let t=G.value;return t=G.value,t},set:t=>{G.value=t}}),v=K(()=>u.SerialNumber),fe=K(()=>{const t=u.Ownership;return Jl(t)}),ze=K(()=>u.DefectUpdate),We=K(()=>E.formAlreadySubmitted),qe=K(()=>"Defect Identified Description"),Qe=K(()=>"Defect Repair Instructions / Actions"),nt=K(()=>E.taskAlreadyUpdated),c=K(()=>m.generic?l.value.Title:dt(Kl(u.stateTask))),I=K(()=>m.defectData.DefectRequirement!="Less than 30 minutes labour and less than $250 in parts"),w=["images","description","instruction","defectPriority","plannedDuration","parts","labours","resources","symptoms","causes"],H=K(()=>Yl(w,S.value,D.value));Le(()=>m.predefinedPriority,t=>{me.value=t}),Le(x,t=>{t||setTimeout(()=>{const s=document.getElementsByClassName(Ne.value)[0];s==null||s.scrollIntoView(!0)},500)}),Le(We,t=>{t&&(u.toggleYesVisible(!1),E.resetTaskUpdated(),x.value=!1,M.value=!1,g.value=!1,u.setCancelledState(!0),f.clearCurrent())}),Le(nt,t=>{t&&(u.toggleYesVisible(!1),E.resetTaskUpdated(),x.value=!1,M.value=!1,g.value=!1,u.setCancelledState(!0),f.clearCurrent())}),Le(ze,t=>{u.DefectYesVisible==!0&&(t===!1&&(g.value=!0),t===!0&&(x.value=!0))});const ce=K(()=>{const t="Diesel Fitter";return j.positionOption&&j.positionOption.find(s=>s.label==t)?t:""}),ae=()=>{const t=_t();return`${kt(t.stateTimeZone)} (${t.stateTimeZoneDesc})`},Q=()=>{u.setOpenDialogConfirmSubmitDefect(!0),d.value="",G.value="",Lt(),M.value=!0,g.value=!1,y("addAnotherDefect")},Ze=t=>{l.value.setDescription(t.value),l.value.validateDescription()},rt=t=>{t.preventDefault(),t.target.value=ft(t.target.value),isNaN(Number(t.target.value))&&(l.value.setPlannedDuration(t.target.value),l.value.validatePlannedDuration()),l.value.setPlannedDuration(t.target.value),l.value.validatePlannedDuration()},b=t=>{let s=t.keyCode?t.keyCode:t.which;(s<48||s>57)&&s!=46&&t.preventDefault()},N=t=>{l.value.setInstruction(t.value),l.value.validateInstruction()},ne=(t,s)=>{t.preventDefault(),l.value.setPartDescription(s,t.target.value),l.value.validatePartDescription(l.value.Parts[s])},ke=(t,s)=>{t.preventDefault(),l.value.setPartNumber(s,t.target.value)},T=(t,s)=>{t.preventDefault(),t.target.value=ft(t.target.value),isNaN(Number(t.target.value))&&(l.value.setPartQty(s,t.target.value),l.value.validatePartQty(l.value.Parts[s])),l.value.setPartQty(s,t.target.value),l.value.validatePartQty(l.value.Parts[s])},Ge=t=>{const{value:s,index:O}=t;l.value.setPartImage(O,s),Ae.push(re.last(s).filename)},Fe=t=>{const{value:s,index:O}=t;l.value.setPartAttachment(O,s),Ae.push(re.last(s).url)},it=()=>{if(l.value.Parts.every(s=>s.partDescription!==""&&s.qty!=="")){for(const s in l.value.Parts)if(Object.prototype.hasOwnProperty.call(l.value.Parts,s)){const O=l.value.Parts[s];if(!O.partNumberValidation.isValid||!O.descriptionValidation.isValid||!O.qtyValidation.isValid)return}}else{l.value.validateParts();return}l.value.addPart({partNumber:"",partDescription:"",qty:""})},wt=t=>{l.value.removeParts(t)},Xe=t=>{l.value.setLabourActivity(t,he.value[t]),l.value.validateLaboursActivity(l.value.Labours[t])},Rt=(t,s)=>{t.preventDefault(),t.target.value=ft(t.target.value),isNaN(Number(t.target.value))&&(l.value.setLabourQty(s,t.target.value),l.value.validateLaboursQty(l.value.Labours[s]),l.value.Labours[s].position||Xe(s),ut(s)),l.value.setLabourQty(s,t.target.value),l.value.validateLaboursQty(l.value.Labours[s]),l.value.Labours[s].position||Xe(s),ut(s)},Ft=(t,s)=>{t.preventDefault(),t.target.value=ft(t.target.value),isNaN(Number(t.target.value))&&(l.value.setLabourHireEach(s,t.target.value),l.value.validateLaboursHireEach(l.value.Labours[s]),l.value.Labours[s].position||Xe(s),ut(s)),l.value.setLabourHireEach(s,t.target.value),l.value.validateLaboursHireEach(l.value.Labours[s]),l.value.Labours[s].position||Xe(s),ut(s)},ut=t=>{if(!l.value.Labours[t].qty||!l.value.Labours[t].hireEach)return;l.value.Labours[t].totalHoursValidation.message="",l.value.Labours[t].totalHoursValidation.isValid=!0;const s=+l.value.Labours[t].qty,O=+l.value.Labours[t].hireEach;let Ie=s*O;Number.isInteger(Ie)||(Ie=Number((Math.round(Ie*100)/100).toFixed(2))),l.value.setLabourTotalHours(t,Ie.toString())},il=()=>{if(l.value.Labours.every(s=>s.position!==""&&s.qty!==""&&s.hireEach!==""&&s.totalHours!=="")){for(const s in l.value.Labours)if(Object.prototype.hasOwnProperty.call(l.value.Labours,s)){const O=l.value.Labours[s];if(!O.positionValidation.isValid||!O.qtyValidation.isValid||!O.hireEachValidation.isValid)return}l.value.validateLabours()&&(l.value.addLabour({position:"",qty:"",hireEach:"",totalHours:""}),he.value.push(ce.value),Xe(l.value.Labours.length-1))}else{l.value.validateLabours();return}},cl=t=>{he.value.splice(t,1),l.value.removeLabours(t)},dl=(t,s)=>{t.preventDefault(),l.value.setResources(s,t.target.value),!(s==0&&l.value.Resources[s].value=="")&&l.value.validateResource(l.value.Resources[s])},ul=()=>{if(!l.value.Resources.every(s=>s.value!=="")){l.value.validateResourcesAdd();return}l.value.addResource("")},pl=t=>{l.value.removeResource(t),l.value.validateResourcesRemove()},ml=t=>{ve.value[t]="",i.value[t]=!0,l.value.setCauses(t,de.value[t]),l.value.validateCause(l.value.Causes[t])},fl=t=>{ve.value[t.index]=t.value,i.value[t.index]=ve.value[t.index]!=""},vl=()=>{P.value=!1,_e.value=!0,fs("form-defect-yes-eform  ","parts-collapse")},yl=()=>{for(const O in l.value.Causes)if(Object.prototype.hasOwnProperty.call(l.value.Causes,O)&&!l.value.Causes[O].isValid)return;if(!l.value.Causes.every(O=>O.value!=="")){l.value.validateCauses();return}const s=de.value.length-1;if(de.value[s]==="Other")if(ve.value[s])i.value[s]=!0;else{i.value[s]=!1;return}l.value.addCauses(""),de.value.push(""),ve.value.push(""),i.value.push(!0)},bl=t=>{de.value.splice(t,1),ve.value.splice(t,1),i.value.splice(t,1),l.value.removeCauses(t)},gl=t=>{ue.value[t]="",ee.value[t]=!0,l.value.setSymptom(t,se.value[t]),l.value.validateSymptom(l.value.Symptoms[t])},hl=t=>{ue.value[t.index]=t.value,ee.value[t.index]=ue.value[t.index]!=""},_l=()=>{for(const O in l.value.Symptoms)if(Object.prototype.hasOwnProperty.call(l.value.Symptoms,O)&&!l.value.Symptoms[O].isValid)return;if(!l.value.Symptoms.every(O=>O.value!=="")){l.value.validateSymptoms();return}const s=se.value.length-1;if(se.value[s]==="Other")if(ue.value[s])ee.value[s]=!0;else{ee.value[s]=!1;return}l.value.addSymptom(""),se.value.push(""),ue.value.push(""),ee.value.push(!0)},xl=t=>{se.value.splice(t,1),ue.value.splice(t,1),ee.value.splice(t,1),l.value.removeSymptom(t)},kl=async()=>{u.resetTaskUpdated(),setTimeout(()=>{u.SetTaskUpdated()},50),Te()||(E.getTaskProgress(),E.updateGroupByParam(E.stateSelectedGroup.groupName)),E.updateAllItems(u.ItemKey,"2")},Dl=()=>{for(const s in l.value.Symptoms)if(Object.prototype.hasOwnProperty.call(l.value.Symptoms,s)&&!l.value.Symptoms[s].isValid)return!1;const t=se.value.length-1;return se.value[t]==="Other"?ue.value[t]?ee.value[t]=!0:ee.value[t]=!1:ee.value[t]=!0,ee.value[t]},wl=()=>{for(const s in l.value.Causes)if(Object.prototype.hasOwnProperty.call(l.value.Causes,s)&&!l.value.Causes[s].isValid)return!1;const t=de.value.length-1;return de.value[t]==="Other"?ve.value[t]?i.value[t]=!0:i.value[t]=!1:i.value[t]=!0,i.value[t]},et=n(!1);Le(q,t=>{t.length>0&&(et.value=!1)},{deep:!0});const Cl=async()=>{var t;l.value.validateDefectForm(),m.generic&&(d.value==""?(U.value.isValid=!1,U.value.errorMessage="Required"):(U.value.isValid=!0,U.value.errorMessage="")),I.value&&(re.isUndefined(u.images)||u.images.ImageInfos.length<1)&&(et.value=!0),(t=l.value)!=null&&t.IsValid&&Dl()&&wl()&&U.value.isValid&&!et.value?P.value=!0:(Pl(),vs())},$l=()=>{l.value.Symptoms.forEach((t,s)=>{t.value=t.value==="Other"?`Other:${ue.value[s]}`:t.value})},Sl=()=>{l.value.Causes.forEach((t,s)=>{t.value=t.value==="Other"?`Other:${ve.value[s]}`:t.value})},Vl=async t=>{if(P.value=!1,le.value=ms.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"}),l.value.setAssetNumber(m.assetNumber),$l(),Sl(),l.value.setPriority(me.value),l.value.setIsComplete(t.isComplete),m.generic)await u.createDefectGeneric({form:m.form,workorder:m.workorder,taskDesc:d.value}),u.SetTaskUpdated(),Y.getDefectsDataAll(m.workorder);else{let s=!1;if(u.stateTask.taskValue=="3"){const Ie=[{keyValue:"",propertyParams:[{propertyName:"isActive",propertyValue:"false"}]}];await E.updateDefectHeaderWithTaskKey(u.stateTask.key,Ie,u.ItemKey),Te()&&await Hl(E.stateWorkOrder,u.stateTask.key,"false"),u.stateTask.taskValue="2",s=!0}else u.stateTask.taskValue=="1"&&(s=!0);let O;Te()?O=await u.updateDefectToLocalDB(s):O=await u.createDefect(s),O?await kl():E.taskErrorDialog&&Ct(),Te()?E.getMultiDefectList():Y.getDefectsDataAll(m.workorder)}u.setOpenDialogConfirmSubmitDefect(!1),le.value.close()},Il=()=>{P.value=!1},Lt=()=>{x.value=!1,M.value=!0,g.value=!1,_e.value=!1,et.value=!1,E.resetTaskUpdated(),u.resetTaskUpdated(),f.clearCurrent(),jt()},jt=()=>{me.value=m.predefinedPriority,he.value=[ce.value],se.value=[""],de.value=[""],ue.value=[""],ee.value=[!0],ve.value=[""],i.value=[!0],V.value="",U.value={isValid:!0,errorMessage:""}},Ct=async()=>{Lt(),u.setUpdateTaskDefect(""),u.OpenDialogConfirmSubmitDefect==!1&&u.resetInstance(),f.clearCurrent(),f.setShowCloseButton(!1),f.reset(),u.toggleYesVisible(!1),M.value===!0&&u.setCancelledState(!0)},Ut=n(null),Al=()=>{u.setCancelledState(!1),me.value=m.predefinedPriority,d.value="",l.value.setIsNeed30Minutes(u.stateIsNeed30Minutes),jt(),Ae=[],f.setShowCloseButton(!0),u.setOpenDialogConfirmSubmitDefect(!1),nl(Ne.value),M.value=!0,S.value={images:re.cloneDeep(q.value),description:re.cloneDeep(m.defectData.Description.value),priority:re.cloneDeep(m.defectData.Priority),instruction:re.cloneDeep(m.defectData.Instruction.value),plannedDuration:re.cloneDeep(m.defectData.PlannedDuration.value),parts:re.cloneDeep(m.defectData.Parts),labours:re.cloneDeep(m.defectData.Labours),resources:re.cloneDeep(m.defectData.Resources),symptoms:re.cloneDeep(m.defectData.Symptoms),causes:re.cloneDeep(m.defectData.Causes)},S.value.labours[0].position=ce.value,Ql(Ut.value),_e.value=!1},Pl=()=>{Oe.value="Priority",$e.value="Parts Required",Pe.value="Labour Required",Ve.value="Other Resources Required (optional)",Re.value="Defect Symptom",B.value="Defect Cause"},Tl=()=>{H.value?Se.value=!0:u.toggleYesVisible(!1)},Nl=()=>{Se.value=!1},Ol=()=>{if(Se.value=!1,u.toggleYesVisible(!1),Ae.length==0)return;const t=ct.pendingTaskFile.where("filename").anyOf(Ae);t&&t.delete()};return(t,s)=>{const O=ie("Label"),Ie=ie("el-collapse-item"),tt=ie("el-collapse"),$t=ie("el-option"),St=ie("el-select"),Rl=ie("el-dialog");return a(),ge(Rl,{modelValue:X.value,"onUpdate:modelValue":s[13]||(s[13]=pt=>X.value=pt),width:"90%",center:"",onClosed:Ct,onOpened:Al,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":Tl,"custom-class":`el-defect-crack-form-custom form-defect-yes-eform ${Ne.value}`,"destroy-on-close":!0},{title:_(()=>[ra,e("span",{class:"el-dialog__title task-title",innerHTML:c.value,ref_key:"defectDetailRef",ref:Ut},null,8,ia)]),default:_(()=>{var pt,Mt,Bt,qt,Ht,Et,Gt,zt,Wt,Jt,Kt,Yt,Qt,Zt;return[e("div",null,[o.generic?(a(),r("div",ca,[e("div",da,[e("div",ua,[e("div",pa,[De(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=h=>d.value=h),"on:handleChange":z},null,544),[[st,d.value]]),ma])])]),U.value.isValid?A("",!0):(a(),r("div",fa,[p(O,{class:"error-label"},{default:_(()=>[W(k(U.value.errorMessage),1)]),_:1})]))])):A("",!0),e("div",va,[e("div",ya,[e("div",ba,[e("div",ga,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:o.assetNumber},null,8,ha),_a])]),e("div",xa,[e("div",ka,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:v.value},null,8,Da),wa])]),e("div",Ca,[e("div",$a,[e("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:fe.value},null,8,Sa),Va])])])]),e("div",Ia,[p(Fl,{id:"defect",disabled:!1,"allow-delete":!0,"is-monitoring":!1,"is-mandatory":I.value,"has-submitted":et.value},null,8,["is-mandatory","has-submitted"])]),et.value?(a(),ge(O,{key:1,class:"error-label"},{default:_(()=>[W("Required")]),_:1})):A("",!0),e("div",Aa,[e("div",Pa,[p(vt,{class:"form-control h-100px",value:(Mt=(pt=l.value)==null?void 0:pt.Description)==null?void 0:Mt.value,label:qe.value,name:"defectPlaceholder",errorMessage:(qt=(Bt=l.value)==null?void 0:Bt.Description)==null?void 0:qt.errorMessage,"is-valid":(Et=(Ht=l.value)==null?void 0:Ht.Description)==null?void 0:Et.isValid,onHandleChange:Ze},null,8,["value","label","errorMessage","is-valid"])])]),e("div",Ta,[e("div",Na,[e("div",Oa,[e("div",Ra,[e("input",{type:"text",class:"form-control",disabled:"",value:L(u).selectedFitter.name},null,8,Fa),La])])])]),e("div",ja,[e("div",Ua,[e("div",Ma,[e("div",Ba,[e("input",{type:"text",class:"form-control",disabled:"",value:ae()},null,8,qa),Ha])]),e("div",Ea,[e("div",Ga,[e("div",za,[De(e("input",{type:"text",pattern:"[0-9]*",inputmode:"numeric",class:"form-control",onInput:xe(rt,["prevent"]),onFocusout:rt,"onUpdate:modelValue":s[1]||(s[1]=h=>V.value=h),onKeypress:b},null,544),[[st,V.value]]),Wa]),(zt=(Gt=l.value)==null?void 0:Gt.PlannedDuration)!=null&&zt.isValid?A("",!0):(a(),r("div",Ja,[p(O,{class:"error-label"},{default:_(()=>{var h,C;return[W(k((C=(h=l.value)==null?void 0:h.PlannedDuration)==null?void 0:C.errorMessage),1)]}),_:1})]))]),e("div",Ka,[p(O,null,{default:_(()=>[W("Hours")]),_:1})])])])]),e("div",Ya,[p(vt,{class:"form-control h-100px",value:(Jt=(Wt=l.value)==null?void 0:Wt.Instruction)==null?void 0:Jt.value,label:Qe.value,name:"instructionPlaceholder",errorMessage:(Yt=(Kt=l.value)==null?void 0:Kt.Instruction)==null?void 0:Yt.errorMessage,"is-valid":(Zt=(Qt=l.value)==null?void 0:Qt.Instruction)==null?void 0:Zt.isValid,onHandleChange:N},null,8,["value","label","errorMessage","is-valid"])]),Qa,p(tt,{class:"task-group general-accordion py-1 px-5",modelValue:Oe.value,"onUpdate:modelValue":s[6]||(s[6]=h=>Oe.value=h)},{default:_(()=>[p(Ie,{title:"Priority",name:"Priority"},{default:_(()=>[Za,e("div",Xa,[e("div",eo,[e("div",to,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[2]||(s[2]=h=>me.value=h),value:"P1"},null,512),[[je,me.value]]),lo])]),so,ao]),e("div",oo,[e("div",no,[e("div",ro,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[3]||(s[3]=h=>me.value=h),value:"P2"},null,512),[[je,me.value]]),io])]),co,uo]),e("div",po,[e("div",mo,[e("div",fo,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[4]||(s[4]=h=>me.value=h),value:"P3"},null,512),[[je,me.value]]),vo])]),yo,bo]),e("div",go,[e("div",ho,[e("div",_o,[De(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[5]||(s[5]=h=>me.value=h),value:"P4"},null,512),[[je,me.value]]),xo])]),ko,Do])]),_:1})]),_:1},8,["modelValue"]),wo,p(tt,{class:"task-group general-accordion py-1 px-5 parts-collapse",modelValue:$e.value,"onUpdate:modelValue":s[7]||(s[7]=h=>$e.value=h)},{default:_(()=>[p(Ie,{title:"Parts Required",name:"Parts Required"},{default:_(()=>{var h;return[_e.value?(a(),ge(ts,{key:0})):A("",!0),Co,(a(!0),r(te,null,we((h=l.value)==null?void 0:h.Parts,(C,$)=>(a(),r("div",{class:"row p-3 m-1 priority-container px-0",key:C.partNumber},[e("div",$o,[e("div",So,[e("input",{type:"text",class:"form-control",value:l.value.Parts[$].partNumber,onChange:Be=>ke(Be,$)},null,40,Vo),C.partNumberValidation.isValid?A("",!0):(a(),r("div",Io,[p(O,{class:"error-label"},{default:_(()=>[W(k(C.partNumberValidation.message),1)]),_:2},1024)]))])]),e("div",Ao,[e("div",Po,[e("input",{type:"text",class:"form-control",value:C.partDescription,onChange:Be=>ne(Be,$)},null,40,To),C.descriptionValidation.isValid?A("",!0):(a(),r("div",No,[p(O,{class:"error-label"},{default:_(()=>[W(k(C.descriptionValidation.message),1)]),_:2},1024)]))])]),e("div",Oo,[e("div",Ro,[e("div",Fo,[De(e("input",{pattern:"[0-9]*",inputmode:"numeric",class:"form-control","onUpdate:modelValue":Be=>C.qty=Be,onInput:xe(Be=>T(Be,$),["prevent"]),onKeypress:b,onFocusout:Be=>T(Be,$)},null,40,Lo),[[st,C.qty]])])]),C.qtyValidation.isValid?A("",!0):(a(),r("div",jo,[p(O,{class:"error-label"},{default:_(()=>[W(k(C.qtyValidation.message),1)]),_:2},1024)]))]),e("div",Uo,[e("div",Mo,[p(Ll,{index:$,"item-value":C.images||[],onHandleChangeImage:Ge},null,8,["index","item-value"])])]),e("div",Bo,[e("div",qo,[p(jl,{index:$,"item-value":C.attachment||[],onHandleChangeAttachment:Fe},null,8,["index","item-value"])]),e("div",Ho,[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:xe(Be=>wt($),["prevent"])},null,8,Eo)])])]))),128)),e("div",Go,[e("div",zo,[W(" Check Partbook "),e("a",{href:L(R).statePartReference.linkAddress,target:"_blank",class:"fw-bolder",style:{color:"#18AF4A"}},[Jo,W(" "+k(L(R).statePartReference.brand),1)],8,Wo)]),e("button",{class:"my-3 btn-add-new",onClick:it},[Ko,W(" Add more parts ")])])]}),_:1})]),_:1},8,["modelValue"]),Yo,p(tt,{class:"task-group general-accordion py-1 px-5",modelValue:Pe.value,"onUpdate:modelValue":s[9]||(s[9]=h=>Pe.value=h)},{default:_(()=>[p(Ie,{title:"Labour Required",name:"Labour Required"},{default:_(()=>[Qo,(a(!0),r(te,null,we(l.value.Labours,(h,C)=>(a(),r("div",{key:h,class:"row p-3 m-1 priority-container ps-0"},[e("div",Zo,[e("div",Xo,[p(St,{modelValue:he.value[C],"onUpdate:modelValue":$=>he.value[C]=$,filterable:"",placeholder:"Choose Labour",onChange:$=>Xe(C),class:"w-100"},{default:_(()=>[(a(!0),r(te,null,we(L(j).positionOption,$=>(a(),ge($t,{key:$.value,label:$.label,value:$.label},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h.positionValidation.isValid?A("",!0):(a(),r("div",en,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.positionValidation.message),1)]),_:2},1024)]))])]),e("div",tn,[e("div",ln,[De(e("input",{pattern:"[0-9]*",inputmode:"numeric",class:"form-control","onUpdate:modelValue":$=>h.qty=$,onKeypress:s[8]||(s[8]=(...$)=>L(el)&&L(el)(...$)),onInput:xe($=>Rt($,C),["prevent"]),onFocusout:$=>Rt($,C)},null,40,sn),[[st,h.qty]]),h.qtyValidation.isValid?A("",!0):(a(),r("div",an,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.qtyValidation.message),1)]),_:2},1024)]))])]),e("div",on,[e("div",nn,[De(e("input",{pattern:"[0-9]*",inputmode:"numeric",class:"form-control","onUpdate:modelValue":$=>h.hireEach=$,onKeypress:b,onInput:xe($=>Ft($,C),["prevent"]),onFocusout:$=>Ft($,C)},null,40,rn),[[st,h.hireEach]]),h.hireEachValidation.isValid?A("",!0):(a(),r("div",cn,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.hireEachValidation.message),1)]),_:2},1024)]))])]),e("div",dn,[e("div",un,[e("div",pn,[e("input",{class:"form-control d-flex",value:h.totalHours,disabled:""},null,8,mn),e("div",{class:F(["ms-4 d-flex align-items-center",C===0?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:xe($=>cl(C),["prevent"])},null,8,fn)],2)])]),h.totalHoursValidation.isValid?A("",!0):(a(),r("div",vn,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.totalHoursValidation.message),1)]),_:2},1024)]))])]))),128)),e("button",{class:"my-3 btn-add-new",onClick:il},[yn,W(" Add more labour ")])]),_:1})]),_:1},8,["modelValue"]),bn,p(tt,{class:"task-group general-accordion py-1 px-5",modelValue:Ve.value,"onUpdate:modelValue":s[10]||(s[10]=h=>Ve.value=h)},{default:_(()=>[p(Ie,{title:"Other Resources Required (optional)",name:"Other Resources Required (optional)"},{default:_(()=>[(a(!0),r(te,null,we(l.value.Resources,(h,C)=>(a(),r("div",{class:"p-2 d-flex",key:h.value},[e("div",gn,[e("div",hn,[e("input",{type:"text",class:"form-control",value:h.value,placeholder:`Resource ${Number(C)+1}`,onChange:$=>dl($,C)},null,40,_n),e("div",{class:F(["ms-4 d-flex align-items-center",C===0?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:xe($=>pl(C),["prevent"])},null,8,xn)],2)]),h.isValid?A("",!0):(a(),r("div",kn,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.errorMessage),1)]),_:2},1024)]))])]))),128)),e("button",{class:"my-3 btn-add-new",onClick:ul},[Dn,W(" Add new resource ")])]),_:1})]),_:1},8,["modelValue"]),wn,p(tt,{class:"task-group general-accordion py-1 px-5",modelValue:Re.value,"onUpdate:modelValue":s[11]||(s[11]=h=>Re.value=h)},{default:_(()=>[p(Ie,{title:"Defect Symptom",name:"Defect Symptom"},{default:_(()=>[(a(!0),r(te,null,we(l.value.Symptoms,(h,C)=>(a(),r("div",{class:"p-2 d-flex flex-column",key:h.value},[e("div",Cn,[e("div",$n,[p(St,{modelValue:se.value[C],"onUpdate:modelValue":$=>se.value[C]=$,placeholder:"Select Symptom",filterable:"",onChange:$=>gl(C),class:"w-100"},{default:_(()=>[(a(!0),r(te,null,we(L(Z).Symptoms,$=>(a(),ge($t,{key:$.id,label:$.symptom,value:$.symptom},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),se.value[C]==="Other"?(a(),r("div",Sn,[p(vt,{class:"form-control h-100px",value:ue.value[C],label:"Description",name:"Description",errorMessage:"Required","is-valid":ee.value[C],index:C,onHandleChange:hl},null,8,["value","is-valid","index"])])):A("",!0)]),e("div",{class:F(["ms-4 d-flex align-items-center",C===0?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:xe($=>xl(C),["prevent"])},null,8,Vn)],2)]),h.isValid?A("",!0):(a(),r("div",In,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.errorMessage),1)]),_:2},1024)]))]))),128)),e("button",{class:"my-3 btn-add-new",onClick:xe(_l,["prevent"])},[An,W(" Add another symptom ")])]),_:1})]),_:1},8,["modelValue"]),Pn,p(tt,{class:"task-group general-accordion py-1 px-5",modelValue:B.value,"onUpdate:modelValue":s[12]||(s[12]=h=>B.value=h)},{default:_(()=>[p(Ie,{title:"Defect Cause",name:"Defect Cause"},{default:_(()=>[(a(!0),r(te,null,we(l.value.Causes,(h,C)=>(a(),r("div",{class:"p-2 d-flex flex-column",key:h.value},[e("div",Tn,[e("div",Nn,[p(St,{modelValue:de.value[C],"onUpdate:modelValue":$=>de.value[C]=$,placeholder:"Select Cause",filterable:"",onChange:$=>ml(C),class:"w-100"},{default:_(()=>[(a(!0),r(te,null,we(L(Z).Causes,$=>(a(),ge($t,{key:$.id,label:$.causes,value:$.causes},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),de.value[C]==="Other"?(a(),r("div",On,[p(vt,{class:"form-control h-100px",value:ve.value[C],label:"Description",name:"Description",errorMessage:"Required","is-valid":i.value[C],index:C,onHandleChange:fl},null,8,["value","is-valid","index"])])):A("",!0)]),e("div",{class:F(["ms-4 d-flex align-items-center",C===0?"hidden":""])},[e("em",{class:"fa fa-times",style:{color:"gray",cursor:"pointer"},onClick:xe($=>bl(C),["prevent"])},null,8,Rn)],2)]),h.isValid?A("",!0):(a(),r("div",Fn,[p(O,{class:"error-label"},{default:_(()=>[W(k(h.errorMessage),1)]),_:2},1024)]))]))),128)),e("button",{class:"my-3 btn-add-new",onClick:yl},[Ln,W(" Add another cause ")])]),_:1})]),_:1},8,["modelValue"]),e("div",jn,[e("button",{class:"btn btn-success w-100",onClick:xe(Cl,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Submit")])]),p(ls,{show:P.value,"parts-warning":ye.value,onAddParts:vl,onClose:Il,onSubmit:Vl},null,8,["show","parts-warning"]),p(ps,{visibility:Se.value,caption:"Are you sure want to close the defect form? <br /> Note: By closing the defect form, you will lose your defect data that you have already inputted.",onOnNoConfirm:Nl,onOnYesConfirm:Ol},null,8,["visibility"]),p(Ul,{show:x.value,message:"Defect Information Successfully Submitted","show-left-button":!0,"left-button-label":"+ Add Another Defect",onLeftButtonAction:Q,backgroundLeftButton:"#18AF4A",colorLeftButton:"#FFF",borderColorLeftButton:"#18AF4A",backgroundRightButton:"#FFF",colorRightButton:"#18AF4A",borderColorRightButton:"#18AF4A",onClose:Ct},null,8,["show"])]}),_:1},8,["modelValue","custom-class"])}}}),Mn=Ye(Un,[["__scopeId","data-v-939b16c8"]]),Ce=o=>(Je("data-v-4b545a80"),o=o(),Ke(),o),Bn={class:"mt-5 ps-0"},qn={class:"row px-2 item mx-1 w-100 defect-panel-header"},Hn=Ce(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),En=Ce(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description â€“ Defect Description",-1)),Gn=Ce(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center flex-basis-80"},"Priority",-1)),zn=Ce(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),Wn=Ce(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),Jn=Ce(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),Kn={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},Yn={key:0,class:"item px-2 my-2 mx-1"},Qn={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Zn=Ce(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},null,-1)),Xn={class:"col align-items-center d-flex text-break defect-description"},er=["innerHTML"],tr=Ce(()=>e("div",{class:"col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80"},null,-1)),lr={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},sr=Ce(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},null,-1)),ar=Ce(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},null,-1)),or={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},nr={key:1,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},rr=Ce(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),ir=[rr],cr={class:"row mt-2 flex-nowrap px-2 my-2 mx-1 w-100"},dr={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},ur=["innerHTML"],pr={class:"item px-2 my-2 mx-1"},mr={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},fr=Ce(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},null,-1)),vr={class:"col align-items-center d-flex text-break defect-description"},yr=["innerHTML"],br={class:"text-center",style:{"font-weight":"600",color:"white"}},gr={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},hr=["onClick"],_r=["onClick"],xr={class:"row"},kr={class:"col-8 col-md-8 d-flex flex-column pe-0"},Dr=["value"],wr={key:0,class:"ms-1 d-flex align-items-center"},Cr=Ce(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),$r=Ce(()=>e("span",null,"Loading...",-1)),Sr=[Cr,$r],Vr=Ce(()=>e("div",{class:"col-4 col-md-3 ps-0 pe-1"},[e("button",{disabled:!0,class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},[e("i",{class:"fa fa-save"})])],-1)),Ir=Ce(()=>e("img",{src:ht,alt:""},null,-1)),Ar=[Ir],Pr={class:"mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",style:{"margin-top":"6px",cursor:"initial"}},Tr=["onClick"],Nr={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Or={key:1},Rr={class:"item header-collapse px-2 my-2 mx-1"},Fr={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Lr={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},jr={class:"col align-items-center d-flex text-break defect-description"},Ur=["innerHTML"],Mr={class:"col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80"},Br={class:"text-center",style:{"font-weight":"600",color:"white"}},qr=Ce(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},null,-1)),Hr={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Er=Ce(()=>e("img",{src:ht,alt:""},null,-1)),Gr=[Er],zr={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Wr={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Jr=Ee({__name:"DefectPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!0,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},viewIsDownload:{required:!1,type:Boolean,default:!1},isApproval:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},title:{required:!1,type:String,default:"Repairs Completed"}},emits:["onRefreshData","on-handle-pdf"],setup(o,{emit:oe}){const m=o,y=ot(),f=At(),u=El(),R=xt(),E=_t(),j=Pt(),Z=oe,Y=n("Defect Identified"),le=n(!1),x=n(!0),P=n([]),M=n(""),g=n(""),X=n(""),l=n(!1),me=n(),he=n(""),se=n(""),de=n(""),ue=n({type:"",title:"",assetNumber:"",description:"",raisedBy:"",date:"",plannedDuration:"",instruction:"",priority:"P1",parts:JSON.parse("[]"),labours:JSON.parse("[]"),resources:JSON.parse("[]"),symptoms:JSON.parse("[]"),causes:JSON.parse("[]"),images:JSON.parse("[]"),key:""}),ee=K(()=>y.DefectSMUHeader),ve=c=>q.value[c].length==1&&q.value[c][0].cbmRatingType=="SERVICE_CLEANED_AND_REPLACED",i=c=>!!(c&&c.find(w=>w.downloadBy.id==R.user.EmployeeId)),Se=c=>c=="Acknowledge",_e=n([""]),Ne=c=>{var I;return(I=P.value.find(w=>w.id==c))==null?void 0:I.wo},Ae=c=>{var I;return(I=P.value.find(w=>w.id==c))==null?void 0:I.load},Oe=c=>{let I="red  ";return c.defectType=="CALIBRATION"?!re.isUndefined(u.stateSCHeader)&&!re.isUndefined(u.stateSCHeader.status)&&u.stateSCHeader.status=="Submitted"?I="green":I="red":I=y.getCompleteStatus(c.id)?"green":"red",I},$e=c=>c.plannerStatus=="Decline"||c.status=="Decline"||c.priority===void 0?"invisible":"",Pe=c=>c.plannerStatus=="Decline"||c.status=="Decline"?"invisible":"",Ve=c=>{y.setDefectDetailDownload(c)},Re=(c,I)=>{y.setApprovalDefectDownload(c,I)},B=(c,I)=>{ue.value=null,he.value="",de.value="";const w=qe(c),H=re.cloneDeep(w),ce=y.getDefectHeader(c);if(H){for(const ae in H.detail)if(ae=="parts"||ae=="labours"||ae=="resources"||ae=="symptoms"||ae=="causes"||ae=="images")try{H.detail[ae]=JSON.parse(H.detail[ae])}catch(Q){console.log(Q)}H.detail.ownership=j.Ownership,ue.value=H.detail,Ve(H.detail),ce&&Re(ce.approvedBy,ce.approvedDate),he.value=c}ue.value&&(v(),de.value=`${f.SelectedDefectSheet.brand} ${f.SelectedDefectSheet.equipmentModel} ${d.value} ${f.SelectedDefectSheet.psType} Hr Service ${f.SelectedDefectSheet.unitNumber} ${f.SelectedDefectSheet.workOrder}${I?" WO ":""}${I}`,me.value.handleDataFetch())},d=K(()=>Zl(f.SelectedDefectSheet.equipmentModel)?"Dozer":"Dump Truck"),S=K(()=>y.ApprovalData.DefectHeaders.filter(I=>y.ApprovalData.DefectDetails.find(H=>I.id==H.defectHeaderId&&(H.detail.isComplete??!0)==(m.title=="Repairs Completed"))!=null)),q=K(()=>{const c=S.value;return y.ApprovalData.DefectDetails.forEach(w=>{const H=S.value.findIndex(ce=>ce.id===w.defectHeaderId);H>=0&&(c[H].descriptionDefect=w.detail.description)}),c.forEach(w=>{w.taskDesc&&w.taskDesc.split(";")[1]&&w.taskDesc.split(";")[1]!=""&&(w.taskNo=w.taskDesc.split(";")[0]+";"+w.taskDesc.split(";")[1])}),c.filter(w=>w.defectType!=="machineSMU").reduce((w,H)=>{const ce=w[H.taskNo]||[];return ce.push(H),w[H.taskNo]=ce,w},{})}),ye=c=>c&&c.length>=30?c.substring(0,30)+"...":c,D=K(()=>y.DataFetched),z=(c,I)=>{let w="light-yellow color-dark-yellow";const H=I==null?void 0:I.find(ce=>ce.id===c);if(H){switch(H.generalStatus){case"Submited":w="light-yellow color-dark-yellow";break;case"Acknowledge":w="light-green color-dark-green";break}H.priority===void 0&&(w="light-green color-dark-green")}return w};Le(D,c=>{c===!0&&(G(),V())});const U=K(()=>f.SelectedDefectSheet.workOrder);Le(U,()=>{fe()});const G=()=>{P.value=[],S.value.forEach(c=>{P.value.push({id:c.id,wo:c.defectWorkorder,load:!1})})},V=()=>{_e.value=[],S.value.forEach(c=>{_e.value.findIndex(w=>c.taskDesc&&c.taskDesc.split(";")[1]&&c.taskDesc.split(";")[1]!=""?w==c.taskDesc.split(";")[0]+";"+c.taskDesc.split(";")[1]:w==c.taskNo)<0&&(c.taskDesc&&c.taskDesc.split(";")[1]&&c.taskDesc.split(";")[1]!=""?_e.value.push(c.taskDesc.split(";")[0]+";"+c.taskDesc.split(";")[1]):_e.value.push(c.taskNo))})},v=()=>{const c=R.user.Name,I=kt(E.stateTimeZone);se.value=`${c}, at ${I} (${E.stateTimeZoneDesc})`};Le(q,(c,I)=>{re.isEmpty(I)&&Te()&&(G(),V())},{deep:!0}),Nt(()=>{if(D.value&&(Te()||(G(),V())),fe(),setTimeout(()=>{Z("on-handle-pdf")},1e3),!Te())E.getServerTimestamp();else{E.setTimeStamp();let c=1e3;if(re.isUndefined(q.value))return;G(),setTimeout(()=>{V()},c)}});const fe=async()=>{const c=Tt(),I=re.isUndefined(f.stateSelectedDefectSheet.equipmentModel)?"":f.stateSelectedDefectSheet.equipmentModel,w=`${f.stateSelectedDefectSheet.brand} ${I}`;if(w.includes("undefined")){const H={modelId:c.stateGeneralForm.modelId,psTypeId:c.stateGeneralForm.psTypeId,unitNumber:c.stateGeneralForm.equipment,workOrder:c.stateGeneralForm.workOrder,employee:{id:R.stateUser.EmployeeId,name:R.stateUser.Name}};Te()?l.value=await u.getSuspensionCalibrationTemplateFromLocalDB(c.stateGeneralForm.workOrder):l.value=await u.getSuspensionCalibrationTemplate(H)}else{const H={modelId:w,psTypeId:f.stateSelectedDefectSheet.psType,unitNumber:f.stateSelectedDefectSheet.unitNumber,workOrder:f.stateSelectedDefectSheet.workOrder,employee:{id:R.stateUser.EmployeeId,name:R.stateUser.Name}};u.toggleShowPreviewSuspensionCylinderHeightForm(!1),Te()?l.value=await u.getSuspensionCalibrationTemplateFromLocalDB(c.stateGeneralForm.workOrder):l.value=await u.getSuspensionCalibrationTemplate(H)}},ze=c=>{let I=c.createdBy.name,w=c.updatedDate!=""?c.updatedDate:c.createdDate;const H=y.ApprovalData.DefectDetails.find(ce=>ce.defectHeaderId==c.id);return H&&H.otherFitterUpdatedBy&&(I=H.otherFitterUpdatedBy.name,at(H.updatedDate)>at(w)&&(w=H.updatedDate)),`${I}, ${w}`},We=async(c,I)=>{const w=await y.setDefectData(c);y.setDefectGeneralStatus(c),x.value=y.getCompleteStatus(c),y.HeaderStatus!="Decline"&&y.updateHeaderDefect(c),M.value=c,X.value=I,m.fitterId?g.value=f.SelectedWorkOrder:g.value=f.SelectedDefectSheet.workOrder,w&&w=="CALIBRATION"?!re.isUndefined(u.stateSCHeader)&&!re.isUndefined(u.stateSCHeader.status)&&u.stateSCHeader.status=="Submitted"&&u.toggleShowPreviewSuspensionCylinderHeightForm(!0):le.value=!0},qe=c=>y.getDefectDetail(c),Qe=()=>{le.value=!1},nt=()=>{Z("onRefreshData")};return(c,I)=>{const w=ie("el-collapse-item"),H=ie("el-collapse");return a(),r(te,null,[e("div",Bn,[p(H,{class:"task-group general-accordion defect-panel-wrapper px-5 pb-1 testing",modelValue:Y.value,"onUpdate:modelValue":I[2]||(I[2]=ce=>Y.value=ce)},{default:_(()=>[p(w,{title:`Defect Identified - ${o.title}`,name:"Defect Identified"},{default:_(()=>{var ce;return[e("div",qn,[Hn,En,Gn,zn,Wn,Jn,o.viewIsDownload?(a(),r("div",Kn)):A("",!0)]),Object.keys(ee.value).length>0?(a(),r("div",Yn,[e("div",Qn,[Zn,e("div",Xn,[e("span",{class:"text-break",innerHTML:ee.value.taskDesc},null,8,er)]),tr,e("div",lr,[e("div",{class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",z(ee.value.id,S.value)]),onClick:I[0]||(I[0]=ae=>We(ee.value.id,ee.value.taskId))}," Detailed Information ",2)]),sr,ar]),e("div",or,k((ce=ee.value.createdBy)==null?void 0:ce.name)+", "+k(ee.value.updatedDate!=""?ee.value.updatedDate:ee.value.createdDate),1)])):A("",!0),Object.keys(q.value).length===0&&Object.keys(ee.value).length===0?(a(),r("div",nr,ir)):(a(!0),r(te,{key:2},we(L(Xl)(Object.keys(q.value)),ae=>(a(),r(te,{key:ae},[ve(ae)?(a(),r("div",Or,[e("div",Rr,[e("div",Fr,[e("div",Lr,k(q.value[ae][0].taskNo&&q.value[ae][0].taskNo.split(";")[0]),1),e("div",jr,[e("span",{class:"text-break",style:{"white-space":"break-spaces"},innerHTML:L(dt)(q.value[ae][0].taskDesc)},null,8,Ur)]),e("div",Mr,[e("div",{class:F(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",L(yt)(q.value[ae][0].priority)]),style:{"margin-top":"6px"}},[e("span",Br,k(q.value[ae][0].priority),1)],2)]),qr,e("div",{class:F(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",$e(q.value[ae][0])])},null,2),e("div",Hr,[e("div",{class:F(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[Oe(q.value[ae][0])]]),style:{"margin-top":"6px"}},Gr,2)]),o.viewIsDownload?(a(),r("div",zr)):A("",!0)]),e("div",Wr,k(ze(q.value[ae][0])),1)])])):(a(),ge(H,{key:0,modelValue:_e.value,"onUpdate:modelValue":I[1]||(I[1]=Q=>_e.value=Q),class:"task-group e-form-only py-1 px-2 mt-2 overflow-visible defect-panel-task"},{default:_(()=>[p(w,{name:q.value[ae][0].taskNo},{title:_(()=>[e("div",cr,[e("span",dr,k(q.value[ae][0].taskNo&&q.value[ae][0].taskNo.split(";")[0]),1),e("span",{class:"col defect-identified-task",innerHTML:L(dt)(q.value[ae][0].taskDesc)},null,8,ur)])]),default:_(()=>[(a(!0),r(te,null,we(q.value[ae],Q=>(a(),r("div",{key:Q.id},[e("div",pr,[e("div",mr,[fr,e("div",vr,[e("span",{class:"text-break",style:{"white-space":"break-spaces"},innerHTML:ye(Q.descriptionDefect)},null,8,yr)]),e("div",{class:F(["col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80",Pe(Q)])},[e("div",{class:F(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",L(yt)(Q.priority)]),style:{"margin-top":"6px"}},[e("span",br,k(Q.priority),1)],2)],2),e("div",gr,[Q.plannerStatus=="Decline"||Q.status=="Decline"?(a(),r("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:Ze=>We(Q.id,Q.taskId)}," Declined ",8,hr)):(a(),r("div",{key:1,class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",z(Q.id,S.value)]),onClick:Ze=>We(Q.id,Q.taskId)}," Detailed Information ",10,_r))]),e("div",{class:F(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",$e(Q)])},[e("div",xr,[e("div",kr,[e("input",{type:"text",class:"form-control mou-input",placeholder:"Input Work Order",value:Ne(Q.id),disabled:!0},null,8,Dr),Ae(Q.id)?(a(),r("div",wr,Sr)):A("",!0)]),Vr])],2),e("div",{class:F(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",Pe(Q)])},[e("div",{class:F(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[Oe(Q)]]),style:{"margin-top":"6px"}},Ar,2)],2),o.viewIsDownload?(a(),r("div",{key:0,class:F(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",Pe(Q)])},[e("div",Pr,[Se(o.plannerApprove?Q.plannerStatus:Q.status)?(a(),r("img",{key:0,onClick:Ze=>B(Q.id,Q.defectWorkorder),class:F(["ms-4 me-2 download-icon",i(Q.downloadHistory)?"icon-green":"icon-red"]),src:It,style:{height:"18px"},alt:""},null,10,Tr)):A("",!0)])],2)):A("",!0)]),e("div",Nr,k(ze(Q)),1)])]))),128))]),_:2},1032,["name"])]),_:2},1032,["modelValue"]))],64))),128))]}),_:1},8,["title"])]),_:1},8,["modelValue"])]),p(sl,{status:L(y).GeneralStatus,visibility:le.value,"defect-data":L(y).DefectFormData,"header-id":M.value,"work-order":g.value,"view-only":o.viewOnly,"fitter-id":o.fitterId,"task-id":X.value,plannerApprove:o.plannerApprove,"is-form":o.isForm,"is-complete":x.value,onCloseForm:Qe,onOnRefreshData:nt},null,8,["status","visibility","defect-data","header-id","work-order","view-only","fitter-id","task-id","plannerApprove","is-form","is-complete"])],64)}}}),Vu=Ye(Jr,[["__scopeId","data-v-4b545a80"]]),Ue=o=>(Je("data-v-f4d67c03"),o=o(),Ke(),o),Kr={class:"mt-5 ps-0"},Yr={class:"row px-2 item mx-1 w-100 defect-panel-header"},Qr=Ue(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Zr=Ue(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Xr=Ue(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center flex-basis-80"},"Priority",-1)),ei=Ue(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),ti=Ue(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),li=Ue(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),si={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},ai={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},oi=Ue(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),ni=[oi],ri={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ii={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},ci={class:"col align-items-center d-flex text-break"},di=["innerHTML"],ui={style:{"font-weight":"600",color:"white"}},pi={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},mi=["onClick"],fi=["onClick"],vi={class:"row justify-content-center"},yi={class:"col-8 col-md-8 d-flex flex-column pe-0"},bi=["onUpdate:modelValue"],gi={key:0,class:"ms-1 d-flex align-items-center"},hi=Ue(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),_i=Ue(()=>e("span",null,"Loading...",-1)),xi=[hi,_i],ki=Ue(()=>e("div",{class:"col-4 col-md-3 ps-0 pe-1"},[e("button",{disabled:!0,class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},[e("i",{class:"fa fa-save"})])],-1)),Di=Ue(()=>e("img",{src:ht,alt:""},null,-1)),wi=[Di],Ci={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},$i=["onClick"],Si={class:"row flex-nowrap w-100 flex-row-reverse create-by"},Vi=Ee({__name:"CrackPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},viewIsDownload:{required:!1,type:Boolean,default:!1},isApproval:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},title:{required:!1,type:String,default:"Repairs Completed"}},emits:["onRefreshData","onGetPositionY"],setup(o,{emit:oe}){const m=o,y=ot(),f=Ot(),u=At(),R=_t(),E=xt(),j=ol(),Z=oe,Y=n("Crack Identified"),le=n(!1),x=n(!0),P=n([]),M=n([]),g=n(""),X=n(""),l=n(""),me=n(),he=n(""),se=n(""),de=n(""),ue=n({assetNumber:"",description:"",title:"",raisedBy:"",date:"",plannedDuration:"",instruction:"",priority:"",parts:JSON.parse("[]"),labours:JSON.parse("[]"),resources:JSON.parse("[]"),symptoms:JSON.parse("[]"),causes:JSON.parse("[]"),images:JSON.parse("[]"),previousCracks:JSON.parse("[]")}),ee=D=>y.getCrackDetail(D),ve=()=>{const D=E.user.Name,z=kt(R.stateTimeZone);se.value=`${D}, at ${z} (${R.stateTimeZoneDesc})`},i=D=>{y.setDefectDetailDownload(D)},Se=(D,z)=>{y.setApprovalDefectDownload(D,z)},_e=D=>{let z="red  ";return z=y.getCrackCompleteStatus(D.id)?"green":"red",z},Ne=async(D,z)=>{ue.value=null,he.value="",de.value="";const U=ee(D);U!=null&&U.detail.referencePhoto&&await y.setReferencePhoto(U.detail.referenceSection,U.detail.referencePhoto);const G=re.cloneDeep(U),V=y.getDefectHeader(D);if(G){for(const v in G.detail)if(v=="parts"||v=="labours"||v=="resources"||v=="symptoms"||v=="causes"||v=="images"||v=="previousCracks")try{G.detail[v]=JSON.parse(G.detail[v])}catch(fe){console.log(fe)}G.detail.ownership=j.Ownership,ue.value=G.detail,V&&Se(V.approvedBy,V.approvedDate),i(G.detail),he.value=D}ue.value&&(ve(),de.value=`${u.SelectedDefectSheet.brand} ${u.SelectedDefectSheet.equipmentModel} Dump Truck ${u.SelectedDefectSheet.psType} Hr Service ${u.SelectedDefectSheet.unitNumber} ${u.SelectedDefectSheet.workOrder}${z?" WO ":""}${z}`,me.value.handleDataFetch())},Ae=D=>!!(D&&D.find(U=>U.downloadBy.id==E.user.EmployeeId)),Oe=D=>D=="Acknowledge",$e=K(()=>y.ApprovalData.CrackHeaders.filter(z=>y.ApprovalData.CrackDetails.find(G=>z.id==G.defectHeaderId&&(G.detail.isComplete??!0)==(m.title=="Repairs Completed"))!=null)),Pe=K(()=>y.DataFetched),Ve=D=>D.plannerStatus=="Decline"||D.status=="Decline"||D.priority===void 0?"invisible":"",Re=D=>D.plannerStatus=="Decline"||D.status=="Decline"?"invisible":"",B=(D,z)=>{let U="light-yellow color-dark-yellow";const G=z==null?void 0:z.find(V=>V.id===D);if(G){switch(G.generalStatus){case"Submited":U="light-yellow color-dark-yellow";break;case"Acknowledge":U="light-green color-dark-green";break}G.priority===void 0&&(U="light-green color-dark-green")}return U};Le(Pe,D=>{D===!0&&(M.value=[],$e.value.forEach(z=>{M.value.push(z.defectWorkorder)}))}),Nt(()=>{Pe.value&&(M.value=[],$e.value.forEach(D=>{M.value.push(D.defectWorkorder)}))});const d=D=>{let z=D.createdBy.name,U=D.updatedDate!=""?D.updatedDate:D.createdDate;const G=y.ApprovalData.CrackDetails.find(V=>V.defectHeaderId==D.id);return G&&G.otherFitterUpdatedBy&&(z=G.otherFitterUpdatedBy.name,at(G.updatedDate)>at(U)&&(U=G.updatedDate)),`${z}, ${U}`},S=async(D,z)=>{Z("onGetPositionY"),f.setCurrent("crack"),await y.setCrackData(D),y.setCrackGeneralStatus(D),x.value=y.getCrackCompleteStatus(D),m.plannerApprove&&y.HeaderStatus!="Decline"&&y.updateHeaderCrack(D),g.value=D,l.value=z,m.fitterId?X.value=u.SelectedWorkOrder:X.value=u.SelectedDefectSheet.workOrder,le.value=!0},q=()=>{le.value=!1},ye=()=>{Z("onRefreshData")};return(D,z)=>{const U=ie("el-collapse-item"),G=ie("el-collapse");return a(),r(te,null,[p(as,{ref_key:"downloadPdfDefect",ref:me,"time-stamp":se.value,filename:de.value},null,8,["time-stamp","filename"]),e("div",Kr,[p(G,{class:"task-group general-accordion py-1 px-5 testing",modelValue:Y.value,"onUpdate:modelValue":z[0]||(z[0]=V=>Y.value=V)},{default:_(()=>[p(U,{title:`Crack Identified - ${o.title}`,name:"Crack Identified"},{default:_(()=>[e("div",Yr,[Qr,Zr,Xr,ei,ti,li,o.viewIsDownload?(a(),r("div",si)):A("",!0)]),$e.value.length<1?(a(),r("div",ai,ni)):(a(!0),r(te,{key:1},we($e.value,(V,v)=>(a(),r("div",{key:V.id,class:"item px-2 my-2 mx-1"},[e("div",ri,[e("div",ii,k(V.taskNo),1),e("div",ci,[e("span",{class:"text-break defect-identified-task",innerHTML:L(dt)(V.taskDesc)},null,8,di)]),e("div",{class:F(["col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80",Re(V)])},[e("div",{class:F(["little-box d-flex justify-content-center align-items-center",L(yt)(V.priority)]),style:{"margin-top":"6px"}},[e("span",ui,k(V.priority),1)],2)],2),e("div",pi,[V.plannerStatus=="Decline"||V.status=="Decline"?(a(),r("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:fe=>S(V.id,V.taskId)}," Declined ",8,mi)):(a(),r("div",{key:1,class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",B(V.id,$e.value)]),onClick:fe=>S(V.id,V.taskId)}," Detailed Information ",10,fi))]),e("div",{class:F(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",Ve(V)])},[e("div",vi,[e("div",yi,[De(e("input",{type:"text",class:"form-control mou-input","onUpdate:modelValue":fe=>M.value[v]=fe,placeholder:"Input Work Order",disabled:!0},null,8,bi),[[st,M.value[v]]]),P.value[v]?(a(),r("div",gi,xi)):A("",!0)]),ki])],2),e("div",{class:F(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",Re(V)])},[e("div",{class:F(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center",[_e(V)]]),style:{"margin-top":"6px"}},wi,2)],2),o.viewIsDownload?(a(),r("div",Ci,[Oe(o.plannerApprove?V.plannerStatus:V.status)?(a(),r("img",{key:0,onClick:fe=>Ne(V.id,V.defectWorkorder),class:F(["ms-4 me-2 download-icon",Ae(V.downloadHistory)?"icon-green":"icon-red"]),src:It,style:{height:"18px"},alt:""},null,10,$i)):A("",!0)])):A("",!0)]),e("div",Si,k(d(V)),1)]))),128))]),_:1},8,["title"])]),_:1},8,["modelValue"])]),p(Ml,{status:L(y).GeneralStatus,visibility:le.value,"header-id":g.value,"work-order":X.value,"view-only":o.viewOnly,"fitter-id":o.fitterId,"task-id":l.value,plannerApprove:o.plannerApprove,"is-form":o.isForm,"is-complete":x.value,"crack-data":L(y).CrackFormData,onCloseForm:q,onOnRefreshData:ye},null,8,["status","visibility","header-id","work-order","view-only","fitter-id","task-id","plannerApprove","is-form","is-complete","crack-data"])],64)}}}),Iu=Ye(Vi,[["__scopeId","data-v-f4d67c03"]]),pe=o=>(Je("data-v-46b9aebf"),o=o(),Ke(),o),Ii=pe(()=>e("span",{class:"el-dialog__title",style:{"text-align":"start"}},null,-1)),Ai={class:"ps-3"},Pi=pe(()=>e("h3",null,"Detailed Information",-1)),Ti=pe(()=>e("div",{class:"d-flex flex-row justify-content-between"},[e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"No")]),e("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Location")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Previous Value")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Current Value")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"UoM")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Rating")])],-1)),Ni={class:"d-flex flex-row justify-content-between"},Oi={key:0,class:"d-flex flex-row justify-content-between"},Ri=pe(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Fi=pe(()=>e("div",{class:"col text-start px-2 py-2",style:{}},[e("label",null,"Replacement")],-1)),Li=pe(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{}},[e("label")],-1)),ji={class:"col-2 text-start px-2 py-2",style:{}},Ui={class:"col-1 text-start px-2 py-2",style:{}},Mi={class:"col-2 text-start px-2 py-2",style:{"border-right":"1px solid rgba(145, 158, 171, 0.24)"}},Bi={key:1,class:"d-flex flex-row justify-content-between"},qi=pe(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Hi=pe(()=>e("div",{class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Comment")],-1)),Ei=pe(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Gi={class:"col-5 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},zi=pe(()=>e("div",{class:"d-flex flex-row justify-content-between items-center"},[e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"No")]),e("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Location")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Tool")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"A")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"B")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Piston Movement (B-A)")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"UoM")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Percent Worn")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Rating")])],-1)),Wi={class:"d-flex flex-row justify-content-between"},Ji=pe(()=>e("div",{class:"d-flex flex-row justify-content-between"},[e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"No")]),e("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Location")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Value")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"UoM")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Rating")])],-1)),Ki={class:"d-flex flex-row justify-content-between"},Yi={key:0,class:"d-flex flex-row justify-content-between"},Qi=pe(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),Zi={class:"col text-start px-2 py-2",style:{}},Xi={key:0},ec={key:1},tc=pe(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{}},[e("label")],-1)),lc={class:"col-2 text-start px-2 py-2",style:{}},sc={class:"col-1 text-start px-2 py-2",style:{}},ac={class:"col-2 text-start px-2 py-2",style:{"border-right":"1px solid rgba(145, 158, 171, 0.24)"}},oc={key:1,class:"d-flex flex-row justify-content-between"},nc=pe(()=>e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),rc=pe(()=>e("div",{class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Comment")],-1)),ic=pe(()=>e("div",{class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label")],-1)),cc={class:"col-5 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},dc=pe(()=>e("h3",{class:"mt-3"},"Detail Spec",-1)),uc={key:5},pc={class:"table table-bordered",style:{width:"500px"}},mc=pe(()=>e("caption",null,null,-1)),fc=pe(()=>e("thead",null,[e("tr",{style:{background:"#70AD47"}},[e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),e("th",{scope:"col",class:"table-header"},"UoM")])],-1)),vc={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},yc={scope:"row",style:{"border-right":"1px solid white"}},bc={scope:"row",style:{"border-right":"1px solid white"}},gc={scope:"row"},hc=pe(()=>e("h3",{class:"mt-3"},"Previous - Current Gap Rating Spec",-1)),_c={class:"table table-bordered",style:{width:"500px"}},xc=pe(()=>e("caption",null,null,-1)),kc=pe(()=>e("thead",null,[e("tr",{style:{background:"#70AD47"}},[e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),e("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Dc={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},wc={scope:"row",style:{"border-right":"1px solid white"}},Cc={scope:"row",style:{"border-right":"1px solid white"}},$c={scope:"row"},Sc=pe(()=>e("h3",{class:"mt-3"},"Detailed picture",-1)),Vc={class:"row my-4"},Ic={style:{"font-size":"10px","font-weight":"600"}},Ac={class:"bg-secondary"},Pc=["src","onClick"],Tc=Ee({__name:"CBMInfo",props:{visibility:{required:!0,type:Boolean},cbmData:{required:!0,type:Object}},emits:["closeForm"],setup(o,{emit:oe}){const m=o,y=oe,f=Tt(),u=ot(),R=n(!1),E=n([]),j=n([]),Z=n([]),Y=n([]),le=n(""),x=n([]),P=n([]),M=n([]),g=n(),X=n(""),l=B=>{const d=Y.value.findIndex(q=>q.imgBlob==B),S=Y.value[d];if(d>0){const q=Y.value.slice(d),ye=Y.value.slice(0,d);Y.value=[...q,...ye]}le.value=S.url,R.value=!0},me=()=>{le.value="",R.value=!1},he=K(()=>re.orderBy(Z.value,B=>B.type)),se=n(""),de=B=>B?B=="cab side"?"Cab Side":"Off Cab Side":"",ue=K(()=>{let B=Se.value.filter(d=>d.cbmType!="CBM_GAP"&&d.cbmType!=Vt.CBM_BRAKE_PACK_PERCENTAGE);return X.value==lt.OIL_COOLED&&(B=B.filter(d=>d.cbmType!=Vt.BIRRANA&&d.cbmType!=Vt.CAT_GAUGE)),B}),ee=K(()=>{const B=Se.value.filter(d=>d.cbmType=="CBM_GAP");return console.log(B),B}),ve=gt(m,"visibility"),i=gt(m,"cbmData"),Se=n([]),_e=n(!1),Ne=n([]),Ae=B=>{const d=E.value.find(S=>S.key==B);return(d==null?void 0:d.value)??""},Oe=async()=>{if(Ne.value=[],!(Z.value.length<1))for(const[B,d]of Z.value.entries())try{const S=window.URL||window.webkitURL;let q="";if(Te())q=await oa(d.filename);else{const ye=await na(d.filename);q=S.createObjectURL(ye),aa(d.filename,f.stateGeneralForm.workOrder,ye,m.cbmData.taskId,"task",f.employee.id)}E.value.push({key:d.filename,value:q}),Y.value.forEach(ye=>{ye.imgBlob==d.filename&&(ye.url=q)}),j.value[B]=!1}catch(S){console.log("image",S)}},$e=()=>{y("closeForm")},Pe=async()=>{try{let B=[];Te()?(B=f.getFieldValueByKey(m.cbmData.taskId,"items"),X.value=f.getFieldValueByKey(m.cbmData.taskId,tl.RATING),X.value!=lt.OIL_COOLED&&m.cbmData.cbmPistonA&&m.cbmData.cbmPistonB&&(X.value=lt.OIL_COOLED)):(B=await f.getTask(m.cbmData.serviceSheetDetailId,m.cbmData.taskId,"items"),X.value=await f.getTask(m.cbmData.serviceSheetDetailId,m.cbmData.taskId,tl.RATING)),X.value==lt.OIL_COOLED&&(se.value=`${Number(se.value)*100}%`),x.value=B.filter(d=>d.categoryItemType=="previousParamRating"),P.value=B.filter(d=>d.categoryItemType=="paramRating"),M.value=B.filter(d=>d.categoryItemType=="targetRating"),Te()?g.value=f.getFieldValueByKey(m.cbmData.taskId,"replacement"):g.value=await f.getTask(m.cbmData.serviceSheetDetailId,m.cbmData.taskId,"replacement")}catch(B){console.log(B)}},Ve=K(()=>i.value.taskNo.replace(/[^a-z]/gi,"").length>1?i.value.taskNo.replace(";","").replace(/\D/g,""):i.value.taskNo.replace(";","")),Re=async()=>{_e.value=!0,se.value="",m.cbmData&&m.cbmData.cbmMeasurement&&(se.value=ns(m.cbmData.cbmMeasurement)),await Pe();const B=f.stateCBMFormulas.filter(S=>S.taskKey===i.value.taskId);Se.value=re.orderBy(B,["uom","cbmRating","minValue"]);let d=[];Te()?d=f.getFieldValueByKey(i.value.cbmImageKey,i.value.cbmImageProp):d=await u.getDefectImages(i.value.serviceSheetDetailId,i.value.cbmImageKey,i.value.cbmImageProp),console.log("ðŸš€ ~ onFormOpened ~ raw:",d),Z.value=rs(d),console.log("ðŸš€ ~ onFormOpened ~ images.value:",Z.value),j.value=Array.apply(null,Array(Z.value.length)).map(function(){return!0}),Y.value=Z.value.map(S=>({imgBlob:S.filename,url:"",description:S.description})),console.log("ðŸš€ ~ imagesFull.value=images.value.map ~  imagesFull.value:",Y.value),await Oe(),_e.value=!1};return(B,d)=>{const S=ie("el-input"),q=ie("el-option"),ye=ie("el-select"),D=ie("el-skeleton-item"),z=ie("el-skeleton"),U=ie("el-dialog"),G=es("loading");return a(),r(te,null,[p(U,{modelValue:ve.value,"onUpdate:modelValue":d[17]||(d[17]=V=>ve.value=V),"custom-class":"crackform dialog-header-noborder",width:"90%",center:"",onClosed:$e,onOpened:Re,"destroy-on-close":!0},{title:_(()=>[Ii]),default:_(()=>{var V;return[e("div",null,[De((a(),r("div",Ai,[Pi,o.cbmData.appSPVBy?(a(),r(te,{key:0},[p(mt,{message:`${o.cbmData.appSPVDate} - ${o.cbmData.appSPVBy.name}`,"placeholder-message":"Approved by Supervisor"},null,8,["message"]),o.cbmData.approveReason?(a(),ge(mt,{key:0,message:`${o.cbmData.approveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):A("",!0)],64)):A("",!0),o.cbmData.appPlannerBy?(a(),r(te,{key:1},[p(mt,{message:`${o.cbmData.appPlannerDate} - ${o.cbmData.appPlannerBy.name}`,"placeholder-message":"Approved by Planner"},null,8,["message"]),o.cbmData.plannerApproveReason?(a(),ge(mt,{key:0,message:`${o.cbmData.plannerApproveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):A("",!0)],64)):A("",!0),x.value&&P.value&&g.value&&M.value?(a(),r(te,{key:2},[Ti,e("div",Ni,[e("div",{class:"col-1 text-center px-2 py-2",style:be([{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"},g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);"])},[e("label",null,k(Ve.value),1)],4),e("div",{class:"col text-start px-2 py-2",style:be(g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.taskDesc),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:be(g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[x.value.length<1?(a(),ge(S,{key:0,size:"small",class:"dark-text-primary",disabled:!0})):(a(),ge(S,{key:1,size:"small",class:"dark-text-primary",modelValue:x.value[0].value,"onUpdate:modelValue":d[0]||(d[0]=v=>x.value[0].value=v),disabled:!0},null,8,["modelValue"]))],4),e("div",{class:"col-2 text-start px-2 py-2",style:be(g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[P.value.length<1?(a(),ge(S,{key:0,size:"small",class:"dark-text-primary",disabled:!0})):(a(),ge(S,{key:1,size:"small",class:"dark-text-primary",modelValue:P.value[0].value,"onUpdate:modelValue":d[1]||(d[1]=v=>P.value[0].value=v),disabled:!0},null,8,["modelValue"]))],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.cbmUom),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:be([{"border-right":"1px solid rgba(145, 158, 171, 0.24)"},g.value.rating?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);"])},[M.value.length<1?(a(),ge(S,{key:0,size:"small",class:"dark-text-primary",disabled:!0})):(a(),ge(S,{key:1,size:"small",modelValue:M.value[0].value,"onUpdate:modelValue":d[2]||(d[2]=v=>M.value[0].value=v),class:F((V=M.value[0].value)==null?void 0:V.toLowerCase()),disabled:!0},null,8,["modelValue","class"]))],4)]),g.value.rating?(a(),r("div",Oi,[Ri,Fi,Li,e("div",ji,[p(S,{size:"small",class:"dark-text-primary",modelValue:g.value.measurement,"onUpdate:modelValue":d[3]||(d[3]=v=>g.value.measurement=v),disabled:!0},null,8,["modelValue"])]),e("div",Ui,[e("label",null,k(g.value.uom),1)]),e("div",Mi,[p(S,{size:"small",class:F(["dark-text-primary",g.value.rating.toLowerCase()]),modelValue:g.value.rating,"onUpdate:modelValue":d[4]||(d[4]=v=>g.value.rating=v),disabled:!0},null,8,["modelValue","class"])])])):A("",!0),g.value.rating?(a(),r("div",Bi,[qi,Hi,Ei,e("div",Gi,[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.commentValue,"onUpdate:modelValue":d[5]||(d[5]=v=>i.value.commentValue=v),disabled:!0},null,8,["modelValue"])])])):A("",!0)],64)):X.value==L(lt).OIL_COOLED?(a(),r(te,{key:3},[zi,e("div",Wi,[e("div",{class:"col-1 text-center px-2 py-2",style:be([i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);",{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}])},[e("label",null,k(Ve.value),1)],4),e("div",{class:"col text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.taskDesc),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(ye,{size:"small",modelValue:i.value.cbmPistonTool,"onUpdate:modelValue":d[6]||(d[6]=v=>i.value.cbmPistonTool=v),disabled:"",placeholder:"Select"},{default:_(()=>[(a(!0),r(te,null,we([i.value.cbmPistonTool],v=>(a(),ge(q,{key:v,label:v,value:v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.cbmPistonA,"onUpdate:modelValue":d[7]||(d[7]=v=>i.value.cbmPistonA=v),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.cbmPistonB,"onUpdate:modelValue":d[8]||(d[8]=v=>i.value.cbmPistonB=v),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.cbmPistonResult,"onUpdate:modelValue":d[9]||(d[9]=v=>i.value.cbmPistonResult=v),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.cbmUom),1)],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(S,{size:"small",class:"dark-text-primary",modelValue:se.value,"onUpdate:modelValue":d[10]||(d[10]=v=>se.value=v),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be([{"border-right":"1px solid rgba(145, 158, 171, 0.24)"},i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);"])},[p(S,{size:"small",modelValue:i.value.taskValue,"onUpdate:modelValue":d[11]||(d[11]=v=>i.value.taskValue=v),class:F(i.value.taskValue.toLowerCase()),disabled:!0},null,8,["modelValue","class"])],4)])],64)):(a(),r(te,{key:4},[Ji,e("div",Ki,[e("div",{class:"col-1 text-center px-2 py-2",style:be([i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);",{"background-color":"rgb(249, 250, 251)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}])},[e("label",null,k(Ve.value),1)],4),e("div",{class:"col text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.taskDesc),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[p(S,{size:"small",class:"dark-text-primary",modelValue:se.value,"onUpdate:modelValue":d[12]||(d[12]=v=>se.value=v),disabled:!0},null,8,["modelValue"])],4),e("div",{class:"col-1 text-start px-2 py-2",style:be(i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);")},[e("label",null,k(i.value.cbmUom),1)],4),e("div",{class:"col-2 text-start px-2 py-2",style:be([{"border-right":"1px solid rgba(145, 158, 171, 0.24)"},i.value.isCbmAdjusment==="true"&&i.value.correctedValue?"":"border-bottom: 1px solid rgba(145, 158, 171, 0.24);"])},[p(S,{size:"small",modelValue:i.value.taskValue,"onUpdate:modelValue":d[13]||(d[13]=v=>i.value.taskValue=v),class:F(i.value.taskValue.toLowerCase()),disabled:!0},null,8,["modelValue","class"])],4)]),i.value.isCbmAdjusment==="true"&&i.value.correctedValue?(a(),r("div",Yi,[Qi,e("div",Zi,[X.value==L(lt).MANUAL_CLEANED?(a(),r("label",Xi,"After clean")):(a(),r("label",ec,"Adjustment"))]),tc,e("div",lc,[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.correctedMeasurement,"onUpdate:modelValue":d[14]||(d[14]=v=>i.value.correctedMeasurement=v),disabled:!0},null,8,["modelValue"])]),e("div",sc,[e("label",null,k(i.value.correctedUom),1)]),e("div",ac,[p(S,{size:"small",class:F(["dark-text-primary",i.value.correctedValue.toLowerCase()]),modelValue:i.value.correctedValue,"onUpdate:modelValue":d[15]||(d[15]=v=>i.value.correctedValue=v),disabled:!0},null,8,["modelValue","class"])])])):A("",!0),i.value.isCbmAdjusment==="true"&&i.value.correctedValue?(a(),r("div",oc,[nc,rc,ic,e("div",cc,[p(S,{size:"small",class:"dark-text-primary",modelValue:i.value.commentValue,"onUpdate:modelValue":d[16]||(d[16]=v=>i.value.commentValue=v),disabled:!0},null,8,["modelValue"])])])):A("",!0)],64)),dc,ee.value.length==0?(a(),r("div",uc,[e("table",pc,[mc,fc,e("tbody",null,[(a(!0),r(te,null,we(ue.value,(v,fe)=>(a(),r("tr",{key:fe,class:F(fe%2==0?"even":"odd")},[e("th",vc,k(v.cbmRating),1),e("th",yc,k(v.minValueComplete),1),e("th",bc,k(v.maxValueComplete),1),e("th",gc,k(v.uom),1)],2))),128))])])])):A("",!0),ee.value.length>0?(a(),r(te,{key:6},[hc,e("table",_c,[xc,kc,e("tbody",null,[(a(!0),r(te,null,we(ee.value,(v,fe)=>(a(),r("tr",{key:fe,class:F(fe%2==0?"even":"odd")},[e("th",Dc,k(v.cbmRating),1),e("th",wc,k(v.minValueComplete),1),e("th",Cc,k(v.maxValueComplete),1),e("th",$c,k(v.uom),1)],2))),128))])])],64)):A("",!0),Sc,e("div",Vc,[(a(!0),r(te,null,we(he.value,(v,fe)=>(a(),r("div",{class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative",key:v.filename},[p(z,{loading:j.value[fe],animated:""},{template:_(()=>[p(D,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:_(()=>[e("span",Ic,k(de(v.type)),1),e("div",Ac,[Ae(v.filename)!=null?(a(),r("img",{key:0,src:Ae(v.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:ze=>l(v.filename)},null,8,Pc)):A("",!0)])]),_:2},1032,["loading"])]))),128))])])),[[G,_e.value]])])]}),_:1},8,["modelValue"]),R.value?(a(),ge(os,{key:0,images:Y.value,visibility:R.value,image:le.value,onHandleClose:me},null,8,["images","visibility","image"])):A("",!0)],64)}}}),Nc=Ye(Tc,[["__scopeId","data-v-46b9aebf"]]),rl=o=>(Je("data-v-bdf11fa9"),o=o(),Ke(),o),Oc={class:"mt-5 ps-0"},Rc=rl(()=>e("div",{class:"row px-2 item mx-1 w-100 defect-panel-header"},[e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task"),e("div",{class:"col align-items-center d-flex text-break"},"Task Description"),e("div",{class:"col align-items-center d-flex text-break"},"Comments"),e("div",{class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},"Rating"),e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status")],-1)),Fc={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Lc=rl(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),jc=[Lc],Uc={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Mc={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},Bc={class:"col align-items-center d-flex text-break"},qc=["innerHTML"],Hc={class:"col align-items-center d-flex text-break"},Ec={class:"text-break"},Gc={class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},zc={style:{"font-weight":"600",color:"white"}},Wc={style:{"font-weight":"600",color:"white"}},Jc={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},Kc=["onClick"],Yc={class:"row flex-nowrap w-100 flex-row-reverse create-by"},Qc=Ee({__name:"CBMPanel",props:{headers:{required:!0,type:[]},plannerApprove:{required:!1,type:Boolean,default:!1},isDisabled:{required:!1,type:Boolean,default:!1},defectStatus:{required:!1,type:String,default:""}},setup(o){const oe=o,m=n([]),y=n("Component Condition Data"),f=n(),u=n(!1);oe.headers.forEach(()=>{m.value.push(!1)});const R=j=>{const Z=oe.headers.find(Y=>Y.id===j);f.value=Z,u.value=!0},E=()=>{u.value=!1};return(j,Z)=>{const Y=ie("el-collapse-item"),le=ie("el-collapse");return a(),r(te,null,[e("div",Oc,[p(le,{class:"task-group general-accordion py-1 px-5 testing",modelValue:y.value,"onUpdate:modelValue":Z[0]||(Z[0]=x=>y.value=x)},{default:_(()=>[p(Y,{title:"Condition Data",name:"Component Condition Data"},{default:_(()=>[Rc,o.headers.length<1?(a(),r("div",Fc,jc)):(a(!0),r(te,{key:1},we(o.headers,x=>(a(),r("div",{key:x.id,class:"item px-2 my-2 mx-1"},[e("div",Uc,[e("div",Mc,k(L(Bl)(x.taskNo.replace(";",""))),1),e("div",Bc,[e("span",{class:"text-break defect-identified-task",innerHTML:L(ql)(x.taskDesc,x.taskNo.replace(";",""))},null,8,qc)]),e("div",Hc,[e("span",Ec,k(x.commentValue),1)]),e("div",Gc,[e("div",{class:F(["little-box d-flex justify-content-center align-items-center px-2",L(Xt)(x.taskValue)])},[e("span",zc,k(x.taskValue),1)],2),x.correctedValue?(a(),r("div",{key:0,class:F(["little-box d-flex justify-content-center align-items-center px-2 ms-1",L(Xt)(x.correctedValue)])},[e("span",Wc,k(x.correctedValue),1)],2)):A("",!0)]),e("div",Jc,[e("div",{class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",L(al)(x.id,o.headers,!o.plannerApprove,"cbmNAStatus","plannerCbmNAStatus",o.isDisabled,o.defectStatus)]),onClick:xe(P=>R(x.id),["prevent"])}," Detailed Information ",10,Kc)])]),e("div",Yc,k(x.createdBy.name)+", "+k(x.createdDate),1)]))),128))]),_:1})]),_:1},8,["modelValue"])]),p(Nc,{visibility:u.value,"cbm-data":f.value,onCloseForm:E},null,8,["visibility","cbm-data"])],64)}}}),Au=Ye(Qc,[["__scopeId","data-v-bdf11fa9"]]),Dt=o=>(Je("data-v-310d1e37"),o=o(),Ke(),o),Zc={class:"mt-5 ps-0"},Xc={class:"row px-2 item mx-1 w-100 defect-panel-header"},ed=Dt(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),td=Dt(()=>e("div",{class:"col-4 align-items-center d-flex text-break"},"Task Description",-1)),ld={key:0,class:"col align-items-center d-flex text-break"},sd=Dt(()=>e("div",{class:"col column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-end pe-16"},"Review Status",-1)),ad={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},od=Dt(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),nd=[od],rd={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},id={class:"col-4 align-items-center d-flex text-break"},cd=["innerHTML"],dd={key:0,class:"col align-items-center d-flex text-break"},ud={class:"text-break"},pd=["onClick"],md=["onClick"],fd={class:"row flex-nowrap w-100 flex-row-reverse create-by"},vd=Ee({__name:"NAPanel",props:{title:{required:!0,type:String},isDefect:{required:!0,type:Boolean,default:!0},headers:{required:!0,type:[]},plannerApprove:{required:!1,type:Boolean,default:!1},isDisabled:{required:!1,type:Boolean,default:!1}},setup(o){const oe=o,m=ot(),y=n([]),f=K(()=>oe.title),u=n(),R=n();oe.headers.forEach(()=>{y.value.push(!1)});const E=K(()=>!oe.plannerApprove),j=n(!1);n(""),n("");const Z=()=>{j.value=!1},Y=le=>{u.value=void 0,R.value=void 0;const x=le.id;let P=m.ApprovalData.DefectNADetails.find(g=>g.defectHeaderId==x),M=le;P?(j.value=!0,u.value=M,R.value=P):(P=m.ApprovalData.CrackNADetails.find(g=>g.defectHeaderId==x),P&&(j.value=!0,u.value=M,R.value=P))};return(le,x)=>{const P=ie("el-collapse-item"),M=ie("el-collapse");return a(),r(te,null,[e("div",Zc,[p(M,{class:"task-group general-accordion py-1 px-5 testing",modelValue:f.value,"onUpdate:modelValue":x[0]||(x[0]=g=>f.value=g)},{default:_(()=>[p(P,{title:o.title,name:o.title},{default:_(()=>[e("div",Xc,[ed,td,o.isDefect?(a(),r("div",ld,"Comments")):A("",!0),sd]),o.headers.length<1?(a(),r("div",ad,nd)):(a(!0),r(te,{key:1},we(o.headers,g=>(a(),r("div",{key:g.id,class:"row px-2 item mx-1 w-100 my-2"},[e("div",rd,k(g.taskNo.replace(";","")),1),e("div",id,[e("span",{class:"text-break defect-identified-task",innerHTML:L(dt)(g.taskDesc)},null,8,cd)]),o.isDefect?(a(),r("div",dd,[e("span",ud,k(g.commentValue),1)])):A("",!0),e("div",{class:F([[E.value?"col justify-content-end":"col-1 justify-content-center"],"column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex"])},[g.plannerCbmNAStatus=="Decline"||g.cbmNAStatus=="Decline"?(a(),r("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:X=>Y(g)}," Declined ",8,pd)):(a(),r("div",{key:1,class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",L(al)(g.id,o.headers,!0,"cbmNAStatus","plannerCbmNAStatus")]),onClick:xe(X=>Y(g),["prevent"])}," Detailed Information ",10,md))],2),e("div",fd,k(g.createdBy.name)+", "+k(g.createdDate),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),p(is,{ref:"NAFormComponent","view-only":!0,visibility:j.value,"na-data-header":u.value,"na-data-detail":R.value,onClose:Z},null,8,["visibility","na-data-header","na-data-detail"])],64)}}}),Pu=Ye(vd,[["__scopeId","data-v-310d1e37"]]),Me=o=>(Je("data-v-cdb3750b"),o=o(),Ke(),o),yd={class:"mt-5 ps-0"},bd={class:"row px-2 item mx-1 w-100 defect-panel-header"},gd=Me(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),hd=Me(()=>e("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},"Priority",-1)),_d=Me(()=>e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),xd=Me(()=>e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),kd=Me(()=>e("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),Dd={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},wd={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Cd=Me(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),$d=[Cd],Sd={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Vd={class:"col align-items-center d-flex text-break defect-description"},Id=["innerHTML"],Ad={class:"text-center",style:{"font-weight":"600",color:"white"}},Pd={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},Td=["onClick"],Nd=["onClick"],Od={class:"row"},Rd={class:"col-8 col-md-8 d-flex flex-column pe-0"},Fd=["value"],Ld={key:0,class:"ms-1 d-flex align-items-center"},jd=Me(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),Ud=Me(()=>e("span",null,"Loading...",-1)),Md=[jd,Ud],Bd=Me(()=>e("div",{class:"col-4 col-md-3 ps-0 pe-1"},[e("button",{disabled:!0,class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},[e("i",{class:"fa fa-save"})])],-1)),qd=Me(()=>e("img",{src:ht,alt:""},null,-1)),Hd=[qd],Ed={class:"mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",style:{"margin-top":"6px",cursor:"initial"}},Gd=["onClick"],zd={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Wd=Me(()=>e("em",{class:"fa fa-plus me-2"},null,-1)),Jd=Ee({__name:"DefectPanelGeneric",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!0,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},viewIsDownload:{required:!1,type:Boolean,default:!1},assetNumber:{required:!1,type:String,default:""},workorder:{required:!1,type:String,default:""},form:{required:!1,type:String,default:""},disableAddGeneric:{required:!1,type:Boolean,default:!0},isApproval:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},title:{required:!1,type:String,default:"Repairs Completed"}},emits:["onRefreshData"],setup(o,{emit:oe}){const m=o,y=ot(),f=Ot(),u=At(),R=xt(),E=_t(),j=Pt(),Z=oe,Y=n("Generic Defect Identified"),le=n(!1),x=n(!0),P=n(!1),M=n([]),g=n(""),X=n(""),l=n(""),me=n(!1),he=n(!1),se=n(""),de=n({}),ue=n(!1),ee=n(),ve=n(""),i=n(""),Se=n(""),_e=b=>{P.value=!1,se.value=b.priority,he.value=!0},Ne=async(b,N)=>{le.value=!1,ue.value=N,he.value=!1,N?(de.value=y.DefectFormData,le.value=!0):(de.value=j.defectInfo,j.toggleYesVisible(!0))},Ae=b=>{j.toggleIsNeed30Minutes(!1);const N=b.type=="Less than 30 minutes labour and less than $250 in parts";j.toggleIsNeed30Minutes(!N),j.cretateInstance(!N),j.setPredefinedPriority(se.value),j.setDefectRequirment(b.type),Ne(!N,!1),f.addLocalImageInfo({taskKey:"GENERIC",workOrder:m.workorder,type:"defect",updatedBy:m.fitterId,email:R.user.Email})},Oe=()=>{P.value=!1,j.setPredefinedPriority(""),j.toggleYesVisible(!1)},$e=()=>{he.value=!1,j.toggleYesVisible(!1)},Pe=()=>{P.value=!0,nl("form-defect-yes-eform")},Ve=n({type:"",title:"",assetNumber:"",description:"",raisedBy:"",date:"",plannedDuration:"",instruction:"",priority:"P1",parts:JSON.parse("[]"),labours:JSON.parse("[]"),resources:JSON.parse("[]"),symptoms:JSON.parse("[]"),causes:JSON.parse("[]"),images:JSON.parse("[]"),key:""}),Re=b=>!!(b&&b.find(ne=>ne.downloadBy.id==R.user.EmployeeId)),B=()=>{P.value=!0},d=K(()=>m.disableAddGeneric||!E.generalUpdated),S=K(()=>j.DefectYesVisible),q=(b,N)=>N=="Acknowledge",ye=n([""]),D=b=>{var N;return(N=M.value.find(ne=>ne.id==b))==null?void 0:N.wo},z=b=>{var N;return(N=M.value.find(ne=>ne.id==b))==null?void 0:N.load},U=b=>{let N="red  ";return N=y.getGenericCompleteStatus(b.id)?"green":"red",N},G=b=>b.plannerStatus=="Decline"||b.status=="Decline"||b.priority===void 0?"invisible":"",V=b=>{let N=b.createdBy.name,ne=b.updatedDate!=""?b.updatedDate:b.createdDate;const ke=y.ApprovalData.DefectGenericDetails.find(T=>T.defectHeaderId==b.id);return ke&&ke.otherFitterUpdatedBy&&(N=ke.otherFitterUpdatedBy.name,at(ke.updatedDate)>at(ne)&&(ne=ke.updatedDate)),`${N}, ${ne}`},v=b=>b.plannerStatus=="Decline"||b.status=="Decline"?"invisible":"",fe=b=>{y.setDefectDetailDownload(b)},ze=(b,N)=>{y.setApprovalDefectDownload(b,N)},We=(b,N,ne)=>{Ve.value=null,ve.value="",Se.value="";const ke=ae(b),T=re.cloneDeep(ke),Ge=y.getDefectHeader(b);if(T){for(const Fe in T.detail)if(Fe=="parts"||Fe=="labours"||Fe=="resources"||Fe=="symptoms"||Fe=="causes"||Fe=="images")try{T.detail[Fe]=JSON.parse(T.detail[Fe])}catch(it){console.log(it)}T.detail.ownership=j.Ownership,Ve.value=T.detail,fe(T.detail),Ge&&ze(Ge.approvedBy,Ge.approvedDate),ve.value=b}if(Ve.value){H();const it=(ne.includes(";")?ne.split(";")[2]:ne).slice(0,20),wt=T.detail.description<=20?T.detail.description:T.detail.description.slice(0,20);Se.value=`${u.SelectedDefectSheet.unitNumber} ${it} ${wt}${N?` ${N}`:""}`,ee.value.handleDataFetch()}},qe=K(()=>y.ApprovalData.DefectGenericHeaders.filter(N=>y.ApprovalData.DefectGenericDetails.find(ke=>N.defectHeaderId==ke.defectHeaderId&&(ke.detail.isComplete??!0)==(m.title=="Repairs Completed"))!=null)),Qe=K(()=>y.DataFetched),nt=K(()=>{var b;return(b=y.DefectPictures[g.value])==null?void 0:b.map(N=>({fileName:N,url:""}))}),c=(b,N)=>{let ne="light-yellow color-dark-yellow";const ke=N==null?void 0:N.find(T=>T.id===b);if(ke){switch(ke.generalStatus){case"Submited":ne="light-yellow color-dark-yellow";break;case"Acknowledge":ne="light-green color-dark-green";break}ke.priority===void 0&&(ne="light-green color-dark-green")}return ne};Le(Qe,b=>{b===!0&&(I(),w())});const I=()=>{M.value=[],qe.value.forEach(b=>{M.value.push({id:b.id,wo:b.defectWorkorder,load:!1})})},w=()=>{ye.value=[],qe.value.forEach(b=>{ye.value.findIndex(ne=>b.taskDesc&&b.taskDesc.split(";")[1]&&b.taskDesc.split(";")[1]!=""?ne==b.taskDesc.split(";")[0]+";"+b.taskDesc.split(";")[1]:ne==b.taskNo)<0&&(b.taskDesc&&b.taskDesc.split(";")[1]&&b.taskDesc.split(";")[1]!=""?ye.value.push(b.taskDesc.split(";")[0]+";"+b.taskDesc.split(";")[1]):ye.value.push(b.taskNo))})},H=()=>{const b=R.user.Name,N=kt(E.stateTimeZone);i.value=`${b}, at ${N} (${E.stateTimeZoneDesc})`};Nt(()=>{j.resetInstance(),Qe.value&&(I(),w()),Te()||E.getServerTimestamp()});const ce=async b=>{f.setCurrent("defect");const N=await y.setDefectGenericData(b);x.value=y.getGenericCompleteStatus(b),y.setGenericDefectGeneralStatus(b),X.value=b,m.fitterId?l.value=u.SelectedWorkOrder:l.value=u.SelectedDefectSheet.workOrder,Ne(N==="YES",!0)},ae=b=>y.getDefectGenericDetail(b),Q=()=>{le.value=!1},Ze=()=>{me.value=!1},rt=()=>{Z("onRefreshData")};return(b,N)=>{const ne=ie("el-collapse-item"),ke=ie("el-collapse");return a(),r(te,null,[e("div",yd,[p(ke,{class:"task-group general-accordion defect-panel-wrapper px-5 pb-1",modelValue:Y.value,"onUpdate:modelValue":N[0]||(N[0]=T=>Y.value=T)},{default:_(()=>[p(ne,{title:`Generic Defect Identified - ${o.title}`,name:"Generic Defect Identified"},{default:_(()=>[e("div",bd,[gd,hd,_d,xd,kd,o.viewIsDownload?(a(),r("div",Dd)):A("",!0)]),qe.value.length===0?(a(),r("div",wd,$d)):(a(!0),r(te,{key:1},we(qe.value,T=>(a(),r("div",{key:T,class:"item px-2 my-2 mx-1"},[e("div",Sd,[e("div",Vd,[e("span",{class:"text-break",innerHTML:T.taskDesc},null,8,Id)]),e("div",{class:F(["col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center",v(T)])},[e("div",{class:F(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",L(yt)(T.priority)]),style:{"margin-top":"6px"}},[e("span",Ad,k(T.priority),1)],2)],2),e("div",Pd,[T.plannerStatus=="Decline"||T.status=="Decline"?(a(),r("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:Ge=>ce(T.id)}," Declined ",8,Td)):(a(),r("div",{key:1,class:F(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",c(T.id,qe.value)]),onClick:Ge=>ce(T.id)}," Detailed Information ",10,Nd))]),e("div",{class:F(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",G(T)])},[e("div",Od,[e("div",Rd,[e("input",{type:"text",class:"form-control mou-input",placeholder:"Input Work Order",value:D(T.id),disabled:!0},null,8,Fd),z(T.id)?(a(),r("div",Ld,Md)):A("",!0)]),Bd])],2),e("div",{class:F(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",v(T)])},[e("div",{class:F(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[U(T)]]),style:{"margin-top":"6px"}},Hd,2)],2),o.viewIsDownload?(a(),r("div",{key:0,class:F(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",v(T)])},[e("div",Ed,[q(T.defectWorkorder&&T.defectWorkorder!="",o.plannerApprove?T.plannerStatus:T.status)?(a(),r("img",{key:0,onClick:Ge=>We(T.id,T.defectWorkorder,T.taskDesc),class:F(["ms-4 me-2 download-icon",Re(T.downloadHistory)?"icon-green":"icon-red"]),src:It,style:{height:"18px"},alt:""},null,10,Gd)):A("",!0)])],2)):A("",!0)]),e("div",zd,k(V(T)),1)]))),128)),!d.value&&o.title=="Repairs Completed"?(a(),r("button",{key:2,class:"my-3 btn-add-new",onClick:B},[Wd,W(" Add Generic Identified Defect, If Required ")])):A("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue"])]),p(la,{show:P.value,onSubmit:_e,onClose:Oe},null,8,["show"]),p(Vs,{show:he.value,onSubmit:Ae,onClose:$e},null,8,["show"]),p(cs,{images:nt.value,visibility:me.value,onHandleClose:Ze},null,8,["images","visibility"]),p(sl,{status:L(y).GeneralStatus,visibility:le.value,"defect-data":L(y).DefectFormData,"header-id":X.value,"work-order":l.value,"view-only":o.viewOnly,"fitter-id":o.fitterId,"predefined-priority":se.value,"task-id":"GENERIC",plannerApprove:o.plannerApprove,generic:!0,"is-form":o.isForm,"is-complete":x.value,onCloseForm:Q,onOnRefreshData:rt},null,8,["status","visibility","defect-data","header-id","work-order","view-only","fitter-id","predefined-priority","plannerApprove","is-form","is-complete"]),o.title=="Repairs Completed"?(a(),ge(Mn,{key:0,visibility:S.value,"asset-number":o.assetNumber,"defect-data":L(j).defectInfo,generic:!0,form:o.form,workorder:o.workorder,"predefined-priority":se.value,"is-revise":ue.value,onOnRefreshData:rt,onAddAnotherDefect:Pe},null,8,["visibility","asset-number","defect-data","form","workorder","predefined-priority","is-revise"])):A("",!0)],64)}}}),Tu=Ye(Jd,[["__scopeId","data-v-cdb3750b"]]);export{Iu as C,Vu as D,Pu as N,la as _,Tu as a,Au as b,Vs as c,oa as d,Mn as e,na as g,aa as h};
