import{a as Q,b as Ee,l as Je,d as Pe,e as Le,f as We}from"./index-BuVmIl8K.js";import{u as je,a as qe}from"./useDefectsFormStore-41UTMhiG.js";import{u as Be}from"./useDailyScheduleStore-B3ZQzhxq.js";import{n as Re}from"./navigator-D5io2Cca.js";import{_ as H,a as V}from"./OfflineWorkOrderDialog.vue_vue_type_style_index_0_lang-Cz-mBkE7.js";import{b as Ue,u as Ge}from"./vue-router-iNp9kJ0K.js";import{e as He}from"./lodash-DrHMlsdo.js";import{k as X,c as s,p as I,aa as D,aB as r,C as k,B as Ve,bd as Z,bb as ee,r as g,d as W,o as ze,a7 as Ye,s as p,F as Ke,$ as Qe,R as z,b4 as Xe}from"./@vue-BypzYtbH.js";import{_ as te}from"./nw-img-vue-CR837WER.js";import{_ as Ze}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{a as et}from"./get-user-info-DjfNX8-X.js";import{u as tt}from"./@vueuse-DFoNmIyu.js";import{u as ot}from"./useGlobalConnectionStore-DV9B81de.js";import{_ as nt}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{u as rt}from"./useComponentInterventionStore-Cc_xw-uu.js";import{u as it}from"./useComponentInterventionEformStore-CMy33xkJ.js";import{u as st}from"./useCronStore-CDY_CiV6.js";import{u as at}from"./useMasterStore-CzSO06fn.js";import{u as lt}from"./usePersonelLabourStore-BUmSURn2.js";import{a as ct,u as ut}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{u as mt,a as dt}from"./useInterimEngineStore-Ctq4w8Oq.js";import{u as pt,a as St,b as ft}from"./useEFormStore-DtkLPope.js";import{a as Y}from"./element-plus-BeWdvTRa.js";import{_ as vt}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{u as yt}from"./useSyncStore-DsLBNjEA.js";import{d as j}from"./cron-De-pTz2b.js";import{i as b,r as K}from"./internet-connection-CnLQPjRt.js";import{u as gt}from"./useMsal-BbsBYoof.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./luxon-C_T8jI2d.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-CvqtYZA-.js";import"./number-format-BdMuQVyW.js";import"./urls-CPQ2HRXU.js";import"./prev-val-handler-DvA3D_kF.js";import"./helpers-wUOLw-dU.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./date-format-8-IvfSl3.js";import"./moment-C5S46NFB.js";import"./urls-B0Rq9QQ3.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./authentication-handler-Pueb_EI7.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./useCameraStore-BwXVJhPe.js";import"./useAttachmentStore-DqM3autD.js";import"./SelectSearch-CnaDUnr3.js";import"./useBodyStore-L-idhAYV.js";import"./urls-RITu66bD.js";import"./urls-COjrEEs1.js";import"./disabled-state-O9W-ZY8y.js";import"./list-pcxkCnQg.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./CrackYesClass-COntz77m.js";import"./IronformConfig-BWypCgSI.js";const bt="/media/svg/dma/side-menu/inactive/logout.png",ht=S=>(Z("data-v-18b7a932"),S=S(),ee(),S),wt={class:"avatar-card py-3"},It={class:"row justify-content-center mb-0 mt-2"},Dt=["src"],_t={key:1,class:"symbol symbol-circle firstname-placeholder text-center d-flex flex-row justify-content-center align-items-center"},Ct={class:"col text-center mt-4"},kt=ht(()=>r("br",null,null,-1)),Ot=X({__name:"AvatarCard",setup(S){const h=Q(),l=s(()=>h.user||{}),O=s(()=>h.userPic||""),x=s(()=>He.isUndefined(h.user.Name)?"":h.user.Name[0]);return(J,q)=>{var o,n,f;return I(),D("div",wt,[r("div",It,[O.value!=""?(I(),D("img",{key:0,class:"px-0",style:{height:"42px",width:"42px","border-radius":"28px"},src:O.value,alt:""},null,8,Dt)):(I(),D("div",_t,[r("span",null,k(x.value),1)]))]),r("div",Ct,[r("h4",null,k((o=l.value)==null?void 0:o.Name),1),r("span",null,k((n=l.value)==null?void 0:n.Position),1),Ve(),kt,r("span",null,k((f=l.value)==null?void 0:f.Location),1)])])}}}),xt=te(Ot,[["__scopeId","data-v-18b7a932"]]),oe=S=>(Z("data-v-b581e4ab"),S=S(),ee(),S),Nt={class:"full-page d-flex"},At={class:"d-flex flex-column flex-shrink-0",style:{width:"11rem"}},$t={class:"ms-5 menu-wrapper d-flex flex-column"},Mt=["onClick"],Tt=["src"],Ft={class:"label text-center"},Et=oe(()=>r("img",{src:bt,alt:"icon",style:{width:"18px",height:"20px"}},null,-1)),Jt=oe(()=>r("h4",{class:"label"},"Logout",-1)),Pt=[Et,Jt],Lt={class:"mb-10"},Wt={class:"d-flex flex-column flex-fill px-5"},jt=X({__name:"SidebarLayout",setup(S){const h=tt(),{redirectByName:l}=Re(),O=Ue(),x=g(!1),J=Ee(),q=je(),o=Be(),n=Q(),f=ot(),u=rt(),ne=it(),_=st(),v=at(),re=lt(),ie=qe(),m=ct(),se=mt(),ae=dt(),N=g(!1),i=pt(),le=St(),ce=ft(),y=ut(),c=yt(),ue=Ge(),me=g(!1),A=g(!1),$=g(!1),P=g(!1),M=g(!1),L=g(!1),de=s(()=>i.DailyScheduleOptions),pe=s(()=>f.stateSubmitConnectionError),Se=s(()=>_.TokenIntervalId),fe=s(()=>J.menuDMA),ve=s(()=>o.DailyScheduleOptions),ye=s(()=>m.WorkOrder.map(e=>{var t,a;return{label:`<span class="break-word">${e.equipment} - ${e.equipmentDesc} - <span class="${((t=e.sampleStatus)==null?void 0:t.toLowerCase())=="caution"?"yellow":((a=e.sampleStatus)==null?void 0:a.toLowerCase())=="normal"?"green":"red"}">${e.sampleStatus} Intervention</span> - ${e.componentSystem} - ${e.sapWorkOrder}</span>`,value:e.id,icon:e.status=="Updated"?"Updated":"",labelPlain:`${e.equipment} - ${e.equipmentDesc} - ${e.sampleStatus} Intervention - ${e.sapWorkOrder}`,status:e.interventionExecution,progress:e.progress}})),ge=s(()=>o.DailyScheduleInterimOptions),be=s(()=>n.loggedIn),he=s(()=>_.FormSyncIntervalId);W(be,e=>{e||K(C)});const we=e=>e==="e-Form"?"Digital Service Forms":e==="Approval"?"Digital Service Approvals":e;ze(async()=>{if(b()?(c.stopAllJob(),await v.getSymptoms(),await v.getActions(),await v.getCauses(),await v.getNAConditions(),await v.getCBMMappings(),await v.getPositions(),await v.getOwnership(),m.getWorkOrdersFromLocal(),re.setPersonalLaboursLocal()):(R(),U(),G(),n.user.SiteId&&(await i.getDailySchedules(n.user.SiteId),o.getDailySchedules(n.user.SiteId),o.getDailySchedulesInterim(n.user.SiteId),u.getComponentInterventions(n.user.SiteId)),await u.getParamDaysBeforeEst(),await v.getCBMMappingDataFromServer(),await v.getMasterDataFromServer()),c.stopAllJob(),b())c.stopAllJob();else{if(Se.value!=null)return;let e=window.setInterval(async()=>{await n.renewToken()},6e5);if(_.setTokenCronJob(e),he.value!=null)return;e=window.setInterval(async()=>{await y.SyncData(),await y.SyncImage()},2e3),_.setFormSyncCronJob(e),m.syncWithIronPortalData(),m.getLatestSyncDate(),n.user.SiteId&&m.getWorkOrders(n.user.SiteId)}});const Ie=async e=>{if(e.icon=="Updated")return;if(!f.stateConnectionStatus){f.setSubmitConnectionError(!0);return}const t=m.WorkOrder.find(w=>w.id==e.value),a=Y.service({lock:!0,text:"Please wait, we are downloading service sheet data to local device.",background:"rgba(0, 0, 0, 0.7)"});await m.handleSetInterventionAccessibleOffline(t),a.close()},De=async e=>{if(!f.stateConnectionStatus){f.setSubmitConnectionError(!0);return}const t=i.stateDailySchedules.find(w=>w.id==e.value),a=Y.service({lock:!0,text:"Please wait, we are downloading service sheet data to local device.",background:"rgba(0, 0, 0, 0.7)"});await i.handleServiceFormAccessibleOffline(t),a.close()},_e=async e=>{if(i.setSelectedDailySchedule(e.value),b()&&await i.getServiceSheetDetailFromLocalDB(i.SelectedDailySchedule.workOrder)==null){L.value=!0;return}i.setSelectedDailySchedule(e.value),le.setSMUActual(Number(i.SelectedDailySchedule.smuDue)),ce.setModelAndPsTypeId(i.SelectedDailySchedule.equipmentModel,i.SelectedDailySchedule.psType,i.SelectedDailySchedule.workOrder,i.SelectedDailySchedule.equipmentModelName,i.SelectedDailySchedule.unitNumber),l("eformoffline")},B=(e="")=>{let t;return e!=""&&(t=e.split("/")[2].replaceAll(" ","").replaceAll("-","").toLowerCase()),t===O.name||me.value===!0},Ce=e=>B(e)?"/media/svg/dma/side-menu/active/":"/media/svg/dma/side-menu/inactive/",ke=()=>{P.value=!0},Oe=()=>{f.setSubmitConnectionError(!1)},xe=e=>{o.setSelectedDailySchedule(e.value),ie.setSMUActual(Number(o.SelectedDailySchedule.smuDue)),q.setModelAndPsTypeId(o.SelectedDailySchedule.equipmentModel,o.SelectedDailySchedule.psType,o.SelectedDailySchedule.workOrder,o.SelectedDailySchedule.equipmentModelName,o.SelectedDailySchedule.unitNumber),l("eform")},Ne=async e=>{u.setSelectedComponentIntervention(e.value),ne.setComponentInterventionHeader(u.SelectedComponentIntervention.id,u.SelectedComponentIntervention.equipment,u.SelectedComponentIntervention.sapWorkOrder,u.SelectedComponentIntervention.equipmentDesc,u.SelectedComponentIntervention.sampleStatus,u.SelectedComponentIntervention.componentDescription),m.setSelectedWorkOrder(e.value),m.setSelectedShortWorkOrder(e.label),b()?await m.getWorkOrderDetailFromDB(e.value)!=null&&l("componentinterventionforms"):l("componentinterventionforms")},T=s(()=>c.jobRenewToken),R=()=>{if(!(T.value&&T.value.running))if(T.value)T.value.start();else{const e=new j.CronJob("*/10 * * * *",async function(){K(C)},null,!0);c.setJobRenewTokenRunning(e)}},F=s(()=>c.jobSyncTask),U=()=>{if(!(F.value&&F.value.running))if(F.value)y.SyncData(),F.value.start();else{y.SyncData();const e=new j.CronJob("*/3 * * * * *",function(){y.SyncData()},null,!0);c.setJobSyncTaskRunning(e)}},E=s(()=>c.jobSyncTaskImage),G=()=>{if(!(E.value&&E.value.running))if(E.value)b()||y.SyncImage(),E.value.start();else{b()||y.SyncImage();const e=new j.CronJob("*/3 * * * * *",function(){b()||y.SyncImage()},null,!0);c.setJobSyncTaskImageRunning(e)}},Ae=async e=>{o.setSelectedDailyScheduleInterim(e.value),ae.setSMUActual(Number(o.SelectedDailyScheduleInterim.smuDue)),se.setModelAndPsTypeId(o.SelectedDailyScheduleInterim.equipmentModel,o.SelectedDailyScheduleInterim.psType,o.SelectedDailyScheduleInterim.workOrder,o.SelectedDailyScheduleInterim.equipmentModelName,o.SelectedDailyScheduleInterim.unitNumber),l("interimengineservice")},$e=(e,t="")=>{var d;const a=e.split("/")[2].replaceAll(" ","").replaceAll("-","").toLowerCase(),w=["componentinterventionforms","eformoffline","eformv2","pendingtaskmonitor"];if(!(b()&&!w.includes(a)))switch(a){case"eform":A.value=!0;break;case"eformoffline":case"eformv2":N.value=!0;break;case"componentinterventionforms":$.value=!0;break;case"interimengineservice":M.value=!0;break;default:t.includes("Guide")?(d=window.open(e,"_blank"))==null||d.focus():l(a)}},{instance:C}=gt(),Me=async()=>{try{await C.logoutPopup()}catch(e){console.log(e)}finally{localStorage.clear(),sessionStorage.clear(),n.reset(),J.reset(),_.releaseCronJob(),c.reset();try{const e=Pe();e.provider&&e.provider.resetUser()}catch(e){console.log(e)}finally{await Le(We,"validTokenNew"),ue.push({name:"signin"})}}},Te=()=>{P.value=!1},Fe=()=>{l("ironforms")};return Ye(async()=>{await C.acquireTokenSilent(Je),x.value=!0,await et(h.value,C),x.value=!1}),W(()=>n.user.SiteId,async e=>{e&&(await i.getDailySchedules(n.user.SiteId),o.getDailySchedules(n.user.SiteId),o.getDailySchedulesInterim(n.user.SiteId),u.getComponentInterventions(n.user.SiteId))}),W(h,e=>{e?(R(),U(),G()):c.stopAllJob()}),(e,t)=>{const a=z("NwImg"),w=z("router-view");return I(),D("div",Nt,[r("div",At,[r("div",{class:"logo-wrapper d-flex align-items-center ms-1",onClick:Fe},[p(a,{style:{cursor:"pointer","margin-left":"auto"},src:"/media/logos/logo-whitebg.png",class:"h-40px logo"})]),r("div",$t,[(I(!0),D(Ke,null,Qe(fe.value,d=>(I(),D("div",{key:d.Path,class:Xe(["px-2 menu d-flex flex-fill flex-column justify-content-center align-items-center py-5 shadow-lg position-relative",B(d.Path)?"active":""]),onClick:qt=>$e(d.Path,d.MenuName)},[r("img",{src:`${Ce(d.Path)}/${d.Icon}`,alt:"icon",style:{width:"18px",height:"20px"}},null,8,Tt),r("h4",Ft,k(we(d.MenuName)),1)],10,Mt))),128)),r("div",{class:"menu d-flex flex-fill flex-column justify-content-center align-items-center py-5 shadow-lg",onClick:ke},Pt),r("div",Lt,[p(xt)])])]),r("div",Wt,[p(w)]),p(H,{title:"Commence Digital Service",placeholder:"Outstanding Services",visibility:N.value,data:de.value,onOnSubmit:_e,onOnDownload:De,onOnClose:t[0]||(t[0]=()=>{N.value=!N.value})},null,8,["visibility","data"]),p(vt,{visibility:L.value,caption:"Data is not available in offline mode",onOnClose:t[1]||(t[1]=()=>{L.value=!1})},null,8,["visibility"]),p(V,{title:"Commence Digital Service",placeholder:"Outstanding Services",visibility:A.value,data:ve.value,onOnSubmit:xe,onOnClose:t[2]||(t[2]=()=>{A.value=!A.value})},null,8,["visibility","data"]),p(H,{title:"Commence Digital Component Intervention",placeholder:"Outstanding Component Intervention",visibility:$.value,data:ye.value,onOnSubmit:Ne,onOnDownload:Ie,onOnClose:t[3]||(t[3]=()=>{$.value=!$.value})},null,8,["visibility","data"]),p(V,{title:"Interim Engine Service",placeholder:"Outstanding Interim Engine Service",visibility:M.value,data:ge.value,onOnSubmit:Ae,onOnClose:t[4]||(t[4]=()=>{M.value=!M.value})},null,8,["visibility","data"]),p(Ze,{visibility:P.value,caption:"Are you sure want to log out?",onOnNoConfirm:Te,onOnYesConfirm:Me},null,8,["visibility"]),p(nt,{show:pe.value,onClose:Oe,"title-pop-up":"No internet connection"},null,8,["show"])])}}}),wn=te(jt,[["__scopeId","data-v-b581e4ab"]]);export{wn as default};
