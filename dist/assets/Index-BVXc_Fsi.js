import{a as At}from"./breadcrumb-BYmEOf4C.js";import{c as z,J as St,I as wt,K as dt,j as ct,A as Dt,y as Ut}from"./index-BuVmIl8K.js";import{P as Nt}from"./Pagination-D-xfdYmn.js";import{P as et}from"./Pagination-BiobnanQ.js";import{I as H,B as Rt,U as Bt}from"./urls-DzqKjzQ_.js";import{d as ut}from"./pinia-BjOS2_Ao.js";import{a as zt,d as Mt}from"./table-sort-Bpdq_Uwn.js";import{k as O,r as U,u as b,y as J,p as w,aa as N,q as B,x as r,R as g,Y as mt,s,aB as a,C as K,bL as qt,B as R,A as Y,F as pt,a0 as st,c as P,T as ht,bd as X,bb as Z,b4 as Ot,$ as Tt,a7 as jt,L as Ht}from"./@vue-BypzYtbH.js";import{_ as T}from"./nw-img-vue-CR837WER.js";import{_ as W,b as Gt}from"./element-plus-BeWdvTRa.js";import{e as Kt}from"./lodash-DrHMlsdo.js";import{c as gt,a as q}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{E as ft}from"./ErrorAlert-CMKGfwAi.js";import{F as yt}from"./file-saver-CwTBvle_.js";import{_ as at}from"./Icon.vue_vue_type_script_setup_true_lang-DE-yo5DI.js";import{A as Jt}from"./MetronicAlert-CahvwpSR.js";import{_ as Yt}from"./TextInput.vue_vue_type_script_setup_true_lang-oAh_qqu1.js";import{_ as Qt}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./vue-router-iNp9kJ0K.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";const nt={site:"",status:"true",page:1,pageSize:20},ot=ut({id:"siteList",state:()=>({stateFilterData:{site:"",status:"",page:1,pageSize:20},stateLastUsedFilterData:{...nt},statePageName:"site",stateDisplayData:[],stateDraftData:[],statePagination:new et,stateLoading:!1,statePaginationLoading:!1,stateSiteOption:[],stateSearchValue:""}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateSearchValue?t.stateDisplayData.filter(l=>{var o,i,e,p;return((o=l.siteId)==null?void 0:o.toLowerCase().includes(t.stateSearchValue.toLocaleLowerCase()))||((i=l.siteName)==null?void 0:i.toLowerCase().includes(t.stateSearchValue.toLocaleLowerCase()))||((e=l.siteCode)==null?void 0:e.toLowerCase().includes(t.stateSearchValue.toLocaleLowerCase()))||((p=l.modifiedBy)==null?void 0:p.toLowerCase().includes(t.stateSearchValue.toLocaleLowerCase()))}):t.stateDisplayData,draftData:t=>t.stateDraftData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,siteOption:t=>t.stateSiteOption},actions:{async getData(t=!0){this.stateLoading=!0,this.stateLastUsedFilterData={...this.stateFilterData};const l={ver:"v1"},o={site:this.stateFilterData.site,status:this.stateFilterData.status===""?null:this.stateFilterData.status==="true",page:this.stateFilterData.page,pageSize:this.stateFilterData.pageSize};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const i=await z.post(`${H}?${new URLSearchParams(l).toString()}`,o);this.stateDisplayData=i.data.result.content.siteList,this.stateDraftData=i.data.result.content.siteDraftList,this.setTotalPage(i.data.result.content.totalData)}catch(i){console.log(i)}this.stateLoading=!1},async template(){try{const t={};return(await z.postBlob(`${H}/export/true?ver=v1`,t)).data}catch(t){console.log(t)}},async export(){const t={site:this.stateFilterData.site,status:this.stateFilterData.status===""?null:this.stateFilterData.status==="true"};try{return(await z.postBlob(`${H}/export/false?ver=v1`,t)).data}catch(l){console.log(l)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPageSize(t){this.statePaginationLoading=!0,this.stateFilterData.pageSize=t,this.statePagination.totalPageSize=this.stateFilterData.pageSize,this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!0),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.statePagination.totalPageSize=this.stateFilterData.pageSize,this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setFilterData(t){this.stateLoading=!0,this.stateFilterData=t,await this.getData(!1)},setLastActiveFilter(t){this.stateFilterData=t},async resetFilter(){this.stateFilterData=nt,this.stateFilterData.page=1,this.stateFilterData.pageSize=20;const t=this.stateLastUsedFilterData.page!==0,l=this.stateLastUsedFilterData.pageSize!==0;(t||l)&&await this.getData()},setSearchValue(t){this.stateSearchValue=t},resetState(){this.stateFilterData={...nt},this.stateDisplayData=[],this.statePagination=new et,this.stateLoading=!1,this.statePaginationLoading=!1}}}),Q=ut({id:"siteForm",state:()=>({stateFormData:{isActive:!0},stateFormDraft:{},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateLoadingMessage:""}),getters:{formData:t=>t.stateFormData,formDraftData:t=>t.stateFormDraft,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading},actions:{async upsertData(){var t,l;try{this.stateLoading=!0;const o={ver:"v1"},i=[this.stateFormData],e=await z.post(`${H}/upsert?${new URLSearchParams(o).toString()}`,i);e.data.title!=="Error"?e.data.result.isError?(this.stateErrors.push((l=(t=e.data.result.content)==null?void 0:t.siteList[0])==null?void 0:l.validationReason),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1):(this.stateErrors.push(e.data.result.message),this.stateIsError=!0)}catch(o){this.stateErrors.push(o.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateDraft(){var t,l;try{this.stateLoading=!0;const o={ver:"v1"},i=[this.stateFormDraft],e=await z.post(`${H}/upsert?${new URLSearchParams(o).toString()}`,i);e.data.title!=="Error"?e.data.result.isError?(this.stateErrors.push((l=(t=e.data.result.content)==null?void 0:t.siteList[0])==null?void 0:l.validationReason),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1):(this.stateErrors.push(e.data.result.message),this.stateIsError=!0)}catch(o){this.stateErrors.push(o.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async deleteDraft(t){try{this.stateLoading=!0;const l=[{siteDraftId:t}],o=await z.post(`${H}/delete_draft?ver=v1`,l);o.data.title!=="Error"?o.data.result.isError?(this.stateErrors.push("Failed to delete draft"),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1):(this.stateErrors.push(o.data.result.message),this.stateIsError=!0)}catch(l){this.stateErrors.push(l&&l.response.data.result.message),this.stateIsError=!0,this.stateLoading=!1}finally{this.stateLoading=!1}},async deleteBulkDraft(t){const l=new URLSearchParams({ver:"v1"}).toString();this.stateLoading=!0,this.stateLoadingMessage="Removing Data";try{return(await z.post(`${H}/delete_draft?${l}`,t)).data}catch(o){console.log(o)}finally{this.stateLoading=!1,this.stateLoadingMessage=""}},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.siteKeyId=t.siteKeyId||0,this.stateFormData.siteId=t.siteId||"",this.stateFormData.siteCode=t.siteCode||"",this.stateFormData.siteName=t.siteName||"",this.stateFormData.isActive=t.isActive||!1},setFormDraftData(t){this.stateFormDraft.siteDraftId=t.siteDraftId||0,this.stateFormDraft.siteId=t.siteId||"",this.stateFormDraft.siteCode=t.siteCode||"",this.stateFormDraft.siteName=t.siteName||"",this.stateFormDraft.isActive=!0},resetState(){this.stateFormData={isActive:!0},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),Wt={key:0,style:{height:"100px"}},Xt={class:"text-name"},Zt={class:"text-sitename"},te={key:0,class:"d-flex justify-content-center"},ee={class:"badge badge-circle badge-success mx-auto rounded-badge-success"},ae={key:1,class:"d-flex justify-content-center"},se={class:"badge badge-circle badge-success mx-auto rounded-badge-error"},oe={class:"row"},ie={class:"d-flex justify-content-end"},le=["onClick"],re=O({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog"],setup(t,{emit:l}){const o=t,i=ot(),e=Q(),p=l,y=U(""),n=S=>{y.value=S.order},v=(S,I,u)=>zt(S[u].toString()||"",I[u].toString()||"",y.value),E=S=>{e.setFormData(S),p("show-dialog",null)};return(S,I)=>{const u=g("el-table-column"),k=g("inline-svg"),m=g("el-tooltip"),D=g("el-table"),F=mt("loading");return b(i).loading?J((w(),N("div",Wt,null,512)),[[F,b(i).loading]]):J((w(),B(D,{key:1,data:o.listData,style:{width:"100%"},onSortChange:n,"sort-orders":["ascending","descending"],"default-sort":{prop:"siteId",order:"ascending"},"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell","empty-text":"No Data"},{default:r(()=>[s(u,{prop:"siteId",label:"Site ID",width:"200",sortable:"","sort-orders":["ascending","descending"],"sort-method":(h,_)=>v(h,_,"siteId"),align:"left"},{default:r(h=>[a("div",Xt,K(h.row.siteId),1)]),_:1},8,["sort-method"]),s(u,{width:"200",prop:"siteCode",label:"Site Code",sortable:"","sort-orders":["ascending","descending"],"sort-method":(h,_)=>v(h,_,"siteCode")},null,8,["sort-method"]),s(u,{width:"200",prop:"siteName",label:"Site Name",sortable:"","sort-orders":["ascending","descending"],"sort-method":(h,_)=>v(h,_,"siteName")},{default:r(h=>[a("div",Zt,K(h.row.siteName),1)]),_:1},8,["sort-method"]),s(u,{width:"200",prop:"isActive",label:"Status",align:"center",sortable:"","sort-orders":["ascending","descending"],"sort-method":(h,_)=>v(h,_,"isActive")},{default:r(h=>[h.row.isActive?(w(),N("div",te,[a("div",ee,[s(k,{src:"/media/svg/tables/rows/check-light.svg"})])])):(w(),N("div",ae,[a("div",se,[s(k,{src:"/media/svg/tables/rows/valid-false-light.svg"})])]))]),_:1},8,["sort-method"]),s(u,{label:"Action","min-width":"80",align:"right",fixed:"right"},{default:r(h=>[a("div",oe,[a("div",ie,[s(m,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:r(()=>[a("span",{onClick:_=>E(h.row),class:"svg-icon svg-icon-btech-secondary-500 d-flex justify-content-end cursor-pointer"},[s(k,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,le)]),_:2},1024)])])]),_:1})]),_:1},8,["data"])),[[F,b(i).loading]])}}}),ne=T(re,[["__scopeId","data-v-df5c497e"]]),tt=ut({id:"siteBulk",state:()=>({stateBulkPayload:{},stateAlert:{show:!1,variant:"",desc:""},statePagination:new et,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{alertVariant:t=>t.stateAlert.variant,alertDesc:t=>t.stateAlert.desc,validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkUpload(){this.stateLoading=!0;const t=new FormData;t.append("fileUpload",this.stateBulkPayload.fileUpload);try{const l=await z.post(`${H}/bulk?ver=v1`,t);if(l.data.statusCode==200)if(l.data.result.isError)this.stateIsError=!0,this.stateError=l.data.result.message;else{const o=l.data.result.content,i=o.totalData,p=o.siteList.filter(n=>n.isValid===!1).length,y=i>1?"records":"record";p===0&&i===0?this.stateAlert={show:!0,variant:"info",desc:"No record has been submitted, please check your file"}:p===0&&i>0?this.stateAlert={show:!0,variant:"success",desc:`${i} of ${i} ${y} submitted successfully`}:p>0&&i>0&&(this.stateAlert={show:!0,variant:"warning",desc:`${p} of ${i} ${y} failed to submit`})}else this.stateAlert={show:!0,variant:"warning",desc:l.data.result.message},this.stateIsError=l.data.result.isError,this.stateError=l.data.result.message;this.stateLoading=!1}catch(l){console.log(l),this.stateLoading=!1,this.stateError=l,this.stateIsError=!0}},async bulkInsert(t){const l={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const o=await z.post(`${Rt}?${new URLSearchParams(l).toString()}`,this.stateBulkData);this.stateError=o.data.result.isError?o.data.result.message:"",this.stateIsError=o.data.result.isError}catch(o){console.log(o)}this.stateLoading=!1},async upload({userAccount:t,excelFile:l}){const o={userAccount:t,ver:"v1"},i=`${Bt}?${new URLSearchParams(o).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const e=await z.postImages(i,l);e.data.statusCode==200?e.data.result.isError?(this.stateIsError=!0,this.stateError=e.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=e.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=Kt.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=e.data.result.isError,this.stateError=e.data.result.message)}catch(e){console.log(e),this.stateIsError=!0,this.stateError=e.response.data.result.message}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(Mt(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new et,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),de={key:0,class:"d-flex justify-content-end"},ce={class:"svg-icon svg-icon-btech-danger-500 d-inline-block mr-2"},ue={key:1,style:{height:"100px"}},me={class:"d-flex gap-4"},pe=["onClick"],he={class:"text-name"},ge={class:"d-flex justify-content-end gap-6"},fe=["onClick"],ve=["onClick"],_e=O({__name:"DraftGrid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog","show-errors","delete-draft"],setup(t,{emit:l}){const o=t,i=ot(),e=Q();tt();const p=l;qt(()=>(o.page-1)*20+1);const y=U(""),n=m=>{y.value=m.order;const D={prop:m.prop,order:m.order};i.setSort(D)},v=m=>{e.setFormDraftData(m),p("show-dialog",null)},E=m=>{const D={name:m.siteName,errors:m.validationReason};p("show-errors",D)},S=m=>{p("delete-draft",m)},I=U([]),u=m=>{I.value=m.map(D=>({siteDraftId:D.siteDraftId}))},k=()=>{St("Remove all selected records from Need Review?","Remove").then(async m=>{m.isConfirmed&&await e.deleteBulkDraft(I.value).then(()=>{i.setPage(1),wt("Records have been successfully deleted!","Ok"),I.value=[]})})};return(m,D)=>{const F=g("inline-svg"),h=g("el-button"),_=g("el-tooltip"),c=mt("loading");return w(),N(pt,null,[I.value.length>0?(w(),N("section",de,[s(h,{class:"btn btn-outline btn-outline-btech-danger btn-active-light-btech-danger btech-md mb-4",onClick:k},{default:r(()=>[a("span",ce,[s(F,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})]),R(" Delete ("+K(I.value.length)+") ",1)]),_:1})])):Y("",!0),b(i).loading?J((w(),N("div",ue,null,512)),[[c,b(i).loading]]):J((w(),B(b(Gt),{key:2,data:o.listData,style:{width:"100%"},"max-height":400,onSortChange:n,"empty-text":"No Data","header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSelect:u,onSelectAll:u},{default:r(()=>[s(b(W),{label:"Site ID",width:"200",align:"left",prop:"validationReason"},{default:r(d=>[a("div",me,[s(_,{class:"box-item",effect:"dark",content:"Click to see errors.",placement:"top"},{default:r(()=>[a("span",{class:"svg-icon svg-icon-btech-danger-500 me-1",style:{cursor:"pointer"},onClick:L=>E(d.row)},[s(F,{src:"/media/icons/bumaau/info.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,pe)]),_:2},1024),a("div",he,K(d.row.siteId),1)])]),_:1}),s(b(W),{width:"200",prop:"siteCode",label:"Site Code"}),s(b(W),{"min-width":"200",prop:"siteName",label:"Site Name"}),s(b(W),{label:"Action",width:"80",align:"center",fixed:"right"},{default:r(d=>[a("div",ge,[s(_,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:r(()=>[a("span",{onClick:L=>v(d.row),class:"svg-icon svg-icon-btech-secondary-500 d-inline-block m-0 cursor-pointer"},[s(F,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,fe)]),_:2},1024),s(_,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:r(()=>[a("span",{onClick:L=>S(d.row),class:"svg-icon svg-icon-btech-danger-500 d-inline-block m-0 cursor-pointer"},[s(F,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,ve)]),_:2},1024)])]),_:1}),s(b(W),{type:"selection",fixed:"right",width:"40",align:"center","header-align":"center"})]),_:1},8,["data"])),[[c,b(i).loading]])],64)}}}),be=T(_e,[["__scopeId","data-v-c45fa329"]]),vt=t=>(X("data-v-f46cdeb1"),t=t(),Z(),t),De={class:"col-md-12 fv-row fv-plugins-icon-container"},ye=vt(()=>a("span",{class:"required"},"Site ID",-1)),Se={class:"col-md-12 fv-row fv-plugins-icon-container"},we=vt(()=>a("span",{class:"required"},"Site Code",-1)),Ie={class:"col-md-12 fv-row fv-plugins-icon-container"},Ce=vt(()=>a("span",{class:"required"},"Site Name",-1)),Ee={class:"dialog-footer"},ke=O({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:l}){const o=t,i=l,e=Q(),p=tt(),y=st(o,"visibility"),n=P(()=>e.formData),v=P(()=>e.errors),E=P(()=>e.isError),S=gt().shape({siteId:q().required("Site is mandatory"),siteCode:q().required("Site Code is mandatory"),siteName:q().required("Site Name is mandatory")}),I=()=>{k(""),D(""),m(""),F(!0)},u=(c=!1)=>{_(),I(),e.resetState(),i("handle-close",c)},k=c=>{n.value.siteId=c},m=c=>{n.value.siteName=c},D=c=>{n.value.siteCode=c},F=c=>{n.value.isActive=c},h=async()=>{_(),p.stateAlert.show=!1,e.stateLoadingMessage="Submitting Data",await S.validate(n.value,{abortEarly:!1}).catch(c=>{e.setErrors(c.errors)}),!E.value&&e.upsertData().then(()=>{e.isError?ct("Failed to Submit","","Ok"):dt("Record has been submitted successfully","","Ok").then(()=>{u(!0)})})},_=()=>{e.setErrors([])};return(c,d)=>{const L=g("el-input"),V=g("el-form-item"),G=g("el-form"),M=g("el-button"),j=g("el-dialog");return w(),B(j,{modelValue:y.value,"onUpdate:modelValue":d[4]||(d[4]=C=>y.value=C),title:"Add New Site",width:500,"close-on-click-modal":!1,"show-close":!1,onClose:d[5]||(d[5]=C=>u())},{footer:r(()=>[a("span",Ee,[s(M,{type:"secondary",onClick:d[3]||(d[3]=C=>u()),disabled:b(e).loading},{default:r(()=>[R("Close")]),_:1},8,["disabled"]),s(M,{type:"primary",onClick:h,disabled:b(e).loading},{default:r(()=>[R("Submit")]),_:1},8,["disabled"])])]),default:r(()=>[s(ht,{name:"fade"},{default:r(()=>[E.value?(w(),B(ft,{key:0,errorMessages:v.value,onResetForm:_},null,8,["errorMessages"])):Y("",!0)]),_:1}),s(G,{class:"row g-4 my-4","label-position":"top"},{default:r(()=>[a("div",De,[s(V,{class:"m-0"},{label:r(()=>[ye]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteId,"onUpdate:modelValue":d[0]||(d[0]=C=>n.value.siteId=C),placeholder:"Add Site ID",onInput:k},null,8,["modelValue"])]),_:1})]),a("div",Se,[s(V,{class:"m-0"},{label:r(()=>[we]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteCode,"onUpdate:modelValue":d[1]||(d[1]=C=>n.value.siteCode=C),placeholder:"Add Site Code",onInput:D},null,8,["modelValue"])]),_:1})]),a("div",Ie,[s(V,{class:"m-0"},{label:r(()=>[Ce]),default:r(()=>[s(L,{"max-length":"3",modelValue:n.value.siteName,"onUpdate:modelValue":d[2]||(d[2]=C=>n.value.siteName=C),placeholder:"Add Site Name",onInput:m},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1},8,["modelValue"])}}}),$e=T(ke,[["__scopeId","data-v-f46cdeb1"]]),it=t=>(X("data-v-1260c43b"),t=t(),Z(),t),Fe={class:"col-md-12 fv-row fv-plugins-icon-container"},Le=it(()=>a("span",{class:"required"},"Site ID",-1)),xe={class:"col-md-12 fv-row fv-plugins-icon-container"},Pe=it(()=>a("span",{class:"required"},"Site Code",-1)),Ve={class:"col-md-12 fv-row fv-plugins-icon-container"},Ae=it(()=>a("span",{class:"required"},"Site Name",-1)),Ue={class:"col-md-12 fv-row fv-plugins-icon-container"},Ne={class:"align-items-center fv-row"},Re=it(()=>a("label",{class:Ot("form-label fs-6 fw-bolder")},[R("Status "),a("span",{class:"text-danger"},"*")],-1)),Be={class:"d-flex align-items-center justify-content-between form-control form-control-lg"},ze={class:"dialog-footer"},Me=O({__name:"FormEditDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:l}){const o=t,i=l,e=Q(),p=tt(),y=st(o,"visibility"),n=P(()=>e.formData),v=P(()=>e.errors),E=P(()=>e.isError),S=gt().shape({siteId:q().required("Site is mandatory"),siteCode:q().required("Site Code is mandatory"),siteName:q().required("Site Name is mandatory")}),I=()=>{e.stateFormData.siteKeyId=0,k(""),D(""),m(""),F(!1)},u=(c=!1)=>{I(),_(),e.resetState(),i("handle-close",c)},k=c=>{n.value.siteId=c},m=c=>{n.value.siteName=c},D=c=>{n.value.siteCode=c},F=c=>{n.value.isActive=c},h=async()=>{_(),p.stateAlert.show=!1,e.stateLoadingMessage="Submitting Data",await S.validate(n.value,{abortEarly:!1}).catch(c=>{e.setErrors(c.errors)}),!E.value&&e.upsertData().then(()=>{e.isError?ct("Failed to Update","","Ok"):dt("Record has been submitted successfully","","Ok").then(()=>{u(!0)})})},_=()=>{e.setErrors([])};return(c,d)=>{const L=g("el-input"),V=g("el-form-item"),G=g("el-switch"),M=g("el-form"),j=g("el-button"),C=g("el-dialog");return w(),B(C,{modelValue:y.value,"onUpdate:modelValue":d[5]||(d[5]=A=>y.value=A),title:"Edit Site",width:500,"close-on-click-modal":!1,"show-close":!1,onClose:d[6]||(d[6]=A=>u())},{footer:r(()=>[a("span",ze,[s(j,{type:"secondary",onClick:d[4]||(d[4]=A=>u()),disabled:b(e).loading},{default:r(()=>[R("Close")]),_:1},8,["disabled"]),s(j,{type:"primary",onClick:h,disabled:b(e).loading},{default:r(()=>[R("Submit")]),_:1},8,["disabled"])])]),default:r(()=>[s(ht,{name:"fade"},{default:r(()=>[E.value?(w(),B(ft,{key:0,errorMessages:v.value,onResetForm:_},null,8,["errorMessages"])):Y("",!0)]),_:1}),s(M,{class:"row g-4 my-4","label-position":"top"},{default:r(()=>[a("div",Fe,[s(V,{class:"m-0"},{label:r(()=>[Le]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteId,"onUpdate:modelValue":d[0]||(d[0]=A=>n.value.siteId=A),placeholder:"Add Site ID",onInput:k},null,8,["modelValue"])]),_:1})]),a("div",xe,[s(V,{class:"m-0"},{label:r(()=>[Pe]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteCode,"onUpdate:modelValue":d[1]||(d[1]=A=>n.value.siteCode=A),placeholder:"Add Site Code",onInput:D},null,8,["modelValue"])]),_:1})]),a("div",Ve,[s(V,{class:"m-0"},{label:r(()=>[Ae]),default:r(()=>[s(L,{"max-length":"3",modelValue:n.value.siteName,"onUpdate:modelValue":d[2]||(d[2]=A=>n.value.siteName=A),placeholder:"Add Site Name",onInput:m},null,8,["modelValue"])]),_:1})]),a("div",Ue,[a("div",Ne,[Re,a("div",Be,[s(G,{modelValue:n.value.isActive,"onUpdate:modelValue":d[3]||(d[3]=A=>n.value.isActive=A),name:"Status",onHandleChange:F},null,8,["modelValue"]),a("span",null,K(n.value.isActive?"Active":"Inactive"),1)])])])]),_:1})]),_:1},8,["modelValue"])}}}),qe=T(Me,[["__scopeId","data-v-1260c43b"]]),Oe=O({__name:"DownloadButton",emits:["handleDownload"],setup(t,{emit:l}){const o=l,i=()=>{o("handleDownload")};return(e,p)=>(w(),N("button",{class:"d-flex gap-2 align-items-center btn btn-btech-outline px-4 py-2",onClick:i},[s(at,{name:"download",size:"24"}),R(" Export ")]))}}),Te=T(Oe,[["__scopeId","data-v-0c70acd8"]]),je={key:0},He={class:"m-0",style:{"word-break":"normal"}},Ge={key:1},Ke=O({__name:"DraftErrorModal",props:{visibility:{type:Boolean,default:!1},errorData:{type:Object,default:null}},emits:["handle-close"],setup(t,{emit:l}){const o=t,i=P(()=>{var v,E;return(E=(v=o.errorData)==null?void 0:v.errors)==null?void 0:E.split(",")}),e=st(o,"visibility"),p=l,y=(n=!1)=>{p("handle-close",n)};return(n,v)=>{var S;const E=g("el-dialog");return w(),B(E,{modelValue:e.value,"onUpdate:modelValue":v[0]||(v[0]=I=>e.value=I),title:`Errors for ${(S=o.errorData)==null?void 0:S.name}`,width:"500px",onClose:v[1]||(v[1]=I=>y()),"align-center":""},{default:r(()=>[i.value?(w(),N("ul",je,[(w(!0),N(pt,null,Tt(i.value,(I,u)=>(w(),N("li",{key:u},[a("p",He,K(I),1)]))),128))])):(w(),N("p",Ge,"Undefined"))]),_:1},8,["modelValue","title"])}}}),Je=T(Ke,[["__scopeId","data-v-ab75fb3d"]]),_t=t=>(X("data-v-108865cd"),t=t(),Z(),t),Ye={class:"col-md-12 fv-row fv-plugins-icon-container"},Qe=_t(()=>a("span",{class:"required"},"Site ID",-1)),We={class:"col-md-12 fv-row fv-plugins-icon-container"},Xe=_t(()=>a("span",{class:"required"},"Site Code",-1)),Ze={class:"col-md-12 fv-row fv-plugins-icon-container"},ta=_t(()=>a("span",{class:"required"},"Site Name",-1)),ea={class:"dialog-footer"},aa=O({__name:"FormEditDraftDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:l}){const o=t,i=l,e=Q(),p=tt(),y=st(o,"visibility"),n=P(()=>e.formDraftData),v=P(()=>e.errors),E=P(()=>e.isError),S=gt().shape({siteId:q().required("Site is mandatory"),siteCode:q().required("Site Code is mandatory"),siteName:q().required("Site Name is mandatory")}),I=()=>{e.stateFormData.siteKeyId=0,k(""),D(""),m(""),F(!1)},u=(c=!1)=>{I(),_(),e.resetState(),i("handle-close",c)},k=c=>{n.value.siteId=c},m=c=>{n.value.siteName=c},D=c=>{n.value.siteCode=c},F=c=>{n.value.isActive=c},h=async()=>{_(),p.stateAlert.show=!1,e.stateLoadingMessage="Submitting Data",await S.validate(n.value,{abortEarly:!1}).catch(c=>{e.setErrors(c.errors)}),!E.value&&e.updateDraft().then(()=>{e.isError?ct("Failed to Submit","","Ok"):dt("Record has been submitted successfully","","Ok").then(()=>{u(!0)})})},_=()=>{e.setErrors([])};return(c,d)=>{const L=g("el-input"),V=g("el-form-item"),G=g("el-form"),M=g("el-button"),j=g("el-dialog");return w(),B(j,{modelValue:y.value,"onUpdate:modelValue":d[4]||(d[4]=C=>y.value=C),title:"Edit Site",width:500,"close-on-click-modal":!1,"show-close":!1,onClose:d[5]||(d[5]=C=>u())},{footer:r(()=>[a("span",ea,[s(M,{type:"secondary",onClick:d[3]||(d[3]=C=>u()),disabled:b(e).loading},{default:r(()=>[R("Close")]),_:1},8,["disabled"]),s(M,{type:"primary",onClick:h,disabled:b(e).loading},{default:r(()=>[R("Submit")]),_:1},8,["disabled"])])]),default:r(()=>[s(ht,{name:"fade"},{default:r(()=>[E.value?(w(),B(ft,{key:0,errorMessages:v.value,onResetForm:_},null,8,["errorMessages"])):Y("",!0)]),_:1}),s(G,{class:"row g-4 my-4","label-position":"top"},{default:r(()=>[a("div",Ye,[s(V,{class:"m-0"},{label:r(()=>[Qe]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteId,"onUpdate:modelValue":d[0]||(d[0]=C=>n.value.siteId=C),placeholder:"Add Site ID",onInput:k},null,8,["modelValue"])]),_:1})]),a("div",We,[s(V,{class:"m-0"},{label:r(()=>[Xe]),default:r(()=>[s(L,{maxlength:"4",modelValue:n.value.siteCode,"onUpdate:modelValue":d[1]||(d[1]=C=>n.value.siteCode=C),placeholder:"Add Site Code",onInput:D},null,8,["modelValue"])]),_:1})]),a("div",Ze,[s(V,{class:"m-0"},{label:r(()=>[ta]),default:r(()=>[s(L,{"max-length":"3",modelValue:n.value.siteName,"onUpdate:modelValue":d[2]||(d[2]=C=>n.value.siteName=C),placeholder:"Add Site Name",onInput:m},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1},8,["modelValue"])}}}),sa=T(aa,[["__scopeId","data-v-108865cd"]]),oa=t=>(X("data-v-88d259a0"),t=t(),Z(),t),ia={class:"employee-filter-container"},la=oa(()=>a("div",{class:"employee-filter-header"},[a("p",{class:"m-0 fw-700 text-large"},"Filters")],-1)),ra={class:"row employee-filter-body"},na={class:"col-12"},da={class:"col-12"},ca=O({__name:"FilterButton",emits:["applyFilter"],setup(t,{emit:l}){const o=ot(),i=U({site:"",status:"",ver:"v1",page:1,pageSize:20}),e=U([{value:"",label:"All"},{value:"true",label:"Active"},{value:"false",label:"Inactive"}]),p=U(!1),y=l,n=()=>{y("applyFilter",i)},v=()=>{i.value.site=o.stateLastUsedFilterData.site,i.value.status=o.stateLastUsedFilterData.status,p.value=!p.value},E=()=>{i.value.site=o.stateLastUsedFilterData.site,i.value.status=o.stateLastUsedFilterData.status,p.value=!1},S=()=>{i.value.site="",i.value.status=""};return(I,u)=>{const k=g("el-popover");return w(),B(k,{placement:"bottom",width:480,trigger:"click",visible:p.value},{reference:r(()=>[a("button",{class:"d-flex gap-2 align-items-center btn btn-btech-outline px-4 py-2",onClick:v},[s(at,{name:"filter",size:"24"}),R(" Filter ")])]),default:r(()=>[a("div",ia,[la,a("div",ra,[a("div",na,[s(Yt,{value:i.value.site,margin:!1,placeholder:"Search Site ID, Site Code or Site name",label:"Site",name:"Site",onHandleChange:u[0]||(u[0]=m=>i.value.site=m),max:255},null,8,["value"])]),a("div",da,[s(Qt,{class:"m-0",margin:!1,options:e.value,value:i.value.status,name:"Status",label:"Status",placeholder:"Select status",onHandleChange:u[1]||(u[1]=m=>i.value.status=m)},null,8,["options","value"])])]),a("div",{class:"employee-filter-footer"},[a("div",null,[a("button",{class:"btn btn-btech-outline",onClick:S}," Reset ")]),a("div",{class:"d-flex gap-4 align-items-center"},[a("button",{class:"btn btn-btech-outline",onClick:E}," Close "),a("button",{class:"btn btn-btech",onClick:n},"Apply")])])])]),_:1},8,["visible"])}}}),ua=T(ca,[["__scopeId","data-v-88d259a0"]]),lt=t=>(X("data-v-d7a8a3b6"),t=t(),Z(),t),ma={"element-loading-text":"Uploading File","element-loading-background":"rgba(0, 0, 0, 0.5)"},pa=["element-loading-text"],ha={class:"px-3 py-8"},ga={class:"d-flex justify-content-between align-items-center"},fa=lt(()=>a("div",{class:""},[a("div",{class:"flex-grow-1"},[a("h5",{class:"mb-2 header-title"},"Site")])],-1)),va={class:"align-self-start d-flex gap-2"},_a=lt(()=>a("i",{class:"fas fa-plus fs-4 pe-2"},null,-1)),ba={key:0,class:"card mb-6"},Da={class:"m-0"},ya={class:"text-btech-danger-500"},Sa=lt(()=>a("section",{class:"mb-6"},null,-1)),wa={class:"card mb-10"},Ia={class:"card-body p-3"},Ca={class:"d-flex justify-content-between my-4 align-items-center"},Ea=lt(()=>a("p",{class:"m-0 card-table-title"},"Site List",-1)),ka={class:"d-flex justify-content-between gap-2"},$a={class:"my-5"},Fa=O({__name:"Index",setup(t){l[Dt.ACTIVE_PAGE]("IronLake");const l=useMenuStore(),o=ot(),i=Q(),e=tt(),p=U(!1),y=U(!1),n=U(!1),v=U(!1),E=U({}),S=U(null),I=U(["draftPanel"]),u=P(()=>o.displayData),k=P(()=>o.draftData),m=P(()=>e.stateBulkPayload),D=P(()=>o.pagination),F=f=>{o.setPage(f)};jt(async()=>{l[Dt.ACTIVE_PAGE]("IronLake"),At("Site",[{pageName:"Site",pageRoute:"site"}]),await o.setPage(1)}),Ht(()=>{o.resetState(),i.resetState(),e.resetState()});const h=async()=>{await o.setPage(1)},_=()=>{p.value=!0},c=async f=>{p.value=!1,f&&await h()},d=()=>{y.value=!0},L=async f=>{y.value=!1,f&&await h()},V=async()=>{const f=await o.export();yt.saveAs(new Blob([f],{type:"application/octet-stream"}),"Site.xlsx")},G=f=>{o.setPageSize(f)},M=f=>{E.value=f,v.value=!0},j=()=>{v.value=!1},C=()=>{n.value=!0},A=async f=>{n.value=!1,f&&await h()},It=()=>{var f;(f=S.value)==null||f.click()},Ct=async()=>{const f=await o.template();yt.saveAs(new Blob([f],{type:"application/octet-stream"}),"MasterSite.xlsx")},Et=f=>{m.value.fileUpload=f},kt=async f=>{const $=f.target.files[0];Et($),$t(),S.value&&(S.value.value="")},$t=()=>{e.bulkUpload().then(()=>{h()})},Ft=async f=>{i.stateLoadingMessage="Removing Data",St("Remove this record from Need Review ?").then(async $=>{$.isConfirmed&&i.deleteDraft(f.siteDraftId).then(()=>{i.isError?Ut(`Failed to delete : ${i.stateErrors[0].toString}`,"Close").then(()=>{h()}):wt("Record has been removed successfuly!","Close").then(()=>{h()})})})},Lt=f=>{o.setFilterData(f),o.setLastActiveFilter(f)};return(f,$)=>{const rt=g("el-button"),xt=g("el-tooltip"),Pt=g("el-collapse-item"),Vt=g("el-collapse"),bt=mt("loading");return w(),N(pt,null,[a("template",null,[J(a("div",ma,null,512),[[bt,b(e).loading,void 0,{fullscreen:!0,lock:!0}]]),J(a("div",{"element-loading-text":b(i).stateLoadingMessage,"element-loading-background":"rgba(0, 0, 0, 0.5)"},null,8,pa),[[bt,b(i).loading,void 0,{fullscreen:!0,lock:!0}]])]),a("section",ha,[a("div",ga,[fa,a("div",va,[s(xt,{class:"box-item",effect:"dark",content:"Download Site Template",placement:"top"},{default:r(()=>[s(rt,{class:"btn btn-icon btn-btech-outline btech-lg m-0",onClick:Ct},{default:r(()=>[s(at,{name:"excel-icon",size:"20"})]),_:1})]),_:1}),s(rt,{class:"btn btn-btech-outline btech-lg m-0",onClick:It},{default:r(()=>[s(at,{name:"upload",size:"20"}),R(" Upload ")]),_:1}),a("input",{ref_key:"bulkFile",ref:S,type:"file",accept:".xlsx",hidden:"",onChange:kt},null,544),s(rt,{class:"btn btn-btech-secondary btech-lg m-0",onClick:$[0]||($[0]=x=>_())},{default:r(()=>[_a,R(" Add New ")]),_:1})])])]),s(Jt,{"show-alert":b(e).stateAlert.show,"onUpdate:showAlert":$[1]||($[1]=x=>b(e).stateAlert.show=x),variant:b(e).alertVariant,desc:b(e).alertDesc},null,8,["show-alert","variant","desc"]),k.value.length>0?(w(),N("section",ba,[s(Vt,{modelValue:I.value,"onUpdate:modelValue":$[4]||($[4]=x=>I.value=x),class:"card-body p-3 ironlake-draft-collapse"},{default:r(()=>[s(Pt,{name:"draftPanel"},{title:r(()=>[a("p",Da,[R(" Need Review "),a("span",ya," ("+K(k.value.length)+") ",1)])]),default:r(()=>[Sa,s(be,{"list-data":k.value,page:D.value.currentPage,onShowDialog:C,onShowErrors:$[2]||($[2]=x=>M(x)),onDeleteDraft:$[3]||($[3]=x=>Ft(x))},null,8,["list-data","page"])]),_:1})]),_:1},8,["modelValue"])])):Y("",!0),a("section",wa,[a("div",Ia,[a("div",Ca,[Ea,a("div",ka,[s(ua,{onApplyFilter:$[5]||($[5]=x=>Lt(x))}),s(Te,{onHandleDownload:V})])]),s(ne,{"list-data":u.value,page:D.value.currentPage,onShowDialog:d},null,8,["list-data","page"]),a("div",$a,[b(o).paginationLoading?Y("",!0):(w(),B(Nt,{key:0,onRaisePageChange:$[6]||($[6]=x=>F(x)),onRaiseSizeChange:$[7]||($[7]=x=>G(x)),currentPage:D.value.currentPage,totalPage:D.value.totalPage,totalPageSize:D.value.totalPageSize,startPaginationIndex:D.value.startPaginationIndex,endPaginationIndex:D.value.endPaginationIndex,isPageSizeChange:!0,pageSizes:[50,20,10]},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),s($e,{visibility:p.value,onHandleClose:c},null,8,["visibility"]),s(qe,{visibility:y.value,onHandleClose:L},null,8,["visibility"]),s(sa,{visibility:n.value,onHandleClose:A},null,8,["visibility"]),s(Je,{visibility:v.value,onHandleClose:j,"error-data":E.value},null,8,["visibility","error-data"])])])],64)}}}),Es=T(Fa,[["__scopeId","data-v-d7a8a3b6"]]);export{Es as default};
