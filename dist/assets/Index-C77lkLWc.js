import{k as oe,a0 as he,r as D,c as P,o as wt,p as r,aa as m,aB as t,bd as Ie,bb as we,b4 as ue,d as Ee,R as O,Y as ve,y as te,q as G,x as p,s as i,B as le,C as S,F as K,$ as ae,A as V,u as y,_ as kt,T as Ve,aG as Fn,bL as nt,a2 as at,a1 as $n,a7 as Pn,L as Tn,n as An}from"./@vue-BypzYtbH.js";import{e as Re}from"./lodash-DrHMlsdo.js";import{c as X,a as ce,s as ne,J as Wt,O as Nn,f as En,I as vt,y as Vn}from"./index-BuVmIl8K.js";import{c as Ut}from"./urls-DrpWsKIM.js";import{d as rt}from"./pinia-BjOS2_Ao.js";import{x as ht,q as ft,w as gt,h as qt,B as St,K as On,L as ot}from"./date-format-8-IvfSl3.js";import{a as bt,m as Ye,f as Hn}from"./mapOption-CeGMwmH0.js";import{u as Fe}from"./useComponentInterventionDefectsStore-CA75rH_W.js";import{_ as De}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import{_ as Ce}from"./ElementTextInput.vue_vue_type_style_index_0_lang-kzHysIyZ.js";import{_ as Un}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-CCwjwK39.js";import{_ as ge}from"./nw-img-vue-CR837WER.js";import{_ as Z,b as Dt}from"./element-plus-BeWdvTRa.js";import{D as Mt}from"./DefectNoClass-BqGKOkzR.js";import{D as Bt}from"./urls-CvqtYZA-.js";import{u as Se,f as Xt,g as Qt}from"./useComponentInterventionEformStore-CMy33xkJ.js";import{u as zt}from"./useCameraStore-BwXVJhPe.js";import{u as qn}from"./useAttachmentStore-DqM3autD.js";import{u as it}from"./authentication-handler-Pueb_EI7.js";import{u as yt}from"./useGlobalConnectionStore-DV9B81de.js";import{t as Mn,l as Zt,p as en}from"./helpers-wUOLw-dU.js";import{S as lt,f as Ge}from"./number-format-BdMuQVyW.js";import{u as Bn}from"./usePreviewNaFormStore-C1MJT2RQ.js";import{u as Ct}from"./useInterventionDefectStore-CSZwjVeC.js";import{_ as tn}from"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import{s as It}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{E as Oe}from"./ErrorAlert-CMKGfwAi.js";import{a as dt}from"./vee-validate-C_msoaAA.js";import{c as ct,a as me,f as zn}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{_ as jn}from"./AutoComplete.vue_vue_type_script_setup_true_lang-DJ43pGTI.js";import{_ as Gn}from"./Repair-zyV2di4A.js";import{d as xt}from"./manipulate-html-string-DqTEGh-F.js";import{u as Yn,o as Kn}from"./vue-router-iNp9kJ0K.js";import{C as Jn}from"./urls-Cljsxeb-.js";import{_ as Wn}from"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import{s as jt}from"./urls-CPQ2HRXU.js";import{_ as Ne}from"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import{v as nn}from"./uuid-SoommWqA.js";import{u as Xn}from"./useMasterStore-CzSO06fn.js";import{P as Qn}from"./Pagination-D-xfdYmn.js";import{c as Zn}from"./get-user-info-DjfNX8-X.js";import{u as ea}from"./useMsal-BbsBYoof.js";import"./@popperjs-BaMZbQYT.js";import"./object-path-DPahbflh.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./moment-C5S46NFB.js";import"./CrackNoClass-0DSU7BAn.js";import"./CrackYesClass-COntz77m.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./urls-RITu66bD.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import"./@vueuse-DFoNmIyu.js";import"./internet-connection-CnLQPjRt.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";import"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import"./language-BriOOvyN.js";import"./useBodyStore-L-idhAYV.js";const He="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention",st="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/intervention_forms/lookup",ta="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/intervention_form_lookup",na=`${He}_header/intervention_forms`,aa=`${He}_header/recommended_action`,sa=`${He}_header/additional_task`,oa=`${He}_header/get_list_by_param`,ia=`${He}_header/intervention_forms`,la=`${He}_header/get_estimation_completion_date`,Gt="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/list_intervention",Yt="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/list_intervention_declined",ra="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/total_list_intervention",da="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/type_task_lookup",ca="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/type_condition_lookup",ua="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/uom/lookup_transaction",ma="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/get_list_sensor",pa="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/revise_sensor";class va{constructor(a=1,n=10,s=0,l=-1,c=0){this.getPaginationStartIndex=()=>{this.startPaginationIndex=(this.currentPage-1)*this.totalPageSize},this.getPaginationLastIndex=()=>{const o=this.startPaginationIndex+this.totalPageSize>=this.totalPage?void 0:this.startPaginationIndex+this.totalPageSize;this.endPaginationIndex=o||this.totalPage},this.handleCurrentPageChange=o=>{this.currentPage=o,this.getPaginationStartIndex(),this.getPaginationLastIndex()},this.getPaginationStartIndexFromBE=()=>{this.currentPage>1?this.startPaginationIndex=this.totalPageSize*(this.currentPage-1):this.currentPage==1&&(this.startPaginationIndex=0)},this.getPaginationLastIndexFromBE=()=>{this.currentPage==1&&this.currentPage*this.totalPageSize<=this.totalPage?this.endPaginationIndex=this.totalPageSize:this.currentPage*this.totalPageSize>this.totalPage?this.endPaginationIndex=this.totalPage:this.currentPage>1&&(this.endPaginationIndex=this.currentPage*this.totalPageSize)},this.handleCurrentPageChangeFromBE=o=>{this.currentPage=o,this.getPaginationStartIndexFromBE(),this.getPaginationLastIndexFromBE()},this.currentPage=a,this.totalPageSize=n,this.totalPage=s,this.startPaginationIndex=l,this.endPaginationIndex=c}}const ha=Fe(),fa={keyPbi:""},_t={additionalTaskId:0,sequence:0,recAction:"",executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",taskKey:"",isActive:!0,isDeleted:!1,psType:"",interventionIdCosmos:"",images:[],typeTaskId:0,uom:"",typeTask:"",componentId:"",listComponent:[]},Kt={equipmentId:"",equipmentNumber:"",interventionCode:"",workOrder:"",model:"",modelId:"",brand:"",status:"",intervention:"",keyPbi:"",interventionDate:"",componentGroup:""},ye=rt({id:"interventionList",state:()=>({stateFilter:{...fa},stateComponentList:[],stateReRenderSelection:!1,stateRerenderComponentList:!1,stateInterventionCheckList:[],stateAdditionalTaskList:[],stateDeletedAdditionalTaskList:[],stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateComponentListLoading:!1,stateHeader:[{label:"Pending Evaluation",total:0,value:"Pending Evaluation"},{label:"Submitted",total:0,value:"Submitted"},{label:"Yet to Start",total:0,value:"Yet to Start"},{label:"In Progress",total:0,value:"In Progress"},{label:"Under Review",total:0,value:"Under Review"},{label:"Final Review",total:0,value:"Final Review"},{label:"Closed",total:0,value:"Close"},{label:"Declined",total:0,value:"Declined"}],stateSelectedHeader:"Pending Evaluation",stateSelectedHeaderItem:{...Kt},stateHeaderListItems:[],stateLoadingHeader:!1,stateIsSelectedItem:!1,statePaginationLoading:!1,statePagination:new va(1,3),stateSearchOptions:[],stateTypeTaskOptions:[],stateFormAdditionalTask:{..._t},stateConditionOptions:[],stateLoadingConditionOptions:!1,stateUomOptions:[],stateComponentFromEquipment:""}),getters:{componentList:e=>e.stateComponentList,reRenderSelection:e=>e.stateReRenderSelection,reRenderComponentList:e=>e.stateRerenderComponentList,interventionCheckList:e=>e.stateInterventionCheckList,additionalTaskList:e=>e.stateAdditionalTaskList,deletedAdditionalTaskList:e=>e.stateDeletedAdditionalTaskList,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,componentListLoading:e=>e.stateComponentListLoading,headerList:e=>e.stateHeader,selectedHeader:e=>e.stateSelectedHeader,selectedHeaderItem:e=>e.stateSelectedHeaderItem,isSelectedItem:e=>e.stateIsSelectedItem,headerListItems:e=>e.stateHeaderListItems,pagination:e=>e.statePagination,loadingHeader:e=>e.stateLoadingHeader,paginationLoading:e=>e.statePaginationLoading,searchOption:e=>e.stateSearchOptions,typeTaskOptions:e=>e.stateTypeTaskOptions,formDataAdditional:e=>e.stateFormAdditionalTask,conditionOptions:e=>e.stateConditionOptions,loadingConditionOptions:e=>e.stateLoadingConditionOptions,uomOptions:e=>e.stateUomOptions},actions:{getImageProperty(e){var a,n;return(a=e==null?void 0:e.adjustment)!=null&&a.images?(n=e==null?void 0:e.adjustment)==null?void 0:n.images:e},setComponentFromEquipment(e){this.stateComponentFromEquipment=e},async getComponentList(e=!1){const a={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateRerenderComponentList=!1,this.stateComponentListLoading=!0;const n=await X.get(oa,"",new URLSearchParams(a).toString());if(this.stateComponentList=n.data.result.content,this.stateComponentFromEquipment&&e){const s=n.data.result.content.filter(l=>l.componentDescription==this.stateComponentFromEquipment);this.updateComponentAffected(s)}}catch(n){n.response.data.statusCode==401&&ce().setLoggedIn(!1),ne("IRONS",n),console.log(n)}finally{this.stateComponentListLoading=!1,this.stateRerenderComponentList=!0}},setReRenderComponentList(e){this.stateRerenderComponentList=e},setReRenderSelection(e){this.stateReRenderSelection=e},async getInterventionCheckList(){var n;const e=fe(),a={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateReRenderSelection=!1,this.stateLoading=!0;const s=await X.get(aa,"",new URLSearchParams(a).toString());((n=s.data.result.content)==null?void 0:n.length)>0&&(this.stateInterventionCheckList=[...s.data.result.content],e.isCannotReviseOrSubmit&&(this.stateInterventionCheckList=this.stateInterventionCheckList.filter(l=>l.isMandatory||l.isMandatory==null)))}catch(s){s.response.data.statusCode==401&&ce().setLoggedIn(!1),ne("IRONS",s),console.log(s)}finally{this.stateReRenderSelection=!0,this.stateLoading=!1}},getInterventionChecksImage(){Promise.all(this.stateInterventionCheckList.map(async(e,a)=>{const n=await ha.getDefectImages(e.interventionIdCosmos,e.taskKey,"images");return{...e,images:this.getImageProperty(n)??[]}})).then(e=>{console.log("VALUES",e),this.stateReRenderSelection=!1,this.stateInterventionCheckList=[...e],this.stateReRenderSelection=!0}).catch(e=>{console.log(e)})},async getAdditionalTaskList(){var a;const e={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateLoading=!0;const n=Fe(),s=await X.get(sa,"",new URLSearchParams(e).toString());this.stateAdditionalTaskList=s.data.result.content,((a=this.stateAdditionalTaskList)==null?void 0:a.length)>0&&(this.stateAdditionalTaskList=await Promise.all(this.stateAdditionalTaskList.map(async(l,c)=>{const o=await n.getDefectImages(l.interventionIdCosmos,l.taskKey,"images");return{...l,images:this.getImageProperty(o)??[]}})))}catch(n){n.response.data.statusCode==401&&ce().setLoggedIn(!1),ne("IRONS",n),console.log(n)}finally{this.stateLoading=!1}},setAdditionalForm(e){this.stateFormAdditionalTask=e},addAdditionalForm(){this.stateFormAdditionalTask.sequence=this.stateAdditionalTaskList.length+1},insertAdditionalTask(e){this.stateAdditionalTaskList.push({additionalTaskId:0,sequence:this.stateAdditionalTaskList.length+1,recAction:e.recAction,executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",taskKey:"",isActive:!0,isDeleted:!1,psType:"",interventionIdCosmos:"",images:[],typeTaskId:e.typeTaskId,uom:e.typeTaskId==3||e.typeTaskId==10?e.uom:"",typeTask:"",componentId:"",listComponent:[...e.listComponent]})},updateAdditionalTask(e,a){const n=this.stateAdditionalTaskList.findIndex(s=>s.sequence==e.sequence);a.recAction=a.recAction.trim(),a.uom=a.typeTaskId==3||a.typeTaskId==10?a.uom:"",this.stateAdditionalTaskList[n]={...a}},deleteAdditionalTask(e){const a=this.stateAdditionalTaskList.findIndex(n=>n.sequence==e.sequence);e.additionalTaskId!==0&&(this.stateAdditionalTaskList[a].isDeleted=!0,this.stateDeletedAdditionalTaskList.push(this.stateAdditionalTaskList[a])),this.stateAdditionalTaskList.splice(a,1),this.stateAdditionalTaskList.forEach((n,s)=>{n.sequence=s+1})},checkIsAdditionalTaskDuplicate(e){return this.stateAdditionalTaskList.filter(n=>{if(e.uom){if(n.recAction.trim().toLowerCase()===e.recAction.trim().toLowerCase()&&n.typeTaskId===e.typeTaskId&&n.uom===e.uom)return n}else if(n.recAction.trim().toLowerCase()===e.recAction.trim().toLowerCase()&&n.typeTaskId===e.typeTaskId)return n}).length>=2},checkAnyEmptyAdditionalTask(){return this.stateAdditionalTaskList.find(e=>{if(!e.recAction||e.recAction=="")return e})},setFilter(e){this.stateFilter.keyPbi=e.keyPbi||""},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},resetFormAdditionalTask(){this.stateFormAdditionalTask={..._t}},resetFewList(){this.stateInterventionCheckList=[],this.stateAdditionalTaskList=[],this.stateDeletedAdditionalTaskList=[],this.stateComponentList=[]},resetAllList(){this.stateInterventionCheckList=[],this.stateAdditionalTaskList=[],this.stateDeletedAdditionalTaskList=[],this.stateComponentList=[],this.stateComponentFromEquipment="",this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateFormAdditionalTask={..._t},this.stateSelectedHeaderItem={...Kt},this.stateIsSelectedItem=!1},async updateInterventionCheckListMandatory(e){this.stateInterventionCheckList.forEach(a=>{e.findIndex(s=>s.recAction==a.recAction)!=-1?a.isMandatory=!0:a.isMandatory=!1})},async updateComponentAffected(e){const a=fe();let n=[];const s=[];if(this.stateComponentList.forEach(l=>{e.find(o=>o.componentId==l.componentId)?(l.isCheck=!0,l.interventionReason.forEach(o=>{n.push(o)}),l.interventionChecks.forEach(o=>{o.interventionDetailId&&!s.includes(o.interventionDetailId)?s.push(o.interventionDetailId):o.interventionDetailSourceId&&!s.includes(o.interventionDetailSourceId)&&s.push(o.interventionDetailSourceId)})):(l.isCheck=!1,l.interventionReason.forEach(o=>{n=n.filter(h=>o!=h)}))}),n=n.sort((l,c)=>{const o=l.includes("CRITICAL")||l.includes("CAUTION"),h=c.includes("CRITICAL")||c.includes("CAUTION"),v=!l.includes("CRITICAL")&&!l.includes("CAUTION"),x=!c.includes("CRITICAL")&&!c.includes("CAUTION");return o&&h?l.includes("CRITICAL")&&c.includes("CRITICAL")||l.includes("CAUTION")&&c.includes("CAUTION")?0:l.includes("CRITICAL")&&c.includes("CAUTION")?-1:1:v&&h?1:o&&x?-1:0}),a.updateInterventionReason(n.join("<br> ")),s.length==0){this.stateInterventionCheckList.forEach(l=>{l.isActive=!1});return}this.stateInterventionCheckList.forEach(l=>{s.findIndex(o=>l.interventionDetailId?o==l.interventionDetailId:l.interventionDetailSourceId?o==l.interventionDetailSourceId:!1)>-1?(l.isActive=!0,l.isMandatory=!0):l.isActive=!1})},setTotalPage(e){this.pagination.totalPage=e,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(e){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(e),this.stateSelectedHeader==="Declined"?await this.setHeaderDeclined(this.stateSelectedHeader,e):await this.setHeaderChange(this.stateSelectedHeader,e),setTimeout(()=>{this.statePaginationLoading=!1},20)},async setHeaderChange(e,a=1){const n=ce();await this.getTotalHeader(),this.stateSelectedHeader=e;const s={site:n.user.SiteId,status:e,ver:"v1",page:a.toString(),pageSize:"3"};try{this.stateLoadingHeader=!0;const l=await X.get(Gt,"",new URLSearchParams(s).toString());this.stateHeaderListItems=l.data.result.content,this.setTotalPage(l.data.result.total)}catch(l){l.response.data.statusCode==401&&n.setLoggedIn(!1),ne("IRONS",l),console.log(l)}finally{this.stateLoadingHeader=!1}},async searchItems(e){const a=ce(),n={site:a.user.SiteId,status:this.stateSelectedHeader,parameter:e,ver:"v1"};try{const s=this.stateSelectedHeader==="Declined"?Yt:Gt,l=await X.get(s,"",new URLSearchParams(n).toString());this.stateSearchOptions=l.data.result.content}catch(s){s.response.data.statusCode==401&&a.setLoggedIn(!1),ne("IRONS",s),console.log(s)}},async getTotalHeader(){const e=ce(),a={site:e.user.SiteId,ver:"v1"};try{const n=await X.get(ra,"",new URLSearchParams(a).toString());this.stateHeader[0].total=n.data.result.content.totalPendingEvaluation,this.stateHeader[1].total=n.data.result.content.totalSubmitted,this.stateHeader[2].total=n.data.result.content.totalYetToStart,this.stateHeader[3].total=n.data.result.content.totalInProgress,this.stateHeader[4].total=n.data.result.content.totalUnderReview,this.stateHeader[5].total=n.data.result.content.totalFinalReview,this.stateHeader[6].total=n.data.result.content.totalClosed}catch(n){ne("IRONS",n),console.log(n),n.response.data.statusCode==401&&e.setLoggedIn(!1)}},async setSelectedHeader(e){this.stateSelectedHeader=e},async setSelectedHeaderItem(e){this.stateSelectedHeaderItem=e},setIsSelectedItem(e){this.stateIsSelectedItem=e},async getLookupTypeTask(){const e={ver:"v1"};try{const a=await X.get(da,"",new URLSearchParams(e).toString());this.stateTypeTaskOptions=bt(a.data.result.content,"typeTaskId","typeTask",!1)}catch(a){ne("IRONS",a),a.response.data.statusCode==401&&ce().setLoggedIn(!1),console.log(a)}},async getLookupConditionOption(e){const a={typeTaskId:e,ver:"v1"};try{this.stateLoadingConditionOptions=!0;const n=await X.get(ca,"",new URLSearchParams(a).toString());this.stateConditionOptions=bt(n.data.result.content,"typeCondition","typeCondition",!1)}catch(n){ne("IRONS",n),n.response.data.statusCode==401&&ce().setLoggedIn(!1),console.log(n)}finally{this.stateLoadingConditionOptions=!1}},async getLookupUom(){const e={ver:"v1"};try{const a=await X.get(ua,"",new URLSearchParams(e).toString());this.stateUomOptions=Ye(a.data.result.content.uom)}catch(a){a.response.data.statusCode==401&&ce().setLoggedIn(!1),ne("IRONS",a),console.log(a)}},async setHeaderDeclined(e="Declined",a=1,n=!1){const s=ce();await this.getTotalHeader();const l={site:s.user.SiteId,status:e,ver:"v1",page:a.toString(),pageSize:"3"};try{this.stateLoadingHeader=!0;const c=await X.get(Yt,"",new URLSearchParams(l).toString());n||(this.stateHeaderListItems=c.data.result.content,this.setTotalPage(c.data.result.total)),this.stateHeader[7].total=c.data.result.total}catch(c){c.response.data.statusCode==401&&s.setLoggedIn(!1),ne("IRONS",c),console.log(c)}finally{this.stateLoadingHeader=!1}},mapHeaderFromExecutionIdAndDefectId(e,a){let n="Pending Evaluation";const s=l=>{switch(l){case 1:n="Final Review";break;default:n="Closed";break}};switch(e){case 2:n="Submitted";break;case 3:n="Submitted";break;case 4:n="Yet to Start";break;case 5:n="In Progress";break;case 6:n="Under Review";break;case 7:n="Approved";break;case 8:n="Final Review";break;case 9:s(a);break;default:n="Pending Evaluation";break}return n}}}),ga={keyPbi:""},Jt={interventionHeaderId:0,interventionHeaderSourceId:0,site:"",equipmentModel:"",equipmentNumberId:0,equipmentNumber:"",componentDescription:"",componentHours:"",interventionReason:"",conditionRatingSmu:"",conditionRatingDate:"",interventionCodeId:"",interventionStatus:"",interventionDiagnostic:"",followUp:"",uomId:"",followUpPriority:"",estimationCompletionDate:"",workOrder:"",additionalInformation:"",interventionExecutionId:0,userRevise:!0,componentId:0,interventionCosmosId:"",component:"",keyPbi:"",declineReason:"",frameHours:"",hmOffset:"",genericDefect:!1,canEditComponent:!1,showConditionRatingDate:"",isParameterUpdate:!1,defectStatusId:null,interventionExecutionBy:null,executionDateTime:null,approveReason:"",smuSap:0,statusIP:{name:"",date:"",status:""},statusIF:{name:"",date:"",status:""},approvedBy:"",approveDate:"",declinedBy:"",declinedDate:"",reviseReason:"",acceptedby:"",accepteddate:"",declinedPortalBy:"",declinedPortalDate:""},_a={site:!1,equipmentModel:!1,equipmentNumber:!1,componentDescription:!1,conditionRatingDate:!1,interventionStatus:!1,followUpPriority:!1,estimationCompletionDate:!1},fe=rt({id:"formIntervention",state:()=>({stateIsFromEquipment:!1,stateIsFromIntervention:!1,stateFormFilter:ga,stateFormIntervention:{...Jt},stateFormLoading:{..._a},stateListAdditionalSensorData:[],stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateEquipmentNumberOption:[],stateComponentOption:[],stateConditionRatingDateOption:[],stateInterventionStatusOption:[],stateFollowUpPriorityOption:[],stateHeaderCbm:"",stateFormCbmHeaderVisibility:!1,statePsTypeCbm:"",stateGenericDefectLoading:!1,stateIsAdditionalSensorExist:!1}),getters:{listAdditionalSensorData:e=>e.stateListAdditionalSensorData,isAdditionalSensorExist:e=>e.stateIsAdditionalSensorExist,isFromEquipment:e=>e.stateIsFromEquipment,isFromIntervention:e=>e.stateIsFromIntervention,formIntervention:e=>e.stateFormIntervention,formFilter:e=>e.stateFormFilter,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,siteOption:e=>e.stateSiteOption,equipmentModelOption:e=>e.stateEquipmentModelOption,equipmentNumberOption:e=>e.stateEquipmentNumberOption,componentOption:e=>e.stateComponentOption,conditionRatingDateOption:e=>e.stateConditionRatingDateOption,interventionStatusOption:e=>e.stateInterventionStatusOption,followUpPriorityOption:e=>e.stateFollowUpPriorityOption,formLoading:e=>e.stateFormLoading,genericLoading:e=>e.stateGenericDefectLoading,headerCbm:e=>e.stateHeaderCbm,formCbmHeaderVisibility:e=>e.stateFormCbmHeaderVisibility,psTypeCbm:e=>e.statePsTypeCbm,isCannotReviseOrSubmit:e=>e.stateFormIntervention.interventionExecutionId<1||e.stateFormIntervention.interventionExecutionId>4||!e.stateFormIntervention.userRevise&&!(e.stateFormIntervention.interventionHeaderId==0||e.stateFormIntervention.interventionHeaderId==null)},actions:{async getSiteLookup(e=!1){this.stateFormLoading.site=!0;const a={ver:"v1",equipmentModel:this.formIntervention.equipmentModel||"",equipmentNumber:this.formIntervention.equipmentNumber||""};try{const n=await X.get(st,"",new URLSearchParams(a).toString());e&&(this.stateFormIntervention.site=n.data.result.content.site.siteDescription[0]||""),this.stateSiteOption=Ye(n.data.result.content.site.siteDescription)}catch(n){ne("IRONS",n),console.log(n)}finally{this.stateFormLoading.site=!1}},async getEquipmentModelLookup(e=!1){this.stateFormLoading.equipmentModel=!0;const a={site:this.formIntervention.site||"",equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const n=await X.get(st,"",new URLSearchParams(a).toString());e&&(this.stateFormIntervention.equipmentModel=n.data.result.content.equipmentModel[0]||""),this.stateEquipmentModelOption=Ye(n.data.result.content.equipmentModel)}catch(n){ne("IRONS",n),console.log(n)}finally{this.stateFormLoading.equipmentModel=!1}},async getEquipmentNumberLookup(){this.stateFormLoading.equipmentNumber=!0;const e={site:this.formIntervention.site||"",equipmentModel:this.formIntervention.equipmentModel||"",ver:"v1"};try{const a=await X.get(st,"",new URLSearchParams(e).toString());this.stateEquipmentNumberOption=Ye(a.data.result.content.equipmentNumber)}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.equipmentNumber=!1}},async getComponentLookup(){this.stateFormLoading.componentDescription=!0;const e={equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const a=await X.get(st,"",new URLSearchParams(e).toString());this.stateComponentOption=Ye(a.data.result.content.component)}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.componentDescription=!1}},async getConditionRatingDateLookup(){this.stateFormLoading.conditionRatingDate=!0;const e={equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const a=await X.get(ta,"",new URLSearchParams(e).toString());this.stateConditionRatingDateOption=a.data.result.content.conditionRatingDate.map((n,s)=>({label:`${ht(n)} | ${a.data.result.content.interventionCodeId[s]}`,value:`${s}`,conditionRatingDate:ht(n),componentHours:a.data.result.content.componentHours[s],interventionReason:a.data.result.content.interventionReason[s],conditionRatingSmu:a.data.result.content.conditionRatingSmu[s],interventionCodeId:a.data.result.content.interventionCodeId[s],keyPbi:a.data.result.content.keyPbi[s]}))}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.conditionRatingDate=!1}},async getInterventionStatusLookup(){this.stateFormLoading.interventionStatus=!0;const e={ver:"v1"};try{const a=await X.get(Ut,"",new URLSearchParams(e).toString());this.stateInterventionStatusOption=bt(a.data.result.content,"interventionStatus","interventionStatusDesc")}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.interventionStatus=!1}},async getFollowUpPriorityLookup(){this.stateFormLoading.followUpPriority=!0;const e={interventionStatus:"Accepted",ver:"v1"};try{const a=await X.get(Ut,"",new URLSearchParams(e).toString());this.stateFollowUpPriorityOption=Hn({followUpPriority:a.data.result.content.followUpPriority,followUpPriorityUom:a.data.result.content.followUpPriorityUom}," "),this.stateFollowUpPriorityOption.sort((n,s)=>{const l=parseInt(n.value.replace(" hrs","")),c=parseInt(s.value.replace(" hrs",""));return l<c?-1:l>c?1:0})}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.followUpPriority=!1}},async getFormIntervention(){const e=Fe(),n={employeeId:ce().user.EmployeeId||"",keyPbi:this.stateFormFilter.keyPbi||"",ver:"v1"};try{this.stateLoading=!0;const s=await X.get(na,"",new URLSearchParams(n).toString());if(console.log("Form Intervention",s.data.result.content),s.data.result.content[0]){let l=s.data.result.content[0].interventionReason==""||s.data.result.content[0].interventionReason==null?[]:s.data.result.content[0].interventionReason.split("<br> ");l=l.sort((c,o)=>c.includes("CRITICAL")&&o.includes("CAUTION")?-1:1),this.stateFormIntervention.interventionHeaderId=s.data.result.content[0].interventionHeaderId,this.stateFormIntervention.interventionHeaderSourceId=s.data.result.content[0].interventionHeaderSourceId,this.stateFormIntervention.componentHours=s.data.result.content[0].componentHours,this.stateFormIntervention.conditionRatingSmu=s.data.result.content[0].conditionRatingSmu,this.stateFormIntervention.interventionStatus=s.data.result.content[0].interventionStatus||"",this.stateFormIntervention.interventionDiagnostic=s.data.result.content[0].interventionDiagnostic||"",this.stateFormIntervention.followUpPriority=s.data.result.content[0].followUpPriority||"",this.stateFormIntervention.estimationCompletionDate=s.data.result.content[0].estimationCompletionDate||"",this.stateFormIntervention.workOrder=s.data.result.content[0].workOrder||"",this.stateFormIntervention.additionalInformation=s.data.result.content[0].additionalInformation,this.stateFormIntervention.interventionExecutionId=s.data.result.content[0].interventionExecutionId,this.stateFormIntervention.userRevise=s.data.result.content[0].userRevise,this.stateFormIntervention.keyPbi=s.data.result.content[0].keyPbi,this.stateFormIntervention.declineReason=s.data.result.content[0].declineReason,this.stateFormIntervention.interventionCosmosId=s.data.result.content[0].interventionCosmosId,this.stateFormIntervention.genericDefect=s.data.result.content[0].genericDefect,this.stateFormIntervention.site=s.data.result.content[0].site,this.stateFormIntervention.equipmentModel=s.data.result.content[0].equipmentModel,this.stateFormIntervention.equipmentNumber=s.data.result.content[0].equipmentNumber,this.stateFormIntervention.conditionRatingDate=ht(s.data.result.content[0].conditionRatingDate)||"",this.stateFormIntervention.interventionReason=l.join("<br> "),this.stateFormIntervention.frameHours=s.data.result.content[0].frameHours||"0",this.stateFormIntervention.showConditionRatingDate=s.data.result.content[0].showConditionRatingDate||"",this.stateFormIntervention.isParameterUpdate=s.data.result.content[0].isParameterUpdate||!1,this.stateFormIntervention.defectStatusId=s.data.result.content[0].defectStatusId||null,this.stateFormIntervention.interventionExecutionBy=s.data.result.content[0].interventionExecutionBy||null,this.stateFormIntervention.executionDateTime=s.data.result.content[0].executionDateTime||null,this.stateFormIntervention.approveReason=s.data.result.content[0].approveReason,this.stateFormIntervention.smuSap=s.data.result.content[0].smuSap,this.stateFormIntervention.statusIP={name:s.data.result.content[0].statusIP.name,date:s.data.result.content[0].statusIP.date,status:s.data.result.content[0].statusIP.status},this.stateFormIntervention.statusIF={name:s.data.result.content[0].statusIF.name,date:s.data.result.content[0].statusIF.date,status:s.data.result.content[0].statusIF.status},this.stateFormIntervention.approvedBy=s.data.result.content[0].approvedBy,this.stateFormIntervention.approveDate=s.data.result.content[0].approveDate,this.stateFormIntervention.reviseReason=s.data.result.content[0].reviseReason,this.stateFormIntervention.declinedBy=s.data.result.content[0].declinedBy,this.stateFormIntervention.declinedDate=s.data.result.content[0].declinedDate,this.stateFormIntervention.acceptedby=s.data.result.content[0].acceptedby,this.stateFormIntervention.accepteddate=s.data.result.content[0].accepteddate,this.stateFormIntervention.declinedPortalBy=s.data.result.content[0].declinedPortalBy,this.stateFormIntervention.declinedPortalDate=s.data.result.content[0].declinedPortalDate,this.stateGenericDefectLoading=!0,await e.getDefectsDataAll(this.stateFormIntervention.interventionCosmosId),this.stateGenericDefectLoading=!1,this.stateFormIntervention.isParameterUpdate&&(this.setIsAdditionalSensorExist(!0),await this.getAdditionalSensorData())}}catch(s){ne("IRONS",s),console.log(s),s.response.data.statusCode==401&&(this.stateLoading=!1,ce().setLoggedIn(!1)),console.log(s)}finally{this.stateLoading=!1}},async getAdditionalSensorData(){const e={keyPbi:this.stateFormIntervention.keyPbi,ver:"v1"};try{this.stateLoading=!0;const a=await X.get(ma,"",new URLSearchParams(e).toString());this.stateListAdditionalSensorData=[],a.data.result.content.sensors.forEach(n=>{this.stateListAdditionalSensorData.push({id:n.id,interventionReason:n.interventionReason,isCheck:!0})})}catch(a){ne("IRONS",a),console.log(a)}finally{this.stateLoading=!1}},async postAdditionalSensorData(e){const a=ce(),n={userAccount:a.user.Name,ver:"v1"},s={keyPbi:this.stateFormIntervention.keyPbi,isRevise:e,employeeId:a.user.EmployeeId,employeeName:a.user.Name,sensors:[]};return this.stateListAdditionalSensorData.forEach(l=>{s.sensors.push({id:l.id,isCheck:l.isCheck})}),new Promise((l,c)=>{this.stateLoading=!0,X.post(`${pa}?${new URLSearchParams(n).toString()}`,s).then(o=>{l(o.data.result)}).catch(o=>{ne("IRONS",o),console.log(o.response),l(o.response.data.result)}).finally(()=>{this.stateLoading=!1})})},resetInterventionWhenStatusIsDeclined(){this.stateFormIntervention.interventionDiagnostic="",this.stateFormIntervention.followUpPriority="",this.stateFormIntervention.estimationCompletionDate="",this.stateFormIntervention.workOrder=""},resetFollowUpPriorityOption(){this.stateFollowUpPriorityOption=[]},async getEstimationCompletionDate(){this.stateFormLoading.estimationCompletionDate=!0;const e={equipmentModel:this.stateFormIntervention.equipmentModel,site:this.stateFormIntervention.site,followUpPriority:this.stateFormIntervention.followUpPriority,sampleDate:this.stateFormIntervention.conditionRatingDate?ft(gt(qt(this.stateFormIntervention.conditionRatingDate))):"",ver:"v1"};try{const a=await X.get(la,"",new URLSearchParams(e).toString());this.stateFormIntervention.estimationCompletionDate=a.data.result.content.estimationCompletionDate}catch(a){a.response.data.statusCode==401&&ce().setLoggedIn(!1),ne("IRONS",a),console.log(a)}finally{this.stateFormLoading.estimationCompletionDate=!1}},async updateData(e,a){const n=ye();try{this.stateLoading=!0;const s={userAccount:e,ver:"v1"},l={employeeName:e,employeeId:a,interventionHeaderId:this.stateFormIntervention.interventionHeaderId,interventionHeaderSourceId:this.stateFormIntervention.interventionHeaderSourceId,site:this.stateFormIntervention.site,equipmentModel:this.stateFormIntervention.equipmentModel,equipmentNumber:this.stateFormIntervention.equipmentNumber,interventionReason:this.stateFormIntervention.interventionReason,conditionRatingSmu:Number(this.stateFormIntervention.conditionRatingSmu),conditionRatingDate:ft(gt(qt(this.stateFormIntervention.conditionRatingDate))),interventionCodeId:this.stateFormIntervention.interventionCodeId,interventionStatus:this.stateFormIntervention.interventionStatus,interventionDiagnostic:this.stateFormIntervention.interventionDiagnostic,followUpPriority:this.stateFormIntervention.followUpPriority,estimationCompletionDate:this.stateFormIntervention.estimationCompletionDate?ft(gt(new Date(this.stateFormIntervention.estimationCompletionDate))):null,workOrder:this.stateFormIntervention.workOrder,isRevise:!!this.stateFormIntervention.interventionHeaderId,additionalTask:[...n.additionalTaskList,...n.deletedAdditionalTaskList],keyPbi:this.stateFormIntervention.keyPbi,interventionChecks:this.getInterventionChecksForRequest(),componentAffected:[...n.componentList],declineReason:this.stateFormIntervention.interventionStatus=="Declined"?this.stateFormIntervention.declineReason:"",reviseReason:this.stateFormIntervention.interventionStatus=="Accepted"?this.stateFormIntervention.reviseReason:"",isDma:!1};console.log(l);const c=await X.post(`${ia}?${new URLSearchParams(s).toString()}`,l);c.data.title==="Error"?(this.stateErrors.push(c.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&ce().setLoggedIn(!1),this.stateError=s,ne("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setIsError(e){this.stateIsError=e},setFormFilter(e){this.stateFormFilter.keyPbi=e.keyPbi||""},setIsFromEquipment(e){this.stateIsFromEquipment=e},setIsFromIntervention(e){this.stateIsFromIntervention=e},updateInterventionReason(e){this.stateFormIntervention.interventionReason=e},setIsAdditionalSensorExist(e){this.stateIsAdditionalSensorExist=e},resetFormIntervention(){this.stateFormIntervention.interventionHeaderId=0,this.stateFormIntervention.interventionHeaderSourceId=0,this.stateFormIntervention.conditionRatingDate="",this.stateFormIntervention.componentHours="",this.stateFormIntervention.conditionRatingSmu="",this.stateFormIntervention.interventionReason="",this.stateFormIntervention.interventionCodeId="",this.stateFormIntervention.interventionStatus="",this.stateFormIntervention.interventionDiagnostic="",this.stateFormIntervention.followUpPriority="",this.stateFormIntervention.estimationCompletionDate="",this.stateFormIntervention.workOrder="",this.stateFormIntervention.additionalInformation="",this.stateFormIntervention.interventionExecutionId=0,this.stateFormIntervention.keyPbi="",this.stateFormIntervention.declineReason="",this.stateFormIntervention.frameHours="",this.stateFormIntervention.canEditComponent=!1,this.stateFormIntervention.showConditionRatingDate="",this.stateFormIntervention.interventionExecutionBy=null,this.stateFormIntervention.executionDateTime=null,this.stateFormIntervention.approveReason="",this.stateFormIntervention.smuSap=0,this.stateFormIntervention.statusIP={name:"",date:"",status:""},this.stateFormIntervention.statusIF={name:"",date:"",status:""},this.stateFormIntervention.approvedBy="",this.stateFormIntervention.approveDate="",this.stateFormIntervention.reviseReason="",this.stateFormIntervention.declinedBy="",this.stateFormIntervention.declinedDate="",this.stateFormIntervention.acceptedby="",this.stateFormIntervention.accepteddate="",this.stateFormIntervention.declinedPortalBy="",this.stateFormIntervention.declinedPortalDate="",this.stateIsFromEquipment=!1,this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateFormFilter.keyPbi=""},resetFormInterventionAndFilter(){this.stateFormIntervention={...Jt}},setHeaderCbm(e){this.stateHeaderCbm=e},setFormCbmHeaderVisibility(e){this.stateFormCbmHeaderVisibility=e},setPsTypeCbm(e){this.statePsTypeCbm=e},getInterventionChecksForRequest(){return ye().interventionCheckList.map(a=>({interventionDetailId:a.interventionDetailId,interventionDetailSourceId:a.interventionDetailSourceId,sequence:a.isMandatory?a.sequence:null,isMandatory:a.isMandatory,keyPbi:a.keyPbi,isActive:a.isActive}))},resetGeneric(e=!1){if(e){Fe().reset();return}this.stateGenericDefectLoading=!1},async getDataFromKeyPbi(e){const a=ye();this.stateFormFilter.keyPbi=e,a.setFilter({keyPbi:e}),this.getFollowUpPriorityLookup(),this.getInterventionStatusLookup();try{await this.getFormIntervention();const n=a.mapHeaderFromExecutionIdAndDefectId(this.stateFormIntervention.interventionExecutionId,this.stateFormIntervention.defectStatusId);this.stateIsFromEquipment&&n=="Pending Evaluation"?(await Promise.all([a.getInterventionCheckList(),a.getAdditionalTaskList()]),await a.getComponentList(!0)):(a.resetFewList(),await Promise.all([a.getComponentList(),a.getAdditionalTaskList()]),await a.getInterventionCheckList()),a.getInterventionChecksImage(),this.getSiteLookup(),this.getEquipmentModelLookup(),this.getEquipmentNumberLookup(),this.getComponentLookup(),this.getConditionRatingDateLookup()}catch(n){console.error(n)}}}}),ba=e=>(Ie("data-v-83928213"),e=e(),we(),e),ya={class:"fv-row custom-text-input"},Ia=ba(()=>t("label",{class:ue("form-label fs-6 fw-bolder text-white")},"Intervention Reason",-1)),wa=["innerHTML"],ka=oe({__name:"InterventionReason",props:{paragraph:{required:!0,default:""}},setup(e){const n=he(e,"paragraph"),s=D(null),l=P(()=>n.value.replace(/CRITICAL/gi,'<span class="text-critical">CRITICAL</span>').replace(/CAUTION/gi,'<span class="text-caution">CAUTION</span>').replace(/NORMAL/gi,'<span class="text-normal-inv">NORMAL</span>')),c=D(!0);return wt(()=>{s.value&&(c.value=s.value.scrollHeight>s.value.clientHeight)}),(o,h)=>(r(),m("div",ya,[Ia,t("p",{ref_key:"paragraphRef",ref:s,class:"disabled-textarea",innerHTML:l.value,style:{overflow:"auto"}},null,8,wa)]))}}),Sa=ge(ka,[["__scopeId","data-v-83928213"]]),Da=oe({__name:"ComponentGrid",props:{listData:{required:!0,type:Array},reRender:{required:!0,type:Boolean},isLoading:{type:Boolean,default:!1},isCannotEdit:{type:Boolean,default:!1},height:{type:String,default:"200"}},setup(e){const a=ye(),n=e,s=D();Ee(()=>n.reRender===!0,async()=>{c()});const l=async o=>{a.updateComponentAffected(o)},c=async()=>{a.componentList.length>0?a.componentList.filter(h=>h.isCheck==!0).forEach(h=>{s.value.toggleRowSelection(h,void 0)}):s.value.clearSelection()};return(o,h)=>{const v=O("el-table-column"),x=O("el-table"),b=ve("loading");return te((r(),G(x,{ref_key:"tableComponentListRef",ref:s,data:n.listData,height:n.height,style:{width:"100%"},"element-loading-background":"#2d2b39b3","empty-text":"No Data",class:"intervention-component_table table-grey","header-row-class-name":"bg-grey-header","header-cell-class-name":"bg-grey-header","row-class-name":"table-row-grey no-uppercase","cell-class-name":"text-black small-padding",onSelectionChange:l,"row-key":"componentId","select-on-indeterminate":""},{default:p(()=>[i(v,{prop:"componentDescription",label:"Component",width:"180",class:"text-black"}),i(v,{prop:"componentHm",label:"Component Life (hours)",align:"center","label-class-name":"no-uppercase",class:"text-black"}),i(v,{prop:"oemInterval",label:"BUMA AU Target (hours)","label-class-name":"no-uppercase",align:"center",class:"text-black"}),i(v,{prop:"percentage",label:"Component Life (percentage)","label-class-name":"no-uppercase",align:"center",class:"text-black"},{default:p(f=>[le(S(f.row.percentage)+" % ",1)]),_:1}),i(v,{type:"selection","reserve-selection":"",selectable:()=>!n.isCannotEdit,width:52,align:"center",class:"table-selection","class-name":"table-selection"},null,8,["selectable"])]),_:1},8,["data","height"])),[[b,n.isLoading]])}}}),ut=rt({id:"ComponentInterventionDefectsForm",state:()=>({stateIsYes:void 0,stateLoading:!1,stateCancelled:!1,stateDefectYesVisible:!1,stateDefectNoVisible:!1,stateViewYesVisible:!1,stateViewtNoVisible:!1,stateIsValid:!0,stateItemKey:"",stateTask:{},stateDefectInfo:{},stateDeclineReason:"",stateDeclineBy:{},stateDeclineDate:"",statePayload:{updateParams:[]},stateItem:{}}),getters:{Loading:e=>e.stateLoading,Cancelled:e=>e.stateCancelled,DefectYesVisible:e=>e.stateDefectYesVisible,DefectNoVisible:e=>e.stateDefectNoVisible,ViewYesVisible:e=>e.stateViewYesVisible,ViewNoVisible:e=>e.stateViewtNoVisible,ItemKey:e=>e.stateItemKey,isValid:e=>e.stateIsValid,isYes:e=>e.stateIsYes,defectInfo:e=>e.stateDefectInfo,selectedGroup:()=>Se().selectedGroup,selectedFitter:()=>Se().employee,supervisor:()=>{const e=ce();return{id:e.user.EmployeeId,name:e.user.Name}},images:()=>zt().ImageObjects.find(a=>a.Id==="defect"),globalConnectionStore:()=>yt(),declineReason:e=>e.stateDeclineReason,declineBy:e=>e.stateDeclineBy,declineDate:e=>e.stateDeclineDate},actions:{setItem(e){this.stateItem=e},setItemKey(e){this.stateItemKey=e},setCancelledState(e){this.stateCancelled=e},cretateInstance(e=!0){this.stateDefectInfo=e?new Bt:new Mt,this.stateIsYes=e},setTask(e){this.stateTask=e},toggleYesVisible(e){this.stateDefectYesVisible=e,this.stateDefectNoVisible=!1,this.stateCancelled=!1},toggleNoVisible(e){this.stateDefectNoVisible=e,this.stateDefectYesVisible=!1,this.stateCancelled=!1},toggleViewNoVisible(e){this.stateViewtNoVisible=e,this.stateViewYesVisible=!1},toggleViewYesVisible(e){this.stateViewYesVisible=e,this.stateViewtNoVisible=!1},createYesPayload(e){var c;const a=Se(),n=this.stateDefectInfo,s=((c=this.images)==null?void 0:c.ImageInfos)??[],l=n.Resources.filter(o=>o.value!=="");this.statePayload.defectDetail={type:"YES",title:e,assetNumber:n.AssetNumber,description:n.Description.value,raisedBy:this.selectedFitter.name,date:"<<ServerDateTime>>",plannedDuration:n.PlannedDuration.value,instruction:n.Instruction.value,priority:n.Priority,parts:JSON.stringify(n.Parts),labours:JSON.stringify(n.Labours),resources:JSON.stringify(l.map(o=>o.value)),symptoms:JSON.stringify(n.Symptoms.map(o=>o.value)),causes:JSON.stringify(n.Causes.map(o=>o.value)),images:JSON.stringify(s),interventionId:a.generalForm.id}},createNoPayload(e){var l;const a=Se(),n=this.stateDefectInfo,s=((l=this.images)==null?void 0:l.ImageInfos)??[];this.statePayload.defectDetail={type:"NO",title:e,assetNumber:n.AssetNumber,description:n.Description.value,raisedBy:this.selectedFitter.name,date:"<<ServerDateTime>>",actions:JSON.stringify(n.Actions.map(c=>c.value)),images:JSON.stringify(s),interventionId:a.generalForm.id}},createPayload(){const e=Se();this.statePayload.id=e.generalForm.id,this.statePayload.headerId=e.generalForm.id,this.statePayload.workorder=e.generalForm.sapWorkOrder,this.statePayload.updateParams=[],this.statePayload.updateParams.push({keyValue:this.stateTask.key,propertyParams:[{propertyName:"taskValue",propertyValue:"3"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.selectedFitter)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.statePayload.employee=this.selectedFitter,this.statePayload.defectHeader={workorder:e.generalForm.sapWorkOrder,form:e.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:e.generalForm.id,category:this.stateTask.category,taskId:this.stateTask.key,interventionHeaderId:e.generalForm.trInterventionHeaderId,taskNo:this.stateTask.description!=""?this.stateTask.description.split("")[0]:this.stateTask.items[0].value,taskDesc:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,defectWorkorder:"",formDefect:"BA-PL-F55",defectType:this.stateIsYes?"YES":"NO",cbmMeasurement:"",cbmUom:"",cbmImageKey:"",cbmImageProp:"",isCbmAdjusment:"",taskValue:"3",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.supervisor,status:"Submited",defectStatus:"Submited"};const a=Mn(this.stateTask);this.stateIsYes?this.createYesPayload(a):this.createNoPayload(a)},async createDefect(){this.stateLoading=!0;const e={ver:"v1"};try{this.createPayload();const a=await X.post(`${Xt}?${new URLSearchParams(e).toString()}`,this.statePayload);this.stateLoading=!1;const n=Se();return a.data.result.message==lt.TASK_UPDATED_BY_OTHER?(n.toggleTaskAlreadyUpdatedStatus(!0),!1):a.data.result.message==lt.SUBMITTED?(n.toggleFormAlreadySubmitted(!0),!1):(n.toggleFormUpdated(!0),!0)}catch(a){const n=this.globalConnectionStore.checkIsErrorNoNetwork(a);return this.globalConnectionStore.setSubmitConnectionError(n),it(a),console.log(a),this.stateLoading=!1,ne("IRONS",a),!1}},async getDefectDeclineReason(e){const s=Fe().ApprovalData.DefectHeaders.find(l=>l.taskId==e);s&&(this.stateDeclineReason=s.declineReason||"",this.stateDeclineDate=s.declineDate||"",this.stateDeclineBy=s.declineBy||{})},async getDefectDetail(e,a){this.stateLoading=!0;const n={ver:"v1"},s={interventionHeaderId:e,taskId:a,isActive:"true",isDeleted:"false"};try{const c=(await X.post(`${Qt}?${new URLSearchParams(n).toString()}`,s)).data.result.content.detail,o=zt(),h=qn();if(o.setCurrent("defect"),o.clearCurrent(),c.type==="YES"){this.stateIsYes=!0,this.stateDefectInfo=new Bt,this.stateDefectInfo.setAssetNumber(c.assetNumber),this.stateDefectInfo.setDescription(c.description),this.stateDefectInfo.setPriority(c.priority),this.stateDefectInfo.setRaisedBy(c.raisedBy),this.stateDefectInfo.setDate(c.date),this.stateDefectInfo.setPlannedDuration(c.plannedDuration),this.stateDefectInfo.setInstruction(c.instruction),this.stateDefectInfo.setTitle(c.title),this.stateDefectInfo.importParts(...JSON.parse(c.parts)),this.stateDefectInfo.importLabours(...JSON.parse(c.labours)),this.stateDefectInfo.importResources(...JSON.parse(c.resources)),this.stateDefectInfo.importSymptoms(...JSON.parse(c.symptoms)),this.stateDefectInfo.importCauses(...JSON.parse(c.causes)),this.images.ImageInfos.push(...JSON.parse(c.images));const v=[];this.images.ImageInfos.forEach(x=>{let b="";typeof x=="string"?b=x:b=x.filename,v.push(h.downloadAttachment(b))}),Promise.all(v).then(x=>{x.forEach(b=>{const f=new Blob([b],{type:"image/png"});this.images.ImageBlobs.push(f)}),this.toggleViewYesVisible(!0)})}else{this.stateIsYes=!1,this.stateDefectInfo=new Mt,this.stateDefectInfo.setAssetNumber(c.assetNumber),this.stateDefectInfo.setDescription(c.description),this.stateDefectInfo.setRaisedBy(c.raisedBy),this.stateDefectInfo.setDate(c.date),this.stateDefectInfo.setTitle(c.title),this.stateDefectInfo.importActions(...JSON.parse(c.actions)),this.images.ImageInfos.push(...JSON.parse(c.images));const v=[];this.images.ImageInfos.forEach(x=>{let b="";typeof x=="string"?b=x:b=x.filename,v.push(h.downloadAttachment(b))}),Promise.all(v).then(x=>{x.forEach(b=>{const f=new Blob([b],{type:"image/png"});this.images.ImageBlobs.push(f)}),this.toggleViewNoVisible(!0)})}this.stateLoading=!1}catch(l){it(l),console.log(l),ne("IRONS",l),this.stateLoading=!1}},resetInstance(){this.stateLoading=!1,this.stateIsYes=void 0,this.stateDefectYesVisible=!1,this.stateDefectNoVisible=!1,this.stateViewYesVisible=!1,this.stateViewtNoVisible=!1,this.stateIsValid=!0,this.stateItemKey="",this.stateTask={},this.stateDefectInfo={},this.statePayload={updateParams:[]}}}}),mt=rt({id:"ComponentInterventionNAForm",state:()=>({stateLoading:!1,stateCancelled:!1,stateVisible:!1,stateViewVisible:!1,stateIsValid:!0,stateItemKey:"",stateReason:"",stateTitle:"",stateTask:{},statePayload:{updateParams:[]},stateItem:{},stateSuccessUpdateItemKey:""}),getters:{Loading:e=>e.stateLoading,Cancelled:e=>e.stateCancelled,Reason:e=>e.stateReason,Visible:e=>e.stateVisible,ViewVisible:e=>e.stateViewVisible,ItemKey:e=>e.stateItemKey,isValid:e=>e.stateIsValid,selectedGroup:()=>Se().selectedGroup,selectedFitter:()=>Se().employee,supervisor:()=>{const e=ce();return{id:e.user.EmployeeId,name:e.user.Name}},globalConnectionStore:()=>yt()},actions:{setItem(e){this.stateItem=e},setReason(e){this.stateReason=e},setCancelledState(e){this.stateCancelled=e},setItemKey(e){this.stateItemKey=e,this.stateSuccessUpdateItemKey=""},setTask(e){this.stateTask=e},toggleIsVisible(e){this.stateVisible=e,this.stateCancelled=!1},toggleIsViewVisible(e){this.stateViewVisible=e},createPayload(){const e=Se();this.statePayload.id=e.generalForm.id,this.statePayload.workorder=e.generalForm.sapWorkOrder,this.statePayload.headerId=e.generalForm.id,this.statePayload.updateParams=[],this.statePayload.updateParams.push({keyValue:this.stateTask.key,propertyParams:[{propertyName:"taskValue",propertyValue:"4"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.selectedFitter)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.statePayload.employee=this.selectedFitter,this.statePayload.defectHeader={workorder:e.generalForm.sapWorkOrder,form:e.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:e.generalForm.id,interventionHeaderId:e.generalForm.trInterventionHeaderId,category:this.stateTask.category,taskId:this.stateTask.key,taskNo:this.stateTask.description!=""?this.stateTask.description.split("")[0]:this.stateTask.items[0].value,taskDesc:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,defectWorkorder:"",formDefect:"DM-PL-F55",defectType:"",cbmMeasurement:"",cbmUom:"",cbmImageKey:"",cbmImageProp:"",isCbmAdjusment:"",taskValue:"4",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.supervisor,status:"Submited",defectStatus:"Submited"},this.statePayload.defectDetail={type:"N/A",reason:this.Reason,title:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,interventionId:e.generalForm.id}},async createNA(){this.stateLoading=!0;const e={ver:"v1"};try{this.createPayload();const a=await X.post(`${Xt}?${new URLSearchParams(e).toString()}`,this.statePayload);this.stateLoading=!1;const n=Se();return a.data.result.message==lt.TASK_UPDATED_BY_OTHER?(n.toggleTaskAlreadyUpdatedStatus(!0),!1):a.data.result.message==lt.SUBMITTED?(n.toggleFormAlreadySubmitted(!0),!1):(n.toggleFormUpdated(!0),!0)}catch(a){const n=this.globalConnectionStore.checkIsErrorNoNetwork(a);this.globalConnectionStore.setSubmitConnectionError(n),it(a),ne("IRONS",a),console.log(a)}},async getNADetail(e,a){this.stateLoading=!0;const n={ver:"v1"},s={interventionHeaderId:e,taskId:a,isActive:"true",isDeleted:"false"};try{const c=(await X.post(`${Qt}?${new URLSearchParams(n).toString()}`,s)).data.result.content.detail;Bn().setNAInfo(c),this.setReason(c.reason),this.stateTitle=c.title,this.stateLoading=!1,this.toggleIsViewVisible(!0)}catch(l){l.message.includes("Network Error")&&yt().setSubmitConnectionError(!0),it(l),ne("IRONS",l),console.log(l)}this.stateLoading=!1},resetInstance(){this.stateSuccessUpdateItemKey=this.stateItemKey,this.stateLoading=!1,this.stateReason="",this.stateVisible=!1,this.stateViewVisible=!1,this.stateIsValid=!0,this.stateTask={},this.statePayload={updateParams:[]}}}}),Ca={class:"row my-4"},xa={class:"bg-secondary"},La=["src","onClick"],Ra={key:0,class:"row mt-7 mb-0"},Fa=t("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),$a=[Fa],Lt=oe({__name:"ImagePreview",props:{visibility:{type:Boolean,required:!1},images:{type:Array,required:!0},type:{type:String,required:!1,default:"cbm"},reRender:{type:Boolean,default:!1},showMandatoryCaption:{type:Boolean,default:!1}},emits:["onClose","onDelete","onDownloaded"],setup(e,{emit:a}){const n=e,s=a,l=D([]),c=he(n,"visibility"),o=D([]),h=D(0),v=D([]),x=D(),b=D(""),f=D(!1),k=async()=>{if(!(v.value.length<1))for(const[$,_]of v.value.entries()){const T={fileUrl:`${_.filename}`,ver:"v1"};try{const Y=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(T).toString()}`,I=await X.getBlob(Y),U=I.data,E=new Blob([U]),N=(window.URL||window.webkitURL).createObjectURL(E);l.value.push({key:_.filename,value:N}),v.value[$]={...v.value[$],imgBlob:I.blob,url:R(v.value[$].filename)},o.value[$]=!1}catch(Y){console.log("image",Y)}}},u=()=>{c.value=!1,s("onClose",null)};Ee(()=>n.reRender,async()=>{await L()});const L=async()=>{if(!n.images)return;o.value=Array.apply(null,Array(n.images.length)).map(function(){return!0}),h.value=0,l.value=[];const $=Re.clone(n.images);v.value=It(n.images);const _=$.length;for(let T=h.value;T<_;T++){const Y=v.value[T].filename;await A(Y,T)}await k()},A=async($,_)=>{const T={fileUrl:$,ver:"v1"};try{const Y=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(T).toString()}`,U=(await X.getBlob(Y)).data,E=new Blob([U]),d={};d.filename=$,d.blob=E,d.type=n.type;const N={};N.image=d,N.index=_,N.length=n.images.length,s("onDownloaded",N),window.setTimeout(async()=>{let H=window.URL||window.webkitURL;l.value.push({key:$,value:H.createObjectURL(E)}),o.value[_]=!1},1e3)}catch(Y){console.log("image",Y)}},R=$=>{const _=l.value.find(T=>T.key==$);return(_==null?void 0:_.value)??""},q=$=>{const _=v.value.findIndex(Y=>Y.filename==$),T=v.value[_];if(_>0){const Y=v.value.slice(_),I=v.value.slice(0,_);x.value=[...Y,...I]}else x.value=v.value;b.value=T.url,f.value=!0},z=()=>{b.value="",f.value=!1};return($,_)=>{const T=O("el-skeleton-item"),Y=O("el-skeleton"),I=O("el-dialog");return r(),m(K,null,[i(I,{modelValue:c.value,"onUpdate:modelValue":_[0]||(_[0]=U=>c.value=U),title:"Detailed picture",width:"80%",onOpen:L,onClose:u,"custom-class":"e-form-font-family"},{default:p(()=>[t("div",Ca,[(r(!0),m(K,null,ae(v.value,(U,E)=>(r(),m("div",{key:U.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[i(Y,{loading:o.value[E],animated:""},{template:p(()=>[i(T,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:p(()=>[t("div",xa,[t("img",{src:U.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:d=>q(U.filename),alt:"images"},null,8,La)])]),_:2},1032,["loading"])]))),128))]),e.showMandatoryCaption?(r(),m("div",Ra,$a)):V("",!0)]),_:1},8,["modelValue"]),i(tn,{images:v.value,visibility:f.value,image:b.value,onHandleClose:z},null,8,["images","visibility","image"])],64)}}}),Pa={class:"text-white"},Ta=["innerHTML"],Aa=t("span",{class:"text-white"},". ",-1),Na=["innerHTML"],Ea={class:"text-white"},Va={class:"text-white"},Oa={class:"text-white"},Ha={class:"text-white"},Ua=["onClick"],qa=["onClick"],Ma=["onClick"],Ba=["onClick"],za={key:0},ja=["onClick"],Ga={key:1},Ya=["onClick"],Ka=oe({__name:"InterventionChecksGrid",props:{listData:{required:!0,type:Array},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{emit:a}){const n=e,s=a;ye();const l=ut(),c=mt(),o=Ct(),h=fe(),v=D(!1),x=D([]),b=D(null),f=async(R,q,z="")=>{s("setDeclineReason",z&&z!=""?z:""),await l.getDefectDetail(R,q)},k=async(R,q)=>{await c.getNADetail(R,q)},u=async(R,q,z)=>{const $=await o.getDefectHeaderFromServer(q,R,"taskId");h.setHeaderCbm($),h.setFormCbmHeaderVisibility(!0),h.setPsTypeCbm(z)},L=async R=>{v.value=!0,x.value=R},A=async()=>{v.value=!1,x.value=[]};return(R,q)=>{const z=O("inline-svg"),$=ve("loading");return r(),m(K,null,[te((r(),G(y(Dt),{ref_key:"tableRecActionRef",ref:b,data:n.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row"},{default:p(()=>[i(y(Z),{label:"No",width:"50",align:"center"},{default:p(_=>[t("span",Pa,S(_.row.subTask==null||_.row.subTask==""?_.$index+1:""),1)]),_:1}),i(y(Z),{prop:"recAction",label:"Intervention Checks","min-width":"200"},{default:p(_=>[_.row.subTask!=null&&_.row.subTask!=""?(r(),m(K,{key:0},[t("span",{class:"text-white",innerHTML:_.row.subTask},null,8,Ta),Aa],64)):V("",!0),t("span",{class:"text-white",innerHTML:_.row.recAction},null,8,Na)]),_:1}),i(y(Z),{prop:"executed",label:"Executed (Yes/No)",width:"100"},{default:p(_=>[t("span",Ea,S(_.row.executed?"Yes":"No"),1)]),_:1}),i(y(Z),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:p(_=>[t("span",Va,S(_.row.actualInterventionDate&&_.row.actualInterventionDate!=""?y(St)(_.row.actualInterventionDate):"-"),1)]),_:1}),i(y(Z),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:p(_=>[t("span",Oa,S(_.row.interventionStatus&&_.row.interventionStatus!=""?_.row.interventionStatus:"-"),1)]),_:1}),i(y(Z),{prop:"condition",label:"Condition","max-width":"200"},{default:p(_=>[t("span",Ha,S(_.row.condition&&_.row.condition!=""?_.row.condition:"-"),1)]),_:1}),i(y(Z),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:p(_=>[_.row.condition!=null&&_.row.condition[0]=="2"&&(_.row.spvStatus=="Decline"||_.row.plannerStatus=="Decline")?(r(),m("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:T=>f(_.row.interventionHeaderId,_.row.taskKey,_.row.declineReason)}," Declined ",8,Ua)):_.row.condition!=null&&_.row.condition[0]=="2"?(r(),m("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:T=>f(_.row.interventionHeaderId,_.row.taskKey)}," Detailed Information ",8,qa)):_.row.condition!=null&&_.row.condition[0]=="3"?(r(),m("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:T=>k(_.row.interventionHeaderId,_.row.taskKey)}," Detailed Information ",8,Ma)):_.row.interventionStatus&&(_.row.interventionStatus.includes("X")||_.row.interventionStatus.includes("C"))?(r(),m("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:T=>u(_.row.interventionHeaderId,_.row.taskKey,_.row.psType)}," Detailed Information ",8,Ba)):V("",!0)]),_:1}),i(y(Z),{width:"50"},{default:p(_=>{var T,Y,I;return[_.row.images&&((T=_.row.images)==null?void 0:T.length)>0&&!((Y=_.row.interventionStatus)!=null&&Y.includes("X"))&&!((I=_.row.interventionStatus)!=null&&I.includes("C"))?(r(),m("div",za,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:U=>L(_.row.images)},[i(z,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,ja)])):V("",!0),_.row.interventionStatus&&(_.row.interventionStatus.includes("X")||_.row.interventionStatus.includes("C"))&&_.row.condition!=null&&_.row.condition[0]=="2"?(r(),m("div",Ga,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:U=>u(_.row.interventionHeaderId,_.row.taskKey,_.row.psType)},[i(z,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,Ya)])):V("",!0)]}),_:1}),i(y(Z),{width:"90"})]),_:1},8,["data"])),[[$,n.isLoading]]),i(Lt,{showMandatoryCaption:!0,"re-render":"",images:x.value,visibility:v.value,onOnClose:A},null,8,["images","visibility"])],64)}}}),Ja={class:"text-white"},Wa=["innerHTML"],Xa=t("span",{class:"text-white"},". ",-1),Qa=["innerHTML"],Za={class:"text-white"},es={class:"text-white"},ts={class:"text-white"},ns={class:"text-white"},as=["onClick"],ss=["onClick"],os=["onClick"],is=["onClick"],ls={key:0},rs=["onClick"],ds={key:1},cs=["onClick"],us=oe({__name:"InterventionCheckList",props:{listData:{required:!0,type:Array},disableSelection:{require:!0,type:Boolean,default:!0},reRender:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{emit:a}){const n=e,s=a,l=ye(),c=ut(),o=mt(),h=Ct(),v=fe(),x=D(!1),b=D([]),f=D(null),k=async($,_,T="")=>{s("setDeclineReason",T&&T!=""?T:""),await c.getDefectDetail($,_)},u=async($,_)=>{await o.getNADetail($,_)},L=async($,_,T)=>{const Y=await h.getDefectHeaderFromServer(_,$,"taskId");v.setHeaderCbm(Y),v.setFormCbmHeaderVisibility(!0),v.setPsTypeCbm(T)},A=async $=>{x.value=!0,b.value=$},R=async()=>{x.value=!1,b.value=[]},q=async $=>{console.log("checks row",$),l.updateInterventionCheckListMandatory($)},z=()=>{console.log("set selection ****************"),console.log("listData",n.listData),n.listData.length>0?n.listData.filter(_=>_.isMandatory==!0).forEach(_=>{f.value.toggleRowSelection(_,!0)}):(console.log("ELSE CLEAR SELECTION"),f.value.clearSelection()),console.log("**************************************************")};return Ee(()=>n.reRender===!0,()=>{console.log("rerender true"),z()}),($,_)=>{const T=O("inline-svg"),Y=ve("loading");return r(),m(K,null,[te((r(),G(y(Dt),{ref_key:"tableRecActionRef",ref:f,data:n.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row",onSelectionChange:q,"row-key":"taskKey","select-on-indeterminate":""},{default:p(()=>[i(y(Z),{"reserve-selection":"",class:"table-selection","class-name":"table-selection",type:"selection",width:52,align:"right","header-align":"right",selectable:()=>!n.disableSelection},null,8,["selectable"]),i(y(Z),{"class-name":"table-number",label:"No",width:"50",align:"center"},{default:p(I=>[t("span",Ja,S(I.row.subTask==null||I.row.subTask==""?I.$index+1:""),1)]),_:1}),i(y(Z),{prop:"recAction",label:"Intervention Checks","min-width":"200"},{default:p(I=>[I.row.subTask!=null&&I.row.subTask!=""?(r(),m(K,{key:0},[t("span",{class:"text-white",innerHTML:I.row.subTask},null,8,Wa),Xa],64)):V("",!0),t("span",{class:"text-white",innerHTML:I.row.recAction},null,8,Qa)]),_:1}),i(y(Z),{prop:"executed",label:"Executed (Yes/No)",width:"100"},{default:p(I=>[t("span",Za,S(I.row.executed?"Yes":"No"),1)]),_:1}),i(y(Z),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:p(I=>[t("span",es,S(I.row.actualInterventionDate&&I.row.actualInterventionDate!=""?y(St)(I.row.actualInterventionDate):"-"),1)]),_:1}),i(y(Z),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:p(I=>[t("span",ts,S(I.row.interventionStatus&&I.row.interventionStatus!=""?I.row.interventionStatus:"-"),1)]),_:1}),i(y(Z),{prop:"condition",label:"Condition","max-width":"200"},{default:p(I=>[t("span",ns,S(I.row.condition&&I.row.condition!=""?I.row.condition:"-"),1)]),_:1}),i(y(Z),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:p(I=>[I.row.condition!=null&&I.row.condition[0]=="2"&&(I.row.spvStatus=="Decline"||I.row.plannerStatus=="Decline")?(r(),m("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:U=>k(I.row.interventionHeaderId,I.row.taskKey,I.row.declineReason)}," Declined ",8,as)):I.row.condition!=null&&I.row.condition[0]=="2"?(r(),m("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:U=>k(I.row.interventionHeaderId,I.row.taskKey)}," Detailed Information ",8,ss)):I.row.condition!=null&&I.row.condition[0]=="3"?(r(),m("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:U=>u(I.row.interventionHeaderId,I.row.taskKey)}," Detailed Information ",8,os)):I.row.interventionStatus&&(I.row.interventionStatus.includes("X")||I.row.interventionStatus.includes("C"))?(r(),m("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:U=>L(I.row.interventionHeaderId,I.row.taskKey,I.row.psType)}," Detailed Information ",8,is)):V("",!0)]),_:1}),i(y(Z),{width:"50"},{default:p(I=>{var U,E,d;return[I.row.images&&((U=I.row.images)==null?void 0:U.length)>0&&!((E=I.row.interventionStatus)!=null&&E.includes("X"))&&!((d=I.row.interventionStatus)!=null&&d.includes("C"))?(r(),m("div",ls,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:N=>A(I.row.images)},[i(T,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,rs)])):V("",!0),I.row.interventionStatus&&(I.row.interventionStatus.includes("X")||I.row.interventionStatus.includes("C"))&&I.row.condition!=null&&I.row.condition[0]=="2"?(r(),m("div",ds,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:N=>L(I.row.interventionHeaderId,I.row.taskKey,I.row.psType)},[i(T,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,cs)])):V("",!0)]}),_:1}),i(y(Z),{width:"90"})]),_:1},8,["data"])),[[Y,n.isLoading]]),i(Lt,{showMandatoryCaption:!0,"re-render":"",images:b.value,visibility:x.value,onOnClose:R},null,8,["images","visibility"])],64)}}}),ms=e=>(Ie("data-v-f6a628e5"),e=e(),we(),e),ps={class:"table-preview"},vs=ms(()=>t("thead",null,[t("tr",null,[t("th",{class:"no-column"},"No"),t("th",{class:"col-task"},"Task"),t("th",{class:"col-condition"},"Condition")])],-1)),hs={key:0},fs={class:"cel-no"},gs={key:1},_s={class:"cel-no"},bs={class:"row justify-content-between align-items-center"},ys={class:"col-7"},Is={class:"col-5"},ws={key:2},ks={class:"cel-no"},Ss={class:"row justify-content-between align-items-center"},Ds={class:"col-7",style:{"word-wrap":"break-word"}},Cs={class:"col-5"},xs={class:"row justify-content-between align-items-center"},Ls={class:"col-8"},Rs={class:"col-4"},Fs={class:"me-1"},$s={key:3},Ps={class:"cel-no"},Ts={class:"row justify-content-between align-items-center"},As={class:"col-5"},Ns={class:"col-7"},Es={class:"row justify-content-between align-items-center"},Vs={class:"col-5"},Os={class:"col-7"},Hs={key:4},Us={class:"cel-no"},qs={class:"d-flex"},Ms={class:"col-8 me-6"},Bs={class:"col-2"},zs={class:"btn btn-sm btn-icon btn-bg-light"},js={key:5},Gs={class:"cel-no"},Ys={class:"d-flex"},Ks={class:"col-8 me-6"},Js={class:"col-2"},Ws={class:"btn btn-sm btn-icon btn-bg-light"},Xs={key:6},Qs={class:"cel-no"},Zs={class:"row justify-content-between align-items-center"},eo={class:"col-7"},to={style:{"word-wrap":"break-word"}},no={class:"col-5"},ao={class:"row justify-content-between align-items-center"},so={class:"col-9"},oo={class:"col-3"},io={class:"btn btn-sm btn-icon btn-bg-light"},lo={key:7},ro={class:"cel-no"},co={class:"row justify-content-between align-items-center"},uo={class:"col-7",style:{"word-wrap":"break-word"}},mo={class:"col-5"},po={class:"row justify-content-between align-items-center"},vo={class:"col-8"},ho={class:"col-4"},fo={class:"me-1"},go={class:"d-flex"},_o={class:"col-8 me-6"},bo={class:"col-2"},yo={class:"btn btn-sm btn-icon btn-bg-light"},Io=oe({__name:"PreviewTable",props:{taskNo:{type:Number,default:1},typeTask:{type:Number,default:0},task:{type:String,default:""},optionsSelectCondition:{default:[],type:Array},uom:{type:String,default:""}},setup(e){const a=e,n=D(""),s=D(""),l=D(""),c=D(""),o=D([{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"},{label:"X",value:"X"}]);return Ee(()=>a.taskNo,()=>{n.value="",s.value="",l.value="",c.value=""}),(h,v)=>{const x=O("el-option"),b=O("el-select"),f=O("el-input"),k=O("NwImg");return r(),m("div",ps,[t("table",null,[vs,t("tbody",null,[e.typeTask==1?(r(),m("tr",hs,[t("td",fs,S(e.taskNo),1),t("td",null,[t("div",null,[t("span",null,S(e.task),1)])]),t("td",null,[i(b,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=u=>n.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(e.optionsSelectCondition,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):V("",!0),e.typeTask==2?(r(),m("tr",gs,[t("td",_s,S(e.taskNo),1),t("td",null,[t("div",bs,[t("div",ys,[t("span",null,S(e.task),1)]),t("div",Is,[i(f,{modelValue:l.value,"onUpdate:modelValue":v[1]||(v[1]=u=>l.value=u),placeholder:"Additional Information",size:"small"},null,8,["modelValue"])])])]),t("td",null,[i(b,{modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=u=>n.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(e.optionsSelectCondition,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):V("",!0),e.typeTask==3?(r(),m("tr",ws,[t("td",ks,S(e.taskNo),1),t("td",null,[t("div",Ss,[t("div",Ds,S(e.task),1),t("div",Cs,[t("div",xs,[t("div",Ls,[i(f,{modelValue:l.value,"onUpdate:modelValue":v[3]||(v[3]=u=>l.value=u),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),t("div",Rs,[t("span",Fs,S(e.uom),1)])])])])]),t("td",null,[i(b,{modelValue:n.value,"onUpdate:modelValue":v[4]||(v[4]=u=>n.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(e.optionsSelectCondition,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):V("",!0),e.typeTask==4?(r(),m("tr",$s,[t("td",Ps,S(e.taskNo),1),t("td",null,[t("div",Ts,[t("div",As,[t("span",null,S(e.task),1)]),t("div",Ns,[t("div",Es,[t("div",Vs,[i(f,{modelValue:l.value,"onUpdate:modelValue":v[5]||(v[5]=u=>l.value=u),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),t("div",Os,[i(f,{modelValue:c.value,"onUpdate:modelValue":v[6]||(v[6]=u=>c.value=u),placeholder:"Additional Information",size:"small"},null,8,["modelValue"])])])])])]),t("td",null,[i(b,{modelValue:n.value,"onUpdate:modelValue":v[7]||(v[7]=u=>n.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(e.optionsSelectCondition,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):V("",!0),e.typeTask==7?(r(),m("tr",Hs,[t("td",Us,S(e.taskNo),1),t("td",null,[t("div",null,[t("span",null,S(e.task),1)])]),t("td",null,[t("div",qs,[t("div",Ms,[i(b,{modelValue:s.value,"onUpdate:modelValue":v[8]||(v[8]=u=>s.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(o.value,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Bs,[t("button",zs,[i(k,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):V("",!0),e.typeTask==8?(r(),m("tr",js,[t("td",Gs,S(e.taskNo),1),t("td",null,[t("div",null,[t("span",null,S(e.task),1)])]),t("td",null,[t("div",Ys,[t("div",Ks,[i(b,{modelValue:s.value,"onUpdate:modelValue":v[9]||(v[9]=u=>s.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(o.value,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Js,[t("button",Ws,[i(k,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):V("",!0),e.typeTask==9?(r(),m("tr",Xs,[t("td",Qs,S(e.taskNo),1),t("td",null,[t("div",Zs,[t("div",eo,[t("span",to,S(e.task),1)]),t("div",no,[t("div",ao,[t("div",so,[i(b,{modelValue:s.value,"onUpdate:modelValue":v[10]||(v[10]=u=>s.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(o.value,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",oo,[t("button",io,[i(k,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])]),t("td",null,[i(b,{modelValue:n.value,"onUpdate:modelValue":v[11]||(v[11]=u=>n.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(e.optionsSelectCondition,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):V("",!0),e.typeTask==10?(r(),m("tr",lo,[t("td",ro,S(e.taskNo),1),t("td",null,[t("div",co,[t("div",uo,S(e.task),1),t("div",mo,[t("div",po,[t("div",vo,[i(f,{modelValue:l.value,"onUpdate:modelValue":v[12]||(v[12]=u=>l.value=u),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),t("div",ho,[t("span",fo,S(e.uom),1)])])])])]),t("td",null,[t("div",go,[t("div",_o,[i(b,{modelValue:s.value,"onUpdate:modelValue":v[13]||(v[13]=u=>s.value=u),placeholder:"Choose one",size:"small"},{default:p(()=>[(r(!0),m(K,null,ae(o.value,u=>(r(),G(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",bo,[t("button",yo,[i(k,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):V("",!0)])])])}}}),wo=ge(Io,[["__scopeId","data-v-f6a628e5"]]),ko={key:0,class:"mb-5"},So=t("span",null,"Is the Intervention Check required to assign to specific component?",-1),Do={class:"my-3"},Co={key:0},xo={key:1},Lo=t("h5",{class:"form-label fs-5 fw-bolder text-dark"}," Preview ",-1),Ro={class:"dialog-footer"},Fo=oe({__name:"FormAdditionalTask",props:{visibility:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},emits:["handle-close","handle-submit"],setup(e,{emit:a}){const n=e,s=a,l=ye(),c=fe(),o=D(!1),h=D([]),v=[5,6,7,8,9,10,11],x=he(n,"visibility"),b=P(()=>l.formDataAdditional),f=P(()=>l.loadingConditionOptions),k=P(()=>c.componentOption),u=D([]),L=D(!1),A=ct().shape({recAction:me().required("Intervention Check is mandatory").nullable(),typeTaskId:zn().required("Task Type is mandatory").nullable(),uom:me().when("typeTaskId",{is:H=>H==3||H==10,then:me().required("UoM is mandatory").nullable()})}),R=()=>n.isPreview?"Additional Task Details":n.isEdit?"Edit Other Additional Intervention Check":"Add Other Additional Intervention Check",q=()=>{_(""),Y(0),l.resetFormAdditionalTask(),o.value=!1,h.value=[]},z=()=>{N().length>0&&(o.value=!0,b.value.listComponent.forEach(B=>{!B.isDeleted&&B.componentName&&h.value.push(B.componentName)}))},$=(H=!1)=>{d(),q(),s("handle-close",H)},_=H=>{b.value.recAction=H},T=H=>{b.value.uom=H,d()},Y=async H=>{d(),b.value.typeTaskId=H,T(""),H&&await l.getLookupConditionOption(H),v.includes(H)||U(!1)},I=H=>{h.value=H},U=H=>{if(H){const B=N();h.value=B.map(F=>F.componentName)}else o.value=!1,h.value=[]},E=async()=>{if(L.value=!1,d(),await A.validate(b.value,{abortEarly:!1}).catch(B=>{L.value=!0,u.value=B.errors}),L.value)return;if(await l.checkIsAdditionalTaskDuplicate(b.value)){L.value=!0,u.value=["Intervention check already exist"];return}if(b.value.listComponent.length==0)b.value.listComponent=h.value.map(B=>({componentName:B,isDeleted:!1}));else{const B=b.value.listComponent.filter(F=>{const ie=h.value.findIndex(se=>se==F.componentName);if(F.isDeleted&&ie==-1||ie==-1)return F});b.value.listComponent=B.map(F=>({componentName:F.componentName,isDeleted:!0})),h.value.forEach(F=>{F&&b.value.listComponent.push({componentName:F,isDeleted:!1})})}console.log(b.value.listComponent),s("handle-submit",b.value)},d=()=>{L.value=!1,u.value=[]},N=()=>b.value.listComponent.filter(H=>!H.isDeleted);return(H,B)=>{const F=O("el-switch"),ie=O("el-button"),se=O("el-dialog"),W=ve("loading");return r(),G(se,{modelValue:x.value,"onUpdate:modelValue":B[1]||(B[1]=re=>x.value=re),title:R(),width:"60%",onOpen:z,onClose:$},kt({default:p(()=>[i(Ve,{name:"fade"},{default:p(()=>[L.value?(r(),G(Oe,{key:0,errorMessages:u.value,onResetForm:d},null,8,["errorMessages"])):V("",!0)]),_:1}),i(y(dt),{id:"kt_filter_form",class:"row g-2 my-4"},{default:p(()=>[i(Ce,{value:b.value.recAction,readonly:n.isPreview,placeholder:"Add Intervention Check",label:"Intervention Check",name:"InterventionCheck",textInputType:"textarea",max:255,onHandleChange:_},null,8,["value","readonly"]),i(De,{value:b.value.typeTaskId,"is-disabled":n.isPreview,placeholder:"Add Task Type",label:"Task Type",name:"TypeTask",onHandleChange:Y,options:y(l).typeTaskOptions},null,8,["value","is-disabled","options"]),b.value.typeTaskId==3||b.value.typeTaskId==10?(r(),G(jn,{key:0,"is-disabled":n.isPreview,value:b.value.uom,placeholder:"Add UoM",label:"UoM",name:"Uom",onHandleChange:T,options:y(l).uomOptions},null,8,["is-disabled","value","options"])):V("",!0)]),_:1}),v.includes(b.value.typeTaskId)?(r(),m("div",ko,[So,t("div",Do,[i(F,{modelValue:o.value,"onUpdate:modelValue":B[0]||(B[0]=re=>o.value=re),"active-text":o.value?"Required":"Not Required",onChange:U,disabled:n.isPreview},null,8,["modelValue","active-text","disabled"])]),o.value?(r(),m("div",Co,[i(De,{value:h.value,"is-disabled":n.isPreview,placeholder:"Choose component",name:"componentList",options:k.value,isMultiple:!0,onHandleChange:I},null,8,["value","is-disabled","options"])])):V("",!0)])):V("",!0),b.value.recAction&&b.value.typeTaskId?(r(),m("div",xo,[Lo,te((r(),m("div",null,[i(wo,{taskNo:b.value.sequence,typeTask:b.value.typeTaskId,task:b.value.recAction,optionsSelectCondition:y(l).conditionOptions,uom:b.value.uom},null,8,["taskNo","typeTask","task","optionsSelectCondition","uom"])])),[[W,f.value]])])):V("",!0)]),_:2},[n.isPreview?void 0:{name:"footer",fn:p(()=>[t("span",Ro,[i(ie,{type:"secondary",onClick:$},{default:p(()=>[le("Cancel")]),_:1}),i(ie,{type:"primary",onClick:E},{default:p(()=>[le("Submit")]),_:1})])]),key:"0"}]),1032,["modelValue","title"])}}}),$o=e=>(Ie("data-v-d55e6b79"),e=e(),we(),e),Po={class:"text-white"},To={class:"text-white"},Ao=["onClick"],No={class:"me-2"},Eo=$o(()=>t("em",{class:"fa fa-eye",style:{color:"black",cursor:"pointer"}},null,-1)),Vo={class:"text-white"},Oo={class:"text-white"},Ho={class:"text-white"},Uo={class:"text-white"},qo=["onClick"],Mo=["onClick"],Bo=["onClick"],zo=["onClick"],jo={key:0},Go=["onClick"],Yo={key:1},Ko=["onClick"],Jo={class:"d-flex justify-space-between"},Wo=["onClick"],Xo=["onClick"],Qo=["disabled"],Zo={class:"svg-icon svg-icon-1x text-white"},ei=oe({__name:"AdditionalTaskGrid",props:{listData:{required:!0,type:Array},canEditAndDelete:{required:!0,type:Boolean},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{expose:a,emit:n}){const s=D(!1),l=D([]),c=e,o=n,h=ye(),v=ut(),x=mt(),b=Ct(),f=fe(),k={additionalTaskId:-1,sequence:0,recAction:"",executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",isActive:!0,isDeleted:!1,typeTaskId:0,typeTask:"",uom:"",listComponent:[]},u=D({...k}),L=D({...k}),A=D(!1),R=D(!1),q=D(!1),z=D({sequence:"",recAction:"",typeTask:"",uom:""}),$=P(()=>h.isError),_=P(()=>h.errors);wt(()=>{z.value={sequence:"",recAction:"",typeTask:"",uom:""}});const T=j=>{var J;return j?(J=h.typeTaskOptions.find(ee=>ee.value==j))==null?void 0:J.label:""},Y=()=>{A.value=!1,q.value=!1},I=j=>{Wt("Are you sure you want to submit ?").then(J=>{J.isConfirmed&&(R.value?(h.updateAdditionalTask(u.value,j),F()):h.insertAdditionalTask(j),Nn("Form has been successfully submitted!").then(()=>{A.value=!1}))})},U=async j=>{H(j),q.value=!0,await h.getLookupConditionOption(j.typeTaskId)},E=async(j,J,ee="")=>{o("setDeclineReason",ee&&ee!=""?ee:""),await v.getDefectDetail(j,J)},d=async(j,J)=>{await x.getNADetail(j,J)},N=()=>{h.addAdditionalForm(),R.value=!1,A.value=!0},H=async j=>{u.value={...j,uom:j.uom||""},L.value={...j,uom:j.uom||""},console.log(j),h.setAdditionalForm(L.value),R.value=!0,A.value=!0},B=j=>{h.deleteAdditionalTask(j)},F=async()=>{ie(),u.value={...k},L.value={...k}},ie=()=>{h.setErrors([])},se=async(j,J,ee)=>{const be=await b.getDefectHeaderFromServer(J,j,"taskId");f.setHeaderCbm(be),f.setFormCbmHeaderVisibility(!0),f.setPsTypeCbm(ee)},W=async j=>{s.value=!0,l.value=j},re=async()=>{s.value=!1,l.value=[]};return a({editedItem:L,handleCancelEditRow:F}),(j,J)=>{const ee=O("inline-svg"),be=O("el-tooltip"),Te=ve("loading");return r(),m(K,null,[te((r(),G(y(Dt),{data:c.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table_dark-row table-dark","header-row-class-name":"table_dark-header","row-class-name":"table_dark-row"},{default:p(()=>[i(y(Z),{label:"No",width:"52",align:"center"},{default:p(g=>[t("span",Po,S(g.row.sequence),1)]),_:1}),i(y(Z),{prop:"recAction",label:"Intervention Checks","min-width":"150"},{default:p(({row:g})=>[t("span",To,S(g.recAction),1)]),_:1}),i(y(Z),{prop:"typeTaskId",label:"Type Task",width:"161"},{default:p(g=>[g.row.typeTaskId?(r(),m("button",{key:0,size:"small",class:"btn btn-sm btn-bg-light",onClick:pe=>U(g.row),style:{padding:"5px !important"}},[t("span",No,S(T(g.row.typeTaskId)||g.row.typeTask),1),Eo],8,Ao)):V("",!0)]),_:1}),i(y(Z),{prop:"executed",label:"Executed (Yes/No)",width:"79"},{default:p(g=>[t("span",Vo,S(g.row.executed?"Yes":"No"),1)]),_:1}),i(y(Z),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:p(g=>[t("span",Oo,S(g.row.actualInterventionDate&&g.row.actualInterventionDate!=""?y(St)(g.row.actualInterventionDate):"-"),1)]),_:1}),i(y(Z),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:p(g=>[t("span",Ho,S(g.row.interventionStatus&&g.row.interventionStatus!=""?g.row.interventionStatus:"-"),1)]),_:1}),i(y(Z),{prop:"condition",label:"Condition","max-width":"200"},{default:p(g=>[t("span",Uo,S(g.row.condition&&g.row.condition!=""?g.row.condition:"-"),1)]),_:1}),i(y(Z),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:p(g=>[g.row.condition!=null&&g.row.condition[0]=="2"&&(g.row.spvStatus=="Decline"||g.row.plannerStatus=="Decline")?(r(),m("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:pe=>E(g.row.interventionHeaderId,g.row.taskKey,g.row.declineReason)}," Declined ",8,qo)):g.row.condition!=null&&g.row.condition[0]=="2"?(r(),m("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:pe=>E(g.row.interventionHeaderId,g.row.taskKey)}," Detailed Information ",8,Mo)):g.row.condition!=null&&g.row.condition[0]=="3"?(r(),m("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:pe=>d(g.row.interventionHeaderId,g.row.taskKey)}," Detailed Information ",8,Bo)):g.row.interventionStatus&&(g.row.interventionStatus.includes("X")||g.row.interventionStatus.includes("C"))?(r(),m("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:pe=>se(g.row.interventionHeaderId,g.row.taskKey,g.row.psType)}," Detailed Information ",8,zo)):V("",!0)]),_:1}),i(y(Z),{width:"50"},{default:p(g=>{var pe,Ke,Je;return[g.row.images&&((pe=g.row.images)==null?void 0:pe.length)>0&&!((Ke=g.row.interventionStatus)!=null&&Ke.includes("X"))&&!((Je=g.row.interventionStatus)!=null&&Je.includes("C"))?(r(),m("div",jo,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:We=>W(g.row.images)},[i(ee,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,Go)])):V("",!0),g.row.interventionStatus&&(g.row.interventionStatus.includes("X")||g.row.interventionStatus.includes("C"))&&g.row.condition!=null&&g.row.condition[0]=="2"?(r(),m("div",Yo,[t("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:We=>se(g.row.interventionHeaderId,g.row.taskKey,g.row.psType)},[i(ee,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,Ko)])):V("",!0)]}),_:1}),i(y(Z),{width:"90","class-name":"el-table__body-wrapper fixed-right"},kt({_:2},[e.canEditAndDelete?{name:"default",fn:p(g=>[t("div",Jo,[i(be,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:p(()=>[t("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:pe=>H(g.row)},[i(ee,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Wo)]),_:2},1024),i(be,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:p(()=>[t("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:pe=>B(g.row)},[i(ee,{src:"/media/svg/tables/rows/trash-delete-blue.svg",width:"12",height:"12"})],8,Xo)]),_:2},1024)])]),key:"0"}:void 0]),1024)]),_:1},8,["data"])),[[Te,c.isLoading]]),e.canEditAndDelete?(r(),G(be,{key:0,class:"box-item",effect:"dark",content:L.value.additionalTaskId!=-1?"Please finish the edited item first":"Add additional task",placement:"bottom"},{default:p(()=>[t("button",{disabled:y(h).loading,class:"fw-bolder my-5 text-green btn-additional-task",onClick:N},[t("span",Zo,[i(ee,{src:"/media/icons/duotune/arrows/arr075.svg"})]),le(" If required, please add other specific intervention check ")],8,Qo)]),_:1},8,["content"])):V("",!0),i(Ve,{name:"fade"},{default:p(()=>[$.value?(r(),G(Oe,{key:0,ref:"additionalTaskError",errorMessages:_.value,onResetForm:ie},null,8,["errorMessages"])):V("",!0)]),_:1}),i(Lt,{showMandatoryCaption:!0,"re-render":"",images:l.value,visibility:s.value,onOnClose:re},null,8,["images","visibility"]),i(Fo,{"is-preview":q.value,"is-edit":R.value,visibility:A.value,onHandleClose:Y,onHandleSubmit:I},null,8,["is-preview","is-edit","visibility"])],64)}}}),ti=ge(ei,[["__scopeId","data-v-d55e6b79"]]),an=e=>(Ie("data-v-b156c6a9"),e=e(),we(),e),ni={class:"row px-2 item mx-1 w-100 defect-panel-header",style:{color:"#909399",background:"#3d3d4b"}},ai=Fn('<div class="col align-items-center d-flex text-break" data-v-b156c6a9>Task Description</div><div class="text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center" data-v-b156c6a9>Priority</div><div class="col-1 column-sm-20-percent column-md-24-percent column-lg-15-percent column-xl-15-percent align-items-center d-flex justify-content-center" style="padding-left:0;" data-v-b156c6a9>Review Status</div><div class="col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center" style="padding-left:0;" data-v-b156c6a9>Work Order</div><div class="col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex" style="word-break:initial !important;" data-v-b156c6a9>Repair Status</div>',5),si=[ai],oi={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ii=an(()=>t("p",{class:"el-table__empty-text",style:{"text-align":"center"}},"No Data",-1)),li=[ii],ri={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},di={class:"col align-items-center d-flex text-break"},ci=["innerHTML"],ui={class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},mi={class:"text-center",style:{"font-weight":"600",color:"white"}},pi={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-15-percent column-xl-15-percent align-items-center d-flex justify-content-center"},vi=["onClick"],hi=["onClick"],fi={class:"row"},gi={key:0,class:"pe-0"},_i=["value"],bi={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},yi=an(()=>t("img",{src:Gn,alt:""},null,-1)),Ii=[yi],wi={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},ki=oe({__name:"GenericDefect",props:{listData:{required:!0,type:Array},loading:{required:!0,type:Boolean}},emits:["onViewDetailInformation"],setup(e,{emit:a}){const n=e,s=a,l=(f,k)=>{const u=!!f.declineReason,L=!!k.declineReason;return u<L?-1:u>L?1:0},c=(f,k)=>{let u="light-yellow color-dark-yellow";const L=k==null?void 0:k.find(A=>A.id===f);if(L){switch(L.status){case"Submited":u="light-yellow color-dark-yellow";break;case"Acknowledge":u="light-green color-dark-green";break}L.priority===void 0&&(u="light-green color-dark-green")}return u},o=f=>{let k="";switch(f){case"P1":k="red";break;case"P2":k="gold";break;case"P3":k="yellow";break;case"P4":k="green";break}return k},h=f=>{s("onViewDetailInformation",{type:"defectGeneric",taskId:f.taskId,taskNo:f.taskNo,taskDesc:f.taskDesc,taskStatus:f.status,taskDeclineReason:f.declineReason,taskDeclineDate:f.declineDate,taskDeclineBy:f.declineBy,defectHeaderId:f.id})},v=P(()=>Re.cloneDeep(n.listData).sort(l)),x=f=>{let k=f.repairedStatus=="Repaired"?"green":"red";return k=f.priority?k:"green",k},b=f=>f.plannerStatus=="Decline"||f.status=="Decline";return(f,k)=>{const u=O("el-table-column"),L=O("el-table"),A=ve("loading");return e.loading?te((r(),G(L,{key:0,"element-loading-background":"#2d2b39b3",data:[],style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row"},{default:p(()=>[i(u,{label:"Task Description"}),i(u,{label:"Priority",align:"center",width:"80"}),i(u,{label:"Review Status",align:"center",width:"170"}),i(u,{label:"Work Order",align:"center",width:"250"}),i(u,{label:"Repair Status",align:"center",width:"150"})]),_:1})),[[A,e.loading]]):(r(),m(K,{key:1},[te((r(),m("div",ni,si)),[[A,e.loading]]),v.value.length<1?(r(),m("div",oi,li)):(r(!0),m(K,{key:1},ae(v.value,R=>(r(),m("div",{key:R.id,class:"item px-2 my-2 mx-1"},[t("div",ri,[t("div",di,[t("span",{class:"text-break",innerHTML:y(xt)(R.taskDesc??"")},null,8,ci)]),t("div",ui,[b(R)?V("",!0):(r(),m("div",{key:0,class:ue(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",o(R.priority??"")]),style:{"margin-top":"6px"}},[t("span",mi,S(R.priority),1)],2))]),t("div",pi,[b(R)?(r(),m("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red",onClick:q=>h(R),style:{"font-size":"11px !important"}}," Declined ",8,hi)):(r(),m("div",{key:0,class:ue(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center",c(R.id,v.value)]),onClick:q=>h(R),style:{"font-size":"11px !important"}}," Detailed Information ",10,vi))]),t("div",{class:ue(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",R.priority===void 0?"invisible":""])},[t("div",fi,[b(R)?V("",!0):(r(),m("div",gi,[t("input",{type:"text",class:"form-control mou-input",value:R.defectWorkorder,disabled:""},null,8,_i)]))])],2),t("div",bi,[b(R)?V("",!0):(r(),m("div",{key:0,class:ue(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",x(R)]),style:{"margin-top":"6px",cursor:"initial"}},Ii,2))])]),t("div",wi,S(R.createdBy.name)+", "+S(R.updatedDate&&R.updatedDate!=""?R.updatedDate:R.createdDate),1)]))),128))],64))}}}),Si=ge(ki,[["__scopeId","data-v-b156c6a9"]]),Di=e=>(Ie("data-v-1e1482f5"),e=e(),we(),e),Ci={class:"py-2 ps-0 pe-2 w-100"},xi={class:"d-flex align-items-center"},Li=Di(()=>t("div",{class:"flex-fill large-camera-container"},[t("span",null,"Please take a photo of the defect identified")],-1)),Ri={class:"ms-2"},Fi={key:0,class:"d-flex justify-content-center ms-2"},$i={class:"text-white"},Pi=oe({__name:"DefectViewCamera",props:{defectImages:{type:Array,required:!0}},emits:["onImageDownloaded"],setup(e,{emit:a}){const n=e,s=a,l=D(!1),c=nt(()=>n.defectImages.length),o=nt(()=>n.defectImages??[]),h=nt(()=>"disabled"),v=nt(()=>"not-allowed"),x=()=>{l.value=!0},b=()=>{l.value=!1},f=k=>{s("onImageDownloaded",k)};return(k,u)=>{const L=O("NwImg");return r(),m(K,null,[t("div",Ci,[t("div",xi,[t("div",{class:ue(["d-flex w-100 align-items-center camera-wrapper py-2",y(h)])},[Li,t("div",Ri,[t("div",{class:ue(["p-2 justify-items-center rounded",y(v)]),style:{background:"#F4F6F8"}},[y(c)>0&&y(v)!="not-allowed"?(r(),G(L,{key:0,src:"/media/svg/dma/camera/e-form/png/cam-user.png",style:{height:"20px",width:"24px"},class:ue(y(v)),alt:"camera"},null,8,["class"])):y(v)=="not-allowed"?(r(),G(L,{key:1,src:"/media/svg/dma/camera/e-form/png/cam-read.png",style:{height:"20px",width:"24px"},class:ue(y(v)),alt:"camera"},null,8,["class"])):(r(),G(L,{key:2,src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"20px",width:"24px"},class:ue(y(v)),alt:"camera"},null,8,["class"]))],2)]),y(c)&&y(c)>0?(r(),m("div",Fi,[t("button",{class:"btn btn-sm btn-icon btn-bg-success lg-btn-icon",onClick:x,style:{"background-color":"#18AF4A"}},[t("label",$i,"+"+S(y(c)),1)])])):V("",!0)],2)])]),i(Wn,{"is-monitoring":!0,images:y(o),visibility:l.value,showDeleteButton:!1,type:"defect","is-mandatory":!1,onOnClose:b,onOnDownloaded:f},null,8,["images","visibility"])],64)}}}),sn=ge(Pi,[["__scopeId","data-v-1e1482f5"]]),Q=e=>(Ie("data-v-db28e701"),e=e(),we(),e),Ti={class:"el-dialog__title"},Ai={key:0,class:"red-bg text-dark-red p-1"},Ni={key:1,class:"status-badge-dialog-header approved-badge p-1"},Ei=["innerHTML"],Vi={key:0,class:"mt-1 py-2"},Oi={class:"d-flex flex-column"},Hi={class:"row mb-1"},Ui={class:"col"},qi={class:"form-floating declined-text-box"},Mi={class:"form-control"},Bi=Q(()=>t("label",null,"Declined Reason*",-1)),zi={key:0,class:"mb-2 text-end"},ji={key:1,class:"mt-1 py-2"},Gi={class:"row mb-1"},Yi={class:"col"},Ki={key:0,class:"form-floating approved-text-box"},Ji={class:"form-control",style:{"white-space":"break-spaces"}},Wi=Q(()=>t("label",null,"Approved",-1)),Xi={class:"d-flex flex-row justify-content-between"},Qi={class:"p-2 d-flex flex-row flex-grow-1"},Zi={class:"flex-fill"},el={class:"form-floating"},tl=["innerHTML"],nl=Q(()=>t("label",{for:"floatingInput"},"Asset Number",-1)),al={class:"flex-fill ps-3"},sl={class:"form-floating"},ol=["innerHTML"],il=Q(()=>t("label",{for:"floatingInput"},"Serial Number",-1)),ll={class:"flex-fill ps-3"},rl={class:"form-floating"},dl=["innerHTML"],cl=Q(()=>t("label",{for:"floatingInput"},"Ownership",-1)),ul={class:"d-flex flex-row justify-content-between"},ml={class:"mt-1 p-2"},pl={class:"mt-1 p-2"},vl={class:"row"},hl={class:"col pe-0"},fl={class:"form-floating"},gl=["value"],_l=Q(()=>t("label",null,"Raised By",-1)),bl={class:"mt-1 p-2"},yl={class:"row"},Il={class:"col-4 pe-0 date"},wl={class:"form-floating"},kl=["value"],Sl=Q(()=>t("label",null,"Date Raised",-1)),Dl={class:"col pe-0 d-flex"},Cl={class:"d-flex flex-column flex-fill"},xl={class:"form-floating"},Ll=["value"],Rl=Q(()=>t("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Fl={class:"ms-2 d-flex align-items-center"},$l={class:"mt-1 p-2"},Pl=Q(()=>t("div",{class:"mt-2"},null,-1)),Tl=Q(()=>t("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[t("div",{class:"col-3"},"Priority"),t("div",{class:"col-6"},"Action"),t("div",{class:"col-3 text-break"},"Person Responsible")],-1)),Al={class:"row p-3 m-1 priority-container"},Nl={class:"col-3"},El={class:"form-check"},Vl=Q(()=>t("label",{class:"form-check-label text-nowrap"}," (P1) Immediate ",-1)),Ol=Q(()=>t("div",{class:"col-6"},"Shall shut machine down and undertake repairs.",-1)),Hl=Q(()=>t("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Ul={class:"row p-3 m-1 priority-container"},ql={class:"col-3"},Ml={class:"form-check"},Bl=Q(()=>t("label",{class:"form-check-label text-nowrap"}," (P2) Urgent ",-1)),zl=Q(()=>t("div",{class:"col-6"},"Shall complete within 7 days.",-1)),jl=Q(()=>t("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Gl={class:"row p-3 m-1 priority-container"},Yl={class:"col-3"},Kl={class:"form-check"},Jl=Q(()=>t("label",{class:"form-check-label text-nowrap"}," (P3) Routine ",-1)),Wl=Q(()=>t("div",{class:"col-6"},"Shall complete within 60 days.",-1)),Xl=Q(()=>t("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),Ql={class:"row p-3 m-1 priority-container"},Zl={class:"col-3"},er={class:"form-check"},tr=Q(()=>t("label",{class:"form-check-label text-nowrap"}," (P4) Monitor ",-1)),nr=Q(()=>t("div",{class:"col-6"},"Shall continue to inspect and monitor for 90 days.",-1)),ar=Q(()=>t("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),sr=Q(()=>t("div",{class:"mt-2"},null,-1)),or=Q(()=>t("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[t("div",{class:"col-3"},"Part Number"),t("div",{class:"col-7"},"Part Description"),t("div",{class:"col-2"},"Qty")],-1)),ir={class:"col-3 px-0"},lr={class:"d-flex flex-column"},rr=["value"],dr={class:"col-7"},cr={class:"d-flex flex-column"},ur=["value"],mr={class:"col-2 px-1 d-flex justify-content-start"},pr={class:"d-flex flex-column"},vr=["value"],hr=Q(()=>t("div",{class:"ms-4 d-flex align-items-center"},null,-1)),fr=Q(()=>t("div",{class:"mt-2"},null,-1)),gr=Q(()=>t("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[t("div",{class:"col-6"},"Labour Activity"),t("div",{class:"col-2"},"Qty"),t("div",{class:"col-2 word-breaker"},"Hours Each"),t("div",{class:"col-2 word-breaker"},"Total Hours")],-1)),_r={class:"col-6 px-0"},br={class:"d-flex flex-column"},yr={class:"form-select","aria-label":"Disabled select example",disabled:""},Ir={selected:""},wr={class:"col-2 d-flex justify-content-start"},kr={class:"d-flex flex-column"},Sr=["value"],Dr={class:"col-2 d-flex justify-content-start"},Cr={class:"d-flex flex-column"},xr=["value"],Lr={class:"col-2 d-flex justify-content-start"},Rr={class:"d-flex flex-column"},Fr=["value"],$r=Q(()=>t("div",{class:"mt-2"},null,-1)),Pr={class:"d-flex flex-fill flex-column"},Tr=["value"],Ar=Q(()=>t("div",{class:"ms-4 d-flex align-items-center"},null,-1)),Nr=Q(()=>t("div",{class:"mt-2"},null,-1)),Er={class:"d-flex flex-fill flex-column"},Vr={key:0,class:"mt-2"},Or=Q(()=>t("div",{class:"mt-2"},null,-1)),Hr={class:"d-flex flex-fill flex-column"},Ur={key:0,class:"mt-2"},qr=oe({__name:"DefectYesView",props:{visibility:{required:!0,type:Boolean},data:{required:!0,type:Object},decline:{type:Object},ownership:{type:String,default:""},serialNumber:{type:String,default:""},approvedDate:{required:!1,type:String,default:""},approvedBy:{required:!1,type:Object,default:{}}},emits:["onClose","onImageDownloaded"],setup(e,{emit:a}){const n=e,s=a,l=D("Priority"),c=D("Parts Required"),o=D("Labour Required"),h=D("Other Resources Required (optional)"),v=D("Defect Symptom"),x=D("Defect Cause"),b=he(n,"visibility"),f=he(n,"data"),k=D(),u=D(nn()),L=P(()=>n.data.images?JSON.parse(n.data.images):[]),A=P(()=>JSON.parse(f.value.parts)),R=P(()=>JSON.parse(f.value.labours)),q=P(()=>JSON.parse(f.value.resources).map(E=>E)),z=P(()=>JSON.parse(f.value.symptoms).map(E=>E)),$=P(()=>JSON.parse(f.value.causes).map(E=>E)),_=async()=>{s("onClose")},T=()=>{en(k.value)},Y=U=>{s("onImageDownloaded",U)},I=P(()=>{const U=n.ownership;return Zt(U)});return(U,E)=>{const d=O("Label"),N=O("el-collapse-item"),H=O("el-collapse"),B=O("el-option"),F=O("el-select"),ie=O("el-dialog");return r(),G(ie,{modelValue:b.value,"onUpdate:modelValue":E[10]||(E[10]=se=>b.value=se),width:"90%",center:"",onClosed:_,onOpened:T,"destroy-on-close":!0,"custom-class":`el-defect-crack-form-custom form-defect-yes-intervention-view ${u.value}`},{title:p(()=>{var se,W;return[t("span",Ti,[le("Detailed Information for Defect Identification "),(se=e.decline)!=null&&se.isDecline?(r(),m("span",Ai,"Declined")):e.approvedBy&&e.approvedDate?(r(),m("span",Ni,"Approved")):V("",!0)]),t("span",{class:"el-dialog__title task-title",innerHTML:y(xt)((W=f.value)==null?void 0:W.title),ref_key:"defectDetailRef",ref:k},null,8,Ei)]}),default:p(()=>{var se,W,re,j,J,ee,be,Te;return[t("div",null,[(se=e.decline)!=null&&se.isDecline?(r(),m("div",Vi,[t("div",Oi,[t("div",Hi,[t("div",Ui,[t("div",qi,[t("div",Mi,S((W=e.decline)==null?void 0:W.declineReason),1),Bi])])]),e.decline&&e.decline.declineBy&&e.decline.declineDate?(r(),m("div",zi,S(e.decline.declineBy.name)+", "+S(e.decline.declineDate),1)):V("",!0)])])):e.approvedBy&&e.approvedDate?(r(),m("div",ji,[t("div",Gi,[t("div",Yi,[e.approvedBy&&e.approvedDate?(r(),m("div",Ki,[t("div",Ji,S(e.approvedDate)+"  "+S(e.approvedBy.name),1),Wi])):V("",!0)])])])):V("",!0),t("div",Xi,[t("div",Qi,[t("div",Zi,[t("div",el,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:(re=f.value)==null?void 0:re.assetNumber},null,8,tl),nl])]),t("div",al,[t("div",sl,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:e.serialNumber},null,8,ol),il])]),t("div",ll,[t("div",rl,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:I.value},null,8,dl),cl])])])]),t("div",ul,[i(sn,{"defect-images":L.value,onOnImageDownloaded:Y},null,8,["defect-images"])]),t("div",ml,[i(Ne,{value:(j=f.value)==null?void 0:j.description,label:"Defect Identified Description",name:"DefectIdentifiedDescription",disabled:!0},null,8,["value"])]),t("div",pl,[t("div",vl,[t("div",hl,[t("div",fl,[t("input",{type:"text",class:"form-control",disabled:"",value:(J=f.value)==null?void 0:J.raisedBy},null,8,gl),_l])])])]),t("div",bl,[t("div",yl,[t("div",Il,[t("div",wl,[t("input",{type:"text",class:"form-control",disabled:"",value:(ee=f.value)==null?void 0:ee.date},null,8,kl),Sl])]),t("div",Dl,[t("div",Cl,[t("div",xl,[t("input",{type:"text",class:"form-control",value:y(Ge)((be=f.value)==null?void 0:be.plannedDuration),disabled:""},null,8,Ll),Rl])]),t("div",Fl,[i(d,null,{default:p(()=>[le("Hours")]),_:1})])])])]),t("div",$l,[i(Ne,{value:(Te=f.value)==null?void 0:Te.instruction,label:"Defect Identified instruction",name:"DefectIdentifiedInstruction",disabled:!0},null,8,["value"])]),Pl,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:l.value,"onUpdate:modelValue":E[4]||(E[4]=g=>l.value=g)},{default:p(()=>[i(N,{title:"Priority",name:"Priority"},{default:p(()=>[Tl,t("div",Al,[t("div",Nl,[t("div",El,[te(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":E[0]||(E[0]=g=>f.value.priority=g),value:"P1",disabled:""},null,512),[[at,f.value.priority]]),Vl])]),Ol,Hl]),t("div",Ul,[t("div",ql,[t("div",Ml,[te(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":E[1]||(E[1]=g=>f.value.priority=g),value:"P2",disabled:""},null,512),[[at,f.value.priority]]),Bl])]),zl,jl]),t("div",Gl,[t("div",Yl,[t("div",Kl,[te(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":E[2]||(E[2]=g=>f.value.priority=g),value:"P3",disabled:""},null,512),[[at,f.value.priority]]),Jl])]),Wl,Xl]),t("div",Ql,[t("div",Zl,[t("div",er,[te(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":E[3]||(E[3]=g=>f.value.priority=g),value:"P4",disabled:""},null,512),[[at,f.value.priority]]),tr])]),nr,ar])]),_:1})]),_:1},8,["modelValue"]),sr,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:c.value,"onUpdate:modelValue":E[5]||(E[5]=g=>c.value=g)},{default:p(()=>[i(N,{title:"Parts Required",name:"Parts Required"},{default:p(()=>[or,(r(!0),m(K,null,ae(A.value,g=>(r(),m("div",{class:"row p-3 m-1 priority-container px-0",key:g.partNumber},[t("div",ir,[t("div",lr,[t("input",{type:"text",class:"form-control",value:g.partNumber,disabled:""},null,8,rr)])]),t("div",dr,[t("div",cr,[t("input",{type:"text",class:"form-control",value:g.partDescription,disabled:""},null,8,ur)])]),t("div",mr,[t("div",pr,[t("input",{class:"form-control",value:y(Ge)(g.qty),disabled:""},null,8,vr)]),hr])]))),128))]),_:1})]),_:1},8,["modelValue"]),fr,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:o.value,"onUpdate:modelValue":E[6]||(E[6]=g=>o.value=g)},{default:p(()=>[i(N,{title:"Labour Required",name:"Labour Required"},{default:p(()=>[gr,(r(!0),m(K,null,ae(R.value,g=>(r(),m("div",{class:"row p-3 m-1 priority-container ps-0",key:g.position},[t("div",_r,[t("div",br,[t("select",yr,[t("option",Ir,S(g.position),1)])])]),t("div",wr,[t("div",kr,[t("input",{class:"form-control",value:y(Ge)(g.qty),disabled:""},null,8,Sr)])]),t("div",Dr,[t("div",Cr,[t("input",{class:"form-control",value:y(Ge)(g.hireEach),disabled:""},null,8,xr)])]),t("div",Lr,[t("div",Rr,[t("input",{class:"form-control",value:y(Ge)(g.totalHours),disabled:""},null,8,Fr)])])]))),128))]),_:1})]),_:1},8,["modelValue"]),$r,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:h.value,"onUpdate:modelValue":E[7]||(E[7]=g=>h.value=g)},{default:p(()=>[i(N,{title:"Other Resources Required (optional)",name:"Other Resources Required (optional)"},{default:p(()=>[(r(!0),m(K,null,ae(q.value,g=>(r(),m("div",{class:"p-2 d-flex",key:g},[t("div",Pr,[t("input",{type:"text",class:"form-control",value:g,placeholder:"Resource1",disabled:""},null,8,Tr)]),Ar]))),128))]),_:1})]),_:1},8,["modelValue"]),Nr,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:v.value,"onUpdate:modelValue":E[8]||(E[8]=g=>v.value=g)},{default:p(()=>[i(N,{title:"Defect Symptom",name:"Defect Symptom"},{default:p(()=>[(r(!0),m(K,null,ae(z.value,g=>(r(),m("div",{class:"p-2 d-flex",key:g},[t("div",Er,[i(F,{modelValue:g.split(":")[0],"onUpdate:modelValue":pe=>g.split(":")[0]=pe,disabled:!0,class:"w-100"},{default:p(()=>[i(B,{label:g.split(":")[0],value:g.split(":")[0]},null,8,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),g.includes("Other")?(r(),m("div",Vr,[i(Ne,{value:y(jt)(g),label:"Description",name:"Description",disabled:!0},null,8,["value"])])):V("",!0)])]))),128))]),_:1})]),_:1},8,["modelValue"]),Or,i(H,{class:"task-group general-accordion py-1 px-5",modelValue:x.value,"onUpdate:modelValue":E[9]||(E[9]=g=>x.value=g)},{default:p(()=>[i(N,{title:"Defect Cause",name:"Defect Cause"},{default:p(()=>[(r(!0),m(K,null,ae($.value,g=>(r(),m("div",{class:"p-2 d-flex",key:g},[t("div",Hr,[i(F,{modelValue:g.split(":")[0],"onUpdate:modelValue":pe=>g.split(":")[0]=pe,disabled:"",class:"w-100"},{default:p(()=>[i(B,{label:g.split(":")[0],value:g.split(":")[0]},null,8,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),g.includes("Other")?(r(),m("div",Ur,[i(Ne,{value:y(jt)(g),label:"Description",name:"Description",disabled:!0},null,8,["value"])])):V("",!0)])]))),128))]),_:1})]),_:1},8,["modelValue"])])]}),_:1},8,["modelValue","custom-class"])}}}),Mr=ge(qr,[["__scopeId","data-v-db28e701"]]),$e=e=>(Ie("data-v-5d253356"),e=e(),we(),e),Br=$e(()=>t("span",{class:"el-dialog__title"},"Detailed Information for Defect Identification",-1)),zr=["innerHTML"],jr={class:"d-flex flex-row justify-content-between"},Gr={class:"p-2 d-flex flex-row flex-grow-1"},Yr={class:"flex-fill"},Kr={class:"form-floating"},Jr=["innerHTML"],Wr=$e(()=>t("label",{for:"floatingInput"},"Asset Number",-1)),Xr={class:"flex-fill ps-3"},Qr={class:"form-floating"},Zr=["innerHTML"],ed=$e(()=>t("label",{for:"floatingInput"},"Serial Number",-1)),td={class:"flex-fill ps-3"},nd={class:"form-floating"},ad=["innerHTML"],sd=$e(()=>t("label",{for:"floatingInput"},"Ownership",-1)),od={class:"d-flex flex-row justify-content-between"},id={class:"mt-1 p-2"},ld={class:"d-flex flex-column"},rd={class:"mt-1 p-2"},dd={class:"row",style:{width:"101%"}},cd={class:"col-6 pe-0"},ud={class:"form-floating"},md=["value"],pd=$e(()=>t("label",null,"Raised By",-1)),vd={class:"col-6 pe-0"},hd={class:"form-floating"},fd=["value"],gd=$e(()=>t("label",null,"Date Raised",-1)),_d=$e(()=>t("div",{class:"mt-2"},null,-1)),bd={class:"d-flex flex-fill flex-column"},yd={class:"mt-2"},Id=oe({__name:"DefectNoView",props:{visibility:{required:!0,type:Boolean},data:{required:!0,type:Object},ownership:{type:String,default:""},serialNumber:{type:String,default:""}},emits:["onClose","onImageDownloaded"],setup(e,{emit:a}){const n=e,s=a,l=D("Repairs Completed"),c=he(n,"visibility"),o=he(n,"data"),h=D(),v=D(nn()),x=async()=>{s("onClose",null)},b=()=>{en(h.value)},f=u=>{s("onImageDownloaded",u)},k=P(()=>{const u=n.ownership;return Zt(u)});return(u,L)=>{const A=O("el-collapse-item"),R=O("el-collapse"),q=O("el-dialog");return r(),G(q,{modelValue:c.value,"onUpdate:modelValue":L[1]||(L[1]=z=>c.value=z),width:"90%",center:"",onClosed:x,onOpened:b,"destroy-on-close":!0,"custom-class":`el-defect-crack-form-custom form-defect-no-intervention-view ${v.value}`},{title:p(()=>{var z;return[Br,t("span",{class:"el-dialog__title task-title",innerHTML:y(xt)((z=o.value)==null?void 0:z.title),ref_key:"defectDetailRef",ref:h},null,8,zr)]}),default:p(()=>{var z;return[t("div",jr,[t("div",Gr,[t("div",Yr,[t("div",Kr,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:(z=u.detai)==null?void 0:z.assetNumber},null,8,Jr),Wr])]),t("div",Xr,[t("div",Qr,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:e.serialNumber},null,8,Zr),ed])]),t("div",td,[t("div",nd,[t("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:k.value},null,8,ad),sd])])])]),t("div",od,[i(sn,{"defect-images":e.data.images?JSON.parse(e.data.images):[],onOnImageDownloaded:f},null,8,["defect-images"])]),t("div",id,[t("div",ld,[i(Ne,{value:o.value.description,label:"Defect Identified Description",name:"DefectIdentifiedDescription",disabled:!0},null,8,["value"])])]),t("div",rd,[t("div",dd,[t("div",cd,[t("div",ud,[t("input",{type:"text",class:"form-control",disabled:"",value:o.value.raisedBy},null,8,md),pd])]),t("div",vd,[t("div",hd,[t("input",{type:"text",class:"form-control",disabled:"",value:o.value.date},null,8,fd),gd])])])]),_d,i(R,{class:"task-group general-accordion py-1 px-5",modelValue:l.value,"onUpdate:modelValue":L[0]||(L[0]=$=>l.value=$)},{default:p(()=>[i(A,{title:"Repairs Completed",name:"Repairs Completed"},{default:p(()=>{var $;return[(r(!0),m(K,null,ae(JSON.parse(($=o.value)==null?void 0:$.actions),_=>(r(),m("div",{class:"p-2 d-flex",key:_},[t("div",bd,[t("div",yd,[i(Ne,{value:_,label:"Description of Repairs Completed",name:"DescriptionofRepairsCompleted",disabled:!0},null,8,["value"])])])]))),128))]}),_:1})]),_:1},8,["modelValue"])]}),_:1},8,["modelValue","custom-class"])}}}),wd=ge(Id,[["__scopeId","data-v-5d253356"]]),Pe=e=>(Ie("data-v-4314e49f"),e=e(),we(),e),kd=Pe(()=>t("span",{class:"el-dialog__title",style:{"text-align":"start"}},null,-1)),Sd={class:"ps-3"},Dd=Pe(()=>t("h3",null,"Detailed Information",-1)),Cd=Pe(()=>t("div",{class:"d-flex flex-row justify-content-between"},[t("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[t("label",{style:{}},"No")]),t("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[t("label",{style:{}},"Measurement Location")]),t("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[t("label",{style:{}},"Measurement Value")]),t("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[t("label",{style:{}},"UoM")]),t("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[t("label",{style:{}},"Rating")])],-1)),xd={class:"d-flex flex-row justify-content-between"},Ld={class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},Rd={style:{}},Fd={class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},$d=["innerHTML"],Pd={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Td={class:"col-1 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Ad={style:{}},Nd={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},Ed=Pe(()=>t("h3",{class:"mt-3"},"Detail Spec",-1)),Vd={class:"table table-bordered",style:{width:"500px"}},Od=Pe(()=>t("thead",null,[t("tr",{style:{background:"#70AD47"}},[t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),t("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Hd={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},Ud={scope:"row",style:{"border-right":"1px solid white"}},qd={scope:"row",style:{"border-right":"1px solid white"}},Md={scope:"row"},Bd={key:0,class:"mt-3"},zd={key:1,class:"table table-bordered",style:{width:"500px"}},jd=Pe(()=>t("thead",null,[t("tr",{style:{background:"#70AD47"}},[t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),t("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),t("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Gd={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},Yd={scope:"row",style:{"border-right":"1px solid white"}},Kd={scope:"row",style:{"border-right":"1px solid white"}},Jd={scope:"row"},Wd=Pe(()=>t("h3",{class:"mt-3"},"Detailed picture",-1)),Xd={class:"row my-4"},Qd={class:"bg-secondary"},Zd=["src","onClick"],ec=oe({__name:"CBMInfo",props:{visibility:{required:!0,type:Boolean},cbmData:{required:!0,type:Object},equipmentModel:{required:!0,default:""},psType:{required:!0,default:""}},emits:["closeForm"],setup(e,{emit:a}){const n=e,s=a,l=Fe(),c=he(n,"visibility"),o=he(n,"cbmData"),h=D([]),v=D(!1),x=D([]),b=D([]),f=D(),k=D([]),u=D(""),L=D(!1),A=D([]),R=async()=>{if(!(x.value.length<1))for(const[d,N]of x.value.entries()){const H={fileUrl:`${N.filename}`,ver:"v1"};try{const B=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(H).toString()}`,F=await X.getBlob(B),ie=F.data,se=new Blob([ie]),re=(window.URL||window.webkitURL).createObjectURL(se);A.value.push({key:N.filename,value:re}),b.value[d]={...b.value[d],imgBlob:F.blob,url:I(b.value[d].filename)},k.value[d]=!1}catch(B){console.log("image",B)}}},q=()=>{s("closeForm")},z=P(()=>{var d;return(d=o.value)!=null&&d.taskNo?o.value.taskNo.replace(/[^a-z]/gi,"").length>1?o.value.taskNo.replace(";","").replace(/\D/g,""):o.value.taskNo.replace(";",""):""}),$=P(()=>{if(!h.value)return[];const d=h.value.filter(N=>N.cbmType!="CBM_GAP");return Re.orderBy(d,["uom","cbmRating","minValue"])}),_=P(()=>{if(!h.value)return[];const d=h.value.filter(N=>N.cbmType=="CBM_GAP");return Re.orderBy(d,["uom","cbmRating","minValue"])}),T=async()=>{v.value=!0;const d=await En.cbmMapping.where({model:n.equipmentModel,psType:n.psType}).first(),N=d==null?void 0:d.detail.filter(F=>F.taskKey==o.value.taskId);N&&(h.value=N),x.value=[];const H=await l.getDefectImages(o.value.interventionId,o.value.taskId,o.value.cbmImageProp);x.value=It(H),A.value=[],k.value=Array.apply(null,Array(x.value.length)).map(function(){return!0}),b.value=It(x.value);const B=x.value.length;for(let F=0;F<B;F++){const ie=b.value[F].filename;await Y(ie,F)}await R(),v.value=!1},Y=async(d,N)=>{const H={fileUrl:d,ver:"v1"};try{const B=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(H).toString()}`,ie=(await X.getBlob(B)).data,se=new Blob([ie]),W={};W.filename=d,W.blob=se,W.type="cbm";const re={};re.image=W,re.index=N,re.length=x.value.length,window.setTimeout(async()=>{let j=window.URL||window.webkitURL;A.value.push({key:d,value:j.createObjectURL(se)}),k.value[N]=!1},1e3)}catch(B){console.log("image",B)}},I=d=>{const N=A.value.find(H=>H.key==d);return(N==null?void 0:N.value)??""},U=d=>{const N=b.value.findIndex(B=>B.filename==d),H=b.value[N];if(N>0){const B=b.value.slice(N),F=b.value.slice(0,N);f.value=[...B,...F]}else f.value=b.value;u.value=H.url,L.value=!0},E=()=>{u.value="",L.value=!1};return(d,N)=>{const H=O("el-input"),B=O("el-skeleton-item"),F=O("el-skeleton"),ie=O("el-dialog"),se=ve("loading");return r(),m(K,null,[i(ie,{modelValue:c.value,"onUpdate:modelValue":N[2]||(N[2]=W=>c.value=W),"custom-class":"crackform dialog-header-noborder e-form-font-family",width:"90%",center:"",onClosed:q,onOpened:T,"destroy-on-close":!0},{title:p(()=>[kd]),default:p(()=>{var W,re,j;return[t("div",null,[te((r(),m("div",Sd,[Dd,Cd,t("div",xd,[t("div",Ld,[t("label",Rd,S(z.value),1)]),t("div",Fd,[t("label",{style:{},innerHTML:o.value.taskDesc.split(";").length>3?(W=o.value.taskDesc)==null?void 0:W.split(";")[2]:o.value.taskDesc},null,8,$d)]),t("div",Pd,[i(H,{class:"dark-text-primary",size:"small",modelValue:o.value.cbmMeasurement,"onUpdate:modelValue":N[0]||(N[0]=J=>o.value.cbmMeasurement=J),disabled:!0},null,8,["modelValue"])]),t("div",Td,[t("label",Ad,S(((re=h.value[0])==null?void 0:re.uom)||((j=o.value)==null?void 0:j.cbmUom)),1)]),t("div",Nd,[i(H,{size:"small",class:ue(["dark-text-primary",o.value.taskValue==="C"?"c":"x"]),modelValue:o.value.taskValue,"onUpdate:modelValue":N[1]||(N[1]=J=>o.value.taskValue=J),disabled:!0},null,8,["modelValue","class"])])]),Ed,t("table",Vd,[Od,t("tbody",null,[(r(!0),m(K,null,ae($.value,(J,ee)=>(r(),m("tr",{key:ee,class:ue(ee%2==0?"even":"odd")},[t("th",Hd,S(J.cbmRating),1),t("th",Ud,S(J.minValue),1),t("th",qd,S(J.maxValue),1),t("th",Md,S(J.uom),1)],2))),128))])]),_.value.length>0?(r(),m("h3",Bd,"Detail Spec Gap")):V("",!0),_.value.length>0?(r(),m("table",zd,[jd,t("tbody",null,[(r(!0),m(K,null,ae(_.value,(J,ee)=>(r(),m("tr",{key:ee,class:ue(ee%2==0?"even":"odd")},[t("th",Gd,S(J.cbmRating),1),t("th",Yd,S(J.minValue),1),t("th",Kd,S(J.maxValue),1),t("th",Jd,S(J.uom),1)],2))),128))])])):V("",!0),Wd,t("div",Xd,[(r(!0),m(K,null,ae(b.value,(J,ee)=>(r(),m("div",{key:J.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[i(F,{loading:k.value[ee],animated:""},{template:p(()=>[i(B,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:p(()=>[t("div",Qd,[t("img",{src:J.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:be=>U(J.filename),alt:"images"},null,8,Zd)])]),_:2},1032,["loading"])]))),128))])])),[[se,v.value]])])]}),_:1},8,["modelValue"]),i(tn,{images:b.value,visibility:L.value,image:u.value,onHandleClose:E},null,8,["images","visibility","image"])],64)}}}),tc=ge(ec,[["__scopeId","data-v-4314e49f"]]),nc=oe({__name:"SubmitButton",props:{formIntervention:{type:Object,required:!0},isLoading:{type:Boolean,required:!1,default:!1},selectedHeader:{type:String,required:!1}},emits:["clicked"],setup(e,{emit:a}){const n=e,s=a,l=()=>{s("clicked")};return(c,o)=>{const h=O("el-button"),v=ve("loading");return e.formIntervention.interventionHeaderId==0||e.formIntervention.interventionHeaderId==null?te((r(),G(h,{key:0,id:"submit-button",type:"success",disabled:e.formIntervention.interventionExecutionId>4,onClick:l,"element-loading-background":"#2d2b39b3"},{default:p(()=>[le(" Submit ")]),_:1},8,["disabled"])),[[v,n.isLoading]]):(r(),G(h,{key:1,id:"revise-button",type:"success",disabled:e.formIntervention.interventionExecutionId>4||!e.formIntervention.userRevise||e.formIntervention.interventionStatus=="Declined"&&n.selectedHeader=="Declined",onClick:l},{default:p(()=>[le(" Revise ")]),_:1},8,["disabled"]))}}}),ac=e=>(Ie("data-v-6f2c7039"),e=e(),we(),e),sc={class:"list-group ps-0 mt-5 mb-3"},oc={key:0,class:"d-flex flex-column"},ic={class:"d-flex my-2 align-items-center"},lc={style:{width:"100%"},class:"d-flex my-2 align-items-center"},rc=ac(()=>t("em",{class:"fa fa-search me-1 ms-3"},null,-1)),dc={class:"d-flex justify-content-between"},cc={class:"label ms-5 intervention-label"},uc={class:"label item__timestamp"},mc={key:0},pc={"element-loading-background":"#2d2b39b3"},vc=["onClick"],hc={class:"d-flex flex-column w-100"},fc={class:"d-flex justify-content-between"},gc={class:"label ms-5 intervention-label"},_c={class:"label item__timestamp"},bc={key:1,class:"d-flex justify-content-center mt-8"},yc={key:0,style:{color:"#FFFF"}},Ic={key:1,"element-loading-background":"#2d2b39b3"},wc={key:1,class:"d-flex flex-column"},kc={class:"pb-2"},Sc={class:"item d-flex flex-fill my-2 align-items-center"},Dc={class:"d-flex flex-column w-100"},Cc={class:"d-flex justify-content-between"},xc={class:"label ms-5 intervention-label"},Lc={class:"label item__timestamp"},Rc=oe({__name:"ListGroup",props:{dataList:{required:!0,type:Object},loading:{required:!0,type:Boolean}},emits:["onItemClick","onBackToList"],setup(e,{emit:a}){const n=ye(),s=fe(),l=e,c=a,o=D(!1),h=D(null),v=D(""),x=P(()=>n.pagination),b=D("custom-pagination"),f=P({get(){return n.isSelectedItem},set(I){n.setIsSelectedItem(I)}}),k=P(()=>n.selectedHeaderItem),u=P(()=>n.searchOption.length==0&&v.value),L=P({get(){return n.searchOption},set(I){n.stateSearchOptions=I}});Ee(()=>l.dataList,I=>{f.value=!1});const A=I=>{n.setPage(I)},R=I=>On(I,"YYYY-MM-DD HH:mm:ss","DD.MM.YYYY"),q=I=>{s.setIsFromEquipment(!1),f.value=!0,c("onItemClick",I)},z=I=>{s.setIsFromEquipment(!1),f.value=!0,L.value=[],c("onItemClick",I)},$=async I=>{I?(o.value=!0,await n.searchItems(I),o.value=!1,v.value=I):(v.value="",L.value=[])},_=()=>{f.value=!1,h.value=null,L.value=[],c("onBackToList")},T=async()=>{v.value="",setTimeout(()=>{L.value=[]},300)},Y=(I="")=>{const U=I?I.toLowerCase():"";return U.includes("normal")?"text-normal-inv":U.includes("caution")?"yellow":"text-critical"};return(I,U)=>{const E=O("el-option"),d=O("el-select"),N=O("inline-svg"),H=O("el-button"),B=ve("loading");return r(),m("div",sc,[f.value?(r(),m("div",wc,[t("div",kc,[i(H,{text:"",class:"dark-btn",onClick:_},{default:p(()=>[i(N,{src:"/media/icons/bootstrap-icon/arrow-left-short.svg",width:"36",height:"36",fill:"white"}),le(" Item selected ")]),_:1})]),t("div",Sc,[t("div",Dc,[t("div",Cc,[t("div",null,[t("span",xc,[le(S(k.value.equipmentNumber)+" - "+S(k.value.brand)+" "+S(k.value.model)+" - ",1),t("span",{class:ue(Y(k.value.interventionCode))},S(k.value.interventionCode)+" "+S(k.value.componentGroup?` - ${k.value.componentGroup}`:""),3),le(" "+S(k.value.workOrder?` - ${k.value.workOrder}`:""),1)])]),t("div",null,[t("span",Lc,S(k.value.interventionDate?R(k.value.interventionDate):""),1)])])])])])):(r(),m("div",oc,[e.dataList.length>0?(r(),m(K,{key:0},[t("div",ic,[t("div",lc,[i(d,{style:{width:"100%"},filterable:"",remote:"","reserve-keyword":"",modelValue:h.value,"onUpdate:modelValue":U[0]||(U[0]=F=>h.value=F),placeholder:"Search component intervention forms","remote-method":$,loading:o.value,onChange:z,persistent:!1,onBlur:T,size:"large"},{prefix:p(()=>[rc]),default:p(()=>[(r(!0),m(K,null,ae(L.value,F=>(r(),G(E,{key:F.workOrder,value:F},{default:p(()=>[t("div",dc,[t("span",cc,[le(S(F.equipmentNumber)+" - "+S(F.brand)+" "+S(F.model)+" - ",1),t("span",{class:ue(Y(F.interventionCode))},S(F.interventionCode)+" "+S(F.componentGroup?` - ${F.componentGroup}`:""),3),le(" "+S(F.workOrder?` - ${F.workOrder}`:""),1)]),t("span",uc,S(F.interventionDate?R(F.interventionDate):""),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading"])])]),L.value.length==0&&!u.value&&!f.value?(r(),m("div",mc,[te((r(),m("div",pc,[(r(!0),m(K,null,ae(e.dataList,F=>(r(),m("div",{key:F.workOrder,class:"item d-flex flex-fill my-2 align-items-center",onClick:ie=>q(F)},[t("div",hc,[t("div",fc,[t("div",null,[t("span",gc,[le(S(F.equipmentNumber)+" - "+S(F.brand)+" "+S(F.model)+" - ",1),t("span",{class:ue(Y(F.interventionCode))},S(F.interventionCode)+" "+S(F.componentGroup?` - ${F.componentGroup}`:""),3),le(" "+S(F.workOrder?` - ${F.workOrder}`:""),1)])])])]),t("div",null,[t("span",_c,S(F.interventionDate?R(F.interventionDate):""),1)])],8,vc))),128))])),[[B,e.loading]]),e.dataList.length>0?(r(),G(Qn,{key:0,customClassPagination:"custom-pagination",onRaisePageChange:U[1]||(U[1]=F=>A(F)),"class-custom":b.value,currentPage:x.value.currentPage,totalPage:x.value.totalPage,totalPageSize:x.value.totalPageSize,startPaginationIndex:x.value.startPaginationIndex,endPaginationIndex:x.value.endPaginationIndex},null,8,["class-custom","currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):V("",!0)])):V("",!0)],64)):(r(),m("div",bc,[e.loading?te((r(),m("div",Ic,null,512)),[[B,e.loading]]):(r(),m("h5",yc,"No Data Display"))]))]))])}}}),Fc=ge(Rc,[["__scopeId","data-v-6f2c7039"]]),$c={class:"row grouping-by-status"},Pc={class:"col-10"},Tc={key:0,style:{"font-size":"12px"},class:"text-white vertical-line"},Ac={key:1,style:{"font-size":"12px"},class:"text-white"},Nc={class:"col-2 d-flex justify-content-between align-items-center"},Ec=t("div",null,null,-1),Vc={key:0},Oc=oe({__name:"HeaderMenu",emits:["onBackToList"],setup(e,{emit:a}){const n=a,{instance:s}=ea(),l=ye(),c=fe(),o=P(()=>l.headerList),h=P(()=>l.headerListItems),v=P(()=>l.selectedHeader),x=P(()=>l.loadingHeader),b=P({get(){return l.isSelectedItem},set(q){l.setIsSelectedItem(q)}}),f=D("fa-chevron-down"),k=D(!1);wt(async()=>{await Zn(s),await l.setHeaderDeclined("Declined",1,!0),v.value=="Pending Evaluation"&&await l.setHeaderChange("Pending Evaluation")});const u=async q=>{b.value=!1,l.resetAllList(),c.resetFormIntervention(),l.setSelectedHeader(q),q==="Declined"?await l.setHeaderDeclined(q,1):await l.setPage(1)},L=async q=>{l.setSelectedHeaderItem(q),c.resetGeneric(),await c.getDataFromKeyPbi(q.keyPbi)},A=async()=>{l.resetAllList(),c.resetFormIntervention(),c.resetGeneric(!0),n("onBackToList")},R=()=>{k.value=!k.value,k.value?f.value="fa-chevron-up":f.value="fa-chevron-down"};return(q,z)=>{const $=O("el-menu-item"),_=O("el-menu");return r(),m(K,null,[t("div",$c,[t("div",Pc,[i(_,{"default-active":v.value,class:"el-menu-demo d-flex flex-wrap",mode:"horizontal","background-color":"#2D2B39","text-color":"#fff","active-text-color":"#18AF4A",onSelect:u},{default:p(()=>[(r(!0),m(K,null,ae(o.value,T=>(r(),G($,{key:T,index:T.label},{default:p(()=>[T.label==="Declined"?(r(),m("span",Tc,S(T.label)+" ("+S(T.total)+")",1)):(r(),m("span",Ac,S(T.label)+" ("+S(T.total)+")",1))]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),t("div",Nc,[Ec,t("em",{class:ue(["fa",f.value]),style:{color:"white","font-size":"1.2em",cursor:"pointer"},onClick:R},null,2)])]),k.value?V("",!0):(r(),m("div",Vc,[i(Fc,{loading:x.value,dataList:h.value,onOnItemClick:L,onOnBackToList:A},null,8,["loading","dataList"])]))],64)}}}),Hc={class:"d-flex justify-content-end"},Uc={key:0},qc={class:"dialog-footer"},Mc=oe({__name:"FormDeclineReason",props:{visibility:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},declinerName:{type:String,required:!1,default:""},declinerDate:{type:String,required:!1,default:""}},emits:["handle-close","handle-submit"],setup(e,{emit:a}){const n=e,s=a,l=fe(),c=he(n,"visibility"),o=P(()=>l.formIntervention),h=D([]),v=D(!1),x=ct().shape({declineReason:me().required("Decline Reason is mandatory").nullable()}),b=()=>{u(),s("handle-close")},f=L=>{o.value.declineReason=L},k=async()=>{v.value=!1,u(),await x.validate(o.value,{abortEarly:!1}).catch(L=>{v.value=!0,h.value=L.errors}),!v.value&&s("handle-submit")},u=()=>{v.value=!1,h.value=[]};return(L,A)=>{const R=O("el-button"),q=O("el-dialog"),z=ve("loading");return te((r(),G(q,{modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=$=>c.value=$),title:"Reason for Declining Intervention",width:"40%",onClose:A[1]||(A[1]=$=>b()),class:"dialog-word_break"},kt({default:p(()=>[te((r(),m("div",null,[i(Ve,{name:"fade"},{default:p(()=>[v.value?(r(),G(Oe,{key:0,errorMessages:h.value,onResetForm:u},null,8,["errorMessages"])):V("",!0)]),_:1}),i(y(dt),{id:"kt_filter_form",class:"row"},{default:p(()=>[i(Ce,{class:"textarea-custom",value:o.value.declineReason,placeholder:"Write reason here",label:"Decline Reason",name:"DeclineReason",required:"",max:1500,textInputType:"textarea",readonly:!n.isEdit,onHandleChange:f},null,8,["value","readonly"]),t("div",Hc,[n.isEdit?V("",!0):(r(),m("span",Uc,S(n.declinerName)+", "+S(y(ot)(n.declinerDate)),1))])]),_:1})])),[[z,y(l).loading]])]),_:2},[n.isEdit?{name:"footer",fn:p(()=>[t("span",qc,[i(R,{disabled:y(l).loading,type:"secondary",onClick:b},{default:p(()=>[le("Cancel")]),_:1},8,["disabled"]),i(R,{disabled:y(l).loading,type:"primary",onClick:k},{default:p(()=>[le("Submit")]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["modelValue"])),[[z,y(l).loading]])}}}),Bc=ge(Mc,[["__scopeId","data-v-2fee69f7"]]),zc={class:"d-flex justify-content-end"},jc=oe({__name:"FormApproveReason",props:{visibility:{type:Boolean,default:!1},approverName:{type:String,required:!1,default:""},approverDate:{type:String,required:!1,default:""}},emits:["handle-close"],setup(e,{emit:a}){const n=e,s=a,l=fe(),c=he(n,"visibility"),o=P(()=>l.formIntervention),h=D([]),v=D(!1),x=()=>{b(),s("handle-close")},b=()=>{v.value=!1,h.value=[]};return(f,k)=>{const u=O("el-dialog"),L=ve("loading");return te((r(),G(u,{modelValue:c.value,"onUpdate:modelValue":k[0]||(k[0]=A=>c.value=A),title:"Reason for Revising Intervention",width:"40%",onClose:k[1]||(k[1]=A=>x()),class:"dialog-word_break"},{default:p(()=>[te((r(),m("div",null,[i(y(dt),{id:"kt_filter_form",class:"row"},{default:p(()=>[i(Ce,{class:"textarea-custom",value:o.value.approveReason,placeholder:"Write reason here",label:"Approve Reason",name:"ApproveReason",required:"",textInputType:"textarea",readonly:""},null,8,["value"]),t("div",zc,[t("span",null,S(n.approverName)+", "+S(y(ot)(n.approverDate)),1)])]),_:1})])),[[L,y(l).loading]])]),_:1},8,["modelValue"])),[[L,y(l).loading]])}}}),Gc=ge(jc,[["__scopeId","data-v-1f872e67"]]),Yc={class:"dialog-footer"},Kc=oe({__name:"FormReviseReason",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close","handle-submit"],setup(e,{emit:a}){const n=e,s=a,l=fe(),c=he(n,"visibility"),o=P(()=>l.formIntervention),h=D([]),v=D(!1),x=ct().shape({reviseReason:me().required("Revise Reason is mandatory").nullable()}),b=()=>{u(),s("handle-close")},f=L=>{o.value.reviseReason=L},k=async()=>{v.value=!1,u(),await x.validate(o.value,{abortEarly:!1}).catch(L=>{v.value=!0,h.value=L.errors}),!v.value&&s("handle-submit")},u=()=>{v.value=!1,h.value=[]};return(L,A)=>{const R=O("el-button"),q=O("el-dialog"),z=ve("loading");return te((r(),G(q,{modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=$=>c.value=$),title:"Reason for Revising Intervention",width:"40%",onClose:A[1]||(A[1]=$=>b()),class:"dialog-word_break"},{footer:p(()=>[t("span",Yc,[i(R,{disabled:y(l).loading,type:"secondary",onClick:b},{default:p(()=>[le("Cancel")]),_:1},8,["disabled"]),i(R,{disabled:y(l).loading,type:"primary",onClick:k},{default:p(()=>[le("Submit")]),_:1},8,["disabled"])])]),default:p(()=>[te((r(),m("div",null,[i(Ve,{name:"fade"},{default:p(()=>[v.value?(r(),G(Oe,{key:0,errorMessages:h.value,onResetForm:u},null,8,["errorMessages"])):V("",!0)]),_:1}),i(y(dt),{id:"kt_filter_form",class:"row"},{default:p(()=>[i(Ce,{class:"textarea-custom",value:o.value.reviseReason,placeholder:"Write reason here",label:"Revise Reason",name:"ReviseReason",required:"",max:1500,textInputType:"textarea",onHandleChange:f},null,8,["value"])]),_:1})])),[[z,y(l).loading]])]),_:1},8,["modelValue"])),[[z,y(l).loading]])}}}),Jc=ge(Kc,[["__scopeId","data-v-34e3b231"]]),Wc=e=>(Ie("data-v-0f936a89"),e=e(),we(),e),Xc=Wc(()=>t("div",{class:"my-3 word_break"}," Do you want to add another sensor parameter critically in the current Intervention Form: ",-1)),Qc=["onUpdate:modelValue"],Zc=["innerHTML"],eu={class:"dialog-footer"},tu=oe({__name:"AdditionalSensorDataDialog",props:{visibility:{type:Boolean,default:!1}},setup(e){const a=e,n=fe(),s=he(a,"visibility"),l=P(()=>n.formIntervention),c=D([]),o=D(!1),h=P(()=>n.listAdditionalSensorData),v=f=>f.replace(/CRITICAL/gi,'<span class="text-critical">CRITICAL</span>').replace(/CAUTION/gi,'<span class="text-caution">CAUTION</span>').replace(/NORMAL/gi,'<span class="text-normal-inv">NORMAL</span>'),x=async f=>{b();const k=await n.postAdditionalSensorData(f);k.isError?(o.value=!0,c.value.push(k.message)):(n.setIsAdditionalSensorExist(!1),await n.getDataFromKeyPbi(l.value.keyPbi))},b=()=>{o.value=!1,c.value=[]};return(f,k)=>{const u=O("el-button"),L=O("el-dialog"),A=ve("loading");return te((r(),G(L,{modelValue:s.value,"onUpdate:modelValue":k[2]||(k[2]=R=>s.value=R),title:"Additional Sensor Data","show-close":!1,width:"40%","lock-scroll":""},{footer:p(()=>[t("span",eu,[i(u,{type:"secondary",onClick:k[0]||(k[0]=R=>x(!1))},{default:p(()=>[le("No")]),_:1}),i(u,{disabled:y(n).loading,type:"primary",onClick:k[1]||(k[1]=R=>x(!0))},{default:p(()=>[le("Add & Revise Intervention Form")]),_:1},8,["disabled"])])]),default:p(()=>[te((r(),m("div",null,[i(Ve,{name:"fade"},{default:p(()=>[o.value?(r(),G(Oe,{key:0,errorMessages:c.value,onResetForm:b},null,8,["errorMessages"])):V("",!0)]),_:1}),Xc,(r(!0),m(K,null,ae(h.value,R=>(r(),m("div",{key:R.id,class:"mb-2 ms-2"},[te(t("input",{type:"checkbox","onUpdate:modelValue":q=>R.isCheck=q,class:"me-3"},null,8,Qc),[[$n,R.isCheck]]),t("span",{innerHTML:v(R.interventionReason)},null,8,Zc)]))),128))])),[[A,y(n).loading]])]),_:1},8,["modelValue"])),[[A,y(n).loading]])}}}),nu=ge(tu,[["__scopeId","data-v-0f936a89"]]),au={class:"my-5"},su=oe({__name:"ConditionRatingDateDialog",props:{visibility:{type:Boolean,default:!1},dates:{type:Array}},emits:["handle-close","handle-submit"],setup(e,{emit:a}){const n=e,s=a,l=fe(),c=he(n,"visibility"),o=()=>{s("handle-close")};return(h,v)=>{const x=O("el-dialog"),b=ve("loading");return te((r(),G(x,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=f=>c.value=f),title:"Condition Rating Date",width:"40%",onClose:v[1]||(v[1]=f=>o()),class:"dialog-word_break"},{default:p(()=>[te((r(),m("div",au,[t("ul",null,[(r(!0),m(K,null,ae(n.dates,(f,k)=>(r(),m("li",{key:k,class:"my-2"},S(f),1))),128))])])),[[b,y(l).loading]])]),_:1},8,["modelValue"])),[[b,y(l).loading]])}}}),ke=[{name:"site",sessionStorageName:"IronPortalDashboardFilter-Site"},{name:"equipmentModel",sessionStorageName:"IronPortalDashboardFilter-Model"},{name:"equipmentNumber",sessionStorageName:"IronPortalDashboardFilter-Equipment"},{name:"componentDescription",sessionStorageName:"IronPortalDashboardFilter-Component"}],_e=e=>(Ie("data-v-00e82247"),e=e(),we(),e),ou={class:"section-header"},iu={class:"section iron_portal-intervention","element-loading-background":"#2d2b39b3"},lu=_e(()=>t("div",{id:"error-site",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Site is mandatory")],-1)),ru=_e(()=>t("div",{id:"error-model",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Model is mandatory")],-1)),du=_e(()=>t("div",{id:"error-equipment",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Equipment is mandatory")],-1)),cu=_e(()=>t("label",{class:ue("form-label fs-6 fw-bolder text-white"),for:"componentAffected"},"Component Affected",-1)),uu={key:0,class:"ms-auto"},mu={key:1,class:"ms-auto"},pu={key:0,class:"mb-2 d-flex justify-content-end text-white"},vu={key:1,class:"mb-2 d-flex justify-content-end text-white"},hu=_e(()=>t("div",{id:"error-follow-up-priority",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Follow Up Priority is mandatory")],-1)),fu=_e(()=>t("div",{id:"error-intervention-description",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Intervention Description is mandatory")],-1)),gu={key:0,class:"ms-auto"},_u=_e(()=>t("div",{id:"error-condition-rating-date",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null," Condition Rating Date is mandatory ")],-1)),bu=_e(()=>t("div",{id:"error-estimation-completion-date",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"Estimation Completion Date is mandatory")],-1)),yu=_e(()=>t("div",{id:"error-work-order",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[t("span",null,"SAP Work Order is mandatory")],-1)),Iu={class:"section"},wu=_e(()=>t("h3",{class:"text-white mb-5"},"Intervention Checks",-1)),ku={class:"section"},Su=_e(()=>t("h3",{class:"text-white mb-5"},"Additional Tasks",-1)),Du={class:"section"},Cu=_e(()=>t("h3",{class:"text-white mb-5"},"Additional Information",-1)),xu={class:"text-white text-medium"},Lu={class:"section"},Ru=_e(()=>t("h3",{class:"text-white mb-5"},"Generic Defect",-1)),Fu={style:{margin:"20px 50px"}},$u={id:"submit-button-container",class:"d-flex justify-content-end"},Pu=oe({__name:"Index",setup(e){const a=ce(),n=ut(),s=mt(),l=Xn(),c=Fe(),o=fe(),h=ye(),v=Yn(),x=D(!1),b=D(""),f=D(!1),k=D(!1),u=D(!1),L=D(!1),A=D(!1),R=D(""),q=D(!1),z=D(!1),$=D(""),_=D(""),T=D(),Y=D(),I=D(),U=P({get(){return h.reRenderSelection},set(w){h.setReRenderSelection(w)}}),E=P({get(){return h.reRenderComponentList},set(w){h.setReRenderComponentList(w)}}),d=P(()=>o.formIntervention),N=P(()=>o.formFilter),H=P(()=>o.formCbmHeaderVisibility),B=P(()=>o.headerCbm),F=P(()=>o.psTypeCbm),ie=P(()=>c.ApprovalData.DefectGenericHeaders),se=P(()=>c.ApprovalData.DefectGenericDetails),W=P(()=>a.user.EmployeeId),re=D(null);Ee(W,async()=>{await Ht()},{deep:!0});const j=P(()=>o.formLoading),J=P(()=>o.errors),ee=P(()=>o.isError),be=P(()=>h.interventionCheckList.filter(w=>!w.isDeleted&&w.isActive)),Te=P(()=>h.additionalTaskList),g=P(()=>h.componentList),pe=P(()=>n.ViewYesVisible),Ke=P(()=>n.ViewNoVisible),Je=P(()=>s.ViewVisible),We=P(()=>d.value.showConditionRatingDate?d.value.showConditionRatingDate.split(";"):[]),Rt=P(()=>o.isAdditionalSensorExist),on=P(()=>d.value.statusIP.name&&d.value.statusIF.name?"255":d.value.statusIP.name&&!d.value.statusIF.name?"225":"200"),Ue=P({get(){return h.isSelectedItem},set(w){h.setIsSelectedItem(w),E.value=!0}}),Ft=P(()=>h.selectedHeader),ln=ct().shape({site:me().required("site"),equipmentModel:me().required("model"),equipmentNumber:me().required("equipment"),conditionRatingDate:me().required("Condition Rating Date"),interventionStatus:me().required("intervention-status"),followUpPriority:me().when("interventionStatus",{is:"Accepted",then:me().required("follow-up-priority")}),interventionDiagnostic:me().when("interventionStatus",{is:"Accepted",then:me().required("intervention-description")}),workOrder:me().when("interventionStatus",{is:"Accepted",then:me().required("work-order")})}),$t=w=>{const C=l.Ownership.find(M=>M.equipmentNumber==w);$.value=(C==null?void 0:C.ownership)??"",_.value=(C==null?void 0:C.serialNumber)??""},qe=async()=>{if(N.value.keyPbi!=""){const w={keyPbi:N.value.keyPbi};o.setFormFilter(w),h.setFilter(w),await o.getDataFromKeyPbi(N.value.keyPbi),f.value=!1,A.value=!1,$t(d.value.equipment),tt.value=""}},Xe=P(()=>d.value.site==""),Pt=P(()=>d.value.equipmentModel==""),Me=Re.debounce((w=!1)=>{o.getSiteLookup(w)},300),Qe=Re.debounce((w=!1)=>{o.getEquipmentModelLookup(w)},300),Ze=Re.debounce(()=>{o.getEquipmentNumberLookup()},300),rn=w=>{d.value.site=w,xe(),et(),Ue.value=!1,ze(ke[0]),w==""&&(Me(),Tt("")),Me(),Qe(),Ze()},Tt=async w=>{d.value.equipmentModel=w,xe(),et(),Ue.value=!1,ze(ke[1]),w==""?At(""):w!=""&&Xe.value&&await o.getSiteLookup(Xe.value),Me(),Qe(),Ze()},At=async w=>{d.value.equipmentNumber=w,xe(),et(),Ue.value=!1,ze(ke[2]),w!=""&&(Xe.value&&await o.getSiteLookup(Xe.value),Pt.value&&await o.getEquipmentModelLookup(Pt.value),o.getConditionRatingDateLookup()),Me(),Qe(),Ze(),Nt("")},Nt=async w=>{xe(),Ue.value=!1,w==""?(et(),d.value.conditionRatingDate="",d.value.componentHours="",d.value.interventionReason="",d.value.conditionRatingSmu="",d.value.interventionCodeId=""):(d.value.conditionRatingDate=o.conditionRatingDateOption[w].conditionRatingDate,o.setFormFilter({keyPbi:o.conditionRatingDateOption[w].keyPbi}),await qe(),je(d.value.interventionStatus=="Accepted"))},et=()=>{h.resetAllList(),o.resetFormIntervention(),o.resetGeneric(!0),Et()},Et=()=>{let w=document.getElementsByClassName("error-label");if(w)for(let C=0;C<w.length;C++)w[C].classList.add("is-hidden");if(w=document.getElementsByClassName("is-input-error"),w)for(let C=0;C<w.length;C++)w[C].classList.remove("is-input-error")},Be=w=>{let C=document.getElementById(`error-${w}`);C&&C.classList.add("is-hidden"),C=document.getElementById(w).getElementsByClassName("el-form-item__content")[0],C&&C.classList.remove("is-input-error")},tt=D(""),dn=async w=>{if(Be("intervention-status"),d.value.interventionStatus=w,h.setReRenderSelection(!1),Et(),w=="Accepted")tt.value=d.value.declineReason,d.value.declineReason="",R.value="",await o.getFollowUpPriorityLookup();else if(w=="Declined"){d.value.declineReason=tt.value,tt.value="",await Vt(""),o.resetInterventionWhenStatusIsDeclined();const C=document.getElementById("submit-button-container");Ft.value=="Declined"&&await h.getComponentList(),An(()=>{C==null||C.scrollIntoView()})}h.setReRenderSelection(!0)},cn=w=>{Be("intervention-description"),d.value.interventionDiagnostic=w},Vt=async w=>{Be("follow-up-priority"),d.value.followUpPriority=w,w==""?d.value.estimationCompletionDate="":await o.getEstimationCompletionDate()},un=async w=>{xe(),Be("estimation-completion-date"),d.value.estimationCompletionDate=w},mn=w=>{Be("work-order"),d.value.workOrder=w},pn=async()=>{f.value=!1,k.value=!1,u.value=!1,Wt("Are you sure you want to submit?").then(async w=>{w.isConfirmed&&(U.value=!1,E.value=!1,o.updateData(a.user.Name,W.value).then(async()=>{o.isError?(o.setIsError(!1),Vn(J.value[0],"Ok")):vt("Form has been successfully submitted!","Ok").then(async()=>{o.isFromEquipment?(v.push("/ironportal-dashboard/equipment"),o.setIsFromEquipment(!1)):(await qe(),je(d.value.interventionStatus=="Accepted"))})}),U.value=!0,E.value=!0)})},vn=async()=>{xe(),await ln.validate(d.value,{abortEarly:!1}).catch(w=>{o.setIsError(!0),w.errors.forEach(C=>{let M=document.getElementById(`error-${C}`);M&&M.classList.remove("is-hidden"),M=document.getElementById(C).getElementsByClassName("el-form-item__content")[0],M&&M.classList.add("is-input-error")}),setTimeout(()=>{const C=document.getElementById(w.errors[0]);C&&C.scrollIntoView({behavior:"smooth",block:"center"})},100)}),!ee.value&&(d.value.interventionStatus=="Accepted"&&!d.value.interventionHeaderId?await pn():d.value.interventionStatus=="Accepted"?u.value=!0:(d.value.declineReason&&d.value.interventionHeaderId&&(R.value=d.value.declineReason),f.value=!0))},hn=async()=>{await o.updateData(a.user.Name,W.value).then(async()=>{f.value=!1,o.isError||vt("Form has been successfully submitted!","Ok").then(async()=>{await qe(),je(d.value.interventionStatus=="Accepted")})}).catch(async w=>{console.log(w)}),U.value=!0,E.value=!0},fn=async()=>{await o.updateData(a.user.Name,W.value).then(async()=>{u.value=!1,o.isError||vt("Form has been successfully submitted!","Ok").then(async()=>{await qe(),je(d.value.interventionStatus=="Accepted")})}).catch(async w=>{console.log(w)}),U.value=!0,E.value=!0},gn=()=>{R.value=d.value.declineReason,A.value=!0,f.value=!0},_n=()=>{A.value=!0,k.value=!0},bn=()=>{L.value=!0},xe=()=>{o.setErrors([]),h.setErrors([])},pt=w=>{b.value=w},yn=()=>{o.setFormCbmHeaderVisibility(!1),o.setPsTypeCbm("")},Ot=async w=>{const C={employeeId:w,page:"1",pageSize:"1",ver:"v1"};try{return(await X.get(Jn,"",new URLSearchParams(C).toString())).data.result.content[0].Location}catch(M){console.log(M)}return""},Le=P(()=>d.value.interventionStatus=="Declined"||d.value.interventionExecutionId>4),Ht=async(w="")=>{if(W.value){w&&w!="AU02"&&(x.value=!0);const C=In(ke[0].sessionStorageName),M=a.user.Location=="Head Office"?"Blackwater":a.user.Location,de=C||M;d.value.site=de,sessionStorage.setItem(ke[0].sessionStorageName,JSON.stringify([de]))}else d.value.site="Blackwater",d.value.equipmentModel="930E-4 HPI";for(let C=1;C<ke.length;C++){const M=ke[C],de=JSON.parse(sessionStorage.getItem(M.sessionStorageName)),Ae=de!=null&&de.length>0?de[0]:d.value[M.name];Ae&&(M.name=="equipmentModel"?d.value.equipmentModel=Ae:M.name=="equipmentNumber"?d.value.equipmentNumber=Ae:M.name=="componentDescription"&&(d.value.componentDescription=Ae))}},In=w=>{const C=sessionStorage.getItem(w);return C&&C.length>0?JSON.parse(C)[0]:""},ze=(w=null)=>{if(w){if(d.value[w.name]||d.value[w.name]==""){const C=d.value[w.name]==""?[]:[d.value[w.name]];sessionStorage.setItem(w.sessionStorageName,JSON.stringify(C))}return}ke.forEach(C=>{if(d.value[C.name]||d.value[C.name]==""){const M=d.value[C.name]==""?[]:[d.value[C.name]];sessionStorage.setItem(C.sessionStorageName,JSON.stringify(M))}})};Pn(async()=>{Ue.value=!1,o.setIsFromIntervention(!0);try{await o.getInterventionStatusLookup();let C="";if(W.value&&(C=await Ot(W.value),C!="AU02"&&(x.value=!0)),Me(),!o.isFromEquipment&&!sessionStorage.getItem("formFilter")){if(await Ht(C),Qe(),d.value.equipmentModel==""){const M=JSON.parse(sessionStorage.getItem("IronPortalDashboardFilter-Model"));o.equipmentModelOption.map(de=>{de.label=="930E-4 HPI"&&(!M||M.length==0)&&(d.value.equipmentModel="930E-4 HPI",sessionStorage.setItem("IronPortalDashboardFilter-Model",JSON.stringify(["930E-4 HPI"])))})}Ze(),d.value.equipmentNumber!=""&&await o.getConditionRatingDateLookup()}else{const M=JSON.parse(sessionStorage.getItem("formFilter"));o.setIsFromEquipment(!0),o.setFormFilter(M),sessionStorage.removeItem("formFilter");const de=JSON.parse(sessionStorage.getItem("IronPortalDashboardFilter-Component"))[0];de&&h.setComponentFromEquipment(de);var w=setInterval(async()=>{W.value&&(clearInterval(w),await qe(),je(d.value.interventionStatus=="Accepted"||!d.value.interventionStatus),ze())},750)}await h.getLookupTypeTask(),await h.getLookupUom(),await l.getCBMMappingDataFromServer(),await l.getMasterDataFromServer(),await l.getCBMMappings(),window.addEventListener("beforeunload",()=>{ze()})}catch(C){console.log(C)}});const je=async w=>{const C=w?h.mapHeaderFromExecutionIdAndDefectId(d.value.interventionExecutionId,d.value.defectStatusId):"Declined";C=="Declined"?(h.setSelectedHeader("Declined"),await h.setHeaderDeclined("Declined",1)):await h.setHeaderChange(C)};Tn(async()=>{o.resetFormIntervention(),h.resetAllList(),o.resetGeneric(!0),await o.getFollowUpPriorityLookup()}),Kn(w=>{w.fullPath.includes("/ironportal-dashboard/equipment")||(o.setIsFromIntervention(!1),o.resetFormInterventionAndFilter())});const wn=()=>{d.value.declineReason&&R.value&&(d.value.declineReason=R.value),A.value=!1,f.value=!1},kn=()=>{A.value=!1,k.value=!1},Sn=()=>{u.value=!1,A.value=!1},Dn=async()=>{if(W.value){if(await Ot(W.value)!="AU02"){x.value=!0;const C=JSON.parse(sessionStorage.getItem(ke[0].sessionStorageName)),M=C!=null&&C.length>0?C[0]:a.user.Location;d.value.site=M;const de=C!=null&&C.length>0?C:[M];sessionStorage.setItem(ke[0].sessionStorageName,JSON.stringify(de))}}else d.value.site="Blackwater",d.value.equipmentModel="930E-4 HPI"},Cn=async w=>{$t(d.value.equipmentNumber);const C=se.value.find(de=>de.defectHeaderId==w.defectHeaderId);if(!C)return;const M=C.detail;M.type=="NO"?(I.value=M,z.value=!0):(Y.value=M,T.value={},T.value.isDecline=w.taskDeclineReason!="",T.value.declineReason=w.taskDeclineReason??"",T.value.declineDate=w.taskDeclineDate,T.value.declineBy=w.taskDeclineBy,q.value=!0)};return(w,C)=>{const M=O("el-col"),de=O("el-row"),Ae=O("ViewOnlyDefectYesForm"),xn=O("ViewOnlyDefectNoForm"),Ln=O("ViewOnlyNAForm"),Rn=ve("loading");return r(),m(K,null,[t("div",ou,[i(Oc,{onOnBackToList:Dn})]),te((r(),m("div",iu,[i(de,{gutter:50},{default:p(()=>[i(M,{span:12},{default:p(()=>[i(De,{id:"site",class:"custom-text-input",labelClass:"text-white",value:d.value.site,isLoading:j.value.site,placeholder:"Select Site",label:"Site",name:"Site",max:200,onHandleChange:rn,"is-disabled":y(o).isFromEquipment||x.value,options:y(o).siteOption},null,8,["value","isLoading","is-disabled","options"]),lu,i(De,{id:"model",class:"custom-text-input",labelClass:"text-white",value:d.value.equipmentModel,isLoading:j.value.equipmentModel,placeholder:"Select Model",label:"Model",name:"EquipmentModel",max:200,onHandleChange:Tt,"is-disabled":y(o).isFromEquipment,options:y(o).equipmentModelOption},null,8,["value","isLoading","is-disabled","options"]),ru,i(De,{id:"equipment",class:"custom-text-input",labelClass:"text-white",value:d.value.equipmentNumber,isLoading:j.value.equipmentNumber,placeholder:"Select Equipment",label:"Equipment",name:"EquipmentNumber",max:200,onHandleChange:At,"is-disabled":y(o).isFromEquipment,options:y(o).equipmentNumberOption},null,8,["value","isLoading","is-disabled","options"]),du]),_:1}),i(M,{span:12},{default:p(()=>[i(Sa,{labelClass:"text-white",value:d.value.interventionReason,paragraph:d.value.interventionReason,placeholder:"This value will appear when other form is filled",label:"Intervention Reason",name:"InterventionReason",textInputType:"textarea",disabled:!0},null,8,["value","paragraph"])]),_:1}),i(M,{span:12},{default:p(()=>[cu,i(Da,{isCannotEdit:Le.value,"list-data":g.value,reRender:E.value,isLoading:y(h).componentListLoading||y(h).loading,height:on.value},null,8,["isCannotEdit","list-data","reRender","isLoading","height"])]),_:1}),i(M,{span:12},{default:p(()=>[i(de,{gutter:20,class:"mt-0.5"},{default:p(()=>[i(M,{span:12},{default:p(()=>[i(De,{id:"intervention-status",class:"custom-text-input",labelClass:"text-white",value:d.value.interventionStatus,isLoading:j.value.interventionStatus,placeholder:"Select Intervention Status",label:"Intervention Status",name:"InterventionStatus",max:200,onHandleChange:dn,options:y(o).interventionStatusOption,"is-disabled":d.value.interventionExecutionId>4},{"after-label":p(()=>[d.value.interventionHeaderId&&d.value.declineReason?(r(),m("span",uu,[t("em",{class:"fa fa-info-circle me-2",style:{color:"red","font-size":"1.1em",cursor:"pointer"},onClick:gn})])):d.value.interventionHeaderId&&d.value.approveReason?(r(),m("span",mu,[t("em",{class:"fa fa-info-circle me-2",style:{color:"green","font-size":"1.1em",cursor:"pointer"},onClick:_n})])):V("",!0)]),_:1},8,["value","isLoading","options","is-disabled"]),d.value.statusIP.name&&d.value.statusIP.date?(r(),m("span",pu,S(d.value.statusIP.name)+", "+S(y(ot)(d.value.statusIP.date)),1)):V("",!0),d.value.statusIF.name&&d.value.statusIF.date?(r(),m("span",vu,S(d.value.statusIF.name)+", "+S(y(ot)(d.value.statusIF.date)),1)):V("",!0)]),_:1}),i(M,{span:12},{default:p(()=>[i(De,{id:"follow-up-priority",class:"custom-text-input",labelClass:"text-white",value:d.value.followUpPriority,isLoading:j.value.followUpPriority,placeholder:"Select Follow-up Priority",label:"Follow-up Priority",name:"FollowUpPriority",max:200,onHandleChange:Vt,"is-disabled":Le.value,options:y(o).followUpPriorityOption},null,8,["value","isLoading","is-disabled","options"]),hu]),_:1})]),_:1}),i(Ce,{id:"intervention-description",class:"textarea-custom",labelClass:"text-white",value:d.value.interventionDiagnostic,placeholder:"Add Intervention Description",label:"Intervention Description",name:"InterventionDiagnostic",onHandleChange:cn,max:1500,disabled:Le.value,textInputType:"textarea"},null,8,["value","disabled"]),fu]),_:1}),i(M,{span:12},{default:p(()=>[i(De,{id:"condition-rating-date",class:"custom-text-input",labelClass:"text-white",value:d.value.conditionRatingDate,isLoading:j.value.conditionRatingDate,placeholder:!d.value.equipmentNumber||d.value.equipmentNumber==""?"Please select an Equipment first":"Select Condition Rating Date",label:"Condition Rating Date",name:"ConditionRatingDate",max:200,onHandleChange:Nt,"is-disabled":!d.value.equipmentNumber||d.value.equipmentNumber==""||y(o).isFromEquipment,options:y(o).conditionRatingDateOption},{"after-label":p(()=>[We.value.length>1?(r(),m("span",gu,[t("em",{class:"fa fa-info-circle me-2",style:{color:"#f0f0f0","font-size":"1.1em",cursor:"pointer"},onClick:bn})])):V("",!0)]),_:1},8,["value","isLoading","placeholder","is-disabled","options"]),_u]),_:1}),i(M,{span:12},{default:p(()=>[i(Un,{id:"estimation-completion-date",class:"custom-text-input",labelClass:"text-white",value:d.value.estimationCompletionDate,label:"Estimated Completion Date",name:"EstCompletionDate","is-loading":j.value.estimationCompletionDate,"is-disabled":Le.value,onHandleChange:un},null,8,["value","is-loading","is-disabled"]),bu]),_:1}),i(M,{span:12},{default:p(()=>[i(de,{gutter:20},{default:p(()=>[i(M,{span:12},{default:p(()=>[i(Ce,{labelClass:"text-white",value:d.value.conditionRatingSmu,placeholder:"This value will appear when other form is filled",label:"Condition Rating SMU",name:"ConditionRatingSmu",disabled:!0},null,8,["value"])]),_:1}),i(M,{span:12},{default:p(()=>[i(Ce,{labelClass:"text-white",value:d.value.frameHours,placeholder:"This value will appear when other form is filled",label:"Frame Hours",name:"FrameHours",disabled:!0},null,8,["value"])]),_:1})]),_:1})]),_:1}),i(M,{span:12},{default:p(()=>[i(Ce,{id:"work-order",textInputType:"number",labelClass:"text-white",value:d.value.workOrder,placeholder:"Add SAP Work Order Number",label:"SAP Work Order Number",name:"SapWorkOrderNumber",onHandleChange:mn,disabled:Le.value,max:20},null,8,["value","disabled"]),yu]),_:1})]),_:1})])),[[Rn,y(o).loading]]),t("div",Iu,[wu,Le.value?(r(),G(Ka,{key:0,listData:be.value,onSetDeclineReason:pt,isLoading:y(h).componentListLoading||y(h).loading},null,8,["listData","isLoading"])):(r(),G(us,{key:1,reRender:U.value,listData:be.value,onSetDeclineReason:pt,disableSelection:Le.value,isLoading:y(h).componentListLoading||y(h).loading},null,8,["reRender","listData","disableSelection","isLoading"]))]),t("div",ku,[Su,i(ti,{ref_key:"additionalTaskRef",ref:re,listData:Te.value,canEditAndDelete:d.value.interventionStatus!="Declined"&&d.value.interventionExecutionId<=4,onSetDeclineReason:pt},null,8,["listData","canEditAndDelete"])]),t("div",Du,[Cu,t("p",xu,S(d.value.additionalInformation),1)]),t("div",Lu,[Ru,i(Si,{"list-data":ie.value,onOnViewDetailInformation:Cn,loading:y(o).genericLoading},null,8,["list-data","loading"])]),t("div",Fu,[i(Ve,{name:"fade"},{default:p(()=>[ee.value&&J.value.length>0?(r(),G(Oe,{key:0,errorMessages:J.value,onResetForm:xe},null,8,["errorMessages"])):V("",!0)]),_:1}),t("div",$u,[i(nc,{"form-intervention":d.value,onClicked:vn,isLoading:y(o).loading,selectedHeader:Ft.value},null,8,["form-intervention","isLoading","selectedHeader"])])]),i(Ae,{visibility:pe.value,"defect-data":y(n).defectInfo,onClose:C[0]||(C[0]=()=>y(n).resetInstance()),"is-intervention":!0,"decline-reason":b.value},null,8,["visibility","defect-data","decline-reason"]),i(xn,{visibility:Ke.value,"is-intervention":!0,"defect-data":y(n).defectInfo,onClose:C[1]||(C[1]=()=>y(n).resetInstance())},null,8,["visibility","defect-data"]),i(Ln,{visibility:Je.value,"is-intervention":!0,onClose:C[2]||(C[2]=()=>y(s).resetInstance())},null,8,["visibility"]),i(tc,{viewOnly:"",equipmentModel:d.value.equipmentModel,psType:F.value,visibility:H.value,"cbm-data":B.value,onCloseForm:yn},null,8,["equipmentModel","psType","visibility","cbm-data"]),i(Bc,{isEdit:!A.value,visibility:f.value,declinerName:d.value.statusIF.name||d.value.statusIP.name,declinerDate:d.value.statusIF.date||d.value.statusIP.date,onHandleClose:wn,onHandleSubmit:hn},null,8,["isEdit","visibility","declinerName","declinerDate"]),i(Gc,{visibility:k.value,approverName:d.value.statusIP.name||d.value.statusIP.name,approverDate:d.value.statusIP.date||d.value.statusIP.date,onHandleClose:kn},null,8,["visibility","approverName","approverDate"]),i(Jc,{visibility:u.value,onHandleClose:Sn,onHandleSubmit:fn},null,8,["visibility"]),i(su,{dates:We.value,visibility:L.value,onHandleClose:C[3]||(C[3]=()=>{L.value=!1})},null,8,["dates","visibility"]),i(nu,{visibility:Rt.value,onHandleClose:C[4]||(C[4]=()=>{Rt.value=!1})},null,8,["visibility"]),i(wd,{visibility:z.value,data:I.value,ownership:$.value,"serial-number":_.value,onOnClose:C[5]||(C[5]=()=>{z.value=!1})},null,8,["visibility","data","ownership","serial-number"]),i(Mr,{visibility:q.value,data:Y.value,decline:T.value,ownership:$.value,"serial-number":_.value,onOnClose:C[6]||(C[6]=()=>{q.value=!1})},null,8,["visibility","data","decline","ownership","serial-number"])],64)}}}),up=ge(Pu,[["__scopeId","data-v-00e82247"]]);export{up as default};
