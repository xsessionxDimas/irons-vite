import{e as D}from"./lodash-DrHMlsdo.js";import{_ as W}from"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import{s as R}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{u as X}from"./useCameraStore-BwXVJhPe.js";import{k as j,r as m,a0 as U,c as k,d as L,p as h,aa as b,aB as s,b4 as I,u as B,C as V,A as P,q as E,F as S,o as Z,R as T,Y as ee,x as H,y as te,B as ne,s as A,$ as se,bd as le,bb as ae}from"./@vue-BypzYtbH.js";import{q as oe}from"./helpers-wUOLw-dU.js";import{b as ie,_ as re}from"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import{_ as ce}from"./pdf-DNpyvVEz.js";import{_ as ue}from"./image-close-button-red-B1UxWyBV.js";import{u as z}from"./useAttachmentStore-DqM3autD.js";import{_ as de}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as me}from"./nw-img-vue-CR837WER.js";import{a as fe}from"./element-plus-BeWdvTRa.js";import{a as pe}from"./index-BuVmIl8K.js";const ve=["disabled"],he=["src"],be={key:0,class:"col-6 p-0 d-flex justify-content-center text-nowrap"},ge={class:"text-white"},nt=j({__name:"SmallCamera",props:{itemValue:{required:!0,type:Object},index:{requied:!0,type:Number},isDisabled:{required:!1,type:Boolean,defauly:!1}},emits:["handleChangeImage"],setup(n,{emit:w}){const a=m(!1),u=X(),t=n,f=w,l=m(!1),o=U(t,"itemValue"),i=k(()=>o.value?R(o.value):[]),p=k(()=>D.cloneDeep(u.ImageObjects.find(e=>e.Id===`${t.index}-parts`))),g=()=>{u.toggleIsVisible(!0,`${t.index}-parts`),u.setShowCloseButton(!0)},C=()=>{let e="/media/svg/dma/camera/e-form/png/cam-active.png";return i.value.length>0&&(e="/media/svg/dma/camera/e-form/png/cam-user.png"),e};L(p,async(e,c)=>{e&&e.ImageInfos.length>0&&e.ImageInfos.length!=(c==null?void 0:c.ImageInfos.length)&&(f("handleChangeImage",{index:t.index,value:[...R(o.value),...e.ImageInfos]}),l.value=!l.value,u.setCurrent(`${t.index}-parts`),u.clearCurrent())},{deep:!0});const y=k(()=>!d.value),x=()=>{a.value=!0},v=()=>{a.value=!1},d=k(()=>t.isDisabled?t.isDisabled:!1),_=async e=>{const c=D.cloneDeep(o.value).filter($=>$.filename!=e);f("handleChangeImage",{index:t.index,value:c}),l.value=!l.value,u.setCurrent(`${t.index}-parts`),o.value.length==0&&v(),u.clearCurrent()};return(e,c)=>(h(),b(S,null,[s("div",{class:I(["row m-0 p-0",!B(D.isUndefined)(o.value)&&o.value.length>0?"justify-content-around":"justify-content-center"])},[s("div",{class:I(["d-flex justify-content-center",!B(D.isUndefined)(o.value)&&o.value.length>0?"col-6 pe-0 ps-1":"col-6 px-0"])},[s("button",{class:"btn btn-sm btn-icon btn-bg-light",disabled:d.value,onClick:g},[s("img",{src:C(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,he)],8,ve)],2),i.value&&i.value.length>0?(h(),b("div",be,[s("button",{class:"btn btn-sm btn-icon btn-bg-success",onClick:x,style:{"background-color":"#18AF4A"}},[s("label",ge,"+"+V(i.value.length),1)])])):P("",!0)],2),a.value?(h(),E(W,{key:0,type:"task","re-render":l.value,images:i.value,"show-delete-button":y.value,"is-mandatory":!1,visibility:a.value,"is-monitoring":!y.value,"show-mandatory-caption":!1,onOnClose:v,onOnDelete:_},null,8,["re-render","images","show-delete-button","visibility","is-monitoring"])):P("",!0)],64))}}),ye={key:0,style:{height:"100px"}},_e={key:0,class:"row text-center my-10"},we={class:"text-danger"},Ce={key:1,class:"row justify-content-end pt-4 pe-10"},xe={class:"div page-controller",style:{"margin-left":"auto"}},De=["disabled"],ke=["disabled"],$e=j({__name:"PDFViewerDialog",props:{show:{type:Boolean,required:!0},blobUrl:{type:String,required:!0}},emits:["handleCloseModal"],setup(n,{emit:w}){const a=n,u=w,t=z(),f=m(""),l=m(1),o=m(1),i=m(!0);m(null);const p=m(""),g=m(!1),C=U(a,"show"),y=async()=>{if(g.value=!1,f.value="",l.value=1,o.value=1,a.blobUrl!="")try{i.value=!0;const v=await t.downloadAttachmentPDF(a.blobUrl),d=new Blob([v],{type:"application/pdf"}),_=window.URL||window.webkitURL;f.value=_.createObjectURL(d)}catch(v){g.value=!0,a.blobUrl.includes("#")?p.value="PDF not yet attached":p.value=`${v}`}finally{i.value=!1}};Z(async()=>{await y()}),L(C,v=>{v&&y()},{deep:!0});const x=()=>{u("handleCloseModal")};return(v,d)=>{const _=T("el-dialog"),e=ee("loading");return h(),E(_,{modelValue:C.value,"onUpdate:modelValue":d[2]||(d[2]=c=>C.value=c),title:"Preview",width:"80%","custom-class":"show-pdf","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:d[3]||(d[3]=c=>x())},{default:H(()=>[i.value?te((h(),b("div",ye,null,512)),[[e,i.value]]):(h(),b(S,{key:1},[g.value?(h(),b("div",_e,[s("span",we,V(p.value),1)])):(h(),b("div",Ce,[s("div",xe,[s("button",{type:"button",disabled:l.value<=1,onClick:d[0]||(d[0]=c=>l.value--),class:"btn btn-success btn-sm ok-button"},"❮",8,De),ne(" "+V(l.value)+" / "+V(o.value)+" ",1),s("button",{type:"button",disabled:l.value>=o.value,onClick:d[1]||(d[1]=c=>l.value++),class:"btn btn-success btn-sm ok-button"},"❯",8,ke)])]))],64))]),_:1},8,["modelValue"])}}}),Y=n=>(le("data-v-5536f1af"),n=n(),ae(),n),Ve={class:"d-flex"},Ae=["onClick"],Fe=Y(()=>s("img",{src:ce,alt:"pdf",class:"d-icon pdf",style:{"vertical-align":"-1px",width:"13px"}},null,-1)),Ue=[Fe],Ie=["onClick"],Be={style:{"white-space":"pre-wrap"},class:"pdf"},Pe=["onClick"],Se=Y(()=>s("img",{src:ue,alt:"close",class:"d-icon pdf",style:{"vertical-align":"-2px",width:"15px"}},null,-1)),je=[Se],Oe=j({__name:"AttachmentPreview",props:{visibility:{type:Boolean,required:!1},files:{type:Array,required:!0},showDeleteButton:{type:Boolean,required:!0,default:!0},isMonitoring:{type:Boolean,default:!1}},emits:["onClose","onChangeAttachment","onDownloaded"],setup(n,{emit:w}){const a=n,u=w,t=m(!1),f=m(""),l=()=>{t.value=!1},o=U(a,"files"),i=U(a,"visibility"),p=m(!1),g=m(""),C=k(()=>{let e=!1;return a.showDeleteButton&&(e=!0),a.isMonitoring&&(e=!1),e}),y=e=>{f.value=e,t.value=!0},x=()=>{i.value=!1,u("onClose")},v=e=>{p.value=!0,g.value=e},d=()=>{p.value=!1},_=()=>{p.value=!1;const e=D.cloneDeep(o.value).filter(c=>c.url!=g.value);u("onChangeAttachment",e),e.length==0&&x(),g.value=""};return(e,c)=>{const $=T("el-dialog");return h(),b(S,null,[A($,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=r=>i.value=r),title:"Detailed Document",width:"80%","custom-class":"el-defect-crack-form-custom multi-defect-list-dialog",onClose:x},{default:H(()=>[(h(!0),b(S,null,se(n.files,r=>(h(),b("div",{class:"multi-defect-list-item py-2 d-flex align-items-center justify-content-between",key:r.filename},[s("div",Ve,[s("div",{class:"multi-icon cursor-pointer",onClick:F=>y(r.url)},Ue,8,Ae),s("div",{class:"multi-description cursor-pointer",onClick:F=>y(r.url)},[s("span",Be,V(r.filename),1)],8,Ie)]),C.value?(h(),b("div",{key:0,class:"multi-icon cursor-pointer",onClick:F=>v(r.url)},je,8,Pe)):P("",!0)]))),128))]),_:1},8,["modelValue"]),A(de,{visibility:p.value,caption:"Are you sure want to delete this PDF?",onOnNoConfirm:d,onOnYesConfirm:_},null,8,["visibility"]),A($e,{show:t.value,onHandleCloseModal:l,"blob-url":f.value},null,8,["show","blob-url"])],64)}}}),qe=me(Oe,[["__scopeId","data-v-5536f1af"]]),Me=["disabled"],Ne=["src"],Re={key:0,class:"col-6 ps-0 pe-1 d-flex justify-content-center"},Le={class:"text-white"},st=j({__name:"UploadAttachment",props:{itemValue:{required:!0,type:Object},index:{requied:!0,type:Number},isDisabled:{required:!1,type:Boolean,defauly:!1}},emits:["handleChangeAttachment"],setup(n,{emit:w}){const a=z(),u=pe(),t=n,f=w,l=m(null),o=m(!1),i=m([]),p=m(!1),g=()=>{l.value&&l.value.openUploadDialog()},C=()=>{o.value=!1},y=()=>{},x=async r=>{i.value=[];const F=fe.service({lock:!0,text:"Uploading",background:"rgba(0, 0, 0, 0.7)"});let q=!0;const G=["application/pdf"];if((r[0].size>2097152||!G.includes(r[0].type))&&(q=!1,i.value.push(r[0].name)),!q)i.value.length>0&&(o.value=!0);else{const J=new Blob([r[0]],{type:"application/pdf"});let M=oe(15);const O=new FormData;O.append("files",J,encodeURI(`${M}.pdf`)),O.append("userAccount",u.user.Email);const K=await a.uploadAttachment(O,u.user.Email);Promise.all([K]).then(Q=>{if(typeof Q[0]=="string"){const N=D.cloneDeep(t.itemValue);N.push({filename:r[0].name,url:M}),v(N)}})}F.close()},v=r=>{f("handleChangeAttachment",{index:t.index,value:r})},d=()=>{let r="/media/svg/dma/attachment/blue.png";return t.itemValue.length>0&&(r="/media/svg/dma/attachment/green.png"),r},_=k(()=>!$.value),e=()=>{p.value=!0},c=()=>{p.value=!1},$=k(()=>t.isDisabled?t.isDisabled:!1);return(r,F)=>(h(),b("div",null,[s("div",{class:I(["row m-0",!B(D.isUndefined)(n.itemValue)&&n.itemValue.length>0?"justify-content-around":"justify-content-center"])},[s("div",{class:I(["d-flex justify-content-center",!B(D.isUndefined)(n.itemValue)&&n.itemValue.length>0?"col-6 pe-0 ps-1":"col-6 px-0"])},[s("button",{class:"btn btn-sm btn-icon btn-bg-light",disabled:$.value,onClick:g},[s("img",{src:d(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,Ne)],8,Me)],2),n.itemValue&&n.itemValue.length>0?(h(),b("div",Re,[s("button",{class:"btn btn-sm btn-icon btn-bg-success",onClick:e,style:{"background-color":"#18AF4A"}},[s("label",Le,"+"+V(n.itemValue.length),1)])])):P("",!0)],2),A(qe,{visibility:p.value,files:n.itemValue,"is-monitoring":!_.value,"show-delete-button":_.value,onOnClose:c,onOnChangeAttachment:v},null,8,["visibility","files","is-monitoring","show-delete-button"]),A(ie,{ref_key:"singlePDFUploader",ref:l,"is-multiple":!1,"accepted-file":"application/pdf",onOnFileDropped:x,onOnFileCancelled:y},null,512),A(re,{show:o.value,onClose:C,imageList:i.value,fileType:"PDF"},null,8,["show","imageList"])]))}}),lt=(n,w)=>{const a=n.split(","),u=a[0].match(/:(.*?);/)[1],t=atob(a[a.length-1]);let f=t.length;const l=new Uint8Array(f);for(;f--;)l[f]=t.charCodeAt(f);return new File([l],w,{type:u})};export{nt as _,st as a,lt as d};
