import{u as Te,G as xe,C as te,_ as Me,a as qe,D as Fe,b as Le,N as $e,c as Ye}from"./useInterventionNAStore-JmmvsR31.js";import{C as Ue}from"./CardPersonnelMonitoring-BNc2-LD9.js";import{C as We}from"./Cameras-vtENZZzD.js";import{u as je}from"./useCameraStore-BwXVJhPe.js";import{D as Je}from"./cbm-helper-BxJZ9NTc.js";import{D as Ke,a as re,b as ze,C as oe,N as ae}from"./NAPanel-DsLwt-Yx.js";import{C as Qe}from"./CommentPanel-D0ptrEBp.js";import{V as Xe}from"./ViewOnlyNAReasonDialog-DR-Uz59p.js";import{u as Ze}from"./useComponentInterventionDefectsStore-CA75rH_W.js";import{u as et}from"./useComponentInterventionDefectSheetStore-H9Ju8hNj.js";import{u as tt}from"./useComponentInterventionEformStore-CMy33xkJ.js";import{a as rt,d as ot}from"./useComponentInterventionHeaderStore-CbC-c2Z5.js";import{u as at}from"./useInterventionDefectStore-CSZwjVeC.js";import{a as nt,f as S}from"./index-BuVmIl8K.js";import{u as st}from"./useMasterStore-CzSO06fn.js";import{e as it}from"./lodash-DrHMlsdo.js";import{n as lt}from"./navigator-D5io2Cca.js";import{_ as ut}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{_ as ct}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{a as F}from"./element-plus-BeWdvTRa.js";import{B as pt}from"./BackNavigator-DUE8rWVW.js";import{_ as dt}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as ne}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{N as mt}from"./NoDefect-DdL3mqty.js";import{u as ft}from"./vue-router-iNp9kJ0K.js";import{b as vt}from"./useDefectsFormStore-41UTMhiG.js";import{g as se,v as Dt}from"./helpers-wUOLw-dU.js";import{t as ht}from"./helpers-BS1ZZpAr.js";import{A as gt,N as wt}from"./number-format-BdMuQVyW.js";import{s as bt}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{i as yt}from"./date-format-8-IvfSl3.js";import{k as kt,r as s,c as i,a7 as St,o as Nt,L as At,p as h,aa as N,s as r,u as p,F as I,aB as ie,q as le,A as Ct,$ as It}from"./@vue-BypzYtbH.js";import"./nw-img-vue-CR837WER.js";import"./manipulate-html-string-DqTEGh-F.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./@vueuse-DFoNmIyu.js";import"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import"./ReferenceInline.vue_vue_type_script_setup_true_lang-DqEUurUl.js";import"./reference-file-C1vLEEpf.js";import"./internet-connection-CnLQPjRt.js";import"./@azure-DwL0pga8.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./urls-CPQ2HRXU.js";import"./uuid-SoommWqA.js";import"./pdf-DNpyvVEz.js";import"./image-close-button-red-B1UxWyBV.js";import"./PDFViewerDialog.vue_vue_type_style_index_0_lang-DqiQYePb.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./pinia-BjOS2_Ao.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./simple-vue-camera-D9MGhAeE.js";import"./@popperjs-BaMZbQYT.js";import"./vue-BzYgrL08.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./Repair-zyV2di4A.js";import"./SMUDetailDialog-Bs-98WGo.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./document_download-C1p7j0nJ.js";import"./useHistoricalEformDmaStore-Fo4tKNgB.js";import"./DefectForm-eu6l4STx.js";import"./manipulate-file-oif_A7gg.js";import"./@progress-DBKeVTWA.js";import"./pdf-merger-js-DY3-eECH.js";import"./pdf-lib-DrnT2QV2.js";import"./@pdf-lib-CXIx2D9y.js";import"./pako-Dx2kwFQn.js";import"./usePositionListStore-BsprGHwA.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./LargeCamera-BnWfLFAm.js";import"./NAForm-BdrJ0TGj.js";import"./usePreviewDefectFormStore-CVtftEdK.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-CvqtYZA-.js";import"./useDefectsStore-7BpSnT1n.js";import"./CrackNoClass-0DSU7BAn.js";import"./CrackYesClass-COntz77m.js";import"./prev-val-handler-DvA3D_kF.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./useEFormStore-DtkLPope.js";import"./list-pcxkCnQg.js";import"./urls-B0Rq9QQ3.js";import"./useOfflineCameraStore-BBsMm6DV.js";import"./IronformConfig-BWypCgSI.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./disabled-state-O9W-ZY8y.js";import"./Check-CTArJpdm.js";import"./urls-RITu66bD.js";import"./object-path-DPahbflh.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./moment-C5S46NFB.js";const Ot={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},Pt=["disabled"],Zo=kt({__name:"Detail",setup(_t){const L=ft(),n=Ze(),a=et(),O=tt(),P=rt(),l=ot(),A=at(),ue=Te(),$=je(),Y=vt(),U=nt(),_=st(),B=s(!1),R=s(!1),E=s(!1),g=s(),W=s("Not-Confirm"),w=s(),b=s(""),G=s(""),ce=s(!1),d=s(),V=s(!1),H=s(!1),T=s(!1),j=s(0),{redirectByLink:J}=lt(),y=i(()=>{var t;return((t=a.SelectedDefectSheet)==null?void 0:t.intFormStatus)=="Submited"}),u=i(()=>l.Intervention),x=i(()=>l.serialNumber),K=i(()=>P.Log),pe=i(()=>l.RiskAssessmentImages),z=i(()=>l.Groups),C=i(()=>l.Group),k=i(()=>l.Task),de=i(()=>k.value?A.DefectImages[k.value.key]:[]),me=i(()=>l.LoadingTask),fe=i(()=>l.ItemTriggerDisabledValue),ve=i(()=>l.CountIdentifiedDefect),Q=i(()=>P.GeneralSubmitted),De=i(()=>l.TaskProgress),he=i(()=>n.stateErrorByNetwork),ge=i(()=>n.Comments.slice().sort(Ce)),we=t=>{l.setSelectedGroup(t)},M=async t=>{var m;t.index==0&&(E.value=!1);const e=t.image,o={};o.id=u.value.id,e.type=="imageEquipment"?o.key=u.value.key:e.type=="value"?o.key=u.value.riskAssesment[0].key:o.key=(m=k.value)==null?void 0:m.key,o.type=e.type,o.employee={id:U.user.EmployeeId,name:U.user.Name};const c=bt([e.filename]);o.files=c,o.blobs=[e.blob],o.submitDate=yt(),await P.storeImageLocal(o),t.index==t.length-1&&(E.value=!0)},be=async({param:t,task:e={}})=>{switch(t.key){case"na":ye(t);break;case"defect":ke(t),e&&l.setSelectedTask(e);break}},ye=async t=>{const e=await ue.getNADetail(t.value,u.value.trInterventionHeaderId,u.value.sapWorkOrder);e&&(g.value=JSON.parse(e.defectData),W.value=e.cbmNAStatus,d.value={},d.value.declineReason=e.declineReason||"",d.value.declineDate=e.declineDate||"",d.value.declineBy=e.declineBy||{},w.value=e.approvedBy,b.value=e.approvedDate||"",V.value=!0)},ke=async t=>{const e=await A.getDefectDetail(t.value,u.value.trInterventionHeaderId,u.value.sapWorkOrder,"taskId"),o=await A.getDefectHeader(t.value,u.value.trInterventionHeaderId,u.value.sapWorkOrder,"taskId");if(e.type=="NO")g.value=e,T.value=!0;else{d.value={},g.value=e;const c=await A.getDefectDecline(t.value);d.value.isDecline=c.isDecline,d.value.declineReason=c.declineReason,d.value.declineDate=c.declineDate,d.value.declineBy=c.declineBy,w.value=o.approvedBy,b.value=o.approvedDate??"",H.value=!0}},Se=()=>{V.value=!1,d.value={},w.value={},b.value=""},Ne=()=>{H.value=!1},Ae=()=>{T.value=!1},Ce=(t,e)=>{const o=parseInt(t.taskDesc.split(";;")[0]),c=parseInt(e.taskDesc.split(";;")[0]);return o-c},Ie=i(()=>{const t=["P1","P2","P3","P4"],o=se(n.ApprovalData.DefectHeaders,t).every(D=>D.status=="Acknowledge"||D.status=="Decline"),m=se(n.ApprovalData.DefectGenericHeaders,t).every(D=>D.status=="Acknowledge"||D.status=="Decline"),v=n.ApprovalData.CBMHeaders.every(D=>D.cbmNAStatus==="Confirmed"),He=Dt(n.ApprovalData.DefectNAHeaders);return n.ApprovalData.SMUDefectHeaders.length>0&&n.ApprovalData.SMUDefectHeaders[0].status!=="Acknowledge"?!1:o&&m&&v&&He&&y.value}),q=()=>{j.value=window.scrollY},Oe=()=>{n.toggleErrorByNetwork(!1),L.push({name:"defects"})},f=async()=>{j.value=window.scrollY;const t=F.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await n.getDefectsData(a.SelectedDefectSheet.interventionId),t.close()},Pe=async()=>{const t=F.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});await a.approveDefectSheetBySupervisor(),await S.interventionDefect.where("interventionId").equals(a.SelectedDefectSheet.interventionId).delete(),await S.pendingTask.where("workorder").equals(a.SelectedWorkOrder).delete();const e=await S.interventionDetail.where("id").equals(a.SelectedDefectSheet.interventionId).first();if(await S.interventionDetail.where("id").equals(a.SelectedDefectSheet.interventionId).delete(),e&&await S.interventionHeader.where("id").equals(e.keyPbi).delete(),t.close(),a.IsError){R.value=!0;return}a.reset(),B.value=!0},_e=()=>{B.value=!1,J("/ironforms/defects")},Be=()=>{R.value=!1,a.Error!=gt.INCOMPLETE_DATA&&a.Error!=wt.NO_NETWORK_VIEW&&J("/ironforms/defects")},X=s(null),Re=s(""),Z=s(!1),ee=s(!1),Ee=t=>{ee.value=t};St(()=>{!a.SelectedDefectSheet||it.isEmpty(a.SelectedDefectSheet)?L.push({name:"defects"}):a.setDefectTitle(ht(a.SelectedDefectSheet))});const Ge=t=>{const e=_.Ownership.find(o=>o.equipmentNumber==t);G.value=(e==null?void 0:e.ownership)??""};Nt(async()=>{const t=F.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(n.DataFetched===!1){await n.getDefectsData(a.SelectedDefectSheet.interventionId),await O.getInterventionDataCosmos(a.SelectedDefectSheet.interventionId),l.initGroup(O.intervention);const e=z.value.find(o=>o.key=="Identified Defects");e&&l.setSelectedGroup(e),await Y.getOwnershipDefectForm(O.intervention.equipment),l.setSerialNumber(Y.SerialNumber),Ge(u.value.equipment),await l.getCountIdentifiedDefect()}try{const e=X.value,o=Array.from(e.getElementsByClassName("show-pdf")),c=Array.from(e.getElementsByClassName("spv-print-pdf"));o.forEach(m=>{m.onclick=v=>{v.preventDefault()}}),c.forEach(m=>{m.onclick=v=>{v.preventDefault()}})}catch(e){console.log(e)}n.setCurrentUserGroup("Supervisor"),t.close()});const Ve=()=>{Z.value=!1};return At(()=>{$.reset()}),(t,e)=>{var o,c,m;return h(),N("div",{ref_key:"defectDetailRef",ref:X},[r(pt,{title:`${(o=p(a).SelectedDefectSheet)==null?void 0:o.sampleStatus} Intervention ${(c=p(a).SelectedDefectSheet)==null?void 0:c.equipment} ${(m=p(a).SelectedDefectSheet)==null?void 0:m.sapWorkOrder}`,"component-router-push":"defects"},null,8,["title"]),r(xe,{groups:z.value,"selected-group":C.value,"general-submitted":Q.value,"is-approval":!0,"task-progress":De.value,"count-identified-defect":ve.value,"is-monitoring":!0,onGroupChange:we},null,8,["groups","selected-group","general-submitted","task-progress","count-identified-defect"]),C.value.group=="General"?(h(),N(I,{key:0},[r(te,{intervention:u.value},null,8,["intervention"]),r(Ue,{intervention:u.value,"serial-number":x.value},null,8,["intervention","serial-number"]),r(Me,{tasks:u.value.safetyPrecaution},null,8,["tasks"]),r(qe,{"general-submitted":Q.value,intervention:u.value,fitter:K.value.employee,"fitter-photos":pe.value,"is-monitoring":!0},null,8,["general-submitted","intervention","fitter","fitter-photos"])],64)):C.value.group=="Identified Defects"?(h(),N(I,{key:1},[r(Je),r(Ke,{"view-only":!1,"planner-approve":!1,supervisor:!0,onOnRefreshData:f,onOnGetPositionY:q}),r(re,{"view-only":!1,supervisor:!0,"need-confirm":!1,onOnRefreshData:f,"view-is-download":!0}),r(re,{"view-only":!1,supervisor:!0,"is-additional-task":!0,"need-confirm":!1,onOnRefreshData:f,"view-is-download":!0}),r(ze,{"view-only":!1,supervisor:!0,"need-confirm":!1,onOnRefreshData:f,"view-is-download":!0}),r(oe,{headers:p(n).ApprovalData.CBMHeaders,"view-only":!1,supervisor:!0,"is-disabled":!y.value,onOnRefreshData:f},null,8,["headers","is-disabled"]),r(oe,{headers:p(n).ApprovalData.CBMHeaders,"view-only":!1,supervisor:!0,"is-disabled":!y.value,"is-additional-task":!0,onOnRefreshData:f},null,8,["headers","is-disabled"]),r(ae,{title:"Not Applicable Item Check",headers:p(n).ApprovalData.DefectNAHeaders,"is-defect":!0,"is-disabled":!y.value,onOnRefreshData:f,onOnGetPositionY:q},null,8,["headers","is-disabled"]),r(ae,{title:"Not Applicable Item Check (Additional Task)",headers:p(n).ApprovalData.DefectNAHeaders,"is-disabled":!y.value,onOnRefreshData:f,onOnGetPositionY:q,"is-additional-task":!0},null,8,["headers","is-disabled"]),r(Qe,{headers:ge.value,"is-intervention":!0},null,8,["headers"]),ie("div",Ot,[p(n).ApprovalData.DefectHeaders.length==0&&p(n).ApprovalData.DefectNAHeaders.length==0&&p(n).ApprovalData.CBMHeaders.length==0?(h(),le(mt,{key:0,message:"Component intervention sheet was completed in full and no issues were identified."})):Ct("",!0),ie("button",{class:"btn btn-success",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"},disabled:!Ie.value,onClick:Pe},"Approve",8,Pt)])],64)):(h(),N(I,{key:2},[r(te,{intervention:u.value,"default-accordion-open":!1},null,8,["intervention"]),(h(!0),N(I,null,It(C.value.sections,v=>(h(),le(Ye,{key:v.key,"re-render":!1,"defect-images":de.value,intervention:u.value,section:v,"current-fitter":K.value.employee,"general-submitted":!1,validation:"","loading-indicator":me.value,"item-trigger-disabled-value":fe.value,currInputTyped:"","expand-all":!1,onOnImageDownloaded:M,onOnDefectView:be},null,8,["defect-images","intervention","section","current-fitter","loading-indicator","item-trigger-disabled-value"]))),128))],64)),r(We,{visibility:p($).isVisible},null,8,["visibility"]),r(ut,{show:B.value,onClose:_e,message:"Data successfully approved"},null,8,["show"]),r(ct,{visibility:R.value,caption:p(a).Error,onOnClose:Be},null,8,["visibility","caption"]),r(dt,{show:Z.value,onHandleCloseModal:Ve,"blob-url":Re.value},null,8,["show","blob-url"]),r(ne,{show:ee.value,onClose:Ee,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),r(ne,{show:he.value,onClose:Oe,"title-pop-up":"No internet connection"},null,8,["show"]),r(Fe,{"re-render":!1,task:k.value,decline:d.value,visibility:H.value,"approved-by":w.value,"approved-date":b.value,ownership:G.value,serialNumber:x.value,data:g.value,onOnImageDownloaded:M,onOnClose:Ne,naReasonOptions:p(_).NAConditions},null,8,["task","decline","visibility","approved-by","approved-date","ownership","serialNumber","data","naReasonOptions"]),r(Le,{"re-render":E.value,task:k.value,generic:ce.value,visibility:T.value,data:g.value,ownership:G.value,serialNumber:x.value,onOnImageDownloaded:M,onOnClose:Ae,naReasonOptions:p(_).NAConditions},null,8,["re-render","task","generic","visibility","data","ownership","serialNumber","naReasonOptions"]),r($e,{visibility:V.value,status:W.value,"approved-by":w.value,"approved-date":b.value,declineData:d.value,data:g.value,onOnClose:Se},null,8,["visibility","status","approved-by","approved-date","declineData","data"]),r(Xe,{"is-intervention":!0})],512)}}});export{Zo as default};
