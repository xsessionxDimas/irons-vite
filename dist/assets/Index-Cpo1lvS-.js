import{u as Bt}from"./vuex-BbOKrtVp.js";import{a as zt}from"./breadcrumb-D-Q4Tk9w.js";import{b as q,u as ut,i as et,h as pt,j as Z,A as jt}from"./index-BCnwA6yE.js";import{P as yt}from"./Pagination-CVDIvnOM.js";import{F as Kt}from"./FilterIconButton-Bj0WTbms.js";import{h as Gt,A as Yt,U as Qt}from"./excel-generator-CRLIz6fw.js";import{D as Xt}from"./DownloadIconButton-CIQp-YG7.js";import{_ as b,b as Et}from"./element-plus-C5R56mia.js";import{f as P,n as G,a as Tt,b as Jt}from"./date-format-BASVuupi.js";import{P as at,d as Wt,b as Zt,a as te}from"./table-sort-VnBD5Hfa.js";import{d as mt}from"./pinia-BjOS2_Ao.js";import{a as R,m as bt}from"./mapOption-sP4IrA4W.js";import{L as ee}from"./urls-B8AUZ1MD.js";import{L as ae}from"./urls-BUxQAIma.js";import{L as oe}from"./urls-DTUjp4BB.js";import{k as z,bL as se,r as Q,u as o,y as B,p as S,aa as tt,q as U,x as h,Y as nt,R as O,s as a,aB as D,C as X,a0 as it,c as M,B as w,A as rt,T as Ft,bd as ne,bb as ie,a7 as re,L as le,F as de}from"./@vue-BypzYtbH.js";import{_ as _t}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as ot}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as Y}from"./AutoComplete.vue_vue_type_script_setup_true_lang-D4CTLiQF.js";import{a as St}from"./vee-validate-C_msoaAA.js";import{c as Ct,a as V,b as st,d as kt}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as Lt}from"./ErrorAlert-CMKGfwAi.js";import{_ as ce}from"./lodash-Cr9vlq0V.js";import{_ as ue}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as pe}from"./map-anything-abi6NY2Z.js";import{_ as me}from"./nw-img-vue-CR837WER.js";import{_ as H}from"./AutoComplete.vue_vue_type_style_index_0_lang-CRR6Z--K.js";import{_ as vt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as he}from"./file-saver-DhbZvGod.js";import"./vue-router-iNp9kJ0K.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const j="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/assignment_component_lubricant",De=`${j}/bulk`,ge=`${j}/validate_upload`,Te=`${j}/export`,be=`${j}/lookup`,ve=`${j}/update`,ct={EquipmentModel:"",EquipmentModelTo:"",PsType:"",PsTypeTo:"",Component:"",ComponentTo:"",RecomLubricant:"",RecomLubricantTo:"",Value:"",ValueTo:"",Uom:"",UomTo:"",TaskNo:"",TaskNoTo:"",StartDate:"",StartDateTo:"",EndDate:"",EndDateTo:"",ver:"v1",Page:1,PageSize:10,Order:""},ht=mt({id:"AssignmentcomponentLubricant",state:()=>({stateFilterData:{...ct},stateLastUsedFilterData:{...ct},statePageName:"assignmentcomponentLubricant",stateDisplayData:[],statePagination:new at,stateLoading:!1,statePaginationLoading:!1,stateEquipmentModelOption:[],statePsTypeOption:[],stateComponentOption:[],stateRecomLubricantOption:[],stateValueOption:[],stateUomOption:[],stateTaskNoOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,equipmentModelOption:t=>t.stateEquipmentModelOption,psTypeOption:t=>t.statePsTypeOption,componentOption:t=>t.stateComponentOption,recomLubricantOption:t=>t.stateRecomLubricantOption,valueOption:t=>t.stateValueOption,uomOption:t=>t.stateUomOption,taskNoOption:t=>t.stateTaskNoOption},actions:{async getData(t=!0){const s={EquipmentModel:this.stateFilterData.EquipmentModel,EquipmentModelTo:this.stateFilterData.EquipmentModelTo,PsType:this.stateFilterData.PsType,PsTypeTo:this.stateFilterData.PsTypeTo,Component:this.stateFilterData.Component,ComponentTo:this.stateFilterData.ComponentTo,RecomLubricant:this.stateFilterData.RecomLubricant,RecomLubricantTo:this.stateFilterData.RecomLubricantTo,Value:this.stateFilterData.Value,ValueTo:this.stateFilterData.ValueTo,Uom:this.stateFilterData.Uom,UomTo:this.stateFilterData.UomTo,TaskNo:this.stateFilterData.TaskNo,TaskNoTo:this.stateFilterData.TaskNoTo,StartDate:this.stateFilterData.StartDate?P(this.stateFilterData.StartDate):"",StartDateTo:this.stateFilterData.StartDateTo?P(this.stateFilterData.StartDateTo):"",EndDate:this.stateFilterData.EndDate?P(this.stateFilterData.EndDate):"",EndDateTo:this.stateFilterData.EndDateTo?P(this.stateFilterData.EndDateTo):"",Page:this.stateFilterData.Page.toString(),PageSize:this.stateFilterData.PageSize.toString(),Order:this.stateFilterData.Order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await q.get(j,"",new URLSearchParams(s).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const s=await q.get(be,"",new URLSearchParams(t).toString());this.stateEquipmentModelOption=R(s.data.result.content.equipmentModel),this.statePsTypeOption=R(s.data.result.content.psType),this.stateComponentOption=R(s.data.result.content.component),this.stateRecomLubricantOption=R(s.data.result.content.recomendedLubricant),this.stateValueOption=R(s.data.result.content.value),this.stateUomOption=R(s.data.result.content.uom),this.stateTaskNoOption=R(s.data.result.content.taskNo)}catch(s){console.log(s)}},async export(){const t={EquipmentModel:this.stateFilterData.EquipmentModel,EquipmentModelTo:this.stateFilterData.EquipmentModelTo,PsType:this.stateFilterData.PsType,PsTypeTo:this.stateFilterData.PsTypeTo,Component:this.stateFilterData.Component,ComponentTo:this.stateFilterData.ComponentTo,RecomLubricant:this.stateFilterData.RecomLubricant,RecomLubricantTo:this.stateFilterData.RecomLubricantTo,Value:this.stateFilterData.Value,ValueTo:this.stateFilterData.ValueTo,Uom:this.stateFilterData.Uom,UomTo:this.stateFilterData.UomTo,TaskNo:this.stateFilterData.TaskNo,TaskNoTo:this.stateFilterData.TaskNoTo,StartDate:this.stateFilterData.StartDate?P(this.stateFilterData.StartDate):"",StartDateTo:this.stateFilterData.StartDateTo?P(this.stateFilterData.StartDateTo):"",EndDate:this.stateFilterData.EndDate?P(this.stateFilterData.EndDate):"",EndDateTo:this.stateFilterData.EndDateTo?P(this.stateFilterData.EndDateTo):"",ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await q.getBlob(Te,"",new URLSearchParams(t).toString())).data}catch(s){console.log(s)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:s}){if(!t&&!s)this.stateFilterData.Order="";else{const e=s=="ascending"?"asc":"desc";this.stateFilterData.Order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.Page=this.statePagination.currentPage,await this.getData(!1)},setEquipmentModel(t){this.stateFilterData.EquipmentModel=t},setEquipmentModelTo(t){this.stateFilterData.EquipmentModelTo=t},setPsType(t){this.stateFilterData.PsType=t},setPsTypeTo(t){this.stateFilterData.PsTypeTo=t},setComponent(t){this.stateFilterData.Component=t},setComponentTo(t){this.stateFilterData.ComponentTo=t},setRecomLubricant(t){this.stateFilterData.RecomLubricant=t},setRecomLubricantTo(t){this.stateFilterData.RecomLubricantTo=t},setValue(t){this.stateFilterData.Value=t},setValueTo(t){this.stateFilterData.ValueTo=t},setUom(t){this.stateFilterData.Uom=t},setUomTo(t){this.stateFilterData.UomTo=t},setTaskNo(t){this.stateFilterData.TaskNo=t},setTaskNoTo(t){this.stateFilterData.TaskNoTo=t},setStartDate(t){this.stateFilterData.StartDate=t},setStartDateTo(t){this.stateFilterData.StartDateTo=t},setEndDate(t){this.stateFilterData.EndDate=t},setEndDateTo(t){this.stateFilterData.EndDateTo=t},async resetFilter(){this.stateFilterData.EquipmentModel="",this.stateFilterData.EquipmentModelTo="",this.stateFilterData.PsType="",this.stateFilterData.PsTypeTo="",this.stateFilterData.Component="",this.stateFilterData.ComponentTo="",this.stateFilterData.RecomLubricant="",this.stateFilterData.RecomLubricantTo="",this.stateFilterData.Value="",this.stateFilterData.ValueTo="",this.stateFilterData.Uom="",this.stateFilterData.UomTo="",this.stateFilterData.TaskNo="",this.stateFilterData.TaskNoTo="",this.stateFilterData.Component="",this.stateFilterData.ComponentTo="",this.stateFilterData.StartDate="",this.stateFilterData.StartDateTo="",this.stateFilterData.EndDate="",this.stateFilterData.EndDateTo="";const t=this.stateLastUsedFilterData.EquipmentModel!=="",s=this.stateLastUsedFilterData.EquipmentModelTo!=="",e=this.stateLastUsedFilterData.PsType!=="",g=this.stateLastUsedFilterData.PsTypeTo!=="",n=this.stateLastUsedFilterData.Component!=="",d=this.stateLastUsedFilterData.ComponentTo!=="",i=this.stateLastUsedFilterData.RecomLubricant!=="",u=this.stateLastUsedFilterData.RecomLubricantTo!=="",y=this.stateLastUsedFilterData.Value!=="",f=this.stateLastUsedFilterData.ValueTo!=="",F=this.stateLastUsedFilterData.Uom!=="",C=this.stateLastUsedFilterData.UomTo!=="",T=this.stateLastUsedFilterData.TaskNo!=="",_=this.stateLastUsedFilterData.TaskNoTo!=="",E=this.stateLastUsedFilterData.StartDate!=="",k=this.stateLastUsedFilterData.StartDateTo!=="",m=this.stateLastUsedFilterData.EndDate!=="",r=this.stateLastUsedFilterData.EndDateTo!=="";(t||s||e||g||n||d||i||u||y||f||F||C||T||_||E||k||m||r)&&await this.getData()},resetState(){this.stateFilterData={...ct},this.stateDisplayData=[],this.statePagination=new at,this.stateLoading=!1,this.statePaginationLoading=!1}}}),ft={mdAssignmentComponentLubricantId:0,equipmentModel:"",psType:"",component:"",taskNo:"",startDate:G(new Date),endDate:G(new Date("12/31/9999"))},lt=mt({id:"AssignmentcomponentLubricantForm",state:()=>({stateFormData:{...ft},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateComponentOption:[],stateComponentDetailOption:{},stateEquipmentModelOption:[],statePsTypeOption:[]}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading,componentOption:t=>t.stateComponentOption,psTypeOption:t=>t.statePsTypeOption,equipmentModelOption:t=>t.stateEquipmentModelOption},actions:{async getComponentLubriLookUp(){const t={ver:"v1"};try{const s=await q.get(ee,"",new URLSearchParams(t).toString());s.data.result.content&&(this.stateComponentOption=bt(s.data.result.content,"component",["recommendedLubricant","value","uom"]),this.stateComponentDetailOption=s.data.result.content)}catch(s){console.log(s)}},async getPsTypeLookUp(){const t={ver:"v1"};try{const s=await q.get(ae,"",new URLSearchParams(t).toString());this.statePsTypeOption=R(s.data.result.content.psType)}catch(s){console.log(s)}},async getEquipmentModelLookUp(){const t={ver:"v1",isEquipmentModel:"true"};try{const s=await q.get(oe,"",new URLSearchParams(t).toString());this.stateEquipmentModelOption=bt(s.data.result.content,"characteristicValue","characteristicValueDescription")}catch(s){console.log(s)}},async insertData(t){try{this.stateLoading=!0;const s={userAccount:t,ver:"v1"},e={};this.stateComponentDetailOption.component.forEach((d,i)=>{this.stateComponentDetailOption.component[i]==this.stateFormData.component&&(e.recommendedLubricant=this.stateComponentDetailOption.recommendedLubricant[i],e.value=this.stateComponentDetailOption.value[i],e.uom=this.stateComponentDetailOption.uom[i])});const g={mdAssignmentComponentLubricant:0,equipmentModel:this.stateFormData.equipmentModel,psType:this.stateFormData.psType,component:this.stateFormData.component,recomendedLubricant:e.recommendedLubricant,value:e.value,uom:e.uom,taskNo:this.stateFormData.taskNo,startDate:P(G(new Date(this.stateFormData.startDate))),endDate:P(G(new Date(this.stateFormData.endDate)))},n=await q.post(`${j}?${new URLSearchParams(s).toString()}`,g);n.data.title==="Error"?(this.stateErrors.push(n.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){this.stateError=s,this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},async updateData(t){try{this.stateLoading=!0;const s={userAccount:t,ver:"v1"},e={};this.stateComponentDetailOption.component.forEach((d,i)=>{this.stateComponentDetailOption.component[i]==this.stateFormData.component&&(e.recommendedLubricant=this.stateComponentDetailOption.recommendedLubricant[i],e.value=this.stateComponentDetailOption.value[i],e.uom=this.stateComponentDetailOption.uom[i])});const g={mdAssignmentComponentLubricant:this.stateFormData.mdAssignmentComponentLubricantId,equipmentModel:this.stateFormData.equipmentModel,psType:this.stateFormData.psType,component:this.stateFormData.component,recomendedLubricant:e.recommendedLubricant,value:e.value,uom:e.uom,taskNo:this.stateFormData.taskNo,startDate:P(G(new Date(this.stateFormData.startDate))),endDate:P(G(new Date(this.stateFormData.endDate)))},n=await q.post(`${ve}?${new URLSearchParams(s).toString()}`,g);n.data.title==="Error"?(this.stateErrors.push(n.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){this.stateError=s,this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.mdAssignmentComponentLubricantId=t.mdAssignmentComponentLubricantId||0,this.stateFormData.equipmentModel=t.equipmentModel||"",this.stateFormData.psType=t.psType||"",this.stateFormData.taskNo=t.taskNo||"",this.stateFormData.startDate=t.startDate||"",this.stateFormData.endDate=t.endDate||"",this.stateComponentDetailOption.component.forEach((s,e)=>{this.stateComponentDetailOption.component[e]==t.component&&this.stateComponentDetailOption.recommendedLubricant[e]==t.recomendedLubricant&&this.stateComponentDetailOption.value[e]==t.value&&this.stateComponentDetailOption.uom[e]==t.uom&&(this.stateFormData.component=s)})},resetState(){this.stateFormData={...ft},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),fe={key:0,style:{height:"100px"}},ye={key:0,class:"row justify-content-center"},Ee={key:1,class:"row justify-content-center"},Fe={class:"row justify-content-center"},_e=["onClick"],Se=z({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog"],setup(t,{emit:s}){const e=t,g=ht(),n=lt(),d=s,i=se(()=>(e.page-1)*10+1),u=Q(""),y=T=>{u.value=T.order;const _={prop:T.prop,order:T.order};g.setSort(_)},f=(T,_,E)=>Wt(T[E],_[E],u.value),F=()=>Zt(u.value),C=T=>{n.setFormData(T),d("show-dialog",null)};return(T,_)=>{const E=O("inline-svg"),k=O("el-tooltip"),m=nt("loading");return o(g).loading?B((S(),tt("div",fe,null,512)),[[m,o(g).loading]]):B((S(),U(o(Et),{key:1,data:e.listData,style:{width:"100%"},onSortChange:y,"empty-text":"No Data"},{default:h(()=>[a(o(b),{label:"No",width:"90",align:"center"},{default:h(r=>[D("span",null,X(o(i)+r.$index),1)]),_:1}),a(o(b),{prop:"equipmentModel",label:"Equipment Model",width:"200",sortable:"","sort-method":(r,l)=>f(r,l,"equipmentModel")},null,8,["sort-method"]),a(o(b),{prop:"psType",label:"PS Type",width:"200",sortable:"","sort-method":()=>F()},null,8,["sort-method"]),a(o(b),{prop:"component",label:"ID Component",width:"200",sortable:"","sort-method":(r,l)=>f(r,l,"component")},null,8,["sort-method"]),a(o(b),{prop:"recomendedLubricant",label:"Recommended Lubricants",width:"250",sortable:"","sort-method":(r,l)=>f(r,l,"recomendedLubricant")},null,8,["sort-method"]),a(o(b),{prop:"value",label:"Value",width:"110",sortable:"","sort-method":(r,l)=>f(r,l,"value")},null,8,["sort-method"]),a(o(b),{prop:"uom",label:"UOM",width:"100",sortable:"","sort-method":(r,l)=>f(r,l,"uom")},null,8,["sort-method"]),a(o(b),{prop:"taskNo",label:"Task No",width:"100",sortable:"","sort-method":(r,l)=>f(r,l,"taskNo")},null,8,["sort-method"]),a(o(b),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:h(r=>[D("span",null,X(o(Tt)(r.row.startDate)),1)]),_:1}),a(o(b),{prop:"endDate",label:"End Date",align:"center",width:"170",sortable:""},{default:h(r=>[D("span",null,X(o(Tt)(r.row.endDate)),1)]),_:1}),a(o(b),{prop:"isActive",label:"Is Active",width:"100",sortable:""},{default:h(r=>[r.row.isActive?(S(),tt("div",ye,[a(E,{src:"/media/svg/tables/rows/check.svg"})])):(S(),tt("div",Ee,[a(E,{src:"/media/svg/tables/rows/minus.svg"})]))]),_:1}),a(o(b),{prop:"changedOn",label:"Changed on",align:"center",width:"150",sortable:""},{default:h(r=>[D("span",null,X(o(Jt)(r.row.changedOn)),1)]),_:1}),a(o(b),{prop:"changedBy",label:"Changed by",sortable:"",width:"300","sort-method":(r,l)=>f(r,l,"changedBy")},null,8,["sort-method"]),a(o(b),{label:"",width:"80"},{default:h(r=>[D("div",Fe,[a(k,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:h(()=>[D("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:l=>C(r.row)},[a(E,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,_e)]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[m,o(g).loading]])}}}),Ce={class:"col-md-6 fv-row fv-plugins-icon-container"},ke={class:"col-md-6 fv-row fv-plugins-icon-container"},Le={class:"dialog-footer"},Pe=z({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const e=t,g=s,n=lt(),d=ut(),i=it(e,"visibility"),u=M(()=>n.formData),y=M(()=>n.errors),f=M(()=>n.isError),F=Ct().shape({component:V().required("Component Lubricant is mandatory"),psType:V().required("PS Type is mandatory"),taskNo:V().required("Task No is mandatory"),equipmentModel:V().required("Equipment Model is mandatory"),startDate:st().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:st().required("End Date is mandatory").min(kt("startDate"),"End date must be later than start date").typeError("End Date is mandatory")}),C=()=>{_(""),E(""),k(""),m(""),r(""),l("")},T=(c=!1)=>{L(),C(),n.resetState(),g("handle-close",c)},_=c=>{u.value.component=c},E=c=>{u.value.equipmentModel=c},k=c=>{u.value.psType=c},m=c=>{u.value.taskNo=c},r=c=>{u.value.startDate=c},l=c=>{u.value.endDate=c},I=async()=>{L(),await F.validate(u.value,{abortEarly:!1}).catch(c=>{n.setErrors(c.errors)}),!f.value&&et("Are you sure you want to submit ?").then(async c=>{c.isConfirmed&&n.insertData(d.user.Name).then(()=>{n.isError||pt("Form has been successfully submitted!","Ok").then(()=>{T(!0)})})})},L=()=>{n.setErrors([])};return(c,v)=>{const N=O("el-button"),A=O("el-dialog"),$=nt("loading");return B((S(),U(A,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=x=>i.value=x),title:"New Data",width:"40%",onClose:v[1]||(v[1]=x=>T())},{footer:h(()=>[D("span",Le,[a(N,{type:"primary",onClick:I,disabled:o(n).loading},{default:h(()=>[w("Submit")]),_:1},8,["disabled"]),a(N,{type:"secondary",onClick:T,disabled:o(n).loading},{default:h(()=>[w("Close")]),_:1},8,["disabled"])])]),default:h(()=>[a(Ft,{name:"fade"},{default:h(()=>[f.value?(S(),U(Lt,{key:0,errorMessages:y.value,onResetForm:L},null,8,["errorMessages"])):rt("",!0)]),_:1}),B((S(),U(o(St),{id:"kt_filter_form",class:"row g-9 my-4"},{default:h(()=>[a(Y,{value:u.value.equipmentModel,placeholder:"Add Equipment Model",label:"Equipment Model",name:"equipmentModel",onHandleChange:E,options:o(n).equipmentModelOption},null,8,["value","options"]),a(Y,{value:u.value.psType,placeholder:"Add PS Type",label:"PS Type",name:"psType",onHandleChange:k,options:o(n).psTypeOption},null,8,["value","options"]),a(Y,{value:u.value.component,placeholder:"Add Component Lubricant",label:"Component Lubricant",name:"component",onHandleChange:_,options:o(n).componentOption},null,8,["value","options"]),a(_t,{value:u.value.taskNo,placeholder:"Add Task No",label:"Task No",name:"taskNo",max:10,onHandleChange:m},null,8,["value"]),D("div",Ce,[a(ot,{value:u.value.startDate,placeholder:"Add Start Date",label:"Start Date",name:"startDate",onHandleChange:r},null,8,["value"])]),D("div",ke,[a(ot,{value:u.value.endDate,placeholder:"Add End Date",label:"End Date",name:"endDate",onHandleChange:l},null,8,["value"])])]),_:1})),[[$,o(n).loading]])]),_:1},8,["modelValue"])),[[$,o(n).loading]])}}}),Ue={class:"col-md-6 fv-row fv-plugins-icon-container"},we={class:"col-md-6 fv-row fv-plugins-icon-container"},Oe={class:"dialog-footer"},Ne=z({__name:"FormEditDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const e=t,g=s,n=lt(),d=ut(),i=it(e,"visibility"),u=M(()=>n.formData),y=M(()=>n.errors),f=M(()=>n.isError),F=Ct().shape({component:V().required("Component Lubricant is mandatory"),psType:V().required("PS Type is mandatory"),taskNo:V().required("Task No is mandatory"),equipmentModel:V().required("Equipment Model is mandatory"),startDate:st().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:st().required("End Date is mandatory").min(kt("startDate"),"End date must be later than start date").typeError("End Date is mandatory")}),C=()=>{_(""),E(""),k(""),m(""),r(""),l("")},T=(c=!1)=>{C(),n.resetState(),L(),g("handle-close",c)},_=c=>{u.value.component=c},E=c=>{u.value.equipmentModel=c},k=c=>{u.value.psType=c},m=c=>{u.value.taskNo=c},r=c=>{u.value.startDate=c},l=c=>{u.value.endDate=c},I=async()=>{L(),await F.validate(u.value,{abortEarly:!1}).catch(c=>{n.setErrors(c.errors)}),!f.value&&et("Are you sure you want to submit ?").then(async c=>{c.isConfirmed&&n.updateData(d.user.Name).then(()=>{n.isError||pt("Form has been successfully submitted!","Ok").then(()=>{T(!0)})})})},L=()=>{n.setErrors([])};return(c,v)=>{const N=O("el-button"),A=O("el-dialog"),$=nt("loading");return B((S(),U(A,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=x=>i.value=x),title:"Update Data",width:"40%",onClose:v[1]||(v[1]=x=>T())},{footer:h(()=>[D("span",Oe,[a(N,{type:"primary",onClick:I,disabled:o(n).loading},{default:h(()=>[w("Submit")]),_:1},8,["disabled"]),a(N,{type:"secondary",onClick:T,disabled:o(n).loading},{default:h(()=>[w("Close")]),_:1},8,["disabled"])])]),default:h(()=>[a(Ft,{name:"fade"},{default:h(()=>[f.value?(S(),U(Lt,{key:0,errorMessages:y.value,onResetForm:L},null,8,["errorMessages"])):rt("",!0)]),_:1}),B((S(),U(o(St),{id:"kt_filter_form",class:"row g-9 my-4"},{default:h(()=>[a(Y,{value:u.value.equipmentModel,placeholder:"Add Equipment Model",label:"Equipment Model",name:"equipmentModel",onHandleChange:E,options:o(n).equipmentModelOption},null,8,["value","options"]),a(Y,{value:u.value.psType,placeholder:"Add PS Type",label:"PS Type",name:"psType",onHandleChange:k,options:o(n).psTypeOption},null,8,["value","options"]),a(Y,{value:u.value.component,placeholder:"Add Component Lubricant",label:"Component Lubricant",name:"Component",onHandleChange:_,options:o(n).componentOption},null,8,["value","options"]),a(_t,{value:u.value.taskNo,placeholder:"Add Task No",label:"Task No",name:"taskNo",max:10,onHandleChange:m},null,8,["value"]),D("div",Ue,[a(ot,{value:u.value.startDate,placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:r},null,8,["value"])]),D("div",we,[a(ot,{value:u.value.endDate,placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:l},null,8,["value"])])]),_:1})),[[$,o(n).loading]])]),_:1},8,["modelValue"])),[[$,o(n).loading]])}}}),Dt=mt({id:"AssignmentcomponentLubricantBulk",state:()=>({statePagination:new at,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const s={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await q.post(`${De}?${new URLSearchParams(s).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:s}){const e={userAccount:t,ver:"v1"},g=`${ge}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const n=await q.postImages(g,s);n.data.statusCode==200?n.data.result.isError?(this.stateIsError=!0,this.stateError=n.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=n.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=ce.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=n.data.result.isError,this.stateError=n.data.result.message)}catch(n){console.log(n),this.stateIsError=!0,this.stateError=n.response.data.result.message}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(te(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new at,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),qe={class:"icon"},Me=z({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const s=t,e=Dt(),g=M(()=>(s.page-1)*10+1),n=d=>{const i={prop:d.prop,order:d.order};e.setSort(i)};return(d,i)=>{const u=O("inline-svg");return S(),U(o(Et),{data:s.listData,style:{width:"100%"},onSortChange:n,"empty-text":"No Data"},{default:h(()=>[a(o(b),{label:"No",width:"60",align:"center"},{default:h(y=>[D("span",null,X(g.value+y.$index),1)]),_:1}),a(o(b),{prop:"equipmentModel",label:"Equipment Model",width:"200",sortable:""}),a(o(b),{prop:"psType",label:"PS Type",width:"200",sortable:""}),a(o(b),{prop:"component",label:"ID Component",width:"200",sortable:""}),a(o(b),{prop:"recomendedLubricant",label:"Recommended Lubricants",width:"250",sortable:""}),a(o(b),{prop:"value",label:"Value",width:"150",sortable:""}),a(o(b),{prop:"uom",label:"UOM",width:"150",sortable:""}),a(o(b),{prop:"taskNo",label:"Task No",width:"150",sortable:""}),a(o(b),{prop:"startDate",label:"Start Date",width:"120",sortable:""}),a(o(b),{prop:"endDate",label:"End Date",width:"100",sortable:""}),a(o(b),{prop:"validationReason",label:"Remark",width:"200",sortable:""}),a(o(b),{prop:"isValid",label:"Status","min-width":"100",align:"center",sortable:""},{default:h(y=>[D("div",qe,[a(u,{src:y.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),gt=t=>(ne("data-v-eca75be7"),t=t(),ie(),t),Ie=gt(()=>D("div",{class:"text-center"},null,-1)),Re=gt(()=>D("div",{class:"mb-3"},[D("span",null,[w(" Download template "),D("a",{href:"documents/MasterDataAssignmentComponentLubricant.xlsx",target:"_blank",id:"link-download"},"here"),w(" before uploading file ")])],-1)),Ve=gt(()=>D("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[D("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),Ae={class:"card"},$e={class:"card-body grid-padding"},xe={class:"dialog-footer"},He=z({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:s}){const e=t,g=s,n=ut(),d=Dt(),i=it(e,"visibility"),u=()=>{const m=pe(d.validatedData,r=>{console.log(r);const l=r;return{mdAssignmentComponentLubricantId:0,equipmentModel:l.equipmentModel,psType:l.psType,component:l.component,recomendedLubricant:l.recomendedLubricant,value:l.value,uom:l.uom,taskNo:l.taskNo,startDate:l.startDate,endDate:l.endDate}});return Object.values(m)},y=()=>{const m=document.getElementById("link-download");m&&m.click()},f=()=>{d.validatedData.length>0?et("Cancel Upload Data?","Confirm").then(r=>{r.isConfirmed&&C()}):C()},F=async m=>{await d.upload({userAccount:n.user.Name,excelFile:m}),d.stateError&&Z(d.error)},C=(m=!1)=>{d.resetState(),g("handle-close",m)},T=m=>{d.setIsUploadedState(m)},_=m=>{d.setPage(m)},E=()=>{if(d.validatedData.length<1){y();return}const m=["EQUIPMENT MODEL","PS TYPE","COMPONENT","RECOMENDED LUBRICANT","VALUE","UOM","TASK NO","START DATE","END DATE","REMARK","STATUS"],r=d.validatedData.map(l=>({equipmentModel:l.equipmentModel,psType:l.psType,component:l.component,recomendedLubricant:l.recomendedLubricant,value:l.value,uom:l.uom,taskNo:l.taskNo,startDate:l.startDate,endDate:l.endDate,remark:l.validationReason,status:l.isValid?"OK":"Error"}));Gt("AssignmentComponentLubricant",m,r)},k=async()=>{if(d.displayData.length<1){Z("There is no data to submit");return}if(d.isError){Z("There is still invalid row(s)");return}et("Are you sure you want to submit ?").then(async m=>{if(m.isConfirmed){const r=u();if(d.setBulkData(r),await d.bulkInsert(n.user.Name),d.isError){Z(d.stateError);return}pt("Form has been successfully submitted!","Ok").then(()=>{C(!0)})}})};return(m,r)=>{const l=O("el-button"),I=O("el-dialog"),L=nt("loading");return S(),U(I,{title:"Upload Bulk Data",modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=c=>i.value=c),"before-close":f,width:"70%","custom-class":"upload-modal"},{footer:h(()=>[D("div",null,[D("span",xe,[a(l,{type:"success",onClick:E},{default:h(()=>[w("Download")]),_:1}),a(l,{type:"primary",onClick:k},{default:h(()=>[w("Upload")]),_:1}),a(l,{type:"success",onClick:f},{default:h(()=>[w("Cancel")]),_:1})])])]),default:h(()=>[Ie,Re,B(a(ue,{isSubmissionUploadSuccess:o(d).isUploaded,onHandleCloseUploadedFile:f,onHandleUpload:F,onHandleSetIsExcelFileUploaded:T},null,8,["isSubmissionUploadSuccess"]),[[L,o(d).uploadLoading]]),Ve,D("div",Ae,[D("div",$e,[a(Me,{"list-data":o(d).displayData,page:o(d).pagination.currentPage},null,8,["list-data","page"])])]),o(d).displayData.length>0?(S(),U(yt,{key:0,onRaisePageChange:r[0]||(r[0]=c=>_(c)),currentPage:o(d).pagination.currentPage,totalPage:o(d).pagination.totalPage,totalPageSize:o(d).pagination.totalPageSize,startPaginationIndex:o(d).pagination.startPaginationIndex,endPaginationIndex:o(d).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):rt("",!0)]),_:1},8,["modelValue"])}}}),Be=me(He,[["__scopeId","data-v-eca75be7"]]),ze={class:"row g-9 my-4"},je={class:"dialog-footer"},Ke=z({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const e=ht(),g=t,n=s,d=it(g,"visibility"),i=M(()=>e.filterData),u=()=>{y(),e.resetFilter()},y=()=>{n("handle-close",!1)},f=p=>{e.setEquipmentModel(p)},F=p=>{e.setEquipmentModelTo(p)},C=p=>{e.setPsType(p)},T=p=>{e.setPsTypeTo(p)},_=p=>{e.setComponent(p)},E=p=>{e.setComponentTo(p)},k=p=>{e.setRecomLubricant(p)},m=p=>{e.setRecomLubricantTo(p)},r=p=>{e.setValue(p)},l=p=>{e.setValueTo(p)},I=p=>{e.setUom(p)},L=p=>{e.setUomTo(p)},c=p=>{e.setTaskNo(p)},v=p=>{e.setTaskNoTo(p)},N=p=>{e.setStartDate(p)},A=p=>{e.setStartDateTo(p)},$=p=>{e.setEndDate(p)},x=p=>{e.setEndDateTo(p)},Pt=()=>{const p=e.lastUsedFilterData.EquipmentModel!==e.filterData.EquipmentModel,K=e.lastUsedFilterData.EquipmentModelTo!==e.filterData.EquipmentModelTo,J=e.lastUsedFilterData.PsType!==e.filterData.PsType,dt=e.lastUsedFilterData.PsTypeTo!==e.filterData.PsTypeTo,W=e.lastUsedFilterData.Component!==e.filterData.Component,Ut=e.lastUsedFilterData.ComponentTo!==e.filterData.ComponentTo,wt=e.lastUsedFilterData.RecomLubricant!==e.filterData.RecomLubricant,Ot=e.lastUsedFilterData.RecomLubricantTo!==e.filterData.RecomLubricantTo,Nt=e.lastUsedFilterData.Value!==e.filterData.Value,qt=e.lastUsedFilterData.ValueTo!==e.filterData.ValueTo,Mt=e.lastUsedFilterData.Uom!==e.filterData.Uom,It=e.lastUsedFilterData.UomTo!==e.filterData.UomTo,Rt=e.lastUsedFilterData.TaskNo!==e.filterData.TaskNo,Vt=e.lastUsedFilterData.TaskNoTo!==e.filterData.TaskNoTo,At=e.lastUsedFilterData.StartDate!==e.filterData.StartDate,$t=e.lastUsedFilterData.StartDateTo!==e.filterData.StartDateTo,xt=e.lastUsedFilterData.EndDate!==e.filterData.EndDate,Ht=e.lastUsedFilterData.EndDateTo!==e.filterData.EndDateTo;n("handle-close",p||K||J||dt||W||Ut||wt||Ot||Nt||qt||Mt||It||Rt||Vt||At||$t||xt||Ht)};return(p,K)=>{const J=O("el-button"),dt=O("el-dialog");return S(),U(dt,{modelValue:d.value,"onUpdate:modelValue":K[0]||(K[0]=W=>d.value=W),title:"Filter",width:"60%",onClose:K[1]||(K[1]=W=>y())},{footer:h(()=>[D("span",je,[a(J,{type:"secondary",onClick:u},{default:h(()=>[w("Reset")]),_:1}),a(J,{type:"primary",onClick:Pt},{default:h(()=>[w("Filter")]),_:1})])]),default:h(()=>[D("div",ze,[a(H,{"value-from":i.value.EquipmentModel,"value-to":i.value.EquipmentModelTo,label:"Equipment Model",options:o(e).equipmentModelOption,onHandleChangeFrom:f,onHandleChangeTo:F},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.PsType,"value-to":i.value.PsTypeTo,label:"PS Type",options:o(e).psTypeOption,onHandleChangeFrom:C,onHandleChangeTo:T},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.Component,"value-to":i.value.ComponentTo,label:"ID Component",options:o(e).componentOption,onHandleChangeFrom:_,onHandleChangeTo:E},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.RecomLubricant,"value-to":i.value.RecomLubricantTo,label:"Recommended Lubricants",name:"RecommendedLubricant",options:o(e).recomLubricantOption,onHandleChangeFrom:k,onHandleChangeTo:m},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.Value,"value-to":i.value.ValueTo,label:"Value",name:"Value",options:o(e).valueOption,onHandleChangeFrom:r,onHandleChangeTo:l},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.Uom,"value-to":i.value.UomTo,label:"UOM",name:"Uom",options:o(e).uomOption,onHandleChangeFrom:I,onHandleChangeTo:L},null,8,["value-from","value-to","options"]),a(H,{"value-from":i.value.TaskNo,"value-to":i.value.TaskNoTo,label:"Task No",name:"TaskNo",options:o(e).taskNoOption,onHandleChangeFrom:c,onHandleChangeTo:v},null,8,["value-from","value-to","options"]),a(vt,{"value-from":i.value.StartDate?i.value.StartDate.toString():"","value-to":i.value.StartDateTo?i.value.StartDateTo.toString():"",label:"Start Date",name:"StartDate",placeholder:"Pick a date",onHandleChangeFrom:N,onHandleChangeTo:A},null,8,["value-from","value-to"]),a(vt,{"value-from":i.value.EndDate?i.value.EndDate.toString():"","value-to":i.value.EndDateTo?i.value.EndDateTo.toString():"",label:"End Date",name:"EndDate",placeholder:"Pick a date",onHandleChangeFrom:$,onHandleChangeTo:x},null,8,["value-from","value-to"])])]),_:1},8,["modelValue"])}}}),Ge={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},Ye=D("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),Qe={class:"d-flex justify-content-between align-items-center"},Xe={class:"card"},Je={class:"card-body grid-padding"},We={class:"my-5"},lo=z({__name:"Index",setup(t){const s=Bt(),e=ht(),g=lt(),n=Dt(),d=Q(!1),i=Q(!1),u=Q(!1),y=Q(!1),f=M(()=>e.displayData),F=M(()=>e.pagination),C=v=>{e.setPage(v)};re(async()=>{s.dispatch(jt.ACTIVE_PAGE,"IronLake"),zt("Assignment Component Lubricant",[{pageName:"Iron Lake",pageRoute:"ironlake"},{pageName:"Parameter",pageRoute:"assignmentcomponentlubricant"},{pageName:"Assignment Component Lubricant",pageRoute:"assignmentcomponentlubricant"}]),e.setPage(1),e.getLookup(),g.getComponentLubriLookUp(),g.getPsTypeLookUp(),g.getEquipmentModelLookUp()}),le(()=>{e.resetState(),g.resetState(),n.resetState()});const T=async()=>{await e.setPage(1),await e.getLookup(),await g.getComponentLubriLookUp(),await g.getPsTypeLookUp(),await g.getEquipmentModelLookUp()},_=()=>{d.value=!0},E=async v=>{d.value=!1,v&&await T()},k=()=>{i.value=!0},m=async v=>{i.value=!1,v&&await T()},r=()=>{u.value=!0},l=async v=>{u.value=!1,v&&await T()},I=async()=>{const v=await e.export();he.saveAs(new Blob([v],{type:"application/octet-stream"}),"Assignment Component Lubricant.xlsx")},L=()=>{y.value=!0},c=async v=>{y.value=!1,v&&await T()};return(v,N)=>(S(),tt(de,null,[D("div",Ge,[Ye,D("div",Qe,[a(Yt,{onShowDialog:_}),a(Kt,{onShowDialog:r}),a(Xt,{onHandleDownload:I}),a(Qt,{onShowDialog:L})])]),D("div",Xe,[D("div",Je,[a(Se,{"list-data":f.value,page:F.value.currentPage,onShowDialog:k},null,8,["list-data","page"])])]),D("div",We,[o(e).paginationLoading?rt("",!0):(S(),U(yt,{key:0,onRaisePageChange:N[0]||(N[0]=A=>C(A)),currentPage:F.value.currentPage,totalPage:F.value.totalPage,totalPageSize:F.value.totalPageSize,startPaginationIndex:F.value.startPaginationIndex,endPaginationIndex:F.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),a(Pe,{visibility:d.value,onHandleClose:E},null,8,["visibility"]),a(Ne,{visibility:i.value,onHandleClose:m},null,8,["visibility"]),a(Ke,{visibility:u.value,onHandleClose:l},null,8,["visibility"]),a(Be,{visibility:y.value,onHandleClose:c},null,8,["visibility"])],64))}});export{lo as default};
