import{u as Q}from"./useMenuStore-CD5Gmvif.js";import{a as Z}from"./breadcrumb-BYmEOf4C.js";import{c as g,a as L,s as f,A as tt}from"./index-BuVmIl8K.js";import{P as et}from"./Pagination-D-xfdYmn.js";import{P as V}from"./Pagination-BiobnanQ.js";import{d as at}from"./pinia-BjOS2_Ao.js";import{m as q}from"./mapOption-CeGMwmH0.js";import{w as _,q as w}from"./date-format-8-IvfSl3.js";import{_ as E}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import{k as R,c as m,p as h,aa as C,aB as y,C as ot,b4 as X,s as d,x as b,R as $,Y as M,y as x,q as O,F as Y,$ as st,r as N,d as J,o as nt,u as i,B as it,a7 as lt,L as rt,A as pt}from"./@vue-BypzYtbH.js";import{_ as j}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-CCwjwK39.js";import{C as dt}from"./urls-Cljsxeb-.js";import{_ as F,b as ut}from"./element-plus-BeWdvTRa.js";import{b as S}from"./table-sort-Bpdq_Uwn.js";import{F as K}from"./file-saver-CwTBvle_.js";import{_ as ct}from"./nw-img-vue-CR837WER.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./vue-router-iNp9kJ0K.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./lodash-DrHMlsdo.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./moment-C5S46NFB.js";const B="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_component_health_data",mt=`${B}`,ht=`${B}/export_all`,gt=`${B}/export_row`,k="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/component_health_data/lookup",Dt=t=>(t.setMonth(t.getMonth()-1),t.setDate(1),t),A={site:"Blackwater",group:"Rear Dump Truck",model:"930E-4 HPI",equipment:["DT0700"],component:["Engine"],startDate:_(Dt(new Date)),endDate:_(new Date),ver:"v1",page:1,pageSize:10,order:""},vt={site:!1,group:!1,model:!1,equipment:!1,component:!1},G=at({id:"componentHealthDataList",state:()=>({stateFilterData:{...A},stateLastUsedFilterData:{...A},stateFilterLoading:{...vt},statePageName:"componentHealthData",stateDisplayData:[],statePagination:new V,stateLoading:!1,statePaginationLoading:!1,stateSiteOption:[],stateGroupOption:[],stateModelOption:[],stateEquipmentOption:[],stateComponentOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,siteOption:t=>t.stateSiteOption,groupOption:t=>t.stateGroupOption,modelOption:t=>t.stateModelOption,equipmentOption:t=>t.stateEquipmentOption,componentOption:t=>t.stateComponentOption,filterLoading:t=>t.stateFilterLoading},actions:{async getData(t=!0){const a={ver:"v1"},e={site:this.stateFilterData.site,group:this.stateFilterData.group,model:this.stateFilterData.model,equipment:this.stateFilterData.equipment,component:this.stateFilterData.component,startDate:this.stateFilterData.startDate?w(_(new Date(this.stateFilterData.startDate))):"",endDate:this.stateFilterData.endDate?w(_(new Date(this.stateFilterData.endDate))):"",page:this.stateFilterData.page,pageSize:this.stateFilterData.pageSize,order:this.stateFilterData.order};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const s=await g.post(`${mt}/data?${new URLSearchParams(a).toString()}`,e);this.stateDisplayData=s.data.result.content,this.setTotalPage(s.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(s){!s.response.data&&(s!=null&&s.includes("Request failed with status code 401"))&&L().setLoggedIn(!1),f("IRONS",s),console.log(s)}this.stateLoading=!1},async getLookupSite(){this.stateFilterLoading.site=!0;const t={ver:"v1"},a={site:null,group:null,model:null,equipment:[],component:[],ver:this.stateFilterData.ver};try{const e=await g.post(`${k}?${new URLSearchParams(t).toString()}`,a);this.stateSiteOption=q(e.data.result.content.site)}catch(e){e.response.data.statusCode==401&&L().setLoggedIn(!1),f("IRONS",e),console.log(e)}this.stateFilterLoading.site=!1},setDefaultFilter(t){this.stateFilterData.site=t},async getLookupGroup(){this.stateFilterLoading.group=!0;const t={ver:"v1"},a={site:this.stateFilterData.site,group:null,model:null,equipment:[],component:[],ver:this.stateFilterData.ver};try{const e=await g.post(`${k}?${new URLSearchParams(t).toString()}`,a);this.stateGroupOption=q(e.data.result.content.group)}catch(e){e.response.data.statusCode==401&&L().setLoggedIn(!1),f("IRONS",e),console.log(e)}this.stateFilterLoading.group=!1},async getLookupModel(){this.stateFilterLoading.model=!0;const t={ver:"v1"},a={site:this.stateFilterData.site,group:this.stateFilterData.group,model:null,equipment:[],component:[],ver:this.stateFilterData.ver};try{const e=await g.post(`${k}?${new URLSearchParams(t).toString()}`,a);this.stateModelOption=q(e.data.result.content.model)}catch(e){e.response.data.statusCode==401&&L().setLoggedIn(!1),f("IRONS",e),console.log(e)}this.stateFilterLoading.model=!1},async getLookupEquipment(){this.stateFilterLoading.equipment=!0;const t={ver:"v1"},a={site:this.stateFilterData.site,group:this.stateFilterData.group,model:this.stateFilterData.model,equipment:[],component:[],ver:this.stateFilterData.ver};try{const e=await g.post(`${k}?${new URLSearchParams(t).toString()}`,a);this.stateEquipmentOption=q(e.data.result.content.equipment)}catch(e){e.response.data.statusCode==401&&L().setLoggedIn(!1),f("IRONS",e),console.log(e)}this.stateFilterLoading.equipment=!1},async getLookupComponent(){this.stateFilterLoading.component=!0;const t={ver:"v1"},a={site:this.stateFilterData.site,group:this.stateFilterData.group,model:this.stateFilterData.model,equipment:this.stateFilterData.equipment,component:[],ver:this.stateFilterData.ver};try{const e=await g.post(`${k}?${new URLSearchParams(t).toString()}`,a);this.stateComponentOption=q(e.data.result.content.component)}catch(e){e.response.data.statusCode==401&&L().setLoggedIn(!1),f("IRONS",e),console.log(e)}this.stateFilterLoading.component=!1},async exportAll(){const t={ver:"v1"},a={site:this.stateFilterData.site,group:this.stateFilterData.group,model:this.stateFilterData.model,equipment:this.stateFilterData.equipment,component:this.stateFilterData.component,startDate:this.stateFilterData.startDate?w(_(new Date(this.stateFilterData.startDate))):"",endDate:this.stateFilterData.endDate?w(_(new Date(this.stateFilterData.endDate))):""};try{return(await g.postBlob(`${ht}?${new URLSearchParams(t).toString()}`,a)).data}catch(e){f("IRONS",e),console.log(e)}},async exportRow({site:t,group:a,model:e,equipment:s,component:o,sourceType:l}){const r={site:t,group:a,model:e,equipment:s,component:o,sourceType:l,startDate:this.stateFilterData.startDate?w(_(new Date(this.stateFilterData.startDate))):"",endDate:this.stateFilterData.endDate?w(_(new Date(this.stateFilterData.endDate))):"",ver:this.stateFilterData.ver};try{return(await g.getBlob(gt,"",new URLSearchParams(r).toString())).data}catch(n){f("IRONS",n),console.log(n)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:a}){if(!t&&!a)this.stateFilterData.order="";else{const e=a=="ascending"?"asc":"desc";this.stateFilterData.order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1)},setSite(t){this.stateFilterData.site=t},setGroup(t){this.stateFilterData.group=t},setModel(t){this.stateFilterData.model=t},setEquipment(t){t.length!=0?this.stateFilterData.equipment=[...t]:this.stateFilterData.equipment=[]},setComponent(t){t.length!=0?this.stateFilterData.component=[...t]:this.stateFilterData.component=[]},setStartDate(t){this.stateFilterData.startDate=t},setEndDate(t){this.stateFilterData.endDate=t},async resetFilter(){this.stateFilterData.site="",this.stateFilterData.group="",this.stateFilterData.model="",this.stateFilterData.equipment=[],this.stateFilterData.component=[],this.stateFilterData.startDate="",this.stateFilterData.endDate="";const t=this.stateLastUsedFilterData.site!=="",a=this.stateLastUsedFilterData.group!=="",e=this.stateLastUsedFilterData.model!=="",s=this.stateLastUsedFilterData.equipment.length!==0,o=this.stateLastUsedFilterData.component.length!==0,l=this.stateLastUsedFilterData.startDate!=="",r=this.stateLastUsedFilterData.endDate!=="";(t||a||e||s||o||l||r)&&await this.getData()},resetState(){this.stateFilterData={...A},this.stateDisplayData=[],this.statePagination=new V,this.stateLoading=!1,this.statePaginationLoading=!1}}}),W=R({__name:"MultiSelectInput",props:{value:{required:!0,type:Array},gridClass:{required:!1,type:String,default:""},name:{required:!0,type:String},label:{required:!1,type:String},options:{required:!0,type:Array},placeholder:{required:!1,type:String,default:"Please Select"},isDisabled:{required:!1,type:Boolean,default:!1},labelClass:{required:!1,type:String,default:"text-dark"},loading:{required:!1,type:Boolean,default:!1},popperClass:{required:!1,type:String,default:""}},emits:["handleChange"],setup(t,{emit:a}){const e=t,s=a,o=m({get:()=>e.value,set:l=>{s("handleChange",l)}});return(l,r)=>{const n=$("el-option"),D=$("el-select"),v=$("el-form-item"),p=M("loading");return h(),C("div",{class:X(["fv-row",t.gridClass])},[y("label",{class:X(`form-label fs-6 fw-bolder ${t.labelClass||"text-dark"}`)},ot(t.label),3),d(v,{class:"col"},{default:b(()=>[x((h(),O(D,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=c=>o.value=c),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",class:"w-100",placeholder:t.placeholder,clearable:"",filterable:"",disabled:t.isDisabled,"popper-class":t.popperClass},{default:b(()=>[(h(!0),C(Y,null,st(t.options,c=>(h(),O(n,{key:c,label:c.label,value:c.value,selected:t.value&&t.value.includes(c.value)},null,8,["label","value","selected"]))),128))]),_:1},8,["modelValue","placeholder","disabled","popper-class"])),[[p,t.loading]])]),_:1})],2)}}}),ft={class:"d-flex justify-content-between"},_t=R({__name:"Filters",setup(t){const a=G(),e=L(),s=N(!1),o=m(()=>a.filterData),l=m(()=>a.filterLoading),r=m(()=>e.user.EmployeeId);J(r,async()=>{await I()},{deep:!0});const n=async u=>{a.setSite(u),await a.getLookupGroup()},D=async u=>{a.setGroup(u),await a.getLookupModel()},v=async u=>{a.setModel(u),await a.getLookupEquipment()},p=async u=>{a.setEquipment(u),await a.getLookupComponent()},c=u=>{a.setComponent(u)},U=u=>{a.setStartDate(u)},P=u=>{a.setEndDate(u)},I=async()=>{if(r.value){await H(e.user.EmployeeId)!="AU02"&&(s.value=!0,await n(e.user.Location));return}a.setDefaultFilter("Blackwater")},H=async u=>{const T={employeeId:u,page:"1",pageSize:"1",ver:"v1"};try{return(await g.get(dt,"",new URLSearchParams(T).toString())).data.result.content[0].Location}catch(z){console.log(z)}return""};return nt(async()=>{await I()}),(u,T)=>(h(),C("div",ft,[d(E,{"is-disabled":s.value,value:o.value.site,isLoading:l.value.site,label:"Site",labelClass:"text-white",popperClass:"component_health_data-dropdown",name:"Site",options:i(a).siteOption,class:"me-2 component_health_data-filter",onHandleChange:n},null,8,["is-disabled","value","isLoading","options"]),d(E,{value:o.value.group,isLoading:l.value.group,label:"Group",labelClass:"text-white",popperClass:"component_health_data-dropdown",name:"Group",options:i(a).groupOption,class:"me-2 component_health_data-filter",onHandleChange:D},null,8,["value","isLoading","options"]),d(E,{value:o.value.model,isLoading:l.value.model,label:"Model",labelClass:"text-white",popperClass:"component_health_data-dropdown",name:"Model",options:i(a).modelOption,class:"me-2 component_health_data-filter",onHandleChange:v},null,8,["value","isLoading","options"]),d(W,{value:o.value.equipment,isLoading:l.value.equipment,label:"Equipment",labelClass:"text-white",popperClass:"component_health_data-dropdown",name:"Equipment",options:i(a).equipmentOption,class:"me-2 component_health_data-filter",onHandleChange:p},null,8,["value","isLoading","options"]),d(W,{value:o.value.component,isLoading:l.value.component,label:"Component",labelClass:"text-white",popperClass:"component_health_data-dropdown",name:"Component",options:i(a).componentOption,class:"me-2 component_health_data-filter",onHandleChange:c},null,8,["value","isLoading","options"]),d(j,{value:o.value.startDate,placeholder:"Select Start Date",label:"Start Date",labelClass:"text-white",name:"StartDate",class:"me-2 component_health_data-filter",onHandleChange:U},null,8,["value"]),d(j,{value:o.value.endDate,placeholder:"Select End Date",label:"End Date",labelClass:"text-white",name:"EndDate",class:"component_health_data-filter",onHandleChange:P},null,8,["value"])]))}}),Ft={key:0,style:{height:"100px"}},Lt=["disabled"],wt=["onClick"],St=R({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const a=G(),e=N(!1),s=t,o=m(()=>a.filterData),l=m(()=>!(o.value.site&&o.value.site!=""&&o.value.group&&o.value.group!=""&&o.value.model&&o.value.model!=""&&o.value.equipment&&o.value.equipment.length!=0&&o.value.component&&o.value.component.length!=0&&o.value.startDate&&o.value.startDate!=""&&o.value.endDate&&o.value.endDate!="")),r=N(""),n=p=>{r.value=p.order;const c={prop:p.prop,order:p.order};a.setSort(c)},D=async()=>{e.value=!0;const p=await a.exportAll();K.saveAs(new Blob([p],{type:"application/octet-stream"}),"ComponentHealthData.xlsx"),e.value=!1},v=async p=>{const c=await a.exportRow(p);K.saveAs(new Blob([c],{type:"application/octet-stream"}),`ComponentHealthData-${p.site}-${p.group}-${p.model}-${p.equipment}-${p.sourceType}.xlsx`)};return(p,c)=>{const U=$("el-tooltip"),P=M("loading");return i(a).loading?x((h(),C("div",Ft,null,512)),[[P,i(a).loading]]):x((h(),O(i(ut),{key:1,data:s.listData,style:{width:"100%"},"empty-text":"No Data",class:"table_dark-row table-dark","header-row-class-name":"table_dark-header","row-class-name":"table_dark-row text-white",onSortChange:n},{default:b(()=>[d(i(F),{prop:"site",label:"Site","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{prop:"group",label:"Group","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{prop:"model",label:"Model","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{prop:"equipment",label:"Equipment","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{prop:"component",label:"Component","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{prop:"sourceType",label:"Source Type","min-width":"170",sortable:"","sort-method":i(S)(r.value)},null,8,["sort-method"]),d(i(F),{label:"",width:"170"},{header:b(()=>[d(U,{class:"box-item",effect:"dark",content:l.value?"Please fill all the filter first":"Click to Download All",placement:"top"},{default:b(()=>[y("div",null,[x((h(),C("button",{class:"btn fw-bolder comp_heath_data-btn_download",onClick:D,disabled:l.value,"element-loading-background":"#2d2b39b3",align:"center"},[it(" Download All ")],8,Lt)),[[P,e.value]])])]),_:1},8,["content"])]),default:b(I=>[y("button",{class:"btn fw-bolder comp_heath_data-btn_download",onClick:H=>v(I.row)}," Download ",8,wt)]),_:1})]),_:1},8,["data"])),[[P,i(a).loading]])}}}),bt={style:{width:"95%",margin:"20px auto"}},yt={class:"section"},Ct={class:"my-5"},Pt=R({__name:"Index",setup(t){const a=Q(),e=G(),s=m(()=>e.loading),o=m(()=>e.displayData),l=m(()=>e.pagination),r=D=>{e.setPage(D)},n=m(()=>e.filterData);return J(n,async()=>{n.value.site&&n.value.site!=""&&n.value.group&&n.value.group!=""&&n.value.model&&n.value.model!=""&&n.value.equipment&&n.value.equipment.length!=0&&n.value.component&&n.value.component.length!=0&&n.value.startDate&&n.value.startDate!=""&&n.value.endDate&&n.value.endDate!=""&&await e.getData()},{deep:!0}),lt(async()=>{a[tt.ACTIVE_PAGE]("IronPortal"),Z("Component Health Data",[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Historical",pageRoute:"componenthealthdata"},{pageName:"Component Health Data",pageRoute:"componenthealthdata"}]),e.setPage(1),await e.getLookupSite(),await e.getLookupGroup(),await e.getLookupModel(),await e.getLookupEquipment(),await e.getLookupComponent()}),rt(async()=>{e.resetState()}),(D,v)=>{const p=M("loading");return h(),C(Y,null,[y("div",bt,[d(_t)]),y("div",yt,[x(d(St,{"element-loading-background":"#2d2b39b3",listData:o.value,page:l.value.currentPage},null,8,["listData","page"]),[[p,s.value]]),y("div",Ct,[i(e).paginationLoading?pt("",!0):(h(),O(et,{key:0,onRaisePageChange:v[0]||(v[0]=c=>r(c)),currentPage:l.value.currentPage,totalPage:l.value.totalPage,totalPageSize:l.value.totalPageSize,startPaginationIndex:l.value.startPaginationIndex,endPaginationIndex:l.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))])])],64)}}}),Le=ct(Pt,[["__scopeId","data-v-4fe67d45"]]);export{Le as default};
