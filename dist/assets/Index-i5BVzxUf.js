import{u as I}from"./vuex-BbOKrtVp.js";import{g as F}from"./generate-id-loKj70ts.js";import{M as A}from"./ErrorHandleEnum-CyFTj_P_.js";import{A as L,M as G}from"./PbiEmbeddedEnums-BaTTPSF0.js";import{p as d}from"./powerbi-client-BGzjSA60.js";import{d as O}from"./date-format-BASVuupi.js";import{u as W}from"./vue-router-iNp9kJ0K.js";import{k as _,r as y,c as b,o as k,L as T,y as j,p as E,aa as z,Y,a7 as B,q as U}from"./@vue-BypzYtbH.js";import{u as J,b as K,G as Q,A as X}from"./index-BCnwA6yE.js";import{a as Z}from"./breadcrumb-D-Q4Tk9w.js";import{_ as ee}from"./nw-img-vue-CR837WER.js";import"./attr-accept-BWI1aNlo.js";import"./moment-C5S46NFB.js";import"./object-path-BACu75q6.js";import"./pinia-BjOS2_Ao.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./element-plus-C5R56mia.js";import"./dayjs-C7SXsQPH.js";import"./lodash-Cr9vlq0V.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";const te=5,ae=3e5,oe=_({__name:"PbiReportCbm",props:["reportName","analyticPage","visibletab","idPageName","showFilter","isPublic","pbiReportId","pbiWorkspaceId","isHideVisualHeaders","isTransparent","background"],emits:["handle-click"],setup(s,{emit:u}){const e=s,c=u,l=I(),v=W(),g=y();let t;const f=y(0),C=b(()=>l.getters.getIsDashboardConfigLoading),P=b(()=>`${e.analyticPage}-${e.idPageName}`),p=b(()=>l.getters.getDashboardConfigPbi),M=()=>{const a={type:"report",tokenType:d.models.TokenType.Embed||"",accessToken:p.value.embedToken.token||"",embedUrl:p.value.embedReport[0].embedUrl||"",id:p.value.embedReport[0].reportId||"",permissions:d.models.Permissions.All,settings:{panes:{filters:{visible:!1},pageNavigation:{visible:typeof e.visibletab>"u"?!0:e.visibletab}},visualSettings:{visualHeaders:[{settings:{visible:!e.isHideVisualHeaders}}]}}};return e.isTransparent&&(a.settings.background=d.models.BackgroundType.Transparent),a},H=()=>{try{if(typeof p.value<"u"){const a=M();let m=new d.service.Service(d.factories.hpmFactory,d.factories.wpmpFactory,d.factories.routerFactory);g.value&&(t=m.embed(g.value,a)),t.off("loaded"),e.showFilter||t.on("loaded",async()=>{t.off("dataSelected"),t.on("dataSelected",function(r){let o={siteCode:"",componentName:"",modelUnit:"",equipment:""};r.detail.dataPoints[0].identity.forEach(i=>{i.target.column=="site_code"?o.siteCode=i.equals:i.target.column=="component_name"?o.componentName=i.equals:i.target.column=="model_unit"?o.modelUnit=i.equals:i.target.column=="equipment"&&(o.equipment=i.equals)}),o.siteCode!=""&&o.componentName!=""&&o.modelUnit!=""&&o.equipment!=""&&v.push(`/ironportal-dashboard/equipment/${o.siteCode}/${o.componentName}/${o.modelUnit}/${o.equipment}`)})}),t.off("rendered"),t.off("pageChanged"),t.on("pageChanged",function(r){R(r.detail.newPage.displayName)}),t.on("error",async function(r){r.detail=="TokenExpired"&&await h(()=>{w()}),t.off("error")}),t.off("buttonClicked"),t.on("buttonClicked",r=>{S(r)})}}catch(a){console.log(a)}},S=a=>{a.detail.type=="WebUrl"?$(t):a.detail.type=="PageNavigation"&&R(D(t))},R=a=>{e.analyticPage},h=async a=>{await l.dispatch(L.GET_PBI_CONFIG,{reportName:e.reportName,pageName:P.value,isPublic:e.isPublic,reportId:e.pbiReportId,workspaceId:e.pbiWorkspaceId}),a()},D=async a=>(await a.getPages()).filter(function(o){return o.isActive})[0].displayName,$=async a=>{try{const r=(await a.getPages()).filter(function(n){return n.isActive})[0],o=await r.getVisuals(),i=d.models;let N=[];const x=o.filter(function(n){if(n.type=="tableEx")return N.push({data:null,name:n.title}),!0});for(let n=0;n<x.length;n++){const q=await x[n].exportData(i.ExportDataType.Summarized);N[n].data=q.data}c("handle-click",{data:N,workbookName:r.displayName})}catch(m){console.log(m)}},w=async()=>{await t.setAccessToken(p.value.embedToken.token),await t.refresh()},V=()=>{const m=O(new Date),o=Date.parse(p.value.embedToken.expiration)-m,i=te*60*1e3;o<=i&&h(function(){w()})};return k(async()=>{await h(()=>{H()}),f.value=setInterval(()=>{V()},ae)}),T(()=>{f.value&&clearInterval(f.value)}),(a,m)=>{const r=Y("loading");return j((E(),z("div",{ref_key:"reportContainer",ref:g,class:"my-5",style:{height:"90vh"}},null,512)),[[r,C.value]])}}}),re="a9befe6f-7bc4-4d4a-91c1-8715b01416c5",ie="d90b69f1-3a2e-423e-9e27-e341dc02a972",ne=_({__name:"PBI",props:["breadCrumb","reportName","analyticPage","eventName","isPublic","isHideVisualHeaders"],setup(s){const u=s,e=I(),c=b(()=>F(5)),l=b(()=>`${u.analyticPage}-${c.value}`);return B(()=>{e.commit(G.SET_PBI_URL,"https://digital-bumaau-dev-apm-001.azure-api.net/amadm")}),k(async()=>{e.commit(A.SET_ERROR_PAGES,l.value)}),T(async()=>{e.commit(A.SET_ERROR_PAGES,l.value)}),(v,g)=>(E(),U(oe,{reportName:s.reportName,analyticPage:s.analyticPage,idPageName:c.value,isPublic:s.isPublic,pbiReportId:re,pbiWorkspaceId:ie,isHideVisualHeaders:s.isHideVisualHeaders},null,8,["reportName","analyticPage","idPageName","isPublic","isHideVisualHeaders"]))}}),se="AM-EHM-CBM-Compliance",ce="BUMA CBM Compliance Dashboard",le="cbm_compliance_dashboard",pe=_({__name:"Index",setup(s){const u={currentPageBreadCrumb:"CBM Compliance Report",activePage:"CBM Compliance Report",breadCrumbList:[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Dashboard",pageRoute:"/iron-portal"},{pageName:"CBM Compliance Report",pageRoute:"/iron-portal/pbi/cbm-compliance"}]},e=y(!1),c=y(!1),l=J(),v=I(),t=setInterval(()=>{c.value&&(e.value=!0,f())},1*60*1e3),f=async()=>{const P={email:l.user.Email,ver:"v1"};if(e.value){try{await K.get(Q,"",new URLSearchParams(P).toString())}catch(p){console.log(p)}e.value=!1}};return k(()=>{c.value=!0}),T(()=>{c.value=!1,clearInterval(t)}),B(()=>{v.dispatch(X.ACTIVE_PAGE,"IronPortal"),Z("CBM Compliance Report",[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Dashboard",pageRoute:"ironportal"},{pageName:"CBM Compliance Report",pageRoute:"ironportaldashboardcbmcompliance"}])}),(C,P)=>(E(),U(ne,{reportName:se,breadCrumb:u,analyticPage:ce,eventName:le,visibletab:!1,showFilter:!1,isPublic:!1,isHideVisualHeaders:!0,class:"cbm-compliance-dashboard",isTransparent:!0}))}}),ze=ee(pe,[["__scopeId","data-v-bb896cd9"]]);export{ze as default};
