import{u as A,A as F,a as L,M as G,b as x}from"./usePbiEmbeddedStore-Bda_75jS.js";import{g as O}from"./generate-id-loKj70ts.js";import{p as m}from"./powerbi-client-99lwt5rM.js";import{k as W}from"./date-format-8-IvfSl3.js";import{u as j}from"./vue-router-iNp9kJ0K.js";import{k as I,r as y,c as v,o as _,L as k,y as z,p as T,aa as Y,Y as J,a7 as B,q as U}from"./@vue-BypzYtbH.js";import{a as K,c as Q,G as X,A as Z}from"./index-BuVmIl8K.js";import{u as ee}from"./vuex-BbOKrtVp.js";import{a as te}from"./breadcrumb-BYmEOf4C.js";import{_ as ae}from"./nw-img-vue-CR837WER.js";import"./pinia-BjOS2_Ao.js";import"./@popperjs-BaMZbQYT.js";import"./moment-C5S46NFB.js";import"./object-path-DPahbflh.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./element-plus-BeWdvTRa.js";import"./dayjs-D0x2Df_K.js";import"./lodash-DrHMlsdo.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";const oe=5,re=3e5,ie=I({__name:"PbiReportCbm",props:["reportName","analyticPage","visibletab","idPageName","showFilter","isPublic","pbiReportId","pbiWorkspaceId","isHideVisualHeaders","isTransparent","background"],emits:["handle-click"],setup(s,{emit:g}){const e=s,d=g,c=A(),u=j(),f=y();let t;const b=y(0),C=v(()=>c.getIsDashboardConfigLoading),P=v(()=>`${e.analyticPage}-${e.idPageName}`),l=v(()=>c.getDashboardConfigPbi),S=()=>{const a={type:"report",tokenType:m.models.TokenType.Embed||"",accessToken:l.value.embedToken.token||"",embedUrl:l.value.embedReport[0].embedUrl||"",id:l.value.embedReport[0].reportId||"",permissions:m.models.Permissions.All,settings:{panes:{filters:{visible:!1},pageNavigation:{visible:typeof e.visibletab>"u"?!0:e.visibletab}},visualSettings:{visualHeaders:[{settings:{visible:!e.isHideVisualHeaders}}]}}};return e.isTransparent&&(a.settings.background=m.models.BackgroundType.Transparent),a},H=()=>{try{if(typeof l.value<"u"){const a=S();let p=new m.service.Service(m.factories.hpmFactory,m.factories.wpmpFactory,m.factories.routerFactory);f.value&&(t=p.embed(f.value,a)),t.off("loaded"),e.showFilter||t.on("loaded",async()=>{t.off("dataSelected"),t.on("dataSelected",function(r){let o={siteCode:"",componentName:"",modelUnit:"",equipment:""};r.detail.dataPoints[0].identity.forEach(i=>{i.target.column=="site_code"?o.siteCode=i.equals:i.target.column=="component_name"?o.componentName=i.equals:i.target.column=="model_unit"?o.modelUnit=i.equals:i.target.column=="equipment"&&(o.equipment=i.equals)}),o.siteCode!=""&&o.componentName!=""&&o.modelUnit!=""&&o.equipment!=""&&u.push(`/ironportal-dashboard/equipment/${o.siteCode}/${o.componentName}/${o.modelUnit}/${o.equipment}`)})}),t.off("rendered"),t.off("pageChanged"),t.on("pageChanged",function(r){E(r.detail.newPage.displayName)}),t.on("error",async function(r){r.detail=="TokenExpired"&&await h(()=>{R()}),t.off("error")}),t.off("buttonClicked"),t.on("buttonClicked",r=>{M(r)})}}catch(a){console.log(a)}},M=a=>{a.detail.type=="WebUrl"?$(t):a.detail.type=="PageNavigation"&&E(D(t))},E=a=>{e.analyticPage},h=async a=>{await c[F.GET_PBI_CONFIG]({reportName:e.reportName,pageName:P.value,isPublic:e.isPublic,reportId:e.pbiReportId,workspaceId:e.pbiWorkspaceId}),a()},D=async a=>(await a.getPages()).filter(function(o){return o.isActive})[0].displayName,$=async a=>{try{const r=(await a.getPages()).filter(function(n){return n.isActive})[0],o=await r.getVisuals(),i=m.models;let N=[];const w=o.filter(function(n){if(n.type=="tableEx")return N.push({data:null,name:n.title}),!0});for(let n=0;n<w.length;n++){const q=await w[n].exportData(i.ExportDataType.Summarized);N[n].data=q.data}d("handle-click",{data:N,workbookName:r.displayName})}catch(p){console.log(p)}},R=async()=>{await t.setAccessToken(l.value.embedToken.token),await t.refresh()},V=()=>{const p=W(new Date),o=Date.parse(l.value.embedToken.expiration)-p,i=oe*60*1e3;o<=i&&h(function(){R()})};return _(async()=>{await h(()=>{H()}),b.value=setInterval(()=>{V()},re)}),k(()=>{b.value&&clearInterval(b.value)}),(a,p)=>{const r=J("loading");return z((T(),Y("div",{ref_key:"reportContainer",ref:f,class:"my-5",style:{height:"90vh"}},null,512)),[[r,C.value]])}}}),ne="a9befe6f-7bc4-4d4a-91c1-8715b01416c5",se="d90b69f1-3a2e-423e-9e27-e341dc02a972",ce=I({__name:"PBI",props:["breadCrumb","reportName","analyticPage","eventName","isPublic","isHideVisualHeaders"],setup(s){const g=s,e=L(),d=A(),c=v(()=>O(5)),u=v(()=>`${g.analyticPage}-${c.value}`);return B(()=>{d[G.SET_PBI_URL]("https://digital-bumaau-dev-apm-001.azure-api.net/amadm")}),_(async()=>{e[x.SET_ERROR_PAGES](u.value)}),k(async()=>{e[x.SET_ERROR_PAGES](u.value)}),(f,t)=>(T(),U(ie,{reportName:s.reportName,analyticPage:s.analyticPage,idPageName:c.value,isPublic:s.isPublic,pbiReportId:ne,pbiWorkspaceId:se,isHideVisualHeaders:s.isHideVisualHeaders},null,8,["reportName","analyticPage","idPageName","isPublic","isHideVisualHeaders"]))}}),le="AM-EHM-CBM-Compliance",pe="BUMA CBM Compliance Dashboard",me="cbm_compliance_dashboard",de=I({__name:"Index",setup(s){const g={currentPageBreadCrumb:"CBM Compliance Report",activePage:"CBM Compliance Report",breadCrumbList:[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Dashboard",pageRoute:"/iron-portal"},{pageName:"CBM Compliance Report",pageRoute:"/iron-portal/pbi/cbm-compliance"}]},e=y(!1),d=y(!1),c=K(),u=ee(),t=setInterval(()=>{d.value&&(e.value=!0,b())},1*60*1e3),b=async()=>{const P={email:c.user.Email,ver:"v1"};if(e.value){try{await Q.get(X,"",new URLSearchParams(P).toString())}catch(l){console.log(l)}e.value=!1}};return _(()=>{d.value=!0}),k(()=>{d.value=!1,clearInterval(t)}),B(()=>{u.dispatch(Z.ACTIVE_PAGE,"IronPortal"),te("CBM Compliance Report",[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Dashboard",pageRoute:"ironportal"},{pageName:"CBM Compliance Report",pageRoute:"ironportaldashboardcbmcompliance"}])}),(C,P)=>(T(),U(ce,{reportName:le,breadCrumb:g,analyticPage:pe,eventName:me,visibletab:!1,showFilter:!1,isPublic:!1,isHideVisualHeaders:!0,class:"cbm-compliance-dashboard",isTransparent:!0}))}}),Ze=ae(de,[["__scopeId","data-v-bb896cd9"]]);export{Ze as default};
