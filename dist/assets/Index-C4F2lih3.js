import{u as Me}from"./vuex-BbOKrtVp.js";import{a as Ae}from"./breadcrumb-D-Q4Tk9w.js";import{b as M,u as L,s as A,i as se,h as $e,j as ae,q as Ne,A as Be}from"./index-BCnwA6yE.js";import{P as be}from"./Pagination-CVDIvnOM.js";import{F as Ve}from"./FilterIconButton-Bj0WTbms.js";import{h as ze,A as je,U as Ge}from"./excel-generator-CRLIz6fw.js";import{D as Ke}from"./DownloadIconButton-CIQp-YG7.js";import{k as J,c as R,r as Q,u as o,y as ee,p as f,aa as k,s as r,x as u,T as _e,q as E,F as ye,Y as de,R as z,A as ie,aB as F,C as N,P as De,a0 as pe,B as V,bd as Ye,bb as Qe,a7 as We,L as Xe}from"./@vue-BypzYtbH.js";import{_ as T,b as Te}from"./element-plus-C5R56mia.js";import{f as Z,n as Y,a as Ce}from"./date-format-BASVuupi.js";import{P as ne,b as K,a as Je,d as Ze}from"./table-sort-VnBD5Hfa.js";import{d as ue}from"./pinia-BjOS2_Ao.js";import{b as Ee,m as X,a as Se}from"./mapOption-sP4IrA4W.js";import{b as et,P as tt}from"./urls-De-ebYNz.js";import{c as we,a as $,b as me,d as at,f as ot}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as Ie}from"./ErrorAlert-CMKGfwAi.js";import{_ as Re}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as re}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as G}from"./AutoComplete.vue_vue_type_script_setup_true_lang-D4CTLiQF.js";import{a as st}from"./vee-validate-C_msoaAA.js";import{_ as ve}from"./lodash-Cr9vlq0V.js";import{_ as nt}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as rt}from"./map-anything-abi6NY2Z.js";import{_ as it}from"./nw-img-vue-CR837WER.js";import{_ as W}from"./AutoComplete.vue_vue_type_style_index_0_lang-CRR6Z--K.js";import{_ as lt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as mt}from"./file-saver-DhbZvGod.js";import"./vue-router-iNp9kJ0K.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const te="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/component_replacement",dt=`${te}`,pt=`${te}/component_replacement_bulk`,ut=`${te}/validate_upload`,ct=`${te}/export`,ht=`${te}/lookup`,oe="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/counter_reading/lookup_data",le={site:"",siteTo:"",model:"",modelTo:"",equipment:"",equipmentTo:"",component:"",componentTo:"",replacementDate:"",replacementDateTo:"",replacementSmu:"",replacementSmuTo:"",hmoffset:"",hmoffsetTo:"",frameHours:"",frameHoursTo:"",ver:"v1",page:1,pageSize:10,order:""},ce=ue({id:"componentReplacementList",state:()=>({stateFilterData:{...le},stateLastUsedFilterData:{...le},statePageName:"ComponentReplacement",stateDisplayData:[],statePagination:new ne,stateLoading:!1,statePaginationLoading:!1,stateSiteOption:[],stateModelOption:[],stateEquipmentOption:[],stateComponentOption:[],stateReplacementDateOption:[],stateReplacementSmuOption:[],stateFrameHoursOption:[]}),getters:{pageName:e=>e.statePageName,pagination:e=>e.statePagination,displayData:e=>e.stateDisplayData,filterData:e=>e.stateFilterData,lastUsedFilterData:e=>e.stateLastUsedFilterData,loading:e=>e.stateLoading,paginationLoading:e=>e.statePaginationLoading,siteOption:e=>e.stateSiteOption,modelOption:e=>e.stateModelOption,equipmentOption:e=>e.stateEquipmentOption,componentOption:e=>e.stateComponentOption,replacementDateOption:e=>e.stateReplacementDateOption,replacementSmuOption:e=>e.stateReplacementSmuOption,frameHoursOption:e=>e.stateFrameHoursOption},actions:{async getData(e=!0){const a={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,model:this.stateFilterData.model,modelTo:this.stateFilterData.modelTo,equipment:this.stateFilterData.equipment,equipmentTo:this.stateFilterData.equipmentTo,component:this.stateFilterData.component,componentTo:this.stateFilterData.componentTo,replacementDate:this.stateFilterData.replacementDate?Z(Y(new Date(this.stateFilterData.replacementDate))):"",replacementDateTo:this.stateFilterData.replacementDateTo?Z(Y(new Date(this.stateFilterData.replacementDateTo))):"",replacementSmu:this.stateFilterData.replacementSmu,replacementSmuTo:this.stateFilterData.replacementSmuTo,frameHours:this.stateFilterData.frameHours,frameHoursTo:this.stateFilterData.frameHoursTo,page:this.stateFilterData.page.toString(),pageSize:this.stateFilterData.pageSize.toString(),order:this.stateFilterData.order,ver:this.stateFilterData.ver};try{e&&(this.stateLoading=!0),e||(this.stateDisplayData=[]);const t=await M.get(dt,"component_replacement_paging",new URLSearchParams(a).toString());this.stateDisplayData=t.data.result.content,this.setTotalPage(t.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(t){!t.response.data&&(t!=null&&t.includes("Request failed with status code 401"))&&L().setLoggedIn(!1),A("IRONS",t),console.log(t)}this.stateLoading=!1},async getLookup(){const e={ver:this.stateFilterData.ver};try{const a=await M.get(ht,"",new URLSearchParams(e).toString());this.stateSiteOption=Ee(a.data.result.content.site,"siteId","siteCode","siteDescription"),this.stateModelOption=X(a.data.result.content.equipmentModel,"equipmentModel","equipmentModelDescription"),this.stateEquipmentOption=X(a.data.result.content.equipmentNumber,"equipmentNumber","equipmentNumberDescription"),this.stateComponentOption=X(a.data.result.content.component,"componentDescription","component"),this.stateReplacementSmuOption=Se(a.data.result.content.replacementSmu),this.stateFrameHoursOption=Se(a.data.result.content.frameHours)}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",a),console.log(a)}},async export(){const e={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,model:this.stateFilterData.model,modelTo:this.stateFilterData.modelTo,equipment:this.stateFilterData.equipment,equipmentTo:this.stateFilterData.equipmentTo,component:this.stateFilterData.component,componentTo:this.stateFilterData.componentTo,replacementDate:this.stateFilterData.replacementDate?Z(Y(new Date(this.stateFilterData.replacementDate))):"",replacementDateTo:this.stateFilterData.replacementDateTo?Z(Y(new Date(this.stateFilterData.replacementDateTo))):"",replacementSmu:this.stateFilterData.replacementSmu,replacementSmuTo:this.stateFilterData.replacementSmuTo,frameHours:this.stateFilterData.frameHours,frameHoursTo:this.stateFilterData.frameHoursTo,order:this.stateFilterData.order,ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await M.getBlob(ct,"",new URLSearchParams(e).toString())).data}catch(a){A("IRONS",a),console.log(a)}},setTotalPage(e){this.pagination.totalPage=e,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(e){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(e),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:e,order:a}){if(!e&&!a)this.stateFilterData.order="";else{const t=a=="ascending"?"asc":"desc";this.stateFilterData.order=`${e}_${t}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1)},setSite(e){this.stateFilterData.site=e},setSiteTo(e){this.stateFilterData.siteTo=e},setModel(e){this.stateFilterData.model=e},setModelTo(e){this.stateFilterData.modelTo=e},setEquipment(e){this.stateFilterData.equipment=e},setEquipmentTo(e){this.stateFilterData.equipmentTo=e},setComponent(e){this.stateFilterData.component=e},setComponentTo(e){this.stateFilterData.componentTo=e},setReplacementDate(e){this.stateFilterData.replacementDate=e},setReplacementDateTo(e){this.stateFilterData.replacementDateTo=e},setReplacementSmu(e){this.stateFilterData.replacementSmu=e},setReplacementSmuTo(e){this.stateFilterData.replacementSmuTo=e},setFrameHours(e){this.stateFilterData.frameHours=e},setFrameHoursTo(e){this.stateFilterData.frameHoursTo=e},async resetFilter(){this.stateFilterData.site="",this.stateFilterData.siteTo="",this.stateFilterData.model="",this.stateFilterData.modelTo="",this.stateFilterData.equipment="",this.stateFilterData.equipmentTo="",this.stateFilterData.component="",this.stateFilterData.componentTo="",this.stateFilterData.replacementDate="",this.stateFilterData.replacementDateTo="",this.stateFilterData.replacementSmu="",this.stateFilterData.replacementSmuTo="",this.stateFilterData.frameHours="",this.stateFilterData.frameHoursTo="";const e=this.stateLastUsedFilterData.site!=="",a=this.stateLastUsedFilterData.siteTo!=="",t=this.stateLastUsedFilterData.model!=="",h=this.stateLastUsedFilterData.modelTo!=="",s=this.stateLastUsedFilterData.equipment!=="",i=this.stateLastUsedFilterData.equipmentTo!=="",d=this.stateLastUsedFilterData.component!=="",m=this.stateLastUsedFilterData.componentTo!=="",b=this.stateLastUsedFilterData.replacementDate!=="",_=this.stateLastUsedFilterData.replacementDateTo!=="",p=this.stateLastUsedFilterData.replacementSmu!=="",n=this.stateLastUsedFilterData.replacementSmuTo!=="",P=this.stateLastUsedFilterData.frameHours!=="",I=this.stateLastUsedFilterData.frameHoursTo!=="";(e||a||t||h||s||i||d||m||b||_||p||n||P||I)&&await this.getData()},resetState(){this.stateFilterData={...le},this.stateDisplayData=[],this.statePagination=new ne,this.stateLoading=!1,this.statePaginationLoading=!1}}}),Fe={componentReplacementId:0,site:"",model:"",equipment:"",component:"",componentAssignmentId:0,replacementDate:"",replacementSmu:0,hmoffset:0,frameHours:0},gt={site:!1,model:!1,equipment:!1,component:!1},he=ue({id:"componentReplacementForm",state:()=>({stateFormData:{...Fe},stateFormLoading:{...gt},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateSiteOption:[],stateModelOption:[],stateEquipmentOption:[],stateComponentOption:[],stateHmoffsetDefault:0,stateIsEdit:!1}),getters:{formData:e=>e.stateFormData,isEdit:e=>e.stateIsEdit,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,siteOption:e=>e.stateSiteOption,modelOption:e=>e.stateModelOption,equipmentOption:e=>e.stateEquipmentOption,componentOption:e=>e.stateComponentOption,formLoading:e=>e.stateFormLoading,hmoffsetDefault:e=>e.stateHmoffsetDefault},actions:{async getHmOffset(e,a){const t={equipment:e,ver:"v1"};try{this.stateLoading=!0;const h=await M.get(et,"",new URLSearchParams(t).toString());this.stateHmoffsetDefault=h.data.result.content.hmoffset||0,a||(this.stateFormData.frameHours=this.stateHmoffsetDefault)}catch(h){A("IRONS",h),console.log(h)}finally{this.stateLoading=!1}},async getLookupSite(){this.stateFormLoading.site=!0;const e={ver:"v1"};try{const a=await M.get(oe,"",new URLSearchParams(e).toString());this.stateSiteOption=Ee(a.data.result.content.site,"siteId","siteCode","siteDescription")}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",a),console.log(a)}this.stateFormLoading.site=!1},async getLookupModel(){this.stateFormLoading.model=!0;const e={siteId:this.formData.site,ver:"v1"};try{const a=await M.get(oe,"",new URLSearchParams(e).toString());this.stateModelOption=X(a.data.result.content.equipmentModel,"equipmentModel","equipmentModelDescription")}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",a),console.log(a)}this.stateFormLoading.model=!1},async getLookupEquipment(){this.stateFormLoading.equipment=!0;const e={siteId:this.formData.site,equipmentModel:this.formData.model,ver:"v1"};try{const a=await M.get(oe,"",new URLSearchParams(e).toString());this.stateEquipmentOption=X(a.data.result.content.equipmentNumber,"equipmentNumber","equipmentNumberDescription")}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",a),console.log(a)}this.stateFormLoading.equipment=!1},async getLookupComponent(){this.stateFormLoading.component=!0;const e={siteId:this.formData.site,equipmentModel:this.formData.model,equipmentNumber:this.formData.equipment,ver:"v1"};try{const a=await M.get(oe,"",new URLSearchParams(e).toString());this.stateComponentOption=X(a.data.result.content.component,"componentDescription","component")}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",a),console.log(a)}this.stateFormLoading.component=!1},async insertData(e){try{this.stateLoading=!0;const a={userAccount:e,ver:"v1"},t={componentReplacementId:this.stateFormData.componentReplacementId,site:this.stateFormData.site,model:this.stateFormData.model,equipment:this.stateFormData.equipment,component:this.stateFormData.component,componentAssignmentId:this.stateFormData.componentAssignmentId,replacementDate:Z(Y(new Date(this.stateFormData.replacementDate))),replacementSmu:this.stateFormData.replacementSmu,hmoffset:this.stateFormData.hmoffset,frameHours:this.stateFormData.frameHours,transactionCount:this.stateFormData.transactionCount},h=await M.post(`${tt}?${new URLSearchParams(a).toString()}`,t);h.data.title==="Error"?(this.stateErrors.push(h.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(a){a.response.data.statusCode==401&&L().setLoggedIn(!1),this.stateError=a,A("IRONS",a),console.log(a),this.stateErrors.push(a.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},setIsEdit(e){this.stateIsEdit=e},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setFormData(e,a=!1){this.stateFormData.componentReplacementId=a?0:e.componentReplacementId,this.stateFormData.site=e.site,this.stateFormData.model=e.model,this.stateFormData.equipment=e.equipment,this.stateFormData.component=e.component,this.stateFormData.componentAssignmentId=e.componentAssignmentId,this.stateFormData.replacementDate=e.replacementDate,this.stateFormData.replacementSmu=e.replacementSmu,this.stateFormData.hmoffset=e.hmoffset,this.stateFormData.frameHours=e.frameHours},resetState(){this.stateFormData={...Fe},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1}}}),ft={key:0,style:{height:"100px"}},Dt={key:1},St={key:1},vt={key:1},Ft={key:1},bt={key:1},_t={key:1},yt={key:1},Tt={key:0,class:"d-flex justify-content-end"},Ct=["onClick"],Et={key:1,class:"d-flex"},wt=J({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["fetch-data","duplicateData"],setup(e,{emit:a}){const t=e;L();const h=ce(),s=he(),i=a,d=R(()=>s.isEdit),m=R(()=>(t.page-1)*10+1),b=Q(""),_=S=>{b.value=S.order;const l={prop:S.prop,order:S.order};h.setSort(l)},p=Q({componentReplacementId:0,site:"",model:"",equipment:"",component:"",componentAssignmentId:0,replacementDate:Y(new Date),replacementSmu:0,hmoffset:0,frameHours:0,transactionCount:0}),n=Q({componentReplacementId:0,site:"",model:"",equipment:"",component:"",componentAssignmentId:0,replacementDate:Y(new Date),replacementSmu:0,hmoffset:0,frameHours:0,transactionCount:0}),P=()=>{s.setIsEdit(!1),s.resetState(),H(),setTimeout(()=>{n.value=Object.assign({},p.value)},300)},I=we().shape({site:$().required("Site is mandatory"),model:$().required("Model is mandatory"),equipment:$().required("Equipment is mandatory"),component:$().required("Component is mandatory"),smu:$().required("SMU is mandatory"),counterReading:$().required("Component Life is mandatory"),startDate:me().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:me().required("End Date is mandatory").min(at("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),H=()=>{s.setErrors([])},O=R(()=>s.isError),v=R(()=>s.errors),y=async S=>{n.value.site=S,S!=""&&await s.getLookupModel(),c("")},c=async S=>{n.value.model=S,S!=""&&await s.getLookupEquipment(),U("")},U=async S=>{n.value.equipment=S,S!=""&&await s.getLookupComponent(),C("")},C=S=>{n.value.component=S},w=async()=>{s.setIsEdit(!0),H(),await I.validate(n.value,{abortEarly:!1}).catch(S=>{s.setErrors(S.errors),window&&window.scrollTo(0,0)}),!O.value&&se("Are you sure you want to submit ?").then(async S=>{S.isConfirmed&&s.setFormData(n.value)})},D=async S=>{s.setFormData(S,!0),i("duplicateData",!0)};return(S,l)=>{const q=z("inline-svg"),x=z("el-tooltip"),B=de("loading");return o(h).loading?ee((f(),k("div",ft,null,512)),[[B,o(h).loading]]):(f(),k(ye,{key:1},[r(_e,{name:"fade"},{default:u(()=>[O.value&&d.value?(f(),E(Ie,{key:0,errorMessages:v.value,onResetForm:H},null,8,["errorMessages"])):ie("",!0)]),_:1}),ee((f(),E(o(Te),{data:t.listData,style:{width:"100%"},onSortChange:_,"empty-text":"No Data"},{default:u(()=>[r(o(T),{label:"No",width:"90",align:"center"},{default:u(g=>[F("span",null,N(m.value+g.$index),1)]),_:1}),r(o(T),{prop:"site",label:"Site","min-width":"100",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(G,{key:0,value:n.value.site,placeholder:"Add Site",name:"Site",max:20,onHandleChange:y,options:o(s).siteOption},null,8,["value","options"])):(f(),k("span",Dt,N(g.row.site),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"model",label:"Model","min-width":"150",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(G,{key:0,value:n.value.model,placeholder:"Add Model","is-disabled":!n.value.site||n.value.site=="",name:"model",max:40,onHandleChange:c,options:o(s).modelOption},null,8,["value","is-disabled","options"])):(f(),k("span",St,N(g.row.model),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"equipment",label:"Equipment","min-width":"150",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(G,{key:0,value:n.value.equipment,placeholder:"Add Equipment","is-disabled":!n.value.model||n.value.model=="",name:"equipment",max:20,onHandleChange:U,options:o(s).equipmentOption},null,8,["value","is-disabled","options"])):(f(),k("span",vt,N(g.row.equipment),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"component",label:"Component","min-width":"200",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(G,{key:0,value:n.value.component,placeholder:"Add Component","is-disabled":!n.value.equipment||n.value.equipment=="",name:"Component",max:20,onHandleChange:C,options:o(s).componentOption},null,8,["value","is-disabled","options"])):(f(),k("span",Ft,N(g.row.component),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"replacementDate",label:"Replacement Date","min-width":"180",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(Re,{key:0,value:n.value.replacementDate,placeholder:"Add Replacement Date",name:"ReplacementDate",onHandleChange:l[0]||(l[0]=j=>n.value.replacementDate=j)},null,8,["value"])):(f(),k("span",bt,N(o(Ce)(g.row.replacementDate)),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"replacementSmu",label:"Replacement SMU","min-width":"200",sortable:"","sort-method":()=>o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(re,{key:0,value:n.value.replacementSmu,placeholder:"Add Replacement SMU",name:"ReplacementSmu",onHandleChange:l[1]||(l[1]=j=>n.value.replacementSmu=j)},null,8,["value"])):(f(),k("span",_t,N(g.row.replacementSmu),1))]),_:1},8,["sort-method"]),r(o(T),{prop:"frameHours",label:"Frame Hours","min-width":"150",sortable:"","sort-method":o(K)(b.value)},{default:u(g=>[g.row.componentReplacementId===n.value.componentReplacementId?(f(),E(re,{key:0,value:n.value.frameHours,placeholder:"Add Frame Hours",name:"FrameHours",onHandleChange:l[2]||(l[2]=j=>n.value.frameHours=j)},null,8,["value"])):(f(),k("span",yt,N(g.row.frameHours),1))]),_:1},8,["sort-method"]),r(o(T),{label:"",width:"100"},{default:u(g=>[g.row.componentReplacementId!==n.value.componentReplacementId?(f(),k("div",Tt,[r(x,{class:"box-item",effect:"dark",content:"Add new data based on table rows",placement:"top"},{default:u(()=>[F("div",null,[F("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:j=>D(g.row)},[r(q,{src:"/media/svg/tables/rows/paste-icon-button-blue.svg",width:"12",height:"12"})],8,Ct)])]),_:2},1024)])):(f(),k("div",Et,[r(x,{class:"box-item",effect:"dark",content:"Save",placement:"top"},{default:u(()=>[F("button",{class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:De(w,["prevent"])},[r(q,{src:"/media/svg/tables/rows/save.svg",width:"12",height:"12"})])]),_:1}),r(x,{class:"box-item",effect:"dark",content:"Cancel",placement:"top"},{default:u(()=>[F("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:De(P,["prevent"])},[r(q,{src:"/media/svg/tables/rows/valid-false.svg",width:"12",height:"12"})])]),_:1})]))]),_:1})]),_:1},8,["data"])),[[B,o(h).loading]])],64))}}}),It={class:"dialog-footer"},Rt=J({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(e,{emit:a}){const t=e,h=a,s=he(),i=L(),d=pe(t,"visibility"),m=R(()=>s.formData),b=R(()=>s.errors),_=R(()=>s.isError),p=R(()=>s.formLoading),n=R(()=>s.hmoffsetDefault),P=we().shape({site:$().required("Site is mandatory"),model:$().required("Model is mandatory"),equipment:$().required("Equipment is mandatory"),component:$().required("Component is mandatory"),componentAssignmentId:$().required("Component Assignment ID is mandatory"),replacementDate:me().required("Replacement Date is mandatory").typeError("Replacement Date is mandatory"),replacementSmu:ot().required("Replacement SMU is mandatory").typeError("Replacement SMU is mandatory")}),I=(D=!1)=>{w(),s.resetState(),h("handle-close",D)},H=async D=>{m.value.site=D,D!=""&&await s.getLookupModel(),O("")},O=async D=>{m.value.model=D,D!=""&&(await s.getHmOffset(m.value.equipment,!1),U(0),await s.getLookupEquipment()),v("")},v=async D=>{m.value.equipment=D,D!=""&&await s.getLookupComponent(),y("")},y=D=>{m.value.component=D},c=D=>{m.value.replacementDate=D},U=D=>{m.value.replacementSmu=D,m.value.frameHours=(parseInt(D)||0)+n.value},C=async()=>{w(),await P.validate(m.value,{abortEarly:!1}).catch(D=>{s.setErrors(D.errors)}),!_.value&&se("Are you sure you want to submit ?").then(async D=>{D.isConfirmed&&s.insertData(i.user.Name).then(()=>{s.isError||$e("Form has been successfully submitted!","Ok").then(()=>{I(!0)})})})},w=()=>{s.setErrors([])};return(D,S)=>{const l=z("el-button"),q=z("el-dialog"),x=de("loading");return ee((f(),E(q,{modelValue:d.value,"onUpdate:modelValue":S[0]||(S[0]=B=>d.value=B),title:"New Data",width:"40%",onClose:S[1]||(S[1]=B=>I())},{footer:u(()=>[F("span",It,[r(l,{type:"primary",onClick:C,disabled:o(s).loading},{default:u(()=>[V("Submit")]),_:1},8,["disabled"]),r(l,{type:"secondary",onClick:I,disabled:o(s).loading},{default:u(()=>[V("Close")]),_:1},8,["disabled"])])]),default:u(()=>[r(_e,{name:"fade"},{default:u(()=>[_.value?(f(),E(Ie,{key:0,errorMessages:b.value,onResetForm:w},null,8,["errorMessages"])):ie("",!0)]),_:1}),ee((f(),E(o(st),{id:"kt_filter_form",class:"row g-9 my-4"},{default:u(()=>[r(G,{value:m.value.site,isLoading:p.value.site,placeholder:"Add Site",label:"Site",name:"Site",max:20,onHandleChange:H,options:o(s).siteOption},null,8,["value","isLoading","options"]),r(G,{value:m.value.model,isLoading:p.value.model,"is-disabled":!m.value.site||m.value.site=="",placeholder:"Add Model",label:"Model",name:"EquipmentModel",max:40,onHandleChange:O,options:o(s).modelOption},null,8,["value","isLoading","is-disabled","options"]),r(G,{value:m.value.equipment,isLoading:p.value.equipment,"is-disabled":!m.value.model||m.value.model=="",placeholder:"Add Equipment",label:"Equipment",name:"EquipmentNumber",max:20,onHandleChange:v,options:o(s).equipmentOption},null,8,["value","isLoading","is-disabled","options"]),r(G,{value:m.value.component,isLoading:p.value.component,"is-disabled":!m.value.equipment||m.value.equipment=="",placeholder:"Add Component",label:"Component",name:"Component",max:20,onHandleChange:y,options:o(s).componentOption},null,8,["value","isLoading","is-disabled","options"]),r(Re,{class:"custom-text-input",value:m.value.replacementDate,label:"Replacement Date",name:"ReplacementDate","format-date":"DD/MM/YYYY",onHandleChange:c},null,8,["value"]),r(re,{value:m.value.replacementSmu,label:"Replacement SMU",name:"ReplacementSmu",onHandleChange:U},null,8,["value"]),r(re,{value:m.value.frameHours,label:"Frame Hours",name:"FrameHours",disabled:!0},null,8,["value"])]),_:1})),[[x,o(s).loading]])]),_:1},8,["modelValue"])),[[x,o(s).loading]])}}}),ge=ue({id:"componentReplacementBulk",state:()=>({statePagination:new ne,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null,stateErrorBulkMsg:""}),getters:{validatedData:e=>e.stateValidatedData,displayData:e=>e.stateDisplayData,pagination:e=>e.statePagination,bulkData:e=>e.stateBulkData,error:e=>e.stateError,isError:e=>e.stateIsError,loading:e=>e.stateLoading,uploadLoading:e=>e.stateUploadLoading,isUploaded:e=>e.stateIsUploaded,errorBulkMsg:e=>e.stateErrorBulkMsg},actions:{async bulkInsert(e){const a={userAccount:e,ver:"v1"};try{this.stateLoading=!0;const t=await M.post(`${pt}?${new URLSearchParams(a).toString()}`,this.stateBulkData);this.stateError=t.data.result.isError?t.data.result.message:"",this.stateIsError=t.data.result.isError}catch(t){t.response.data.statusCode==401&&L().setLoggedIn(!1),A("IRONS",t),console.log(t)}this.stateLoading=!1},async upload({userAccount:e,excelFile:a}){const t={userAccount:e,ver:"v1"},h=`${ut}?${new URLSearchParams(t).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const s=await M.postImages(h,a);s.data.statusCode==200?s.data.result.isError?(this.stateIsError=!0,this.stateError=s.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=s.data.result.content,this.setTotalPage(this.stateValidatedData.length),ve.every(this.stateValidatedData,{validationReason:"Component Replacement already exists"})?(this.stateIsError=!0,this.stateErrorBulkMsg="There is no new data, all data has been uploaded previously."):ve.every(this.stateValidatedData,{isValid:!1})&&(this.stateIsError=!0,this.stateErrorBulkMsg="There is no new data, please check for the remark."),console.log(this.stateIsError),this.setPage(1)):(this.stateIsError=s.data.result.isError,this.stateError=s.data.result.message)}catch(s){s.response.data.statusCode==401?L().setLoggedIn(!1):(A("IRONS",s),this.stateIsError=!0,this.stateError=s.response.data.result.message)}this.stateUploadLoading=!1},setTotalPage(e){this.pagination.totalPage=e},setDisplayData(){let e=[...this.stateValidatedData];this.stateIsSort&&(e=e.sort(Je(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=e.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(e){this.statePagination.handleCurrentPageChange(e),this.setDisplayData()},setSort(e){this.stateIsSort=e.prop!==null,this.stateSortBy=e.prop,this.stateSortOrder=e.order,this.setPage(1)},setBulkData(e){this.stateBulkData=e},setIsUploadedState(e){this.stateIsUploaded=e},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new ne,this.stateIsError=!1,this.stateError="",this.stateErrorBulkMsg="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),qt={class:"icon"},kt=J({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(e){const a=e,t=Q(""),h=ge(),s=R(()=>(a.page-1)*10+1),i=m=>{t.value=m.order;const b={prop:m.prop,order:m.order};h.setSort(b)},d=(m,b,_)=>Ze(m[_],b[_],t.value);return(m,b)=>{const _=z("inline-svg");return f(),E(o(Te),{data:a.listData,style:{width:"100%"},onSortChange:i,"empty-text":"No Data"},{default:u(()=>[r(o(T),{label:"No",width:"60",align:"center"},{default:u(p=>[F("span",null,N(s.value+p.$index),1)]),_:1}),r(o(T),{prop:"site",label:"Site",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"site")},null,8,["sort-method"]),r(o(T),{prop:"model",label:"Model",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"model")},null,8,["sort-method"]),r(o(T),{prop:"equipment",label:"Equipment",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"equipment")},null,8,["sort-method"]),r(o(T),{prop:"component",label:"Component",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"component")},null,8,["sort-method"]),r(o(T),{prop:"replacementDate",label:"Replacement Date",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"replacementDate")},{default:u(p=>[F("span",null,N(o(Ce)(p.row.replacementDate)),1)]),_:1},8,["sort-method"]),r(o(T),{prop:"replacementSmu",label:"Replacement SMU",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"replacementSmu")},null,8,["sort-method"]),r(o(T),{prop:"hmOffset",label:"HM offset",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"hmOffset")},null,8,["sort-method"]),r(o(T),{prop:"frameHours",label:"Frame Hours",width:"300",sortable:"","sort-method":(p,n)=>d(p,n,"frameHours")},null,8,["sort-method"]),r(o(T),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),r(o(T),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:u(p=>[F("div",qt,[r(_,{src:p.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),fe=e=>(Ye("data-v-87d771c8"),e=e(),Qe(),e),Lt=fe(()=>F("div",{class:"text-center"},null,-1)),Pt=fe(()=>F("div",{class:"mb-3"},[F("span",null,[V(" Download template "),F("a",{href:"documents/MasterDataComponentReplacement.xlsx",target:"_blank",id:"link-download"},"here"),V(" before uploading file ")])],-1)),Ht=fe(()=>F("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[F("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),Ot={class:"card"},Ut={class:"card-body grid-padding"},xt={class:"dialog-footer"},Mt=J({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(e,{emit:a}){const t=e,h=a,s=L(),i=ge(),d=pe(t,"visibility"),m=()=>{const v=rt(i.validatedData,y=>{const c=y;return{componentReplacementId:0,site:c.site,model:c.model,equipment:c.equipment,component:c.component,replacementDate:c.replacementDate,replacementSmu:c.replacementSmu,hmOffset:c.hmOffset,frameHours:c.frameHours}});return Object.values(v)},b=()=>{const v=document.getElementById("link-download");v&&v.click()},_=()=>{i.validatedData.length>0?se("Cancel Upload Data?","Confirm").then(y=>{y.isConfirmed&&n()}):n()},p=async v=>{await i.upload({userAccount:s.user.Name,excelFile:v}),i.stateError&&ae(i.error)},n=(v=!1)=>{i.resetState(),h("handle-close",v)},P=v=>{i.setIsUploadedState(v)},I=v=>{i.setPage(v)},H=()=>{if(i.validatedData.length<1){b();return}const v=["SITE","MODEL","EQUIPMENT","COMPONENT","REPLACEMENT DATE","REPLACEMENT SMU","HM OFFSET","FRAME HOURS","VALIDATION REASON","STATUS"],y=i.validatedData.map(c=>({site:c.site,model:c.model,equipment:c.equipment,component:c.component,replacementDate:c.replacementDate,replacementSmu:c.replacementSmu,hmoffset:c.hmoffset,frameHours:c.frameHours,remark:c.validationReason,status:c.isValid?"OK":"Error"}));ze("ComponentReplacement",v,y)},O=async()=>{if(i.displayData.length<1){ae("There is no data to submit");return}if(i.isError){ae(i.errorBulkMsg);return}se("Are you sure you want to submit ?").then(async v=>{if(v.isConfirmed){const y=m();if(i.setBulkData(y),await i.bulkInsert(s.user.Name),i.isError){ae(i.stateError);return}Ne("Form has been successfully submitted!").then(()=>{n(!0)})}})};return(v,y)=>{const c=z("el-button"),U=z("el-dialog"),C=de("loading");return f(),E(U,{title:"Upload Bulk Data",modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=w=>d.value=w),"before-close":_,width:"70%","custom-class":"upload-modal"},{footer:u(()=>[F("div",null,[F("span",xt,[r(c,{type:"success",onClick:H},{default:u(()=>[V("Download")]),_:1}),r(c,{type:"primary",onClick:O},{default:u(()=>[V("Upload")]),_:1}),r(c,{type:"success",onClick:_},{default:u(()=>[V("Cancel")]),_:1})])])]),default:u(()=>[Lt,Pt,ee(r(nt,{isSubmissionUploadSuccess:o(i).isUploaded,onHandleCloseUploadedFile:_,onHandleUpload:p,onHandleSetIsExcelFileUploaded:P},null,8,["isSubmissionUploadSuccess"]),[[C,o(i).uploadLoading]]),Ht,F("div",Ot,[F("div",Ut,[r(kt,{"list-data":o(i).displayData,page:o(i).pagination.currentPage},null,8,["list-data","page"])])]),o(i).displayData.length>0?(f(),E(be,{key:0,onRaisePageChange:y[0]||(y[0]=w=>I(w)),currentPage:o(i).pagination.currentPage,totalPage:o(i).pagination.totalPage,totalPageSize:o(i).pagination.totalPageSize,startPaginationIndex:o(i).pagination.startPaginationIndex,endPaginationIndex:o(i).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):ie("",!0)]),_:1},8,["modelValue"])}}}),At=it(Mt,[["__scopeId","data-v-87d771c8"]]),$t={class:"row g-9 my-4"},Nt={class:"dialog-footer"},Bt=J({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(e,{emit:a}){const t=ce(),h=e,s=a,i=pe(h,"visibility"),d=R(()=>t.filterData),m=()=>{t.resetFilter(),b()},b=()=>{s("handle-close",!1)},_=l=>{console.log("site ",l),t.setSite(l)},p=l=>{console.log("site to ",l),t.setSiteTo(l)},n=l=>{t.setModel(l)},P=l=>{t.setModelTo(l)},I=l=>{t.setEquipment(l)},H=l=>{t.setEquipmentTo(l)},O=l=>{t.setComponent(l)},v=l=>{t.setComponentTo(l)},y=l=>{t.setReplacementDate(l)},c=l=>{t.setReplacementDateTo(l)},U=l=>{t.setReplacementSmu(l)},C=l=>{t.setReplacementSmuTo(l)},w=l=>{t.setFrameHours(l)},D=l=>{t.setFrameHoursTo(l)},S=()=>{const l=t.lastUsedFilterData.site!==t.filterData.site,q=t.lastUsedFilterData.siteTo!==t.filterData.siteTo,x=t.lastUsedFilterData.model!==t.filterData.model,B=t.lastUsedFilterData.modelTo!==t.filterData.modelTo,g=t.lastUsedFilterData.equipment!==t.filterData.equipment,j=t.lastUsedFilterData.equipmentTo!==t.filterData.equipmentTo,qe=t.lastUsedFilterData.component!==t.filterData.component,ke=t.lastUsedFilterData.componentTo!==t.filterData.componentTo,Le=t.lastUsedFilterData.replacementDate!==t.filterData.replacementDate,Pe=t.lastUsedFilterData.replacementDateTo!==t.filterData.replacementDateTo,He=t.lastUsedFilterData.replacementSmu!==t.filterData.replacementSmu,Oe=t.lastUsedFilterData.replacementSmuTo!==t.filterData.replacementSmuTo,Ue=t.lastUsedFilterData.frameHours!==t.filterData.frameHours,xe=t.lastUsedFilterData.frameHoursTo!==t.filterData.frameHoursTo;s("handle-close",l||q||x||B||g||j||qe||ke||Le||Pe||He||Oe||Ue||xe)};return(l,q)=>{const x=z("el-button"),B=z("el-dialog");return f(),E(B,{modelValue:i.value,"onUpdate:modelValue":q[0]||(q[0]=g=>i.value=g),title:"Filter",width:"60%",onClose:q[1]||(q[1]=g=>b())},{footer:u(()=>[F("span",Nt,[r(x,{type:"secondary",onClick:m},{default:u(()=>[V("Reset")]),_:1}),r(x,{type:"primary",onClick:S},{default:u(()=>[V("Filter")]),_:1})])]),default:u(()=>[F("div",$t,[r(W,{"value-from":d.value.site,"value-to":d.value.siteTo,label:"Site",name:"Site",options:o(t).siteOption,onHandleChangeFrom:_,onHandleChangeTo:p},null,8,["value-from","value-to","options"]),r(W,{"value-from":d.value.model,"value-to":d.value.modelTo,label:"Equipment Model",name:"EquipmentModel",options:o(t).modelOption,onHandleChangeFrom:n,onHandleChangeTo:P},null,8,["value-from","value-to","options"]),r(W,{"value-from":d.value.equipment,"value-to":d.value.equipmentTo,label:"Equipment Number",name:"EquipmentNumber",options:o(t).equipmentOption,onHandleChangeFrom:I,onHandleChangeTo:H},null,8,["value-from","value-to","options"]),r(W,{"value-from":d.value.component,"value-to":d.value.componentTo,label:"Component",name:"Component",options:o(t).componentOption,onHandleChangeFrom:O,onHandleChangeTo:v},null,8,["value-from","value-to","options"]),r(lt,{"value-from":d.value.replacementDate?d.value.replacementDate.toString():"","value-to":d.value.replacementDateTo?d.value.replacementDateTo.toString():"",label:"Replacement Date",name:"ReplacementDate",placeholder:"Pick a date",onHandleChangeFrom:y,onHandleChangeTo:c},null,8,["value-from","value-to"]),r(W,{"value-from":d.value.replacementSmu,"value-to":d.value.replacementSmuTo,label:"Replacement Smu",name:"ReplacementSmu",options:o(t).replacementSmuOption,onHandleChangeFrom:U,onHandleChangeTo:C},null,8,["value-from","value-to","options"]),r(W,{"value-from":d.value.frameHours,"value-to":d.value.frameHoursTo,label:"Frame Hours",name:"FrameHours",options:o(t).frameHoursOption,onHandleChangeFrom:w,onHandleChangeTo:D},null,8,["value-from","value-to","options"])])]),_:1},8,["modelValue"])}}}),Vt={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},zt=F("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),jt={class:"d-flex justify-content-between align-items-center"},Gt={class:"card"},Kt={class:"card-body grid-padding"},Yt={class:"my-5"},ao=J({__name:"Index",setup(e){const a=Me(),t=ce(),h=he(),s=ge(),i=Q(!1),d=Q(!1),m=Q(!1),b=R(()=>t.displayData),_=R(()=>t.pagination),p=C=>{t.setPage(C)};We(async()=>{a.dispatch(Be.ACTIVE_PAGE,"IronPortal"),Ae("Component Replacement",[{pageName:"IronPortal",pageRoute:"ironportal"},{pageName:"IronPortal Transactional",pageRoute:"componentreplacement"},{pageName:"Component Replacement",pageRoute:"componentreplacement"}]),t.setPage(1),await t.getLookup(),await h.getLookupSite()}),Xe(async()=>{t.resetState(),h.resetState(),s.resetState()});const n=async()=>{await t.setPage(1),await t.getLookup(),await h.getLookupSite()},P=()=>{i.value=!0},I=async C=>{i.value=!1,C&&await n()},H=()=>{d.value=!0},O=async C=>{d.value=!1,C&&await n()},v=async()=>{const C=await t.export();mt.saveAs(new Blob([C],{type:"application/octet-stream"}),"ComponentReplacement.xlsx")},y=()=>{m.value=!0},c=async C=>{m.value=!1,C&&await n()},U=()=>{i.value=!0,h.setErrors([])};return(C,w)=>(f(),k(ye,null,[F("div",Vt,[zt,F("div",jt,[r(je,{onShowDialog:P}),r(Ve,{onShowDialog:H}),r(Ke,{onHandleDownload:v}),r(Ge,{onShowDialog:y})])]),F("div",Gt,[F("div",Kt,[r(wt,{"list-data":b.value,page:_.value.currentPage,onFetchData:n,onDuplicateData:U},null,8,["list-data","page"])])]),F("div",Yt,[o(t).paginationLoading?ie("",!0):(f(),E(be,{key:0,onRaisePageChange:w[0]||(w[0]=D=>p(D)),currentPage:_.value.currentPage,totalPage:_.value.totalPage,totalPageSize:_.value.totalPageSize,startPaginationIndex:_.value.startPaginationIndex,endPaginationIndex:_.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),r(Rt,{visibility:i.value,onHandleClose:I},null,8,["visibility"]),r(Bt,{visibility:d.value,onHandleClose:O},null,8,["visibility"]),r(At,{visibility:m.value,onHandleClose:c},null,8,["visibility"])],64))}});export{ao as default};
