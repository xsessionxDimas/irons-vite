import{k as he,a0 as we,r as F,c as q,o as Qt,p as h,aa as D,aB as l,bd as Oe,bb as Le,b4 as ke,d as it,R as Y,Y as be,y as me,q as se,x as S,s as m,B as ve,C as P,F as ie,$ as fe,A as W,u as _,_ as ea,T as nt,aG as Ls,bL as Pt,a2 as Tt,a1 as Hs,a7 as Ms,L as Bs,n as $s}from"./@vue-BypzYtbH.js";import{e as C,_ as Da}from"./lodash-Cr9vlq0V.js";import{u as ae,b as g,s as A,e as u,p as Me,w as Us,t as xt,x as xs,y as Qe,z as ka,d as Sa,i as ja,q as qs,h as qt,g as Gs}from"./index-BCnwA6yE.js";import{c as Ia}from"./urls-DrpWsKIM.js";import{d as Ne}from"./pinia-BjOS2_Ao.js";import{l as xe,o as Js,a as Gt,f as Jt,n as Kt,p as ba,q as Ks,r as Ws,t as Ys,u as zs,A as re,c as ta,v as js,w as Rt}from"./date-format-BASVuupi.js";import{m as Zt,a as vt,f as Zs}from"./mapOption-sP4IrA4W.js";import{i as et,m as tt,f as Xs,s as Re,u as Vt,b as Ge,a as gt,d as Za,e as Qs,_ as at,g as yt}from"./ImagePreview.vue_vue_type_style_index_0_lang-BRUqW0pM.js";import{u as Q}from"./authentication-handler-B3K6P3Fb.js";import{S as Z,e as er,f as tr,h as ar,j as Ee,k as sr,l as rr,m as ir,n as nr,o as Xa,p as Qa}from"./helpers-Cten3vIM.js";import{a as or,_ as ue,b as aa}from"./element-plus-C5R56mia.js";import{C as es}from"./urls-hWHEBXep.js";import{C as lr}from"./urls-D8F5Tyyp.js";import{_ as Ue}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import{_ as qe}from"./ElementTextInput.vue_vue_type_style_index_0_lang-kzHysIyZ.js";import{_ as dr}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as Ce}from"./nw-img-vue-CR837WER.js";import{u as Ye}from"./@vueuse-MfruhCTE.js";import{i as ye}from"./internet-connection-B91-AJht.js";import{v as sa}from"./uuid-SoommWqA.js";import{E as ot}from"./ErrorAlert-CMKGfwAi.js";import{a as Lt}from"./vee-validate-C_msoaAA.js";import{c as Ht,a as Se,f as cr}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{_ as ur}from"./AutoComplete.vue_vue_type_script_setup_true_lang-D4CTLiQF.js";import{u as pr,o as mr}from"./vue-router-iNp9kJ0K.js";import{C as fr}from"./urls-Cljsxeb-.js";import{c as yr,e as hr}from"./get-user-info-ClQf79xP.js";import{P as vr}from"./Pagination-CVDIvnOM.js";import{u as gr}from"./useMsal-BbsBYoof.js";import"./attr-accept-BWI1aNlo.js";import"./vuex-BbOKrtVp.js";import"./object-path-BACu75q6.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./moment-C5S46NFB.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-DhbZvGod.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./index-CLJyswLZ.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";const lt="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention",Et="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/intervention_forms/lookup",Dr="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/intervention_form_lookup",kr=`${lt}_header/intervention_forms`,Sr=`${lt}_header/recommended_action`,Ir=`${lt}_header/additional_task`,br=`${lt}_header/get_list_by_param`,wr=`${lt}_header/intervention_forms`,_r=`${lt}_header/get_estimation_completion_date`,wa="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/list_intervention",_a="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/list_intervention_declined",Nr="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/total_list_intervention",Cr="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/type_task_lookup",Pr="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/type_condition_lookup",Tr="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/uom/lookup_transaction",Er="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/get_list_sensor",Ar="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/intervention_header/revise_sensor",Fr="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention",ts="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention/update_task_with_defect",as="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/get_data_by_param/",ss="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/get_data_list_by_param?ver=v1",Rr="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/get_data_list_by_param?ver=v1",Pe="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/update?ver=v1",Wt="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/update?ver=v1",Vr=`${Fr}/get_field_value`,Or="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/get_intervention_defect_header";class Lr{constructor(){this.smuDefectHeaders=[],this.defectHeaders=[],this.crackHeaders=[],this.cbmHeaders=[],this.defectNAHeaders=[],this.crackNAHeaders=[],this.defectDetails=[],this.crackDetails=[],this.defectNADetails=[],this.crackNADetails=[],this.defectGenericHeaders=[],this.defectGenericDetails=[],this.smuDefectDetails=[]}setDefectHeaders(t){this.defectHeaders=C.filter(t,a=>a.category==="NORMAL"&&a.taskValue=="2"||a.category==="NORMAL"&&a.taskValue=="3"&&a.cbmRatingType=="SERVICE_CLEANED_AND_REPLACED")}setSMUDefectHeaders(t){this.smuDefectHeaders=C.filter(t,a=>a.defectType=="machineSMU")}setDefectGenericHeaders(t){this.defectGenericHeaders=C.filter(t,a=>a.category==="NORMAL"&&a.defectType=="Generic")}setCrackHeaders(t){const a=["2","3"];this.crackHeaders=C.filter(t,s=>s.category==="CRACK"&&a.includes(s.taskValue))}setCBMHeaders(t){this.cbmHeaders=C.filter(t,a=>["CBM","CBM-NORMAL"].includes(a.category)&&isNaN(Number(a.taskValue))),this.cbmHeaders=C.orderBy(this.cbmHeaders,[a=>{let s=0;if(isNaN(Number(a.taskNo))){let r="",n=!0;for(let o=0;o<a.taskNo.length;o++)n&&isNaN(Number(a.taskNo.charAt(o)))&&(r=a.taskNo.charAt(o),n=!1);return Number(a.taskNo.split(r)[0])}else s=Number(a.taskNo);return s},a=>a.taskNo])}setDefectNAHeaders(t){this.defectNAHeaders=C.filter(t,a=>(a.category==="NORMAL"||a.category==="CBM")&&a.taskValue==="3"&&a.cbmRatingType!="SERVICE_CLEANED_AND_REPLACED")}setCrackNAHeaders(t){this.crackNAHeaders=C.filter(t,a=>a.category==="CRACK"&&a.taskValue==="4")}orderDetailTaskCBM(){this.cbmHeaders=this.cbmHeaders.sort((t,a)=>t.taskNo.localeCompare(a.taskNo,"en",{numeric:!0}))}setHeaders(t){this.setSMUDefectHeaders(t),this.setDefectHeaders(t),this.setDefectGenericHeaders(t),this.setCrackHeaders(t),this.setCBMHeaders(t),this.orderDetailTaskCBM(),this.setDefectNAHeaders(t),this.setCrackNAHeaders(t)}setDefectDetails(t){const a=C.keyBy(this.defectHeaders,s=>s.id);this.defectDetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.defectDetails.forEach(s=>{const r=this.defectHeaders.find(n=>n.id===s.defectHeaderId);r&&(r.priority=s.detail.priority,r.assetNumber=s.detail.assetNumber,r.imageAvailable=s.detail.images!="[]",r.status=="Acknowledge"||r.status=="Submited"?(r.numberStatus=1,r.plannerStatus=="Acknowledge"||r.plannerStatus=="Submited"?r.numberStatus=1:r.plannerStatus=="Decline"&&(r.numberStatus=2)):r.status=="Decline"&&(r.numberStatus=2))}),this.defectHeaders=C.orderBy(this.defectHeaders,[s=>s.numberStatus,s=>s.priority,s=>{var r;return Number((r=s.taskNo)==null?void 0:r.replaceAll(/[a-zA-Z]/g,""))},s=>s.taskDesc])}setDefectGenericDetails(t){const a=C.keyBy(this.defectGenericHeaders,s=>s.defectHeaderId);this.defectGenericDetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.defectGenericDetails.forEach(s=>{const r=this.defectGenericHeaders.find(n=>n.defectHeaderId===s.defectHeaderId);r&&(r.priority=s.detail.priority,r.assetNumber=s.detail.assetNumber,r.imageAvailable=s.detail.images!="[]",r.status=="Acknowledge"||r.status=="Submited"?(r.numberStatus=1,r.plannerStatus=="Acknowledge"||r.plannerStatus=="Submited"?r.numberStatus=1:r.plannerStatus=="Decline"&&(r.numberStatus=2)):r.status=="Decline"&&(r.numberStatus=2))}),this.defectGenericHeaders=C.orderBy(this.defectGenericHeaders,[s=>s.numberStatus,s=>s.priority,s=>s.taskDesc])}setSMUDefectDetails(t){const a=C.keyBy(this.smuDefectHeaders,s=>s.id);this.smuDefectDetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.smuDefectDetails.forEach(s=>{const r=this.defectGenericHeaders.find(n=>n.id===s.defectHeaderId);r&&(r.priority=s.detail.priority,r.assetNumber=s.detail.assetNumber,r.imageAvailable=s.detail.images!="[]",r.status=="Acknowledge"||r.status=="Submited"?(r.numberStatus=1,r.plannerStatus=="Acknowledge"||r.plannerStatus=="Submited"?r.numberStatus=1:r.plannerStatus=="Decline"&&(r.numberStatus=2)):r.status=="Decline"&&(r.numberStatus=2))})}setCrackDetails(t){const a=C.keyBy(this.crackHeaders,s=>s.id);this.crackDetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.crackDetails.forEach(s=>{const r=this.crackHeaders.find(n=>n.id===s.defectHeaderId);r&&(r.priority=s.detail.priority,r.assetNumber=s.detail.assetNumber,r.imageAvailable=s.detail.images!="[]",r.status=="Acknowledge"||r.status=="Submited"?(r.numberStatus=1,r.plannerStatus=="Acknowledge"||r.plannerStatus=="Submited"?r.numberStatus=1:r.plannerStatus=="Decline"&&(r.numberStatus=2)):r.status=="Decline"&&(r.numberStatus=2))}),this.crackHeaders=C.orderBy(this.crackHeaders,[s=>s.numberStatus,s=>s.priority,s=>Number(s.taskNo.replaceAll(/[a-zA-Z]/g,"")),s=>s.taskDesc])}setDefectNADetails(t){const a=C.keyBy(this.defectNAHeaders,s=>s.id);this.defectNADetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.defectNADetails.forEach(s=>{const r=this.defectNAHeaders.find(n=>n.id===s.defectHeaderId);r&&(r.cbmNAStatus=="Confirmed"||r.cbmNAStatus=="Not-Confirm"?(r.numberStatus=1,r.plannerCbmNAStatus=="Confirmed"||!r.plannerCbmNAStatus?r.numberStatus=1:r.plannerCbmNAStatus=="Decline"&&(r.numberStatus=2)):r.cbmNAStatus=="Decline"&&(r.numberStatus=2))}),this.defectNAHeaders=C.orderBy(this.defectNAHeaders,[s=>s.numberStatus,s=>Number(s.taskNo.replaceAll(/[a-zA-Z]/g,"")),s=>s.taskDesc])}setCrackNADetails(t){const a=C.keyBy(this.crackNAHeaders,s=>s.id);this.crackNADetails=C.filter(t,s=>a[s.defectHeaderId]!==void 0),this.crackNADetails.forEach(s=>{const r=this.crackNAHeaders.find(n=>n.id===s.defectHeaderId);r&&(r.cbmNAStatus=="Confirmed"||r.cbmNAStatus=="Not-Confirm"?(r.numberStatus=1,r.plannerCbmNAStatus=="Confirmed"||!r.plannerCbmNAStatus?r.numberStatus=1:r.plannerCbmNAStatus=="Decline"&&(r.numberStatus=2)):r.cbmNAStatus=="Decline"&&(r.numberStatus=2))}),this.crackNAHeaders=C.orderBy(this.crackNAHeaders,[s=>s.numberStatus,s=>Number(s.taskNo.replaceAll(/[a-zA-Z]/g,"")),s=>s.taskDesc])}setDetails(t){this.setDefectDetails(t),this.setDefectGenericDetails(t),this.setSMUDefectDetails(t),this.setCrackDetails(t),this.setDefectNADetails(t),this.setCrackNADetails(t)}updateDefectMOU(t,a){const s=this.defectHeaders.find(r=>r.id===t);s&&(s.defectWorkorder=a)}updateDefectRepairedStatus(t){const a=this.defectHeaders.find(s=>s.id===t);a&&(a.repairedStatus="Repaired")}setDefectAcknowledge(t){const a=this.defectHeaders.find(s=>s.id===t);a&&(a.status="Acknowledge")}updateCrackMOU(t,a){const s=this.crackHeaders.find(r=>r.id===t);s&&(s.defectWorkorder=a)}updateCrackRepairedStatus(t){const a=this.crackHeaders.find(s=>s.id===t);a&&(a.repairedStatus="Repaired")}setCrackAcknowledge(t){const a=this.crackHeaders.find(s=>s.id===t);a&&(a.status="Acknowledge")}setCBMAcknowledge(t){const a=this.cbmHeaders.find(s=>s.id===t);a&&(a.status="Acknowledge")}setDefectNAAcknowledge(t){const a=this.defectNAHeaders.find(s=>s.id===t);a&&(a.status="Acknowledge")}setCrackNAAcknowledge(t){const a=this.crackNAHeaders.find(s=>s.id===t);a&&(a.status="Acknowledge")}get DefectHeaders(){return this.defectHeaders}get SMUDefectHeaders(){return this.smuDefectHeaders}get DefectGenericHeaders(){return this.defectGenericHeaders}get CrackHeaders(){return this.crackHeaders}get CBMHeaders(){return this.cbmHeaders}get DefectNAHeaders(){return this.defectNAHeaders}get CrackNAHeaders(){return this.crackNAHeaders}get DefectDetails(){return this.defectDetails}get SMUDefectDetails(){return this.smuDefectDetails}get DefectGenericDetails(){return this.defectGenericDetails}get CrackDetails(){return this.crackDetails}get DefectNADetails(){return this.defectNADetails}get CrackNADetails(){return this.crackNADetails}}class Na extends Lr{setDefectHeaders(t){this.defectHeaders=C.filter(t,a=>a.category==="NORMAL"&&a.taskValue==="3")}setDefectNAHeaders(t){this.defectNAHeaders=C.filter(t,a=>(a.category==="NORMAL"||a.category==="CBM")&&a.taskValue==="4"),this.defectNAHeaders=C.orderBy(this.defectNAHeaders,[a=>Number(a.taskNo.replaceAll(/[a-zA-Z_;]/g,"")),a=>a.taskDesc])}}class ra{constructor(){this.type="",this.assetNumber="",this.raisedBy="",this.date="",this.title="",this.isValid=!0,this.images=[],this.description=this.initStringWithValidationType(),this.priority="",this.isComplete=!0}initValidationType(){return{isValid:!0,message:""}}initStringWithValidationType(t=""){return{value:t,isValid:!0,errorMessage:""}}initStringWithValidationTypeArray(t=""){return[this.initStringWithValidationType(t)]}setType(t){this.type=t}setRaisedBy(t){this.raisedBy=t}setDate(t){this.date=t}setAssetNumber(t){this.assetNumber=t}addImages(...t){this.images=this.images.concat(t)}setDescription(t){this.description.value=t}setTitle(t){this.title=t}setPriority(t){this.priority=t}setIsComplete(t){this.isComplete=t}validateDescription(){let t=!0;return this.description.value===""?(this.description.isValid=!1,this.description.errorMessage="Required",t=!1):(this.description.isValid=!0,this.description.errorMessage=""),t}get IsValid(){return this.isValid}get Images(){return this.images}get Description(){return this.description}get AssetNumber(){return this.assetNumber}get RaisedBy(){return this.raisedBy}get Date(){return this.date}get Title(){return this.title}get Priority(){return this.priority}get IsComplete(){return this.isComplete}get Type(){return this.type}}class ze extends ra{constructor(){super(),this.instruction=this.initStringWithValidationType(),this.plannedDuration=this.initStringWithValidationType(),this.parts=[],this.labours=[this.initLabours()],this.resources=this.initStringWithValidationTypeArray(),this.symptoms=this.initStringWithValidationTypeArray(),this.causes=this.initStringWithValidationTypeArray(),this.isNeed30Minutes=!1,this.defectRequirement=""}initParts(t="",a="",s="",r=[],n=[]){return{partNumberFormatted:t,partNumber:t,partDescription:a,qty:s,attachment:r,images:n,partNumberValidation:this.initValidationType(),descriptionValidation:this.initValidationType(),qtyValidation:this.initValidationType()}}initLabours(t="",a="",s="",r=""){return{position:t,qty:a,hireEach:s,totalHours:r,positionValidation:this.initValidationType(),qtyValidation:this.initValidationType(),hireEachValidation:this.initValidationType(),totalHoursValidation:this.initValidationType()}}setIsNeed30Minutes(t){this.isNeed30Minutes=t}setDefectRequirement(t){this.defectRequirement=t}setPlannedDuration(t){this.plannedDuration.value=t}setInstruction(t){this.instruction.value=t}importParts(...t){this.parts=[],t.forEach(a=>{this.parts.push(this.initParts(a.partNumber,a.partDescription,a.qty,a.attachment||[],a.images||[]))})}addPart(...t){t.forEach(a=>{this.parts.push(this.initParts(a.partNumber,a.partDescription,a.qty))})}importLabours(...t){this.labours=[],t.forEach(a=>{this.labours.push(this.initLabours(a.position,a.qty,a.hireEach,a.totalHours))})}addLabour(...t){t.forEach(a=>{this.labours.push(this.initLabours(a.position,a.qty,a.hireEach,a.totalHours))})}importResources(...t){this.resources=[],t.forEach(a=>{this.resources.push(this.initStringWithValidationType(a))})}addResource(...t){t.forEach(a=>{this.resources.push(this.initStringWithValidationType(a))})}importSymptoms(...t){this.symptoms=[],t.forEach(a=>{this.symptoms.push(this.initStringWithValidationType(a))})}addSymptom(...t){t.forEach(a=>{this.symptoms.push(this.initStringWithValidationType(a))})}importCauses(...t){this.causes=[],t.forEach(a=>{this.causes.push(this.initStringWithValidationType(a))})}addCauses(...t){t.forEach(a=>{this.causes.push(this.initStringWithValidationType(a))})}setPartNumber(t,a){this.parts[t].partNumber=a}setPartDescription(t,a){this.parts[t].partDescription=a}setPartQty(t,a){this.parts[t].qty=a}setPartImage(t,a){this.parts[t].images=a}setPartAttachment(t,a){this.parts[t].attachment=a}removeParts(t){this.parts.splice(t,1)}setLabourActivity(t,a){this.labours[t].position=a}setLabourQty(t,a){this.labours[t].qty=a}setLabourHireEach(t,a){this.labours[t].hireEach=a}setLabourTotalHours(t,a){this.labours[t].totalHours=a}removeLabours(t){this.labours.splice(t,1)}setResources(t,a){this.resources[t].value=a}removeResource(t){this.resources.splice(t,1)}setSymptom(t,a){this.symptoms[t].value=a}removeSymptom(t){this.symptoms.splice(t,1)}setCauses(t,a){this.causes[t].value=a}removeCauses(t){this.causes.splice(t,1)}validatePlannedDuration(){let t=!0;if(this.plannedDuration.value==="")this.plannedDuration.isValid=!1,this.plannedDuration.errorMessage="Required",t=!1;else if(isNaN(Number(this.plannedDuration.value)))this.plannedDuration.isValid=!1,this.plannedDuration.errorMessage="Invalid Format",t=!1;else{let a=!et(this.plannedDuration.value);if(a)this.plannedDuration.isValid=!0,this.plannedDuration.errorMessage="";else return this.plannedDuration.isValid=!1,this.plannedDuration.errorMessage="Invalid format",t=!1,t;a=tt(this.plannedDuration.value),a?this.IsNeed30Minutes&&(Number(this.plannedDuration.value)<=.5?(this.plannedDuration.isValid=!1,this.plannedDuration.errorMessage="Must more than half an hour",t=!1):(this.plannedDuration.isValid=!0,this.plannedDuration.errorMessage="")):(this.plannedDuration.isValid=!1,this.plannedDuration.errorMessage="Out of range (max 5 digit and 2 fraction)",t=!1)}return t}validateInstruction(){let t=!0;return this.instruction.value===""?(this.instruction.isValid=!1,this.instruction.errorMessage="Required",t=!1):(this.instruction.isValid=!0,this.instruction.errorMessage=""),t}validateParts(){let t=!0;const a=[];return this.parts.forEach(s=>{const r=[];r.push(this.validatePartDescription(s)),r.push(this.validatePartQty(s)),a.push(r.every(n=>n))}),t=a.every(s=>s),t}validatePartDescription(t){let a=!0;return t.partDescription===""?(t.descriptionValidation.isValid=!1,t.descriptionValidation.message="Required",a=!1):(t.descriptionValidation.isValid=!0,t.descriptionValidation.message=""),a}validatePartQty(t){let a=!0;if(t.qty==="")t.qtyValidation.isValid=!1,t.qtyValidation.message="Required",a=!1;else if(t.qty=="0"||Number(t.qty)==0)t.qtyValidation.isValid=!1,t.qtyValidation.message="Must be greater than 0",a=!1;else{let s=!et(t.qty);if(s)t.qtyValidation.isValid=!0,t.qtyValidation.message="";else return t.qtyValidation.isValid=!1,t.qtyValidation.message="Invalid format",a=!1,a;s=tt(t.qty),s?(t.qtyValidation.isValid=!0,t.qtyValidation.message=""):(t.qtyValidation.isValid=!1,t.qtyValidation.message="Out of range (max 5 digit and 2 fraction)",a=!1)}return a}validateLabours(){let t=!0;const a=[];return this.labours.forEach(s=>{const r=[];r.push(this.validateLaboursActivity(s)),r.push(this.validateLaboursQty(s)),r.push(this.validateLaboursHireEach(s)),a.push(r.every(n=>n))}),t=a.every(s=>s),t}validateLaboursActivity(t){let a=!0;return t.position?(t.positionValidation.isValid=!0,t.positionValidation.message=""):(t.positionValidation.isValid=!1,t.positionValidation.message="Required",a=!1),this.labours.filter(r=>r.position===t.position).length>1?(t.positionValidation.isValid=!1,t.positionValidation.message="Duplicate labour",a=!1):(t.positionValidation.isValid=!0,t.positionValidation.message=""),a}validateLaboursQty(t){let a=!0;if(t.qty==="")t.qtyValidation.isValid=!1,t.qtyValidation.message="Required",a=!1;else if(t.qty=="0"||Number(t.qty)==0)t.qtyValidation.isValid=!1,t.qtyValidation.message="Must be greater than 0",a=!1;else{let s=!et(t.qty);if(s)t.qtyValidation.isValid=!0,t.qtyValidation.message="";else return t.qtyValidation.isValid=!1,t.qtyValidation.message="Invalid format",a=!1,a;s=Xs(t.qty),s?(t.qtyValidation.isValid=!0,t.qtyValidation.message=""):(t.qtyValidation.isValid=!1,t.qtyValidation.message="Out of range (max 5 digits)",a=!1)}return a}validateLaboursHireEach(t){let a=!0;if(t.hireEach==="")t.hireEachValidation.isValid=!1,t.hireEachValidation.message="Required",a=!1;else if(t.hireEach=="0"||Number(t.hireEach)==0)t.hireEachValidation.isValid=!1,t.hireEachValidation.message="Must be greater than 0",a=!1;else{let s=!et(t.hireEach);if(s)t.hireEachValidation.isValid=!0,t.hireEachValidation.message="";else return t.hireEachValidation.isValid=!1,t.hireEachValidation.message="Invalid format",a=!1,a;s=tt(t.hireEach),s?(t.hireEachValidation.isValid=!0,t.hireEachValidation.message=""):(t.hireEachValidation.isValid=!1,t.hireEachValidation.message="Out of range (max 5 digit and 2 fraction)",a=!1)}return a}validateLaboursTotalHours(t){let a=!0;if(t.totalHours==="")t.totalHoursValidation.isValid=!1,t.totalHoursValidation.message="Required",a=!1;else{let s=!et(t.totalHours);if(s)t.totalHoursValidation.isValid=!0,t.totalHoursValidation.message="";else return t.totalHoursValidation.isValid=!1,t.totalHoursValidation.message="Invalid format",a=!1,a;s=tt(t.totalHours),s?(t.totalHoursValidation.isValid=!0,t.totalHoursValidation.message=""):(t.totalHoursValidation.isValid=!1,t.totalHoursValidation.message="Out of range (max 5 digit and 2 fraction)",a=!1)}return a}validateResources(){let t=!0;return this.resources.forEach((a,s)=>{s!==0&&(t=this.validateResource(a))}),t}validateResourcesAdd(){let t=!0;return this.resources.forEach(a=>{t=this.validateResource(a)}),t}validateResourcesRemove(){let t=!0;const a=this.resources.length;return this.resources.forEach((s,r)=>{if(r===0&&s.value==""&&a==1){s.isValid=!0;return}t=this.validateResource(s)}),t}validateResource(t){let a=!0;return t.value===""?(t.isValid=!1,t.errorMessage="Required",a=!1):(t.isValid=!0,t.errorMessage=""),a}validateSymptoms(){let t=!0;return this.symptoms.forEach(a=>{t=this.validateSymptom(a)}),t}validateSymptom(t){let a=!0;return t.value===""?(t.isValid=!1,t.errorMessage="Required",a=!1):this.Symptoms.filter(r=>r.value===t.value).length>1?(t.isValid=!1,t.errorMessage="Duplicate symptom",a=!1):(t.isValid=!0,t.errorMessage=""),a}validateCauses(){let t=!0;return this.causes.forEach(a=>{t=this.validateCause(a)}),t}validateCause(t){let a=!0;return t.value===""?(t.isValid=!1,t.errorMessage="Required",a=!1):this.Causes.filter(r=>r.value===t.value).length>1?(t.isValid=!1,t.errorMessage="Duplicate causes",a=!1):(t.isValid=!0,t.errorMessage=""),a}validateDefectForm(){const t=[];t.push(this.validateDescription()),t.push(this.validatePlannedDuration()),t.push(this.validateInstruction()),t.push(this.validateParts()),t.push(this.validateLabours()),t.push(this.validateResources()),t.push(this.validateSymptoms()),t.push(this.validateCauses()),this.isValid=t.every(a=>a)}get PlannedDuration(){return this.plannedDuration}get Instruction(){return this.instruction}get Parts(){return this.parts}get Labours(){return this.labours}get Resources(){return this.resources}get Symptoms(){return this.symptoms}get Causes(){return this.causes}get IsNeed30Minutes(){return this.isNeed30Minutes}get DefectRequirement(){return this.defectRequirement}}class Ca extends ze{constructor(){super(),this.crackLength=[]}initCracks(t="",a="",s="",r=""){return{locationId:t,locationDesc:a,previousCrack:s,currentCrack:r,isValid:!0,errorMessage:""}}setCurrentCrack(t,a){this.crackLength[t].currentCrack=a}importPreviousCrack(...t){this.crackLength=[],t.forEach(a=>{this.crackLength.push(this.initCracks(a.locationId,a.locationDesc,a.previousCrack,a.currentCrack))})}validateCurrentCrack(t){let a=!0;if(t.currentCrack==="")t.isValid=!1,t.errorMessage="Required",a=!1;else if(t.currentCrack=="0"||parseFloat(t.currentCrack)==0)t.isValid=!1,t.errorMessage="Must be greater than 0",a=!1;else{let s=!et(t.currentCrack);if(s)t.isValid=!0,t.errorMessage="";else return t.isValid=!1,t.errorMessage="Invalid format",a=!1,a;s=tt(t.currentCrack),s?(t.isValid=!0,t.errorMessage=""):(t.isValid=!1,t.errorMessage="Out of range (max 5 digit and 2 fraction)",a=!1)}return a}validateCrack(){let t=!0;return this.crackLength.forEach(a=>{t=this.validateCurrentCrack(a)}),t}validateDefectForm(){const t=[];t.push(this.validateDescription()),t.push(this.validatePlannedDuration()),t.push(this.validateInstruction()),t.push(this.validateCrack()),t.push(this.validateParts()),t.push(this.validateLabours()),t.push(this.validateResources()),t.push(this.validateSymptoms()),t.push(this.validateCauses()),this.isValid=t.every(a=>a)}get CrackLength(){return this.crackLength}}const $e="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention",Pa=`${$e}/get_intervention_list`,rs=`${$e}/get_intervention`,Hr=`${$e}/get_data_by_param`,Ta=`${$e}/get_task_progress`,st=`${$e}/update`,Mr="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/master_setting/get_server_time",Ea=`${$e}/get_field_value`,ht=`${$e}/update_task`,Aa=`${$e}/update_task_with_defect`,At=`${$e}/get_field_value`,is="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/defect_header",Yt=`${is}/get_data_by_param`,zt=`${is}/update`,Fa=Ne({id:"GeneralComponentInterventionFormStore",state:()=>({statePayload:{},stateUpdateParams:{},statePropertyParams:{},stateGeneralUpdated:!1,stateGeneralForm:{},initPreriskImages:[],stateSMUTolerance:{},stateSMUToleranceNotMapped:!1,stateIsSmuCameraDisabled:!1,stateIsRiskAssesmentPhotoTaken:!1,stateSelectedFitterShift:{},stateTimeStamp:"",stateShiftList:[],stateTimeZone:"+10.00",stateTimeZoneDesc:"AEST",stateIsSelectedFitterAlreadyLoggedIn:!1,stateFitterInfo:{},stateIsFitterLoggedInExist:!1,statePersoneelHistory:[]}),getters:{payload:e=>e.statePayload,generalUpdated:e=>e.stateGeneralUpdated,generalForm:e=>e.stateGeneralForm,smuTolerance:e=>e.stateSMUTolerance,SMUToleranceNotMapped:e=>e.stateSMUToleranceNotMapped,IsRiskAssesmentPhotoTaken:e=>e.stateIsRiskAssesmentPhotoTaken,IsSelectedFitterAlreadyLoggedIn:e=>e.stateIsSelectedFitterAlreadyLoggedIn,FitterInfo:e=>e.stateFitterInfo,IsFitterLoggedInExist:e=>e.stateIsFitterLoggedInExist,PersoneelHistory:e=>e.statePersoneelHistory},actions:{setPersoneelHistory(e){const t={...e};this.statePersoneelHistory.length==0?(t.isChecked=!1,this.statePersoneelHistory.push(t)):this.statePersoneelHistory.findIndex(s=>s.id==e.id)<0&&(t.isChecked=!1,this.statePersoneelHistory.push(t))},setPersoneelHistoryChecked(e,t){if(this.statePersoneelHistory.length>0){const a=this.statePersoneelHistory.findIndex(s=>s.id==e.id);a>=0&&(this.statePersoneelHistory[a].isChecked=t)}},setIsFitterLoggedInExist(e){this.stateIsFitterLoggedInExist=e},setFitterInfo(e){this.stateFitterInfo=C.cloneDeep(e)},setFitterInfoFitter(e,t,a){this.stateFitterInfo.employee={id:e.value,name:e.label},this.stateFitterInfo.timeLoggedIn=t,this.stateFitterInfo.shift=a},setFitterInfoIsIHaveReadChecked(e){this.stateFitterInfo.isIHaveReadChecked=e},setFitterInfoRiskPhotos(e){C.isUndefined(this.stateFitterInfo.riskPhotos)&&(this.stateFitterInfo.riskPhotos=[]),this.stateFitterInfo.riskPhotos=[...Re(this.stateFitterInfo.riskPhotos),...e],this.stateIsFitterLoggedInExist&&this.setGeneralFitterInfoToIndexedDB()},deleteFitterInfoRiskPhotos(e){this.stateFitterInfo.riskPhotos=Re(this.stateFitterInfo.riskPhotos),this.stateFitterInfo.riskPhotos=this.stateFitterInfo.riskPhotos.filter(t=>e!=t.filename),this.setGeneralFitterInfoToIndexedDB()},async setGeneralFitterInfoToIndexedDB(){const e=this.generalForm.log?C.cloneDeep(this.generalForm.log):[],t=e.findIndex(n=>n.employee.id==this.stateFitterInfo.employee.id);this.stateFitterInfo.isIHaveReadChecked=!0,t>=0?e[t]=this.stateFitterInfo:e.push(this.stateFitterInfo);const a=ae(),s={id:this.generalForm.id,updateParams:[{keyValue:this.generalForm.key,propertyParams:[{propertyName:"log",propertyValue:JSON.stringify(e)}]}],employee:{id:a.user.EmployeeId,name:a.user.Name}},r={ver:"v1"};try{await g.post(`${st}?${new URLSearchParams(r).toString()}`,s)}catch(n){A("IRONS",n),console.log("update log",n)}},async deleteGeneralFitterInfoFromIndexedDB(){try{this.stateIsFitterLoggedInExist=!1,this.stateFitterInfo={}}catch(e){console.log("error at indexeddb",e)}},setServiceStart(){const t=`${xe()}`;this.addPropertyParam("GENERAL","serviceStart",t),this.stateGeneralForm.serviceStart=t},setIsSelectedFitterAlreadyLoggedIn(e){this.stateIsSelectedFitterAlreadyLoggedIn=e},setPayloadId(e,t,a){this.statePayload.id=e,this.statePayload.updateParams=[],this.statePayload.employee={},this.statePayload.employee.id=t,this.statePayload.employee.name=a},addPropertyParam(e,t,a){const s=this.statePayload.updateParams.find(n=>n.keyValue===e);if(s)this.stateUpdateParams=s;else{const n={keyValue:e,propertyParams:[]};this.statePayload.updateParams.push(n),this.stateUpdateParams=n}const r=this.stateUpdateParams.propertyParams.find(n=>n.propertyName===t);if(r){r.propertyValue=a;return}this.stateUpdateParams.propertyParams.push({propertyName:t,propertyValue:a})},addUpdatedByAndDate(e,t){const a={id:e,name:t};this.addPropertyParam("GENERAL","updatedBy",JSON.stringify(a)),this.addPropertyParam("GENERAL","updatedDate","<<ServerDateTime>>"),this.addPropertyParam("GENERAL","interventionExecution","On Progress")},addStatusHistory(e){const t=this.generalForm.statusHistory?C.cloneDeep(this.generalForm.statusHistory):[];t.push({status:e,updatedBy:this.FitterInfo.employee,updatedDate:"<<ServerDateTime>>",tsUpdatedDate:"<<ServerTimeStamp>>"}),this.addPropertyParam("GENERAL","statusHistory",JSON.stringify(t))},async updateGeneralForm(){const e={ver:"v1"};this.statePayload.id=this.generalForm.id;const t=Ae(),a=t.groups;let s=!0;a.forEach(i=>{i.doneTask<i.totalTask&&(s=!1)});const r=ae(),n={id:r.user.EmployeeId,name:r.user.Name};if(t.generalForm.riskAssesment[0].value.length>0&&this.addPropertyParam(this.generalForm.riskAssesment[0].key,"value",JSON.stringify(t.generalForm.riskAssesment[0].value)),this.generalForm.imageEquipment&&this.generalForm.imageEquipment.length>0&&this.addPropertyParam("GENERAL","imageEquipment",JSON.stringify(this.generalForm.imageEquipment)),this.addPropertyParam("GENERAL","supervisor",JSON.stringify(n)),this.addStatusHistory("On Progress"),this.setGeneralFitterInfoToIndexedDB(),s){const i=await this.getServiceSheetHeaderKeyValue("interventionExecution");if(i.toString().toLowerCase()=="open"||i.toString().toLowerCase()=="on progress")try{return this.statePayload.updateParams[0].keyValue=this.generalForm.key,await g.post(`${st}?${new URLSearchParams(e).toString()}`,this.statePayload),this.stateGeneralUpdated=!0,this.stateGeneralForm.interventionExecution="On Progress",!1}catch(o){A("IRONS",o),Q(o),console.log(o)}else return!0}else try{return this.statePayload.updateParams[0].keyValue=this.generalForm.key,await g.post(`${st}?${new URLSearchParams(e).toString()}`,this.statePayload),this.stateGeneralUpdated=!0,this.stateGeneralForm.interventionExecution="On Progress",this.setGeneralFitterInfoToIndexedDB(),!1}catch(i){Q(i),A("IRONS",i),console.log(i)}},resetGeneral(){this.stateGeneralUpdated=!1,this.statePersoneelHistory=[]},checkHmOffset(e){switch(e.hmOffset){case void 0:this.stateGeneralForm.hmOffset="Not Applicable";break;case"":this.stateGeneralForm.hmOffset="0";break}},setGeneralForm(e){this.stateIsRiskAssesmentPhotoTaken=!1,this.stateIsSmuCameraDisabled=!1,console.log(e),this.stateGeneralForm=e,this.checkHmOffset(e),C.isUndefined(e)||C.isUndefined(e.riskAssesment)||C.isUndefined(e.riskAssesment[0].value)||(this.initPreriskImages=C.cloneDeep(e.riskAssesment[0].value));try{this.generalForm.imageEquipment&&(this.stateIsSmuCameraDisabled=!0)}catch(t){console.log(t)}},async getServiceSheetHeaderKeyVal(e){const t={id:this.generalForm.id,keyValue:this.generalForm.key,propertyName:e},a={ver:"v1"},s=or.service({lock:!0,text:"Check SMU Value",background:"rgba(0, 0, 0, 0.7)"});try{const r=await g.post(`${Ea}?${new URLSearchParams(a).toString()}`,t);return s.close(),r.data.result.content!=""?r.data.result.content:""}catch(r){return Q(r),console.log(r),A("IRONS",r),s.close(),""}},async getServiceSheetHeaderKeyValue(e){const t={id:this.generalForm.id,keyValue:this.generalForm.key,propertyName:e},a={ver:"v1"};try{return(await g.post(`${Ea}?${new URLSearchParams(a).toString()}`,t)).data.result.content}catch(s){return Q(s),A("IRONS",s),console.log(s),"error"}},async UpdateServiceEndMechanic(e){const t={ver:"v1"},a=this.statePayload.updateParams[0].propertyParams.filter(r=>r.propertyName=="updatedBy"||r.propertyName=="updatedDate"),s={id:this.payload.id,updateParams:[{keyValue:this.generalForm.key,propertyParams:[e,...a]}],employee:this.payload.employee};try{await g.post(`${st}?${new URLSearchParams(t).toString()}`,s),this.stateGeneralUpdated=!0}catch(r){Q(r),A("IRONS",r),console.log(r)}},async getSMUTolerance(){this.stateSMUToleranceNotMapped=!1;const e={Parameter:"",ParameterTo:"",ValueMin:"",ValueMinTo:"",ValueMax:"",ValueMaxTo:"",Uom:"",UomTo:"",StartDate:"",StartDateTo:"",EndDate:"",EndDateTo:"",Page:"1",PageSize:"1",Order:"",ver:"v1"},t=()=>{this.stateSMUTolerance={min:0,max:0},this.stateSMUToleranceNotMapped=!0,console.log("SMU tolerance not mapped on ADM")};try{const s=(await g.get(es,"",new URLSearchParams(e).toString())).data.result.content[0];C.isUndefined(s)?t():s.isActive?this.stateSMUTolerance={min:Number(s.valueMin),max:Number(s.valueMax)}:t()}catch(a){Q(a),A("IRONS",a),t()}},async getServerTimestamp(e){const t={ver:"v1"};try{if(e){const a=await g.get(Mr,"",new URLSearchParams(t).toString());this.stateTimeStamp=a.data.result.content}else this.stateTimeStamp=xe()}catch(a){A("IRONS",a),Q(a)}},getShift(e){return this.stateShiftList.find(a=>a.shift==e)??{}},updateSMUImages(e){let t=[];this.generalForm.imageEquipment&&(t=this.generalForm.imageEquipment),t=[...t,...e],this.stateGeneralForm.imageEquipment=t},deleteSMUPic(e){let t=this.generalForm.imageEquipment;t=t.filter(a=>a!=e),this.generalForm.imageEquipment=t},toggleChangeIsRiskAssesmentPhotoTaken(e){this.stateIsRiskAssesmentPhotoTaken=e},updateSMUONGeneral(e){this.generalForm.interventionSMU=e},async getShiftListData(){const e={Shift:"",StartHour:"",StartHourType:"",EndHour:"",EndHourType:"",StartDate:"",EndDate:"",ver:"v1",Page:"1",PageSize:"999",Order:""};try{this.stateTimeZone="AEST",this.stateTimeZoneDesc="+10.00";const a=(await g.get(lr,"",new URLSearchParams(e).toString())).data.result.content;await u.shift.clear(),await u.shift.bulkAdd(a),this.stateShiftList=a}catch(t){Q(t),A("IRONS",t),console.log(t)}},async setShiftListLocal(){this.stateShiftList=await u.shift.toArray()}}}),Ae=Ne({id:"componentInterventionEformStore",state:()=>({stateInterventionId:"",stateEquipment:"",stateSapWorkOrder:"",stateModelUnit:"",stateSampleStatus:"",statecomponentDescription:"",stateServiceSheets:{},stateGroups:[],stateIsSet:!1,stateEmployee:{},stateSelectedGroup:void 0,stateTaskUpdated:void 0,stateFormAlreadySubmitted:!1,stateTaskAlreadyUpdated:!1,stateIsFormSelectedByOtherSupervisor:!1,stateMeasurementValue:"",stateImageKey:"",stateUOM:"",stateRatingNotMapped:!1,stateCBMFormulas:"",stateWorkOrder:"",stateShift:"",stateServiceStart:"",stateErrorMessage:"",stateSerialNumber:""}),getters:{selectedGroup:e=>e.stateSelectedGroup,groups:e=>e.stateGroups,isSet:e=>e.stateIsSet,employee:e=>e.stateEmployee,intervention:e=>e.stateServiceSheets,generalForm:e=>Da.omit(e.stateServiceSheets,"details"),details:e=>e.stateServiceSheets&&e.stateServiceSheets.details,formAlreadySubmitted:e=>e.stateFormAlreadySubmitted,serviceStart:e=>e.stateServiceStart,shift:e=>e.stateShift,taskUpdated:e=>e.stateTaskUpdated,taskAlreadyUpdated:e=>e.stateTaskAlreadyUpdated,ratingNotMapped:e=>e.stateRatingNotMapped,allCustomValidationRequiredDone:e=>{const t=[];e.stateServiceSheets.details&&e.stateServiceSheets.details.forEach(s=>{s.tasks.forEach(r=>{r.tasks.forEach(n=>{n.items.forEach(i=>{i.customValidation&&i.customValidation=="Required"&&t.push(i.value)})})})});let a=!0;return t.length>0&&(a=t.filter(r=>{if(!r)return!0}).length==0),a},isAllTaskDone:e=>{let t=!0;return e.stateGroups.forEach((a,s)=>{s!=0&&t&&a.totalTask!=a.doneTask&&(t=!1)}),t},errorMessage:e=>e.stateErrorMessage,percentageTaskProgressAllTab:e=>{let t=0,a=0;return e.stateGroups.forEach(s=>{console.log(s),a=a+s.doneTask,t=t+s.totalTask}),t==0?100:C.floor(a/t*100)},SerialNumber:e=>e.stateSerialNumber},actions:{toggleFormAlreadySubmitted(e){this.stateFormAlreadySubmitted=e},toggleFormUpdated(e){this.stateTaskUpdated=e},setMeasurementValueAndUOM(e,t,a){this.stateMeasurementValue=e,this.stateUOM=t,this.stateImageKey=a},setComponentInterventionHeader(e,t,a,s,r,n){this.stateInterventionId=e,this.stateEquipment=t,this.stateSapWorkOrder=a,this.stateModelUnit=s,this.stateSampleStatus=r,this.statecomponentDescription=n},setSelectedGroup(e){this.stateGroups.forEach(t=>{t.key===e?t.isSelected=!0:t.isSelected=!1}),this.stateSelectedGroup=this.stateGroups.find(t=>t.isSelected)},getGroups(e=!1){const t=[{groupSeq:1,isSelected:!0,name:"General",group:"General",totalTask:0,doneTask:0,tasks:null,key:"0"}];let a=0;this.stateServiceSheets&&this.stateServiceSheets.details&&(a=this.stateServiceSheets.details.length,this.stateServiceSheets.details.forEach((s,r)=>{t.push({key:s.key,group:s.group,tasks:s.tasks,name:s.group,groupSeq:r+2,isSelected:!1,totalTask:0,doneTask:0})})),e&&t.push({groupSeq:1+a+1,isSelected:!1,name:"Defect Identified",group:"Defect Identified",totalTask:0,doneTask:0,tasks:null,key:"Defect Identified"}),this.stateGroups=t},async getTaskProgress(){const e={ver:"v1",id:this.generalForm.id};try{const a=(await g.get(`${Ta}`,"",new URLSearchParams(e).toString())).data.result.content;this.stateGroups[1].doneTask=a.doneTask,this.stateGroups[1].totalTask=a.totalTask}catch(t){A("IRONS",t),console.log(t)}},changeIsFormSelectedByOtherSupervisor(e){this.stateIsFormSelectedByOtherSupervisor=e},async getInterventionData(e=""){const t={ver:"v1",keyPbi:this.stateInterventionId||e},a=await g.get(`${rs}?${new URLSearchParams(t).toString()}`);if(a.data.result.message=="Cannot Access With Different Supervisor")return this.changeIsFormSelectedByOtherSupervisor(!0),!1;this.stateServiceSheets=a.data.result.content},async getInterventionDataCosmos(e=""){const t={id:this.stateInterventionId||e},a={ver:"v1"},s=await g.post(`${Hr}?${new URLSearchParams(a).toString()}`,t);if(s.data.result.message=="Cannot Access With Different Supervisor")return this.changeIsFormSelectedByOtherSupervisor(!0),!1;this.stateServiceSheets=s.data.result.content,await u.interventionDetailView.put(s.data.result.content)},async postGenerateServiceSheet(e,t=!1,a=!1){e&&(t&&!a?await this.getInterventionDataCosmos():await this.getInterventionData());try{const s=Fa();this.stateServiceSheets.imageEquipment||(this.stateServiceSheets.imageEquipment=[]);const r=Da.omit(this.stateServiceSheets,"details");return s.setGeneralForm(r),this.getGroups(t),this.getTaskProgress(),this.stateSelectedGroup=this.stateGroups[0],this.stateIsSet=!0,!0}catch(s){try{return Q(s),console.log(s),!1}catch(r){this.stateErrorMessage=r,console.log("error",r)}}},updateSelectedFitter(e){this.stateEmployee=e},resetMechanic(){this.stateEmployee={},this.stateServiceStart="",this.stateShift=""},updateGeneralValue(e,t){this.stateServiceSheets[e]=t},updateServiceStart(e){const t=Fa();this.stateServiceStart=e,this.stateShift=Js(t.stateTimeZone)},async updateRiskAssesment(e){let t=this.generalForm.riskAssesment&&this.generalForm.riskAssesment[0].value||"";t==""&&(t=[]),Array.isArray(t)?t=[...t,...e]:(t=[],t=[...t,...e]),this.stateServiceSheets.riskAssesment[0].value=t,await this.updatePreRiskAssesmentToBE()},async deleteRisAssesmentPic(e){let t=this.generalForm.riskAssesment[0].value;t=t.filter(a=>a.image!=e),this.stateServiceSheets.riskAssesment[0].value=t,await this.updatePreRiskAssesmentToBE()},async updatePreRiskAssesmentToBE(){const e={id:this.generalForm.id,updateParams:[{keyValue:this.generalForm.riskAssesment[0].key,propertyParams:[{propertyName:"value",propertyValue:JSON.stringify(this.generalForm.riskAssesment[0].value)}]}],employee:this.stateEmployee},t={ver:"v1"};try{await g.post(`${st}?${new URLSearchParams(t).toString()}`,e)}catch(a){Q(a),A("IRONS",a),console.log(a),console.log("upload risk Assesment",a)}},async setShowNextPage(){const e={ver:"v1",id:this.generalForm.id};let t=!1;try{const s=(await g.get(`${Ta}`,"",new URLSearchParams(e).toString())).data.result.content;s.doneTask==s.totalTask&&(t=!0)}catch(a){Q(a),A("IRONS",a),console.log(a),t=!1}if(t)if(await this.checkInterventionStatus()=="Submited")this.stateFormAlreadySubmitted=!0;else return!0;else return!1},setTaskUpdated(){this.stateTaskUpdated=!0},resetTaskUpdated(){this.stateTaskUpdated=void 0},async updateServiceSheetTaskValue(e,t,a,s=!0){let r=!1;const n={ver:"v1"};try{const i=this.groups.find(c=>c.isSelected),o={id:this.generalForm.id,headerId:this.generalForm.id,workOrder:this.generalForm.sapWorkOrder,updateParams:e,employee:{id:this.employee.id,name:this.employee.name}};this.stateTaskUpdated=!1;const d=await g.post(`${ht}?${new URLSearchParams(n).toString()}`,o);d.data.result.message==Z.SUBMITTED&&(this.stateFormAlreadySubmitted=!0),d.data.result.message==Z.TASK_UPDATED_BY_OTHER&&(this.stateTaskAlreadyUpdated=!0),this.getTaskProgress(),this.updateGroupByParam(i==null?void 0:i.name),r=!0,this.setTaskUpdated()}catch(i){Q(i),A("IRONS",i),console.log(i)}return this.stateTaskUpdated=!0,r},async updateGroupByParam(e){if(e!=="General")try{const t={id:this.generalForm.id,key:this.generalForm.key,propertyName:"details"},a={ver:"v1"},s=await g.post(`${At}?${new URLSearchParams(a).toString()}`,t);this.stateServiceSheets.details=s.data.result.content}catch(t){Q(t),A("IRONS",t),console.log(t)}},async getCBMResult(e,t){let a,s="";e.items.forEach(n=>{n.categoryItemType=="dropdownTool"&&(s=n.value)});const r=this.stateCBMFormulas.filter(n=>{const i=`${n.taskNumber}${n.detailNumber?n.detailNumber:""}`;if(typeof e.items[0].value=="string")if(t.categoryItemType=="paramRatingDynamic"){const o=i==e.items[0].value||i==e.items[0].value.substring(0,e.items[0].value.length-1),d=n.cbmType==s;return o&&d}else return i==e.items[0].value||i==e.items[0].value.substring(0,e.items[0].value.length-1)});if(r.length>0)if(r.every(n=>{const i=er(n,t.value),o=tr(n,t.value);return a=ar(i,o,n),console.log("checkMin",i,"checkMax",o,"formula",n),!a}),a){const n=e.items.find(i=>i.categoryItemType=="targetRating");if(a=="C"||a=="X"){const i=ae(),o={ver:"v1"},d=`${e.description.split(";")[0]};${e.description.split(";")[1]}`,c={updateParams:[{keyValue:e.key,propertyParams:[{propertyName:"taskValue",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],headerId:this.generalForm.id,workOrder:this.generalForm.sapWorkOrder,id:this.generalForm.id,employee:this.employee,defectHeader:{workorder:this.generalForm.sapWorkOrder,form:this.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:this.generalForm.id,category:e.category,taskId:e.key,taskNo:d,taskDesc:e.items[2].value,defectWorkorder:"",formDefect:"",defectType:"",cbmMeasurement:this.stateMeasurementValue,cbmUom:this.stateUOM,cbmImageKey:this.stateImageKey,cbmImageProp:"value",isCbmAdjusment:"false",taskValue:a,repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:{id:i.user.EmployeeId,name:i.user.Name},status:"Submit"}},p=await g.post(`${Aa}?${new URLSearchParams(o).toString()}`,c);if(p.data.result.message==Z.TASK_UPDATED_BY_OTHER)return this.stateTaskAlreadyUpdated=!0,{value:"",status:!1};if(p.data.result.message==Z.SUBMITTED)return this.stateFormAlreadySubmitted=!0,{value:"",status:!1};const f=[{keyValue:n.key,propertyParams:[{propertyName:"value",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}];return this.updateItemServiceSheetDetail(f),this.stateMeasurementValue="",this.stateUOM="",this.stateImageKey="",{value:a,status:!0}}else{n.value=a;const i=[{keyValue:n.key,propertyParams:[{propertyName:"value",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:e.key,propertyParams:[{propertyName:"taskValue",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}];await this.updateServiceSheetTaskValue(i,this.employee.id.toString(),this.employee.name,!1)}return{value:"",status:!0}}else return await this.deleteExisitingDefectCBMAuto(e),{value:"",status:!0};else return this.stateRatingNotMapped=!0,console.log("rating CBM for this task is not mapped on ADM"),{value:"",status:!1}},async deleteExisitingDefectCBMAuto(e){const t={ver:"v1"};let a={};const s={keyValue:e.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]};e.items.forEach(async i=>{if(i.categoryItemType=="targetRating"){if(a={keyValue:i.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]},i.value=="C"||i.value=="X"){const o={taskId:e.key,workorder:this.stateWorkOrder},c=(await g.post(`${Yt}?${new URLSearchParams(t).toString()}`,o)).data.result.content,p={id:c.id,updateParams:[{keyValue:c.key,propertyParams:[{propertyName:"isActive",propertyValue:"false"}]}],employee:this.employee};try{await g.post(`${zt}?${new URLSearchParams(t).toString()}`,p)}catch(f){Q(f),A("IRONS",f),console.log(f)}}i.value=""}});const r=[a,s],n={headerId:this.generalForm.id,workorder:this.generalForm.sapWorkOrder,id:this.generalForm.id,updateParams:r,employee:this.employee};try{await g.post(`${ht}?${new URLSearchParams(t).toString()}`,n)}catch(i){Q(i),A("IRONS",i),console.log(i)}},async getEhmsRating(){const e={ver:"v1"};try{const t=await g.get("",new URLSearchParams(e).toString());this.stateCBMFormulas=t.data.result.content[0].detail}catch(t){Q(t),A("IRONS",t),console.log(t)}},async getValueFromItemKey(e){const t={keyValue:e,propertyName:"value"},a={ver:"v1"};let s="";const r=await g.post(`${At}?${new URLSearchParams(a).toString()}`,t);return C.isUndefined(r.data.result.content)||(s=r.data.result.content),s},async checkInterventionStatus(){const e={id:this.generalForm.id,key:this.generalForm.key,propertyName:"interventionExecution"},t={ver:"v1"};return(await g.post(`${At}?${new URLSearchParams(t).toString()}`,e)).data.result.content},async updateItemServiceSheetDetail(e){const t={ver:"v1"},a={headerId:this.generalForm.id,workorder:this.generalForm.sapWorkOrder,id:this.generalForm.id,updateParams:e,employee:{id:this.employee.id,name:this.employee.name}};try{await g.post(`${ht}?${new URLSearchParams(t).toString()}`,a)}catch(s){Q(s),A("IRONS",s),console.log(s),console.log("error update item",s)}},async submitEform(){const e={ver:"v1"};let t=!1;const a={interventionId:this.generalForm.id};(await g.post(`${ss}`,a)).data.result.content.length>0&&(t=!0);const r=[{propertyName:"interventionExecution",propertyValue:t?"Submited":"Close"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}],n=this.generalForm.statusHistory?C.cloneDeep(this.generalForm.statusHistory):[];n.push({status:t?"Submited":"Close",updatedBy:this.employee,updatedDate:"<<ServerDateTime>>",tsUpdatedDate:"<<ServerTimeStamp>>"}),r.push({propertyName:"statusHistory",propertyValue:JSON.stringify(n)});const i={id:this.generalForm.id,updateParams:[{keyValue:this.generalForm.key,propertyParams:r}],employee:this.employee};try{return await g.post(`${st}?${new URLSearchParams(e).toString()}`,i),!0}catch(o){return A("IRONS",o),console.log(o),!1}},async updateDefect(e,t,a){const s=ae(),r={ver:"v1"},n=`${e.description.split(";")[0]};${e.description.split(";")[1]}`,i={updateParams:[{keyValue:e.key,propertyParams:[{propertyName:"taskValue",propertyValue:t},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],headerId:this.generalForm.id,workorder:this.generalForm.sapWorkOrder,id:this.generalForm.id,employee:this.employee,defectHeader:{workorder:this.generalForm.sapWorkOrder,form:this.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:this.generalForm.id,category:e.category,taskId:e.key,taskNo:n,taskDesc:e.items[2].value,defectWorkorder:"",formDefect:"",defectType:"",cbmMeasurement:this.stateMeasurementValue,cbmUom:this.stateUOM,cbmImageKey:this.stateImageKey,cbmImageProp:"value",isCbmAdjusment:"false",taskValue:t,repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:{id:s.user.EmployeeId,name:s.user.Name},status:"Submit"}};try{const o=await g.post(`${Aa}?${new URLSearchParams(r).toString()}`,i);if(o.data.result.message==Z.SUBMITTED)return this.stateFormAlreadySubmitted=!0,!1;if(o.data.result.message==Z.TASK_UPDATED_BY_OTHER)return this.stateTaskAlreadyUpdated=!0,!1;this.stateMeasurementValue="",this.stateUOM="",this.stateImageKey="",await this.deleteDefect(e);let d={},c={};a.categoryItemType=="resultRating"&&(c={keyValue:e.key,propertyParams:[{propertyName:"taskNormalValue",propertyValue:""}]},e.items.forEach(I=>{I.categoryItemType=="resultStatus"&&(d={keyValue:I.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]})}));const p=[{keyValue:a.key,propertyParams:[{propertyName:"value",propertyValue:t},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}];a.categoryItemType=="resultRating"&&(p.push(d),p.push(c)),await this.updateItemServiceSheetDetail(p);const f=this.groups.find(I=>I.isSelected);return this.getTaskProgress(),this.updateGroupByParam(f==null?void 0:f.name),!0}catch(o){return Q(o),A("IRONS",o),console.log(o),!1}},toggleNotMapped(e){this.stateRatingNotMapped=e},toggleTaskAlreadyUpdatedStatus(e){this.stateTaskAlreadyUpdated=e},handleGetUomFromSelectedTool(e,t){const a=this.stateCBMFormulas.filter(r=>{const n=`${r.taskNumber}${r.detailNumber?r.detailNumber:""}`;if(typeof e.items[0].value=="string")return n==e.items[0].value||n==e.items[0].value.substring(0,e.items[0].value.length-1)});let s="";return a.forEach(r=>{r.cbmType==t&&(s=r.uom)}),s},async updateToolUom(e,t){const a=this.handleGetUomFromSelectedTool(e,t.value);let s={};e.items.forEach(d=>{d.categoryItemType=="targetTool"&&(d.value=a,s={keyValue:d.key,propertyParams:[{propertyName:"value",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})});const r={keyValue:t.key,propertyParams:[{propertyName:"value",propertyValue:t.value},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},n=[s,r],i={ver:"v1"},o={headerId:this.generalForm.id,workorder:this.generalForm.sapWorkOrder,id:this.generalForm.id,updateParams:n,employee:this.employee};try{await g.post(`${ht}?${new URLSearchParams(i).toString()}`,o)}catch(d){Q(d),A("IRONS",d),console.log(d)}await this.resetCBMMeasurementValueAndDefect(e)},async resetCBMMeasurementValueAndDefect(e){const t={ver:"v1"};let a={},s={},r={};e.items.forEach(async d=>{if(d.categoryItemType=="paramRatingDynamic"&&(d.value="",a={keyValue:d.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]}),d.categoryItemType=="targetRating"){if(s={keyValue:d.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]},d.value=="C"||d.value=="X"){const c={taskId:e.key,workorder:this.stateWorkOrder},f=(await g.post(`${Yt}?${new URLSearchParams(t).toString()}`,c)).data.result.content,I={id:f.id,updateParams:[{keyValue:f.key,propertyParams:[{propertyName:"isActive",propertyValue:"false"}]}],employee:this.employee};try{await g.post(`${zt}?${new URLSearchParams(t).toString()}`,I)}catch(v){Q(v),A("IRONS",v),console.log(v)}}d.value=""}d.itemType=="smallCamera"&&(r={keyValue:d.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]})});const i=[{keyValue:e.key,propertyParams:[{propertyName:"value",propertyValue:""},{propertyName:"updatedBy",propertyValue:""},{propertyName:"updatedDate",propertyValue:""}]},a,s,r],o={headerId:this.generalForm.id,workorder:this.generalForm.sapWorkOrder,id:this.generalForm.id,updateParams:i,employee:this.employee};try{await g.post(`${ht}?${new URLSearchParams(t).toString()}`,o)}catch(d){Q(d),A("IRONS",d),console.log(d)}await this.getTaskProgress(),await this.updateGroupByParam(this.stateSelectedGroup.name)},async deleteDefect(e){const t={ver:"v1"},a={taskId:e.key,workorder:this.stateWorkOrder},r=(await g.post(`${Yt}?${new URLSearchParams(t).toString()}`,a)).data.result.content,n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:"isDeleted",propertyValue:"true"},{propertyName:"isActive",propertyValue:"false"}]}],employee:this.employee};try{await g.post(`${zt}?${new URLSearchParams(t).toString()}`,n)}catch(i){Q(i),A("IRONS",i),console.log(i)}},setPreviewShowNextPage(){const e=this.stateGroups.findIndex(a=>{var s;return a.name==((s=this.stateSelectedGroup)==null?void 0:s.name)}),t=this.stateGroups[e+1];this.setSelectedGroup(t.key),this.getTaskProgress(),this.updateGroupByParam(t.name)},setPreviewShowPrevPage(){const e=this.stateGroups.findIndex(a=>{var s;return a.name==((s=this.stateSelectedGroup)==null?void 0:s.name)}),t=this.stateGroups[e-1];this.setSelectedGroup(t.key),this.updateGroupByParam(t.name)},resetPreview(){this.stateInterventionId="",this.stateEquipment="",this.stateSapWorkOrder="",this.stateModelUnit="",this.stateSampleStatus="",this.statecomponentDescription="",this.stateServiceSheets={},this.stateGroups=[],this.stateIsSet=!1,this.stateEmployee={},this.stateSelectedGroup=void 0},resetPreviewPDF(){this.stateSelectedGroup=void 0},async getDynamicValue(e){const t={id:e.id,keyValue:e.key,propertyName:e.propertyName},a={ver:"v1"};let s="";const r=await g.post(`${At}?${new URLSearchParams(a).toString()}`,t);return C.isUndefined(r.data.result.content)||(s=r.data.result.content),s},setSerialNumber(e){this.stateSerialNumber=e}}});class Xt extends ra{constructor(){super(),this.actions=[this.initStringWithValidationType()]}importActions(...t){this.actions=[],t.forEach(a=>{this.actions.push(this.initStringWithValidationType(a))})}addAction(...t){t.forEach(a=>{this.actions.push(this.initStringWithValidationType(a))})}setAction(t,a){this.actions[t].value=a}removeAction(t){this.actions.splice(t,1)}validateActions(){let t=!0;return this.actions.forEach(a=>{t=this.validateAction(a)}),t}validateAction(t){let a=!0;return t.value===""?(t.isValid=!1,t.errorMessage="Required",a=!1):(t.isValid=!0,t.errorMessage=""),a}validateDefectForm(){const t=[];t.push(this.validateDescription()),t.push(this.validateActions()),this.isValid=t.every(a=>a==!0)}get Actions(){return this.actions}}class Br extends ra{constructor(){super(),this.assetNumber="",this.instruction=this.initStringWithValidationType(),this.crackLength=[]}initCracks(t="",a="",s="",r=""){return{locationId:t,locationDesc:a,previousCrack:s,currentCrack:r,isValid:!0,errorMessage:""}}setAssetNumber(t){this.assetNumber=t}setInstruction(t){this.instruction.value=t}setCurrentCrack(t,a){this.crackLength[t].currentCrack=a}importPreviousCrack(...t){this.crackLength=[],t.forEach(a=>{this.crackLength.push(this.initCracks(a.locationId,a.locationDesc,a.previousCrack,a.currentCrack))})}validateInstruction(){let t=!0;return this.instruction.value===""?(this.instruction.isValid=!1,this.instruction.errorMessage="Required",t=!1):(this.instruction.isValid=!0,this.instruction.errorMessage=""),t}validateCurrentCrack(t){let a=!0;return t.currentCrack===""?(t.isValid=!1,t.errorMessage="Required",a=!1):t.currentCrack=="0"||parseFloat(t.currentCrack)==0?(t.isValid=!1,t.errorMessage="Must be greater than 0",a=!1):tt(t.currentCrack)?(t.isValid=!0,t.errorMessage=""):(t.isValid=!1,t.errorMessage="Out of range (max 5 digit and 2 fraction)",a=!1),a}validateCrack(){let t=!0;return this.crackLength.forEach(a=>{t=this.validateCurrentCrack(a)}),t}validateDefectForm(){const t=[];t.push(this.validateDescription()),t.push(this.validateInstruction()),t.push(this.validateCrack()),this.isValid=t.every(a=>a==!0)}get AssetNumber(){return this.assetNumber}get Instruction(){return this.instruction}get CrackLength(){return this.crackLength}}const Dt={STATUS_IN_RANGE:"In range",STATUS_NOT_IN_RANGE:"Not in range",STATUS_NOT_IN_RANGE_LOWERCASE:"not in range",STATUS_OUT_OF_RANGE:"Out of range",MACHINESMUTITLE:()=>"Machine SMU",TITLE:e=>`Machine SMU - ${e}`,VIEW_DIALOG_LABEL:e=>`Machine SMU ${e?"":` ${Dt.STATUS_NOT_IN_RANGE_LOWERCASE}`}`},Je=Ne({id:"ComponentInterventionDefects",state:()=>({stateLoading:!1,stateData:new Na,stateComments:[],stateDefectFormData:new ze,stateDefectNoFormData:new Xt,stateCrackFormData:new Ca,stateCrackSimpleFormData:new Br,stateIsError:!1,stateHeaderId:"",stateDetailId:"",stateHeaderStatus:"",stateHeaderPlannerStatus:"",stateDefectFetched:!1,stateLoadDefectImages:!1,stateApproveBy:void 0,stateApproveDate:void 0,stateDefectPictures:{},stateDefectKey:1,stateDeclineReason:"",stateDeclineBy:{},stateDeclineDate:"",stateApprovedBy:{},stateApprovedDate:"",stateErrorMessage:"",stateCurrentUserGroup:"",stateDefectSMU:{},stateErrorByNetwork:!1}),getters:{Loading:e=>e.stateLoading,ApprovalData:e=>e.stateData,DefectKey:e=>e.stateDefectKey,DefectFormData:e=>e.stateDefectFormData,CrackFormData:e=>e.stateCrackFormData,ImagesDefect:()=>Vt().ImageObjects.find(t=>t.Id==="defect"),ImagesCrack:()=>Vt().ImageObjects.find(t=>t.Id==="crack"),IsError:e=>e.stateIsError,ErrorMessage:e=>e.stateErrorMessage,HeaderId:e=>e.stateHeaderId,DetailId:e=>e.stateDetailId,DataFetched:e=>e.stateDefectFetched,HeaderStatus:e=>e.stateHeaderStatus,HeaderPlannerStatus:e=>e.stateHeaderPlannerStatus,DefectPictures:e=>e.stateDefectPictures,LoadDefectImages:e=>e.stateLoadDefectImages,DeclineReason:e=>e.stateDeclineReason,DeclineBy:e=>e.stateDeclineBy,DeclineDate:e=>e.stateDeclineDate,ApprovedBy:e=>e.stateApprovedBy,ApprovedDate:e=>e.stateApprovedDate,Comments:e=>e.stateComments,ApproveBy:e=>e.stateApproveBy,ApproveDate:e=>e.stateApproveDate,DefectSMUHeader:e=>e.stateData.SMUDefectHeaders.find(t=>t.defectType=="machineSMU"),DefectSMUDetail:e=>e.stateDefectSMU,DefectSMUDetailDetail:e=>e.stateData.SMUDefectDetails.find(t=>t.defectHeaderId==e.stateDetailId),globalConnectionStore:()=>Ge()},actions:{setCurrentUserGroup(e){this.stateCurrentUserGroup=e},setHeaderId(e){this.stateHeaderId=e},setDefectFetched(e){this.stateDefectFetched=e},setDetailId(e){this.stateDetailId=e},createRequestBody(e){return{interventionId:e}},async getDefectsDataHeader(e){const t=this.createRequestBody(e),a=await g.post(`${ss}`,t);this.stateData.setHeaders(a.data.result.content)},async getDefectsDataDetail(e){const t=this.createRequestBody(e),a=await g.post(`${Rr}`,t);this.stateData.setDetails(a.data.result.content)},toggleErrorByNetwork(e){this.stateErrorByNetwork=e},async getDefectsDataAll(e){var a,s,r,n,i;const t={interventionId:e,ver:"v1"};try{const o=await g.get(`${Or}`,"",new URLSearchParams(t).toString());this.stateData.setHeaders(((a=o.data.result.content)==null?void 0:a.defectHeader)||[]),this.stateData.setDetails(((s=o.data.result.content)==null?void 0:s.defectDetail)||[]),this.stateComments=((r=o.data.result.content)==null?void 0:r.comment)||[],this.stateApproveBy=(n=o.data.result.content)==null?void 0:n.approveBy,this.stateApproveDate=(i=o.data.result.content)==null?void 0:i.approveDate}catch(o){const d=this.globalConnectionStore.checkIsErrorNoNetwork(o);this.stateErrorByNetwork=d,A("IRONS",o)}},async getDefectsData(e){this.stateLoading=!0;try{this.setDefectFetched(!1),await this.getDefectsDataAll(e),this.setDefectFetched(!0)}catch(t){Q(t),console.error(t)}this.stateLoading=!1},setDefectGenericData(e){const t=gt(),a=this.ApprovalData.DefectGenericHeaders.find(r=>r.id===e),s=this.ApprovalData.DefectGenericDetails.find(r=>r.defectHeaderId==e);if(s){this.setHeaderId(e),this.setDetailId(s.id),this.stateHeaderStatus=a==null?void 0:a.status,this.stateHeaderPlannerStatus=a==null?void 0:a.plannerStatus,this.stateDeclineReason=a==null?void 0:a.declineReason,this.stateDeclineDate=a==null?void 0:a.declineDate,this.stateDeclineBy=a==null?void 0:a.declineBy,this.stateApprovedBy=a==null?void 0:a.approvedBy,this.stateApprovedDate=a==null?void 0:a.approvedDate,s.detail.type!="NO"?(this.ImagesDefect.ImageInfos=[],this.stateDefectFormData.setAssetNumber(s.detail.assetNumber),this.stateDefectFormData.setDescription(s.detail.description),this.stateDefectFormData.setRaisedBy(s.detail.raisedBy),this.stateDefectFormData.setDate(s.detail.date),this.stateDefectFormData.setPlannedDuration(s.detail.plannedDuration),this.stateDefectFormData.setInstruction(s.detail.instruction),this.stateDefectFormData.setPriority(s.detail.priority),this.stateDefectFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateDefectFormData.importParts(...JSON.parse(s.detail.parts)),this.stateDefectFormData.importLabours(...JSON.parse(s.detail.labours)),this.stateDefectFormData.importResources(...JSON.parse(s.detail.resources)),this.stateDefectFormData.importSymptoms(...JSON.parse(s.detail.symptoms)),this.stateDefectFormData.importCauses(...JSON.parse(s.detail.causes)),this.ImagesDefect.ImageInfos.push(...JSON.parse(s.detail.images))):(this.ImagesDefect.ImageInfos=[],this.stateDefectNoFormData.setAssetNumber(s.detail.assetNumber),this.stateDefectNoFormData.setDescription(s.detail.description),this.stateDefectNoFormData.setRaisedBy(s.detail.raisedBy),this.stateDefectNoFormData.setDate(s.detail.date),this.stateDefectNoFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateDefectNoFormData.importActions(...JSON.parse(s.detail.actions)),this.ImagesDefect.ImageInfos.push(...JSON.parse(s.detail.images)));const r=[];return this.ImagesDefect.ImageInfos.forEach(n=>{r.push(t.downloadAttachment(n))}),Promise.all(r).then(n=>{n.forEach(i=>{const o=new Blob([i],{type:"image/png"});this.ImagesDefect.ImageBlobs.push(o)})}),s.detail.type}},setDefectData(e){const t=gt(),a=this.ApprovalData.DefectHeaders.find(r=>r.id===e),s=this.ApprovalData.DefectDetails.find(r=>r.defectHeaderId==e);if(s){this.setHeaderId(e),this.setDetailId(s.id),this.stateHeaderStatus=a==null?void 0:a.status,this.stateHeaderPlannerStatus=a==null?void 0:a.plannerStatus,this.stateDeclineReason=a==null?void 0:a.declineReason,this.stateDeclineDate=a==null?void 0:a.declineDate,this.stateDeclineBy=a==null?void 0:a.declineBy,this.stateApprovedBy=a==null?void 0:a.approvedBy,this.stateApprovedDate=a==null?void 0:a.approvedDate,s.detail.type!="NO"?(this.ImagesDefect.ImageInfos=[],this.stateDefectFormData.setAssetNumber(s.detail.assetNumber),this.stateDefectFormData.setDescription(s.detail.description),this.stateDefectFormData.setRaisedBy(s.detail.raisedBy),this.stateDefectFormData.setDate(s.detail.date),this.stateDefectFormData.setPlannedDuration(s.detail.plannedDuration),this.stateDefectFormData.setInstruction(s.detail.instruction),this.stateDefectFormData.setPriority(s.detail.priority),this.stateDefectFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateDefectFormData.importParts(...JSON.parse(s.detail.parts)),this.stateDefectFormData.importLabours(...JSON.parse(s.detail.labours)),this.stateDefectFormData.importResources(...JSON.parse(s.detail.resources)),this.stateDefectFormData.importSymptoms(...JSON.parse(s.detail.symptoms)),this.stateDefectFormData.importCauses(...JSON.parse(s.detail.causes)),this.ImagesDefect.ImageInfos.push(...JSON.parse(s.detail.images))):(this.ImagesDefect.ImageInfos=[],this.stateDefectNoFormData.setAssetNumber(s.detail.assetNumber),this.stateDefectNoFormData.setDescription(s.detail.description),this.stateDefectNoFormData.setRaisedBy(s.detail.raisedBy),this.stateDefectNoFormData.setDate(s.detail.date),this.stateDefectNoFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateDefectNoFormData.importActions(...JSON.parse(s.detail.actions)),this.ImagesDefect.ImageInfos.push(...JSON.parse(s.detail.images)));const r=[];return this.ImagesDefect.ImageInfos.forEach(n=>{let i="";typeof n=="string"?i=n:i=n.filename,r.push(t.downloadAttachment(i))}),Promise.all(r).then(n=>{n.forEach(i=>{const o=new Blob([i],{type:"image/png"});this.ImagesDefect.ImageBlobs.push(o)})}),s.detail.type}},setSMUDefectData(e){let t=!1;const a=gt(),s=this.ApprovalData.SMUDefectHeaders.find(n=>n.id===e),r=this.ApprovalData.SMUDefectDetails.find(n=>n.defectHeaderId==e);if(r){t=!0,this.setHeaderId(e),this.setDetailId(r.id),this.stateHeaderStatus=s==null?void 0:s.status,this.stateDefectSMU=r.detail;const n=[];this.ImagesDefect.ImageInfos.forEach(i=>{let o="";typeof i=="string"?o=i:o=i.filename,n.push(a.downloadAttachment(o))}),Promise.all(n).then(i=>{i.forEach(o=>{const d=new Blob([o],{type:"image/png"});this.ImagesDefect.ImageBlobs.push(d)})})}return t},getDefectData(e){const t=this.ApprovalData.DefectHeaders.find(s=>s.id===e),a=this.ApprovalData.DefectDetails.find(s=>s.defectHeaderId==e);return{header:t,detail:a}},getDefectGenericData(e){const t=this.ApprovalData.DefectGenericHeaders.find(s=>s.id===e),a=this.ApprovalData.DefectGenericDetails.find(s=>s.defectHeaderId==e);return{header:t,detail:a}},async updateDownloadHistory(e,t=!1){let a;t?a=this.ApprovalData.DefectGenericHeaders.find(n=>n.id===e):a=this.ApprovalData.DefectHeaders.find(n=>n.id===e);const s=ae();if(!a)return;const r={id:a.id,updateParams:[{keyValue:a.key,propertyParams:[{propertyName:"downloadHistory",propertyValue:!0},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:xe()}]}],employee:{id:s.user.EmployeeId,name:s.user.Name}};try{this.stateIsError=!1,await g.post(`${Pe}`,r),a.downloadHistory?a.downloadHistory.push({downloadBy:{id:s.user.EmployeeId,name:s.user.Name}}):a.downloadHistory=[{downloadBy:{id:s.user.EmployeeId,name:s.user.Name}}]}catch(n){Q(n),A("IRONS",n),console.log(n),this.stateIsError=!0}},async getDefectImages(e,t,a){const s={id:e,keyValue:t,propertyName:a},r={ver:"v1"};let n=[];const i=await g.post(`${Vr}?${new URLSearchParams(r).toString()}`,s);return C.isUndefined(i.data.result.content)||(n=i.data.result.content),n},setLoadingImages(e){this.stateLoadDefectImages=e},setNewDefectKey(){this.stateDefectKey+=1},async getDefectPictures(e){const t=this.ApprovalData.DefectDetails.find(a=>a.defectHeaderId==e);t&&(this.stateDefectPictures[e]=JSON.parse(t.detail.images))},getCrackPictures(e){const t=this.ApprovalData.CrackDetails.find(a=>a.defectHeaderId==e);t&&(this.stateDefectPictures[e]=JSON.parse(t.detail.images))},setDefectNewData(){var a;const e=this.ApprovalData.DefectDetails.find(s=>s.id===this.stateDetailId);e&&(e.detail.description=this.DefectFormData.Description.value,e.detail.plannedDuration=this.DefectFormData.PlannedDuration.value,e.detail.instruction=this.DefectFormData.Instruction.value,e.detail.priority=this.DefectFormData.Priority,e.detail.parts=JSON.stringify(this.DefectFormData.Parts),e.detail.labours=JSON.stringify(this.DefectFormData.Labours),e.detail.resources=JSON.stringify(this.DefectFormData.Resources.map(s=>s.value)),e.detail.symptoms=JSON.stringify(this.DefectFormData.Symptoms.map(s=>s.value)),e.detail.causes=JSON.stringify(this.DefectFormData.Causes.map(s=>s.value)),e.detail.images=JSON.stringify(((a=this.ImagesDefect)==null?void 0:a.ImageInfos)??[]));const t=this.ApprovalData.DefectHeaders.find(s=>s.id===this.stateHeaderId);t&&(t.status="Acknowledge")},createDefectDetail(){var t;const e=((t=this.ImagesDefect)==null?void 0:t.ImageInfos)??[];return{type:"YES",assetNumber:this.DefectFormData.AssetNumber,description:this.DefectFormData.Description.value,raisedBy:this.DefectFormData.RaisedBy,date:this.DefectFormData.Date,plannedDuration:this.DefectFormData.PlannedDuration.value,instruction:this.DefectFormData.Instruction.value,priority:this.DefectFormData.Priority,parts:JSON.stringify(this.DefectFormData.Parts),labours:JSON.stringify(this.DefectFormData.Labours),resources:JSON.stringify(this.DefectFormData.Resources.map(a=>a.value)),symptoms:JSON.stringify(this.DefectFormData.Symptoms.map(a=>a.value)),causes:JSON.stringify(this.DefectFormData.Causes.map(a=>a.value)),images:JSON.stringify(e),title:this.DefectFormData.Title}},async updateDefectDetail(e){var n,i,o;const t=ae();let a;e?a=this.ApprovalData.DefectGenericDetails.find(d=>d.id===this.stateDetailId):a=this.ApprovalData.DefectDetails.find(d=>d.id===this.stateDetailId);const s=this.createDefectDetail(),r={id:this.DetailId,updateParams:[{keyValue:a.key,propertyParams:[{propertyName:"detail",propertyValue:JSON.stringify(s)},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:t.user.EmployeeId,name:t.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:t.user.EmployeeId,name:t.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1;const d=await g.post(`${Wt}`,r);return d.data.statusError==400||d.data.result.isError?(this.stateIsError=!0,d.data.result.message):""}catch(d){Q(d),console.log(d),this.stateIsError=!0,Ae().toggleTaskAlreadyUpdatedStatus(!0);const p=Ee(((o=(i=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:i.result)==null?void 0:o.message)??`${d}`);return A("IRONS",d),p}},async updateDefectDecline(e,t=!1,a=!1){var i,o,d;const s=ae();let r;a?r=this.ApprovalData.DefectGenericHeaders.find(c=>c.id===this.stateHeaderId):r=this.ApprovalData.DefectHeaders.find(c=>c.id===this.stateHeaderId);const n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:t?"plannerStatus":"status",propertyValue:"Decline"},{propertyName:"declineReason",propertyValue:e},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:xe()},{propertyName:"declineBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"declineDate",propertyValue:xe()}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,n),t?r.plannerStatus="Decline":r.status="Decline",r.declineReason=e,r.declineBy={id:s.user.EmployeeId,name:s.user.Name},r.declineDate=xe()}catch(c){Q(c),console.log(c),this.stateIsError=!0,this.stateErrorMessage=Ee(((d=(o=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:o.result)==null?void 0:d.message)??`${c}`),A("IRONS",c)}},async updateDefectAcknowledge(e=!1,t=!1,a=!1,s=""){var o,d,c;const r=ae();let n;t?n=this.ApprovalData.DefectGenericHeaders.find(p=>p.id===this.stateHeaderId):a?n=this.ApprovalData.SMUDefectHeaders.find(p=>p.id===this.stateHeaderId):n=this.ApprovalData.DefectHeaders.find(p=>p.id===this.stateHeaderId);const i={id:n.id,updateParams:[{keyValue:n.key,propertyParams:[{propertyName:e?"plannerStatus":"status",propertyValue:"Acknowledge"},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:r.user.EmployeeId,name:r.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:r.user.EmployeeId,name:r.user.Name},userGroup:this.stateCurrentUserGroup};s&&i.updateParams[0].propertyParams.push({propertyName:"taskDesc",propertyValue:s}),e||(i.updateParams[0].propertyParams=[...i.updateParams[0].propertyParams,{propertyName:"approvedBy",propertyValue:JSON.stringify({id:r.user.EmployeeId,name:r.user.Name})},{propertyName:"approvedDate",propertyValue:"<<ServerDateTime>>"}]);try{this.stateIsError=!1,await g.post(`${Pe}`,i),e?n.plannerStatus="Acknowledge":n.status="Acknowledge"}catch(p){Q(p),console.log(p),this.stateIsError=!0,this.stateErrorMessage=Ee(((c=(d=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:d.result)==null?void 0:c.message)??`${p}`),A("IRONS",p)}},async updateDefectMO(e,t,a=!1){var i,o,d;const s=ae();let r;a?r=this.ApprovalData.DefectGenericHeaders.find(c=>c.id===e):r=this.ApprovalData.DefectHeaders.find(c=>c.id===e);const n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:"defectWorkorder",propertyValue:t},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,n),r.defectWorkorder=t}catch(c){Q(c),console.log(c),this.stateIsError=!0,this.stateErrorMessage=Ee(((d=(o=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:o.result)==null?void 0:d.message)??`${c}`),A("IRONS",c)}},async updateDefectDetailSMU(e={},t="",a=!1){var o,d,c;const s=ae();let r=this.stateDefectSMU;C.isEmpty(e)||(r=e);let n=this.DetailId;t!=""&&(n=t);const i={id:n,updateParams:[{keyValue:n,propertyParams:[{propertyName:"detail",propertyValue:JSON.stringify(r)},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup===""?s.user.Position:this.stateCurrentUserGroup};a&&(i.isEdit="true");try{this.stateIsError=!1,await g.post(`${Wt}`,i)}catch(p){Q(p),console.log(p),this.stateIsError=!0,this.stateErrorMessage=Ee(((c=(d=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:d.result)==null?void 0:c.message)??`${p}`),A("IRONS",p)}},async updateDefectHeaderSMU(e){const{isInRange:t,headerId:a,headerKey:s,isEdit:r}=e,n=ae(),i={id:a,updateParams:[{keyValue:s,propertyParams:[{propertyName:"taskDesc",propertyValue:Dt.MACHINESMUTITLE()},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:n.user.EmployeeId,name:n.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:n.user.EmployeeId,name:n.user.Name},userGroup:this.stateCurrentUserGroup===""?n.user.Position:this.stateCurrentUserGroup};r&&(i.isEdit="true");try{this.stateIsError=!1,await g.post(`${Pe}`,i)}catch(o){Q(o),console.log(o),A("IRONS",o)}},async updateRepairedStatus(e,t,a=!1){const s=ae();let r;a?r=this.ApprovalData.DefectGenericHeaders.find(i=>i.id===e):r=this.ApprovalData.DefectHeaders.find(i=>i.id===e);const n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:"repairedStatus",propertyValue:t},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,n),r.repairedStatus=t}catch(i){Q(i),console.log(i),this.stateIsError=!0,A("IRONS",i)}},async updateDefectConfirmedStatus(e,t=!1,a=""){var i,o,d;const s=ae(),r=this.ApprovalData.DefectNAHeaders.find(c=>c.id===e),n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:t?"plannerCbmNAStatus":"cbmNAStatus",propertyValue:"Confirmed"},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup};t||(n.updateParams[0].propertyParams=[...n.updateParams[0].propertyParams,{propertyName:"approvedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"approvedDate",propertyValue:"<<ServerDateTime>>"}]),t||n.updateParams[0].propertyParams.push({propertyName:"approveReason",propertyValue:a});try{this.stateIsError=!1,await g.post(`${Pe}`,n),t?r.plannerCbmNAStatus="Confirmed":r.cbmNAStatus="Confirmed"}catch(c){Q(c),console.log(c),this.stateIsError=!0,this.stateErrorMessage=Ee(((d=(o=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:o.result)==null?void 0:d.message)??`${c}`),A("IRONS",c)}},async updateDefectDeclineStatus(e,t=!1,a){var i,o,d;const s=ae(),r=this.ApprovalData.DefectNAHeaders.find(c=>c.id===e),n={id:r.id,updateParams:[{keyValue:r.key,propertyParams:[{propertyName:t?"plannerCbmNAStatus":"cbmNAStatus",propertyValue:"Decline"},{propertyName:"declineReason",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"},{propertyName:"declineBy",propertyValue:JSON.stringify({id:s.user.EmployeeId,name:s.user.Name})},{propertyName:"declineDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:s.user.EmployeeId,name:s.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,n),t?r.plannerCbmNAStatus="Decline":r.cbmNAStatus="Decline"}catch(c){Q(c),console.log(c),this.stateIsError=!0,this.stateErrorMessage=Ee(((d=(o=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:o.result)==null?void 0:d.message)??`${c}`),A("IRONS",c)}},async updateCrackConfirmedStatus(e){var r,n,i;const t=ae(),a=this.ApprovalData.CrackNAHeaders.find(o=>o.id===e),s={id:a.id,updateParams:[{keyValue:a.key,propertyParams:[{propertyName:"cbmNAStatus",propertyValue:"Confirmed"},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:t.user.EmployeeId,name:t.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:t.user.EmployeeId,name:t.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,s),a.cbmNAStatus="Confirmed"}catch(o){Q(o),console.log(o),this.stateIsError=!0,this.stateErrorMessage=Ee(((i=(n=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:n.result)==null?void 0:i.message)??`${o}`),A("IRONS",o)}},async updateCBMConfirmedStatus(e,t=!1,a){var d,c,p;const s=t?"appPlannerBy":"appSPVBy",r=t?"appPlannerDate":"appSPVDate",n=ae(),i=this.ApprovalData.CBMHeaders.find(f=>f.id===e),o={id:i.id,updateParams:[{keyValue:i.key,propertyParams:[{propertyName:t?"plannerCbmNAStatus":"cbmNAStatus",propertyValue:"Confirmed"},{propertyName:t?"plannerApproveReason":"approveReason",propertyValue:a},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:n.user.EmployeeId,name:n.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"},{propertyName:s,propertyValue:JSON.stringify({id:n.user.EmployeeId,name:n.user.Name})},{propertyName:r,propertyValue:"<<ServerDateTime>>"}]}],employee:{id:n.user.EmployeeId,name:n.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,o),t?i.plannerCbmNAStatus="Confirmed":i.cbmNAStatus="Confirmed"}catch(f){Q(f),console.log(f),this.stateIsError=!0,this.stateErrorMessage=Ee(((p=(c=(d=f==null?void 0:f.response)==null?void 0:d.data)==null?void 0:c.result)==null?void 0:p.message)??`${f}`),A("IRONS",f)}},setCrackData(e){const t=gt(),a=this.ApprovalData.CrackHeaders.find(r=>r.id===e),s=this.ApprovalData.CrackDetails.find(r=>r.defectHeaderId==e);if(s){this.setHeaderId(e),this.setDetailId(s.id),this.stateHeaderStatus=a==null?void 0:a.status,s.detail.type!="NO"?(this.stateCrackFormData.setAssetNumber(s.detail.assetNumber),this.stateCrackFormData.setDescription(s.detail.description),this.stateCrackFormData.setRaisedBy(s.detail.raisedBy),this.stateCrackFormData.setDate(s.detail.date),this.stateCrackFormData.setPlannedDuration(s.detail.plannedDuration),this.stateCrackFormData.setInstruction(s.detail.instruction),this.stateCrackFormData.setPriority(s.detail.priority),this.stateCrackFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateCrackFormData.importParts(...JSON.parse(s.detail.parts)),this.stateCrackFormData.importLabours(...JSON.parse(s.detail.labours)),this.stateCrackFormData.importResources(...JSON.parse(s.detail.resources)),this.stateCrackFormData.importSymptoms(...JSON.parse(s.detail.symptoms)),this.stateCrackFormData.importCauses(...JSON.parse(s.detail.causes)),this.stateCrackFormData.importPreviousCrack(...JSON.parse(s.detail.previousCracks))):(this.stateCrackSimpleFormData.setAssetNumber(s.detail.assetNumber),this.stateCrackSimpleFormData.setDescription(s.detail.description),this.stateCrackSimpleFormData.setRaisedBy(s.detail.raisedBy),this.stateCrackSimpleFormData.setDate(s.detail.date),this.stateCrackSimpleFormData.setInstruction(s.detail.instruction),this.stateCrackSimpleFormData.setTitle((a==null?void 0:a.taskDesc)||""),this.stateCrackSimpleFormData.importPreviousCrack(...JSON.parse(s.detail.previousCracks))),this.ImagesCrack.ImageInfos.push(...JSON.parse(s.detail.images));const r=[];return this.ImagesCrack.ImageInfos.forEach(n=>{let i="";typeof n=="string"?i=n:i=n.filename,r.push(t.downloadAttachment(i))}),Promise.all(r).then(n=>{n.forEach(i=>{const o=new Blob([i],{type:"image/png"});this.ImagesCrack.ImageBlobs.push(o)})}),s.detail.type}},setCrackNewData(){const e=this.ApprovalData.CrackDetails.find(t=>t.id===this.stateDetailId);e&&(e.detail.description=this.CrackFormData.Description.value,e.detail.plannedDuration=this.CrackFormData.PlannedDuration.value,e.detail.instruction=this.CrackFormData.Instruction.value,e.detail.priority=this.CrackFormData.Priority,e.detail.parts=JSON.stringify(this.CrackFormData.Parts),e.detail.labours=JSON.stringify(this.CrackFormData.Labours),e.detail.resources=JSON.stringify(this.CrackFormData.Resources.map(t=>t.value)),e.detail.symptoms=JSON.stringify(this.CrackFormData.Symptoms.map(t=>t.value)),e.detail.causes=JSON.stringify(this.CrackFormData.Causes.map(t=>t.value)),e.detail.previousCracks=JSON.stringify(this.CrackFormData.CrackLength))},createCrackDetail(){var t;const e=((t=this.ImagesCrack)==null?void 0:t.ImageInfos)??[];return{type:"YES",assetNumber:this.CrackFormData.AssetNumber,description:this.CrackFormData.Description.value,raisedBy:this.CrackFormData.RaisedBy,date:this.CrackFormData.Date,plannedDuration:this.CrackFormData.PlannedDuration.value,instruction:this.CrackFormData.Instruction.value,priority:this.CrackFormData.Priority,parts:JSON.stringify(this.CrackFormData.Parts),labours:JSON.stringify(this.CrackFormData.Labours),resources:JSON.stringify(this.CrackFormData.Resources.map(a=>a.value)),symptoms:JSON.stringify(this.CrackFormData.Symptoms.map(a=>a.value)),causes:JSON.stringify(this.CrackFormData.Causes.map(a=>a.value)),images:JSON.stringify(e),previousCracks:JSON.stringify(this.CrackFormData.CrackLength)}},async updateCrackDetail(){var r,n,i;const e=ae(),t=this.ApprovalData.CrackDetails.find(o=>o.id===this.stateDetailId),a=this.createCrackDetail(),s={id:this.DetailId,updateParams:[{keyValue:t.key,propertyParams:[{propertyName:"detail",propertyValue:JSON.stringify(a)},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:e.user.EmployeeId,name:e.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:e.user.EmployeeId,name:e.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Wt}`,s)}catch(o){Q(o),console.log(o),this.stateIsError=!0,this.stateErrorMessage=Ee(((i=(n=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:n.result)==null?void 0:i.message)??`${o}`),A("IRONS",o)}},async updateCrackAcknowledge(){var s,r,n;const e=ae(),t=this.ApprovalData.CrackHeaders.find(i=>i.id===this.stateHeaderId),a={id:t.id,updateParams:[{keyValue:t.key,propertyParams:[{propertyName:"status",propertyValue:"Acknowledge"},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:e.user.EmployeeId,name:e.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:e.user.EmployeeId,name:e.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,a),t.status="Acknowledge"}catch(i){Q(i),console.log(i),this.stateIsError=!0,this.stateErrorMessage=Ee(((n=(r=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:r.result)==null?void 0:n.message)??`${i}`),A("IRONS",i)}},async updateCrackMO(e,t){var n,i,o;const a=ae(),s=this.ApprovalData.CrackHeaders.find(d=>d.id===e),r={id:s.id,updateParams:[{keyValue:s.key,propertyParams:[{propertyName:"defectWorkorder",propertyValue:t},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:a.user.EmployeeId,name:a.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:a.user.EmployeeId,name:a.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,r),s.defectWorkorder=t}catch(d){Q(d),console.log(d),this.stateIsError=!0,this.stateErrorMessage=Ee(((o=(i=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:i.result)==null?void 0:o.message)??`${d}`),A("IRONS",d)}},async updateCrackRepairedStatus(e){const t=ae(),a=this.ApprovalData.CrackHeaders.find(r=>r.id===e),s={id:a.id,updateParams:[{keyValue:a.key,propertyParams:[{propertyName:"repairedStatus",propertyValue:"Repaired"},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:t.user.EmployeeId,name:t.user.Name})},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:{id:t.user.EmployeeId,name:t.user.Name},userGroup:this.stateCurrentUserGroup};try{this.stateIsError=!1,await g.post(`${Pe}`,s),a.repairedStatus="Repaired"}catch(r){Q(r),console.log(r),this.stateIsError=!0,A("IRONS",r)}},updateHeaderDefectSMU(e){const t=this.ApprovalData.SMUDefectHeaders.find(a=>a.id===e);this.stateHeaderStatus=C.isUndefined(t.plannerStatus)?"":t.plannerStatus},reset(){this.stateLoading=!1,this.stateData=new Na,this.stateDefectFormData=new ze,this.stateCrackFormData=new Ca,this.stateIsError=!1,this.stateHeaderId="",this.stateDetailId="",this.stateDefectFetched=!1,this.stateHeaderStatus="",this.stateHeaderPlannerStatus="",this.stateDeclineReason="",this.stateDeclineDate="",this.stateDeclineBy={},this.stateApprovedDate="",this.stateApprovedBy={},this.stateLoadDefectImages=!1,this.stateDefectKey=1},resetErrorStatus(){this.stateIsError=!1,this.stateErrorMessage=""}}});class $r{constructor(t=1,a=10,s=0,r=-1,n=0){this.getPaginationStartIndex=()=>{this.startPaginationIndex=(this.currentPage-1)*this.totalPageSize},this.getPaginationLastIndex=()=>{const i=this.startPaginationIndex+this.totalPageSize>=this.totalPage?void 0:this.startPaginationIndex+this.totalPageSize;this.endPaginationIndex=i||this.totalPage},this.handleCurrentPageChange=i=>{this.currentPage=i,this.getPaginationStartIndex(),this.getPaginationLastIndex()},this.getPaginationStartIndexFromBE=()=>{this.currentPage>1?this.startPaginationIndex=this.totalPageSize*(this.currentPage-1):this.currentPage==1&&(this.startPaginationIndex=0)},this.getPaginationLastIndexFromBE=()=>{this.currentPage==1&&this.currentPage*this.totalPageSize<=this.totalPage?this.endPaginationIndex=this.totalPageSize:this.currentPage*this.totalPageSize>this.totalPage?this.endPaginationIndex=this.totalPage:this.currentPage>1&&(this.endPaginationIndex=this.currentPage*this.totalPageSize)},this.handleCurrentPageChangeFromBE=i=>{this.currentPage=i,this.getPaginationStartIndexFromBE(),this.getPaginationLastIndexFromBE()},this.currentPage=t,this.totalPageSize=a,this.totalPage=s,this.startPaginationIndex=r,this.endPaginationIndex=n}}const Ur=Je(),xr={keyPbi:""},jt={additionalTaskId:0,sequence:0,recAction:"",executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",taskKey:"",isActive:!0,isDeleted:!1,psType:"",interventionIdCosmos:"",images:[],typeTaskId:0,uom:"",typeTask:"",componentId:"",listComponent:[]},Ra={equipmentId:"",equipmentNumber:"",interventionCode:"",workOrder:"",model:"",modelId:"",brand:"",status:"",intervention:"",keyPbi:"",interventionDate:"",componentGroup:""},Ve=Ne({id:"interventionList",state:()=>({stateFilter:{...xr},stateComponentList:[],stateReRenderSelection:!1,stateRerenderComponentList:!1,stateInterventionCheckList:[],stateAdditionalTaskList:[],stateDeletedAdditionalTaskList:[],stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateComponentListLoading:!1,stateHeader:[{label:"Pending Evaluation",total:0,value:"Pending Evaluation"},{label:"Submitted",total:0,value:"Submitted"},{label:"Yet to Start",total:0,value:"Yet to Start"},{label:"In Progress",total:0,value:"In Progress"},{label:"Under Review",total:0,value:"Under Review"},{label:"Final Review",total:0,value:"Final Review"},{label:"Closed",total:0,value:"Close"},{label:"Declined",total:0,value:"Declined"}],stateSelectedHeader:"Pending Evaluation",stateSelectedHeaderItem:{...Ra},stateHeaderListItems:[],stateLoadingHeader:!1,stateIsSelectedItem:!1,statePaginationLoading:!1,statePagination:new $r(1,3),stateSearchOptions:[],stateTypeTaskOptions:[],stateFormAdditionalTask:{...jt},stateConditionOptions:[],stateLoadingConditionOptions:!1,stateUomOptions:[],stateComponentFromEquipment:""}),getters:{componentList:e=>e.stateComponentList,reRenderSelection:e=>e.stateReRenderSelection,reRenderComponentList:e=>e.stateRerenderComponentList,interventionCheckList:e=>e.stateInterventionCheckList,additionalTaskList:e=>e.stateAdditionalTaskList,deletedAdditionalTaskList:e=>e.stateDeletedAdditionalTaskList,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,componentListLoading:e=>e.stateComponentListLoading,headerList:e=>e.stateHeader,selectedHeader:e=>e.stateSelectedHeader,selectedHeaderItem:e=>e.stateSelectedHeaderItem,isSelectedItem:e=>e.stateIsSelectedItem,headerListItems:e=>e.stateHeaderListItems,pagination:e=>e.statePagination,loadingHeader:e=>e.stateLoadingHeader,paginationLoading:e=>e.statePaginationLoading,searchOption:e=>e.stateSearchOptions,typeTaskOptions:e=>e.stateTypeTaskOptions,formDataAdditional:e=>e.stateFormAdditionalTask,conditionOptions:e=>e.stateConditionOptions,loadingConditionOptions:e=>e.stateLoadingConditionOptions,uomOptions:e=>e.stateUomOptions},actions:{getImageProperty(e){var t,a;return(t=e==null?void 0:e.adjustment)!=null&&t.images?(a=e==null?void 0:e.adjustment)==null?void 0:a.images:e},setComponentFromEquipment(e){this.stateComponentFromEquipment=e},async getComponentList(e=!1){const t={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateRerenderComponentList=!1,this.stateComponentListLoading=!0;const a=await g.get(br,"",new URLSearchParams(t).toString());if(this.stateComponentList=a.data.result.content,this.stateComponentFromEquipment&&e){const s=a.data.result.content.filter(r=>r.componentDescription==this.stateComponentFromEquipment);this.updateComponentAffected(s)}}catch(a){a.response.data.statusCode==401&&ae().setLoggedIn(!1),A("IRONS",a),console.log(a)}finally{this.stateComponentListLoading=!1,this.stateRerenderComponentList=!0}},setReRenderComponentList(e){this.stateRerenderComponentList=e},setReRenderSelection(e){this.stateReRenderSelection=e},async getInterventionCheckList(){var a;const e=_e(),t={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateReRenderSelection=!1,this.stateLoading=!0;const s=await g.get(Sr,"",new URLSearchParams(t).toString());((a=s.data.result.content)==null?void 0:a.length)>0&&(this.stateInterventionCheckList=[...s.data.result.content],e.isCannotReviseOrSubmit&&(this.stateInterventionCheckList=this.stateInterventionCheckList.filter(r=>r.isMandatory||r.isMandatory==null)))}catch(s){s.response.data.statusCode==401&&ae().setLoggedIn(!1),A("IRONS",s),console.log(s)}finally{this.stateReRenderSelection=!0,this.stateLoading=!1}},getInterventionChecksImage(){Promise.all(this.stateInterventionCheckList.map(async(e,t)=>{const a=await Ur.getDefectImages(e.interventionIdCosmos,e.taskKey,"images");return{...e,images:this.getImageProperty(a)??[]}})).then(e=>{console.log("VALUES",e),this.stateReRenderSelection=!1,this.stateInterventionCheckList=[...e],this.stateReRenderSelection=!0}).catch(e=>{console.log(e)})},async getAdditionalTaskList(){var t;const e={keyPbi:this.stateFilter.keyPbi,ver:"v1"};try{this.stateLoading=!0;const a=Je(),s=await g.get(Ir,"",new URLSearchParams(e).toString());this.stateAdditionalTaskList=s.data.result.content,((t=this.stateAdditionalTaskList)==null?void 0:t.length)>0&&(this.stateAdditionalTaskList=await Promise.all(this.stateAdditionalTaskList.map(async(r,n)=>{const i=await a.getDefectImages(r.interventionIdCosmos,r.taskKey,"images");return{...r,images:this.getImageProperty(i)??[]}})))}catch(a){a.response.data.statusCode==401&&ae().setLoggedIn(!1),A("IRONS",a),console.log(a)}finally{this.stateLoading=!1}},setAdditionalForm(e){this.stateFormAdditionalTask=e},addAdditionalForm(){this.stateFormAdditionalTask.sequence=this.stateAdditionalTaskList.length+1},insertAdditionalTask(e){this.stateAdditionalTaskList.push({additionalTaskId:0,sequence:this.stateAdditionalTaskList.length+1,recAction:e.recAction,executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",taskKey:"",isActive:!0,isDeleted:!1,psType:"",interventionIdCosmos:"",images:[],typeTaskId:e.typeTaskId,uom:e.typeTaskId==3||e.typeTaskId==10?e.uom:"",typeTask:"",componentId:"",listComponent:[...e.listComponent]})},updateAdditionalTask(e,t){const a=this.stateAdditionalTaskList.findIndex(s=>s.sequence==e.sequence);t.recAction=t.recAction.trim(),t.uom=t.typeTaskId==3||t.typeTaskId==10?t.uom:"",this.stateAdditionalTaskList[a]={...t}},deleteAdditionalTask(e){const t=this.stateAdditionalTaskList.findIndex(a=>a.sequence==e.sequence);e.additionalTaskId!==0&&(this.stateAdditionalTaskList[t].isDeleted=!0,this.stateDeletedAdditionalTaskList.push(this.stateAdditionalTaskList[t])),this.stateAdditionalTaskList.splice(t,1),this.stateAdditionalTaskList.forEach((a,s)=>{a.sequence=s+1})},checkIsAdditionalTaskDuplicate(e){return this.stateAdditionalTaskList.filter(a=>{if(e.uom){if(a.recAction.trim().toLowerCase()===e.recAction.trim().toLowerCase()&&a.typeTaskId===e.typeTaskId&&a.uom===e.uom)return a}else if(a.recAction.trim().toLowerCase()===e.recAction.trim().toLowerCase()&&a.typeTaskId===e.typeTaskId)return a}).length>=2},checkAnyEmptyAdditionalTask(){return this.stateAdditionalTaskList.find(e=>{if(!e.recAction||e.recAction=="")return e})},setFilter(e){this.stateFilter.keyPbi=e.keyPbi||""},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},resetFormAdditionalTask(){this.stateFormAdditionalTask={...jt}},resetFewList(){this.stateInterventionCheckList=[],this.stateAdditionalTaskList=[],this.stateDeletedAdditionalTaskList=[],this.stateComponentList=[]},resetAllList(){this.stateInterventionCheckList=[],this.stateAdditionalTaskList=[],this.stateDeletedAdditionalTaskList=[],this.stateComponentList=[],this.stateComponentFromEquipment="",this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateFormAdditionalTask={...jt},this.stateSelectedHeaderItem={...Ra},this.stateIsSelectedItem=!1},async updateInterventionCheckListMandatory(e){this.stateInterventionCheckList.forEach(t=>{e.findIndex(s=>s.recAction==t.recAction)!=-1?t.isMandatory=!0:t.isMandatory=!1})},async updateComponentAffected(e){const t=_e();let a=[];const s=[];if(this.stateComponentList.forEach(r=>{e.find(i=>i.componentId==r.componentId)?(r.isCheck=!0,r.interventionReason.forEach(i=>{a.push(i)}),r.interventionChecks.forEach(i=>{i.interventionDetailId&&!s.includes(i.interventionDetailId)?s.push(i.interventionDetailId):i.interventionDetailSourceId&&!s.includes(i.interventionDetailSourceId)&&s.push(i.interventionDetailSourceId)})):(r.isCheck=!1,r.interventionReason.forEach(i=>{a=a.filter(o=>i!=o)}))}),a=a.sort((r,n)=>{const i=r.includes("CRITICAL")||r.includes("CAUTION"),o=n.includes("CRITICAL")||n.includes("CAUTION"),d=!r.includes("CRITICAL")&&!r.includes("CAUTION"),c=!n.includes("CRITICAL")&&!n.includes("CAUTION");return i&&o?r.includes("CRITICAL")&&n.includes("CRITICAL")||r.includes("CAUTION")&&n.includes("CAUTION")?0:r.includes("CRITICAL")&&n.includes("CAUTION")?-1:1:d&&o?1:i&&c?-1:0}),t.updateInterventionReason(a.join("<br> ")),s.length==0){this.stateInterventionCheckList.forEach(r=>{r.isActive=!1});return}this.stateInterventionCheckList.forEach(r=>{s.findIndex(i=>r.interventionDetailId?i==r.interventionDetailId:r.interventionDetailSourceId?i==r.interventionDetailSourceId:!1)>-1?(r.isActive=!0,r.isMandatory=!0):r.isActive=!1})},setTotalPage(e){this.pagination.totalPage=e,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(e){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(e),this.stateSelectedHeader==="Declined"?await this.setHeaderDeclined(this.stateSelectedHeader,e):await this.setHeaderChange(this.stateSelectedHeader,e),setTimeout(()=>{this.statePaginationLoading=!1},20)},async setHeaderChange(e,t=1){const a=ae();await this.getTotalHeader(),this.stateSelectedHeader=e;const s={site:a.user.SiteId,status:e,ver:"v1",page:t.toString(),pageSize:"3"};try{this.stateLoadingHeader=!0;const r=await g.get(wa,"",new URLSearchParams(s).toString());this.stateHeaderListItems=r.data.result.content,this.setTotalPage(r.data.result.total)}catch(r){r.response.data.statusCode==401&&a.setLoggedIn(!1),A("IRONS",r),console.log(r)}finally{this.stateLoadingHeader=!1}},async searchItems(e){const t=ae(),a={site:t.user.SiteId,status:this.stateSelectedHeader,parameter:e,ver:"v1"};try{const s=this.stateSelectedHeader==="Declined"?_a:wa,r=await g.get(s,"",new URLSearchParams(a).toString());this.stateSearchOptions=r.data.result.content}catch(s){s.response.data.statusCode==401&&t.setLoggedIn(!1),A("IRONS",s),console.log(s)}},async getTotalHeader(){const e=ae(),t={site:e.user.SiteId,ver:"v1"};try{const a=await g.get(Nr,"",new URLSearchParams(t).toString());this.stateHeader[0].total=a.data.result.content.totalPendingEvaluation,this.stateHeader[1].total=a.data.result.content.totalSubmitted,this.stateHeader[2].total=a.data.result.content.totalYetToStart,this.stateHeader[3].total=a.data.result.content.totalInProgress,this.stateHeader[4].total=a.data.result.content.totalUnderReview,this.stateHeader[5].total=a.data.result.content.totalFinalReview,this.stateHeader[6].total=a.data.result.content.totalClosed}catch(a){A("IRONS",a),console.log(a),a.response.data.statusCode==401&&e.setLoggedIn(!1)}},async setSelectedHeader(e){this.stateSelectedHeader=e},async setSelectedHeaderItem(e){this.stateSelectedHeaderItem=e},setIsSelectedItem(e){this.stateIsSelectedItem=e},async getLookupTypeTask(){const e={ver:"v1"};try{const t=await g.get(Cr,"",new URLSearchParams(e).toString());this.stateTypeTaskOptions=Zt(t.data.result.content,"typeTaskId","typeTask",!1)}catch(t){A("IRONS",t),t.response.data.statusCode==401&&ae().setLoggedIn(!1),console.log(t)}},async getLookupConditionOption(e){const t={typeTaskId:e,ver:"v1"};try{this.stateLoadingConditionOptions=!0;const a=await g.get(Pr,"",new URLSearchParams(t).toString());this.stateConditionOptions=Zt(a.data.result.content,"typeCondition","typeCondition",!1)}catch(a){A("IRONS",a),a.response.data.statusCode==401&&ae().setLoggedIn(!1),console.log(a)}finally{this.stateLoadingConditionOptions=!1}},async getLookupUom(){const e={ver:"v1"};try{const t=await g.get(Tr,"",new URLSearchParams(e).toString());this.stateUomOptions=vt(t.data.result.content.uom)}catch(t){t.response.data.statusCode==401&&ae().setLoggedIn(!1),A("IRONS",t),console.log(t)}},async setHeaderDeclined(e="Declined",t=1,a=!1){const s=ae();await this.getTotalHeader();const r={site:s.user.SiteId,status:e,ver:"v1",page:t.toString(),pageSize:"3"};try{this.stateLoadingHeader=!0;const n=await g.get(_a,"",new URLSearchParams(r).toString());a||(this.stateHeaderListItems=n.data.result.content,this.setTotalPage(n.data.result.total)),this.stateHeader[7].total=n.data.result.total}catch(n){n.response.data.statusCode==401&&s.setLoggedIn(!1),A("IRONS",n),console.log(n)}finally{this.stateLoadingHeader=!1}},mapHeaderFromExecutionIdAndDefectId(e,t){let a="Pending Evaluation";const s=r=>{switch(r){case 1:a="Final Review";break;default:a="Closed";break}};switch(e){case 2:a="Submitted";break;case 3:a="Submitted";break;case 4:a="Yet to Start";break;case 5:a="In Progress";break;case 6:a="Under Review";break;case 7:a="Approved";break;case 8:a="Final Review";break;case 9:s(t);break;default:a="Pending Evaluation";break}return a}}}),qr={keyPbi:""},Va={interventionHeaderId:0,interventionHeaderSourceId:0,site:"",equipmentModel:"",equipmentNumberId:0,equipmentNumber:"",componentDescription:"",componentHours:"",interventionReason:"",conditionRatingSmu:"",conditionRatingDate:"",interventionCodeId:"",interventionStatus:"",interventionDiagnostic:"",followUp:"",uomId:"",followUpPriority:"",estimationCompletionDate:"",workOrder:"",additionalInformation:"",interventionExecutionId:0,userRevise:!0,componentId:0,interventionCosmosId:"",component:"",keyPbi:"",declineReason:"",frameHours:"",hmOffset:"",genericDefect:!1,canEditComponent:!1,showConditionRatingDate:"",isParameterUpdate:!1,defectStatusId:null,interventionExecutionBy:null,executionDateTime:null,approveReason:"",smuSap:0,statusIP:{name:"",date:"",status:""},statusIF:{name:"",date:"",status:""},approvedBy:"",approveDate:"",declinedBy:"",declinedDate:"",reviseReason:"",acceptedby:"",accepteddate:"",declinedPortalBy:"",declinedPortalDate:""},Gr={site:!1,equipmentModel:!1,equipmentNumber:!1,componentDescription:!1,conditionRatingDate:!1,interventionStatus:!1,followUpPriority:!1,estimationCompletionDate:!1},_e=Ne({id:"formIntervention",state:()=>({stateIsFromEquipment:!1,stateIsFromIntervention:!1,stateFormFilter:qr,stateFormIntervention:{...Va},stateFormLoading:{...Gr},stateListAdditionalSensorData:[],stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateEquipmentNumberOption:[],stateComponentOption:[],stateConditionRatingDateOption:[],stateInterventionStatusOption:[],stateFollowUpPriorityOption:[],stateHeaderCbm:"",stateFormCbmHeaderVisibility:!1,statePsTypeCbm:"",stateGenericDefectLoading:!1,stateIsAdditionalSensorExist:!1}),getters:{listAdditionalSensorData:e=>e.stateListAdditionalSensorData,isAdditionalSensorExist:e=>e.stateIsAdditionalSensorExist,isFromEquipment:e=>e.stateIsFromEquipment,isFromIntervention:e=>e.stateIsFromIntervention,formIntervention:e=>e.stateFormIntervention,formFilter:e=>e.stateFormFilter,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,siteOption:e=>e.stateSiteOption,equipmentModelOption:e=>e.stateEquipmentModelOption,equipmentNumberOption:e=>e.stateEquipmentNumberOption,componentOption:e=>e.stateComponentOption,conditionRatingDateOption:e=>e.stateConditionRatingDateOption,interventionStatusOption:e=>e.stateInterventionStatusOption,followUpPriorityOption:e=>e.stateFollowUpPriorityOption,formLoading:e=>e.stateFormLoading,genericLoading:e=>e.stateGenericDefectLoading,headerCbm:e=>e.stateHeaderCbm,formCbmHeaderVisibility:e=>e.stateFormCbmHeaderVisibility,psTypeCbm:e=>e.statePsTypeCbm,isCannotReviseOrSubmit:e=>e.stateFormIntervention.interventionExecutionId<1||e.stateFormIntervention.interventionExecutionId>4||!e.stateFormIntervention.userRevise&&!(e.stateFormIntervention.interventionHeaderId==0||e.stateFormIntervention.interventionHeaderId==null)},actions:{async getSiteLookup(e=!1){this.stateFormLoading.site=!0;const t={ver:"v1",equipmentModel:this.formIntervention.equipmentModel||"",equipmentNumber:this.formIntervention.equipmentNumber||""};try{const a=await g.get(Et,"",new URLSearchParams(t).toString());e&&(this.stateFormIntervention.site=a.data.result.content.site.siteDescription[0]||""),this.stateSiteOption=vt(a.data.result.content.site.siteDescription)}catch(a){A("IRONS",a),console.log(a)}finally{this.stateFormLoading.site=!1}},async getEquipmentModelLookup(e=!1){this.stateFormLoading.equipmentModel=!0;const t={site:this.formIntervention.site||"",equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const a=await g.get(Et,"",new URLSearchParams(t).toString());e&&(this.stateFormIntervention.equipmentModel=a.data.result.content.equipmentModel[0]||""),this.stateEquipmentModelOption=vt(a.data.result.content.equipmentModel)}catch(a){A("IRONS",a),console.log(a)}finally{this.stateFormLoading.equipmentModel=!1}},async getEquipmentNumberLookup(){this.stateFormLoading.equipmentNumber=!0;const e={site:this.formIntervention.site||"",equipmentModel:this.formIntervention.equipmentModel||"",ver:"v1"};try{const t=await g.get(Et,"",new URLSearchParams(e).toString());this.stateEquipmentNumberOption=vt(t.data.result.content.equipmentNumber)}catch(t){A("IRONS",t),console.log(t)}finally{this.stateFormLoading.equipmentNumber=!1}},async getComponentLookup(){this.stateFormLoading.componentDescription=!0;const e={equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const t=await g.get(Et,"",new URLSearchParams(e).toString());this.stateComponentOption=vt(t.data.result.content.component)}catch(t){A("IRONS",t),console.log(t)}finally{this.stateFormLoading.componentDescription=!1}},async getConditionRatingDateLookup(){this.stateFormLoading.conditionRatingDate=!0;const e={equipmentNumber:this.formIntervention.equipmentNumber||"",ver:"v1"};try{const t=await g.get(Dr,"",new URLSearchParams(e).toString());this.stateConditionRatingDateOption=t.data.result.content.conditionRatingDate.map((a,s)=>({label:`${Gt(a)} | ${t.data.result.content.interventionCodeId[s]}`,value:`${s}`,conditionRatingDate:Gt(a),componentHours:t.data.result.content.componentHours[s],interventionReason:t.data.result.content.interventionReason[s],conditionRatingSmu:t.data.result.content.conditionRatingSmu[s],interventionCodeId:t.data.result.content.interventionCodeId[s],keyPbi:t.data.result.content.keyPbi[s]}))}catch(t){A("IRONS",t),console.log(t)}finally{this.stateFormLoading.conditionRatingDate=!1}},async getInterventionStatusLookup(){this.stateFormLoading.interventionStatus=!0;const e={ver:"v1"};try{const t=await g.get(Ia,"",new URLSearchParams(e).toString());this.stateInterventionStatusOption=Zt(t.data.result.content,"interventionStatus","interventionStatusDesc")}catch(t){A("IRONS",t),console.log(t)}finally{this.stateFormLoading.interventionStatus=!1}},async getFollowUpPriorityLookup(){this.stateFormLoading.followUpPriority=!0;const e={interventionStatus:"Accepted",ver:"v1"};try{const t=await g.get(Ia,"",new URLSearchParams(e).toString());this.stateFollowUpPriorityOption=Zs({followUpPriority:t.data.result.content.followUpPriority,followUpPriorityUom:t.data.result.content.followUpPriorityUom}," "),this.stateFollowUpPriorityOption.sort((a,s)=>{const r=parseInt(a.value.replace(" hrs","")),n=parseInt(s.value.replace(" hrs",""));return r<n?-1:r>n?1:0})}catch(t){A("IRONS",t),console.log(t)}finally{this.stateFormLoading.followUpPriority=!1}},async getFormIntervention(){const e=Je(),a={employeeId:ae().user.EmployeeId||"",keyPbi:this.stateFormFilter.keyPbi||"",ver:"v1"};try{this.stateLoading=!0;const s=await g.get(kr,"",new URLSearchParams(a).toString());if(console.log("Form Intervention",s.data.result.content),s.data.result.content[0]){let r=s.data.result.content[0].interventionReason==""||s.data.result.content[0].interventionReason==null?[]:s.data.result.content[0].interventionReason.split("<br> ");r=r.sort((n,i)=>n.includes("CRITICAL")&&i.includes("CAUTION")?-1:1),this.stateFormIntervention.interventionHeaderId=s.data.result.content[0].interventionHeaderId,this.stateFormIntervention.interventionHeaderSourceId=s.data.result.content[0].interventionHeaderSourceId,this.stateFormIntervention.componentHours=s.data.result.content[0].componentHours,this.stateFormIntervention.conditionRatingSmu=s.data.result.content[0].conditionRatingSmu,this.stateFormIntervention.interventionStatus=s.data.result.content[0].interventionStatus||"",this.stateFormIntervention.interventionDiagnostic=s.data.result.content[0].interventionDiagnostic||"",this.stateFormIntervention.followUpPriority=s.data.result.content[0].followUpPriority||"",this.stateFormIntervention.estimationCompletionDate=s.data.result.content[0].estimationCompletionDate||"",this.stateFormIntervention.workOrder=s.data.result.content[0].workOrder||"",this.stateFormIntervention.additionalInformation=s.data.result.content[0].additionalInformation,this.stateFormIntervention.interventionExecutionId=s.data.result.content[0].interventionExecutionId,this.stateFormIntervention.userRevise=s.data.result.content[0].userRevise,this.stateFormIntervention.keyPbi=s.data.result.content[0].keyPbi,this.stateFormIntervention.declineReason=s.data.result.content[0].declineReason,this.stateFormIntervention.interventionCosmosId=s.data.result.content[0].interventionCosmosId,this.stateFormIntervention.genericDefect=s.data.result.content[0].genericDefect,this.stateFormIntervention.site=s.data.result.content[0].site,this.stateFormIntervention.equipmentModel=s.data.result.content[0].equipmentModel,this.stateFormIntervention.equipmentNumber=s.data.result.content[0].equipmentNumber,this.stateFormIntervention.conditionRatingDate=Gt(s.data.result.content[0].conditionRatingDate)||"",this.stateFormIntervention.interventionReason=r.join("<br> "),this.stateFormIntervention.frameHours=s.data.result.content[0].frameHours||"0",this.stateFormIntervention.showConditionRatingDate=s.data.result.content[0].showConditionRatingDate||"",this.stateFormIntervention.isParameterUpdate=s.data.result.content[0].isParameterUpdate||!1,this.stateFormIntervention.defectStatusId=s.data.result.content[0].defectStatusId||null,this.stateFormIntervention.interventionExecutionBy=s.data.result.content[0].interventionExecutionBy||null,this.stateFormIntervention.executionDateTime=s.data.result.content[0].executionDateTime||null,this.stateFormIntervention.approveReason=s.data.result.content[0].approveReason,this.stateFormIntervention.smuSap=s.data.result.content[0].smuSap,this.stateFormIntervention.statusIP={name:s.data.result.content[0].statusIP.name,date:s.data.result.content[0].statusIP.date,status:s.data.result.content[0].statusIP.status},this.stateFormIntervention.statusIF={name:s.data.result.content[0].statusIF.name,date:s.data.result.content[0].statusIF.date,status:s.data.result.content[0].statusIF.status},this.stateFormIntervention.approvedBy=s.data.result.content[0].approvedBy,this.stateFormIntervention.approveDate=s.data.result.content[0].approveDate,this.stateFormIntervention.reviseReason=s.data.result.content[0].reviseReason,this.stateFormIntervention.declinedBy=s.data.result.content[0].declinedBy,this.stateFormIntervention.declinedDate=s.data.result.content[0].declinedDate,this.stateFormIntervention.acceptedby=s.data.result.content[0].acceptedby,this.stateFormIntervention.accepteddate=s.data.result.content[0].accepteddate,this.stateFormIntervention.declinedPortalBy=s.data.result.content[0].declinedPortalBy,this.stateFormIntervention.declinedPortalDate=s.data.result.content[0].declinedPortalDate,this.stateGenericDefectLoading=!0,await e.getDefectsDataAll(this.stateFormIntervention.interventionCosmosId),this.stateGenericDefectLoading=!1,this.stateFormIntervention.isParameterUpdate&&(this.setIsAdditionalSensorExist(!0),await this.getAdditionalSensorData())}}catch(s){A("IRONS",s),console.log(s),s.response.data.statusCode==401&&(this.stateLoading=!1,ae().setLoggedIn(!1)),console.log(s)}finally{this.stateLoading=!1}},async getAdditionalSensorData(){const e={keyPbi:this.stateFormIntervention.keyPbi,ver:"v1"};try{this.stateLoading=!0;const t=await g.get(Er,"",new URLSearchParams(e).toString());this.stateListAdditionalSensorData=[],t.data.result.content.sensors.forEach(a=>{this.stateListAdditionalSensorData.push({id:a.id,interventionReason:a.interventionReason,isCheck:!0})})}catch(t){A("IRONS",t),console.log(t)}finally{this.stateLoading=!1}},async postAdditionalSensorData(e){const t=ae(),a={userAccount:t.user.Name,ver:"v1"},s={keyPbi:this.stateFormIntervention.keyPbi,isRevise:e,employeeId:t.user.EmployeeId,employeeName:t.user.Name,sensors:[]};return this.stateListAdditionalSensorData.forEach(r=>{s.sensors.push({id:r.id,isCheck:r.isCheck})}),new Promise((r,n)=>{this.stateLoading=!0,g.post(`${Ar}?${new URLSearchParams(a).toString()}`,s).then(i=>{r(i.data.result)}).catch(i=>{A("IRONS",i),console.log(i.response),r(i.response.data.result)}).finally(()=>{this.stateLoading=!1})})},resetInterventionWhenStatusIsDeclined(){this.stateFormIntervention.interventionDiagnostic="",this.stateFormIntervention.followUpPriority="",this.stateFormIntervention.estimationCompletionDate="",this.stateFormIntervention.workOrder=""},resetFollowUpPriorityOption(){this.stateFollowUpPriorityOption=[]},async getEstimationCompletionDate(){this.stateFormLoading.estimationCompletionDate=!0;const e={equipmentModel:this.stateFormIntervention.equipmentModel,site:this.stateFormIntervention.site,followUpPriority:this.stateFormIntervention.followUpPriority,sampleDate:this.stateFormIntervention.conditionRatingDate?Jt(Kt(ba(this.stateFormIntervention.conditionRatingDate))):"",ver:"v1"};try{const t=await g.get(_r,"",new URLSearchParams(e).toString());this.stateFormIntervention.estimationCompletionDate=t.data.result.content.estimationCompletionDate}catch(t){t.response.data.statusCode==401&&ae().setLoggedIn(!1),A("IRONS",t),console.log(t)}finally{this.stateFormLoading.estimationCompletionDate=!1}},async updateData(e,t){const a=Ve();try{this.stateLoading=!0;const s={userAccount:e,ver:"v1"},r={employeeName:e,employeeId:t,interventionHeaderId:this.stateFormIntervention.interventionHeaderId,interventionHeaderSourceId:this.stateFormIntervention.interventionHeaderSourceId,site:this.stateFormIntervention.site,equipmentModel:this.stateFormIntervention.equipmentModel,equipmentNumber:this.stateFormIntervention.equipmentNumber,interventionReason:this.stateFormIntervention.interventionReason,conditionRatingSmu:Number(this.stateFormIntervention.conditionRatingSmu),conditionRatingDate:Jt(Kt(ba(this.stateFormIntervention.conditionRatingDate))),interventionCodeId:this.stateFormIntervention.interventionCodeId,interventionStatus:this.stateFormIntervention.interventionStatus,interventionDiagnostic:this.stateFormIntervention.interventionDiagnostic,followUpPriority:this.stateFormIntervention.followUpPriority,estimationCompletionDate:this.stateFormIntervention.estimationCompletionDate?Jt(Kt(new Date(this.stateFormIntervention.estimationCompletionDate))):null,workOrder:this.stateFormIntervention.workOrder,isRevise:!!this.stateFormIntervention.interventionHeaderId,additionalTask:[...a.additionalTaskList,...a.deletedAdditionalTaskList],keyPbi:this.stateFormIntervention.keyPbi,interventionChecks:this.getInterventionChecksForRequest(),componentAffected:[...a.componentList],declineReason:this.stateFormIntervention.interventionStatus=="Declined"?this.stateFormIntervention.declineReason:"",reviseReason:this.stateFormIntervention.interventionStatus=="Accepted"?this.stateFormIntervention.reviseReason:"",isDma:!1};console.log(r);const n=await g.post(`${wr}?${new URLSearchParams(s).toString()}`,r);n.data.title==="Error"?(this.stateErrors.push(n.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&ae().setLoggedIn(!1),this.stateError=s,A("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setIsError(e){this.stateIsError=e},setFormFilter(e){this.stateFormFilter.keyPbi=e.keyPbi||""},setIsFromEquipment(e){this.stateIsFromEquipment=e},setIsFromIntervention(e){this.stateIsFromIntervention=e},updateInterventionReason(e){this.stateFormIntervention.interventionReason=e},setIsAdditionalSensorExist(e){this.stateIsAdditionalSensorExist=e},resetFormIntervention(){this.stateFormIntervention.interventionHeaderId=0,this.stateFormIntervention.interventionHeaderSourceId=0,this.stateFormIntervention.conditionRatingDate="",this.stateFormIntervention.componentHours="",this.stateFormIntervention.conditionRatingSmu="",this.stateFormIntervention.interventionReason="",this.stateFormIntervention.interventionCodeId="",this.stateFormIntervention.interventionStatus="",this.stateFormIntervention.interventionDiagnostic="",this.stateFormIntervention.followUpPriority="",this.stateFormIntervention.estimationCompletionDate="",this.stateFormIntervention.workOrder="",this.stateFormIntervention.additionalInformation="",this.stateFormIntervention.interventionExecutionId=0,this.stateFormIntervention.keyPbi="",this.stateFormIntervention.declineReason="",this.stateFormIntervention.frameHours="",this.stateFormIntervention.canEditComponent=!1,this.stateFormIntervention.showConditionRatingDate="",this.stateFormIntervention.interventionExecutionBy=null,this.stateFormIntervention.executionDateTime=null,this.stateFormIntervention.approveReason="",this.stateFormIntervention.smuSap=0,this.stateFormIntervention.statusIP={name:"",date:"",status:""},this.stateFormIntervention.statusIF={name:"",date:"",status:""},this.stateFormIntervention.approvedBy="",this.stateFormIntervention.approveDate="",this.stateFormIntervention.reviseReason="",this.stateFormIntervention.declinedBy="",this.stateFormIntervention.declinedDate="",this.stateFormIntervention.acceptedby="",this.stateFormIntervention.accepteddate="",this.stateFormIntervention.declinedPortalBy="",this.stateFormIntervention.declinedPortalDate="",this.stateIsFromEquipment=!1,this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateFormFilter.keyPbi=""},resetFormInterventionAndFilter(){this.stateFormIntervention={...Va}},setHeaderCbm(e){this.stateHeaderCbm=e},setFormCbmHeaderVisibility(e){this.stateFormCbmHeaderVisibility=e},setPsTypeCbm(e){this.statePsTypeCbm=e},getInterventionChecksForRequest(){return Ve().interventionCheckList.map(t=>({interventionDetailId:t.interventionDetailId,interventionDetailSourceId:t.interventionDetailSourceId,sequence:t.isMandatory?t.sequence:null,isMandatory:t.isMandatory,keyPbi:t.keyPbi,isActive:t.isActive}))},resetGeneric(e=!1){if(e){Je().reset();return}this.stateGenericDefectLoading=!1},async getDataFromKeyPbi(e){const t=Ve();this.stateFormFilter.keyPbi=e,t.setFilter({keyPbi:e}),this.getFollowUpPriorityLookup(),this.getInterventionStatusLookup();try{await this.getFormIntervention();const a=t.mapHeaderFromExecutionIdAndDefectId(this.stateFormIntervention.interventionExecutionId,this.stateFormIntervention.defectStatusId);this.stateIsFromEquipment&&a=="Pending Evaluation"?(await Promise.all([t.getInterventionCheckList(),t.getAdditionalTaskList()]),await t.getComponentList(!0)):(t.resetFewList(),await Promise.all([t.getComponentList(),t.getAdditionalTaskList()]),await t.getInterventionCheckList()),t.getInterventionChecksImage(),this.getSiteLookup(),this.getEquipmentModelLookup(),this.getEquipmentNumberLookup(),this.getComponentLookup(),this.getConditionRatingDateLookup()}catch(a){console.error(a)}}}}),Jr=e=>(Oe("data-v-83928213"),e=e(),Le(),e),Kr={class:"fv-row custom-text-input"},Wr=Jr(()=>l("label",{class:ke("form-label fs-6 fw-bolder text-white")},"Intervention Reason",-1)),Yr=["innerHTML"],zr=he({__name:"InterventionReason",props:{paragraph:{required:!0,default:""}},setup(e){const a=we(e,"paragraph"),s=F(null),r=q(()=>a.value.replace(/CRITICAL/gi,'<span class="text-critical">CRITICAL</span>').replace(/CAUTION/gi,'<span class="text-caution">CAUTION</span>').replace(/NORMAL/gi,'<span class="text-normal-inv">NORMAL</span>')),n=F(!0);return Qt(()=>{s.value&&(n.value=s.value.scrollHeight>s.value.clientHeight)}),(i,o)=>(h(),D("div",Kr,[Wr,l("p",{ref_key:"paragraphRef",ref:s,class:"disabled-textarea",innerHTML:r.value,style:{overflow:"auto"}},null,8,Yr)]))}}),jr=Ce(zr,[["__scopeId","data-v-83928213"]]),Zr=he({__name:"ComponentGrid",props:{listData:{required:!0,type:Array},reRender:{required:!0,type:Boolean},isLoading:{type:Boolean,default:!1},isCannotEdit:{type:Boolean,default:!1},height:{type:String,default:"200"}},setup(e){const t=Ve(),a=e,s=F();it(()=>a.reRender===!0,async()=>{n()});const r=async i=>{t.updateComponentAffected(i)},n=async()=>{t.componentList.length>0?t.componentList.filter(o=>o.isCheck==!0).forEach(o=>{s.value.toggleRowSelection(o,void 0)}):s.value.clearSelection()};return(i,o)=>{const d=Y("el-table-column"),c=Y("el-table"),p=be("loading");return me((h(),se(c,{ref_key:"tableComponentListRef",ref:s,data:a.listData,height:a.height,style:{width:"100%"},"element-loading-background":"#2d2b39b3","empty-text":"No Data",class:"intervention-component_table table-grey","header-row-class-name":"bg-grey-header","header-cell-class-name":"bg-grey-header","row-class-name":"table-row-grey no-uppercase","cell-class-name":"text-black small-padding",onSelectionChange:r,"row-key":"componentId","select-on-indeterminate":""},{default:S(()=>[m(d,{prop:"componentDescription",label:"Component",width:"180",class:"text-black"}),m(d,{prop:"componentHm",label:"Component Life (hours)",align:"center","label-class-name":"no-uppercase",class:"text-black"}),m(d,{prop:"oemInterval",label:"BUMA AU Target (hours)","label-class-name":"no-uppercase",align:"center",class:"text-black"}),m(d,{prop:"percentage",label:"Component Life (percentage)","label-class-name":"no-uppercase",align:"center",class:"text-black"},{default:S(f=>[ve(P(f.row.percentage)+" % ",1)]),_:1}),m(d,{type:"selection","reserve-selection":"",selectable:()=>!a.isCannotEdit,width:52,align:"center",class:"table-selection","class-name":"table-selection"},null,8,["selectable"])]),_:1},8,["data","height"])),[[p,a.isLoading]])}}}),Mt=Ne({id:"ComponentInterventionDefectsForm",state:()=>({stateIsYes:void 0,stateLoading:!1,stateCancelled:!1,stateDefectYesVisible:!1,stateDefectNoVisible:!1,stateViewYesVisible:!1,stateViewtNoVisible:!1,stateIsValid:!0,stateItemKey:"",stateTask:{},stateDefectInfo:{},stateDeclineReason:"",stateDeclineBy:{},stateDeclineDate:"",statePayload:{updateParams:[]},stateItem:{}}),getters:{Loading:e=>e.stateLoading,Cancelled:e=>e.stateCancelled,DefectYesVisible:e=>e.stateDefectYesVisible,DefectNoVisible:e=>e.stateDefectNoVisible,ViewYesVisible:e=>e.stateViewYesVisible,ViewNoVisible:e=>e.stateViewtNoVisible,ItemKey:e=>e.stateItemKey,isValid:e=>e.stateIsValid,isYes:e=>e.stateIsYes,defectInfo:e=>e.stateDefectInfo,selectedGroup:()=>Ae().selectedGroup,selectedFitter:()=>Ae().employee,supervisor:()=>{const e=ae();return{id:e.user.EmployeeId,name:e.user.Name}},images:()=>Vt().ImageObjects.find(t=>t.Id==="defect"),globalConnectionStore:()=>Ge(),declineReason:e=>e.stateDeclineReason,declineBy:e=>e.stateDeclineBy,declineDate:e=>e.stateDeclineDate},actions:{setItem(e){this.stateItem=e},setItemKey(e){this.stateItemKey=e},setCancelledState(e){this.stateCancelled=e},cretateInstance(e=!0){this.stateDefectInfo=e?new ze:new Xt,this.stateIsYes=e},setTask(e){this.stateTask=e},toggleYesVisible(e){this.stateDefectYesVisible=e,this.stateDefectNoVisible=!1,this.stateCancelled=!1},toggleNoVisible(e){this.stateDefectNoVisible=e,this.stateDefectYesVisible=!1,this.stateCancelled=!1},toggleViewNoVisible(e){this.stateViewtNoVisible=e,this.stateViewYesVisible=!1},toggleViewYesVisible(e){this.stateViewYesVisible=e,this.stateViewtNoVisible=!1},createYesPayload(e){var n;const t=Ae(),a=this.stateDefectInfo,s=((n=this.images)==null?void 0:n.ImageInfos)??[],r=a.Resources.filter(i=>i.value!=="");this.statePayload.defectDetail={type:"YES",title:e,assetNumber:a.AssetNumber,description:a.Description.value,raisedBy:this.selectedFitter.name,date:"<<ServerDateTime>>",plannedDuration:a.PlannedDuration.value,instruction:a.Instruction.value,priority:a.Priority,parts:JSON.stringify(a.Parts),labours:JSON.stringify(a.Labours),resources:JSON.stringify(r.map(i=>i.value)),symptoms:JSON.stringify(a.Symptoms.map(i=>i.value)),causes:JSON.stringify(a.Causes.map(i=>i.value)),images:JSON.stringify(s),interventionId:t.generalForm.id}},createNoPayload(e){var r;const t=Ae(),a=this.stateDefectInfo,s=((r=this.images)==null?void 0:r.ImageInfos)??[];this.statePayload.defectDetail={type:"NO",title:e,assetNumber:a.AssetNumber,description:a.Description.value,raisedBy:this.selectedFitter.name,date:"<<ServerDateTime>>",actions:JSON.stringify(a.Actions.map(n=>n.value)),images:JSON.stringify(s),interventionId:t.generalForm.id}},createPayload(){const e=Ae();this.statePayload.id=e.generalForm.id,this.statePayload.headerId=e.generalForm.id,this.statePayload.workorder=e.generalForm.sapWorkOrder,this.statePayload.updateParams=[],this.statePayload.updateParams.push({keyValue:this.stateTask.key,propertyParams:[{propertyName:"taskValue",propertyValue:"3"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.selectedFitter)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.statePayload.employee=this.selectedFitter,this.statePayload.defectHeader={workorder:e.generalForm.sapWorkOrder,form:e.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:e.generalForm.id,category:this.stateTask.category,taskId:this.stateTask.key,interventionHeaderId:e.generalForm.trInterventionHeaderId,taskNo:this.stateTask.description!=""?this.stateTask.description.split("")[0]:this.stateTask.items[0].value,taskDesc:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,defectWorkorder:"",formDefect:"BA-PL-F55",defectType:this.stateIsYes?"YES":"NO",cbmMeasurement:"",cbmUom:"",cbmImageKey:"",cbmImageProp:"",isCbmAdjusment:"",taskValue:"3",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.supervisor,status:"Submited",defectStatus:"Submited"};const t=sr(this.stateTask);this.stateIsYes?this.createYesPayload(t):this.createNoPayload(t)},async createDefect(){this.stateLoading=!0;const e={ver:"v1"};try{this.createPayload();const t=await g.post(`${ts}?${new URLSearchParams(e).toString()}`,this.statePayload);this.stateLoading=!1;const a=Ae();return t.data.result.message==Z.TASK_UPDATED_BY_OTHER?(a.toggleTaskAlreadyUpdatedStatus(!0),!1):t.data.result.message==Z.SUBMITTED?(a.toggleFormAlreadySubmitted(!0),!1):(a.toggleFormUpdated(!0),!0)}catch(t){const a=this.globalConnectionStore.checkIsErrorNoNetwork(t);return this.globalConnectionStore.setSubmitConnectionError(a),Q(t),console.log(t),this.stateLoading=!1,A("IRONS",t),!1}},async getDefectDeclineReason(e){const s=Je().ApprovalData.DefectHeaders.find(r=>r.taskId==e);s&&(this.stateDeclineReason=s.declineReason||"",this.stateDeclineDate=s.declineDate||"",this.stateDeclineBy=s.declineBy||{})},async getDefectDetail(e,t){this.stateLoading=!0;const a={ver:"v1"},s={interventionHeaderId:e,taskId:t,isActive:"true",isDeleted:"false"};try{const n=(await g.post(`${as}?${new URLSearchParams(a).toString()}`,s)).data.result.content.detail,i=Vt(),o=gt();if(i.setCurrent("defect"),i.clearCurrent(),n.type==="YES"){this.stateIsYes=!0,this.stateDefectInfo=new ze,this.stateDefectInfo.setAssetNumber(n.assetNumber),this.stateDefectInfo.setDescription(n.description),this.stateDefectInfo.setPriority(n.priority),this.stateDefectInfo.setRaisedBy(n.raisedBy),this.stateDefectInfo.setDate(n.date),this.stateDefectInfo.setPlannedDuration(n.plannedDuration),this.stateDefectInfo.setInstruction(n.instruction),this.stateDefectInfo.setTitle(n.title),this.stateDefectInfo.importParts(...JSON.parse(n.parts)),this.stateDefectInfo.importLabours(...JSON.parse(n.labours)),this.stateDefectInfo.importResources(...JSON.parse(n.resources)),this.stateDefectInfo.importSymptoms(...JSON.parse(n.symptoms)),this.stateDefectInfo.importCauses(...JSON.parse(n.causes)),this.images.ImageInfos.push(...JSON.parse(n.images));const d=[];this.images.ImageInfos.forEach(c=>{let p="";typeof c=="string"?p=c:p=c.filename,d.push(o.downloadAttachment(p))}),Promise.all(d).then(c=>{c.forEach(p=>{const f=new Blob([p],{type:"image/png"});this.images.ImageBlobs.push(f)}),this.toggleViewYesVisible(!0)})}else{this.stateIsYes=!1,this.stateDefectInfo=new Xt,this.stateDefectInfo.setAssetNumber(n.assetNumber),this.stateDefectInfo.setDescription(n.description),this.stateDefectInfo.setRaisedBy(n.raisedBy),this.stateDefectInfo.setDate(n.date),this.stateDefectInfo.setTitle(n.title),this.stateDefectInfo.importActions(...JSON.parse(n.actions)),this.images.ImageInfos.push(...JSON.parse(n.images));const d=[];this.images.ImageInfos.forEach(c=>{let p="";typeof c=="string"?p=c:p=c.filename,d.push(o.downloadAttachment(p))}),Promise.all(d).then(c=>{c.forEach(p=>{const f=new Blob([p],{type:"image/png"});this.images.ImageBlobs.push(f)}),this.toggleViewNoVisible(!0)})}this.stateLoading=!1}catch(r){Q(r),console.log(r),A("IRONS",r),this.stateLoading=!1}},resetInstance(){this.stateLoading=!1,this.stateIsYes=void 0,this.stateDefectYesVisible=!1,this.stateDefectNoVisible=!1,this.stateViewYesVisible=!1,this.stateViewtNoVisible=!1,this.stateIsValid=!0,this.stateItemKey="",this.stateTask={},this.stateDefectInfo={},this.statePayload={updateParams:[]}}}}),Xr="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/defect_detail/get_data_by_param/",Qr=Ne({id:"NAPreview",state:()=>({stateLoading:!1,stateViewVisible:!1,stateNAInfo:{}}),getters:{ViewVisible:e=>e.stateViewVisible,Details:e=>e.stateNAInfo},actions:{async getNADetail(e,t){this.stateLoading=!0;const a={ver:"v1"},s={servicesheetDetailId:e,taskId:t};try{const r=await g.post(`${Xr}?${new URLSearchParams(a).toString()}`,s);this.stateNAInfo=r.data.result.content.detail,console.log(this.stateNAInfo),this.stateLoading=!1,this.toggleIsViewVisible(!0)}catch(r){Q(r),console.log(r),this.stateLoading=!1,A("IRONS",r)}},setNAInfo(e){this.stateNAInfo=e},toggleIsViewVisible(e){this.stateViewVisible=e},resetInstance(){this.stateLoading=!1,this.stateNAInfo={},this.stateViewVisible=!1}}}),Bt=Ne({id:"ComponentInterventionNAForm",state:()=>({stateLoading:!1,stateCancelled:!1,stateVisible:!1,stateViewVisible:!1,stateIsValid:!0,stateItemKey:"",stateReason:"",stateTitle:"",stateTask:{},statePayload:{updateParams:[]},stateItem:{},stateSuccessUpdateItemKey:""}),getters:{Loading:e=>e.stateLoading,Cancelled:e=>e.stateCancelled,Reason:e=>e.stateReason,Visible:e=>e.stateVisible,ViewVisible:e=>e.stateViewVisible,ItemKey:e=>e.stateItemKey,isValid:e=>e.stateIsValid,selectedGroup:()=>Ae().selectedGroup,selectedFitter:()=>Ae().employee,supervisor:()=>{const e=ae();return{id:e.user.EmployeeId,name:e.user.Name}},globalConnectionStore:()=>Ge()},actions:{setItem(e){this.stateItem=e},setReason(e){this.stateReason=e},setCancelledState(e){this.stateCancelled=e},setItemKey(e){this.stateItemKey=e,this.stateSuccessUpdateItemKey=""},setTask(e){this.stateTask=e},toggleIsVisible(e){this.stateVisible=e,this.stateCancelled=!1},toggleIsViewVisible(e){this.stateViewVisible=e},createPayload(){const e=Ae();this.statePayload.id=e.generalForm.id,this.statePayload.workorder=e.generalForm.sapWorkOrder,this.statePayload.headerId=e.generalForm.id,this.statePayload.updateParams=[],this.statePayload.updateParams.push({keyValue:this.stateTask.key,propertyParams:[{propertyName:"taskValue",propertyValue:"4"},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.selectedFitter)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.statePayload.employee=this.selectedFitter,this.statePayload.defectHeader={workorder:e.generalForm.sapWorkOrder,form:e.generalForm.equipmentDesc,serviceSheetDetailId:"",interventionId:e.generalForm.id,interventionHeaderId:e.generalForm.trInterventionHeaderId,category:this.stateTask.category,taskId:this.stateTask.key,taskNo:this.stateTask.description!=""?this.stateTask.description.split("")[0]:this.stateTask.items[0].value,taskDesc:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,defectWorkorder:"",formDefect:"DM-PL-F55",defectType:"",cbmMeasurement:"",cbmUom:"",cbmImageKey:"",cbmImageProp:"",isCbmAdjusment:"",taskValue:"4",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.supervisor,status:"Submited",defectStatus:"Submited"},this.statePayload.defectDetail={type:"N/A",reason:this.Reason,title:this.stateTask.description!=""?this.stateTask.description:this.stateTask.items[1].value,interventionId:e.generalForm.id}},async createNA(){this.stateLoading=!0;const e={ver:"v1"};try{this.createPayload();const t=await g.post(`${ts}?${new URLSearchParams(e).toString()}`,this.statePayload);this.stateLoading=!1;const a=Ae();return t.data.result.message==Z.TASK_UPDATED_BY_OTHER?(a.toggleTaskAlreadyUpdatedStatus(!0),!1):t.data.result.message==Z.SUBMITTED?(a.toggleFormAlreadySubmitted(!0),!1):(a.toggleFormUpdated(!0),!0)}catch(t){const a=this.globalConnectionStore.checkIsErrorNoNetwork(t);this.globalConnectionStore.setSubmitConnectionError(a),Q(t),A("IRONS",t),console.log(t)}},async getNADetail(e,t){this.stateLoading=!0;const a={ver:"v1"},s={interventionHeaderId:e,taskId:t,isActive:"true",isDeleted:"false"};try{const n=(await g.post(`${as}?${new URLSearchParams(a).toString()}`,s)).data.result.content.detail;Qr().setNAInfo(n),this.setReason(n.reason),this.stateTitle=n.title,this.stateLoading=!1,this.toggleIsViewVisible(!0)}catch(r){r.message.includes("Network Error")&&Ge().setSubmitConnectionError(!0),Q(r),A("IRONS",r),console.log(r)}this.stateLoading=!1},resetInstance(){this.stateSuccessUpdateItemKey=this.stateItemKey,this.stateLoading=!1,this.stateReason="",this.stateVisible=!1,this.stateViewVisible=!1,this.stateIsValid=!0,this.stateTask={},this.statePayload={updateParams:[]}}}}),$t="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention",Ot=`${$t}/update?ver=v1`,Oa=`${$t}/update_task?ver=v1`,La=`${$t}/update_task_with_defect?ver=v1`,ei=`${$t}/get_field_value`,ti="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/history_intervention_sync/get_data_list_by_param_limit",ns="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/upload",ai="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention/sync_intervention",si="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/master_setting/get_data_by_param?ver=v1",ri="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/get_data_by_param?ver=v1",ii="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/get_data_by_param?ver=v1",ni="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/get_data_list_by_param?ver=v1",oi="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/get_data_list_by_param?ver=v1",li="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention/get_defect_identified_count",Ft="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/update?ver=v1",os="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_detail/update_by_fitter?ver=v1",di="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/get_intervention_defect_header",ls="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention_defect_header/update?ver=v1",ds="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_header_offline",ci="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_detail",ui="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_detail_offline",Ha=`${ds}/update?ver=v1`,Ma=`${ds}/update_task?ver=v1`,Ba=`${ui}/update_task?ver=v1`,$a=`${ci}/update_task_with_defect?ver=v1`,Ua="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_detail/update_task_with_defect_multiple?ver=v1",pi="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/defect_header/update_with_service_detail_id?ver=v1",xa="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/defect_detail/update_by_fitter?ver=v1",qa="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_detail/create_generic_defect?ver=v1",Ga="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/calibration_detail/update_task?ver=v1",Ja="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/calibration_header/update?ver=v1",mi="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/intervention/create_generic_defect?ver=v1",fi="https://digital-bumaau-dev-apm-001.azure-api.net/utility/api/master_attachment/get_sas_url",rt=Ne({id:"ComponentInterventionHeaderStore",state:()=>({stateSelectedWorkOrder:"",stateSelectedShortWorkOrder:"",stateOutstandingWorkorders:[],stateLastSync:"",stateActiveFitter:{},stateGeneralSubmitted:!1,stateLog:{},stateServicePersonnel:{},stateServicePersonnels:[],stateDayOffset:0,stateIsBusy:!1,stateSMUTolerance:{},stateSMUToleranceNotMapped:!1}),getters:{WorkOrder:e=>e.stateOutstandingWorkorders.sort((t,a)=>Ks(new Date(a.headerChangedOn),new Date(t.headerChangedOn))),SelectedWorkOrder:e=>e.stateSelectedWorkOrder,SelectedShortWO:e=>e.stateSelectedShortWorkOrder,LastSync:e=>e.stateLastSync,GeneralSubmitted:e=>e.stateGeneralSubmitted,ActiveFitter:e=>{var t;return(t=e.stateLog)==null?void 0:t.employee},Log:e=>e.stateLog,CutOffEstimate:e=>{const t=Ws(10);return Ys(t,"DD/MM/YYYY HH:mm:ss",e.stateDayOffset,"days")},IsBusy:e=>e.stateIsBusy,onlineStatus:()=>Ye(),authStore:()=>ae(),smuTolerance:e=>e.stateSMUTolerance,SMUToleranceNotMapped:e=>e.stateSMUToleranceNotMapped,globalConnectionStore:()=>Ge()},actions:{setLog(e){this.stateLog=e},setServicePersonnel(e){this.stateServicePersonnel=e},setBusyState(e){this.stateIsBusy=e},setSelectedWorkOrder(e){this.stateSelectedWorkOrder=e},setSelectedShortWorkOrder(e){this.stateSelectedShortWorkOrder=e},async getParamDaysBeforeEst(){const e={key:"InterventionMaxEstDate"};try{const t=await g.post(si,e);try{await u.offsetDate.add({offsetDate:+t.data.result.content.value})}catch(a){await u.offsetDate.put({offsetDate:+t.data.result.content.value}),A("IRONS",a)}this.stateDayOffset=+t.data.result.content.value}catch(t){console.log(t)}},async syncWithIronPortalData(){const e={ver:"v1"};try{await g.get(`${ai}?${new URLSearchParams(e).toString()}`)}catch(t){A("IRONS",t),console.log(t)}},async getWorkOrdersFromLocal(){const e=await u.offsetDate.limit(1).first();e&&(this.stateDayOffset=e.offsetDate),this.stateOutstandingWorkorders=await u.interventionHeader.toArray()},async getWorkOrderFromDB(e){await u.interventionHeader.get(e)},async getWorkOrderDetailFromDB(e){return await u.interventionDetail.where("keyPbi").equals(e).first()},async getWorkOrders(e){try{this.stateDayOffset==0&&await this.getParamDaysBeforeEst(),this.stateOutstandingWorkorders=await u.interventionHeader.toArray();const t={ver:"v1",siteId:e},a=await g.get(Pa,"",new URLSearchParams(t).toString()),s=[];a.data.result.content.length<1&&(this.stateOutstandingWorkorders=[],await u.interventionHeader.clear(),await u.interventionDetail.clear(),await u.interventionDefect.clear(),this.stateOutstandingWorkorders=[]),a.data.result.content.forEach(o=>{s.push({id:o.keyPbi,equipment:o.equipment,equipmentDesc:o.equipmentDesc,sampleStatus:o.sampleStatus,componentDescription:o.componentDescription,sapWorkOrder:o.sapWorkOrder,mdInterventionStatusId:o.mdInterventionStatusId,interventionStatus:o.interventionStatus,interventionDiagnosis:o.interventionDiagnosis,followUpPriority:o.followUpPriority,estimationCompletionDate:o.estimationCompletionDate,headerChangedOn:o.headerChangedOn,interventionExecution:o.interventionExecution,progress:o.progress,componentSystem:o.componentSystem})});const r=s.map(o=>o.id);await u.interventionHeader.filter(o=>!r.includes(o.id)).delete(),await u.interventionDetail.filter(o=>!r.includes(o.keyPbi)).delete();for(const o of s){const d=await u.interventionHeader.where("id").equals(o.id).first();if(d||await u.interventionHeader.add({id:o.id,equipment:o.equipment,equipmentDesc:o.equipmentDesc,sampleStatus:o.sampleStatus,componentDescription:o.componentDescription,sapWorkOrder:o.sapWorkOrder,mdInterventionStatusId:o.mdInterventionStatusId,interventionStatus:o.interventionStatus,interventionDiagnosis:o.interventionDiagnosis,followUpPriority:o.followUpPriority,estimationCompletionDate:o.estimationCompletionDate,status:"Not Updated",headerChangedOn:o.headerChangedOn,interventionExecution:o.interventionExecution,progress:o.progress,componentSystem:o.componentSystem}),d){const c=await u.interventionHeader.where("id").equals(o.id).first(),p=c.equipment==o.equipment&&c.equipmentDesc==o.equipmentDesc&&c.sampleStatus==o.sampleStatus&&c.componentDescription==o.componentDescription&&c.sapWorkOrder==o.sapWorkOrder&&c.estimationCompletionDate==o.estimationCompletionDate;await u.interventionHeader.put({id:o.id,equipment:o.equipment,equipmentDesc:o.equipmentDesc,sampleStatus:o.sampleStatus,componentDescription:o.componentDescription,sapWorkOrder:o.sapWorkOrder,mdInterventionStatusId:o.mdInterventionStatusId,interventionStatus:o.interventionStatus,interventionDiagnosis:o.interventionDiagnosis,followUpPriority:o.followUpPriority,estimationCompletionDate:o.estimationCompletionDate,status:p?c.status:"Not Updated",headerChangedOn:o.headerChangedOn,interventionExecution:o.interventionExecution,progress:o.progress,componentSystem:o.componentSystem})}this.stateOutstandingWorkorders=await u.interventionHeader.toArray()}}catch(t){A("IRONS",t),console.log("error")}},async syncWorkOrders(e){try{this.stateDayOffset==0&&await this.getParamDaysBeforeEst();const t={ver:"v1",siteId:e},a=await g.get(Pa,"",new URLSearchParams(t).toString()),s=[];a.data.result.content.length<1&&(this.stateOutstandingWorkorders=[],await u.interventionHeader.clear(),await u.interventionDetail.clear(),await u.interventionDefect.clear(),this.stateOutstandingWorkorders=[]),a.data.result.content.forEach(o=>{s.push({id:o.keyPbi,equipment:o.equipment,equipmentDesc:o.equipmentDesc,sampleStatus:o.sampleStatus,componentDescription:o.componentDescription,sapWorkOrder:o.sapWorkOrder,mdInterventionStatusId:o.mdInterventionStatusId,interventionStatus:o.interventionStatus,interventionDiagnosis:o.interventionDiagnosis,followUpPriority:o.followUpPriority,estimationCompletionDate:o.estimationCompletionDate,headerChangedOn:o.headerChangedOn,interventionExecution:o.interventionExecution,progress:o.progress,componentSystem:o.componentSystem})});const r=s.map(o=>o.id),i=(await u.interventionHeader.filter(o=>!r.includes(o.id)).toArray()).map(o=>o.sapWorkOrder);await u.interventionDetail.filter(o=>i.includes(o.sapWorkOrder)).delete(),await u.interventionHeader.filter(o=>!r.includes(o.id)).delete(),await this.syncDetail()}catch(t){A("IRONS",t),console.log(t)}},async setInterventionHeaderToLocalDB(e){await u.interventionHeader.put({id:e.id,equipment:e.equipment,equipmentDesc:e.equipmentDesc,sampleStatus:e.sampleStatus,componentDescription:e.componentDescription,sapWorkOrder:e.sapWorkOrder,mdInterventionStatusId:e.mdInterventionStatusId,interventionStatus:e.interventionStatus,interventionDiagnosis:e.interventionDiagnosis,followUpPriority:e.followUpPriority,estimationCompletionDate:e.estimationCompletionDate,status:"Updated",headerChangedOn:e.headerChangedOn,interventionExecution:e.interventionExecution,progress:e.progress,componentSystem:e.componentSystem})},async handleSetInterventionAccessibleOffline(e){const t=await this.getWorkOrderDetailById(e.id);await this.setInterventionHeaderToLocalDB(e),this.stateOutstandingWorkorders=await u.interventionHeader.toArray(),t&&t!=null&&await this.updateIntervention(t),console.log(t,"detailJSON")},async syncDetail(){let t=Promise.resolve();const a=C.clone(this.stateOutstandingWorkorders);for(const s of a)t=t.then(async()=>{const r=await this.getWorkOrderDetailById(s.id);return r&&r!=null&&await u.interventionDetail.put(r),await u.interventionHeader.put({id:s.id,equipment:s.equipment,equipmentDesc:s.equipmentDesc,sampleStatus:s.sampleStatus,componentDescription:s.componentDescription,sapWorkOrder:s.sapWorkOrder,mdInterventionStatusId:s.mdInterventionStatusId,interventionStatus:s.interventionStatus,interventionDiagnosis:s.interventionDiagnosis,followUpPriority:s.followUpPriority,estimationCompletionDate:s.estimationCompletionDate,status:"Updated",headerChangedOn:s.headerChangedOn,interventionExecution:s.interventionExecution,progress:s.progress,componentSystem:s.componentSystem}),this.stateOutstandingWorkorders=await u.interventionHeader.toArray(),new Promise(function(n){setTimeout(n,1e3)})})},async updateIntervention(e){const t=await u.interventionDetail.filter(a=>a.sapWorkOrder==e.sapWorkOrder);t&&await t.delete(),await u.interventionDetail.add(e)},async getWorkOrderDetailById(e){const t={ver:"v1",keyPbi:e};try{const a=await g.get(`${rs}?${new URLSearchParams(t).toString()}`),s=a.data.result.content;await this.handleSaveImagesToLocal(s);const r=await u.interventionDetail.filter(i=>i.sapWorkOrder==s.sapWorkOrder);r&&await r.delete(),await u.interventionDetail.add(s);const n=await u.interventionHeader.where({sapWorkOrder:+s.sapWorkOrder}).first();return n&&(n.status="Updated",await u.interventionHeader.put(n)),a.data.result.content}catch(a){return A("IRONS",a),null}},async updateHeaders(e){try{await g.post(Ot,e)}catch(t){A("IRONS",t),console.log(t)}},async handleSaveImagesToLocal(e){const t=[],a=async r=>{if(r.itemType=="image"&&!ye()){const n=await u.taskReference.where({filename:r.value}).first();if(!n)t.includes(r.value)||t.push(r.value);else if(!n.createdDate)u.taskReference.where({filename:r.value}).delete(),t.includes(r.value)||t.push(r.value);else{const i=new Date,o=n.createdDate;(i.getTime()-o.getTime())/(1e3*60*60*24)>1&&(u.taskReference.where({filename:r.value}).delete(),t.includes(r.value)||t.push(r.value))}}},s=e.details;for(const r of s)for(const n of r.tasks)for(const i of n.tasks)if(i.reference)for(const o of i.reference.items)for(const d in o){const c=o[d];await a(c)}if(t.length!=0)for(const r in t){const n=t[r],i={ver:"v1",id:n},d=(await g.get(`${fi}`,"",new URLSearchParams(i).toString())).data.result.content,c=await fetch(d.toString(),{headers:new Headers({})}).then(p=>p.blob()).then(p=>p);await u.taskReference.add({workorder:e.sapWorkOrder,filename:n,file:c,fileType:"image",createdDate:new Date})}},async getLatestSyncDate(){const e={ver:"v1",limit:"1",orderBy:"_ts",orderType:"desc"},t={isActive:"true"};try{const s=(await g.post(`${ti}?${new URLSearchParams(e).toString()}`,t)).data.result.content;if(s.length>0){const r=C.orderBy(s,["_ts"],["desc"]);this.stateLastSync=`${zs(r[0]._ts,"DD/MM/YYYY HH:mm:ss")} (AEST)`}}catch(a){A("IRONS",a),console.log(a)}},setActiveFitter(e){this.stateActiveFitter=e},createLogPayload(e,t){const a=X();let s;a.Intervention.log==null?s=[]:s=a.Intervention.log;let r=s==null?void 0:s.find(n=>{var i;return((i=n.employee)==null?void 0:i.id)==e.employee.id});return r?(Array.isArray(r.timeLoggedIn)||(r.timeLoggedIn=r.timeLoggedIn!=""?[r.timeLoggedIn]:[]),r.timeLoggedIn.push(e.timeLoggedIn),r.riskPhotos=[],s=a.Intervention.log):(r={},r.employee=e.employee,r.timeLoggedIn=[e.timeLoggedIn],r.shift=e.shift,r.isIHaveReadChecked=!0,r.riskPhotos=[],s=[r]),t.updateParams[0].propertyParams.push({propertyName:"log",propertyValue:JSON.stringify(r)}),s},setServicePersonnelForPayload(e=""){e&&(this.stateServicePersonnel.serviceEnd=e)},createServiceHistoryPayload(e,t){const r=X().Intervention.statusHistory.concat(e);t.updateParams[0].propertyParams.push({propertyName:"statusHistory",propertyValue:JSON.stringify(r)})},createGeneralFormPayload(e,t){const a={};a.employee=e.employee,a.localInterventionStatus=e.status,a.id=e.id,a.updateParams=[];const s={};return s.keyValue=e.key,s.propertyParams=[],t||s.propertyParams.push({propertyName:"serviceStart",propertyValue:e.submitDate}),s.propertyParams.push({propertyName:"interventionSMU",propertyValue:e.smu.replaceAll(",","")}),s.propertyParams.push({propertyName:"interventionExecution",propertyValue:e.status}),s.propertyParams.push({propertyName:"supervisor",propertyValue:JSON.stringify(a.employee)}),s.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(a.employee)}),s.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),s.propertyParams.push({propertyName:"servicePersonnels",propertyValue:JSON.stringify(this.stateServicePersonnel)}),a.updateParams.push(s),a},createFinishFormPayload(e){const t={};t.employee=e.employee,t.localInterventionStatus=e.status,t.id=e.id,t.updateParams=[];const a={};return a.keyValue=e.key,a.propertyParams=[],a.propertyParams.push({propertyName:"servicePersonnels",propertyValue:JSON.stringify({...this.stateServicePersonnel,serviceEnd:xe()})}),a.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(t.employee)}),a.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),t.updateParams.push(a),t},createPreRiskImages(e){const a=X().RiskAssessmentImages,s=a.filter(n=>n.updatedBy.id==this.Log.employee.id).slice(0,1);let r="front";return s.length>0&&s[0].imageType&&(r=s[0].imageType=="front"?"back":r),a.push({image:e.files[0],imageType:r,updatedBy:e.employee,updatedDate:xe()}),a},preRiskImagesFiltered(e){return X().RiskAssessmentImages.filter(s=>typeof s.image=="string"?s.image!=e:s.image.filename!=e)},createTaskPreRiskPayload(e,t){const a=X(),s={};s.employee=e.employee,s.localInterventionStatus=a.Intervention.interventionExecution,s.id=e.id,s.updateParams=[];const r={};return r.keyValue=e.key,r.propertyParams=[],r.propertyParams.push({propertyName:"value",propertyValue:JSON.stringify(t)}),s.updateParams.push(r),s},async createTaskPreRisk(e){const a=X().Intervention,s=this.createPreRiskImages(e),r=this.createTaskPreRiskPayload(e,s);ye()?await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"PreRisk",workorder:a.sapWorkOrder,key:e.key,bindingKey:e.key,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}):await this.storeImageToServer(r);for(const[n,i]of e.blobs.entries()){const o={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[n].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[n].filename,originalFilename:e.files[n].originalFilename??e.files[n].filename,blob:i,syncDate:re(),syncStatus:"Pending"};if(ye())await Me(u,"pendingTaskFile",o);else{const d=new FormData;d.append("files",i,`${e.files[n].filename}.png`),d.append("userAccount",this.authStore.user.Email),this.storeImageBlobToServer(d,o)}}return s},async deleteRiskAssesmentImage(e){const t=X(),a=await this.createTaskPreRiskDelete(e);await t.updateRiskAssesmentImageData(a,this.stateLog)},async createTaskPreRiskDelete(e){const t=X(),a=t.Intervention,s=this.preRiskImagesFiltered(e.filename),r={};r.employee=e.employee,r.localInterventionStatus=t.Intervention.interventionExecution,r.id=e.id,r.updateParams=[];const n={};return n.keyValue=e.key,n.propertyParams=[],n.propertyParams.push({propertyName:"value",propertyValue:JSON.stringify(s)}),r.updateParams.push(n),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"PreRisk",workorder:a.sapWorkOrder,key:e.key,bindingKey:e.key,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}),s},createTaskImagePayload(e){const t=X(),a={};a.employee=e.employee,a.localInterventionStatus=t.Intervention.interventionExecution,a.id=e.id,a.updateParams=[];const s={};return s.keyValue=e.key,s.propertyParams=[],s.propertyParams.push({propertyName:e.type,propertyValue:JSON.stringify(e.files)}),a.updateParams.push(s),a},updatePreRiskImagePayload(e){const t=X(),a={};return a.employee=e.employee,a.localInterventionStatus=t.Intervention.interventionExecution,a.id=e.id,a.updateParams=[],e.key,a},async createTaskImage(e){const a=X().Intervention,s=this.createTaskImagePayload(e),r=u.pendingTask.where({module:"Intervention",type:"General",key:e.key,itemKey:`${a.sapWorkOrder}-ImageEquipment`,workorder:a.sapWorkOrder,syncStatus:"Pending"});r&&await r.delete(),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:a.sapWorkOrder,key:e.key,bindingKey:e.key,itemKey:`${a.sapWorkOrder}-ImageEquipment`,payload:JSON.stringify(s),syncDate:re(),syncStatus:"Pending"});for(const[n,i]of e.blobs.entries()){const o={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[n].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[n].filename,originalFilename:e.files[n].filename,blob:i,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",o)}},async storeImageLocal(e){const a=X().Intervention;if(await u.pendingTaskFile.get({filename:e.files[0].filename}))return;const r={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[0].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[0].filename,originalFilename:e.files[0].filename,blob:e.blobs[0],syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",r)},async storeImageToServer(e){try{await g.post(Ot,e)}catch(t){A("IRONS",t),console.log(t)}},async storeImageBlobToServer(e,t=void 0){const a={ver:"v1",userAccount:this.authStore.user.Email};let s="";try{await g.post(`${ns}?${new URLSearchParams(a).toString()}`,e),s="Sync"}catch(r){s="Failed",A("IRONS",r)}finally{t&&(t.syncDate=re(),t.syncStatus=s,await Me(u,"pendingTaskFile",t))}},async updateEquipmentImage(e){const t=X();await this.createTaskImage(e),await t.updateEquipmentImageData(e)},async updateRiskAssesmentImage(e,t){const a=X(),s=await this.createTaskPreRisk(e);t&&this.createLogTask(this.stateLog,e.employee),await a.updateRiskAssesmentImageData(s,this.stateLog)},async getExisitingSMU(e){const t={id:e.id,keyValue:e.key,propertyName:e.propertyName},a={ver:"v1"};return(await g.post(`${ei}?${new URLSearchParams(a).toString()}`,t)).data.result.content??""},createUpdateSMUPayload(e){const t={};t.employee=e.employee,t.localInterventionStatus=e.status,t.id=e.id,t.updateParams=[];const a={};a.keyValue=e.key,a.propertyParams=[];let s=this.Log.employee;return e.fitter&&(s=e.fitter),a.propertyParams.push({propertyName:"interventionSMU",propertyValue:e.value},{propertyName:"smuBy",propertyValue:e.value!==""?JSON.stringify(s):""},{propertyName:"smuDate",propertyValue:e.value!==""?e.submitDate:""},{propertyName:"updatedBy",propertyValue:e.value!==""?JSON.stringify(s):""},{propertyName:"updatedDate",propertyValue:e.value!==""?e.submitDate:""}),t.updateParams.push(a),t},async updateSMU(e){const t=X(),a=Fe(),s=t.Intervention,r=this.createUpdateSMUPayload(e);let n=this.Log.employee;if(e.fitter&&(n=e.fitter),ye()){const i=u.pendingTask.where({module:"Intervention",type:"General",key:e.key,workorder:s.sapWorkOrder,itemKey:`${s.sapWorkOrder}-SMU`,syncStatus:"Pending"});i&&await i.delete(),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:s.sapWorkOrder,key:e.key,bindingKey:e.key,itemKey:`${s.sapWorkOrder}-SMU`,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}),t.updateSMU({value:e.value,smuBy:n,smuDate:e.submitDate})}else{try{await a.SyncInterventionGeneralData(JSON.stringify(r))}catch{const o=u.pendingTask.where({module:"Intervention",type:"General",key:e.key,itemKey:`${s.sapWorkOrder}-SMU`,workorder:s.sapWorkOrder,syncStatus:"Pending"});o&&await o.delete(),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:s.sapWorkOrder,key:e.key,itemKey:`${s.sapWorkOrder}-SMU`,bindingKey:e.key,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"})}finally{const i=await this.getWorkOrderDetailById(s.keyPbi);i&&await u.interventionDetail.put(i)}t.updateSMU({value:e.value,smuBy:n,smuDate:e.submitDate})}},async createLogTask(e,t){const a=X(),s={};s.employee=t,s.localInterventionStatus=a.Intervention.interventionExecution,s.id=a.Intervention.id,s.updateParams=[];const r={};r.keyValue=a.Intervention.id,r.propertyParams=[],s.updateParams.push(r),this.createLogPayload(e,s),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:a.Intervention.sapWorkOrder,key:a.Intervention.id,bindingKey:a.Intervention.id,payload:JSON.stringify(s),syncDate:re(),syncStatus:"Pending"})},async submitGeneral(e){const t=X(),a=Fe(),s=t.Intervention,r=s.interventionExecution!="Open",n=this.createGeneralFormPayload(e,r);if(e.logs=this.createLogPayload(e.log,n),e.servicePersonnel=this.stateServicePersonnel,this.createServiceHistoryPayload(e.history,n),ye())await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:s.sapWorkOrder,key:e.key,bindingKey:e.key,payload:JSON.stringify(n),syncDate:re(),syncStatus:"Pending"}),await t.updateHeaderData(e);else try{await a.SyncInterventionGeneralData(JSON.stringify(n));const i=await this.getWorkOrderDetailById(s.keyPbi);await u.interventionDetail.put(i),await t.updateHeaderData(e)}catch(i){this.globalConnectionStore.checkIsErrorNoNetwork(i)&&(await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:s.sapWorkOrder,key:e.key,bindingKey:e.key,payload:JSON.stringify(n),syncDate:re(),syncStatus:"Pending"}),await t.updateHeaderData(e),this.stateGeneralSubmitted=!0)}this.stateGeneralSubmitted=!0},async UpdateServiceEndMechanic(e){const t=this.createFinishFormPayload(e),a=Fe();if(!ye())await a.SyncInterventionGeneralData(JSON.stringify(t));else{const r=X().Intervention;await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"General",workorder:r.sapWorkOrder,key:`FINISH-${e.id}`,bindingKey:`FINISH-${e.id}`,payload:JSON.stringify(t),syncDate:re(),syncStatus:"Pending"})}},async submitForm(e){Ye();const t=X(),a=Fe(),s=t.Intervention,r={};r.employee=e.employee,r.localInterventionStatus=e.status,r.id=e.id,r.updateParams=[];const n={};if(n.keyValue=e.id,n.propertyParams=[],n.propertyParams.push({propertyName:"interventionExecution",propertyValue:e.status}),n.propertyParams.push({propertyName:"serviceEnd",propertyValue:e.serviceEnd}),n.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(r.employee)}),n.propertyParams.push({propertyName:"updatedDate",propertyValue:e.serviceEnd}),n.propertyParams.push({propertyName:"additionalInformation",propertyValue:e.additionalInformation}),this.setServicePersonnelForPayload(e.serviceEnd),n.propertyParams.push({propertyName:"servicePersonnels",propertyValue:JSON.stringify(this.stateServicePersonnel)}),r.updateParams.push(n),this.createServiceHistoryPayload(e.history,r),ye())await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"SubmitGeneral",workorder:s.sapWorkOrder,key:`SUBMIT-${e.id}`,bindingKey:`SUBMIT-${e.id}`,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}),await t.updateHeaderDataWhenSubmitted(e);else try{await a.SyncInterventionGeneralData(JSON.stringify(r))}catch(i){this.globalConnectionStore.checkIsErrorNoNetwork(i)&&(await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"SubmitGeneral",workorder:s.sapWorkOrder,key:`SUBMIT-${e.id}`,bindingKey:`SUBMIT-${e.id}`,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}),await t.updateHeaderDataWhenSubmitted(e))}},async removeInterventionFromLocal(e){await u.interventionHeader.filter(t=>t.sapWorkOrder==e).delete(),await u.interventionDetail.filter(t=>t.sapWorkOrder==e).delete(),await u.interventionDefect.filter(t=>t.sapWorkorder==e).delete(),await u.taskImage.filter(t=>t.sapWorkorder==e).delete(),await u.pendingTaskFile.filter(t=>t.workorder==e&&t.module=="Intervention").delete()},setInterventionGeneralSubmited(e){this.stateGeneralSubmitted=e},async getSMUTolerance(){this.stateSMUToleranceNotMapped=!1;const e=async()=>{this.stateSMUTolerance={min:0,max:0},this.stateSMUToleranceNotMapped=!0;const t=C.clone(this.stateSMUTolerance);await u.smuTolerance.add(t),console.log("SMU tolerance not mapped on ADM")};if(ye()){const t=await u.smuTolerance.limit(1).first();t?this.stateSMUTolerance=t:e()}else{const t={Parameter:"",ParameterTo:"",ValueMin:"",ValueMinTo:"",ValueMax:"",ValueMaxTo:"",Uom:"",UomTo:"",StartDate:"",StartDateTo:"",EndDate:"",EndDateTo:"",Page:"1",PageSize:"1",Order:"",ver:"v1"};try{const s=(await g.get(es,"",new URLSearchParams(t).toString())).data.result.content[0];if(await u.smuTolerance.clear(),C.isUndefined(s))e();else if(s.isActive){this.stateSMUTolerance={min:Number(s.valueMin),max:Number(s.valueMax)};const r=C.clone(this.stateSMUTolerance);await u.smuTolerance.add(r)}else e()}catch(a){console.log("error get smu",a),e(),A("IRONS",a)}}},reset(){this.stateActiveFitter={},this.stateLog={},this.stateServicePersonnel={},this.stateServicePersonnels=[],this.stateGeneralSubmitted=!1}}}),Ka=Ne({id:"pendingTaskMonitorList",state:()=>({statePendingList:[],statePendingFileList:[],stateTaskList:[],stateTaskFileList:[],stateLoadingRetry:!1,statePendingListNew:[]}),getters:{dataTasks:e=>e.stateTaskList,fileTasks:e=>e.stateTaskFileList},actions:{async getPendingWOCount(){const e=await u.pendingTask.filter(a=>a.syncStatus!="Sync").toArray(),t=[];return e.forEach(a=>{t.includes(a.workorder)||t.push(a.workorder)}),t.length},async getPendingTaskList(){this.statePendingList=[];const e=(await u.pendingTask.toArray()).filter(r=>r.syncStatus!="Sync"),t=await u.serviceSheetDetail.toArray(),a=await u.interventionDetail.toArray(),s=[];e.forEach(r=>{s.includes(r.workorder)||s.push(r.workorder)}),s.forEach(r=>{let n=0;const i={};i.workOrder=r,e.forEach(o=>{if(o.workorder==r){if(!i.form)switch(o.module){case"serviceForm":i.form="Digital Service Form";break;case"Intervention":i.form="Component Intervention Form";break;default:i.form="";break}i.id=o.id,n++}}),i.pendingTask=n,this.statePendingList.push(i)}),this.statePendingList.forEach(async r=>{switch(r.form){case"Digital Service Form":t.forEach(n=>{n.general.workOrder==r.workOrder&&(r.equipment=n.general.equipment,r.psType=n.general.psTypeId)});break;case"Component Intervention Form":a.forEach(n=>{n.sapWorkOrder==r.workOrder&&(r.equipment=n.equipment,r.psType="")});break;default:r.equipment="",r.psType="";break}})},async getPendingFileTaskList(){this.statePendingFileList=[];const e=(await u.pendingTaskFile.toArray()).filter(r=>r.syncStatus!="Sync"),t=await u.serviceSheetDetail.toArray(),a=await u.interventionDetail.toArray(),s=[];e.forEach(r=>{s.includes(r.workorder)||s.push(r.workorder)}),s.forEach(r=>{let n=0;const i={};i.workOrder=r,e.forEach(o=>{if(o.workorder==r){if(!i.form)switch(o.module){case"serviceForm":i.form="Digital Service Form";break;case"Intervention":i.form="Component Intervention Form";break;default:i.form="";break}i.id=o.id,n++}}),i.pendingTask=n,this.statePendingFileList.push(i)}),this.statePendingFileList.forEach(async r=>{switch(r.form){case"Digital Service Form":t.forEach(n=>{n.general.workOrder==r.workOrder&&(r.equipment=n.general.equipment,r.psType=n.general.psTypeId)});break;case"Component Intervention Form":a.forEach(n=>{n.sapWorkOrder==r.workOrder&&(r.equipment=n.equipment,r.psType="")});break;default:r.equipment="",r.psType="";break}})},pendingList(){const e={};return this.statePendingList.forEach(t=>{const{workOrder:a,form:s,equipment:r,psType:n,pendingTask:i}=t,o=`${a}-${s}-${r}-${n}`;e[o]=Number(e[o]||0)+Number(i)}),this.statePendingFileList.forEach(t=>{const{workOrder:a,form:s,equipment:r,psType:n,pendingTask:i}=t,o=`${a}-${s}-${r}-${n}`;e[o]=Number(e[o]||0)+Number(i)}),Object.keys(e).map(t=>{const[a,s,r,n]=t.split("-");return{workOrder:a,form:s,equipment:r,psType:n,pendingTask:e[t]}})},getpendingList(){this.statePendingListNew=this.pendingList()},updatePendingList(e){let t=!1;this.statePendingListNew.forEach(a=>{if(a.workOrder==e&&a.pendingTask>0){a.pendingTask--,a.pendingTask==0&&(t=!0);return}}),t&&(this.statePendingListNew=this.statePendingListNew.filter(a=>a.workOrder!=e))},async getTaskList(){this.stateTaskList=(await u.pendingTask.toArray()).filter(e=>e.syncStatus!="Sync")},async getFileTaskList(){this.stateTaskFileList=(await u.pendingTaskFile.toArray()).filter(e=>e.syncStatus!="Sync")},async toggleLoadingRetry(e){this.stateLoadingRetry=e}}}),Wa=[Z.TASK_UPDATED_BY_OTHER,Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON,Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL,Z.SUBMITTED,Z.CLOSE],Fe=Ne({id:"InterventionFormSyncStore",state:()=>({stateInSync:!1,stateSyncTasks:[],stateKeys:[],stateInSyncBindingKeys:[]}),getters:{WorkOrder:e=>e.stateInSync,globalConnectionStore:()=>Ge()},actions:{async syncImageToBlobStorage(e,t){const a={ver:"v1",userAccount:t};try{return{status:!0,statusCode:(await g.post(`${ns}?${new URLSearchParams(a).toString()}`,e)).data.statusCode}}catch(s){return A("IRONS",s),{status:!1,statusCode:0,error:typeof s=="object"?s.message:s}}},async SyncInterventionGeneralData(e){const t=JSON.parse(e);try{const a=await g.post(Ot,t);if(a.data.result.isError)throw Wa.includes(a.data.result.message)?a.data.result.message:"error sync"}catch(a){const s=this.globalConnectionStore.checkIsErrorNoNetwork(a),r=a;throw A("IRONS",a),Wa.includes(r)||s?a:"error sync"}},async SyncServiceFormGeneralData(e){const t=JSON.parse(e),a=await g.post(Ha,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormSubmitGeneralData(e){const t=JSON.parse(e),a=await g.post(Ma,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionTaskData(e){const t=JSON.parse(e),a=[Z.TASK_UPDATED_BY_OTHER,Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON,Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL,Z.SUBMITTED,Z.CLOSE];try{const s=await g.post(Oa,t);if(s.data.result.isError)throw a.includes(s.data.result.message)?s.data.result.message:"error sync"}catch(s){A("IRONS",s);const r=s;throw a.includes(r)||this.globalConnectionStore.checkIsErrorNoNetwork(s)?s:"error sync"}},async SyncServiceFormTaskData(e){const t=JSON.parse(e),a=await g.post(Ba,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionDefectData(e){const t=JSON.parse(e),a=[Z.TASK_UPDATED_BY_OTHER,Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON,Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL,Z.SUBMITTED,Z.CLOSE];try{const s=await g.post(La,t);if(s.data.result.isError)throw a.includes(s.data.result.message)?s.data.result.message:"error sync"}catch(s){const r=this.globalConnectionStore.checkIsErrorNoNetwork(s),n=s;throw A("IRONS",s),a.includes(n)||r?s:"error sync"}},async SyncInterventionGenericDefectData(e){const t=JSON.parse(e);if((await g.post(mi,t)).data.result.isError)throw"error sync"},async SyncInterventionDefectDataDefectIdentified(e){const t=JSON.parse(e);if((await g.post(os,t)).data.result.isError)throw"error sync"},async SyncServiceFormDefectData(e){const t=JSON.parse(e),a=await g.post($a,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormMultipleDefectData(e){const t=JSON.parse(e),a=await g.post(Ua,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormFitterUpdateDefectData(e){const t=JSON.parse(e),a=await g.post(xa,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormUpdateGenericDefectData(e){const t=JSON.parse(e),a=await g.post(qa,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormPostCalibrationHeaderData(e){const t=JSON.parse(e),a=await g.post(Ja,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormPostCalibrationDetailData(e){const t=JSON.parse(e),a=await g.post(Ga,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionUpdateDefectData(e){const t=JSON.parse(e);if((await g.post(Ft,t)).data.result.isError)throw"error sync"},async SyncServiceFormUpdateDefectData(e){const t=JSON.parse(e),a=await g.post(pi,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionGeneralDataRetry(e){const t=JSON.parse(e),a=await g.post(Ot,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormGeneralDataRetry(e){const t=JSON.parse(e),a=await g.post(Ha,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormSubmitGeneralDataRetry(e){const t=JSON.parse(e),a=await g.post(Ma,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionTaskDataRetry(e){const t=JSON.parse(e),a=await g.post(Oa,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormTaskDataRetry(e){const t=JSON.parse(e),a=await g.post(Ba,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionDefectDataRetry(e){const t=JSON.parse(e),a=await g.post(La,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormDefectDataRetry(e){const t=JSON.parse(e),a=await g.post($a,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormUpdateGenericDefectDataRetry(e){const t=JSON.parse(e),a=await g.post(qa,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormDefectMultipleDataRetry(e){const t=JSON.parse(e),a=await g.post(Ua,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormFitterUpdateDefectDataRetry(e){const t=JSON.parse(e),a=await g.post(xa,t);if(a.data.result.isError)throw a.data.result.message},async SyncInterventionUpdateDefectDataRetry(e){const t=JSON.parse(e),a=await g.post(Ft,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormUpdateDefectDataRetry(e){const t=JSON.parse(e),a=await g.post(Ft,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormPostCalibrationHeaderDataRetry(e){const t=JSON.parse(e),a=await g.post(Ja,t);if(a.data.result.isError)throw a.data.result.message},async SyncServiceFormPostCalibrationDetailDataRetry(e){const t=JSON.parse(e),a=await g.post(Ga,t);if(a.data.result.isError)throw a.data.result.message},async RemoveTemplate(e,t){const a=ae(),s=JSON.parse(e);await u.interventionDetail.delete(s.id),await u.interventionHeader.filter(n=>n.sapWorkOrder==t).delete();const r=rt();a.user.SiteId&&await r.syncWorkOrders(a.user.SiteId)},async SyncDataInSequence(){if(this.stateInSyncBindingKeys.includes("GENERAL"))return;const e=await Us(u,"pendingTask",this.stateInSyncBindingKeys);if(!e||e.bindingKey.includes("SUBMIT")&&(await xt(u,"pendingTask")).filter(i=>i.workorder==e.workorder&&i.bindingKey!=e.bindingKey&&i.syncStatus=="Pending").length>0)return;this.stateInSyncBindingKeys.push(e.bindingKey);const a=(await xs(u,"pendingTask",[e.bindingKey])).filter(r=>r.workorder==e.workorder),s=await this.SyncProcess(a);return this.stateInSyncBindingKeys=this.stateInSyncBindingKeys.filter(r=>r!=e.bindingKey),s},async SyncProcess(e){let t=!1;const a=Ka(),s=C.cloneDeep(e);for(const r of s)try{switch(r.module){case"serviceForm":switch(r.type){case"General":case"PreRisk":await this.SyncServiceFormGeneralData(r.payload);break;case"SubmitGeneral":await this.SyncServiceFormSubmitGeneralData(r.payload);break;case"Task":case"CBMImage":await this.SyncServiceFormTaskData(r.payload);break;case"MultipleDefect":await this.SyncServiceFormMultipleDefectData(r.payload);break;case"Defect":{const n=JSON.parse(r.payload);!C.isUndefined(n.defectDetail)&&!C.isUndefined(n.defectDetail.type)&&n.defectDetail.type=="machineSMU"&&delete n.defectDetail.type,await this.SyncServiceFormDefectData(JSON.stringify(n));break}case"FitterUpdateDefect":await this.SyncServiceFormFitterUpdateDefectData(r.payload);break;case"UpdateDefect":await this.SyncServiceFormUpdateDefectData(r.payload);break;case"CalibrationHeader":await this.SyncServiceFormPostCalibrationHeaderData(r.payload);break;case"CalibrationDetail":await this.SyncServiceFormPostCalibrationDetailData(r.payload);break;case"GenericDefect":await this.SyncServiceFormUpdateGenericDefectData(r.payload);break}break;case"Intervention":switch(r.type){case"General":case"PreRisk":await this.SyncInterventionGeneralData(r.payload);break;case"SubmitGeneral":await this.SyncInterventionGeneralData(r.payload),await this.RemoveTemplate(r.payload,r.workorder);break;case"Task":case"CBMImage":await this.SyncInterventionTaskData(r.payload);break;case"Defect":await this.SyncInterventionDefectData(r.payload);break;case"DefectGeneric":await this.SyncInterventionGenericDefectData(r.payload);break;case"UpdateDefect":await this.SyncInterventionDefectDataDefectIdentified(r.payload);break}break;default:break}r.syncStatus="Sync",r.syncDate=re(),await Qe(u,"pendingTask",r),e.splice(0,1),await a.getPendingTaskList()}catch(n){const i=["Failed to update data, service sheet status is","Data already updated","Task already updated by other mechanic","You cannot modify the defect once already approved or declined by Supervisor","Machine SMU has been","Not applicable task has been","Resource with specified id or name already exists"],o=typeof n=="object"?n.message:n;let d=!1;if(i.forEach(c=>{o.includes(c)&&(d=!0)}),d){r.syncStatus="Sync",r.syncDate=re(),await Qe(u,"pendingTask",r),e.splice(0,1),await a.getPendingTaskList();return}for(const[c,p]of e.entries())c==0&&(p.errorMessage=typeof n=="object"?n.message:n),p.syncStatus="Failed",p.syncDate=re(),await Qe(u,"pendingTask",p);t=!0;break}finally{r.syncStatus=="Sync"&&a.getTaskList().then(()=>{a.updatePendingList(r.workorder)})}return t},async SyncData(){ye()||(this.stateKeys=await ka(u,"pendingTask"),await this.SyncDataInSequence())},async RetrySyncData(){if(ye())return;this.stateKeys=await ka(u,"pendingTask"),this.stateKeys||(this.stateInSync=!1,Sa(u,"syncProgress")),(await xt(u,"pendingTask")).filter(n=>n.syncStatus=="Failed").forEach(n=>{n.syncStatus="Pending",Qe(u,"pendingTask",n)}),(await xt(u,"pendingTaskFile")).filter(n=>n.syncStatus=="Failed").forEach(n=>{n.syncStatus="Pending",Qe(u,"pendingTaskFile",n)});const r=await this.SyncDataInSequence();return r||Sa(u,"syncProgress"),r},async SyncImage(){if(ye())return;const e=Ka(),t=await u.pendingTaskFile.where("syncStatus").equals("Pending").primaryKeys();if(!t||t.length==0)return;const a=await u.pendingTaskFile.get(t[0]);if(a)a.syncStatus="On Progress",await Qe(u,"pendingTaskFile",a);else return;const s={module:a.module,key:a.key,workorder:a.workorder,type:a.type,fileType:a.fileType,createdBy:a.createdBy,email:a.email,filename:a.filename,originalFilename:a.originalFilename,blob:a.blob,syncDate:re(),errorMessage:"",syncStatus:""},r=new FormData;r.append("files",a.blob,`${a.filename}.png`),r.append("userAccount",a.email);let n={};try{n=await this.syncImageToBlobStorage(r,a.email),s.syncStatus="Sync",(!n.status||n.statusCode!=200)&&(s.syncStatus="Failed",s.errorMessage=n.error),await u.pendingTaskFile.update(Number(a.id),s)}catch(i){console.log(i),s.syncStatus="Failed",s.errorMessage=i.toString(),await u.pendingTaskFile.update(Number(a.id),s)}finally{await e.getPendingFileTaskList(),e.getFileTaskList().then(()=>{e.updatePendingList(a.workorder)})}},async GetRetryTasks(e){return await u.retryTask.where("workorder").equals(e).toArray()},async RetrySync(e,t){return{no:t+1,key:e.key,type:e.type,result:"OK"}},async RevokeSync(e){await u.retryTask.where("workorder").equals(e).delete()}}});class Ya{constructor(){this.smuDefectHeaders=[],this.defectHeaders=[],this.defectGenericHeaders=[],this.crackHeaders=[],this.cbmHeaders=[],this.defectNAHeaders=[],this.crackNAHeaders=[]}setSMUDefectHeaders(t){this.smuDefectHeaders=C.filter(t,a=>a.defectType=="machineSMU")}setDefectHeaders(t){this.defectHeaders=C.filter(t,a=>a.category==="NORMAL"&&a.taskValue==="3"),this.defectHeaders=C.orderBy(this.defectHeaders,[a=>a.priority,a=>{var s;return Number((s=a.taskNo)==null?void 0:s.replaceAll(/[a-zA-Z]/g,""))},a=>a.taskDesc])}setDefectGenericHeaders(t){this.defectGenericHeaders=C.filter(t,a=>a.category==="NORMAL"&&a.defectType=="Generic"),this.defectGenericHeaders=C.orderBy(this.defectGenericHeaders,[a=>a.priority,a=>{var s;return Number((s=a.taskNo)==null?void 0:s.replaceAll(/[a-zA-Z]/g,""))},a=>a.taskDesc])}setCrackHeaders(t){const a=["2","3"];this.crackHeaders=C.filter(t,s=>s.category==="CRACK"&&a.includes(s.taskValue)),this.crackHeaders=C.orderBy(this.crackHeaders,[s=>s.priority,s=>{var r;return Number((r=s.taskNo)==null?void 0:r.replaceAll(/[a-zA-Z]/g,""))},s=>s.taskDesc])}setCBMHeaders(t){this.cbmHeaders=C.filter(t,a=>["CBM","CBM-NORMAL"].includes(a.category)&&isNaN(Number(a.taskValue))),this.cbmHeaders=C.orderBy(this.cbmHeaders,[a=>{let s=0;if(a.taskNo&&isNaN(Number(a.taskNo))){let r="",n=!0;for(let o=0;o<a.taskNo.length;o++)n&&isNaN(Number(a.taskNo.charAt(o)))&&(r=a.taskNo.charAt(o),n=!1);return Number(a.taskNo.split(r)[0])}else s=Number(a.taskNo);return s},a=>a.taskNo])}setDefectNAHeaders(t){this.defectNAHeaders=C.filter(t,a=>(a.category==="NORMAL"||a.category==="CBM")&&a.taskValue==="4"),this.defectNAHeaders=C.orderBy(this.defectNAHeaders,[a=>{var s;return Number((s=a.taskNo)==null?void 0:s.replaceAll(/[a-zA-Z_;]/g,""))},a=>a.taskDesc])}setCrackNAHeaders(t){this.crackNAHeaders=C.filter(t,a=>a.category==="CRACK"&&a.taskValue==="4"),this.crackNAHeaders=C.orderBy(this.crackNAHeaders,[a=>{var s;return Number((s=a.taskNo)==null?void 0:s.replaceAll(/[a-zA-Z_;]/g,""))},a=>a.taskDesc])}orderDetailTaskCBM(){this.cbmHeaders=this.cbmHeaders.sort((t,a)=>{const s=t.taskNo,r=a.taskNo;return s.localeCompare(r,"en",{numeric:!0})})}setHeaders(t){this.setSMUDefectHeaders(t),this.setDefectHeaders(t),this.setDefectGenericHeaders(t),this.setCrackHeaders(t),this.setCBMHeaders(t),this.orderDetailTaskCBM(),this.setDefectNAHeaders(t),this.setCrackNAHeaders(t)}get DefectSMUHeaders(){return this.smuDefectHeaders}get DefectHeaders(){return this.defectHeaders}get DefectGenericHeaders(){return this.defectGenericHeaders}get CrackHeaders(){return this.crackHeaders}get CBMHeaders(){return this.cbmHeaders}get DefectNAHeaders(){return this.defectNAHeaders}get CrackNAHeaders(){return this.crackNAHeaders}}const yi=async e=>{const t=await u.interventionComment.where({workOrder:e});t&&t.delete()},Be=Ne({id:"Component Intervention Defects Identified",state:()=>({stateLoading:!1,stateData:new Ya,stateDefectHeader:[],stateDefectDetail:[],stateComments:[],stateApproveBy:void 0,stateApproveDate:void 0,stateDefectFormData:new ze,stateSelectedDetailData:{}}),getters:{Loading:e=>e.stateLoading,defectIdentifiedData:e=>e.stateData,defectEditFormData:e=>e.stateDefectFormData,defectIdentifiedCommentData:e=>e.stateComments,ApproveBy:e=>e.stateApproveBy,ApproveDate:e=>e.stateApproveDate,DefectDetail:e=>e.stateDefectDetail},actions:{createRequestBody(e){return{interventionId:e}},async setDefectIdentifiedData(e){const t=await u.interventionDefect.filter(a=>a.sapWorkorder==e).toArray();this.stateData.setHeaders(t);for(const a of t){const s=this.stateDefectDetail.find(r=>a.defectDetailId==r.id);s&&a.otherFitterUpdatedBy&&(s.otherFitterUpdatedBy=a.otherFitterUpdatedBy)}},async getDefectsDataHeader(e){const t=this.createRequestBody(e),a=await g.post(`${ni}`,t);this.stateDefectHeader=a.data.result.content},async getDefectsDataDetail(e){const t=this.createRequestBody(e),a=await g.post(`${oi}`,t);this.stateDefectDetail=a.data.result.content},async getDefectsDataAll(e){var s,r,n,i,o;const t={interventionId:e,ver:"v1"},a=await g.get(`${di}`,"",new URLSearchParams(t).toString());this.stateDefectHeader=((s=a.data.result.content)==null?void 0:s.defectHeader)||[],this.stateDefectDetail=((r=a.data.result.content)==null?void 0:r.defectDetail)||[],this.stateComments=((n=a.data.result.content)==null?void 0:n.comment)||[],this.stateApproveBy=(i=a.data.result.content)==null?void 0:i.approveBy,this.stateApproveDate=(o=a.data.result.content)==null?void 0:o.approveDate},async getDefectsData(e,t){if(!t)return;if(this.stateLoading=!0,(await u.pendingTask.where({workorder:t,module:"Intervention",syncStatus:"Pending"}).toArray()).length>0)this.setDefectIdentifiedData(t);else try{ye()||(await u.interventionDefect.where({sapWorkorder:t}).delete(),await this.getDefectsDataAll(e),await this.upsertDefectToLocal(e),this.setDefectIdentifiedData(t))}catch(s){console.error(s),Q(s)}this.stateLoading=!1},async upsertDefectToLocal(e){await u.interventionDefect.where({interventionId:e}).delete(),this.stateDefectHeader.forEach(async t=>{var s;const a=this.stateDefectDetail.find(r=>r.defectHeaderId==t.id);await u.interventionDefect.add({category:t.category,interventionId:e,taskId:t.taskId,taskNo:t.taskNo,taskDesc:t.taskDesc,taskValue:t.taskValue,priority:(s=a==null?void 0:a.detail)==null?void 0:s.priority,sapWorkorder:t.workorder,taskKey:t.taskId,type:a==null?"CBM":a.detail.type,defectHeaderId:t.id,defectType:t.defectType,defectDetailId:a==null?void 0:a.id,defectWorkorder:t.defectWorkorder??"",defectData:a==null?"":JSON.stringify({...a.detail,headerKey:t.key,createdBy:a.createdBy?{id:a.createdBy.id,name:a.createdBy.name}:{},createdDate:a.createdDate?a.createdDate:"",updatedBy:a.updatedBy?{id:a.updatedBy.id,name:a.updatedBy.name}:{},updatedDate:a.updatedDate}),commentValue:t.commentValue,status:t.status,repairedStatus:t.repairedStatus,cbmNAStatus:t.cbmNAStatus,cbmUom:t.cbmUom,cbmMeasurement:t.cbmMeasurement??void 0,plannerStatus:t.plannerStatus?t.plannerStatus:"",declineReason:t.declineReason?t.declineReason:"",declineBy:t.declineBy?{id:t.declineBy.id,name:t.declineBy.name}:{},declineDate:t.declineDate?t.declineDate:"",approvedBy:t.approvedBy?{id:t.approvedBy.id,name:t.approvedBy.name}:{},approvedDate:t.approvedDate?t.approvedDate:"",statusSync:"Sync",createdBy:t.createdBy?{id:t.createdBy.id,name:t.createdBy.name}:{},createdDate:t.createdDate,updatedBy:t.updatedBy?{id:t.updatedBy.id,name:t.updatedBy.name}:{},updatedDate:t.updatedDate,downloadHistory:t.downloadHistory?JSON.stringify(t.downloadHistory):"",correctedValue:t.correctedValue?t.correctedValue:"",correctedMeasurement:t.correctedMeasurement?t.correctedMeasurement:"",correctedUom:t.correctedUom?t.correctedUom:"",approveReason:t.approveReason?t.approveReason:"",plannerApproveReason:t.plannerApproveReason?t.plannerApproveReason:""})}),this.stateComments.forEach(async t=>{await u.interventionComment.add({taskKey:t.taskKey,taskDesc:t.taskDesc,taskComment:t.taskComment,workOrder:t.workOrder,createdBy:t.createdBy?{id:t.createdBy.id,name:t.createdBy.name}:{},createdDate:t.createdDate,updatedBy:t.updatedBy?{id:t.updatedBy.id,name:t.updatedBy.name}:{},updatedDate:t.updatedDate})})},createDefectYesUpdatePayload(e){const t={};t.id=this.stateSelectedDetailData.id;const a={};a.type="YES",a.isNeed30Minutes=this.stateDefectFormData.IsNeed30Minutes,a.assetNumber=this.stateDefectFormData.AssetNumber,a.description=this.stateDefectFormData.Description.value,a.raisedBy=this.stateDefectFormData.RaisedBy,a.plannedDuration=this.stateDefectFormData.PlannedDuration.value,a.instruction=this.stateDefectFormData.Instruction.value,a.priority=this.stateDefectFormData.Priority,a.parts=JSON.stringify(this.stateDefectFormData.Parts),a.labours=JSON.stringify(this.stateDefectFormData.Labours),a.resources=JSON.stringify(this.stateDefectFormData.Resources),a.symptoms=JSON.stringify(this.stateDefectFormData.Symptoms.map(r=>r.value)),a.causes=JSON.stringify(this.stateDefectFormData.Causes.map(r=>r.value)),t.updateParams=[],t.updateParams.push({keyValue:this.stateSelectedDetailData.key,propertyParams:[{propertyName:"detail",propertyValue:JSON.stringify(a)},{propertyName:"updateBy",propertyValue:JSON.stringify(e)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),t.employee=e;const s=X();return t.localInterventionStatus=s.Intervention.interventionExecution,t},async updateDefectDetail(e){const t=this.createDefectYesUpdatePayload(e);try{ye()||await g.post(`${Ft}`,t)}catch(a){Q(a),A("IRONS",a),console.log(a)}},async updateDownloadHistory(e){let t;if(e.type=="defect"?t=this.stateData.DefectHeaders.find(s=>s.id===e.headerId):e.type=="defectGeneric"&&(t=this.stateData.DefectGenericHeaders.find(s=>s.id===e.headerId)),!t)return;const a={id:t.defectHeaderId,updateParams:[{keyValue:t.defectDetailId,propertyParams:[{propertyName:"downloadHistory",propertyValue:!0},{propertyName:"updatedBy",propertyValue:JSON.stringify(e.employee)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:e.employee};try{if(await g.post(`${ls}`,a),t.downloadHistory){const s=JSON.parse(t.downloadHistory);s.push({downloadBy:e.employee}),t.downloadHistory=JSON.stringify(s)}else t.downloadHistory=JSON.stringify([{downloadBy:e.employee}])}catch(s){Q(s),A("IRONS",s),console.log(s)}},getDefectDetailData(e){const t=this.stateData.DefectHeaders.find(a=>a.taskId==e);return t?(t.type=="YES",JSON.parse(t.defectData)):null},getDefectGenericData(e){return this.stateData.DefectGenericHeaders.find(a=>a.defectHeaderId==e)},getDefectHeaderDetailData(e){const t=this.stateData.DefectHeaders.find(a=>a.id==e);if(t){const a=JSON.parse(t.defectData),s={...t};return delete s.defectData,{header:s,detail:a}}return null},getDefectGenericHeaderDetailData(e){const t=this.stateData.DefectGenericHeaders.find(a=>a.id==e);if(t){const a=JSON.parse(t.defectData),s={...t};return delete s.defectData,{header:s,detail:a}}return null},getNADetailData(e){const t=this.stateData.DefectNAHeaders.find(a=>a.taskId==e);return t||null},getCBMDetailData(e){const t=this.stateData.CBMHeaders.find(a=>a.taskId==e);return t||null},reset(){this.stateLoading=!1,this.stateData=new Ya,this.stateDefectHeader=[],this.stateDefectDetail=[],this.stateDefectFormData=new ze,this.stateSelectedDetailData={},this.stateComments=[]},async getCommentFromServiceSheet(e){await yi(e);const t=await u.interventionDetail.where({sapWorkOrder:e}).first();if(!t)return;console.log("serviceSheet",t);for(const s of t.details)for(const r of s.tasks)for(const n of r.tasks)if(n.taskValue)if(n!=null&&n.adjustment){const i=n.adjustment;if(i.commentValue){const o=await u.interventionDefect.where({sapWorkorder:e,taskKey:n.key}).first();if(o){const d=!o.commentValue,c=o.commentValue!=i.commentValue;(d||c)&&(o.commentValue=i.commentValue),await u.interventionDefect.update(Number(o.id),o)}else{const d=await u.interventionComment.where({workOrder:e,taskKey:n.key}).first();d?(d.taskComment=i.commentValue,await u.interventionComment.update(Number(n.key),d)):await u.interventionComment.add({taskKey:n.key,taskDesc:n.description,taskComment:i.commentValue,workOrder:e,createdBy:n.updatedBy,createdDate:(n==null?void 0:n.updatedDate)||"",updatedBy:n.updatedBy,updatedDate:(n==null?void 0:n.updatedDate)||""})}}else{const o=await u.interventionDefect.where({sapWorkorder:e,taskKey:n.key}).first();o&&(o!=null&&o.commentValue&&(o.commentValue=""),await u.interventionDefect.update(Number(o.id),o))}}else for(const i of n.items){const o=i.itemType=="input",d=i.value,c=(i==null?void 0:i.valueItemType)=="comment";if(o&&d&&c){const p=await u.interventionDefect.where({sapWorkorder:e,taskKey:n.key}).first();if(p){const f=p.commentValue=="undefined",I=p.commentValue!=i.value;(f||I)&&(p.commentValue=i.value,await u.interventionDefect.update(Number(p.id),p))}else{const f=await u.interventionComment.where({workOrder:e,taskKey:n.key}).first();f?(f==null?void 0:f.taskComment)!=i.value&&(f.taskComment=i.value,await u.interventionComment.update(Number(n.key),f)):await u.interventionComment.add({taskKey:n.key,taskDesc:n.description,taskComment:i.value,workOrder:e,createdBy:n.updatedBy,createdDate:(n==null?void 0:n.updatedDate)||"",updatedBy:n.updatedBy,updatedDate:(n==null?void 0:n.updatedDate)||""})}}}const a=await u.interventionComment.where({workOrder:e}).toArray();await this.setDefectIdentifiedData(e),this.stateComments=a}}}),hi="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/task_cbm_default_value",vi=`${hi}/get_data_list_by_param`,gi=e=>{let t=0,a=0;return e.forEach(s=>{s.tasks.forEach(r=>{const n=r.tasks.filter(i=>!C.isUndefined(i.taskValue));t=t+n.length,n.forEach(i=>{i.taskValue&&(a=a+1)})})}),t==0?100:C.floor(a/t*100)},X=Ne({id:"ComponentInterventionDetailStore",state:()=>({stateSelectedIntervention:{},stateGroups:[],stateSelectedGroup:{},stateSelectedTask:{},stateIdentifiedDefectCount:0,stateLoadingTask:{},stateItemTriggerDisabledValue:{},stateItemKeyWithTriggeredDisabledKey:{},stateIsError:!1,stateTaskErrorDialog:!1,stateErrorMessageTaskErrorDialog:"",stateSerialNumber:"",stateFormSubmittedDialog:!1,stateFormCloseDialog:!1}),getters:{Intervention:e=>e.stateSelectedIntervention,Groups:e=>e.stateGroups,Group:e=>e.stateSelectedGroup,Task:e=>e.stateSelectedTask,CountIdentifiedDefect:e=>e.stateIdentifiedDefectCount,TaskProgress:e=>{const t=[];return C.isEmpty(e.stateSelectedIntervention)||e.stateSelectedIntervention.details.forEach(a=>{let s=0,r=0;a.tasks.forEach(n=>{const i=n.tasks.filter(o=>!C.isUndefined(o.taskValue));r=r+i.length,i.forEach(o=>{o.taskValue&&(s=s+1)})}),t.push({key:a.key,taskDone:s,taskTotal:r})}),t},LoadingTask:e=>e.stateLoadingTask,ItemTriggerDisabledValue:e=>e.stateItemTriggerDisabledValue,IsFilledAllRequiredItem:e=>{var a,s,r,n;let t=!0;return C.isUndefined((a=e.stateSelectedIntervention)==null?void 0:a.details)||(n=(r=(s=e.stateSelectedIntervention)==null?void 0:s.details[0])==null?void 0:r.tasks)==null||n.every(i=>(i.tasks.every(o=>(o.items.every(d=>d.customValidation=="Required"&&d.value==""?(t=!1,!1):!0),t!=!1)),t!=!1)),t},IsError:e=>e.stateIsError,percentageTaskProgressAllTab:e=>gi(e.stateSelectedIntervention.details||[]),RiskAssessmentImages:e=>{let t=[];if(!e.stateSelectedIntervention||!e.stateSelectedIntervention.riskAssesment||!Array.isArray(e.stateSelectedIntervention.riskAssesment))return t;const a=e.stateSelectedIntervention.riskAssesment[0].value;return typeof a=="string"||(t=a),t},taskErrorDialog:e=>e.stateTaskErrorDialog,errorMessageTaskErrorDialog:e=>e.stateErrorMessageTaskErrorDialog,serialNumber:e=>e.stateSerialNumber,formSubmittedDialog:e=>e.stateFormSubmittedDialog,formCloseDialog:e=>e.stateFormCloseDialog,globalConnectionStore:()=>Ge()},actions:{updateLoading(e,t=!1){this.stateLoadingTask[e]=t},resetLoading(){this.stateLoadingTask={}},toogleTaskErrorDialog(e){this.stateTaskErrorDialog=e},toogleFormSubmittedDialog(e){this.stateFormSubmittedDialog=e},toogleFormCloseDialog(e){this.stateFormCloseDialog=e},setItemTriggerDisabledValue(e){e.details[0].tasks.forEach(t=>{t.tasks.forEach(a=>{a.items.forEach(s=>{s.disabledByItemKey&&(s.disabledByItemKey in this.stateItemTriggerDisabledValue||(this.stateItemTriggerDisabledValue[s.disabledByItemKey]="",this.stateItemKeyWithTriggeredDisabledKey[s.key]=s.disabledByItemKey))})})}),e.details[0].tasks.forEach(t=>{t.tasks.forEach(a=>{a.items.forEach(s=>{s.key in this.stateItemTriggerDisabledValue&&(this.stateItemTriggerDisabledValue[s.key]=s.value)})})})},checkHmOffset(e){switch(e.hmOffset){case void 0:this.stateSelectedIntervention.hmOffset="Not Applicable";break;case"":this.stateSelectedIntervention.hmOffset="0";break}},setGroup(e){this.stateSelectedIntervention=e,this.checkHmOffset(e);let t=2;this.stateGroups=[{sequence:1,group:"General",sections:[],key:e.id}],this.stateSelectedIntervention.details.forEach(a=>{this.stateGroups.push({sequence:t++,group:a.group,sections:a.tasks,key:a.key})}),this.stateGroups.push({sequence:t++,group:"Identified Defects",sections:[],key:"Identified Defects"})},setSelectedGroup(e){this.stateSelectedGroup=e},initGroup(e,t=0){this.setGroup(e),this.stateItemTriggerDisabledValue={},this.stateItemKeyWithTriggeredDisabledKey={},this.setItemTriggerDisabledValue(e),this.setSelectedGroup(this.stateGroups[t])},setSelectedTask(e){this.stateSelectedTask=e},resetIntervention(){this.stateSelectedIntervention={},this.stateFormCloseDialog=!1,this.stateFormSubmittedDialog=!1},getTaskById(e){let t;return this.Intervention.details[0].tasks.forEach(a=>{a.tasks.forEach(s=>{s.key==e&&(t=s)})}),t},createTaskUpdatePayload(e,t=!1){const a=X(),s={};s.employee=e.employee,s.localInterventionStatus=a.Intervention.interventionExecution,s.headerId=e.id,s.id=e.id,s.updateParams=[];const r={};if(r.keyValue=e.itemKey,r.propertyParams=[],e.taskCategory=="Adjustment"){let i="";switch(e.type){case"rating":i="rating";break;case"inputUom":i="measurement";break;case"commentValue":i="commentValue";break}r.propertyParams.push({propertyName:i,propertyValue:e.value}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:e.isOutOfRange?"":JSON.stringify(e.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:e.isOutOfRange?"":e.timeStamp})}else r.propertyParams.push({propertyName:"value",propertyValue:e.value}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:e.timeStamp});s.updateParams.push(r);const n=e.task.rating=="AUTOMATIC_REPLACEMENT"||e.task.rating=="AUTOMATIC_REPLACEMENT_GAP";if((e.type=="condition"||e.type=="rating"&&!n)&&!t){const i={};i.keyValue=e.taskKey,i.propertyParams=[],i.propertyParams.push({propertyName:"taskValue",propertyValue:e.value}),i.propertyParams.push({propertyName:"updatedBy",propertyValue:e.value?JSON.stringify(e.employee):""}),i.propertyParams.push({propertyName:"updatedDate",propertyValue:e.value?e.timeStamp:""});const o=e.reason||"";e.task.taskValue=="4"?i.propertyParams.push({propertyName:"reason",propertyValue:o}):i.propertyParams.push({propertyName:"reason",propertyValue:""}),(e.task.rating=="AUTOMATIC_REPLACEMENT"||e.task.rating=="AUTOMATIC_REPLACEMENT_GAP")&&e.type=="condition"&&i.propertyParams.push({propertyName:"taskNormalValue",propertyValue:e.value}),s.updateParams.push(i)}if(e.taskCategory=="CBM"&&(e.task.rating=="NORMAL"||e.task.rating=="AUTOMATIC_REPLACEMENT"||e.task.rating=="AUTOMATIC_REPLACEMENT_GAP")){const i={};if(i.keyValue=e.taskKey,i.propertyParams=[],e.task.rating=="NORMAL"&&i.propertyParams.push({propertyName:"taskNormalValue",propertyValue:e.type=="rating"?"":e.value}),i.propertyParams.length>0&&s.updateParams.push(i),e.task.rating=="NORMAL"){const o=e.task.items.find(d=>(e.type=="rating"&&d.valueItemType=="condition"||e.type=="condition"&&d.valueItemType=="rating")&&d.itemType=="dropDown");if(o){const d={};d.keyValue=o.key,d.propertyParams=[],d.propertyParams.push({propertyName:"value",propertyValue:""}),d.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.employee)}),d.propertyParams.push({propertyName:"updatedDate",propertyValue:e.timeStamp}),s.updateParams.push(d)}}}return e.value=="4"&&Object.keys(this.stateItemKeyWithTriggeredDisabledKey).filter(o=>this.stateItemKeyWithTriggeredDisabledKey[o]===e.itemKey).forEach(o=>{const d={};d.keyValue=o,d.propertyParams=[],d.propertyParams.push({propertyName:"value",propertyValue:""}),d.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.employee)}),d.propertyParams.push({propertyName:"updatedDate",propertyValue:e.timeStamp}),s.updateParams.push(d)}),s.workOrder=e.workOrder,s},createResetTaskAdjustmentPayload(e){const t=X(),a={};a.employee=e.employee,a.localInterventionStatus=t.Intervention.interventionExecution,a.headerId=e.id,a.id=e.id,a.updateParams=[];const s={};return s.keyValue=e.itemKey,s.propertyParams=[],s.propertyParams.push({propertyName:"measurement",propertyValue:""}),s.propertyParams.push({propertyName:"rating",propertyValue:""}),s.propertyParams.push({propertyName:"updatedBy",propertyValue:""}),s.propertyParams.push({propertyName:"updatedDate",propertyValue:""}),s.propertyParams.push({propertyName:"commentValue",propertyValue:""}),a.updateParams.push(s),a.workOrder=e.workOrder,a},async updateHeaderData(e){(this.stateSelectedIntervention.interventionSMU==""||this.stateSelectedIntervention.interventionSMU==null)&&(this.stateSelectedIntervention.interventionSMU=e.smu.replaceAll(",","")),this.stateSelectedIntervention.serviceStart==""&&(this.stateSelectedIntervention.serviceStart=e.serviceStart),this.stateSelectedIntervention.log=e.logs,this.stateSelectedIntervention.interventionExecution=e.status,this.stateSelectedIntervention.supervisor=e.employee,this.stateSelectedIntervention.updatedBy=e.log.employee,this.stateSelectedIntervention.statusHistory.push(e.history),await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async updateEquipmentImageData(e){const t=[];this.stateSelectedIntervention.imageEquipment=[...t,...e.files],this.stateSelectedIntervention.supervisor=e.employee,this.stateSelectedIntervention.updatedBy=e.employee,await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async deleteImageFromEquipmentImage(e){let t=this.stateSelectedIntervention.imageEquipment?this.stateSelectedIntervention.imageEquipment:[];t=t.filter(a=>a!=e),this.stateSelectedIntervention.imageEquipment=t,await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async updateRiskAssesmentImageData(e,t){var s;const a=(s=this.stateSelectedIntervention.log)==null?void 0:s.find(r=>r.employee.id==t.employee.id);a?(a.timeLoggedIn.push(t.timeLoggedIn),a.riskPhotos=[],a.isIHaveReadChecked=!0):(this.stateSelectedIntervention.log==null&&(this.stateSelectedIntervention.log=[]),this.stateSelectedIntervention.log.push({employee:t.employee,timeLoggedIn:[t.timeLoggedIn],shift:t.shift,isIHaveReadChecked:!0,riskPhotos:[]})),this.stateSelectedIntervention.riskAssesment[0].value=e,await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async deleteRiskAssesmentImage(e,t){var s;const a=(s=this.stateSelectedIntervention.log)==null?void 0:s.find(r=>r.employee.id==t.employee.id);a&&(a.riskPhotos=Re(a.riskPhotos)),this.stateSelectedIntervention.riskAssesment[0].value=this.stateSelectedIntervention.riskAssesment[0].value.filter(r=>r.image.filename!=e),await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async updateHeaderDataWhenSubmitted(e){this.stateSelectedIntervention.interventionExecution=e.status,this.stateSelectedIntervention.updatedBy=e.employee,this.stateSelectedIntervention.statusHistory.push(e.history),await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},async updateLocalData(e){const t=C.cloneDeep(e.task),a=this.stateSelectedIntervention.details[0].tasks;let s;if(a.every(n=>(s=n.tasks.find(i=>i.key==e.taskKey),!s)),!s)return;if(e.taskCategory=="Adjustment"){const n=s.adjustment;e.type=="rating"?n.rating=e.value:e.type=="inputUom"&&(n.measurement=e.value),n.updatedBy=e.employee,n.updatedDate=e.timeStamp}else{if((e.type=="condition"||e.type=="rating")&&(s.taskValue=e.value,s.updatedBy=e.employee,s.updatedDate=e.timeStamp,s.reason=e.reason||"",t.reason&&(s.reason=t.reason),(s.taskNormalValue||s.taskNormalValue=="")&&e.type=="condition"&&(s.taskNormalValue=e.value),e.taskCategory=="CBM-NORMAL"||e.task.category=="CBM"&&e.task.rating=="NORMAL"))if(e.type=="condition"){const i=s.items.find(o=>o.valueItemType=="rating");if(!i)return;i.value="",i.updatedBy=e.employee,i.updatedDate=e.timeStamp,e.task.images=""}else{const i=s.items.find(o=>o.valueItemType=="condition");if(!i){if(e.type=="rating"){const o=s.items.find(d=>d.valueItemType=="rating");if(!o)return;o.value=e.value,o.updatedBy=e.employee,o.updatedDate=e.timeStamp}return}i.value="",i.updatedBy=e.employee,i.updatedDate=e.timeStamp}if(e.type=="images"){s.images=e.value,await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention));return}const n=s.items.find(i=>i.key==e.itemKey);if(!n)return;n.value=e.value,n.updatedBy=e.employee,n.updatedDate=e.timeStamp,e.value=="4"&&Object.keys(this.stateItemKeyWithTriggeredDisabledKey).filter(o=>this.stateItemKeyWithTriggeredDisabledKey[o]===e.itemKey).forEach(o=>{const d=s&&s.items.find(c=>c.key==o);d&&(d.value="",d.updatedBy=e.employee,d.updatedDate=e.timeStamp)})}await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention)),Be().setDefectIdentifiedData(this.Intervention.sapWorkOrder)},async updateLocalTaskCBMImageData(e){const t=this.stateSelectedIntervention.details[0].tasks;let a;t.every(s=>(a=s.tasks.find(r=>r.key==e.taskKey),!a)),a&&(a.images=JSON.parse(e.value),await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention)))},async updateLocalAutoCBM(e){const t=this.stateSelectedIntervention.details[0].tasks;let a;if(t.every(r=>(a=r.tasks.find(n=>n.key==e.taskKey),!a)),!a)return;const s=a.items.find(r=>r.categoryItemType=="targetRating");s&&(s.value=e.value,s.updatedBy=e.value?e.employee:"",s.updatedDate=e.value?e.timeStamp:"",localStorage.setItem("itemKey",s.key))},async appendTaskUpdatePayload(e,t,a,s=!1){var i;const r={};if(r.keyValue=t.itemKey,r.propertyParams=[],t.taskCategory=="Adjustment"){let o="";switch(t.type){case"rating":o="rating";break;case"inputUom":o="measurement";break;case"commentValue":o="commentValue";break}r.propertyParams.push({propertyName:o,propertyValue:t.value});const d=t.type=="rating"&&t.value=="";r.propertyParams.push({propertyName:"updatedBy",propertyValue:d?"":JSON.stringify(t.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:d?"":t.timeStamp})}else r.propertyParams.push({propertyName:"value",propertyValue:t.value}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(t.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:t.timeStamp});if(e.updateParams.push(r),(t.type=="condition"||t.type=="rating")&&!a){const o={};o.keyValue=t.taskKey,o.propertyParams=[],o.propertyParams.push({propertyName:"taskValue",propertyValue:t.value}),o.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(t.employee)}),o.propertyParams.push({propertyName:"updatedDate",propertyValue:t.timeStamp}),e.updateParams.push(o)}if(t.taskCategory=="CBM"&&(t.task.rating=="NORMAL"||t.task.rating=="AUTOMATIC_REPLACEMENT"||t.task.rating=="AUTOMATIC_REPLACEMENT_GAP")){const o={};o.keyValue=t.taskKey,o.propertyParams=[];const d=(t.task.rating=="AUTOMATIC_REPLACEMENT"||t.task.rating=="AUTOMATIC_REPLACEMENT_GAP")&&t.type=="condition",c=t.task.rating=="NORMAL";if((d||c)&&o.propertyParams.push({propertyName:"taskNormalValue",propertyValue:t.type=="rating"?"":t.value}),c&&t.type=="condition"&&t.value=="4"&&t.task.images&&((i=t.task.images)==null?void 0:i.length)>0&&o.propertyParams.push({propertyName:"images",propertyValue:""}),e.updateParams.push(o),t.task.rating=="NORMAL"){const p=t.task.items.find(f=>(t.type=="rating"&&f.valueItemType=="condition"||t.type=="condition"&&f.valueItemType=="rating")&&f.itemType=="dropDown");if(p){const f={};f.keyValue=p.key,f.propertyParams=[],f.propertyParams.push({propertyName:"value",propertyValue:""}),f.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(t.employee)}),f.propertyParams.push({propertyName:"updatedDate",propertyValue:t.timeStamp}),e.updateParams.push(f)}}if(t.task.rating=="AUTOMATIC_REPLACEMENT"||t.task.rating=="AUTOMATIC_REPLACEMENT_GAP"){const p={};p.keyValue=t.task.key,p.propertyParams=[],p.propertyParams.push({propertyName:"images",propertyValue:""}),e.updateParams.push(p)}}t.value=="4"&&Object.keys(this.stateItemKeyWithTriggeredDisabledKey).filter(d=>this.stateItemKeyWithTriggeredDisabledKey[d]===t.itemKey).forEach(d=>{const c={};c.keyValue=d,c.propertyParams=[],c.propertyParams.push({propertyName:"value",propertyValue:""}),c.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(t.employee)}),c.propertyParams.push({propertyName:"updatedDate",propertyValue:t.timeStamp}),e.updateParams.push(c)}),Be().setDefectIdentifiedData(this.Intervention.sapWorkOrder)},async getCountIdentifiedDefect(){const e={ver:"v1",interventionId:this.stateSelectedIntervention.id};try{if(ye())return;const a=(await g.get(`${li}`,"",new URLSearchParams(e).toString())).data.result.content;this.stateIdentifiedDefectCount=a.identifiedDefectCount}catch(t){A("IRONS",t),console.log(t)}},async updateFormDataFromServer(){const t=await rt().getWorkOrderDetailById(this.Intervention.keyPbi);this.stateSelectedIntervention=t,this.setGroup(t),this.setSelectedGroup(this.stateGroups[this.stateSelectedGroup.sequence-1])},async updateTask(e,t=!1,a=!1){this.stateIsError=!1;const s=Fe();e.headerId=this.stateSelectedIntervention.id,e.id=this.stateSelectedIntervention.id,e.workOrder=this.stateSelectedIntervention.sapWorkOrder,e.itemKey in this.stateItemTriggerDisabledValue&&(this.stateItemTriggerDisabledValue[e.itemKey]=e.value);let n={};if(a?n=this.createResetTaskAdjustmentPayload(e):n=this.createTaskUpdatePayload(e,t),ye())await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Task",workorder:e.workOrder,key:e.taskKey,bindingKey:e.taskKey,payload:JSON.stringify(n),syncDate:re(),syncStatus:"Pending"}),await this.updateLocalData(e);else{this.LoadingTask[e.itemKey]=!0;try{await s.SyncInterventionTaskData(JSON.stringify(n)),await this.updateFormDataFromServer()}catch(o){this.globalConnectionStore.checkIsErrorNoNetwork(o)?(await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Task",workorder:e.workOrder,key:e.taskKey,bindingKey:e.taskKey,payload:JSON.stringify(n),syncDate:re(),syncStatus:"Pending"}),await this.updateLocalData(e),this.LoadingTask[e.itemKey]=!1,Be().setDefectIdentifiedData(this.Intervention.sapWorkOrder)):(o==Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL||o==Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON?(this.stateTaskErrorDialog=!0,this.stateErrorMessageTaskErrorDialog=o):o==Z.SUBMITTED?this.stateFormSubmittedDialog=!0:o==Z.CLOSE&&(this.stateFormCloseDialog=!0),this.stateIsError=!0)}this.LoadingTask[e.itemKey]=!1}Be().setDefectIdentifiedData(this.Intervention.sapWorkOrder)},async updateIntervention(e=!1){const a=await rt().getWorkOrderDetailById(this.Intervention.keyPbi);await u.interventionDetail.put(a),this.stateSelectedIntervention=a,e&&(this.setGroup(a),this.setSelectedGroup(this.stateGroups[this.stateSelectedGroup.sequence-1]))},async updateSMU(e){this.stateSelectedIntervention.interventionSMU=e.value,this.stateSelectedIntervention.smuBy=e.smuBy,this.stateSelectedIntervention.smuDate=e.smuDate},async discardGeneralChanges(){this.stateSelectedIntervention.imageEquipment="",this.stateSelectedIntervention.log=null,this.stateSelectedIntervention.riskAssesment[0].value="",this.stateSelectedIntervention.servicePersonnels=[],await u.interventionDetail.put(C.cloneDeep(this.stateSelectedIntervention))},setSerialNumber(e){this.stateSerialNumber=e},async saveReplacementPreviousValue(){const e={modelId:this.Intervention.equipmentDesc,type:"intervention"};try{const t=new URLSearchParams({ver:"v1"}).toString(),s=(await g.post(`${vi}?${t}`,e)).data.result.content??[];await u.intervetionReplacementDefaultValue.put({id:this.Intervention.id,defaultValues:C.cloneDeep(s)})}catch(t){A("IRONS",t),console.log("error get bulk default values",t)}},async getReplacementDefaultValueByTask(e){let t="",a=[];const s=await u.intervetionReplacementDefaultValue.where({id:this.Intervention.id}).first();s&&(a=s.defaultValues);const r=a.find(n=>{const i=n.taskId==e.key,o=e.psType==n.psTypeId,d=e.rating==n.rating;return i&&o&&d});return r&&(t=r.defaultValue),t},async checIsReadySubmitInterventionData(){if(this.TaskProgress.every(t=>t.taskDone===t.taskTotal))if(ye()){if(this.Intervention.interventionExecution=="On Progress")return!0}else return await rt().getExisitingSMU({id:this.Intervention.id,key:this.Intervention.key,propertyName:"interventionExecution"})=="On Progress";return!1}}}),ia=Ne({id:"InterventionDefectStore",state:()=>({stateDefectNoData:{},stateDefectYesData:{},stateDefectCBMData:{},stateIsBusy:!1,stateDefectImages:{},stateCBMImages:{}}),getters:{DefectYesData:e=>e.stateDefectYesData,DefectNoData:e=>e.stateDefectNoData,DefectCBMData:e=>e.stateDefectCBMData,DefectImages:e=>e.stateDefectImages,CBMImages:e=>e.stateCBMImages,IsBusy:e=>e.stateIsBusy,globalConnectionStore:()=>Ge()},actions:{initDefectImages(e){e in this.stateDefectImages||(this.stateDefectImages[e]=[])},async addNewPartImages(e){const a=X().Intervention;e.blobs.forEach(async(s,r)=>{const n={module:"Intervention",key:e.taskKey??"",workorder:a.sapWorkOrder,type:e.type,fileType:e.files[r].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[r].filename,originalFilename:e.files[r].originalFilename??e.files[r].filename,blob:s,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",n)})},async deletePartImage(e){await u.pendingTaskFile.where("filename").equals(e).delete()},async defineNewDefectImages(e){const a=X().Intervention;await u.pendingTaskFile.where("filename").equals(this.stateDefectImages[e.key][0].filename).delete(),e.blobs.forEach(async(s,r)=>{const n={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[r].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[r].filename,originalFilename:e.files[r].originalFilename??e.files[r].filename,blob:s,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",n);const i=Re([e.files[r]]);this.stateDefectImages[e.key]=i})},async addNewDefectImages(e){const a=X().Intervention;e.blobs.forEach(async(s,r)=>{const n={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[r].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[r].filename,originalFilename:e.files[r].originalFilename??e.files[r].filename,blob:s,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",n);const i=Re(this.stateDefectImages[e.key]);i.push(e.files[r]),this.stateDefectImages[e.key]=i})},setExistingDefectImages(e,t){this.initDefectImages(e),this.stateDefectImages[e]=Re(t)},async deleteDefectImage(e,t){await u.pendingTaskFile.where("filename").equals(t).delete();const a=Re(this.stateDefectImages[e]);this.stateDefectImages[e]=a.filter(s=>s.filename!=t)},async resetDefectImages(e,t){await u.pendingTaskFile.filter(s=>s.key===e&&s.workorder===t&&s.module=="Intervention").delete(),this.stateDefectImages[e]=[]},initCBMImages(e,t){e in this.stateCBMImages||(this.stateCBMImages[e]=[]),C.isArray(t)?this.stateCBMImages[e]=t:t!=""?this.stateCBMImages[e]=JSON.parse(t):this.stateCBMImages[e]=[]},async addNewCBMImages(e){const a=X().Intervention;e.blobs.forEach(async(s,r)=>{const n={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[r].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[r].filename,originalFilename:e.files[r].originalFilename?e.files[r].originalFilename:e.files[r].filename,blob:s,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",n)}),this.stateCBMImages[e.key].push(...e.files)},async defineNewCBMImages(e){const a=X().Intervention,s=u.pendingTaskFile.where({key:e.key,sapWorkorder:a.sapWorkOrder,syncStatus:"Not Sync"});s&&await s.delete(),e.blobs.forEach(async(r,n)=>{const i={module:"Intervention",key:e.key,workorder:a.sapWorkOrder,type:e.type,fileType:e.files[n].fileType??"webp",createdBy:e.employee.id,email:e.email,filename:e.files[n].filename,originalFilename:e.files[n].originalFilename?e.files[n].originalFilename:e.files[n].filename,blob:r,syncDate:re(),syncStatus:"Pending"};await Me(u,"pendingTaskFile",i)}),this.stateCBMImages[e.key]=e.files},async deleteCBMImage(e,t){await u.pendingTaskFile.where("filename").equals(t).delete();const a=Re(this.stateCBMImages[e]);this.stateCBMImages[e]=a.filter(s=>s.filename!=t)},async resetCBMImages(e,t){await u.pendingTaskFile.filter(s=>s.key===e&&s.workorder===t&&s.module=="Intervention").delete(),this.stateCBMImages[e]=[]},createDefectYesData(e,t=""){var s;const a=X();this.stateDefectYesData.header={},this.stateDefectYesData.header.workorder=a.Intervention.sapWorkOrder,this.stateDefectYesData.header.form=a.Intervention.equipmentDesc,this.stateDefectYesData.header.serviceSheetDetailId="",this.stateDefectYesData.header.interventionId=a.Intervention.id,this.stateDefectYesData.header.interventionHeaderId=a.Intervention.trInterventionHeaderId,this.stateDefectYesData.header.category=e.task.taskCategory,this.stateDefectYesData.header.taskId=e.task.taskKey,this.stateDefectYesData.header.taskNo=e.taskNo,this.stateDefectYesData.header.taskDesc=e.taskDesc,this.stateDefectYesData.header.defectWorkorder="",this.stateDefectYesData.header.formDefect="DM-PL-F55",this.stateDefectYesData.header.defectType=((s=e.task)==null?void 0:s.defectType)||"",this.stateDefectYesData.header.cbmMeasurement="",this.stateDefectYesData.header.cbmUom="",this.stateDefectYesData.header.cbmImageKey="",this.stateDefectYesData.header.cbmImageProp="",this.stateDefectYesData.header.isCbmAdjusment="",this.stateDefectYesData.header.taskValue=e.task.value,this.stateDefectYesData.header.repairedStatus="Not-Repaired",this.stateDefectYesData.header.cbmNAStatus="Not-Confirm",this.stateDefectYesData.header.supervisor=e.task.supervisor,this.stateDefectYesData.header.status="Submited",this.stateDefectYesData.header.defectStatus="Submited",this.stateDefectYesData.header.plannerStatus="",this.stateDefectYesData.header.declineReason="",this.stateDefectYesData.header.declineBy={},this.stateDefectYesData.header.declineDate="",this.stateDefectYesData.header.approvedBy={},this.stateDefectYesData.header.approvedDate="",t!=""&&(this.stateDefectYesData.header.id=t),this.createDefectYesDetail(e,t)},createDefectYesDetail(e,t=""){this.stateDefectYesData.detail={},this.stateDefectYesData.detail.interventionId=e.task.id,this.stateDefectYesData.detail.title=e.taskDesc,this.stateDefectYesData.detail.type="YES",this.stateDefectYesData.detail.isNeed30Minutes=e.isNeed30Minutes,this.stateDefectYesData.detail.assetNumber=e.assetNumber,this.stateDefectYesData.detail.description=e.description,this.stateDefectYesData.detail.raisedBy=e.raisedBy,this.stateDefectYesData.detail.date=e.submitDate,this.stateDefectYesData.detail.plannedDuration=e.plannedDuration,this.stateDefectYesData.detail.instruction=e.instruction,this.stateDefectYesData.detail.priority=e.priority,this.stateDefectYesData.detail.parts=JSON.stringify(e.parts),this.stateDefectYesData.detail.labours=JSON.stringify(e.labours),this.stateDefectYesData.detail.resources=JSON.stringify(e.resources),this.stateDefectYesData.detail.symptoms=JSON.stringify(e.symptoms),this.stateDefectYesData.detail.causes=JSON.stringify(e.causes),t!=""?this.stateDefectYesData.detail.images=JSON.stringify(this.stateDefectImages[t]):e.task.taskKey!=""?this.stateDefectYesData.detail.images=JSON.stringify(this.stateDefectImages[e.task.taskKey]):this.stateDefectYesData.detail.images=JSON.stringify(this.stateDefectImages[e.defectHeaderId]),this.stateDefectYesData.detail.id=sa()},createDefectYesPayload(e,t=""){const a=X();this.createDefectYesData(e,t);const s={};s.headerId=e.task.headerId,s.id=e.task.id,s.employee=e.task.employee,s.localInterventionStatus=a.Intervention.interventionExecution,s.workOrder=a.Intervention.sapWorkOrder,s.updateParams=[];const r={};return r.keyValue=e.task.taskKey,r.propertyParams=[],r.propertyParams.push({propertyName:"taskValue",propertyValue:e.task.value}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.task.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),e.task.task.taskValue=="4"?r.propertyParams.push({propertyName:"reason",propertyValue:e.reason??""}):r.propertyParams.push({propertyName:"reason",propertyValue:""}),s.updateParams.push(r),s.defectHeader=this.DefectYesData.header,s.defectDetail=this.DefectYesData.detail,s},async submitDefectYes(e,t=!1){Ye();const a=X(),s=Fe(),r=this.createDefectYesPayload(e,e.idGenerated);if(t?r.updateParams=[]:a.appendTaskUpdatePayload(r,e.task,!0),ye()){const n=await u.pendingTask.get({key:e.task.taskKey,workorder:r.workOrder});n&&!t?(n.payload=JSON.stringify(r),await u.pendingTask.put(n)):await u.pendingTask.add({module:"Intervention",section:"E-Form",type:t?"DefectGeneric":"Defect",workorder:r.workOrder,key:t?e.idGenerated:e.task.taskKey,bindingKey:t?e.idGenerated:e.task.taskKey,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"})}else{if(t)await s.SyncInterventionGenericDefectData(JSON.stringify(r));else try{await s.SyncInterventionDefectData(JSON.stringify(r))}catch(n){if(this.globalConnectionStore.checkIsErrorNoNetwork(n)){const o=await u.pendingTask.get({key:e.task.taskKey,workorder:r.workOrder});return o&&!t?(o.payload=JSON.stringify(r),await u.pendingTask.put(o)):await u.pendingTask.add({module:"Intervention",section:"E-Form",type:t?"DefectGeneric":"Defect",workorder:r.workOrder,key:t?e.idGenerated:e.task.taskKey,bindingKey:t?e.idGenerated:e.task.taskKey,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"}),await this.updateDefectYesDataAndUpdateOnLocal(t,r,e,a),!1}else{const o=X();return n==Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL||n==Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON||n==Z.TASK_UPDATED_BY_OTHER?(o.stateTaskErrorDialog=!0,o.stateErrorMessageTaskErrorDialog=n):n==Z.SUBMITTED?o.stateFormSubmittedDialog=!0:n==Z.CLOSE&&(o.stateFormCloseDialog=!0),!0}}await a.updateIntervention(!0)}await this.updateDefectYesDataAndUpdateOnLocal(t,r,e,a)},async updateDefectYesDataAndUpdateOnLocal(e,t,a,s){var i,o,d,c,p,f,I,v,T,H,E,U,G,O,k,L,z,w,x,B,y,M,$,J,V,le,oe;if(!e){const te=u.interventionDefect.where({interventionId:(i=t.defectHeader)==null?void 0:i.interventionId,taskId:(o=t.defectHeader)==null?void 0:o.taskId});te&&await te.delete()}await u.interventionDefect.put({category:(d=t.defectHeader)==null?void 0:d.category,interventionId:(c=t.defectHeader)==null?void 0:c.interventionId,taskId:(p=t.defectHeader)==null?void 0:p.taskId,taskNo:(f=t.defectHeader)==null?void 0:f.taskNo,taskDesc:(I=t.defectHeader)==null?void 0:I.taskDesc,taskValue:(v=t.defectHeader)==null?void 0:v.taskValue,defectHeaderId:e?a.idGenerated:"",defectDetailId:((T=t.defectDetail)==null?void 0:T.id)??"",defectType:e?"Generic":"",priority:a.priority,sapWorkorder:t.workOrder,taskKey:(H=t.defectHeader)==null?void 0:H.taskId,type:"YES",defectData:JSON.stringify(t.defectDetail),repairedStatus:(E=t.defectHeader)==null?void 0:E.repairedStatus,cbmNAStatus:"Not-Confirm",status:(U=t.defectHeader)==null?void 0:U.status,plannerStatus:(G=t.defectHeader)!=null&&G.plannerStatus?(O=t.defectHeader)==null?void 0:O.plannerStatus:"",declineReason:(k=t.defectHeader)!=null&&k.declineReason?(L=t.defectHeader)==null?void 0:L.declineReason:"",statusSync:status,declineDate:(z=t.defectHeader)!=null&&z.declineDate?(w=t.defectHeader)==null?void 0:w.declineDate:"",declineBy:(x=t.defectHeader)!=null&&x.declineBy?{id:(B=t.defectHeader)==null?void 0:B.declineBy.id,name:(y=t.defectHeader)==null?void 0:y.declineBy.name}:{},approvedDate:(M=t.defectHeader)!=null&&M.approvedDate?($=t.defectHeader)==null?void 0:$.approvedDate:"",approvedBy:(J=t.defectHeader)!=null&&J.approvedBy?{id:(V=t.defectHeader)==null?void 0:V.approvedBy.id,name:(le=t.defectHeader)==null?void 0:le.approvedBy.name}:{},createdBy:t.employee?{id:t.employee.id,name:t.employee.name}:{},createdDate:a.task.timeStamp?a.task.timeStamp:"",updatedBy:t.employee?{id:t.employee.id,name:t.employee.name}:{},updatedDate:a.task.timeStamp?a.task.timeStamp:""});let r=a.task.taskKey;e&&(r=a.idGenerated),this.stateDefectImages[r]=[],await s.updateLocalData(a.task),Be().setDefectIdentifiedData((oe=t.defectHeader)==null?void 0:oe.workorder)},async checkDataInterventionSMU(){const e=X();return(await u.interventionDefect.where({interventionId:e.Intervention.id,category:"GENERAL",defectType:"machineSMU"}).toArray()).length>0},createDefectSMUPayload(e){const t=X(),a=rt(),s={};s.headerId=e.id,s.id=e.id,s.employee=a.Log.employee,s.localInterventionStatus=t.Intervention.interventionExecution,s.workorder=t.Intervention.sapWorkOrder,s.updateParams=[];const r={};r.keyValue="GENERAL",r.propertyParams=[];let n=a.Log.employee;return e.fitter&&(n=e.fitter,s.employee=e.fitter),r.propertyParams.push({propertyName:"interventionSMU",propertyValue:e.value}),r.propertyParams.push({propertyName:"smuBy",propertyValue:JSON.stringify(n)}),r.propertyParams.push({propertyName:"smuDate",propertyValue:e.submitDate}),r.propertyParams.push({propertyName:"hmOffset",propertyValue:t.Intervention.hmOffset??"0"}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(n)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),s.updateParams.push(r),s.defectHeader={workorder:t.Intervention.sapWorkOrder,form:t.Intervention.equipmentDesc,serviceSheetDetailId:"",interventionId:t.Intervention.id,interventionHeaderId:t.Intervention.trInterventionHeaderId,category:"GENERAL",taskId:"",taskNo:"",taskDesc:Dt.MACHINESMUTITLE(),defectWorkorder:"",formDefect:"",defectType:"machineSMU",cbmMeasurement:"",cbmUom:"",cbmImageKey:"",cbmImageProp:"",isCbmAdjusment:"",taskValue:"",repairedStatus:"",cbmNAStatus:"",supervisor:e.employee,status:"Submited",defectStatus:"Submited",isActive:"true",plannerStatus:"",declineReason:"",declineBy:{},declineDate:"",approvedBy:{},approvedDate:"",createdBy:a.Log.employee,createdDate:e.submitDate,updatedBy:a.Log.employee,updatedDate:e.submitDate},s.defectDetail={title:Dt.TITLE(status),machineSMU:e.value,minRange:Number(e.detail.range.minRange),maxRange:Number(e.detail.range.maxRange),smuDue:t.Intervention.smuDue,assetNumber:t.Intervention.equipment,serialNumber:e.detail.serialNumber,hmOffset:t.Intervention.hmOffset??"0",images:JSON.stringify(t.Intervention.imageEquipment??[])},s},async createDefectSMU(e){var c,p,f,I,v,T,H,E,U,G,O,k,L,z,w,x,B,y,M,$,J,V,le,oe,te,pe,j,K,ne,ce;const t=X(),a=Fe(),s=this.createDefectSMUPayload(e);let r="";const n=async()=>{const ge=await u.pendingTask.get({key:"SMU",workorder:s.workorder});ge?(ge.payload=JSON.stringify(s),await u.pendingTask.put(ge)):await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Defect",workorder:s.workorder,key:"SMU",bindingKey:"SMU",payload:JSON.stringify(s),syncDate:re(),syncStatus:"Pending"}),r="Pending"};if(ye())await n();else try{await a.SyncInterventionDefectData(JSON.stringify(s)),await t.updateIntervention(!0),r="Sync"}catch(ge){const b=X();ge==Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL||ge==Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON||ge==Z.TASK_UPDATED_BY_OTHER?(b.stateTaskErrorDialog=!0,b.stateErrorMessageTaskErrorDialog=ge):ge==Z.SUBMITTED?b.stateFormSubmittedDialog=!0:ge==Z.CLOSE&&(b.stateFormCloseDialog=!0),await n()}const i=u.interventionDefect.where({interventionId:(c=s.defectHeader)==null?void 0:c.interventionId,category:(p=s.defectHeader)==null?void 0:p.category,defectType:"machineSMU"});i&&await i.delete();const o={...s.defectDetail,createdBy:(f=s.defectHeader)==null?void 0:f.createdBy,createdDate:(I=s.defectHeader)==null?void 0:I.createdDate,updatedBy:(v=s.defectHeader)==null?void 0:v.updatedBy,updatedDate:(T=s.defectHeader)==null?void 0:T.updatedDate};await u.interventionDefect.put({category:(H=s.defectHeader)==null?void 0:H.category,interventionId:(E=s.defectHeader)==null?void 0:E.interventionId,taskId:(U=s.defectHeader)==null?void 0:U.taskId,taskNo:(G=s.defectHeader)==null?void 0:G.taskNo,taskDesc:(O=s.defectHeader)==null?void 0:O.taskDesc,taskValue:(k=s.defectHeader)==null?void 0:k.taskValue,defectHeaderId:e.idGenerated,defectType:"machineSMU",priority:"",sapWorkorder:s.workorder,taskKey:(L=s.defectHeader)==null?void 0:L.taskId,type:"machineSMU",defectData:JSON.stringify(o),repairedStatus:(z=s.defectHeader)==null?void 0:z.repairedStatus,cbmNAStatus:"Not-Confirm",status:(w=s.defectHeader)==null?void 0:w.status,plannerStatus:(x=s.defectHeader)!=null&&x.plannerStatus?(B=s.defectHeader)==null?void 0:B.plannerStatus:"",declineReason:(y=s.defectHeader)!=null&&y.declineReason?(M=s.defectHeader)==null?void 0:M.declineReason:"",statusSync:r,declineDate:($=s.defectHeader)!=null&&$.declineDate?(J=s.defectHeader)==null?void 0:J.declineDate:"",declineBy:(V=s.defectHeader)!=null&&V.declineBy?{id:(le=s.defectHeader)==null?void 0:le.declineBy.id,name:(oe=s.defectHeader)==null?void 0:oe.declineBy.name}:{},approvedDate:(te=s.defectHeader)!=null&&te.approvedDate?(pe=s.defectHeader)==null?void 0:pe.approvedDate:"",approvedBy:(j=s.defectHeader)!=null&&j.approvedBy?{id:(K=s.defectHeader)==null?void 0:K.approvedBy.id,name:(ne=s.defectHeader)==null?void 0:ne.approvedBy.name}:{},createdBy:s.employee?{id:s.employee.id,name:s.employee.name}:{},createdDate:e.submitDate,updatedBy:s.employee?{id:s.employee.id,name:s.employee.name}:{},updatedDate:e.submitDate}),Be().setDefectIdentifiedData((ce=s.defectHeader)==null?void 0:ce.workorder)},async updateDefectSMUMonitoring(e){const t=Be(),a=Je(),s=X();if(t.stateData.DefectSMUHeaders.length==0)await this.createDefectSMU(e);else{const r=t.stateData.DefectSMUHeaders[0].defectData,n=JSON.parse(r);await a.updateDefectDetailSMU({...C.omit(n,["headerKey"]),machineSMU:e.value,title:Dt.MACHINESMUTITLE(),images:JSON.stringify(s.Intervention.imageEquipment??[])},t.stateData.DefectSMUHeaders[0].defectDetailId,!0),await a.updateDefectHeaderSMU({isInRange:e.detail.isInRange,headerId:t.stateData.DefectSMUHeaders[0].defectHeaderId,headerKey:n.headerKey,isEdit:!0})}},createDefectNoData(e,t=""){var s;const a=X();this.stateDefectNoData.header={},this.stateDefectNoData.header.workorder=a.Intervention.sapWorkOrder,this.stateDefectNoData.header.form=a.Intervention.equipmentDesc,this.stateDefectNoData.header.serviceSheetDetailId="",this.stateDefectNoData.header.interventionId=a.Intervention.id,this.stateDefectNoData.header.interventionHeaderId=a.Intervention.trInterventionHeaderId,this.stateDefectNoData.header.category=e.task.taskCategory,this.stateDefectNoData.header.taskId=e.task.taskKey,this.stateDefectNoData.header.taskNo=e.taskNo,this.stateDefectNoData.header.taskDesc=e.taskDesc,this.stateDefectNoData.header.defectWorkorder="",this.stateDefectNoData.header.formDefect="DM-PL-F55",this.stateDefectNoData.header.defectType=((s=e.task)==null?void 0:s.defectType)||"",this.stateDefectNoData.header.cbmMeasurement="",this.stateDefectNoData.header.cbmUom="",this.stateDefectNoData.header.cbmImageKey="",this.stateDefectNoData.header.cbmImageProp="",this.stateDefectNoData.header.isCbmAdjusment="",this.stateDefectNoData.header.taskValue=e.task.value,this.stateDefectNoData.header.repairedStatus="Not-Repaired",this.stateDefectNoData.header.cbmNAStatus="Not-Confirm",this.stateDefectNoData.header.supervisor=e.task.supervisor,this.stateDefectNoData.header.status="Submited",this.stateDefectNoData.header.defectStatus="Submited",this.stateDefectNoData.detail={},this.stateDefectNoData.detail.interventionId=e.task.id,this.stateDefectNoData.detail.title=e.taskDesc,this.stateDefectNoData.detail.type="NO",this.stateDefectNoData.detail.assetNumber=e.assetNumber,this.stateDefectNoData.detail.description=e.description,this.stateDefectNoData.detail.raisedBy=e.raisedBy,this.stateDefectNoData.detail.date=e.submitDate,this.stateDefectNoData.detail.actions=JSON.stringify(e.actions),t!=""?this.stateDefectNoData.detail.images=JSON.stringify(this.stateDefectImages[t]):this.stateDefectNoData.detail.images=JSON.stringify(this.stateDefectImages[e.task.taskKey]),this.stateDefectNoData.header.plannerStatus="",this.stateDefectNoData.header.declineReason="",this.stateDefectNoData.header.declineBy={},this.stateDefectNoData.header.declineDate="",this.stateDefectNoData.header.approvedBy={},this.stateDefectNoData.header.approvedDate=""},createDefectNoPayload(e,t=""){const a=X();this.createDefectNoData(e,t);const s={};s.headerId=e.task.headerId,s.id=e.task.id,s.employee=e.task.employee,s.localInterventionStatus=a.Intervention.interventionExecution,s.workOrder=a.Intervention.sapWorkOrder,s.updateParams=[];const r={};return r.keyValue=e.task.taskKey,r.propertyParams=[],r.propertyParams.push({propertyName:"taskValue",propertyValue:e.task.value}),r.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.task.employee)}),r.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),e.task.task.taskValue=="4"?r.propertyParams.push({propertyName:"reason",propertyValue:e.reason||""}):r.propertyParams.push({propertyName:"reason",propertyValue:""}),s.updateParams.push(r),s.defectHeader=this.DefectNoData.header,t!=""&&(s.defectHeader.id=t),s.defectDetail=this.DefectNoData.detail,s},async submitDefectNo(e,t=!1){Ye();const a=X(),s=this.createDefectNoPayload(e,e.idGenerated);if(t?s.updateParams=[]:a.appendTaskUpdatePayload(s,e.task,!0,!1),ye()){const r=await u.pendingTask.get({key:e.task.taskKey,workorder:s.workOrder});r&&!t?(r.payload=JSON.stringify(s),await u.pendingTask.put(r)):await u.pendingTask.add({module:"Intervention",section:"E-Form",type:t?"DefectGeneric":"Defect",workorder:s.workOrder,key:e.task.taskKey,bindingKey:e.task.taskKey,payload:JSON.stringify(s),syncDate:re(),syncStatus:"Pending"})}else{const r=Fe();if(t)await r.SyncInterventionGenericDefectData(JSON.stringify(s));else try{await r.SyncInterventionDefectData(JSON.stringify(s))}catch(n){if(this.globalConnectionStore.checkIsErrorNoNetwork(n)){const o=await u.pendingTask.get({key:e.task.taskKey,workorder:s.workOrder});return o&&!t?(o.payload=JSON.stringify(s),await u.pendingTask.put(o)):await u.pendingTask.add({module:"Intervention",section:"E-Form",type:t?"DefectGeneric":"Defect",workorder:s.workOrder,key:e.task.taskKey,bindingKey:e.task.taskKey,payload:JSON.stringify(s),syncDate:re(),syncStatus:"Pending"}),await this.updateDefectNoDataAndUpdateOnLocal(t,s,e,a),!1}else{const o=X();return n==Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL||n==Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON||n==Z.TASK_UPDATED_BY_OTHER?(o.stateTaskErrorDialog=!0,o.stateErrorMessageTaskErrorDialog=n):n==Z.SUBMITTED?o.stateFormSubmittedDialog=!0:n==Z.CLOSE&&(o.stateFormCloseDialog=!0),!0}}await a.updateIntervention(!0)}await this.updateDefectNoDataAndUpdateOnLocal(t,s,e,a)},async updateDefectNoDataAndUpdateOnLocal(e,t,a,s){var i,o,d,c,p,f,I,v,T,H,E,U,G,O,k;if(!e){const L=u.interventionDefect.where({interventionId:(i=t.defectHeader)==null?void 0:i.interventionId,taskId:(o=t.defectHeader)==null?void 0:o.taskId});L&&await L.delete()}await u.interventionDefect.add({category:(d=t.defectHeader)==null?void 0:d.category,interventionId:(c=t.defectHeader)==null?void 0:c.interventionId,taskId:(p=t.defectHeader)==null?void 0:p.taskId,taskNo:(f=t.defectHeader)==null?void 0:f.taskNo,taskDesc:(I=t.defectHeader)==null?void 0:I.taskDesc,taskValue:(v=t.defectHeader)==null?void 0:v.taskValue,defectHeaderId:e?a.idGenerated:"",defectType:e?"Generic":"",sapWorkorder:t.workOrder,taskKey:(T=t.defectHeader)==null?void 0:T.taskId,type:"NO",defectData:JSON.stringify(t.defectDetail),repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",status:(H=t.defectHeader)==null?void 0:H.status,plannerStatus:(E=t.defectHeader)!=null&&E.plannerStatus?(U=t.defectHeader)==null?void 0:U.plannerStatus:"",declineReason:(G=t.defectHeader)!=null&&G.declineReason?(O=t.defectHeader)==null?void 0:O.declineReason:"",createdBy:t.employee?{id:t.employee.id,name:t.employee.name}:{},createdDate:a.task.timeStamp?a.task.timeStamp:"",updatedBy:t.employee?{id:t.employee.id,name:t.employee.name}:{},updatedDate:a.task.timeStamp?a.task.timeStamp:"",statusSync:status});let r=a.task.taskKey;e&&(r=a.idGenerated),this.stateDefectImages[r]=[],await s.updateLocalData(a.task),Be().setDefectIdentifiedData((k=t.defectHeader)==null?void 0:k.workorder)},createDefectCBMData(e){const t=X();if(this.stateDefectCBMData.header={},this.stateDefectCBMData.header.workorder=t.Intervention.sapWorkOrder,this.stateDefectCBMData.header.form=t.Intervention.equipmentDesc,this.stateDefectCBMData.header.serviceSheetDetailId="",this.stateDefectCBMData.header.interventionId=t.Intervention.id,this.stateDefectCBMData.header.interventionHeaderId=t.Intervention.trInterventionHeaderId,this.stateDefectCBMData.header.category=e.task.taskCategory=="Adjustment"?"CBM":e.task.taskCategory,this.stateDefectCBMData.header.taskId=e.task.taskKey,this.stateDefectCBMData.header.taskNo=e.taskNo,this.stateDefectCBMData.header.taskDesc=e.task.task.description,this.stateDefectCBMData.header.defectWorkorder="",this.stateDefectCBMData.header.formDefect="DM-PL-F55",this.stateDefectCBMData.header.defectType="",this.stateDefectCBMData.header.cbmMeasurement=e.cbmMeasurement??"",this.stateDefectCBMData.header.cbmUom=e.uomValue??"",this.stateDefectCBMData.header.cbmImageKey="",this.stateDefectCBMData.header.cbmImageProp="images",this.stateDefectCBMData.header.isCbmAdjusment="false",this.stateDefectCBMData.header.taskValue=e.task.value,this.stateDefectCBMData.header.repairedStatus="Not-Repaired",this.stateDefectCBMData.header.cbmNAStatus="Not-Confirm",this.stateDefectCBMData.header.supervisor=e.task.supervisor,this.stateDefectCBMData.header.status="Submited",this.stateDefectCBMData.header.defectStatus="Submited",this.stateDefectCBMData.header.plannerStatus="",this.stateDefectCBMData.header.declineReason="",this.stateDefectCBMData.header.declineBy={},this.stateDefectCBMData.header.declineDate="",this.stateDefectCBMData.header.approvedBy={},this.stateDefectCBMData.header.approvedDate="",this.stateDefectCBMData.header.isActive="true",e.task.taskCategory=="Adjustment"){const a=e.task.task.items.find(r=>r.categoryItemType=="paramRating");this.stateDefectCBMData.header.cbmMeasurement=a==null?void 0:a.value;const s=e.task.task.items.find(r=>r.categoryItemType=="targetRating");this.stateDefectCBMData.header.taskValue=s==null?void 0:s.value,e.correctedMeasurement&&(this.stateDefectCBMData.header.correctedMeasurement=e.correctedMeasurement),e.correctedValue&&(this.stateDefectCBMData.header.correctedValue=e.correctedValue),e.correctedUom&&(this.stateDefectCBMData.header.correctedUom=e.correctedUom)}},createDefectCBMPayload(e){const t=X();this.createDefectCBMData(e);const a={};a.headerId=e.task.headerId,a.id=e.task.id,a.employee=e.task.employee,a.localInterventionStatus=t.Intervention.interventionExecution,a.workOrder=t.Intervention.sapWorkOrder,a.updateParams=[];const s={};s.keyValue=e.task.taskKey,s.propertyParams=[];const r=e.task.task.items.find(n=>n.categoryItemType=="targetRating");return s.propertyParams.push({propertyName:"taskValue",propertyValue:e.task.taskCategory=="Adjustment"?r==null?void 0:r.value:e.task.value}),s.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(e.task.employee)}),s.propertyParams.push({propertyName:"updatedDate",propertyValue:e.submitDate}),a.updateParams.push(s),a.defectHeader=this.stateDefectCBMData.header,a.defectDetail=void 0,a},async deleteLocalDefect(e){const t=u.interventionDefect.where({interventionId:e.interventionId,taskId:e.taskId});t&&await t.delete()},async updateLocalDefect(e,t=""){var n,i,o,d,c,p,f,I,v,T,H,E,U,G,O,k,L,z,w,x,B,y,M,$,J,V,le,oe,te,pe,j,K,ne;if(!e.cbmMeasurement){for(const ce of e.task.task.items)if(ce.categoryItemType=="paramRating"){e.cbmMeasurement=ce.value;break}}const a=this.createDefectCBMPayload(e),s=!(e.task.value=="A"||e.task.value=="B"),r=await u.interventionDefect.filter(ce=>ce.taskKey==e.task.taskKey).first();if(r)s?e.task.value&&(r.taskValue=e.task.value,r.cbmMeasurement=e.cbmMeasurement,await u.interventionDefect.put(r)):await u.interventionDefect.filter(ce=>ce.taskKey==e.task.taskKey).delete();else if(s){const ce=u.interventionDefect.where({interventionId:(n=a.defectHeader)==null?void 0:n.interventionId,taskId:(i=a.defectHeader)==null?void 0:i.taskId});ce&&await ce.delete();const ge={category:(o=a.defectHeader)==null?void 0:o.category,interventionId:(d=a.defectHeader)==null?void 0:d.interventionId,taskId:(c=a.defectHeader)==null?void 0:c.taskId,taskNo:(p=a.defectHeader)==null?void 0:p.taskNo,taskDesc:(f=a.defectHeader)==null?void 0:f.taskDesc,taskValue:(I=a.defectHeader)==null?void 0:I.taskValue,sapWorkorder:a.workOrder,taskKey:(v=a.defectHeader)==null?void 0:v.taskId,cbmMeasurement:(T=a.defectHeader)==null?void 0:T.cbmMeasurement,type:"CBM",defectData:"",repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",status:(H=a.defectHeader)==null?void 0:H.status,plannerStatus:(E=a.defectHeader)!=null&&E.plannerStatus?(U=a.defectHeader)==null?void 0:U.plannerStatus:"",declineReason:(G=a.defectHeader)!=null&&G.declineReason?(O=a.defectHeader)==null?void 0:O.declineReason:"",statusSync:t,declineDate:(k=a.defectHeader)!=null&&k.declineDate?(L=a.defectHeader)==null?void 0:L.declineDate:"",declineBy:(z=a.defectHeader)!=null&&z.declineBy?(w=a.defectHeader)==null?void 0:w.declineBy:{},approvedDate:(x=a.defectHeader)!=null&&x.approvedDate?(B=a.defectHeader)==null?void 0:B.approvedDate:"",approvedBy:(y=a.defectHeader)!=null&&y.approvedBy?(M=a.defectHeader)==null?void 0:M.approvedBy:{},createdBy:($=a.defectHeader)!=null&&$.createdBy?{id:(J=a.defectHeader)==null?void 0:J.createdBy.id,name:(V=a.defectHeader)==null?void 0:V.createdBy.name}:{},createdDate:(le=a.defectHeader)!=null&&le.createdDate?(oe=a.defectHeader)==null?void 0:oe.createdDate:"",updatedBy:(te=a.defectHeader)!=null&&te.updatedBy?{id:(pe=a.defectHeader)==null?void 0:pe.updatedBy.id,name:(j=a.defectHeader)==null?void 0:j.updatedBy.name}:{},updatedDate:(K=a.defectHeader)!=null&&K.updatedDate?(ne=a.defectHeader)==null?void 0:ne.updatedDate:""};console.log(ge),await u.interventionDefect.add(C.cloneDeep(ge))}},async submitDefectCBM(e){Ye();const t=X(),a=this.createDefectCBMPayload(e);t.appendTaskUpdatePayload(a,e.task,!0,!1);let s="";if(ye())await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Defect",workorder:a.workOrder,key:e.task.taskKey,bindingKey:e.task.taskKey,payload:JSON.stringify(a),syncDate:re(),syncStatus:"Pending"}),await t.updateTask(e.task,!0),s="Pending",await t.updateLocalData(e.task),this.updateLocalDefect(e,s);else{const r=Fe();try{await r.SyncInterventionDefectData(JSON.stringify(a)),s="Sync",this.updateLocalDefect(e,s)}catch(n){const i=X();this.globalConnectionStore.checkIsErrorNoNetwork(n)?(await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Defect",workorder:a.workOrder,key:e.task.taskKey,bindingKey:e.task.taskKey,payload:JSON.stringify(a),syncDate:re(),syncStatus:"Pending"}),await i.updateTask(e.task,!0),s="Pending",await i.updateLocalData(e.task),this.updateLocalDefect(e,s)):(n==Z.MODIFY_DEFECT_AFTER_SUPERVISOR_APPROVAL||n==Z.CHANGE_NOT_APPLICABLE_WITHOUT_REASON||n==Z.TASK_UPDATED_BY_OTHER?(i.stateTaskErrorDialog=!0,i.stateErrorMessageTaskErrorDialog=n):n==Z.SUBMITTED?i.stateFormSubmittedDialog=!0:n==Z.CLOSE&&(i.stateFormCloseDialog=!0),await i.updateIntervention(!0))}}},async resetDefectCBMAdjustment(e){var i,o,d,c,p,f,I,v,T,H,E,U,G,O,k,L,z,w,x,B,y,M,$,J,V,le,oe,te,pe,j;Ye();const t=X(),a=this.createDefectCBMPayload(e);t.appendTaskUpdatePayload(a,e.task,!1,!0);let s="";ye()?(await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"Defect",workorder:a.workOrder,key:e.task.taskKey,bindingKey:e.task.taskKey,payload:JSON.stringify(a),syncDate:re(),syncStatus:"Pending"}),s="Pending"):(await Fe().SyncInterventionDefectData(JSON.stringify(a)),s="Sync");const r=await u.interventionDefect.filter(K=>K.taskKey==e.task.taskKey).first();if(r)e.task.task.items.forEach(K=>{K.valueItemType=="rating"?r.taskValue=K.value:K.valueItemType=="inputUom"&&(r.cbmMeasurement=K.value)}),await u.interventionDefect.put(r);else{let K="",ne="";e.task.task.items.forEach(ce=>{ce.valueItemType=="rating"?K=ce.value:ce.valueItemType=="inputUom"&&(ne=ce.value)}),await u.interventionDefect.add(C.cloneDeep({category:(i=a.defectHeader)==null?void 0:i.category,interventionId:(o=a.defectHeader)==null?void 0:o.interventionId,taskId:(d=a.defectHeader)==null?void 0:d.taskId,taskNo:(c=a.defectHeader)==null?void 0:c.taskNo,taskDesc:(p=a.defectHeader)==null?void 0:p.taskDesc,taskValue:K,sapWorkorder:a.workOrder,taskKey:(f=a.defectHeader)==null?void 0:f.taskId,cbmMeasurement:ne,type:"CBM",defectData:"",repairedStatus:(I=a.defectHeader)==null?void 0:I.repairedStatus,cbmNAStatus:"Not-Confirm",status:(v=a.defectHeader)==null?void 0:v.status,plannerStatus:(T=a.defectHeader)!=null&&T.plannerStatus?(H=a.defectHeader)==null?void 0:H.plannerStatus:"",declineReason:(E=a.defectHeader)!=null&&E.declineReason?(U=a.defectHeader)==null?void 0:U.declineReason:"",statusSync:s,declineDate:(G=a.defectHeader)!=null&&G.declineDate?(O=a.defectHeader)==null?void 0:O.declineDate:"",declineBy:(k=a.defectHeader)!=null&&k.declineBy?(L=a.defectHeader)==null?void 0:L.declineBy:{},approvedDate:(z=a.defectHeader)!=null&&z.approvedDate?(w=a.defectHeader)==null?void 0:w.approvedDate:"",approvedBy:(x=a.defectHeader)!=null&&x.approvedBy?(B=a.defectHeader)==null?void 0:B.approvedBy:{},createdBy:(y=a.defectHeader)!=null&&y.createdBy?{id:(M=a.defectHeader)==null?void 0:M.createdBy.id,name:($=a.defectHeader)==null?void 0:$.createdBy.name}:{},createdDate:(J=a.defectHeader)!=null&&J.createdDate?(V=a.defectHeader)==null?void 0:V.createdDate:"",updatedBy:(le=a.defectHeader)!=null&&le.updatedBy?{id:(oe=a.defectHeader)==null?void 0:oe.updatedBy.id,name:(te=a.defectHeader)==null?void 0:te.updatedBy.name}:{},updatedDate:(pe=a.defectHeader)!=null&&pe.updatedDate?(j=a.defectHeader)==null?void 0:j.updatedDate:"",correctedValue:"",correctedMeasurement:"",correctedUom:""}))}await t.updateLocalData(e.task),Be().setDefectIdentifiedData(t.Intervention.sapWorkOrder)},async getDefectDetail(e,t,a,s){const r={};r[s]=e,r.sapWorkorder=a;const n=await u.interventionDefect.where(r).first();if(n)return JSON.parse(n.defectData);{const i=await this.getDefectHeaderFromServer(e,t,s),o=await this.getDefectDetailFromServer(e,t,s);return await u.interventionDefect.put({category:i.category,interventionId:i.interventionId,taskId:i.taskId,taskNo:i.taskNo,taskDesc:i.taskDesc,taskValue:i.taskValue,sapWorkorder:a,taskKey:i.taskId,type:o.type,defectHeaderId:i.id,defectData:JSON.stringify(o),statusSync:"Sync",repairedStatus:i.repairedStatus,cbmNAStatus:"Not-Confirm",status:i.status,plannerStatus:i.plannerStatus,declineReason:i.declineReason,declineDate:i.declineDate,declineBy:i.declineBy,approvedDate:i.approvedDate,approvedBy:i.approvedBy,createdBy:i.createdBy,createdDate:i.createdDate,updatedBy:i.updatedBy,updatedDate:i.updatedDate}),o}},async getDefectHeader(e,t,a,s){const r={};return r[s]=e,r.sapWorkorder=a,await u.interventionDefect.where(r).first()},async getDefectDecline(e){const t=await u.interventionDefect.where("taskKey").equals(e).first(),a={};return a.isDecline=t.declineReason!="",a.declineReason=t.declineReason,a.declineBy=t.declineBy,a.declineDate=t.declineDate,a},async getDefectHeaderFromServer(e,t,a){this.stateIsBusy=!0;const s={interventionHeaderId:t,isActive:"true",isDeleted:"false"};s[a]=e;const r=await g.post(ri,s);return this.stateIsBusy=!1,r.data.result.content},async getDefectDetailFromServer(e,t,a){this.stateIsBusy=!0;const s={interventionHeaderId:t,isActive:"true",isDeleted:"false"};s[a]=e;const r=await g.post(ii,s);return this.stateIsBusy=!1,r.data.result.content.detail},createCBMImagePayload(e){const t=X(),a={};a.employee=e.employee,a.localInterventionStatus=t.Intervention.interventionExecution,a.headerId=e.id,a.id=e.id,a.updateParams=[];const s={};return s.propertyParams=[],e.taskCategory=="Adjustment"?(s.keyValue=e.itemKey,s.propertyParams.push({propertyName:"pictures",propertyValue:JSON.stringify(this.stateCBMImages[e.itemKey])})):(s.keyValue=e.taskKey,s.keyValue=e.taskKey,s.propertyParams=[],s.keyValue=e.taskKey,s.propertyParams=[],s.propertyParams.push({propertyName:"images",propertyValue:JSON.stringify(this.stateCBMImages[e.taskKey])})),a.updateParams.push(s),a.workOrder=e.workOrder,a},async submitCBMImageData(e){Ye();const t=X(),a=this.createCBMImagePayload(e);if(ye())e.value=JSON.stringify(this.stateCBMImages[e.taskKey]),e.type="images",await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"CBMImage",workorder:a.workOrder,key:e.taskKey,bindingKey:e.taskKey,payload:JSON.stringify(a),syncDate:re(),syncStatus:"Pending"}),e.value=JSON.stringify(this.stateCBMImages[e.taskKey]),await t.updateLocalTaskCBMImageData(e);else{const s=Fe();try{await s.SyncInterventionTaskData(JSON.stringify(a));const r=rt(),n=t.Intervention,i=await r.getWorkOrderDetailById(n.keyPbi);await u.interventionDetail.put(i),t.stateSelectedIntervention=i,t.setGroup(i),t.setSelectedGroup(t.stateGroups[t.stateSelectedGroup.sequence-1])}catch(r){this.globalConnectionStore.checkIsErrorNoNetwork(r)&&(e.value=JSON.stringify(this.stateCBMImages[e.taskKey]),e.type="images",await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"CBMImage",workorder:a.workOrder,key:e.taskKey,bindingKey:e.taskKey,payload:JSON.stringify(a),syncDate:re(),syncStatus:"Pending"}),e.value=JSON.stringify(this.stateCBMImages[e.taskKey]),await t.updateLocalTaskCBMImageData(e))}}},async getCBMResult(e,t=!1){let a="";const s={};if(t){if(e.value=="")return e.correctedMeasurement=e.value,e.correctedValue=a,s.rating=a,s.task=e,s}else if(e.value=="")return e.cbmMeasurement=e.value,e.value=a,s.rating=a,s.task=e,s;const r=await u.cbmMapping.where({model:e.model,psType:e.task.psType}).first();if(r){const n=r.detail.filter(i=>i.taskKey==e.taskKey&&i.cbmType!="CBM_GAP");if(n.length<1)return s.rating=a,s.task=e,s.isError=!0,s.errorMessage="Rating for this task has not been mapped yet, please insert mapping on IronLake first",s;n.every(i=>{const o=rr(i,e.value),d=ir(i,e.value);if(console.log("checkMin",o,"checkMax",d,"formula",i),a=nr(o,d,i),a)if(t){e.correctedMeasurement=e.value,e.correctedUom=i.uom,e.correctedValue=a;const c=e.task.items.find(p=>p.categoryItemType==="paramRating");return e.value=c==null?void 0:c.value,s.rating=a,s.task=e,!1}else return e.cbmMeasurement=e.value,e.uomValue=i.uom,e.value=a,s.rating=a,s.task=e,!1;else return!0})}else s.isError=!0,s.errorMessage="Rating for this task has not been mapped yet, please insert mapping on IronLake first";return a?s.rating=a:(t?e.correctedValue="":e.value="",s.rating=""),s.task=e,s},async updateDefectDetail(e,t=!1){this.createDefectYesDetail(e);const a={interventionId:e.task.id};t?a.defectHeaderId=e.defectHeaderId:a.taskId=e.task.taskKey;const s=await u.interventionDefect.get(a),r={id:s.defectDetailId,updateParams:[{keyValue:e.task.taskKey,propertyParams:[{propertyName:"detail",propertyValue:JSON.stringify(this.stateDefectYesData.detail)},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:e.task.employee.id,name:e.task.employee.name})},{propertyName:"updatedDate",propertyValue:e.submitDate},{propertyName:"otherFitterUpdatedBy",propertyValue:JSON.stringify({id:e.task.employee.id,name:e.task.employee.name})}]}],employee:{id:e.task.supervisor.id,name:e.task.supervisor.name}},n={id:s.defectHeaderId,updateParams:[{keyValue:e.task.taskKey,propertyParams:[{propertyName:"sapWorkorder",propertyValue:s.sapWorkorder},{propertyName:"updatedBy",propertyValue:JSON.stringify({id:e.task.employee.id,name:e.task.employee.name})},{propertyName:"updatedDate",propertyValue:e.submitDate}]}],employee:{id:e.task.supervisor.id,name:e.task.supervisor.name}},o=X().Intervention,d=await u.pendingTask.where({module:"Intervention",workorder:o.sapWorkOrder,key:t?e.defectHeaderId:e.task.taskKey,type:t?"DefectGeneric":"Defect",syncStatus:"Pending"}).toArray(),c=await u.pendingTask.where({module:"Intervention",workorder:o.sapWorkOrder,key:t?e.defectHeaderId:e.task.taskKey,type:"UpdateDefect",syncStatus:"Pending"}).toArray();if(d.length>0){const f=d[0];await u.pendingTask.delete(d[0].id);const I=JSON.parse(f.payload);I.defectDetail=JSON.parse(r.updateParams[0].propertyParams[0].propertyValue),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:t?"DefectGeneric":"Defect",workorder:o.sapWorkOrder,key:t?e.defectHeaderId:e.task.taskKey,bindingKey:t?e.defectHeaderId:e.task.taskKey,payload:JSON.stringify(I),syncDate:re(),syncStatus:"Pending"})}else if(c.length>0)await u.pendingTask.delete(c[0].id),await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"UpdateDefect",workorder:o.sapWorkOrder,key:t?e.defectHeaderId:e.task.taskKey,bindingKey:t?e.defectHeaderId:e.task.taskKey,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"});else if(ye())await u.pendingTask.add({module:"Intervention",section:"E-Form",type:"UpdateDefect",workorder:o.sapWorkOrder,key:t?e.defectHeaderId:e.task.taskKey,bindingKey:t?e.defectHeaderId:e.task.taskKey,payload:JSON.stringify(r),syncDate:re(),syncStatus:"Pending"});else{const f=await g.post(`${os}`,r);if(await g.post(`${ls}`,n),f.data.result.isError)throw f.data.result.message}const p=u.interventionDefect.where(a);p&&await p.delete(),s.priority=this.DefectYesData.detail.priority,s.defectData=JSON.stringify(this.DefectYesData.detail),s.updatedBy={id:e.task.employee.id,name:e.task.employee.name},s.updatedDate=e.submitDate,s.otherFitterUpdatedBy={id:e.task.employee.id,name:e.task.employee.name},await u.interventionDefect.add(s)}}}),Di={class:"row my-4"},ki={class:"bg-secondary"},Si=["src","onClick"],Ii={key:0,class:"row mt-7 mb-0"},bi=l("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),wi=[bi],na=he({__name:"ImagePreview",props:{visibility:{type:Boolean,required:!1},images:{type:Array,required:!0},type:{type:String,required:!1,default:"cbm"},reRender:{type:Boolean,default:!1},showMandatoryCaption:{type:Boolean,default:!1}},emits:["onClose","onDelete","onDownloaded"],setup(e,{emit:t}){const a=e,s=t,r=F([]),n=we(a,"visibility"),i=F([]),o=F(0),d=F([]),c=F(),p=F(""),f=F(!1),I=async()=>{if(!(d.value.length<1))for(const[O,k]of d.value.entries()){const L={fileUrl:`${k.filename}`,ver:"v1"};try{const z=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(L).toString()}`,w=await g.getBlob(z),x=w.data,B=new Blob([x]),M=(window.URL||window.webkitURL).createObjectURL(B);r.value.push({key:k.filename,value:M}),d.value[O]={...d.value[O],imgBlob:w.blob,url:E(d.value[O].filename)},i.value[O]=!1}catch(z){console.log("image",z)}}},v=()=>{n.value=!1,s("onClose",null)};it(()=>a.reRender,async()=>{await T()});const T=async()=>{if(!a.images)return;i.value=Array.apply(null,Array(a.images.length)).map(function(){return!0}),o.value=0,r.value=[];const O=C.clone(a.images);d.value=Re(a.images);const k=O.length;for(let L=o.value;L<k;L++){const z=d.value[L].filename;await H(z,L)}await I()},H=async(O,k)=>{const L={fileUrl:O,ver:"v1"};try{const z=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(L).toString()}`,x=(await g.getBlob(z)).data,B=new Blob([x]),y={};y.filename=O,y.blob=B,y.type=a.type;const M={};M.image=y,M.index=k,M.length=a.images.length,s("onDownloaded",M),window.setTimeout(async()=>{let $=window.URL||window.webkitURL;r.value.push({key:O,value:$.createObjectURL(B)}),i.value[k]=!1},1e3)}catch(z){console.log("image",z)}},E=O=>{const k=r.value.find(L=>L.key==O);return(k==null?void 0:k.value)??""},U=O=>{const k=d.value.findIndex(z=>z.filename==O),L=d.value[k];if(k>0){const z=d.value.slice(k),w=d.value.slice(0,k);c.value=[...z,...w]}else c.value=d.value;p.value=L.url,f.value=!0},G=()=>{p.value="",f.value=!1};return(O,k)=>{const L=Y("el-skeleton-item"),z=Y("el-skeleton"),w=Y("el-dialog");return h(),D(ie,null,[m(w,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=x=>n.value=x),title:"Detailed picture",width:"80%",onOpen:T,onClose:v,"custom-class":"e-form-font-family"},{default:S(()=>[l("div",Di,[(h(!0),D(ie,null,fe(d.value,(x,B)=>(h(),D("div",{key:x.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[m(z,{loading:i.value[B],animated:""},{template:S(()=>[m(L,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:S(()=>[l("div",ki,[l("img",{src:x.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:y=>U(x.filename),alt:"images"},null,8,Si)])]),_:2},1032,["loading"])]))),128))]),e.showMandatoryCaption?(h(),D("div",Ii,wi)):W("",!0)]),_:1},8,["modelValue"]),m(Za,{images:d.value,visibility:f.value,image:p.value,onHandleClose:G},null,8,["images","visibility","image"])],64)}}}),_i={class:"text-white"},Ni=["innerHTML"],Ci=l("span",{class:"text-white"},". ",-1),Pi=["innerHTML"],Ti={class:"text-white"},Ei={class:"text-white"},Ai={class:"text-white"},Fi={class:"text-white"},Ri=["onClick"],Vi=["onClick"],Oi=["onClick"],Li=["onClick"],Hi={key:0},Mi=["onClick"],Bi={key:1},$i=["onClick"],Ui=he({__name:"InterventionChecksGrid",props:{listData:{required:!0,type:Array},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{emit:t}){const a=e,s=t;Ve();const r=Mt(),n=Bt(),i=ia(),o=_e(),d=F(!1),c=F([]),p=F(null),f=async(E,U,G="")=>{s("setDeclineReason",G&&G!=""?G:""),await r.getDefectDetail(E,U)},I=async(E,U)=>{await n.getNADetail(E,U)},v=async(E,U,G)=>{const O=await i.getDefectHeaderFromServer(U,E,"taskId");o.setHeaderCbm(O),o.setFormCbmHeaderVisibility(!0),o.setPsTypeCbm(G)},T=async E=>{d.value=!0,c.value=E},H=async()=>{d.value=!1,c.value=[]};return(E,U)=>{const G=Y("inline-svg"),O=be("loading");return h(),D(ie,null,[me((h(),se(_(aa),{ref_key:"tableRecActionRef",ref:p,data:a.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row"},{default:S(()=>[m(_(ue),{label:"No",width:"50",align:"center"},{default:S(k=>[l("span",_i,P(k.row.subTask==null||k.row.subTask==""?k.$index+1:""),1)]),_:1}),m(_(ue),{prop:"recAction",label:"Intervention Checks","min-width":"200"},{default:S(k=>[k.row.subTask!=null&&k.row.subTask!=""?(h(),D(ie,{key:0},[l("span",{class:"text-white",innerHTML:k.row.subTask},null,8,Ni),Ci],64)):W("",!0),l("span",{class:"text-white",innerHTML:k.row.recAction},null,8,Pi)]),_:1}),m(_(ue),{prop:"executed",label:"Executed (Yes/No)",width:"100"},{default:S(k=>[l("span",Ti,P(k.row.executed?"Yes":"No"),1)]),_:1}),m(_(ue),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:S(k=>[l("span",Ei,P(k.row.actualInterventionDate&&k.row.actualInterventionDate!=""?_(ta)(k.row.actualInterventionDate):"-"),1)]),_:1}),m(_(ue),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:S(k=>[l("span",Ai,P(k.row.interventionStatus&&k.row.interventionStatus!=""?k.row.interventionStatus:"-"),1)]),_:1}),m(_(ue),{prop:"condition",label:"Condition","max-width":"200"},{default:S(k=>[l("span",Fi,P(k.row.condition&&k.row.condition!=""?k.row.condition:"-"),1)]),_:1}),m(_(ue),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:S(k=>[k.row.condition!=null&&k.row.condition[0]=="2"&&(k.row.spvStatus=="Decline"||k.row.plannerStatus=="Decline")?(h(),D("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:L=>f(k.row.interventionHeaderId,k.row.taskKey,k.row.declineReason)}," Declined ",8,Ri)):k.row.condition!=null&&k.row.condition[0]=="2"?(h(),D("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:L=>f(k.row.interventionHeaderId,k.row.taskKey)}," Detailed Information ",8,Vi)):k.row.condition!=null&&k.row.condition[0]=="3"?(h(),D("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:L=>I(k.row.interventionHeaderId,k.row.taskKey)}," Detailed Information ",8,Oi)):k.row.interventionStatus&&(k.row.interventionStatus.includes("X")||k.row.interventionStatus.includes("C"))?(h(),D("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:L=>v(k.row.interventionHeaderId,k.row.taskKey,k.row.psType)}," Detailed Information ",8,Li)):W("",!0)]),_:1}),m(_(ue),{width:"50"},{default:S(k=>{var L,z,w;return[k.row.images&&((L=k.row.images)==null?void 0:L.length)>0&&!((z=k.row.interventionStatus)!=null&&z.includes("X"))&&!((w=k.row.interventionStatus)!=null&&w.includes("C"))?(h(),D("div",Hi,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:x=>T(k.row.images)},[m(G,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,Mi)])):W("",!0),k.row.interventionStatus&&(k.row.interventionStatus.includes("X")||k.row.interventionStatus.includes("C"))&&k.row.condition!=null&&k.row.condition[0]=="2"?(h(),D("div",Bi,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:x=>v(k.row.interventionHeaderId,k.row.taskKey,k.row.psType)},[m(G,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,$i)])):W("",!0)]}),_:1}),m(_(ue),{width:"90"})]),_:1},8,["data"])),[[O,a.isLoading]]),m(na,{showMandatoryCaption:!0,"re-render":"",images:c.value,visibility:d.value,onOnClose:H},null,8,["images","visibility"])],64)}}}),xi={class:"text-white"},qi=["innerHTML"],Gi=l("span",{class:"text-white"},". ",-1),Ji=["innerHTML"],Ki={class:"text-white"},Wi={class:"text-white"},Yi={class:"text-white"},zi={class:"text-white"},ji=["onClick"],Zi=["onClick"],Xi=["onClick"],Qi=["onClick"],en={key:0},tn=["onClick"],an={key:1},sn=["onClick"],rn=he({__name:"InterventionCheckList",props:{listData:{required:!0,type:Array},disableSelection:{require:!0,type:Boolean,default:!0},reRender:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{emit:t}){const a=e,s=t,r=Ve(),n=Mt(),i=Bt(),o=ia(),d=_e(),c=F(!1),p=F([]),f=F(null),I=async(O,k,L="")=>{s("setDeclineReason",L&&L!=""?L:""),await n.getDefectDetail(O,k)},v=async(O,k)=>{await i.getNADetail(O,k)},T=async(O,k,L)=>{const z=await o.getDefectHeaderFromServer(k,O,"taskId");d.setHeaderCbm(z),d.setFormCbmHeaderVisibility(!0),d.setPsTypeCbm(L)},H=async O=>{c.value=!0,p.value=O},E=async()=>{c.value=!1,p.value=[]},U=async O=>{console.log("checks row",O),r.updateInterventionCheckListMandatory(O)},G=()=>{console.log("set selection ****************"),console.log("listData",a.listData),a.listData.length>0?a.listData.filter(k=>k.isMandatory==!0).forEach(k=>{f.value.toggleRowSelection(k,!0)}):(console.log("ELSE CLEAR SELECTION"),f.value.clearSelection()),console.log("**************************************************")};return it(()=>a.reRender===!0,()=>{console.log("rerender true"),G()}),(O,k)=>{const L=Y("inline-svg"),z=be("loading");return h(),D(ie,null,[me((h(),se(_(aa),{ref_key:"tableRecActionRef",ref:f,data:a.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row",onSelectionChange:U,"row-key":"taskKey","select-on-indeterminate":""},{default:S(()=>[m(_(ue),{"reserve-selection":"",class:"table-selection","class-name":"table-selection",type:"selection",width:52,align:"right","header-align":"right",selectable:()=>!a.disableSelection},null,8,["selectable"]),m(_(ue),{"class-name":"table-number",label:"No",width:"50",align:"center"},{default:S(w=>[l("span",xi,P(w.row.subTask==null||w.row.subTask==""?w.$index+1:""),1)]),_:1}),m(_(ue),{prop:"recAction",label:"Intervention Checks","min-width":"200"},{default:S(w=>[w.row.subTask!=null&&w.row.subTask!=""?(h(),D(ie,{key:0},[l("span",{class:"text-white",innerHTML:w.row.subTask},null,8,qi),Gi],64)):W("",!0),l("span",{class:"text-white",innerHTML:w.row.recAction},null,8,Ji)]),_:1}),m(_(ue),{prop:"executed",label:"Executed (Yes/No)",width:"100"},{default:S(w=>[l("span",Ki,P(w.row.executed?"Yes":"No"),1)]),_:1}),m(_(ue),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:S(w=>[l("span",Wi,P(w.row.actualInterventionDate&&w.row.actualInterventionDate!=""?_(ta)(w.row.actualInterventionDate):"-"),1)]),_:1}),m(_(ue),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:S(w=>[l("span",Yi,P(w.row.interventionStatus&&w.row.interventionStatus!=""?w.row.interventionStatus:"-"),1)]),_:1}),m(_(ue),{prop:"condition",label:"Condition","max-width":"200"},{default:S(w=>[l("span",zi,P(w.row.condition&&w.row.condition!=""?w.row.condition:"-"),1)]),_:1}),m(_(ue),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:S(w=>[w.row.condition!=null&&w.row.condition[0]=="2"&&(w.row.spvStatus=="Decline"||w.row.plannerStatus=="Decline")?(h(),D("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:x=>I(w.row.interventionHeaderId,w.row.taskKey,w.row.declineReason)}," Declined ",8,ji)):w.row.condition!=null&&w.row.condition[0]=="2"?(h(),D("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:x=>I(w.row.interventionHeaderId,w.row.taskKey)}," Detailed Information ",8,Zi)):w.row.condition!=null&&w.row.condition[0]=="3"?(h(),D("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:x=>v(w.row.interventionHeaderId,w.row.taskKey)}," Detailed Information ",8,Xi)):w.row.interventionStatus&&(w.row.interventionStatus.includes("X")||w.row.interventionStatus.includes("C"))?(h(),D("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:x=>T(w.row.interventionHeaderId,w.row.taskKey,w.row.psType)}," Detailed Information ",8,Qi)):W("",!0)]),_:1}),m(_(ue),{width:"50"},{default:S(w=>{var x,B,y;return[w.row.images&&((x=w.row.images)==null?void 0:x.length)>0&&!((B=w.row.interventionStatus)!=null&&B.includes("X"))&&!((y=w.row.interventionStatus)!=null&&y.includes("C"))?(h(),D("div",en,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:M=>H(w.row.images)},[m(L,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,tn)])):W("",!0),w.row.interventionStatus&&(w.row.interventionStatus.includes("X")||w.row.interventionStatus.includes("C"))&&w.row.condition!=null&&w.row.condition[0]=="2"?(h(),D("div",an,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:M=>T(w.row.interventionHeaderId,w.row.taskKey,w.row.psType)},[m(L,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,sn)])):W("",!0)]}),_:1}),m(_(ue),{width:"90"})]),_:1},8,["data"])),[[z,a.isLoading]]),m(na,{showMandatoryCaption:!0,"re-render":"",images:p.value,visibility:c.value,onOnClose:E},null,8,["images","visibility"])],64)}}}),nn=e=>(Oe("data-v-f6a628e5"),e=e(),Le(),e),on={class:"table-preview"},ln=nn(()=>l("thead",null,[l("tr",null,[l("th",{class:"no-column"},"No"),l("th",{class:"col-task"},"Task"),l("th",{class:"col-condition"},"Condition")])],-1)),dn={key:0},cn={class:"cel-no"},un={key:1},pn={class:"cel-no"},mn={class:"row justify-content-between align-items-center"},fn={class:"col-7"},yn={class:"col-5"},hn={key:2},vn={class:"cel-no"},gn={class:"row justify-content-between align-items-center"},Dn={class:"col-7",style:{"word-wrap":"break-word"}},kn={class:"col-5"},Sn={class:"row justify-content-between align-items-center"},In={class:"col-8"},bn={class:"col-4"},wn={class:"me-1"},_n={key:3},Nn={class:"cel-no"},Cn={class:"row justify-content-between align-items-center"},Pn={class:"col-5"},Tn={class:"col-7"},En={class:"row justify-content-between align-items-center"},An={class:"col-5"},Fn={class:"col-7"},Rn={key:4},Vn={class:"cel-no"},On={class:"d-flex"},Ln={class:"col-8 me-6"},Hn={class:"col-2"},Mn={class:"btn btn-sm btn-icon btn-bg-light"},Bn={key:5},$n={class:"cel-no"},Un={class:"d-flex"},xn={class:"col-8 me-6"},qn={class:"col-2"},Gn={class:"btn btn-sm btn-icon btn-bg-light"},Jn={key:6},Kn={class:"cel-no"},Wn={class:"row justify-content-between align-items-center"},Yn={class:"col-7"},zn={style:{"word-wrap":"break-word"}},jn={class:"col-5"},Zn={class:"row justify-content-between align-items-center"},Xn={class:"col-9"},Qn={class:"col-3"},eo={class:"btn btn-sm btn-icon btn-bg-light"},to={key:7},ao={class:"cel-no"},so={class:"row justify-content-between align-items-center"},ro={class:"col-7",style:{"word-wrap":"break-word"}},io={class:"col-5"},no={class:"row justify-content-between align-items-center"},oo={class:"col-8"},lo={class:"col-4"},co={class:"me-1"},uo={class:"d-flex"},po={class:"col-8 me-6"},mo={class:"col-2"},fo={class:"btn btn-sm btn-icon btn-bg-light"},yo=he({__name:"PreviewTable",props:{taskNo:{type:Number,default:1},typeTask:{type:Number,default:0},task:{type:String,default:""},optionsSelectCondition:{default:[],type:Array},uom:{type:String,default:""}},setup(e){const t=e,a=F(""),s=F(""),r=F(""),n=F(""),i=F([{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"},{label:"X",value:"X"}]);return it(()=>t.taskNo,()=>{a.value="",s.value="",r.value="",n.value=""}),(o,d)=>{const c=Y("el-option"),p=Y("el-select"),f=Y("el-input"),I=Y("NwImg");return h(),D("div",on,[l("table",null,[ln,l("tbody",null,[e.typeTask==1?(h(),D("tr",dn,[l("td",cn,P(e.taskNo),1),l("td",null,[l("div",null,[l("span",null,P(e.task),1)])]),l("td",null,[m(p,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=v=>a.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(e.optionsSelectCondition,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):W("",!0),e.typeTask==2?(h(),D("tr",un,[l("td",pn,P(e.taskNo),1),l("td",null,[l("div",mn,[l("div",fn,[l("span",null,P(e.task),1)]),l("div",yn,[m(f,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=v=>r.value=v),placeholder:"Additional Information",size:"small"},null,8,["modelValue"])])])]),l("td",null,[m(p,{modelValue:a.value,"onUpdate:modelValue":d[2]||(d[2]=v=>a.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(e.optionsSelectCondition,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):W("",!0),e.typeTask==3?(h(),D("tr",hn,[l("td",vn,P(e.taskNo),1),l("td",null,[l("div",gn,[l("div",Dn,P(e.task),1),l("div",kn,[l("div",Sn,[l("div",In,[m(f,{modelValue:r.value,"onUpdate:modelValue":d[3]||(d[3]=v=>r.value=v),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),l("div",bn,[l("span",wn,P(e.uom),1)])])])])]),l("td",null,[m(p,{modelValue:a.value,"onUpdate:modelValue":d[4]||(d[4]=v=>a.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(e.optionsSelectCondition,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):W("",!0),e.typeTask==4?(h(),D("tr",_n,[l("td",Nn,P(e.taskNo),1),l("td",null,[l("div",Cn,[l("div",Pn,[l("span",null,P(e.task),1)]),l("div",Tn,[l("div",En,[l("div",An,[m(f,{modelValue:r.value,"onUpdate:modelValue":d[5]||(d[5]=v=>r.value=v),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),l("div",Fn,[m(f,{modelValue:n.value,"onUpdate:modelValue":d[6]||(d[6]=v=>n.value=v),placeholder:"Additional Information",size:"small"},null,8,["modelValue"])])])])])]),l("td",null,[m(p,{modelValue:a.value,"onUpdate:modelValue":d[7]||(d[7]=v=>a.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(e.optionsSelectCondition,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):W("",!0),e.typeTask==7?(h(),D("tr",Rn,[l("td",Vn,P(e.taskNo),1),l("td",null,[l("div",null,[l("span",null,P(e.task),1)])]),l("td",null,[l("div",On,[l("div",Ln,[m(p,{modelValue:s.value,"onUpdate:modelValue":d[8]||(d[8]=v=>s.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(i.value,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",Hn,[l("button",Mn,[m(I,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):W("",!0),e.typeTask==8?(h(),D("tr",Bn,[l("td",$n,P(e.taskNo),1),l("td",null,[l("div",null,[l("span",null,P(e.task),1)])]),l("td",null,[l("div",Un,[l("div",xn,[m(p,{modelValue:s.value,"onUpdate:modelValue":d[9]||(d[9]=v=>s.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(i.value,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",qn,[l("button",Gn,[m(I,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):W("",!0),e.typeTask==9?(h(),D("tr",Jn,[l("td",Kn,P(e.taskNo),1),l("td",null,[l("div",Wn,[l("div",Yn,[l("span",zn,P(e.task),1)]),l("div",jn,[l("div",Zn,[l("div",Xn,[m(p,{modelValue:s.value,"onUpdate:modelValue":d[10]||(d[10]=v=>s.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(i.value,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",Qn,[l("button",eo,[m(I,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])]),l("td",null,[m(p,{modelValue:a.value,"onUpdate:modelValue":d[11]||(d[11]=v=>a.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(e.optionsSelectCondition,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):W("",!0),e.typeTask==10?(h(),D("tr",to,[l("td",ao,P(e.taskNo),1),l("td",null,[l("div",so,[l("div",ro,P(e.task),1),l("div",io,[l("div",no,[l("div",oo,[m(f,{modelValue:r.value,"onUpdate:modelValue":d[12]||(d[12]=v=>r.value=v),placeholder:"Input Value",size:"small"},null,8,["modelValue"])]),l("div",lo,[l("span",co,P(e.uom),1)])])])])]),l("td",null,[l("div",uo,[l("div",po,[m(p,{modelValue:s.value,"onUpdate:modelValue":d[13]||(d[13]=v=>s.value=v),placeholder:"Choose one",size:"small"},{default:S(()=>[(h(!0),D(ie,null,fe(i.value,v=>(h(),se(c,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",mo,[l("button",fo,[m(I,{src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"12px",width:"14px"},alt:"camera"})])])])])])):W("",!0)])])])}}}),ho=Ce(yo,[["__scopeId","data-v-f6a628e5"]]),vo={key:0,class:"mb-5"},go=l("span",null,"Is the Intervention Check required to assign to specific component?",-1),Do={class:"my-3"},ko={key:0},So={key:1},Io=l("h5",{class:"form-label fs-5 fw-bolder text-dark"}," Preview ",-1),bo={class:"dialog-footer"},wo=he({__name:"FormAdditionalTask",props:{visibility:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},emits:["handle-close","handle-submit"],setup(e,{emit:t}){const a=e,s=t,r=Ve(),n=_e(),i=F(!1),o=F([]),d=[5,6,7,8,9,10,11],c=we(a,"visibility"),p=q(()=>r.formDataAdditional),f=q(()=>r.loadingConditionOptions),I=q(()=>n.componentOption),v=F([]),T=F(!1),H=Ht().shape({recAction:Se().required("Intervention Check is mandatory").nullable(),typeTaskId:cr().required("Task Type is mandatory").nullable(),uom:Se().when("typeTaskId",{is:$=>$==3||$==10,then:Se().required("UoM is mandatory").nullable()})}),E=()=>a.isPreview?"Additional Task Details":a.isEdit?"Edit Other Additional Intervention Check":"Add Other Additional Intervention Check",U=()=>{k(""),z(0),r.resetFormAdditionalTask(),i.value=!1,o.value=[]},G=()=>{M().length>0&&(i.value=!0,p.value.listComponent.forEach(J=>{!J.isDeleted&&J.componentName&&o.value.push(J.componentName)}))},O=($=!1)=>{y(),U(),s("handle-close",$)},k=$=>{p.value.recAction=$},L=$=>{p.value.uom=$,y()},z=async $=>{y(),p.value.typeTaskId=$,L(""),$&&await r.getLookupConditionOption($),d.includes($)||x(!1)},w=$=>{o.value=$},x=$=>{if($){const J=M();o.value=J.map(V=>V.componentName)}else i.value=!1,o.value=[]},B=async()=>{if(T.value=!1,y(),await H.validate(p.value,{abortEarly:!1}).catch(J=>{T.value=!0,v.value=J.errors}),T.value)return;if(await r.checkIsAdditionalTaskDuplicate(p.value)){T.value=!0,v.value=["Intervention check already exist"];return}if(p.value.listComponent.length==0)p.value.listComponent=o.value.map(J=>({componentName:J,isDeleted:!1}));else{const J=p.value.listComponent.filter(V=>{const le=o.value.findIndex(oe=>oe==V.componentName);if(V.isDeleted&&le==-1||le==-1)return V});p.value.listComponent=J.map(V=>({componentName:V.componentName,isDeleted:!0})),o.value.forEach(V=>{V&&p.value.listComponent.push({componentName:V,isDeleted:!1})})}console.log(p.value.listComponent),s("handle-submit",p.value)},y=()=>{T.value=!1,v.value=[]},M=()=>p.value.listComponent.filter($=>!$.isDeleted);return($,J)=>{const V=Y("el-switch"),le=Y("el-button"),oe=Y("el-dialog"),te=be("loading");return h(),se(oe,{modelValue:c.value,"onUpdate:modelValue":J[1]||(J[1]=pe=>c.value=pe),title:E(),width:"60%",onOpen:G,onClose:O},ea({default:S(()=>[m(nt,{name:"fade"},{default:S(()=>[T.value?(h(),se(ot,{key:0,errorMessages:v.value,onResetForm:y},null,8,["errorMessages"])):W("",!0)]),_:1}),m(_(Lt),{id:"kt_filter_form",class:"row g-2 my-4"},{default:S(()=>[m(qe,{value:p.value.recAction,readonly:a.isPreview,placeholder:"Add Intervention Check",label:"Intervention Check",name:"InterventionCheck",textInputType:"textarea",max:255,onHandleChange:k},null,8,["value","readonly"]),m(Ue,{value:p.value.typeTaskId,"is-disabled":a.isPreview,placeholder:"Add Task Type",label:"Task Type",name:"TypeTask",onHandleChange:z,options:_(r).typeTaskOptions},null,8,["value","is-disabled","options"]),p.value.typeTaskId==3||p.value.typeTaskId==10?(h(),se(ur,{key:0,"is-disabled":a.isPreview,value:p.value.uom,placeholder:"Add UoM",label:"UoM",name:"Uom",onHandleChange:L,options:_(r).uomOptions},null,8,["is-disabled","value","options"])):W("",!0)]),_:1}),d.includes(p.value.typeTaskId)?(h(),D("div",vo,[go,l("div",Do,[m(V,{modelValue:i.value,"onUpdate:modelValue":J[0]||(J[0]=pe=>i.value=pe),"active-text":i.value?"Required":"Not Required",onChange:x,disabled:a.isPreview},null,8,["modelValue","active-text","disabled"])]),i.value?(h(),D("div",ko,[m(Ue,{value:o.value,"is-disabled":a.isPreview,placeholder:"Choose component",name:"componentList",options:I.value,isMultiple:!0,onHandleChange:w},null,8,["value","is-disabled","options"])])):W("",!0)])):W("",!0),p.value.recAction&&p.value.typeTaskId?(h(),D("div",So,[Io,me((h(),D("div",null,[m(ho,{taskNo:p.value.sequence,typeTask:p.value.typeTaskId,task:p.value.recAction,optionsSelectCondition:_(r).conditionOptions,uom:p.value.uom},null,8,["taskNo","typeTask","task","optionsSelectCondition","uom"])])),[[te,f.value]])])):W("",!0)]),_:2},[a.isPreview?void 0:{name:"footer",fn:S(()=>[l("span",bo,[m(le,{type:"secondary",onClick:O},{default:S(()=>[ve("Cancel")]),_:1}),m(le,{type:"primary",onClick:B},{default:S(()=>[ve("Submit")]),_:1})])]),key:"0"}]),1032,["modelValue","title"])}}}),_o=e=>(Oe("data-v-d55e6b79"),e=e(),Le(),e),No={class:"text-white"},Co={class:"text-white"},Po=["onClick"],To={class:"me-2"},Eo=_o(()=>l("em",{class:"fa fa-eye",style:{color:"black",cursor:"pointer"}},null,-1)),Ao={class:"text-white"},Fo={class:"text-white"},Ro={class:"text-white"},Vo={class:"text-white"},Oo=["onClick"],Lo=["onClick"],Ho=["onClick"],Mo=["onClick"],Bo={key:0},$o=["onClick"],Uo={key:1},xo=["onClick"],qo={class:"d-flex justify-space-between"},Go=["onClick"],Jo=["onClick"],Ko=["disabled"],Wo={class:"svg-icon svg-icon-1x text-white"},Yo=he({__name:"AdditionalTaskGrid",props:{listData:{required:!0,type:Array},canEditAndDelete:{required:!0,type:Boolean},isLoading:{type:Boolean,default:!1}},emits:["setDeclineReason"],setup(e,{expose:t,emit:a}){const s=F(!1),r=F([]),n=e,i=a,o=Ve(),d=Mt(),c=Bt(),p=ia(),f=_e(),I={additionalTaskId:-1,sequence:0,recAction:"",executed:!1,actualInterventionDate:"",interventionStatus:"",condition:"",detailedInformation:"",isActive:!0,isDeleted:!1,typeTaskId:0,typeTask:"",uom:"",listComponent:[]},v=F({...I}),T=F({...I}),H=F(!1),E=F(!1),U=F(!1),G=F({sequence:"",recAction:"",typeTask:"",uom:""}),O=q(()=>o.isError),k=q(()=>o.errors);Qt(()=>{G.value={sequence:"",recAction:"",typeTask:"",uom:""}});const L=j=>{var K;return j?(K=o.typeTaskOptions.find(ne=>ne.value==j))==null?void 0:K.label:""},z=()=>{H.value=!1,U.value=!1},w=j=>{ja("Are you sure you want to submit ?").then(K=>{K.isConfirmed&&(E.value?(o.updateAdditionalTask(v.value,j),V()):o.insertAdditionalTask(j),qs("Form has been successfully submitted!").then(()=>{H.value=!1}))})},x=async j=>{$(j),U.value=!0,await o.getLookupConditionOption(j.typeTaskId)},B=async(j,K,ne="")=>{i("setDeclineReason",ne&&ne!=""?ne:""),await d.getDefectDetail(j,K)},y=async(j,K)=>{await c.getNADetail(j,K)},M=()=>{o.addAdditionalForm(),E.value=!1,H.value=!0},$=async j=>{v.value={...j,uom:j.uom||""},T.value={...j,uom:j.uom||""},console.log(j),o.setAdditionalForm(T.value),E.value=!0,H.value=!0},J=j=>{o.deleteAdditionalTask(j)},V=async()=>{le(),v.value={...I},T.value={...I}},le=()=>{o.setErrors([])},oe=async(j,K,ne)=>{const ce=await p.getDefectHeaderFromServer(K,j,"taskId");f.setHeaderCbm(ce),f.setFormCbmHeaderVisibility(!0),f.setPsTypeCbm(ne)},te=async j=>{s.value=!0,r.value=j},pe=async()=>{s.value=!1,r.value=[]};return t({editedItem:T,handleCancelEditRow:V}),(j,K)=>{const ne=Y("inline-svg"),ce=Y("el-tooltip"),ge=be("loading");return h(),D(ie,null,[me((h(),se(_(aa),{data:n.listData,"element-loading-background":"#2d2b39b3",style:{width:"100%"},"empty-text":"No Data",class:"table_dark-row table-dark","header-row-class-name":"table_dark-header","row-class-name":"table_dark-row"},{default:S(()=>[m(_(ue),{label:"No",width:"52",align:"center"},{default:S(b=>[l("span",No,P(b.row.sequence),1)]),_:1}),m(_(ue),{prop:"recAction",label:"Intervention Checks","min-width":"150"},{default:S(({row:b})=>[l("span",Co,P(b.recAction),1)]),_:1}),m(_(ue),{prop:"typeTaskId",label:"Type Task",width:"161"},{default:S(b=>[b.row.typeTaskId?(h(),D("button",{key:0,size:"small",class:"btn btn-sm btn-bg-light",onClick:Ie=>x(b.row),style:{padding:"5px !important"}},[l("span",To,P(L(b.row.typeTaskId)||b.row.typeTask),1),Eo],8,Po)):W("",!0)]),_:1}),m(_(ue),{prop:"executed",label:"Executed (Yes/No)",width:"79"},{default:S(b=>[l("span",Ao,P(b.row.executed?"Yes":"No"),1)]),_:1}),m(_(ue),{prop:"actualInterventionDate",label:"Actual Intervention Date","max-width":"200"},{default:S(b=>[l("span",Fo,P(b.row.actualInterventionDate&&b.row.actualInterventionDate!=""?_(ta)(b.row.actualInterventionDate):"-"),1)]),_:1}),m(_(ue),{prop:"interventionStatus",label:"Result","min-width":"100"},{default:S(b=>[l("span",Ro,P(b.row.interventionStatus&&b.row.interventionStatus!=""?b.row.interventionStatus:"-"),1)]),_:1}),m(_(ue),{prop:"condition",label:"Condition","max-width":"200"},{default:S(b=>[l("span",Vo,P(b.row.condition&&b.row.condition!=""?b.row.condition:"-"),1)]),_:1}),m(_(ue),{prop:"detailedInformation",label:"Detailed Information",width:"150",align:"center"},{default:S(b=>[b.row.condition!=null&&b.row.condition[0]=="2"&&(b.row.spvStatus=="Decline"||b.row.plannerStatus=="Decline")?(h(),D("button",{key:0,size:"small",class:"btn-intervention__declined fw-bolder",onClick:Ie=>B(b.row.interventionHeaderId,b.row.taskKey,b.row.declineReason)}," Declined ",8,Oo)):b.row.condition!=null&&b.row.condition[0]=="2"?(h(),D("button",{key:1,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:Ie=>B(b.row.interventionHeaderId,b.row.taskKey)}," Detailed Information ",8,Lo)):b.row.condition!=null&&b.row.condition[0]=="3"?(h(),D("button",{key:2,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:Ie=>y(b.row.interventionHeaderId,b.row.taskKey)}," Detailed Information ",8,Ho)):b.row.interventionStatus&&(b.row.interventionStatus.includes("X")||b.row.interventionStatus.includes("C"))?(h(),D("button",{key:3,size:"small",class:"btn-intervention__detailed__information fw-bolder",onClick:Ie=>oe(b.row.interventionHeaderId,b.row.taskKey,b.row.psType)}," Detailed Information ",8,Mo)):W("",!0)]),_:1}),m(_(ue),{width:"50"},{default:S(b=>{var Ie,kt,St;return[b.row.images&&((Ie=b.row.images)==null?void 0:Ie.length)>0&&!((kt=b.row.interventionStatus)!=null&&kt.includes("X"))&&!((St=b.row.interventionStatus)!=null&&St.includes("C"))?(h(),D("div",Bo,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:It=>te(b.row.images)},[m(ne,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,$o)])):W("",!0),b.row.interventionStatus&&(b.row.interventionStatus.includes("X")||b.row.interventionStatus.includes("C"))&&b.row.condition!=null&&b.row.condition[0]=="2"?(h(),D("div",Uo,[l("button",{size:"small",class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:It=>oe(b.row.interventionHeaderId,b.row.taskKey,b.row.psType)},[m(ne,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"12",height:"12"})],8,xo)])):W("",!0)]}),_:1}),m(_(ue),{width:"90","class-name":"el-table__body-wrapper fixed-right"},ea({_:2},[e.canEditAndDelete?{name:"default",fn:S(b=>[l("div",qo,[m(ce,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:S(()=>[l("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:Ie=>$(b.row)},[m(ne,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Go)]),_:2},1024),m(ce,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:S(()=>[l("button",{class:"btn btn-sm btn-icon btn-bg-light me-1",onClick:Ie=>J(b.row)},[m(ne,{src:"/media/svg/tables/rows/trash-delete-blue.svg",width:"12",height:"12"})],8,Jo)]),_:2},1024)])]),key:"0"}:void 0]),1024)]),_:1},8,["data"])),[[ge,n.isLoading]]),e.canEditAndDelete?(h(),se(ce,{key:0,class:"box-item",effect:"dark",content:T.value.additionalTaskId!=-1?"Please finish the edited item first":"Add additional task",placement:"bottom"},{default:S(()=>[l("button",{disabled:_(o).loading,class:"fw-bolder my-5 text-green btn-additional-task",onClick:M},[l("span",Wo,[m(ne,{src:"/media/icons/duotune/arrows/arr075.svg"})]),ve(" If required, please add other specific intervention check ")],8,Ko)]),_:1},8,["content"])):W("",!0),m(nt,{name:"fade"},{default:S(()=>[O.value?(h(),se(ot,{key:0,ref:"additionalTaskError",errorMessages:k.value,onResetForm:le},null,8,["errorMessages"])):W("",!0)]),_:1}),m(na,{showMandatoryCaption:!0,"re-render":"",images:r.value,visibility:s.value,onOnClose:pe},null,8,["images","visibility"]),m(wo,{"is-preview":U.value,"is-edit":E.value,visibility:H.value,onHandleClose:z,onHandleSubmit:w},null,8,["is-preview","is-edit","visibility"])],64)}}}),zo=Ce(Yo,[["__scopeId","data-v-d55e6b79"]]),jo="/media/svg/dma/icons/Repair.png",Zo=e=>typeof e=="string"?e.replaceAll(" - ","<span class='letter-space-hypen'> - </span>").replaceAll("  ","<span class='letter-space-hypen'>  </span>"):e,oa=(e,t=!1)=>{if(e&&typeof e=="string"){const a=e.split("|");let s='<ul style="list-style-type: none; padding-left:0; margin-bottom: 0;">';return a.forEach(r=>{if(r.indexOf(";")>-1){const i=r.split(";"),o=i[1]==""?"":`${i[1]}.`;let d;!t&&i.length==3||t&&i.length==4?d=i[2]??"":!t&&i.length>3?d=i.splice(2,i.length-1).join(";"):t&&i.length>4&&(d=i.splice(2,i.length-2).join(";")),s+=`<li>${o} ${d??""}</li>`}else s+=`<li>${r}</li>`}),s+="</ul>",t&&e.includes(";0")&&(e=e.replace(";0","")),Zo(s)}return e},cs=e=>(Oe("data-v-b156c6a9"),e=e(),Le(),e),Xo={class:"row px-2 item mx-1 w-100 defect-panel-header",style:{color:"#909399",background:"#3d3d4b"}},Qo=Ls('<div class="col align-items-center d-flex text-break" data-v-b156c6a9>Task Description</div><div class="text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center" data-v-b156c6a9>Priority</div><div class="col-1 column-sm-20-percent column-md-24-percent column-lg-15-percent column-xl-15-percent align-items-center d-flex justify-content-center" style="padding-left:0;" data-v-b156c6a9>Review Status</div><div class="col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center" style="padding-left:0;" data-v-b156c6a9>Work Order</div><div class="col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex" style="word-break:initial !important;" data-v-b156c6a9>Repair Status</div>',5),el=[Qo],tl={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},al=cs(()=>l("p",{class:"el-table__empty-text",style:{"text-align":"center"}},"No Data",-1)),sl=[al],rl={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},il={class:"col align-items-center d-flex text-break"},nl=["innerHTML"],ol={class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center"},ll={class:"text-center",style:{"font-weight":"600",color:"white"}},dl={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-15-percent column-xl-15-percent align-items-center d-flex justify-content-center"},cl=["onClick"],ul=["onClick"],pl={class:"row"},ml={key:0,class:"pe-0"},fl=["value"],yl={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},hl=cs(()=>l("img",{src:jo,alt:""},null,-1)),vl=[hl],gl={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Dl=he({__name:"GenericDefect",props:{listData:{required:!0,type:Array},loading:{required:!0,type:Boolean}},emits:["onViewDetailInformation"],setup(e,{emit:t}){const a=e,s=t,r=(f,I)=>{const v=!!f.declineReason,T=!!I.declineReason;return v<T?-1:v>T?1:0},n=(f,I)=>{let v="light-yellow color-dark-yellow";const T=I==null?void 0:I.find(H=>H.id===f);if(T){switch(T.status){case"Submited":v="light-yellow color-dark-yellow";break;case"Acknowledge":v="light-green color-dark-green";break}T.priority===void 0&&(v="light-green color-dark-green")}return v},i=f=>{let I="";switch(f){case"P1":I="red";break;case"P2":I="gold";break;case"P3":I="yellow";break;case"P4":I="green";break}return I},o=f=>{s("onViewDetailInformation",{type:"defectGeneric",taskId:f.taskId,taskNo:f.taskNo,taskDesc:f.taskDesc,taskStatus:f.status,taskDeclineReason:f.declineReason,taskDeclineDate:f.declineDate,taskDeclineBy:f.declineBy,defectHeaderId:f.id})},d=q(()=>C.cloneDeep(a.listData).sort(r)),c=f=>{let I=f.repairedStatus=="Repaired"?"green":"red";return I=f.priority?I:"green",I},p=f=>f.plannerStatus=="Decline"||f.status=="Decline";return(f,I)=>{const v=Y("el-table-column"),T=Y("el-table"),H=be("loading");return e.loading?me((h(),se(T,{key:0,"element-loading-background":"#2d2b39b3",data:[],style:{width:"100%"},"empty-text":"No Data",class:"table-row table-dark","header-row-class-name":"table-header","row-class-name":"table-row"},{default:S(()=>[m(v,{label:"Task Description"}),m(v,{label:"Priority",align:"center",width:"80"}),m(v,{label:"Review Status",align:"center",width:"170"}),m(v,{label:"Work Order",align:"center",width:"250"}),m(v,{label:"Repair Status",align:"center",width:"150"})]),_:1})),[[H,e.loading]]):(h(),D(ie,{key:1},[me((h(),D("div",Xo,el)),[[H,e.loading]]),d.value.length<1?(h(),D("div",tl,sl)):(h(!0),D(ie,{key:1},fe(d.value,E=>(h(),D("div",{key:E.id,class:"item px-2 my-2 mx-1"},[l("div",rl,[l("div",il,[l("span",{class:"text-break",innerHTML:_(oa)(E.taskDesc??"")},null,8,nl)]),l("div",ol,[p(E)?W("",!0):(h(),D("div",{key:0,class:ke(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",i(E.priority??"")]),style:{"margin-top":"6px"}},[l("span",ll,P(E.priority),1)],2))]),l("div",dl,[p(E)?(h(),D("div",{key:1,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red",onClick:U=>o(E),style:{"font-size":"11px !important"}}," Declined ",8,ul)):(h(),D("div",{key:0,class:ke(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center",n(E.id,d.value)]),onClick:U=>o(E),style:{"font-size":"11px !important"}}," Detailed Information ",10,cl))]),l("div",{class:ke(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",E.priority===void 0?"invisible":""])},[l("div",pl,[p(E)?W("",!0):(h(),D("div",ml,[l("input",{type:"text",class:"form-control mou-input",value:E.defectWorkorder,disabled:""},null,8,fl)]))])],2),l("div",yl,[p(E)?W("",!0):(h(),D("div",{key:0,class:ke(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",c(E)]),style:{"margin-top":"6px",cursor:"initial"}},vl,2))])]),l("div",gl,P(E.createdBy.name)+", "+P(E.updatedDate&&E.updatedDate!=""?E.updatedDate:E.createdDate),1)]))),128))],64))}}}),kl=Ce(Dl,[["__scopeId","data-v-b156c6a9"]]),Sl=e=>(Oe("data-v-1e1482f5"),e=e(),Le(),e),Il={class:"py-2 ps-0 pe-2 w-100"},bl={class:"d-flex align-items-center"},wl=Sl(()=>l("div",{class:"flex-fill large-camera-container"},[l("span",null,"Please take a photo of the defect identified")],-1)),_l={class:"ms-2"},Nl={key:0,class:"d-flex justify-content-center ms-2"},Cl={class:"text-white"},Pl=he({__name:"DefectViewCamera",props:{defectImages:{type:Array,required:!0}},emits:["onImageDownloaded"],setup(e,{emit:t}){const a=e,s=t,r=F(!1),n=Pt(()=>a.defectImages.length),i=Pt(()=>a.defectImages??[]),o=Pt(()=>"disabled"),d=Pt(()=>"not-allowed"),c=()=>{r.value=!0},p=()=>{r.value=!1},f=I=>{s("onImageDownloaded",I)};return(I,v)=>{const T=Y("NwImg");return h(),D(ie,null,[l("div",Il,[l("div",bl,[l("div",{class:ke(["d-flex w-100 align-items-center camera-wrapper py-2",_(o)])},[wl,l("div",_l,[l("div",{class:ke(["p-2 justify-items-center rounded",_(d)]),style:{background:"#F4F6F8"}},[_(n)>0&&_(d)!="not-allowed"?(h(),se(T,{key:0,src:"/media/svg/dma/camera/e-form/png/cam-user.png",style:{height:"20px",width:"24px"},class:ke(_(d)),alt:"camera"},null,8,["class"])):_(d)=="not-allowed"?(h(),se(T,{key:1,src:"/media/svg/dma/camera/e-form/png/cam-read.png",style:{height:"20px",width:"24px"},class:ke(_(d)),alt:"camera"},null,8,["class"])):(h(),se(T,{key:2,src:"/media/svg/dma/camera/e-form/png/cam-active.png",style:{height:"20px",width:"24px"},class:ke(_(d)),alt:"camera"},null,8,["class"]))],2)]),_(n)&&_(n)>0?(h(),D("div",Nl,[l("button",{class:"btn btn-sm btn-icon btn-bg-success lg-btn-icon",onClick:c,style:{"background-color":"#18AF4A"}},[l("label",Cl,"+"+P(_(n)),1)])])):W("",!0)],2)])]),m(Qs,{"is-monitoring":!0,images:_(i),visibility:r.value,showDeleteButton:!1,type:"defect","is-mandatory":!1,onOnClose:p,onOnDownloaded:f},null,8,["images","visibility"])],64)}}}),us=Ce(Pl,[["__scopeId","data-v-1e1482f5"]]),za=(e,t=":")=>{if(!e)return"";const a=e.split(t);return a.length>=2?a.slice(1).join(t):""},de=e=>(Oe("data-v-db28e701"),e=e(),Le(),e),Tl={class:"el-dialog__title"},El={key:0,class:"red-bg text-dark-red p-1"},Al={key:1,class:"status-badge-dialog-header approved-badge p-1"},Fl=["innerHTML"],Rl={key:0,class:"mt-1 py-2"},Vl={class:"d-flex flex-column"},Ol={class:"row mb-1"},Ll={class:"col"},Hl={class:"form-floating declined-text-box"},Ml={class:"form-control"},Bl=de(()=>l("label",null,"Declined Reason*",-1)),$l={key:0,class:"mb-2 text-end"},Ul={key:1,class:"mt-1 py-2"},xl={class:"row mb-1"},ql={class:"col"},Gl={key:0,class:"form-floating approved-text-box"},Jl={class:"form-control",style:{"white-space":"break-spaces"}},Kl=de(()=>l("label",null,"Approved",-1)),Wl={class:"d-flex flex-row justify-content-between"},Yl={class:"p-2 d-flex flex-row flex-grow-1"},zl={class:"flex-fill"},jl={class:"form-floating"},Zl=["innerHTML"],Xl=de(()=>l("label",{for:"floatingInput"},"Asset Number",-1)),Ql={class:"flex-fill ps-3"},ed={class:"form-floating"},td=["innerHTML"],ad=de(()=>l("label",{for:"floatingInput"},"Serial Number",-1)),sd={class:"flex-fill ps-3"},rd={class:"form-floating"},id=["innerHTML"],nd=de(()=>l("label",{for:"floatingInput"},"Ownership",-1)),od={class:"d-flex flex-row justify-content-between"},ld={class:"mt-1 p-2"},dd={class:"mt-1 p-2"},cd={class:"row"},ud={class:"col pe-0"},pd={class:"form-floating"},md=["value"],fd=de(()=>l("label",null,"Raised By",-1)),yd={class:"mt-1 p-2"},hd={class:"row"},vd={class:"col-4 pe-0 date"},gd={class:"form-floating"},Dd=["value"],kd=de(()=>l("label",null,"Date Raised",-1)),Sd={class:"col pe-0 d-flex"},Id={class:"d-flex flex-column flex-fill"},bd={class:"form-floating"},wd=["value"],_d=de(()=>l("label",{class:"text-nowrap"},"How long will this defect repair take?",-1)),Nd={class:"ms-2 d-flex align-items-center"},Cd={class:"mt-1 p-2"},Pd=de(()=>l("div",{class:"mt-2"},null,-1)),Td=de(()=>l("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[l("div",{class:"col-3"},"Priority"),l("div",{class:"col-6"},"Action"),l("div",{class:"col-3 text-break"},"Person Responsible")],-1)),Ed={class:"row p-3 m-1 priority-container"},Ad={class:"col-3"},Fd={class:"form-check"},Rd=de(()=>l("label",{class:"form-check-label text-nowrap"}," (P1) Immediate ",-1)),Vd=de(()=>l("div",{class:"col-6"},"Shall shut machine down and undertake repairs.",-1)),Od=de(()=>l("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),Ld={class:"row p-3 m-1 priority-container"},Hd={class:"col-3"},Md={class:"form-check"},Bd=de(()=>l("label",{class:"form-check-label text-nowrap"}," (P2) Urgent ",-1)),$d=de(()=>l("div",{class:"col-6"},"Shall complete within 7 days.",-1)),Ud=de(()=>l("div",{class:"col-3 text-break"},"Maintenance Supervisor",-1)),xd={class:"row p-3 m-1 priority-container"},qd={class:"col-3"},Gd={class:"form-check"},Jd=de(()=>l("label",{class:"form-check-label text-nowrap"}," (P3) Routine ",-1)),Kd=de(()=>l("div",{class:"col-6"},"Shall complete within 60 days.",-1)),Wd=de(()=>l("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),Yd={class:"row p-3 m-1 priority-container"},zd={class:"col-3"},jd={class:"form-check"},Zd=de(()=>l("label",{class:"form-check-label text-nowrap"}," (P4) Monitor ",-1)),Xd=de(()=>l("div",{class:"col-6"},"Shall continue to inspect and monitor for 90 days.",-1)),Qd=de(()=>l("div",{class:"col-3 text-break"},"Maintenance Planner",-1)),ec=de(()=>l("div",{class:"mt-2"},null,-1)),tc=de(()=>l("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[l("div",{class:"col-3"},"Part Number"),l("div",{class:"col-7"},"Part Description"),l("div",{class:"col-2"},"Qty")],-1)),ac={class:"col-3 px-0"},sc={class:"d-flex flex-column"},rc=["value"],ic={class:"col-7"},nc={class:"d-flex flex-column"},oc=["value"],lc={class:"col-2 px-1 d-flex justify-content-start"},dc={class:"d-flex flex-column"},cc=["value"],uc=de(()=>l("div",{class:"ms-4 d-flex align-items-center"},null,-1)),pc=de(()=>l("div",{class:"mt-2"},null,-1)),mc=de(()=>l("div",{class:"row p-3 m-1 priority-container",style:{background:"#F4F6F8","border-radius":"8px"}},[l("div",{class:"col-6"},"Labour Activity"),l("div",{class:"col-2"},"Qty"),l("div",{class:"col-2 word-breaker"},"Hours Each"),l("div",{class:"col-2 word-breaker"},"Total Hours")],-1)),fc={class:"col-6 px-0"},yc={class:"d-flex flex-column"},hc={class:"form-select","aria-label":"Disabled select example",disabled:""},vc={selected:""},gc={class:"col-2 d-flex justify-content-start"},Dc={class:"d-flex flex-column"},kc=["value"],Sc={class:"col-2 d-flex justify-content-start"},Ic={class:"d-flex flex-column"},bc=["value"],wc={class:"col-2 d-flex justify-content-start"},_c={class:"d-flex flex-column"},Nc=["value"],Cc=de(()=>l("div",{class:"mt-2"},null,-1)),Pc={class:"d-flex flex-fill flex-column"},Tc=["value"],Ec=de(()=>l("div",{class:"ms-4 d-flex align-items-center"},null,-1)),Ac=de(()=>l("div",{class:"mt-2"},null,-1)),Fc={class:"d-flex flex-fill flex-column"},Rc={key:0,class:"mt-2"},Vc=de(()=>l("div",{class:"mt-2"},null,-1)),Oc={class:"d-flex flex-fill flex-column"},Lc={key:0,class:"mt-2"},Hc=he({__name:"DefectYesView",props:{visibility:{required:!0,type:Boolean},data:{required:!0,type:Object},decline:{type:Object},ownership:{type:String,default:""},serialNumber:{type:String,default:""},approvedDate:{required:!1,type:String,default:""},approvedBy:{required:!1,type:Object,default:{}}},emits:["onClose","onImageDownloaded"],setup(e,{emit:t}){const a=e,s=t,r=F("Priority"),n=F("Parts Required"),i=F("Labour Required"),o=F("Other Resources Required (optional)"),d=F("Defect Symptom"),c=F("Defect Cause"),p=we(a,"visibility"),f=we(a,"data"),I=F(),v=F(sa()),T=q(()=>a.data.images?JSON.parse(a.data.images):[]),H=q(()=>JSON.parse(f.value.parts)),E=q(()=>JSON.parse(f.value.labours)),U=q(()=>JSON.parse(f.value.resources).map(B=>B)),G=q(()=>JSON.parse(f.value.symptoms).map(B=>B)),O=q(()=>JSON.parse(f.value.causes).map(B=>B)),k=async()=>{s("onClose")},L=()=>{Qa(I.value)},z=x=>{s("onImageDownloaded",x)},w=q(()=>{const x=a.ownership;return Xa(x)});return(x,B)=>{const y=Y("Label"),M=Y("el-collapse-item"),$=Y("el-collapse"),J=Y("el-option"),V=Y("el-select"),le=Y("el-dialog");return h(),se(le,{modelValue:p.value,"onUpdate:modelValue":B[10]||(B[10]=oe=>p.value=oe),width:"90%",center:"",onClosed:k,onOpened:L,"destroy-on-close":!0,"custom-class":`el-defect-crack-form-custom form-defect-yes-intervention-view ${v.value}`},{title:S(()=>{var oe,te;return[l("span",Tl,[ve("Detailed Information for Defect Identification "),(oe=e.decline)!=null&&oe.isDecline?(h(),D("span",El,"Declined")):e.approvedBy&&e.approvedDate?(h(),D("span",Al,"Approved")):W("",!0)]),l("span",{class:"el-dialog__title task-title",innerHTML:_(oa)((te=f.value)==null?void 0:te.title),ref_key:"defectDetailRef",ref:I},null,8,Fl)]}),default:S(()=>{var oe,te,pe,j,K,ne,ce,ge;return[l("div",null,[(oe=e.decline)!=null&&oe.isDecline?(h(),D("div",Rl,[l("div",Vl,[l("div",Ol,[l("div",Ll,[l("div",Hl,[l("div",Ml,P((te=e.decline)==null?void 0:te.declineReason),1),Bl])])]),e.decline&&e.decline.declineBy&&e.decline.declineDate?(h(),D("div",$l,P(e.decline.declineBy.name)+", "+P(e.decline.declineDate),1)):W("",!0)])])):e.approvedBy&&e.approvedDate?(h(),D("div",Ul,[l("div",xl,[l("div",ql,[e.approvedBy&&e.approvedDate?(h(),D("div",Gl,[l("div",Jl,P(e.approvedDate)+"  "+P(e.approvedBy.name),1),Kl])):W("",!0)])])])):W("",!0),l("div",Wl,[l("div",Yl,[l("div",zl,[l("div",jl,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:(pe=f.value)==null?void 0:pe.assetNumber},null,8,Zl),Xl])]),l("div",Ql,[l("div",ed,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:e.serialNumber},null,8,td),ad])]),l("div",sd,[l("div",rd,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:w.value},null,8,id),nd])])])]),l("div",od,[m(us,{"defect-images":T.value,onOnImageDownloaded:z},null,8,["defect-images"])]),l("div",ld,[m(at,{value:(j=f.value)==null?void 0:j.description,label:"Defect Identified Description",name:"DefectIdentifiedDescription",disabled:!0},null,8,["value"])]),l("div",dd,[l("div",cd,[l("div",ud,[l("div",pd,[l("input",{type:"text",class:"form-control",disabled:"",value:(K=f.value)==null?void 0:K.raisedBy},null,8,md),fd])])])]),l("div",yd,[l("div",hd,[l("div",vd,[l("div",gd,[l("input",{type:"text",class:"form-control",disabled:"",value:(ne=f.value)==null?void 0:ne.date},null,8,Dd),kd])]),l("div",Sd,[l("div",Id,[l("div",bd,[l("input",{type:"text",class:"form-control",value:_(yt)((ce=f.value)==null?void 0:ce.plannedDuration),disabled:""},null,8,wd),_d])]),l("div",Nd,[m(y,null,{default:S(()=>[ve("Hours")]),_:1})])])])]),l("div",Cd,[m(at,{value:(ge=f.value)==null?void 0:ge.instruction,label:"Defect Identified instruction",name:"DefectIdentifiedInstruction",disabled:!0},null,8,["value"])]),Pd,m($,{class:"task-group general-accordion py-1 px-5",modelValue:r.value,"onUpdate:modelValue":B[4]||(B[4]=b=>r.value=b)},{default:S(()=>[m(M,{title:"Priority",name:"Priority"},{default:S(()=>[Td,l("div",Ed,[l("div",Ad,[l("div",Fd,[me(l("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":B[0]||(B[0]=b=>f.value.priority=b),value:"P1",disabled:""},null,512),[[Tt,f.value.priority]]),Rd])]),Vd,Od]),l("div",Ld,[l("div",Hd,[l("div",Md,[me(l("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":B[1]||(B[1]=b=>f.value.priority=b),value:"P2",disabled:""},null,512),[[Tt,f.value.priority]]),Bd])]),$d,Ud]),l("div",xd,[l("div",qd,[l("div",Gd,[me(l("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":B[2]||(B[2]=b=>f.value.priority=b),value:"P3",disabled:""},null,512),[[Tt,f.value.priority]]),Jd])]),Kd,Wd]),l("div",Yd,[l("div",zd,[l("div",jd,[me(l("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":B[3]||(B[3]=b=>f.value.priority=b),value:"P4",disabled:""},null,512),[[Tt,f.value.priority]]),Zd])]),Xd,Qd])]),_:1})]),_:1},8,["modelValue"]),ec,m($,{class:"task-group general-accordion py-1 px-5",modelValue:n.value,"onUpdate:modelValue":B[5]||(B[5]=b=>n.value=b)},{default:S(()=>[m(M,{title:"Parts Required",name:"Parts Required"},{default:S(()=>[tc,(h(!0),D(ie,null,fe(H.value,b=>(h(),D("div",{class:"row p-3 m-1 priority-container px-0",key:b.partNumber},[l("div",ac,[l("div",sc,[l("input",{type:"text",class:"form-control",value:b.partNumber,disabled:""},null,8,rc)])]),l("div",ic,[l("div",nc,[l("input",{type:"text",class:"form-control",value:b.partDescription,disabled:""},null,8,oc)])]),l("div",lc,[l("div",dc,[l("input",{class:"form-control",value:_(yt)(b.qty),disabled:""},null,8,cc)]),uc])]))),128))]),_:1})]),_:1},8,["modelValue"]),pc,m($,{class:"task-group general-accordion py-1 px-5",modelValue:i.value,"onUpdate:modelValue":B[6]||(B[6]=b=>i.value=b)},{default:S(()=>[m(M,{title:"Labour Required",name:"Labour Required"},{default:S(()=>[mc,(h(!0),D(ie,null,fe(E.value,b=>(h(),D("div",{class:"row p-3 m-1 priority-container ps-0",key:b.position},[l("div",fc,[l("div",yc,[l("select",hc,[l("option",vc,P(b.position),1)])])]),l("div",gc,[l("div",Dc,[l("input",{class:"form-control",value:_(yt)(b.qty),disabled:""},null,8,kc)])]),l("div",Sc,[l("div",Ic,[l("input",{class:"form-control",value:_(yt)(b.hireEach),disabled:""},null,8,bc)])]),l("div",wc,[l("div",_c,[l("input",{class:"form-control",value:_(yt)(b.totalHours),disabled:""},null,8,Nc)])])]))),128))]),_:1})]),_:1},8,["modelValue"]),Cc,m($,{class:"task-group general-accordion py-1 px-5",modelValue:o.value,"onUpdate:modelValue":B[7]||(B[7]=b=>o.value=b)},{default:S(()=>[m(M,{title:"Other Resources Required (optional)",name:"Other Resources Required (optional)"},{default:S(()=>[(h(!0),D(ie,null,fe(U.value,b=>(h(),D("div",{class:"p-2 d-flex",key:b},[l("div",Pc,[l("input",{type:"text",class:"form-control",value:b,placeholder:"Resource1",disabled:""},null,8,Tc)]),Ec]))),128))]),_:1})]),_:1},8,["modelValue"]),Ac,m($,{class:"task-group general-accordion py-1 px-5",modelValue:d.value,"onUpdate:modelValue":B[8]||(B[8]=b=>d.value=b)},{default:S(()=>[m(M,{title:"Defect Symptom",name:"Defect Symptom"},{default:S(()=>[(h(!0),D(ie,null,fe(G.value,b=>(h(),D("div",{class:"p-2 d-flex",key:b},[l("div",Fc,[m(V,{modelValue:b.split(":")[0],"onUpdate:modelValue":Ie=>b.split(":")[0]=Ie,disabled:!0,class:"w-100"},{default:S(()=>[m(J,{label:b.split(":")[0],value:b.split(":")[0]},null,8,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),b.includes("Other")?(h(),D("div",Rc,[m(at,{value:_(za)(b),label:"Description",name:"Description",disabled:!0},null,8,["value"])])):W("",!0)])]))),128))]),_:1})]),_:1},8,["modelValue"]),Vc,m($,{class:"task-group general-accordion py-1 px-5",modelValue:c.value,"onUpdate:modelValue":B[9]||(B[9]=b=>c.value=b)},{default:S(()=>[m(M,{title:"Defect Cause",name:"Defect Cause"},{default:S(()=>[(h(!0),D(ie,null,fe(O.value,b=>(h(),D("div",{class:"p-2 d-flex",key:b},[l("div",Oc,[m(V,{modelValue:b.split(":")[0],"onUpdate:modelValue":Ie=>b.split(":")[0]=Ie,disabled:"",class:"w-100"},{default:S(()=>[m(J,{label:b.split(":")[0],value:b.split(":")[0]},null,8,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),b.includes("Other")?(h(),D("div",Lc,[m(at,{value:_(za)(b),label:"Description",name:"Description",disabled:!0},null,8,["value"])])):W("",!0)])]))),128))]),_:1})]),_:1},8,["modelValue"])])]}),_:1},8,["modelValue","custom-class"])}}}),Mc=Ce(Hc,[["__scopeId","data-v-db28e701"]]),je=e=>(Oe("data-v-5d253356"),e=e(),Le(),e),Bc=je(()=>l("span",{class:"el-dialog__title"},"Detailed Information for Defect Identification",-1)),$c=["innerHTML"],Uc={class:"d-flex flex-row justify-content-between"},xc={class:"p-2 d-flex flex-row flex-grow-1"},qc={class:"flex-fill"},Gc={class:"form-floating"},Jc=["innerHTML"],Kc=je(()=>l("label",{for:"floatingInput"},"Asset Number",-1)),Wc={class:"flex-fill ps-3"},Yc={class:"form-floating"},zc=["innerHTML"],jc=je(()=>l("label",{for:"floatingInput"},"Serial Number",-1)),Zc={class:"flex-fill ps-3"},Xc={class:"form-floating"},Qc=["innerHTML"],eu=je(()=>l("label",{for:"floatingInput"},"Ownership",-1)),tu={class:"d-flex flex-row justify-content-between"},au={class:"mt-1 p-2"},su={class:"d-flex flex-column"},ru={class:"mt-1 p-2"},iu={class:"row",style:{width:"101%"}},nu={class:"col-6 pe-0"},ou={class:"form-floating"},lu=["value"],du=je(()=>l("label",null,"Raised By",-1)),cu={class:"col-6 pe-0"},uu={class:"form-floating"},pu=["value"],mu=je(()=>l("label",null,"Date Raised",-1)),fu=je(()=>l("div",{class:"mt-2"},null,-1)),yu={class:"d-flex flex-fill flex-column"},hu={class:"mt-2"},vu=he({__name:"DefectNoView",props:{visibility:{required:!0,type:Boolean},data:{required:!0,type:Object},ownership:{type:String,default:""},serialNumber:{type:String,default:""}},emits:["onClose","onImageDownloaded"],setup(e,{emit:t}){const a=e,s=t,r=F("Repairs Completed"),n=we(a,"visibility"),i=we(a,"data"),o=F(),d=F(sa()),c=async()=>{s("onClose",null)},p=()=>{Qa(o.value)},f=v=>{s("onImageDownloaded",v)},I=q(()=>{const v=a.ownership;return Xa(v)});return(v,T)=>{const H=Y("el-collapse-item"),E=Y("el-collapse"),U=Y("el-dialog");return h(),se(U,{modelValue:n.value,"onUpdate:modelValue":T[1]||(T[1]=G=>n.value=G),width:"90%",center:"",onClosed:c,onOpened:p,"destroy-on-close":!0,"custom-class":`el-defect-crack-form-custom form-defect-no-intervention-view ${d.value}`},{title:S(()=>{var G;return[Bc,l("span",{class:"el-dialog__title task-title",innerHTML:_(oa)((G=i.value)==null?void 0:G.title),ref_key:"defectDetailRef",ref:o},null,8,$c)]}),default:S(()=>{var G;return[l("div",Uc,[l("div",xc,[l("div",qc,[l("div",Gc,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:(G=v.detai)==null?void 0:G.assetNumber},null,8,Jc),Kc])]),l("div",Wc,[l("div",Yc,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:e.serialNumber},null,8,zc),jc])]),l("div",Zc,[l("div",Xc,[l("div",{type:"text",class:"form-control asset-number-disabled-div",innerHTML:I.value},null,8,Qc),eu])])])]),l("div",tu,[m(us,{"defect-images":e.data.images?JSON.parse(e.data.images):[],onOnImageDownloaded:f},null,8,["defect-images"])]),l("div",au,[l("div",su,[m(at,{value:i.value.description,label:"Defect Identified Description",name:"DefectIdentifiedDescription",disabled:!0},null,8,["value"])])]),l("div",ru,[l("div",iu,[l("div",nu,[l("div",ou,[l("input",{type:"text",class:"form-control",disabled:"",value:i.value.raisedBy},null,8,lu),du])]),l("div",cu,[l("div",uu,[l("input",{type:"text",class:"form-control",disabled:"",value:i.value.date},null,8,pu),mu])])])]),fu,m(E,{class:"task-group general-accordion py-1 px-5",modelValue:r.value,"onUpdate:modelValue":T[0]||(T[0]=O=>r.value=O)},{default:S(()=>[m(H,{title:"Repairs Completed",name:"Repairs Completed"},{default:S(()=>{var O;return[(h(!0),D(ie,null,fe(JSON.parse((O=i.value)==null?void 0:O.actions),k=>(h(),D("div",{class:"p-2 d-flex",key:k},[l("div",yu,[l("div",hu,[m(at,{value:k,label:"Description of Repairs Completed",name:"DescriptionofRepairsCompleted",disabled:!0},null,8,["value"])])])]))),128))]}),_:1})]),_:1},8,["modelValue"])]}),_:1},8,["modelValue","custom-class"])}}}),gu=Ce(vu,[["__scopeId","data-v-5d253356"]]),Ze=e=>(Oe("data-v-4314e49f"),e=e(),Le(),e),Du=Ze(()=>l("span",{class:"el-dialog__title",style:{"text-align":"start"}},null,-1)),ku={class:"ps-3"},Su=Ze(()=>l("h3",null,"Detailed Information",-1)),Iu=Ze(()=>l("div",{class:"d-flex flex-row justify-content-between"},[l("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[l("label",{style:{}},"No")]),l("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[l("label",{style:{}},"Measurement Location")]),l("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[l("label",{style:{}},"Measurement Value")]),l("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[l("label",{style:{}},"UoM")]),l("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[l("label",{style:{}},"Rating")])],-1)),bu={class:"d-flex flex-row justify-content-between"},wu={class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},_u={style:{}},Nu={class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Cu=["innerHTML"],Pu={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Tu={class:"col-1 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Eu={style:{}},Au={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},Fu=Ze(()=>l("h3",{class:"mt-3"},"Detail Spec",-1)),Ru={class:"table table-bordered",style:{width:"500px"}},Vu=Ze(()=>l("thead",null,[l("tr",{style:{background:"#70AD47"}},[l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),l("th",{scope:"col",class:"table-header"},"UoM")])],-1)),Ou={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},Lu={scope:"row",style:{"border-right":"1px solid white"}},Hu={scope:"row",style:{"border-right":"1px solid white"}},Mu={scope:"row"},Bu={key:0,class:"mt-3"},$u={key:1,class:"table table-bordered",style:{width:"500px"}},Uu=Ze(()=>l("thead",null,[l("tr",{style:{background:"#70AD47"}},[l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),l("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),l("th",{scope:"col",class:"table-header"},"UoM")])],-1)),xu={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},qu={scope:"row",style:{"border-right":"1px solid white"}},Gu={scope:"row",style:{"border-right":"1px solid white"}},Ju={scope:"row"},Ku=Ze(()=>l("h3",{class:"mt-3"},"Detailed picture",-1)),Wu={class:"row my-4"},Yu={class:"bg-secondary"},zu=["src","onClick"],ju=he({__name:"CBMInfo",props:{visibility:{required:!0,type:Boolean},cbmData:{required:!0,type:Object},equipmentModel:{required:!0,default:""},psType:{required:!0,default:""}},emits:["closeForm"],setup(e,{emit:t}){const a=e,s=t,r=Je(),n=we(a,"visibility"),i=we(a,"cbmData"),o=F([]),d=F(!1),c=F([]),p=F([]),f=F(),I=F([]),v=F(""),T=F(!1),H=F([]),E=async()=>{if(!(c.value.length<1))for(const[y,M]of c.value.entries()){const $={fileUrl:`${M.filename}`,ver:"v1"};try{const J=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams($).toString()}`,V=await g.getBlob(J),le=V.data,oe=new Blob([le]),pe=(window.URL||window.webkitURL).createObjectURL(oe);H.value.push({key:M.filename,value:pe}),p.value[y]={...p.value[y],imgBlob:V.blob,url:w(p.value[y].filename)},I.value[y]=!1}catch(J){console.log("image",J)}}},U=()=>{s("closeForm")},G=q(()=>{var y;return(y=i.value)!=null&&y.taskNo?i.value.taskNo.replace(/[^a-z]/gi,"").length>1?i.value.taskNo.replace(";","").replace(/\D/g,""):i.value.taskNo.replace(";",""):""}),O=q(()=>{if(!o.value)return[];const y=o.value.filter(M=>M.cbmType!="CBM_GAP");return C.orderBy(y,["uom","cbmRating","minValue"])}),k=q(()=>{if(!o.value)return[];const y=o.value.filter(M=>M.cbmType=="CBM_GAP");return C.orderBy(y,["uom","cbmRating","minValue"])}),L=async()=>{d.value=!0;const y=await u.cbmMapping.where({model:a.equipmentModel,psType:a.psType}).first(),M=y==null?void 0:y.detail.filter(V=>V.taskKey==i.value.taskId);M&&(o.value=M),c.value=[];const $=await r.getDefectImages(i.value.interventionId,i.value.taskId,i.value.cbmImageProp);c.value=Re($),H.value=[],I.value=Array.apply(null,Array(c.value.length)).map(function(){return!0}),p.value=Re(c.value);const J=c.value.length;for(let V=0;V<J;V++){const le=p.value[V].filename;await z(le,V)}await E(),d.value=!1},z=async(y,M)=>{const $={fileUrl:y,ver:"v1"};try{const J=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams($).toString()}`,le=(await g.getBlob(J)).data,oe=new Blob([le]),te={};te.filename=y,te.blob=oe,te.type="cbm";const pe={};pe.image=te,pe.index=M,pe.length=c.value.length,window.setTimeout(async()=>{let j=window.URL||window.webkitURL;H.value.push({key:y,value:j.createObjectURL(oe)}),I.value[M]=!1},1e3)}catch(J){console.log("image",J)}},w=y=>{const M=H.value.find($=>$.key==y);return(M==null?void 0:M.value)??""},x=y=>{const M=p.value.findIndex(J=>J.filename==y),$=p.value[M];if(M>0){const J=p.value.slice(M),V=p.value.slice(0,M);f.value=[...J,...V]}else f.value=p.value;v.value=$.url,T.value=!0},B=()=>{v.value="",T.value=!1};return(y,M)=>{const $=Y("el-input"),J=Y("el-skeleton-item"),V=Y("el-skeleton"),le=Y("el-dialog"),oe=be("loading");return h(),D(ie,null,[m(le,{modelValue:n.value,"onUpdate:modelValue":M[2]||(M[2]=te=>n.value=te),"custom-class":"crackform dialog-header-noborder e-form-font-family",width:"90%",center:"",onClosed:U,onOpened:L,"destroy-on-close":!0},{title:S(()=>[Du]),default:S(()=>{var te,pe,j;return[l("div",null,[me((h(),D("div",ku,[Su,Iu,l("div",bu,[l("div",wu,[l("label",_u,P(G.value),1)]),l("div",Nu,[l("label",{style:{},innerHTML:i.value.taskDesc.split(";").length>3?(te=i.value.taskDesc)==null?void 0:te.split(";")[2]:i.value.taskDesc},null,8,Cu)]),l("div",Pu,[m($,{class:"dark-text-primary",size:"small",modelValue:i.value.cbmMeasurement,"onUpdate:modelValue":M[0]||(M[0]=K=>i.value.cbmMeasurement=K),disabled:!0},null,8,["modelValue"])]),l("div",Tu,[l("label",Eu,P(((pe=o.value[0])==null?void 0:pe.uom)||((j=i.value)==null?void 0:j.cbmUom)),1)]),l("div",Au,[m($,{size:"small",class:ke(["dark-text-primary",i.value.taskValue==="C"?"c":"x"]),modelValue:i.value.taskValue,"onUpdate:modelValue":M[1]||(M[1]=K=>i.value.taskValue=K),disabled:!0},null,8,["modelValue","class"])])]),Fu,l("table",Ru,[Vu,l("tbody",null,[(h(!0),D(ie,null,fe(O.value,(K,ne)=>(h(),D("tr",{key:ne,class:ke(ne%2==0?"even":"odd")},[l("th",Ou,P(K.cbmRating),1),l("th",Lu,P(K.minValue),1),l("th",Hu,P(K.maxValue),1),l("th",Mu,P(K.uom),1)],2))),128))])]),k.value.length>0?(h(),D("h3",Bu,"Detail Spec Gap")):W("",!0),k.value.length>0?(h(),D("table",$u,[Uu,l("tbody",null,[(h(!0),D(ie,null,fe(k.value,(K,ne)=>(h(),D("tr",{key:ne,class:ke(ne%2==0?"even":"odd")},[l("th",xu,P(K.cbmRating),1),l("th",qu,P(K.minValue),1),l("th",Gu,P(K.maxValue),1),l("th",Ju,P(K.uom),1)],2))),128))])])):W("",!0),Ku,l("div",Wu,[(h(!0),D(ie,null,fe(p.value,(K,ne)=>(h(),D("div",{key:K.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[m(V,{loading:I.value[ne],animated:""},{template:S(()=>[m(J,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:S(()=>[l("div",Yu,[l("img",{src:K.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:ce=>x(K.filename),alt:"images"},null,8,zu)])]),_:2},1032,["loading"])]))),128))])])),[[oe,d.value]])])]}),_:1},8,["modelValue"]),m(Za,{images:p.value,visibility:T.value,image:v.value,onHandleClose:B},null,8,["images","visibility","image"])],64)}}}),Zu=Ce(ju,[["__scopeId","data-v-4314e49f"]]),Xu=he({__name:"SubmitButton",props:{formIntervention:{type:Object,required:!0},isLoading:{type:Boolean,required:!1,default:!1},selectedHeader:{type:String,required:!1}},emits:["clicked"],setup(e,{emit:t}){const a=e,s=t,r=()=>{s("clicked")};return(n,i)=>{const o=Y("el-button"),d=be("loading");return e.formIntervention.interventionHeaderId==0||e.formIntervention.interventionHeaderId==null?me((h(),se(o,{key:0,id:"submit-button",type:"success",disabled:e.formIntervention.interventionExecutionId>4,onClick:r,"element-loading-background":"#2d2b39b3"},{default:S(()=>[ve(" Submit ")]),_:1},8,["disabled"])),[[d,a.isLoading]]):(h(),se(o,{key:1,id:"revise-button",type:"success",disabled:e.formIntervention.interventionExecutionId>4||!e.formIntervention.userRevise||e.formIntervention.interventionStatus=="Declined"&&a.selectedHeader=="Declined",onClick:r},{default:S(()=>[ve(" Revise ")]),_:1},8,["disabled"]))}}}),Qu=e=>(Oe("data-v-6f2c7039"),e=e(),Le(),e),ep={class:"list-group ps-0 mt-5 mb-3"},tp={key:0,class:"d-flex flex-column"},ap={class:"d-flex my-2 align-items-center"},sp={style:{width:"100%"},class:"d-flex my-2 align-items-center"},rp=Qu(()=>l("em",{class:"fa fa-search me-1 ms-3"},null,-1)),ip={class:"d-flex justify-content-between"},np={class:"label ms-5 intervention-label"},op={class:"label item__timestamp"},lp={key:0},dp={"element-loading-background":"#2d2b39b3"},cp=["onClick"],up={class:"d-flex flex-column w-100"},pp={class:"d-flex justify-content-between"},mp={class:"label ms-5 intervention-label"},fp={class:"label item__timestamp"},yp={key:1,class:"d-flex justify-content-center mt-8"},hp={key:0,style:{color:"#FFFF"}},vp={key:1,"element-loading-background":"#2d2b39b3"},gp={key:1,class:"d-flex flex-column"},Dp={class:"pb-2"},kp={class:"item d-flex flex-fill my-2 align-items-center"},Sp={class:"d-flex flex-column w-100"},Ip={class:"d-flex justify-content-between"},bp={class:"label ms-5 intervention-label"},wp={class:"label item__timestamp"},_p=he({__name:"ListGroup",props:{dataList:{required:!0,type:Object},loading:{required:!0,type:Boolean}},emits:["onItemClick","onBackToList"],setup(e,{emit:t}){const a=Ve(),s=_e(),r=e,n=t,i=F(!1),o=F(null),d=F(""),c=q(()=>a.pagination),p=F("custom-pagination"),f=q({get(){return a.isSelectedItem},set(w){a.setIsSelectedItem(w)}}),I=q(()=>a.selectedHeaderItem),v=q(()=>a.searchOption.length==0&&d.value),T=q({get(){return a.searchOption},set(w){a.stateSearchOptions=w}});it(()=>r.dataList,w=>{f.value=!1});const H=w=>{a.setPage(w)},E=w=>js(w,"YYYY-MM-DD HH:mm:ss","DD.MM.YYYY"),U=w=>{s.setIsFromEquipment(!1),f.value=!0,n("onItemClick",w)},G=w=>{s.setIsFromEquipment(!1),f.value=!0,T.value=[],n("onItemClick",w)},O=async w=>{w?(i.value=!0,await a.searchItems(w),i.value=!1,d.value=w):(d.value="",T.value=[])},k=()=>{f.value=!1,o.value=null,T.value=[],n("onBackToList")},L=async()=>{d.value="",setTimeout(()=>{T.value=[]},300)},z=(w="")=>{const x=w?w.toLowerCase():"";return x.includes("normal")?"text-normal-inv":x.includes("caution")?"yellow":"text-critical"};return(w,x)=>{const B=Y("el-option"),y=Y("el-select"),M=Y("inline-svg"),$=Y("el-button"),J=be("loading");return h(),D("div",ep,[f.value?(h(),D("div",gp,[l("div",Dp,[m($,{text:"",class:"dark-btn",onClick:k},{default:S(()=>[m(M,{src:"/media/icons/bootstrap-icon/arrow-left-short.svg",width:"36",height:"36",fill:"white"}),ve(" Item selected ")]),_:1})]),l("div",kp,[l("div",Sp,[l("div",Ip,[l("div",null,[l("span",bp,[ve(P(I.value.equipmentNumber)+" - "+P(I.value.brand)+" "+P(I.value.model)+" - ",1),l("span",{class:ke(z(I.value.interventionCode))},P(I.value.interventionCode)+" "+P(I.value.componentGroup?` - ${I.value.componentGroup}`:""),3),ve(" "+P(I.value.workOrder?` - ${I.value.workOrder}`:""),1)])]),l("div",null,[l("span",wp,P(I.value.interventionDate?E(I.value.interventionDate):""),1)])])])])])):(h(),D("div",tp,[e.dataList.length>0?(h(),D(ie,{key:0},[l("div",ap,[l("div",sp,[m(y,{style:{width:"100%"},filterable:"",remote:"","reserve-keyword":"",modelValue:o.value,"onUpdate:modelValue":x[0]||(x[0]=V=>o.value=V),placeholder:"Search component intervention forms","remote-method":O,loading:i.value,onChange:G,persistent:!1,onBlur:L,size:"large"},{prefix:S(()=>[rp]),default:S(()=>[(h(!0),D(ie,null,fe(T.value,V=>(h(),se(B,{key:V.workOrder,value:V},{default:S(()=>[l("div",ip,[l("span",np,[ve(P(V.equipmentNumber)+" - "+P(V.brand)+" "+P(V.model)+" - ",1),l("span",{class:ke(z(V.interventionCode))},P(V.interventionCode)+" "+P(V.componentGroup?` - ${V.componentGroup}`:""),3),ve(" "+P(V.workOrder?` - ${V.workOrder}`:""),1)]),l("span",op,P(V.interventionDate?E(V.interventionDate):""),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading"])])]),T.value.length==0&&!v.value&&!f.value?(h(),D("div",lp,[me((h(),D("div",dp,[(h(!0),D(ie,null,fe(e.dataList,V=>(h(),D("div",{key:V.workOrder,class:"item d-flex flex-fill my-2 align-items-center",onClick:le=>U(V)},[l("div",up,[l("div",pp,[l("div",null,[l("span",mp,[ve(P(V.equipmentNumber)+" - "+P(V.brand)+" "+P(V.model)+" - ",1),l("span",{class:ke(z(V.interventionCode))},P(V.interventionCode)+" "+P(V.componentGroup?` - ${V.componentGroup}`:""),3),ve(" "+P(V.workOrder?` - ${V.workOrder}`:""),1)])])])]),l("div",null,[l("span",fp,P(V.interventionDate?E(V.interventionDate):""),1)])],8,cp))),128))])),[[J,e.loading]]),e.dataList.length>0?(h(),se(vr,{key:0,customClassPagination:"custom-pagination",onRaisePageChange:x[1]||(x[1]=V=>H(V)),"class-custom":p.value,currentPage:c.value.currentPage,totalPage:c.value.totalPage,totalPageSize:c.value.totalPageSize,startPaginationIndex:c.value.startPaginationIndex,endPaginationIndex:c.value.endPaginationIndex},null,8,["class-custom","currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):W("",!0)])):W("",!0)],64)):(h(),D("div",yp,[e.loading?me((h(),D("div",vp,null,512)),[[J,e.loading]]):(h(),D("h5",hp,"No Data Display"))]))]))])}}}),Np=Ce(_p,[["__scopeId","data-v-6f2c7039"]]),Cp={class:"row grouping-by-status"},Pp={class:"col-10"},Tp={key:0,style:{"font-size":"12px"},class:"text-white vertical-line"},Ep={key:1,style:{"font-size":"12px"},class:"text-white"},Ap={class:"col-2 d-flex justify-content-between align-items-center"},Fp=l("div",null,null,-1),Rp={key:0},Vp=he({__name:"HeaderMenu",emits:["onBackToList"],setup(e,{emit:t}){const a=t,{instance:s}=gr(),r=Ve(),n=_e(),i=q(()=>r.headerList),o=q(()=>r.headerListItems),d=q(()=>r.selectedHeader),c=q(()=>r.loadingHeader),p=q({get(){return r.isSelectedItem},set(U){r.setIsSelectedItem(U)}}),f=F("fa-chevron-down"),I=F(!1);Qt(async()=>{await yr(s),await r.setHeaderDeclined("Declined",1,!0),d.value=="Pending Evaluation"&&await r.setHeaderChange("Pending Evaluation")});const v=async U=>{p.value=!1,r.resetAllList(),n.resetFormIntervention(),r.setSelectedHeader(U),U==="Declined"?await r.setHeaderDeclined(U,1):await r.setPage(1)},T=async U=>{r.setSelectedHeaderItem(U),n.resetGeneric(),await n.getDataFromKeyPbi(U.keyPbi)},H=async()=>{r.resetAllList(),n.resetFormIntervention(),n.resetGeneric(!0),a("onBackToList")},E=()=>{I.value=!I.value,I.value?f.value="fa-chevron-up":f.value="fa-chevron-down"};return(U,G)=>{const O=Y("el-menu-item"),k=Y("el-menu");return h(),D(ie,null,[l("div",Cp,[l("div",Pp,[m(k,{"default-active":d.value,class:"el-menu-demo d-flex flex-wrap",mode:"horizontal","background-color":"#2D2B39","text-color":"#fff","active-text-color":"#18AF4A",onSelect:v},{default:S(()=>[(h(!0),D(ie,null,fe(i.value,L=>(h(),se(O,{key:L,index:L.label},{default:S(()=>[L.label==="Declined"?(h(),D("span",Tp,P(L.label)+" ("+P(L.total)+")",1)):(h(),D("span",Ep,P(L.label)+" ("+P(L.total)+")",1))]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),l("div",Ap,[Fp,l("em",{class:ke(["fa",f.value]),style:{color:"white","font-size":"1.2em",cursor:"pointer"},onClick:E},null,2)])]),I.value?W("",!0):(h(),D("div",Rp,[m(Np,{loading:c.value,dataList:o.value,onOnItemClick:T,onOnBackToList:H},null,8,["loading","dataList"])]))],64)}}}),Op={class:"d-flex justify-content-end"},Lp={key:0},Hp={class:"dialog-footer"},Mp=he({__name:"FormDeclineReason",props:{visibility:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},declinerName:{type:String,required:!1,default:""},declinerDate:{type:String,required:!1,default:""}},emits:["handle-close","handle-submit"],setup(e,{emit:t}){const a=e,s=t,r=_e(),n=we(a,"visibility"),i=q(()=>r.formIntervention),o=F([]),d=F(!1),c=Ht().shape({declineReason:Se().required("Decline Reason is mandatory").nullable()}),p=()=>{v(),s("handle-close")},f=T=>{i.value.declineReason=T},I=async()=>{d.value=!1,v(),await c.validate(i.value,{abortEarly:!1}).catch(T=>{d.value=!0,o.value=T.errors}),!d.value&&s("handle-submit")},v=()=>{d.value=!1,o.value=[]};return(T,H)=>{const E=Y("el-button"),U=Y("el-dialog"),G=be("loading");return me((h(),se(U,{modelValue:n.value,"onUpdate:modelValue":H[0]||(H[0]=O=>n.value=O),title:"Reason for Declining Intervention",width:"40%",onClose:H[1]||(H[1]=O=>p()),class:"dialog-word_break"},ea({default:S(()=>[me((h(),D("div",null,[m(nt,{name:"fade"},{default:S(()=>[d.value?(h(),se(ot,{key:0,errorMessages:o.value,onResetForm:v},null,8,["errorMessages"])):W("",!0)]),_:1}),m(_(Lt),{id:"kt_filter_form",class:"row"},{default:S(()=>[m(qe,{class:"textarea-custom",value:i.value.declineReason,placeholder:"Write reason here",label:"Decline Reason",name:"DeclineReason",required:"",max:1500,textInputType:"textarea",readonly:!a.isEdit,onHandleChange:f},null,8,["value","readonly"]),l("div",Op,[a.isEdit?W("",!0):(h(),D("span",Lp,P(a.declinerName)+", "+P(_(Rt)(a.declinerDate)),1))])]),_:1})])),[[G,_(r).loading]])]),_:2},[a.isEdit?{name:"footer",fn:S(()=>[l("span",Hp,[m(E,{disabled:_(r).loading,type:"secondary",onClick:p},{default:S(()=>[ve("Cancel")]),_:1},8,["disabled"]),m(E,{disabled:_(r).loading,type:"primary",onClick:I},{default:S(()=>[ve("Submit")]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["modelValue"])),[[G,_(r).loading]])}}}),Bp=Ce(Mp,[["__scopeId","data-v-2fee69f7"]]),$p={class:"d-flex justify-content-end"},Up=he({__name:"FormApproveReason",props:{visibility:{type:Boolean,default:!1},approverName:{type:String,required:!1,default:""},approverDate:{type:String,required:!1,default:""}},emits:["handle-close"],setup(e,{emit:t}){const a=e,s=t,r=_e(),n=we(a,"visibility"),i=q(()=>r.formIntervention),o=F([]),d=F(!1),c=()=>{p(),s("handle-close")},p=()=>{d.value=!1,o.value=[]};return(f,I)=>{const v=Y("el-dialog"),T=be("loading");return me((h(),se(v,{modelValue:n.value,"onUpdate:modelValue":I[0]||(I[0]=H=>n.value=H),title:"Reason for Revising Intervention",width:"40%",onClose:I[1]||(I[1]=H=>c()),class:"dialog-word_break"},{default:S(()=>[me((h(),D("div",null,[m(_(Lt),{id:"kt_filter_form",class:"row"},{default:S(()=>[m(qe,{class:"textarea-custom",value:i.value.approveReason,placeholder:"Write reason here",label:"Approve Reason",name:"ApproveReason",required:"",textInputType:"textarea",readonly:""},null,8,["value"]),l("div",$p,[l("span",null,P(a.approverName)+", "+P(_(Rt)(a.approverDate)),1)])]),_:1})])),[[T,_(r).loading]])]),_:1},8,["modelValue"])),[[T,_(r).loading]])}}}),xp=Ce(Up,[["__scopeId","data-v-1f872e67"]]),qp={class:"dialog-footer"},Gp=he({__name:"FormReviseReason",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close","handle-submit"],setup(e,{emit:t}){const a=e,s=t,r=_e(),n=we(a,"visibility"),i=q(()=>r.formIntervention),o=F([]),d=F(!1),c=Ht().shape({reviseReason:Se().required("Revise Reason is mandatory").nullable()}),p=()=>{v(),s("handle-close")},f=T=>{i.value.reviseReason=T},I=async()=>{d.value=!1,v(),await c.validate(i.value,{abortEarly:!1}).catch(T=>{d.value=!0,o.value=T.errors}),!d.value&&s("handle-submit")},v=()=>{d.value=!1,o.value=[]};return(T,H)=>{const E=Y("el-button"),U=Y("el-dialog"),G=be("loading");return me((h(),se(U,{modelValue:n.value,"onUpdate:modelValue":H[0]||(H[0]=O=>n.value=O),title:"Reason for Revising Intervention",width:"40%",onClose:H[1]||(H[1]=O=>p()),class:"dialog-word_break"},{footer:S(()=>[l("span",qp,[m(E,{disabled:_(r).loading,type:"secondary",onClick:p},{default:S(()=>[ve("Cancel")]),_:1},8,["disabled"]),m(E,{disabled:_(r).loading,type:"primary",onClick:I},{default:S(()=>[ve("Submit")]),_:1},8,["disabled"])])]),default:S(()=>[me((h(),D("div",null,[m(nt,{name:"fade"},{default:S(()=>[d.value?(h(),se(ot,{key:0,errorMessages:o.value,onResetForm:v},null,8,["errorMessages"])):W("",!0)]),_:1}),m(_(Lt),{id:"kt_filter_form",class:"row"},{default:S(()=>[m(qe,{class:"textarea-custom",value:i.value.reviseReason,placeholder:"Write reason here",label:"Revise Reason",name:"ReviseReason",required:"",max:1500,textInputType:"textarea",onHandleChange:f},null,8,["value"])]),_:1})])),[[G,_(r).loading]])]),_:1},8,["modelValue"])),[[G,_(r).loading]])}}}),Jp=Ce(Gp,[["__scopeId","data-v-34e3b231"]]),Kp=e=>(Oe("data-v-0f936a89"),e=e(),Le(),e),Wp=Kp(()=>l("div",{class:"my-3 word_break"}," Do you want to add another sensor parameter critically in the current Intervention Form: ",-1)),Yp=["onUpdate:modelValue"],zp=["innerHTML"],jp={class:"dialog-footer"},Zp=he({__name:"AdditionalSensorDataDialog",props:{visibility:{type:Boolean,default:!1}},setup(e){const t=e,a=_e(),s=we(t,"visibility"),r=q(()=>a.formIntervention),n=F([]),i=F(!1),o=q(()=>a.listAdditionalSensorData),d=f=>f.replace(/CRITICAL/gi,'<span class="text-critical">CRITICAL</span>').replace(/CAUTION/gi,'<span class="text-caution">CAUTION</span>').replace(/NORMAL/gi,'<span class="text-normal-inv">NORMAL</span>'),c=async f=>{p();const I=await a.postAdditionalSensorData(f);I.isError?(i.value=!0,n.value.push(I.message)):(a.setIsAdditionalSensorExist(!1),await a.getDataFromKeyPbi(r.value.keyPbi))},p=()=>{i.value=!1,n.value=[]};return(f,I)=>{const v=Y("el-button"),T=Y("el-dialog"),H=be("loading");return me((h(),se(T,{modelValue:s.value,"onUpdate:modelValue":I[2]||(I[2]=E=>s.value=E),title:"Additional Sensor Data","show-close":!1,width:"40%","lock-scroll":""},{footer:S(()=>[l("span",jp,[m(v,{type:"secondary",onClick:I[0]||(I[0]=E=>c(!1))},{default:S(()=>[ve("No")]),_:1}),m(v,{disabled:_(a).loading,type:"primary",onClick:I[1]||(I[1]=E=>c(!0))},{default:S(()=>[ve("Add & Revise Intervention Form")]),_:1},8,["disabled"])])]),default:S(()=>[me((h(),D("div",null,[m(nt,{name:"fade"},{default:S(()=>[i.value?(h(),se(ot,{key:0,errorMessages:n.value,onResetForm:p},null,8,["errorMessages"])):W("",!0)]),_:1}),Wp,(h(!0),D(ie,null,fe(o.value,E=>(h(),D("div",{key:E.id,class:"mb-2 ms-2"},[me(l("input",{type:"checkbox","onUpdate:modelValue":U=>E.isCheck=U,class:"me-3"},null,8,Yp),[[Hs,E.isCheck]]),l("span",{innerHTML:d(E.interventionReason)},null,8,zp)]))),128))])),[[H,_(a).loading]])]),_:1},8,["modelValue"])),[[H,_(a).loading]])}}}),Xp=Ce(Zp,[["__scopeId","data-v-0f936a89"]]),Qp={class:"my-5"},em=he({__name:"ConditionRatingDateDialog",props:{visibility:{type:Boolean,default:!1},dates:{type:Array}},emits:["handle-close","handle-submit"],setup(e,{emit:t}){const a=e,s=t,r=_e(),n=we(a,"visibility"),i=()=>{s("handle-close")};return(o,d)=>{const c=Y("el-dialog"),p=be("loading");return me((h(),se(c,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=f=>n.value=f),title:"Condition Rating Date",width:"40%",onClose:d[1]||(d[1]=f=>i()),class:"dialog-word_break"},{default:S(()=>[me((h(),D("div",Qp,[l("ul",null,[(h(!0),D(ie,null,fe(a.dates,(f,I)=>(h(),D("li",{key:I,class:"my-2"},P(f),1))),128))])])),[[p,_(r).loading]])]),_:1},8,["modelValue"])),[[p,_(r).loading]])}}}),He=[{name:"site",sessionStorageName:"IronPortalDashboardFilter-Site"},{name:"equipmentModel",sessionStorageName:"IronPortalDashboardFilter-Model"},{name:"equipmentNumber",sessionStorageName:"IronPortalDashboardFilter-Equipment"},{name:"componentDescription",sessionStorageName:"IronPortalDashboardFilter-Component"}],Te=e=>(Oe("data-v-00e82247"),e=e(),Le(),e),tm={class:"section-header"},am={class:"section iron_portal-intervention","element-loading-background":"#2d2b39b3"},sm=Te(()=>l("div",{id:"error-site",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Site is mandatory")],-1)),rm=Te(()=>l("div",{id:"error-model",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Model is mandatory")],-1)),im=Te(()=>l("div",{id:"error-equipment",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Equipment is mandatory")],-1)),nm=Te(()=>l("label",{class:ke("form-label fs-6 fw-bolder text-white"),for:"componentAffected"},"Component Affected",-1)),om={key:0,class:"ms-auto"},lm={key:1,class:"ms-auto"},dm={key:0,class:"mb-2 d-flex justify-content-end text-white"},cm={key:1,class:"mb-2 d-flex justify-content-end text-white"},um=Te(()=>l("div",{id:"error-follow-up-priority",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Follow Up Priority is mandatory")],-1)),pm=Te(()=>l("div",{id:"error-intervention-description",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Intervention Description is mandatory")],-1)),mm={key:0,class:"ms-auto"},fm=Te(()=>l("div",{id:"error-condition-rating-date",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null," Condition Rating Date is mandatory ")],-1)),ym=Te(()=>l("div",{id:"error-estimation-completion-date",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"Estimation Completion Date is mandatory")],-1)),hm=Te(()=>l("div",{id:"error-work-order",class:"mb-2 d-flex justify-content-end error-label is-hidden"},[l("span",null,"SAP Work Order is mandatory")],-1)),vm={class:"section"},gm=Te(()=>l("h3",{class:"text-white mb-5"},"Intervention Checks",-1)),Dm={class:"section"},km=Te(()=>l("h3",{class:"text-white mb-5"},"Additional Tasks",-1)),Sm={class:"section"},Im=Te(()=>l("h3",{class:"text-white mb-5"},"Additional Information",-1)),bm={class:"text-white text-medium"},wm={class:"section"},_m=Te(()=>l("h3",{class:"text-white mb-5"},"Generic Defect",-1)),Nm={style:{margin:"20px 50px"}},Cm={id:"submit-button-container",class:"d-flex justify-content-end"},Pm=he({__name:"Index",setup(e){const t=ae(),a=Mt(),s=Bt(),r=hr(),n=Je(),i=_e(),o=Ve(),d=pr(),c=F(!1),p=F(""),f=F(!1),I=F(!1),v=F(!1),T=F(!1),H=F(!1),E=F(""),U=F(!1),G=F(!1),O=F(""),k=F(""),L=F(),z=F(),w=F(),x=q({get(){return o.reRenderSelection},set(N){o.setReRenderSelection(N)}}),B=q({get(){return o.reRenderComponentList},set(N){o.setReRenderComponentList(N)}}),y=q(()=>i.formIntervention),M=q(()=>i.formFilter),$=q(()=>i.formCbmHeaderVisibility),J=q(()=>i.headerCbm),V=q(()=>i.psTypeCbm),le=q(()=>n.ApprovalData.DefectGenericHeaders),oe=q(()=>n.ApprovalData.DefectGenericDetails),te=q(()=>t.user.EmployeeId),pe=F(null);it(te,async()=>{await ga()},{deep:!0});const j=q(()=>i.formLoading),K=q(()=>i.errors),ne=q(()=>i.isError),ce=q(()=>o.interventionCheckList.filter(N=>!N.isDeleted&&N.isActive)),ge=q(()=>o.additionalTaskList),b=q(()=>o.componentList),Ie=q(()=>a.ViewYesVisible),kt=q(()=>a.ViewNoVisible),St=q(()=>s.ViewVisible),It=q(()=>y.value.showConditionRatingDate?y.value.showConditionRatingDate.split(";"):[]),la=q(()=>i.isAdditionalSensorExist),ps=q(()=>y.value.statusIP.name&&y.value.statusIF.name?"255":y.value.statusIP.name&&!y.value.statusIF.name?"225":"200"),dt=q({get(){return o.isSelectedItem},set(N){o.setIsSelectedItem(N),B.value=!0}}),da=q(()=>o.selectedHeader),ms=Ht().shape({site:Se().required("site"),equipmentModel:Se().required("model"),equipmentNumber:Se().required("equipment"),conditionRatingDate:Se().required("Condition Rating Date"),interventionStatus:Se().required("intervention-status"),followUpPriority:Se().when("interventionStatus",{is:"Accepted",then:Se().required("follow-up-priority")}),interventionDiagnostic:Se().when("interventionStatus",{is:"Accepted",then:Se().required("intervention-description")}),workOrder:Se().when("interventionStatus",{is:"Accepted",then:Se().required("work-order")})}),ca=N=>{const R=r.Ownership.find(ee=>ee.equipmentNumber==N);O.value=(R==null?void 0:R.ownership)??"",k.value=(R==null?void 0:R.serialNumber)??""},ct=async()=>{if(M.value.keyPbi!=""){const N={keyPbi:M.value.keyPbi};i.setFormFilter(N),o.setFilter(N),await i.getDataFromKeyPbi(M.value.keyPbi),f.value=!1,H.value=!1,ca(y.value.equipment),Ct.value=""}},bt=q(()=>y.value.site==""),ua=q(()=>y.value.equipmentModel==""),ut=C.debounce((N=!1)=>{i.getSiteLookup(N)},300),wt=C.debounce((N=!1)=>{i.getEquipmentModelLookup(N)},300),_t=C.debounce(()=>{i.getEquipmentNumberLookup()},300),fs=N=>{y.value.site=N,Ke(),Nt(),dt.value=!1,mt(He[0]),N==""&&(ut(),pa("")),ut(),wt(),_t()},pa=async N=>{y.value.equipmentModel=N,Ke(),Nt(),dt.value=!1,mt(He[1]),N==""?ma(""):N!=""&&bt.value&&await i.getSiteLookup(bt.value),ut(),wt(),_t()},ma=async N=>{y.value.equipmentNumber=N,Ke(),Nt(),dt.value=!1,mt(He[2]),N!=""&&(bt.value&&await i.getSiteLookup(bt.value),ua.value&&await i.getEquipmentModelLookup(ua.value),i.getConditionRatingDateLookup()),ut(),wt(),_t(),fa("")},fa=async N=>{Ke(),dt.value=!1,N==""?(Nt(),y.value.conditionRatingDate="",y.value.componentHours="",y.value.interventionReason="",y.value.conditionRatingSmu="",y.value.interventionCodeId=""):(y.value.conditionRatingDate=i.conditionRatingDateOption[N].conditionRatingDate,i.setFormFilter({keyPbi:i.conditionRatingDateOption[N].keyPbi}),await ct(),ft(y.value.interventionStatus=="Accepted"))},Nt=()=>{o.resetAllList(),i.resetFormIntervention(),i.resetGeneric(!0),ya()},ya=()=>{let N=document.getElementsByClassName("error-label");if(N)for(let R=0;R<N.length;R++)N[R].classList.add("is-hidden");if(N=document.getElementsByClassName("is-input-error"),N)for(let R=0;R<N.length;R++)N[R].classList.remove("is-input-error")},pt=N=>{let R=document.getElementById(`error-${N}`);R&&R.classList.add("is-hidden"),R=document.getElementById(N).getElementsByClassName("el-form-item__content")[0],R&&R.classList.remove("is-input-error")},Ct=F(""),ys=async N=>{if(pt("intervention-status"),y.value.interventionStatus=N,o.setReRenderSelection(!1),ya(),N=="Accepted")Ct.value=y.value.declineReason,y.value.declineReason="",E.value="",await i.getFollowUpPriorityLookup();else if(N=="Declined"){y.value.declineReason=Ct.value,Ct.value="",await ha(""),i.resetInterventionWhenStatusIsDeclined();const R=document.getElementById("submit-button-container");da.value=="Declined"&&await o.getComponentList(),$s(()=>{R==null||R.scrollIntoView()})}o.setReRenderSelection(!0)},hs=N=>{pt("intervention-description"),y.value.interventionDiagnostic=N},ha=async N=>{pt("follow-up-priority"),y.value.followUpPriority=N,N==""?y.value.estimationCompletionDate="":await i.getEstimationCompletionDate()},vs=async N=>{Ke(),pt("estimation-completion-date"),y.value.estimationCompletionDate=N},gs=N=>{pt("work-order"),y.value.workOrder=N},Ds=async()=>{f.value=!1,I.value=!1,v.value=!1,ja("Are you sure you want to submit?").then(async N=>{N.isConfirmed&&(x.value=!1,B.value=!1,i.updateData(t.user.Name,te.value).then(async()=>{i.isError?(i.setIsError(!1),Gs(K.value[0],"Ok")):qt("Form has been successfully submitted!","Ok").then(async()=>{i.isFromEquipment?(d.push("/ironportal-dashboard/equipment"),i.setIsFromEquipment(!1)):(await ct(),ft(y.value.interventionStatus=="Accepted"))})}),x.value=!0,B.value=!0)})},ks=async()=>{Ke(),await ms.validate(y.value,{abortEarly:!1}).catch(N=>{i.setIsError(!0),N.errors.forEach(R=>{let ee=document.getElementById(`error-${R}`);ee&&ee.classList.remove("is-hidden"),ee=document.getElementById(R).getElementsByClassName("el-form-item__content")[0],ee&&ee.classList.add("is-input-error")}),setTimeout(()=>{const R=document.getElementById(N.errors[0]);R&&R.scrollIntoView({behavior:"smooth",block:"center"})},100)}),!ne.value&&(y.value.interventionStatus=="Accepted"&&!y.value.interventionHeaderId?await Ds():y.value.interventionStatus=="Accepted"?v.value=!0:(y.value.declineReason&&y.value.interventionHeaderId&&(E.value=y.value.declineReason),f.value=!0))},Ss=async()=>{await i.updateData(t.user.Name,te.value).then(async()=>{f.value=!1,i.isError||qt("Form has been successfully submitted!","Ok").then(async()=>{await ct(),ft(y.value.interventionStatus=="Accepted")})}).catch(async N=>{console.log(N)}),x.value=!0,B.value=!0},Is=async()=>{await i.updateData(t.user.Name,te.value).then(async()=>{v.value=!1,i.isError||qt("Form has been successfully submitted!","Ok").then(async()=>{await ct(),ft(y.value.interventionStatus=="Accepted")})}).catch(async N=>{console.log(N)}),x.value=!0,B.value=!0},bs=()=>{E.value=y.value.declineReason,H.value=!0,f.value=!0},ws=()=>{H.value=!0,I.value=!0},_s=()=>{T.value=!0},Ke=()=>{i.setErrors([]),o.setErrors([])},Ut=N=>{p.value=N},Ns=()=>{i.setFormCbmHeaderVisibility(!1),i.setPsTypeCbm("")},va=async N=>{const R={employeeId:N,page:"1",pageSize:"1",ver:"v1"};try{return(await g.get(fr,"",new URLSearchParams(R).toString())).data.result.content[0].Location}catch(ee){console.log(ee)}return""},We=q(()=>y.value.interventionStatus=="Declined"||y.value.interventionExecutionId>4),ga=async(N="")=>{if(te.value){N&&N!="AU02"&&(c.value=!0);const R=Cs(He[0].sessionStorageName),ee=t.user.Location=="Head Office"?"Blackwater":t.user.Location,De=R||ee;y.value.site=De,sessionStorage.setItem(He[0].sessionStorageName,JSON.stringify([De]))}else y.value.site="Blackwater",y.value.equipmentModel="930E-4 HPI";for(let R=1;R<He.length;R++){const ee=He[R],De=JSON.parse(sessionStorage.getItem(ee.sessionStorageName)),Xe=De!=null&&De.length>0?De[0]:y.value[ee.name];Xe&&(ee.name=="equipmentModel"?y.value.equipmentModel=Xe:ee.name=="equipmentNumber"?y.value.equipmentNumber=Xe:ee.name=="componentDescription"&&(y.value.componentDescription=Xe))}},Cs=N=>{const R=sessionStorage.getItem(N);return R&&R.length>0?JSON.parse(R)[0]:""},mt=(N=null)=>{if(N){if(y.value[N.name]||y.value[N.name]==""){const R=y.value[N.name]==""?[]:[y.value[N.name]];sessionStorage.setItem(N.sessionStorageName,JSON.stringify(R))}return}He.forEach(R=>{if(y.value[R.name]||y.value[R.name]==""){const ee=y.value[R.name]==""?[]:[y.value[R.name]];sessionStorage.setItem(R.sessionStorageName,JSON.stringify(ee))}})};Ms(async()=>{dt.value=!1,i.setIsFromIntervention(!0);try{await i.getInterventionStatusLookup();let R="";if(te.value&&(R=await va(te.value),R!="AU02"&&(c.value=!0)),ut(),!i.isFromEquipment&&!sessionStorage.getItem("formFilter")){if(await ga(R),wt(),y.value.equipmentModel==""){const ee=JSON.parse(sessionStorage.getItem("IronPortalDashboardFilter-Model"));i.equipmentModelOption.map(De=>{De.label=="930E-4 HPI"&&(!ee||ee.length==0)&&(y.value.equipmentModel="930E-4 HPI",sessionStorage.setItem("IronPortalDashboardFilter-Model",JSON.stringify(["930E-4 HPI"])))})}_t(),y.value.equipmentNumber!=""&&await i.getConditionRatingDateLookup()}else{const ee=JSON.parse(sessionStorage.getItem("formFilter"));i.setIsFromEquipment(!0),i.setFormFilter(ee),sessionStorage.removeItem("formFilter");const De=JSON.parse(sessionStorage.getItem("IronPortalDashboardFilter-Component"))[0];De&&o.setComponentFromEquipment(De);var N=setInterval(async()=>{te.value&&(clearInterval(N),await ct(),ft(y.value.interventionStatus=="Accepted"||!y.value.interventionStatus),mt())},750)}await o.getLookupTypeTask(),await o.getLookupUom(),await r.getCBMMappingDataFromServer(),await r.getMasterDataFromServer(),await r.getCBMMappings(),window.addEventListener("beforeunload",()=>{mt()})}catch(R){console.log(R)}});const ft=async N=>{const R=N?o.mapHeaderFromExecutionIdAndDefectId(y.value.interventionExecutionId,y.value.defectStatusId):"Declined";R=="Declined"?(o.setSelectedHeader("Declined"),await o.setHeaderDeclined("Declined",1)):await o.setHeaderChange(R)};Bs(async()=>{i.resetFormIntervention(),o.resetAllList(),i.resetGeneric(!0),await i.getFollowUpPriorityLookup()}),mr(N=>{N.fullPath.includes("/ironportal-dashboard/equipment")||(i.setIsFromIntervention(!1),i.resetFormInterventionAndFilter())});const Ps=()=>{y.value.declineReason&&E.value&&(y.value.declineReason=E.value),H.value=!1,f.value=!1},Ts=()=>{H.value=!1,I.value=!1},Es=()=>{v.value=!1,H.value=!1},As=async()=>{if(te.value){if(await va(te.value)!="AU02"){c.value=!0;const R=JSON.parse(sessionStorage.getItem(He[0].sessionStorageName)),ee=R!=null&&R.length>0?R[0]:t.user.Location;y.value.site=ee;const De=R!=null&&R.length>0?R:[ee];sessionStorage.setItem(He[0].sessionStorageName,JSON.stringify(De))}}else y.value.site="Blackwater",y.value.equipmentModel="930E-4 HPI"},Fs=async N=>{ca(y.value.equipmentNumber);const R=oe.value.find(De=>De.defectHeaderId==N.defectHeaderId);if(!R)return;const ee=R.detail;ee.type=="NO"?(w.value=ee,G.value=!0):(z.value=ee,L.value={},L.value.isDecline=N.taskDeclineReason!="",L.value.declineReason=N.taskDeclineReason??"",L.value.declineDate=N.taskDeclineDate,L.value.declineBy=N.taskDeclineBy,U.value=!0)};return(N,R)=>{const ee=Y("el-col"),De=Y("el-row"),Xe=Y("ViewOnlyDefectYesForm"),Rs=Y("ViewOnlyDefectNoForm"),Vs=Y("ViewOnlyNAForm"),Os=be("loading");return h(),D(ie,null,[l("div",tm,[m(Vp,{onOnBackToList:As})]),me((h(),D("div",am,[m(De,{gutter:50},{default:S(()=>[m(ee,{span:12},{default:S(()=>[m(Ue,{id:"site",class:"custom-text-input",labelClass:"text-white",value:y.value.site,isLoading:j.value.site,placeholder:"Select Site",label:"Site",name:"Site",max:200,onHandleChange:fs,"is-disabled":_(i).isFromEquipment||c.value,options:_(i).siteOption},null,8,["value","isLoading","is-disabled","options"]),sm,m(Ue,{id:"model",class:"custom-text-input",labelClass:"text-white",value:y.value.equipmentModel,isLoading:j.value.equipmentModel,placeholder:"Select Model",label:"Model",name:"EquipmentModel",max:200,onHandleChange:pa,"is-disabled":_(i).isFromEquipment,options:_(i).equipmentModelOption},null,8,["value","isLoading","is-disabled","options"]),rm,m(Ue,{id:"equipment",class:"custom-text-input",labelClass:"text-white",value:y.value.equipmentNumber,isLoading:j.value.equipmentNumber,placeholder:"Select Equipment",label:"Equipment",name:"EquipmentNumber",max:200,onHandleChange:ma,"is-disabled":_(i).isFromEquipment,options:_(i).equipmentNumberOption},null,8,["value","isLoading","is-disabled","options"]),im]),_:1}),m(ee,{span:12},{default:S(()=>[m(jr,{labelClass:"text-white",value:y.value.interventionReason,paragraph:y.value.interventionReason,placeholder:"This value will appear when other form is filled",label:"Intervention Reason",name:"InterventionReason",textInputType:"textarea",disabled:!0},null,8,["value","paragraph"])]),_:1}),m(ee,{span:12},{default:S(()=>[nm,m(Zr,{isCannotEdit:We.value,"list-data":b.value,reRender:B.value,isLoading:_(o).componentListLoading||_(o).loading,height:ps.value},null,8,["isCannotEdit","list-data","reRender","isLoading","height"])]),_:1}),m(ee,{span:12},{default:S(()=>[m(De,{gutter:20,class:"mt-0.5"},{default:S(()=>[m(ee,{span:12},{default:S(()=>[m(Ue,{id:"intervention-status",class:"custom-text-input",labelClass:"text-white",value:y.value.interventionStatus,isLoading:j.value.interventionStatus,placeholder:"Select Intervention Status",label:"Intervention Status",name:"InterventionStatus",max:200,onHandleChange:ys,options:_(i).interventionStatusOption,"is-disabled":y.value.interventionExecutionId>4},{"after-label":S(()=>[y.value.interventionHeaderId&&y.value.declineReason?(h(),D("span",om,[l("em",{class:"fa fa-info-circle me-2",style:{color:"red","font-size":"1.1em",cursor:"pointer"},onClick:bs})])):y.value.interventionHeaderId&&y.value.approveReason?(h(),D("span",lm,[l("em",{class:"fa fa-info-circle me-2",style:{color:"green","font-size":"1.1em",cursor:"pointer"},onClick:ws})])):W("",!0)]),_:1},8,["value","isLoading","options","is-disabled"]),y.value.statusIP.name&&y.value.statusIP.date?(h(),D("span",dm,P(y.value.statusIP.name)+", "+P(_(Rt)(y.value.statusIP.date)),1)):W("",!0),y.value.statusIF.name&&y.value.statusIF.date?(h(),D("span",cm,P(y.value.statusIF.name)+", "+P(_(Rt)(y.value.statusIF.date)),1)):W("",!0)]),_:1}),m(ee,{span:12},{default:S(()=>[m(Ue,{id:"follow-up-priority",class:"custom-text-input",labelClass:"text-white",value:y.value.followUpPriority,isLoading:j.value.followUpPriority,placeholder:"Select Follow-up Priority",label:"Follow-up Priority",name:"FollowUpPriority",max:200,onHandleChange:ha,"is-disabled":We.value,options:_(i).followUpPriorityOption},null,8,["value","isLoading","is-disabled","options"]),um]),_:1})]),_:1}),m(qe,{id:"intervention-description",class:"textarea-custom",labelClass:"text-white",value:y.value.interventionDiagnostic,placeholder:"Add Intervention Description",label:"Intervention Description",name:"InterventionDiagnostic",onHandleChange:hs,max:1500,disabled:We.value,textInputType:"textarea"},null,8,["value","disabled"]),pm]),_:1}),m(ee,{span:12},{default:S(()=>[m(Ue,{id:"condition-rating-date",class:"custom-text-input",labelClass:"text-white",value:y.value.conditionRatingDate,isLoading:j.value.conditionRatingDate,placeholder:!y.value.equipmentNumber||y.value.equipmentNumber==""?"Please select an Equipment first":"Select Condition Rating Date",label:"Condition Rating Date",name:"ConditionRatingDate",max:200,onHandleChange:fa,"is-disabled":!y.value.equipmentNumber||y.value.equipmentNumber==""||_(i).isFromEquipment,options:_(i).conditionRatingDateOption},{"after-label":S(()=>[It.value.length>1?(h(),D("span",mm,[l("em",{class:"fa fa-info-circle me-2",style:{color:"#f0f0f0","font-size":"1.1em",cursor:"pointer"},onClick:_s})])):W("",!0)]),_:1},8,["value","isLoading","placeholder","is-disabled","options"]),fm]),_:1}),m(ee,{span:12},{default:S(()=>[m(dr,{id:"estimation-completion-date",class:"custom-text-input",labelClass:"text-white",value:y.value.estimationCompletionDate,label:"Estimated Completion Date",name:"EstCompletionDate","is-loading":j.value.estimationCompletionDate,"is-disabled":We.value,onHandleChange:vs},null,8,["value","is-loading","is-disabled"]),ym]),_:1}),m(ee,{span:12},{default:S(()=>[m(De,{gutter:20},{default:S(()=>[m(ee,{span:12},{default:S(()=>[m(qe,{labelClass:"text-white",value:y.value.conditionRatingSmu,placeholder:"This value will appear when other form is filled",label:"Condition Rating SMU",name:"ConditionRatingSmu",disabled:!0},null,8,["value"])]),_:1}),m(ee,{span:12},{default:S(()=>[m(qe,{labelClass:"text-white",value:y.value.frameHours,placeholder:"This value will appear when other form is filled",label:"Frame Hours",name:"FrameHours",disabled:!0},null,8,["value"])]),_:1})]),_:1})]),_:1}),m(ee,{span:12},{default:S(()=>[m(qe,{id:"work-order",textInputType:"number",labelClass:"text-white",value:y.value.workOrder,placeholder:"Add SAP Work Order Number",label:"SAP Work Order Number",name:"SapWorkOrderNumber",onHandleChange:gs,disabled:We.value,max:20},null,8,["value","disabled"]),hm]),_:1})]),_:1})])),[[Os,_(i).loading]]),l("div",vm,[gm,We.value?(h(),se(Ui,{key:0,listData:ce.value,onSetDeclineReason:Ut,isLoading:_(o).componentListLoading||_(o).loading},null,8,["listData","isLoading"])):(h(),se(rn,{key:1,reRender:x.value,listData:ce.value,onSetDeclineReason:Ut,disableSelection:We.value,isLoading:_(o).componentListLoading||_(o).loading},null,8,["reRender","listData","disableSelection","isLoading"]))]),l("div",Dm,[km,m(zo,{ref_key:"additionalTaskRef",ref:pe,listData:ge.value,canEditAndDelete:y.value.interventionStatus!="Declined"&&y.value.interventionExecutionId<=4,onSetDeclineReason:Ut},null,8,["listData","canEditAndDelete"])]),l("div",Sm,[Im,l("p",bm,P(y.value.additionalInformation),1)]),l("div",wm,[_m,m(kl,{"list-data":le.value,onOnViewDetailInformation:Fs,loading:_(i).genericLoading},null,8,["list-data","loading"])]),l("div",Nm,[m(nt,{name:"fade"},{default:S(()=>[ne.value&&K.value.length>0?(h(),se(ot,{key:0,errorMessages:K.value,onResetForm:Ke},null,8,["errorMessages"])):W("",!0)]),_:1}),l("div",Cm,[m(Xu,{"form-intervention":y.value,onClicked:ks,isLoading:_(i).loading,selectedHeader:da.value},null,8,["form-intervention","isLoading","selectedHeader"])])]),m(Xe,{visibility:Ie.value,"defect-data":_(a).defectInfo,onClose:R[0]||(R[0]=()=>_(a).resetInstance()),"is-intervention":!0,"decline-reason":p.value},null,8,["visibility","defect-data","decline-reason"]),m(Rs,{visibility:kt.value,"is-intervention":!0,"defect-data":_(a).defectInfo,onClose:R[1]||(R[1]=()=>_(a).resetInstance())},null,8,["visibility","defect-data"]),m(Vs,{visibility:St.value,"is-intervention":!0,onClose:R[2]||(R[2]=()=>_(s).resetInstance())},null,8,["visibility"]),m(Zu,{viewOnly:"",equipmentModel:y.value.equipmentModel,psType:V.value,visibility:$.value,"cbm-data":J.value,onCloseForm:Ns},null,8,["equipmentModel","psType","visibility","cbm-data"]),m(Bp,{isEdit:!H.value,visibility:f.value,declinerName:y.value.statusIF.name||y.value.statusIP.name,declinerDate:y.value.statusIF.date||y.value.statusIP.date,onHandleClose:Ps,onHandleSubmit:Ss},null,8,["isEdit","visibility","declinerName","declinerDate"]),m(xp,{visibility:I.value,approverName:y.value.statusIP.name||y.value.statusIP.name,approverDate:y.value.statusIP.date||y.value.statusIP.date,onHandleClose:Ts},null,8,["visibility","approverName","approverDate"]),m(Jp,{visibility:v.value,onHandleClose:Es,onHandleSubmit:Is},null,8,["visibility"]),m(em,{dates:It.value,visibility:T.value,onHandleClose:R[3]||(R[3]=()=>{T.value=!1})},null,8,["dates","visibility"]),m(Xp,{visibility:la.value,onHandleClose:R[4]||(R[4]=()=>{la.value=!1})},null,8,["visibility"]),m(gu,{visibility:G.value,data:w.value,ownership:O.value,"serial-number":k.value,onOnClose:R[5]||(R[5]=()=>{G.value=!1})},null,8,["visibility","data","ownership","serial-number"]),m(Mc,{visibility:U.value,data:z.value,decline:L.value,ownership:O.value,"serial-number":k.value,onOnClose:R[6]||(R[6]=()=>{U.value=!1})},null,8,["visibility","data","decline","ownership","serial-number"])],64)}}}),Lf=Ce(Pm,[["__scopeId","data-v-00e82247"]]);export{Lf as default};
