import{u as Ie}from"./vuex-BbOKrtVp.js";import{c as K,a as _e,K as Ce,j as Le,A as Pe}from"./index-BuVmIl8K.js";import{P as Se}from"./Pagination-D-xfdYmn.js";import{P as $e}from"./Pagination-BiobnanQ.js";import{d as ie}from"./pinia-BjOS2_Ao.js";import{o as ue,C as xe,D as Te,q as me,y as pe}from"./date-format-8-IvfSl3.js";import{e as Ae,_ as be}from"./lodash-DrHMlsdo.js";import{O as he,P as Be,Q as ye,R as Ve,S as we,T as oe,U as le,j as Ee}from"./helpers-wUOLw-dU.js";import{c as Ue}from"./mapOption-CeGMwmH0.js";import{k as J,r as y,p as v,aa as T,aB as t,s as r,x as c,R as I,B as z,F as Q,$ as Me,q as A,u as f,bd as X,bb as Z,c as j,d as Ne,y as Y,A as B,Y as re,C as x,a0 as de,T as Re,a7 as Oe,L as ze}from"./@vue-BypzYtbH.js";import{_ as ee}from"./nw-img-vue-CR837WER.js";import{_ as je}from"./Icon.vue_vue_type_script_setup_true_lang-DE-yo5DI.js";import{a as qe}from"./table-sort-Bpdq_Uwn.js";import{a as Ge}from"./vee-validate-C_msoaAA.js";import{c as We,g as ne,a as He}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{E as Je}from"./ErrorAlert-CMKGfwAi.js";import{A as Ye}from"./MetronicAlert-CahvwpSR.js";import{_ as ge}from"./FileDropZone.vue_vue_type_style_index_0_lang-C5PyimC7.js";import{_ as Ke}from"./SwitchInput.vue_vue_type_script_setup_true_lang-BosisL7w.js";import{a as Qe}from"./element-plus-BeWdvTRa.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./vue-router-iNp9kJ0K.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./moment-C5S46NFB.js";import"./number-format-BdMuQVyW.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";const Xe="https://digital-bumaau-dev-apm-001.azure-api.net/utility/api/master_attachment/attachments",Ze="https://digital-bumaau-dev-apm-001.azure-api.net/utility/api/master_attachment/download_by_id",et="https://digital-bumaau-dev-apm-001.azure-api.net/utility/api/master_attachment/lookup",tt="https://digital-bumaau-dev-apm-001.azure-api.net/utility/api/master_attachment/upload_attachment";class ve{constructor(){this.id=null,this.startDate=null,this.endDate=null,this.code="",this.desc="",this.fileType="",this.order="",this.page=1,this.pageSize=20}}const te=ie({id:"mediaLibraryList",state:()=>({stateFilterForm:new ve,stateList:[],statePageName:"mediaLibrary",statePagination:new $e,stateLoading:!1,statePaginationLoading:!1,stateLastId:0,stateChecklistDownload:[]}),getters:{pageName:e=>e.statePageName,pagination:e=>e.statePagination,list:e=>e.stateList,checklistDownload:e=>e.stateChecklistDownload,loading:e=>e.stateLoading,paginationLoading:e=>e.statePaginationLoading,lastId:e=>e.stateLastId,intersectionListItem:e=>Ae.intersectionBy(e.stateList,e.stateChecklistDownload,"AttachmentId")},actions:{setTotalPage(e){this.pagination.totalPage=e,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async getList(){this.stateLoading=!0;const e={Page:this.stateFilterForm.page?this.stateFilterForm.page.toString():"1",PageSize:this.stateFilterForm.pageSize.toString(),FileType:this.stateFilterForm.fileType?String(this.stateFilterForm.fileType):"",Id:this.stateFilterForm.id?String(this.stateFilterForm.id):"",Code:this.stateFilterForm.code?String(this.stateFilterForm.code):"",Description:this.stateFilterForm.desc?String(this.stateFilterForm.desc):"",StartDate:this.stateFilterForm.startDate?ue(this.stateFilterForm.startDate):"",EndDate:this.stateFilterForm.endDate?ue(this.stateFilterForm.endDate):"",Order:this.stateFilterForm.order,ver:"v1"};try{const u=await K.get(Xe,"",new URLSearchParams(e).toString());this.stateList=u.data.result.content.attachmentList,this.stateLastId=u.data.result.content.lastId,this.setTotalPage(u.data.result.total)}catch(u){console.log(u)}this.stateLoading=!1},async setPage(e){this.statePaginationLoading=!0,this.statePagination.totalPageSize=this.stateFilterForm.pageSize,this.statePagination.handleCurrentPageChange(e),this.stateFilterForm.page=this.statePagination.currentPage,await this.getList(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:e,order:u}){if(!e&&!u)this.stateFilterForm.order="";else{const s=u=="ascending"?"asc":"desc";this.stateFilterForm.order=`${e}_${s}`}await this.setPage(1)},async setAppliedFilter(e){this.stateFilterForm=e,await this.setPage(1)},setChecklistDownload(e,u){e=="remove"?this.stateChecklistDownload=he(this.stateChecklistDownload,s=>s.AttachmentId===u.AttachmentId):e=="add"&&(this.stateChecklistDownload.some(a=>a.AttachmentId===u.AttachmentId)||this.stateChecklistDownload.push(u))},setUnselectedAllChecklistDownload(){this.stateList.forEach(e=>{this.stateChecklistDownload=he(this.stateChecklistDownload,u=>u.AttachmentId===e.AttachmentId)})},setSelectedAllChecklistDownload(){this.stateList.forEach(e=>{this.stateChecklistDownload.some(s=>s.AttachmentId===e.AttachmentId)||this.stateChecklistDownload.push(e)})},resetDownloadList(){this.stateChecklistDownload=[]},resetFilter(){this.stateFilterForm=new ve}}});class fe{constructor(){this.Code="",this.Description="",this.FileType="",this.Files=null,this.AttachmentId=0,this.IsActive=!0}}const se=ie({id:"mediaLibraryForm",state:()=>({stateLoading:!1,stateLoadingMessage:"",stateFormToggle:!1,stateIsNewForm:!0,stateFormItem:new fe,stateIsError:!1,stateError:"",stateErrors:[],stateFileTypeOption:[]}),getters:{formToggle:e=>e.stateFormToggle,isNewForm:e=>e.stateIsNewForm,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,fileTypeOption:e=>e.stateFileTypeOption,lastId:()=>te().lastId+1},actions:{async getFileTypeLookup(){const e={ver:"v1"};try{const u=await K.get(et,"",new URLSearchParams(e).toString()),s=o=>o,a=o=>o;this.stateFileTypeOption=Ue(u.data.result.content.fileType,s,a)}catch(u){console.log(u)}},async insertData(){this.stateLoading=!0,this.stateLoadingMessage="Submitting Data";const e=_e();try{const u={ver:"v1",userAccount:e.user.Email},s=new FormData;for(const o in this.stateFormItem)this.stateFormItem.hasOwnProperty.call(this.stateFormItem,o)&&(o!=="AttachmentId"||o==="AttachmentId"&&this.stateFormItem[o]!==0)&&(o=="Description"&&this.stateFormItem[o]==null&&(this.stateFormItem[o]=""),s.append(o,this.stateFormItem[o]));const a=await K.post(`${tt}?${new URLSearchParams(u).toString()}`,s);return a.data.result.isError?(this.setErrors(a.data.result.content.dailyOutstandingServiceList[0].validationReason.split(",")),Le("Failed to Submit","","Ok")):Ce("Record has been submitted successfully","","Ok"),this.stateLoading=!1,a.data.result.isError}catch(u){return this.setErrors([u.response.data.result.message]),this.stateLoading=!1,u.response.data.result.isError}},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},resetFormItem(){this.stateFormItem=new fe,this.stateIsNewForm=!0}}}),ae=e=>(X("data-v-1b5b68ef"),e=e(),Z(),e),st={id:"table-actions",class:"mb-6 d-flex justify-content-end"},at={class:"align-self-center d-flex gap-2 ironlake-table-toolbar"},ot={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block mr-2"},lt={class:"p-2 d-flex flex-column gap-8"},nt=ae(()=>t("section",null,[t("p",{class:"m-0 popover-title"},"Filters")],-1)),it={class:"d-flex flex-column gap-6"},rt=ae(()=>t("span",null,"ID",-1)),dt=ae(()=>t("span",null,"Code",-1)),ct=ae(()=>t("span",null,"Description",-1)),ut={class:"d-flex justify-content-end gap-3"},mt=J({__name:"ListTableFilter",setup(e,{expose:u}){const s=te(),a=se(),o=y([]),F=b=>{const m=new Date;return m.setTime(m.getTime()-3600*1e3*24*b),[m,new Date]},$=()=>{const b=xe(),m=Te(b);return[b,m]},P=[{text:"Yesterday",value:F(1)},{text:"Last week",value:F(7)},{text:"Last month",value:$()}],D=()=>{s.stateFilterForm.startDate=me(o.value[0]),s.stateFilterForm.endDate=me(o.value[1]),s.setPage(1)},C=y(!1),h=y({id:null,startDate:null,endDate:null,code:null,desc:null,fileType:null,order:"",page:1,pageSize:20});u({dataFilter:h});const _=()=>{const b=s.stateFilterForm;h.value={id:b.id,fileType:b.fileType,code:b.code,desc:b.desc,startDate:b.startDate,endDate:b.endDate,order:b.order,page:b.page,pageSize:b.pageSize}},S=()=>{o.value=[],h.value={id:null,startDate:null,endDate:null,code:null,desc:null,fileType:null,order:"",page:1,pageSize:20}},V=()=>{s.setAppliedFilter(h.value),C.value=!1},O=b=>{h.value.id=Be(b)};return(b,m)=>{const U=I("el-date-picker"),q=I("inline-svg"),M=I("el-button"),N=I("el-input"),d=I("el-form-item"),w=I("el-option"),g=I("el-select"),n=I("el-form"),L=I("el-popover");return v(),T("section",st,[t("div",at,[r(U,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=i=>o.value=i),class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",type:"daterange","unlink-panels":"","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",format:"DD/MM/YYYY",clearable:!1,shortcuts:P,onChange:D},null,8,["modelValue"]),r(L,{placement:"bottom-end",visible:C.value,width:360,onAfterLeave:_},{reference:c(()=>[r(M,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:m[1]||(m[1]=i=>C.value=!C.value)},{default:c(()=>[t("span",ot,[r(q,{src:"/media/icons/bumaau/filter_list.svg",style:{width:"1.25rem",height:"1.25rem"}})]),z(" Filter ")]),_:1})]),default:c(()=>[t("div",lt,[nt,t("section",it,[r(n,{model:h.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:c(()=>[r(d,null,{label:c(()=>[rt]),default:c(()=>[r(N,{modelValue:h.value.id,"onUpdate:modelValue":m[2]||(m[2]=i=>h.value.id=i),placeholder:"ID",onInput:O},null,8,["modelValue"])]),_:1}),r(d,null,{label:c(()=>[dt]),default:c(()=>[r(N,{modelValue:h.value.code,"onUpdate:modelValue":m[3]||(m[3]=i=>h.value.code=i),placeholder:"Code",onInput:m[4]||(m[4]=i=>h.value.code=i)},null,8,["modelValue"])]),_:1}),r(d,null,{label:c(()=>[ct]),default:c(()=>[r(N,{modelValue:h.value.desc,"onUpdate:modelValue":m[5]||(m[5]=i=>h.value.desc=i),placeholder:"Description",onInput:m[6]||(m[6]=i=>h.value.desc=i)},null,8,["modelValue"])]),_:1}),r(d,{label:"Media Type"},{default:c(()=>[r(g,{modelValue:h.value.fileType,"onUpdate:modelValue":m[7]||(m[7]=i=>h.value.fileType=i),placeholder:"Write Media Type",clearable:"",filterable:"",multiple:""},{default:c(()=>[(v(!0),T(Q,null,Me(f(a).fileTypeOption,i=>(v(),A(w,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("section",ut,[t("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md me-auto",onClick:S}," Reset "),t("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md",onClick:m[8]||(m[8]=i=>C.value=!1)}," Close "),t("button",{class:"btn btn-btech-secondary btech-md",onClick:V}," Apply ")])])]),_:1},8,["visible"])])])}}}),pt=ee(mt,[["__scopeId","data-v-1b5b68ef"]]),ce="/media/icons/bumaau/iron-lake/File.png",Fe=ie({id:"mediaLibraryBulk",state:()=>({stateIsBulkDownload:!1,stateListBulkDownload:[],stateLoading:!1,stateLoadingMessage:""}),getters:{isBulkDownload:e=>e.stateIsBulkDownload,loading:e=>e.stateLoading,loadingMessage:e=>e.stateLoadingMessage},actions:{setIsBulkDownload(e){this.stateIsBulkDownload=e},setLoading(e){this.stateLoading=e},setItemListBulkDownload(e){this.stateListBulkDownload=e},async downloadAttachmentBlob(e){const u={ver:"v1",id:e.AttachmentId};try{return(await K.getBlob(Ze,"",new URLSearchParams(u).toString())).data}catch(s){throw console.log(s),s}},async downloadAttachmentList(){this.stateLoading=!0,this.stateLoadingMessage="Downloading Attachment";const e=[];this.stateListBulkDownload.forEach(u=>{e.push(new Promise((s,a)=>{this.downloadAttachmentBlob(u).then(o=>{s(o)}).catch(o=>{a(o)})}))}),await Promise.allSettled(e).then(async u=>{for(const[s,a]of u.entries()){if(a.status=="rejected")continue;const o=ye(this.stateListBulkDownload[s].FileType,!0),F=`${this.stateListBulkDownload[s].Code}.${this.stateListBulkDownload[s].FileType}`;a.value&&await Ve(a.value,o,F)}this.stateLoading=!1,this.resetBulkList()})},resetBulkList(){this.stateIsBulkDownload=!1,this.stateListBulkDownload=[]}}}),De=e=>(X("data-v-793cb6a9"),e=e(),Z(),e),ht={key:0,style:{height:"100px"}},gt={key:0,class:"mt-3 mb-3"},vt=De(()=>t("span",null," Choose bulk action: ",-1)),ft={class:"d-flex align-items-start gap-3"},_t=De(()=>t("img",{src:ce,style:{width:"50px",height:"50px"},alt:"file"},null,-1)),bt={class:"mt-2"},yt={style:{color:"#919EAB"}},wt={style:{color:"#34B3F1"}},Ft={class:"d-flex justify-content-center gap-6"},Dt=["onClick"],kt=["onClick"],It=J({__name:"ListTable",props:{search:{required:!0,type:String},currentSelection:{required:!0,type:Object}},emits:["show-form","show-viewer","change-selection","update-checklist-download"],setup(e,{expose:u,emit:s}){const a=e,o=s,F=te(),$=se(),P=Fe(),D=y(),C=y({prop:"",order:""}),h=(d,w)=>(d??"").toLowerCase().includes(w.toLowerCase()),_=j(()=>F.stateList.filter(d=>{const w=h(d.Code,a.search),g=h(d.OriginalFileName,a.search),n=h(d.FormattedFileName,a.search),L=h(d.FileType,a.search),i=h(d.FileUrl,a.search),E=h(d.Description,a.search);return!a.search||w||g||n||L||i||E})),S=(d,w,g)=>qe(d[g],w[g],C.value.order);Ne(()=>_.value,()=>{setTimeout(()=>{D.value&&N(a.currentSelection)},100)});const V=async d=>{const w={prop:d.prop,order:d.order};C.value={prop:d.prop,order:d.order},await F.setSort(w),o("update-checklist-download")},O=d=>({Code:d.Code,Description:d.Description,FileType:d.FileType,AttachmentId:d.AttachmentId,IsActive:d.IsActive}),b=d=>{const w=O(d.row);$.stateIsNewForm=!1,$.stateFormItem=w,o("show-form")},m=d=>{o("show-viewer",{dataList:d.row,type:we(d.row.FileType)})},U=()=>{D.value.clearSelection()},q=async()=>{await P.downloadAttachmentList(),U()},M=d=>{P.setItemListBulkDownload(d),o("change-selection",d)},N=d=>{if(d){const w=d==null?void 0:d.map(n=>n.AttachmentId);be.filter(F.stateList,n=>w&&w.includes(n.AttachmentId)).forEach(n=>{D.value.store.states.selection.value.some(i=>i.AttachmentId===n.AttachmentId)||D.value.store.states.selection.value.push(n)})}else U()};return u({toggleSelection:N,resetSelectionRef:U}),(d,w)=>{const g=I("el-button"),n=I("el-table-column"),L=I("inline-svg"),i=I("el-tooltip"),E=I("el-table"),R=re("loading");return f(F).loading?Y((v(),T("div",ht,null,512)),[[R,f(F).loading]]):(v(),T(Q,{key:1},[f(P).isBulkDownload?(v(),T("div",gt,[vt,r(g,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",style:{padding:"0.23rem 0.8rem"},onClick:q},{default:c(()=>[r(je,{name:"download",size:"24"}),z(" Download ")]),_:1})])):B("",!0),Y((v(),A(E,{ref_key:"multipleTableRef",ref:D,data:_.value,"empty-text":"No Data","default-sort":C.value,style:{width:"100%"},"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSortChange:V,onSelect:M,onSelectAll:M},{default:c(()=>[r(n,{prop:"AttachmentId",label:"Code & ID",width:"350",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"AttachmentId")},{default:c(l=>[t("div",ft,[_t,t("div",bt,[t("div",null,x(l.row.Code),1),t("div",yt,x(l.row.AttachmentId),1)])])]),_:1},8,["sort-method"]),r(n,{prop:"Description",label:"Description",width:"400",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"Description")},null,8,["sort-method"]),r(n,{prop:"FileType",label:"Media Type",width:"200",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"FileType")},{default:c(l=>[t("span",null,x(l.row.FileType?f(ye)(l.row.FileType):""),1)]),_:1},8,["sort-method"]),r(n,{prop:"FileUrl",label:"Path Directory",width:"300",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"FileUrl")},{default:c(l=>[t("span",wt,x(l.row.FileUrl?l.row.FileUrl.replaceAll("{BLOB_URL}/",""):""),1)]),_:1},8,["sort-method"]),r(n,{prop:"CreatedOn",label:"Created Date",width:"185",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"CreatedOn")},{default:c(l=>[t("span",null,x(f(pe)(l.row.CreatedOn)),1)]),_:1},8,["sort-method"]),r(n,{prop:"CreatedBy",label:"Created By",width:"300",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"CreatedBy")},null,8,["sort-method"]),r(n,{prop:"ChangedOn",label:"Updated Date",width:"185",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"ChangedOn")},{default:c(l=>[t("span",null,x(f(pe)(l.row.ChangedOn)),1)]),_:1},8,["sort-method"]),r(n,{prop:"ChangedBy",label:"Updated By",width:"300",sortable:"","sort-orders":["ascending","descending"],"sort-method":(l,p)=>S(l,p,"ChangedBy")},null,8,["sort-method"]),f(P).isBulkDownload?B("",!0):(v(),A(n,{key:0,label:"Action","header-align":"center",fixed:"right",width:"80"},{default:c(l=>[t("div",Ft,[r(i,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:c(()=>[t("span",{class:"svg-icon svg-icon-btech-secondary-500 d-flex justify-content-end",style:{cursor:"pointer"},onClick:p=>b(l)},[r(L,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,Dt)]),_:2},1024),r(i,{class:"box-item",effect:"dark",content:"View",placement:"top"},{default:c(()=>[t("span",{class:"svg-icon svg-icon-btech-secondary-500 d-flex justify-content-end",style:{cursor:"pointer"},onClick:p=>m(l)},[r(L,{src:"/media/svg/tables/rows/viewer.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,kt)]),_:2},1024)])]),_:1})),f(P).isBulkDownload?(v(),A(n,{key:1,type:"selection",fixed:"left",width:"40",align:"center","header-align":"center"})):B("",!0)]),_:1},8,["data","default-sort"])),[[R,f(F).loading]])],64))}}}),Ct=ee(It,[["__scopeId","data-v-793cb6a9"]]),W=e=>(X("data-v-f4c68982"),e=e(),Z(),e),Lt={key:0,class:"container p-0"},Pt={class:"row m-0 mt-3 gap-4"},St={class:"col p-0"},$t=W(()=>t("div",{class:"file-upload-caption"},"Format media allowed: PDF, PNG, JPEG, JPG, WEBP",-1)),xt={key:1,class:"d-flex align-items-start gap-3"},Tt=W(()=>t("img",{src:ce,style:{width:"50px",height:"50px"},alt:"file"},null,-1)),At={key:0,class:"mt-2 alert-filename"},Bt={class:"container p-0"},Vt={class:"row m-0 gap-4"},Et={class:"col p-0"},Ut=W(()=>t("span",null,"ID",-1)),Mt={class:"container p-0"},Nt={class:"row m-0 gap-4"},Rt={class:"col p-0"},Ot=W(()=>t("span",{class:"required"},"Code",-1)),zt={class:"container p-0"},jt={class:"row m-0 gap-4"},qt={class:"col p-0"},Gt={class:"container p-0"},Wt={class:"row m-0 gap-4"},Ht={class:"col p-0"},Jt=W(()=>t("span",null,"Format Media",-1)),Yt={key:1,class:"container p-0"},Kt={class:"row m-0 gap-4"},Qt={class:"col p-0"},Xt={key:2,class:"container p-0"},Zt={class:"row m-0 mt-3 gap-4"},es={class:"col p-0"},ts={class:"position-relative"},ss=W(()=>t("div",{class:"file-upload-caption"},"Format media allowed: PDF, PNG, JPEG, JPG, WEBP",-1)),as={key:1,class:"d-flex align-items-start gap-3"},os=W(()=>t("img",{src:ce,style:{width:"50px",height:"50px"},alt:"file"},null,-1)),ls={key:0,class:"mt-2 alert-filename"},ns={class:"dialog-footer"},is=J({__name:"FormDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(e,{emit:u}){const s=se(),a=j({get(){return s.stateFormItem},set(g){s.stateFormItem=g}}),F=de(e,"visibility"),$=y(!1),P=y(!1),D=y(),C=y(),h=y(),_=u,S=async(g=!1)=>{$.value=!1,P.value=!1,_("handle-close",g)},V=()=>{s.resetFormItem(),M()},O=j(()=>s.errors),b=j(()=>s.isError),m=j(()=>s.stateIsNewForm&&a.value.Files?s.lastId:s.stateIsNewForm?"":a.value.AttachmentId),U=We().shape({Files:ne().when(["$isNewForm","$isNeedNewMedia"],{is:(g,n)=>g||!g&&n,then:ne().required("File is required"),otherwise:ne().notRequired()}),Code:He().required("Code is required")}),q=async()=>{await U.validate(a.value,{abortEarly:!1,context:{isNewForm:s.isNewForm,isNeedNewMedia:$.value}}).then(()=>{s.stateIsError=!1}).catch(g=>{s.setErrors(g.errors)}),!b.value&&s.insertData().then(g=>{g||(s.resetFormItem(),S(!0))})},M=()=>{s.setErrors([])},N=g=>{$.value=g,P.value=!1,a.value.Files=null},d=async g=>{const n=g.get("fileUpload");if(D.value=Qe.service({lock:!0,text:"Uploading...",background:"rgba(0, 0, 0, 0.7)"}),n instanceof File){const L=async i=>{try{const E=oe(i),R=await Ee(E);a.value.Files=R.file}catch{a.value.Files=i}};if(s.isNewForm){const i=n;i.type.startsWith("image/")?await L(i):a.value.Files=oe(i),a.value.FileType=i.type.startsWith("image/")?"webp":le(i)}else{const i=n,E=i.type.includes("image");we(a.value.FileType.toLowerCase())=="Image"&&E||a.value.FileType.toLowerCase()==le(i)?(i.type.startsWith("image/")?await L(i):a.value.Files=oe(i),a.value.FileType=i.type.startsWith("image/")?"webp":le(i)):P.value=!0}}D.value.close()},w=j(()=>a.value.Files&&a.value.Files.name&&a.value.Files.name.length>100?"Successfully uploaded with a file name limited to 100 characters.":null);return(g,n)=>{const L=I("el-form-item"),i=I("el-input"),E=I("el-form"),R=I("el-button"),l=I("el-dialog"),p=re("loading");return Y((v(),A(l,{modelValue:F.value,"onUpdate:modelValue":n[5]||(n[5]=k=>F.value=k),title:`${f(s).isNewForm?"Upload":"Edit"} Media Details`,"modal-class":"ironlake-dialog",width:500,"align-center":!0,"close-on-click-modal":!1,"show-close":!1,onClose:n[6]||(n[6]=k=>S()),onClosed:n[7]||(n[7]=k=>V())},{footer:c(()=>[t("span",ns,[r(R,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",onClick:n[4]||(n[4]=k=>S(!1)),disabled:f(s).loading},{default:c(()=>[z("Cancel")]),_:1},8,["disabled"]),r(R,{class:"btn btn-btech-secondary",onClick:q},{default:c(()=>[z(" Submit ")]),_:1})])]),default:c(()=>[r(Re,{name:"fade"},{default:c(()=>[b.value?(v(),A(Je,{key:0,errorMessages:O.value,onResetForm:M},null,8,["errorMessages"])):B("",!0)]),_:1}),r(f(Ge),null,{default:c(()=>[r(E,{ref:"ruleFormRef",model:a.value,"label-position":"top",class:"ironlake-form-media-library d-flex flex-column gap-6"},{default:c(()=>[f(s).isNewForm?(v(),T("section",Lt,[t("div",Pt,[t("div",St,[a.value.Files?(v(),T("div",xt,[Tt,t("div",null,[t("div",null,x(a.value.Files.name),1),w.value?(v(),T("div",At,x(w.value),1)):B("",!0)])])):(v(),A(L,{key:0,class:"position-relative"},{default:c(()=>[r(ge,{ref_key:"newFileDrop",ref:C,accept:".pdf, .jpg, .jpeg, .png, .webp","error-message":"Format media allowed: PDF, PNG, JPEG, JPG, WEBP",onHandleUpload:d,skipSizeValidation:!0},null,512),$t]),_:1}))])])])):B("",!0),t("section",Bt,[t("div",Vt,[t("div",Et,[r(L,null,{label:c(()=>[Ut]),default:c(()=>[r(i,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=k=>m.value=k),disabled:!0},null,8,["modelValue"])]),_:1})])])]),t("section",Mt,[t("div",Nt,[t("div",Rt,[r(L,null,{label:c(()=>[Ot]),default:c(()=>[r(i,{modelValue:a.value.Code,"onUpdate:modelValue":n[1]||(n[1]=k=>a.value.Code=k),"show-word-limit":"",maxlength:"100",placeholder:"Write your code",disabled:!f(s).stateIsNewForm||f(s).stateIsNewForm&&!a.value.Files},null,8,["modelValue","disabled"])]),_:1})])])]),t("section",zt,[t("div",jt,[t("div",qt,[r(L,null,{label:c(()=>[z(" Description ")]),default:c(()=>[r(i,{modelValue:a.value.Description,"onUpdate:modelValue":n[2]||(n[2]=k=>a.value.Description=k),type:"textarea","show-word-limit":"",maxlength:"255",placeholder:"Write your description",disabled:f(s).stateIsNewForm&&!a.value.Files,autosize:{minRows:4,maxRows:4},resize:"none"},null,8,["modelValue","disabled"])]),_:1})])])]),t("section",Gt,[t("div",Wt,[t("div",Ht,[r(L,null,{label:c(()=>[Jt]),default:c(()=>[t("div",null,x(a.value.FileType),1)]),_:1})])])]),f(s).isNewForm?B("",!0):(v(),T("section",Yt,[t("div",Kt,[t("div",Qt,[r(L,null,{default:c(()=>[r(Ke,{value:$.value,label:"Replace Media?",name:"isRepalce",onHandleChange:N},null,8,["value"])]),_:1})])])])),$.value?(v(),T("section",Xt,[t("div",Zt,[t("div",es,[a.value.Files?(v(),T("div",as,[os,t("div",null,[t("div",null,x(a.value.Files.name),1),w.value?(v(),T("div",ls,x(w.value),1)):B("",!0)])])):(v(),A(L,{key:0},{default:c(()=>[r(Ye,{"show-alert":P.value,"onUpdate:showAlert":n[3]||(n[3]=k=>P.value=k),variant:"error",desc:"Cannot change media with different format"},null,8,["show-alert"]),t("div",ts,[r(ge,{ref_key:"updateFileDrop",ref:h,accept:".pdf, .jpg, .jpeg, .png, .webp","error-message":"Format media allowed: PDF, PNG, JPEG, JPG, WEBP",onHandleUpload:d,skipSizeValidation:!0},null,512),ss])]),_:1}))])])])):B("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue","title"])),[[p,f(s).loading]])}}}),rs=ee(is,[["__scopeId","data-v-f4c68982"]]),ds={class:"row fullscreen-dialog-image-preview"},cs=t("div",{class:"bg-secondary"},null,-1),us=["src"],ms={class:"image-carousel-description"},ps=t("div",{class:"description-title"},"Description",-1),hs={class:"description-text"},gs={style:{"font-family":"'Public sans', sans-serif !important","font-size":"12px","text-wrap":"unset"}},vs=J({__name:"ImageViewerDialog",props:{visibility:{type:Boolean,default:!1},url:{required:!0,type:String},data:{required:!0,type:Object}},emits:["handleCloseModal"],setup(e,{emit:u}){const s=e,a=u,o=de(s,"visibility"),F=y(0),$=async()=>{F.value=0},P=()=>{a("handleCloseModal")};return(D,C)=>{const h=I("el-dialog");return v(),A(h,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=_=>o.value=_),title:"Preview Media",width:"90%",onClosed:C[1]||(C[1]=_=>P()),top:"2vh",onOpened:$,"destroy-on-close":""},{default:c(()=>[t("div",ds,[cs,t("img",{src:e.url||"",alt:"photo"},null,8,us)]),t("div",ms,[ps,t("div",hs,[t("pre",gs,x(e.data.Description),1)])])]),_:1},8,["modelValue"])}}}),fs={key:0,class:"row text-center my-10"},_s={class:"text-danger"},bs={class:"row justify-content-end pt-4 pe-10"},ys={class:"div page-controller",style:{"margin-left":"auto"}},ws=["disabled"],Fs=["disabled"],Ds={class:"image-carousel-description"},ks=t("div",{class:"description-title"},"Description",-1),Is={class:"description-text"},Cs={style:{"font-family":"'Public sans', sans-serif !important","font-size":"12px","text-wrap":"unset"}},Ls=J({__name:"PDFViewerDialog",props:{visibility:{type:Boolean,required:!0},url:{type:String,required:!0},data:{required:!0,type:Object}},emits:["handleCloseModal"],setup(e,{emit:u}){const s=e,a=u,o=y(1),F=y(1);y(null);const $=y(""),P=y(!1),D=de(s,"visibility"),C=()=>{o.value=1,a("handleCloseModal")};return(h,_)=>{const S=I("el-dialog");return v(),A(S,{modelValue:D.value,"onUpdate:modelValue":_[2]||(_[2]=V=>D.value=V),title:"Preview",width:"80%","custom-class":"show-pdf","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:_[3]||(_[3]=V=>C())},{default:c(()=>[P.value?(v(),T("div",fs,[t("span",_s,x($.value),1)])):(v(),T(Q,{key:1},[t("div",bs,[t("div",ys,[t("button",{type:"button",disabled:o.value<=1,onClick:_[0]||(_[0]=V=>o.value--),class:"btn btn-success btn-sm ok-button"},"❮",8,ws),z(" "+x(o.value)+" / "+x(F.value)+" ",1),t("button",{type:"button",disabled:o.value>=F.value,onClick:_[1]||(_[1]=V=>o.value++),class:"btn btn-success btn-sm ok-button"},"❯",8,Fs)])]),t("div",Ds,[ks,t("div",Is,[t("pre",Cs,x(e.data.Description),1)])])],64))]),_:1},8,["modelValue"])}}}),Ps=e=>(X("data-v-f45b1d0a"),e=e(),Z(),e),Ss={"element-loading-text":"Submitting Data","element-loading-background":"rgba(0, 0, 0, 0.5)"},$s=["element-loading-text"],xs={class:"px-3 py-8 d-flex"},Ts=Ps(()=>t("div",{class:"flex-grow-1"},[t("h5",{class:"m-0 header-title"},"Media Library")],-1)),As={class:"align-self-start d-flex gap-2"},Bs={class:"card mb-10"},Vs={class:"card-body p-3"},Es={class:"m-0 ironlake-pagination"},Us=J({__name:"Index",setup(e){const u=Ie(),s=te(),a=se(),o=Fe(),F=_e(),$=j(()=>F.user.isHO===1),P=y(),D=y([]),C=y(""),h=y(),_=j(()=>s.pagination),S=async l=>{s.stateFilterForm.pageSize=l,await s.setPage(1),O()},V=async l=>{C.value="",await s.setPage(l),O()},O=()=>{D.value=s.intersectionListItem,h.value.toggleSelection(D.value)},b=async()=>{await s.setPage(1),a.getFileTypeLookup()},m=y(!1),U=()=>{m.value=!0},q=async l=>{m.value=!1,l&&await b()},M=l=>{o.resetBulkList(),o.setIsBulkDownload(l),h.value.resetSelectionRef(),D.value=[]},N=l=>{const p=D.value.length>l.length?"remove":"add",k=be.xor(D.value,l);k.length==1?(s.setChecklistDownload(p,k[0]),D.value=l):l.length==0?s.setUnselectedAllChecklistDownload():l.length==_.value.totalPageSize&&s.setSelectedAllChecklistDownload()},d=y(),w=y(!1),g=y(!1),n=y({}),L=async l=>{o.setLoading(!0),console.log(l);const{dataList:p,type:k}=l;n.value=p;try{const H=await o.downloadAttachmentBlob(p);if(H){const G=new Blob([H]),ke=window.URL||window.webkitURL;d.value=ke.createObjectURL(G),k=="Image"?w.value=!0:k=="Document"&&(g.value=!0)}o.setLoading(!1)}catch{o.setLoading(!1)}},i=()=>{R(),w.value=!1},E=()=>{R(),g.value=!1},R=()=>{d.value="",n.value={}};return Oe(async()=>{u[Pe.ACTIVE_PAGE]("IronLake"),s.stateLoading=!0,F.user!==void 0&&(s.statePaginationLoading=!0,b())}),ze(async()=>{s.$reset(),a.$reset()}),(l,p)=>{const k=I("el-button"),H=re("loading");return v(),T(Q,null,[t("template",null,[Y(t("div",Ss,null,512),[[H,f(a).loading,void 0,{fullscreen:!0,lock:!0}]]),Y(t("div",{"element-loading-text":f(o).loadingMessage,"element-loading-background":"rgba(0, 0, 0, 0.5)"},null,8,$s),[[H,f(o).loading,void 0,{fullscreen:!0,lock:!0}]])]),t("section",xs,[Ts,t("div",As,[f(o).isBulkDownload?B("",!0):(v(),A(k,{key:0,class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",onClick:p[0]||(p[0]=G=>M(!0))},{default:c(()=>[z(" Bulk Action ")]),_:1})),f(o).isBulkDownload?(v(),A(k,{key:1,class:"btn btn-outline btn-outline-btech-cancel btn-active-light-btech-cancel btech-lg m-0",style:{borderColor:"#DFE3E8 !important"},onClick:p[1]||(p[1]=G=>M(!1))},{default:c(()=>[z(" Cancel Action ")]),_:1})):B("",!0),$.value?(v(),A(k,{key:2,class:"btn btn-btech-secondary btech-lg m-0",disabled:f(o).isBulkDownload,onClick:U},{default:c(()=>[z(" Upload Media ")]),_:1},8,["disabled"])):B("",!0)])]),t("section",Bs,[t("div",Vs,[r(pt,{ref_key:"tableFilterRef",ref:P},null,512),r(Ct,{class:"mb-6",ref_key:"listTable",ref:h,search:C.value,"current-selection":D.value,onShowForm:U,onShowViewer:L,onChangeSelection:N,onUpdateChecklistDownload:O},null,8,["search","current-selection"]),t("div",Es,[f(s).paginationLoading?B("",!0):(v(),A(Se,{key:0,currentPage:_.value.currentPage,totalPage:_.value.totalPage,totalPageSize:_.value.totalPageSize,startPaginationIndex:_.value.startPaginationIndex,endPaginationIndex:_.value.endPaginationIndex,isPageSizeChange:!0,onRaiseSizeChange:p[2]||(p[2]=G=>S(G)),onRaisePageChange:p[3]||(p[3]=G=>V(G))},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))])])]),r(rs,{visibility:m.value,onHandleClose:q},null,8,["visibility"]),r(vs,{visibility:w.value,data:n.value,url:d.value,onHandleCloseModal:i},null,8,["visibility","data","url"]),r(Ls,{visibility:g.value,data:n.value,url:d.value,onHandleCloseModal:E},null,8,["visibility","data","url"])],64)}}}),ja=ee(Us,[["__scopeId","data-v-f45b1d0a"]]);export{ja as default};
