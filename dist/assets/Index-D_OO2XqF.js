import{c as ne,s as fe,a as ye,f as At,i as ua,b as ca,y as Te,K as da,O as ma,J as pa,I as ha,P as ga,k as va,G as fa}from"./index-BuVmIl8K.js";import{k as le,l as dt,M as mt,d as qe,R as X,Y as Ee,y as se,p as c,aa as h,aB as t,C as p,s as f,u as K,K as Pe,b4 as pe,c as S,A as W,bd as Le,bb as xe,x as Q,B as _e,a0 as Ze,r as L,o as pt,L as Ot,F as ie,$ as we,q as Y,bL as at,z as Ye,aG as It,T as ya,b6 as ba,a7 as zt,O as _a}from"./@vue-BypzYtbH.js";import{u as Xt,A as Ca,M as Sa}from"./usePbiEmbeddedStore-Bda_75jS.js";import{p as We}from"./powerbi-client-99lwt5rM.js";import{q as Pt,w as Rt,A as ka,j as Ia,k as wa}from"./date-format-8-IvfSl3.js";import{o as Ea}from"./vue-router-iNp9kJ0K.js";import{a as Da,g as Nt,b as Lt}from"./utils-BpQp1sv3.js";import{d as Tt}from"./pinia-BjOS2_Ao.js";import{m as Ct}from"./mapOption-CeGMwmH0.js";import{C as Aa}from"./Cameras-vtENZZzD.js";import{s as Wt}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{_ as Ma}from"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import{_ as Ve}from"./nw-img-vue-CR837WER.js";import{x as st,y as ot,z as rt}from"./helpers-wUOLw-dU.js";import{m as it}from"./number-format-BdMuQVyW.js";import{e as Qe,_ as Yt}from"./lodash-DrHMlsdo.js";import{I as Pa}from"./ImagePreviewCabSide-CpYtX9kF.js";import{_ as Ra}from"./image-close-button-red-B1UxWyBV.js";import{_ as Oa}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as Ta}from"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import{u as Va}from"./useOfflineCameraStore-BBsMm6DV.js";import{i as xt}from"./internet-connection-CnLQPjRt.js";import{u as ht}from"./useCameraStore-BwXVJhPe.js";import{a as $a}from"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import{_ as wt}from"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import{c as Na,b as La,a as xa}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{_ as ct}from"./ElementTextInput.vue_vue_type_style_index_0_lang-kzHysIyZ.js";import{_ as Ua}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as ja}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-CCwjwK39.js";import{E as Ba}from"./ErrorAlert-CMKGfwAi.js";import{G as Fa,a as qa,b as Ka,P as Ga}from"./urls-De-ebYNz.js";import{_ as St}from"./SelectInput.vue_vue_type_script_setup_true_lang-CILKiK7F.js";import{_ as Ne,b as Ha}from"./element-plus-BeWdvTRa.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./moment-C5S46NFB.js";import"./urls-Cljsxeb-.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./simple-vue-camera-D9MGhAeE.js";import"./vue-BzYgrL08.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./@vueuse-DFoNmIyu.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";const kt="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/3dp_hornet/lookup",Ja="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_3dp_hornet/get_3dp_sensor",za="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_3dp_hornet/submit_intervention",Ut={site:"",model:"",equipment:"",component:[],ver:"v1"},Xa={site:!1,model:!1,equipment:!1,component:!1},Vt=Tt({id:"summaryIntervention",state:()=>({stateIsFromEquipment:!1,stateIsFromIntervention:!1,stateFilter:Ut,stateFilterLoading:{...Xa},stateIsError:!1,stateErrors:[],stateSiteOption:[],stateModelOption:[],stateEquipmentOption:[],stateComponentOption:[],stateSensorDataTotal:-1,stateIsSensorSelectAll:!0,stateRerenderSensorList:!0,stateSensorPaginate:{page:1,pagesize:20,lastPage:-1,list:[]},stateLoadingSensor:!1,stateLoadingUpdate:!1}),getters:{filter:e=>e.stateFilter,errors:e=>e.stateErrors,isError:e=>e.stateIsError,filterLoading:e=>e.stateFilterLoading,siteOption:e=>e.stateSiteOption,modelOption:e=>e.stateModelOption,equipmentOption:e=>e.stateEquipmentOption,componentOption:e=>e.stateComponentOption,rerenderSensorList:e=>e.stateRerenderSensorList,sensorDataList:e=>e.stateSensorPaginate.list,sensorDataLastPage:e=>e.stateSensorPaginate.lastPage,sensorDataCurrentPage:e=>e.stateSensorPaginate.page,loadingSensor:e=>e.stateLoadingSensor,isSensorSelectAll:e=>e.stateIsSensorSelectAll,loadingUpdate:e=>e.stateLoadingUpdate},actions:{setFilterSite(e){this.stateFilter.site=e},setFilterModel(e){this.stateFilter.model=e},setFilterEquipment(e){this.stateFilter.equipment=e},setFilterComponent(e){this.stateFilter.component=e},setLoadingSensor(e){this.stateLoadingSensor=e},async getSiteLookup(){this.stateFilterLoading.site=!0;const e={ver:"v1"};try{const s=await ne.get(kt,"",new URLSearchParams(e).toString());this.stateSiteOption=Ct(s.data.result.content.site.siteDescription)}catch(s){fe("IRONS",s),console.log(s)}this.stateFilterLoading.site=!1},async getModelLookup(){this.stateFilterLoading.model=!0;const e={ver:"v1",site:this.stateFilter.site};try{const s=await ne.get(kt,"",new URLSearchParams(e).toString());this.stateModelOption=Ct(s.data.result.content.model.equipmentModel)}catch(s){fe("IRONS",s),console.log(s)}this.stateFilterLoading.model=!1},async getEquipmentLookup(){this.stateFilterLoading.equipment=!0;const e={ver:"v1",site:this.stateFilter.site,model:this.stateFilter.model};try{const s=await ne.get(kt,"",new URLSearchParams(e).toString());this.stateEquipmentOption=Ct(s.data.result.content.equipment.equipmentNumber)}catch(s){fe("IRONS",s),console.log(s)}this.stateFilterLoading.equipment=!1},async getComponentLookup(){this.stateFilterLoading.component=!0;const e={ver:"v1",site:this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment};try{const s=await ne.get(kt,"",new URLSearchParams(e).toString());this.stateComponentOption=Ct(s.data.result.content.component.componentDescription)}catch(s){fe("IRONS",s),console.log(s)}this.stateFilterLoading.component=!1},async getSensorDataListPaginate(e=void 0){if(!e)this.stateSensorPaginate.page=0;else{if(e=="prev"&&this.stateSensorPaginate.page==1)return;if(e=="next"&&this.stateSensorPaginate.lastPage!=-1&&this.stateSensorDataTotal!=-1&&this.stateSensorPaginate.page==this.stateSensorPaginate.lastPage){console.warn("[summary intervention state]: nextpage is unavailable");return}}return e=="prev"?this.stateSensorPaginate.page--:this.stateSensorPaginate.page++,this.stateRerenderSensorList=!1,this.getSensorDataList({page:this.stateSensorPaginate.page,pagesize:this.stateSensorPaginate.pagesize}).then(s=>{console.log("[sensor-data]:",this.stateSensorPaginate.page,s);let a=s;return!this.stateIsSensorSelectAll&&this.stateSensorPaginate.list.length!=0&&(a=s.map(o=>{const r=o;return r.isCheck=!1,r})),e=="next"?this.stateSensorPaginate.list.push(...a):this.stateSensorPaginate.list.unshift(...a),this.stateSensorPaginate.lastPage=Math.ceil(this.stateSensorDataTotal/this.stateSensorPaginate.pagesize)||-1,s}).finally(()=>{this.stateRerenderSensorList=!0})},async getSensorDataList(e){this.stateLoadingSensor=!0;const s={ver:"v1"},a={site:(e==null?void 0:e.site)||this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment,component:this.stateFilter.component,page:String((e==null?void 0:e.page)||1),pagesize:String((e==null?void 0:e.pagesize)||100)};return ne.post(`${Ja}?${new URLSearchParams(s).toString()}`,a).then(o=>{const r=o.data.result.content;return this.stateSensorDataTotal=o.data.result.total,r}).catch(o=>(fe("IRONS",o),console.error(o),Promise.reject(o))).finally(()=>{this.stateLoadingSensor=!1})},setReRenderSensorSelection(e){this.stateRerenderSensorList=e},updateSensorDataList(e){this.stateSensorPaginate.list.forEach(s=>{const a=e.findIndex(o=>o.sensorId==s.sensorId);s.isCheck=a!=-1})},async updateIntervention(e){this.stateLoadingUpdate=!0;try{const s={userAccount:e,ver:"v1"},a={site:this.stateFilter.site,model:this.stateFilter.model,equipment:this.stateFilter.equipment,component:this.stateFilter.component,sensor:this.generatePayloadSensor(),isCheckAllSensor:this.isSensorSelectAll},o=await ne.post(`${za}?${new URLSearchParams(s).toString()}`,a);o.data.title==="Error"?(this.stateErrors.push(o.data.result.message),this.stateIsError=!0):(this.stateErrors=[],this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&ye().setLoggedIn(!1),fe("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}this.stateLoadingUpdate=!1},generatePayloadSensor(){let e;return this.stateIsSensorSelectAll?e=this.stateSensorPaginate.list.filter(s=>s.isCheck==!1):e=this.stateSensorPaginate.list.filter(s=>s.isCheck==!0),e.map(s=>s.sensorId)},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setParam(e){this.stateFilter.site=e.site,this.stateFilter.model=e.model,this.stateFilter.equipment=e.equipment,this.stateFilter.component=e.component},setIsSensorSelectAll(e){this.stateIsSensorSelectAll=e},resetParam(){this.stateFilter={...Ut}},resetList(){this.stateRerenderSensorList=!1,this.stateSensorPaginate={page:1,pagesize:20,list:[],lastPage:-1},this.stateRerenderSensorList=!0},resetErrors(){this.stateErrors=[],this.stateIsError=!1}}}),Wa={class:"table table-bordered"},Ya=t("caption",null,null,-1),Qa=t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"No"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Measurement Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating")])],-1),Za={scope:"row",class:"ps-3 align-middle"},es={scope:"row",class:"align-middle"},ts={scope:"row",class:"align-middle"},as={scope:"row",class:"align-middle"},ss={scope:"row",class:"align-middle"},os={class:"input-eform-status"},rs={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},is=le({__name:"CurrentConditionAutTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=dt({...s.itemService}),{measurement:o,rating:r}=mt(a);return qe(()=>s.itemService,i=>{Object.assign(a,i)},{deep:!0}),(i,l)=>{const n=X("el-input"),m=Ee("loading");return se((c(),h("table",Wa,[Ya,Qa,t("tbody",null,[t("tr",null,[t("th",Za,p(e.itemService.number),1),t("th",es,p(e.itemService.text),1),t("th",ts,[f(n,{modelValue:K(o),"onUpdate:modelValue":l[0]||(l[0]=g=>Pe(o)?o.value=g:null),placeholder:"Measurement Value",readonly:""},null,8,["modelValue"])]),t("th",as,p(e.itemService.uom),1),t("th",ss,[t("div",os,[f(n,{modelValue:K(r),"onUpdate:modelValue":l[1]||(l[1]=g=>Pe(r)?r.value=g:null),class:pe(`pe-3 ${e.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),t("tr",null,[t("td",rs,p(e.itemService.timestamp.name)+", "+p(e.itemService.timestamp.date),1)])])])),[[m,e.loading]])}}}),ns={class:"table table-bordered"},ls=t("caption",null,null,-1),us=t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"No"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Measurement Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating")])],-1),cs={scope:"row",class:"ps-3 align-middle"},ds={scope:"row",class:"align-middle"},ms={scope:"row",class:"align-middle"},ps={scope:"row",class:"align-middle"},hs={scope:"row",class:"align-middle"},gs={class:"input-eform-status"},vs={class:"timestamp-task text-end m-auto px-3 pt-0 pb-0",colspan:"9"},fs=t("th",{scope:"row",class:"ps-3 align-middle"},null,-1),ys={scope:"row",class:"align-middle"},bs={scope:"row",class:"align-middle"},_s={scope:"row",class:"align-middle"},Cs={scope:"row",class:"align-middle"},Ss={class:"input-eform-status"},ks=le({__name:"CurrentConditionCaliperTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=dt({...s.itemService}),{measurement:o,rating:r,previousRating:i}=mt(a);qe(()=>s.itemService,n=>{Object.assign(a,n)},{deep:!0});const l=S(()=>s.itemService.text?s.itemService.text.includes("Disc")?"Disc":"Lining":"");return(n,m)=>{const g=X("el-input"),w=Ee("loading");return se((c(),h("table",ns,[ls,us,t("tbody",null,[t("tr",null,[t("th",cs,p(e.itemService.number),1),t("th",ds,p(e.itemService.text),1),t("th",ms,[f(g,{modelValue:K(o),"onUpdate:modelValue":m[0]||(m[0]=V=>Pe(o)?o.value=V:null),placeholder:"Measurement Value",readonly:""},null,8,["modelValue"])]),t("th",ps,p(e.itemService.uom),1),t("th",hs,[t("div",gs,[f(g,{modelValue:K(r),"onUpdate:modelValue":m[1]||(m[1]=V=>Pe(r)?r.value=V:null),class:pe(`pe-3 ${e.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),t("tr",null,[t("td",vs,p(e.itemService.timestamp.name)+", "+p(e.itemService.timestamp.date),1)]),t("tr",null,[fs,t("th",ys," Previous "+p(l.value),1),t("th",bs,p(e.itemService.previousMeasurement),1),t("th",_s,p(e.itemService.uom),1),t("th",Cs,[t("div",Ss,[f(g,{modelValue:K(i),"onUpdate:modelValue":m[2]||(m[2]=V=>Pe(i)?i.value=V:null),class:pe(`pe-3 ${e.itemService.previousColor}`),disabled:""},null,8,["modelValue","class"])])])])])])),[[w,e.loading]])}}}),gt=e=>(Le("data-v-36c50414"),e=e(),xe(),e),Is={class:"table table-bordered"},ws=gt(()=>t("caption",null,null,-1)),Es=gt(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"No"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Previous Value"),t("th",{scope:"col",class:"table-header"},"Current Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating")])],-1)),Ds={scope:"row",class:"ps-3 align-middle"},As={scope:"row",class:"align-middle"},Ms={scope:"row",class:"align-middle"},Ps={scope:"row",class:"align-middle"},Rs={scope:"row",class:"align-middle"},Os={scope:"row",class:"align-middle"},Ts={class:"input-eform-status"},Vs={class:"timestamp-task text-end m-auto pe-3 pt-0 pb-3",colspan:"9"},$s={key:0},Ns=gt(()=>t("th",{scope:"row"},null,-1)),Ls=gt(()=>t("th",{scope:"row",class:"align-middle"},"Replacement",-1)),xs=gt(()=>t("th",{scope:"row"},null,-1)),Us={scope:"row",class:"align-middle"},js={scope:"row",class:"align-middle"},Bs={scope:"row",class:"align-middle"},Fs={class:"input-eform-status"},qs={key:1},Ks={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},Gs=le({__name:"CurrentConditionAutRepTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=dt({...s.itemService}),{measurement:o,rating:r,previousMeasurement:i,replacementMeasurement:l,replacementRating:n}=mt(a);return qe(()=>s.itemService,m=>{Object.assign(a,m)},{deep:!0}),(m,g)=>{const w=X("el-input"),V=Ee("loading");return se((c(),h("table",Is,[ws,Es,t("tbody",null,[t("tr",null,[t("th",Ds,p(e.itemService.number),1),t("th",As,p(e.itemService.text),1),t("th",Ms,[f(w,{modelValue:K(i),"onUpdate:modelValue":g[0]||(g[0]=P=>Pe(i)?i.value=P:null),placeholder:"Previous Value",class:"input-previous_value",readonly:""},null,8,["modelValue"])]),t("th",Ps,[f(w,{modelValue:K(o),"onUpdate:modelValue":g[1]||(g[1]=P=>Pe(o)?o.value=P:null),placeholder:"Current Value",class:"input-current_value",readonly:""},null,8,["modelValue"])]),t("th",Rs,p(e.itemService.uom),1),t("th",Os,[t("div",Ts,[f(w,{modelValue:K(r),"onUpdate:modelValue":g[2]||(g[2]=P=>Pe(r)?r.value=P:null),class:pe(`pe-3 ${e.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),t("tr",null,[t("td",Vs,p(e.itemService.timestamp.name)+", "+p(e.itemService.timestamp.date),1)]),e.itemService.isReplacementAdjustment?(c(),h("tr",$s,[Ns,Ls,xs,t("th",Us,[f(w,{modelValue:K(l),"onUpdate:modelValue":g[3]||(g[3]=P=>Pe(l)?l.value=P:null),placeholder:"Current Value",class:"input-current_value",readonly:""},null,8,["modelValue"])]),t("th",js,p(e.itemService.uom),1),t("th",Bs,[t("div",Fs,[f(w,{modelValue:K(n),"onUpdate:modelValue":g[4]||(g[4]=P=>Pe(n)?n.value=P:null),class:pe(`pe-3 ${e.itemService.colorReplacementRating}`),disabled:""},null,8,["modelValue","class"])])])])):W("",!0),e.itemService.isReplacementAdjustment?(c(),h("tr",qs,[t("td",Ks,p(e.itemService.replacementTimestamp.name)+", "+p(e.itemService.replacementTimestamp.date),1)])):W("",!0)])])),[[V,s.loading]])}}}),Hs=Ve(Gs,[["__scopeId","data-v-36c50414"]]),Js={class:"table table-bordered"},zs=t("caption",null,null,-1),Xs=t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",style:{width:"5%"},class:"table-header ps-3"},"No"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Measurement Location"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Tool"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"A"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"B"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Piston Movement (B-A)"),t("th",{scope:"col",style:{width:"5%"},class:"table-header"},"UoM"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Percent Worn"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Rating")])],-1),Ws={scope:"row",class:"ps-3 align-middle"},Ys={scope:"row",class:"align-middle"},Qs={scope:"row",class:"align-middle"},Zs={scope:"row",class:"align-middle"},eo={scope:"row",class:"align-middle"},to={scope:"row",class:"align-middle"},ao={scope:"row",class:"align-middle"},so={scope:"row",class:"align-middle"},oo={scope:"row",class:"align-middle"},ro={class:"input-eform-status"},io={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},no=le({__name:"CurrentConditionOilCooledTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=dt({...s.itemService}),{measurement:o,rating:r}=mt(a);qe(()=>s.itemService,n=>{Object.assign(a,n)},{deep:!0});const i=S(()=>s.itemService.tool=="BIRRANA"?"Birrana Gauge":"CAT Gauge"),l=S(()=>parseFloat(s.itemService.pistonPercentageValue)*100);return(n,m)=>{const g=X("el-option"),w=X("el-select"),V=X("el-input"),P=Ee("loading");return se((c(),h("table",Js,[zs,Xs,t("tbody",null,[t("tr",null,[t("th",Ws,p(e.itemService.number),1),t("th",Ys,p(e.itemService.text),1),t("th",Qs,[f(w,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=x=>i.value=x),readonly:""},{default:Q(()=>[f(g,{value:"BIRRANA"},{default:Q(()=>[_e("Birrana Gauge")]),_:1}),f(g,{value:"CAT_GAUGE"},{default:Q(()=>[_e("CAT Gauge")]),_:1})]),_:1},8,["modelValue"])]),t("th",Zs,[f(V,{modelValue:e.itemService.pistonAValue,"onUpdate:modelValue":m[1]||(m[1]=x=>e.itemService.pistonAValue=x),readonly:""},null,8,["modelValue"])]),t("th",eo,[f(V,{modelValue:e.itemService.pistonBValue,"onUpdate:modelValue":m[2]||(m[2]=x=>e.itemService.pistonBValue=x),readonly:""},null,8,["modelValue"])]),t("th",to,[f(V,{modelValue:e.itemService.pistonResultValue,"onUpdate:modelValue":m[3]||(m[3]=x=>e.itemService.pistonResultValue=x),readonly:""},null,8,["modelValue"])]),t("th",ao,p(e.itemService.uom),1),t("th",so,p(l.value)+"% ",1),t("th",oo,[t("div",ro,[f(V,{modelValue:K(r),"onUpdate:modelValue":m[4]||(m[4]=x=>Pe(r)?r.value=x:null),class:pe(`pe-3 ${e.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),t("tr",null,[t("td",io,p(e.itemService.timestamp.name)+", "+p(e.itemService.timestamp.date),1)])])])),[[P,e.loading]])}}}),Ge="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api",Qt="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api",lo=`${Ge}/service_sheet_detail/get_data_detail_cbm`,uo=`${Ge}/interim_engine_detail/get_data_detail_cbm`,co=`${Ge}/intervention/get_intervention_revise`,jt=`${Ge}/service_sheet_detail/update_task_revise`,mo=`${Ge}/interim_engine_detail/update_task_revise`,po=`${Qt}/intervention_header/update_task_revise`,ho=`${Ge}/service_sheet_detail/update_task_with_defect_revise`,go=`${Qt}/intervention_header/update_task_with_defect_revise`,vo=`${Ge}/interim_engine_detail/update_task_with_defect_revise`,fo=`${Ge}/attachment/download_by_url`,Bt="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/history_cbm_change/cbm_change",Ft={workOrder:"",taskKey:"",component:"",ver:"v1"},yo={model:"",psType:"",ver:"v1"},qt={measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}},bo={pistonA:{errorMessage:"",isShowError:!1},pistonB:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}},Mt=[{measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}}],et=Tt({id:"overwriteCbm",state:()=>({stateParamGetDetailCbm:Ft,stateParamGetMappingCbm:yo,stateDetailCbm:{},stateIsError:!1,stateError:"",stateModifiedObjectAvg:{},stateModifiedObjectAut:{taskNo:"",measurementLocation:"",uom:"",measurementValue:"",measurementRating:"",images:""},stateModifiedObjectMan:{taskNo:"",measurementLocation:"",uom:"",measurementRating:"",images:""},stateModifiedObjectOilCooled:{taskNo:"",measurementLocation:"",tool:"",pistonMovementA:"",pistonMovementB:"",pistonMovementResult:"",uom:"",pistonMovementRating:"",rating:"",images:""},stateCbmType:"",stateErrors:[],stateLoading:!1,stateIsUserCanRevise:!1,stateItemKey:{camera:"",rating:"",measurement:""},stateItemKeyAvg:[],stateItemKeyOilCooled:{},stateEmployeeData:{id:"",name:""},stateInputErrorList:[...Mt],stateInputError:{...qt},stateInputErrorOilCooled:{...bo},stateCbmTypeAutomatic:["AUTOMATIC","AUTOMATIC_PREVIOUS","DROPDOWN_TOOL","BIRANA"],stateCbmTypeManual:["MANUAL","NORMAL"]}),getters:{detailCbm:e=>e.stateDetailCbm,cbmType:e=>e.stateCbmType,cbmTypeAutomatic:e=>e.stateCbmTypeAutomatic,cbmTypeManual:e=>e.stateCbmTypeManual,modifiedObjectAvg:e=>e.stateModifiedObjectAvg,modifiedObjAut:e=>e.stateModifiedObjectAut,modifiedObjMan:e=>e.stateModifiedObjectMan,modifiedObjOilCooled:e=>e.stateModifiedObjectOilCooled,loading:e=>e.stateLoading,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,inputErrorList:e=>e.stateInputErrorList,inputError:e=>e.stateInputError,inputErrorOilCooled:e=>e.stateInputErrorOilCooled,isUserCanRevise:e=>e.stateIsUserCanRevise,itemKey:e=>e.stateItemKey,itemKeyOilCooled:e=>e.stateItemKeyOilCooled,isReplacementAdjustment:e=>e.stateDetailCbm.isReplacementAdjustment?e.stateDetailCbm.isReplacementAdjustment:!1},actions:{setCbmType(e="serviceSheet"){const s=this.stateDetailCbm.historyModifiedDefault[this.stateDetailCbm.historyModifiedDefault.length-1];if(s.rating=="AUTOMATIC"){const a=s.items.find(o=>o.categoryItemType=="resultParamRating");this.stateCbmType=a?"AVERAGE":"AUTOMATIC";return}e=="intervention"&&(s.rating=="AUTOMATIC_REPLACEMENT"||s.rating=="AUTOMATIC_REPLACEMENT_GAP")?this.stateCbmType="AUTOMATIC":this.stateCbmType=s.rating},setAverageForms(){this.stateInputErrorList=[],this.stateModifiedObjectAvg.value=[];for(let e=0;e<this.stateDetailCbm.historyModifiedDefault.length;e++)this.stateModifiedObjectAvg.value.push({measurementValue:"",measurementRating:"",uom:this.stateDetailCbm.currentCondition.uom,images:[]}),this.stateInputErrorList.push({measurementValue:{errorMessage:"",isShowError:!1},measurementRating:{errorMessage:"",isShowError:!1},camera:{errorMessage:"",isShowError:!1}})},setModifiedObject(e){this.cbmType=="AUTOMATIC"||this.cbmType.includes("PREVIOUS")||this.cbmType=="CALIPER"?this.stateModifiedObjectAut={taskNo:e.value.currentCondition.taskNo,measurementLocation:e.value.currentCondition.measurementLocation,uom:e.value.currentCondition.uom,measurementValue:"",measurementRating:"",images:""}:this.cbmType=="NORMAL"||this.cbmType=="MANUAL"?this.stateModifiedObjectMan={taskNo:e.value.currentCondition.taskNo,measurementLocation:e.value.currentCondition.measurementLocation,uom:e.value.currentCondition.uom,measurementRating:"",images:""}:this.cbmType=="AVERAGE"?this.setAverageForms():this.cbmType=="AUTOMATIC_REPLACEMENT"||this.cbmType=="AUTOMATIC_REPLACEMENT_GAP"?this.stateModifiedObjectAut={taskNo:e.value.currentCondition.taskNo,measurementLocation:e.value.currentCondition.measurementLocation,uom:e.value.currentCondition.uom,measurementValue:"",measurementRating:"",images:""}:this.cbmType=="OIL_COOLED"&&(this.stateModifiedObjectOilCooled={taskNo:e.value.currentCondition.taskNo,measurementLocation:e.value.currentCondition.measurementLocation,tool:e.value.currentCondition.pistonTool,pistonMovementA:"",pistonMovementB:"",pistonMovementResult:"",uom:e.value.currentCondition.pistonUom,pistonMovementRating:"",rating:"",images:""})},setIsUserCanRevise(e){this.stateIsUserCanRevise=e},async getDetailCbm(){const e={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{this.stateLoading=!0;const s=await ne.post(`${lo}?ver=v1`,e);this.stateDetailCbm=s.data.result.content,this.setCbmType(),this.stateCbmType=="AVERAGE"&&this.setAverageForms()}catch(s){console.log(s),fe("IRONS",s)}finally{this.stateLoading=!1}},async getDetailIntervention(){this.stateLoading=!0;const e={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{const s=await ne.post(`${co}?ver=v1`,e);this.stateDetailCbm=s.data.result.content,this.setCbmType("intervention")}catch(s){console.log(s)}finally{this.stateLoading=!1}},async getDetailCbmInterim(){const e={taskKey:this.stateParamGetDetailCbm.taskKey,workOrder:this.stateParamGetDetailCbm.workOrder,component:this.stateParamGetDetailCbm.component};try{this.stateLoading=!0;const s=await ne.post(`${uo}?ver=v1`,e);this.stateDetailCbm=s.data.result.content,this.setCbmType()}catch(s){console.log(s),fe("IRONS",s)}finally{this.stateLoading=!1}},async getImage(e){if(!e)return null;const s={fileUrl:`${e.filename}`,ver:"v1"};try{const a=`${fo}?${new URLSearchParams(s).toString()}`,r=(await ne.getBlob(a)).data,i=new Blob([r]),n=(window.URL||window.webkitURL).createObjectURL(i);return{key:e.filename,value:n,blob:i}}catch(a){return console.log("image",a),null}},defineItemKey(e="serviceSheet"){if((this.stateCbmType=="AUTOMATIC_REPLACEMENT"||this.stateCbmType=="AUTOMATIC_REPLACEMENT_GAP")&&e=="serviceSheet"){if(this.stateItemKey.camera=this.stateDetailCbm.replacementPhoto[0].items[2].key,this.isReplacementAdjustment){this.stateItemKey.measurement=this.stateDetailCbm.historyModifiedDefault[0].items[0].key,this.stateItemKey.rating=this.stateDetailCbm.historyModifiedDefault[0].items[0].key;return}this.stateItemKey.measurement=this.stateDetailCbm.beforeReplacementItems[4].key,this.stateItemKey.rating=this.stateDetailCbm.beforeReplacementItems[6].key;return}for(const s in this.stateDetailCbm.historyModifiedDefault[0].items)if(Object.hasOwnProperty.call(this.stateDetailCbm.historyModifiedDefault[0].items,s)){const a=this.stateDetailCbm.historyModifiedDefault[0].items[s];this.cbmType=="MANUAL"||this.cbmType=="NORMAL"&&a.categoryItemType=="resultRating"?this.stateItemKey.rating=a.key:a.itemType=="smallCamera"?this.stateItemKey.camera=a.key:a.categoryItemType=="paramRating"||a.categoryItemType=="paramRatingDynamic"?this.stateItemKey.measurement=a.key:a.categoryItemType=="targetRating"||a.itemType=="dropDown"&&a.categoryItemType!="resultStatus"?this.stateItemKey.rating=a.key:a.description=="Adjustment"&&(this.stateItemKey.rating=a.key,this.stateItemKey.measurement=a.key,this.stateItemKey.camera=a.key)}},defineItemMan(){for(const e in this.stateDetailCbm.historyModifiedDefault[0].items)if(Object.hasOwnProperty.call(this.stateDetailCbm.historyModifiedDefault[0].items,e)){const s=this.stateDetailCbm.historyModifiedDefault[0].items[e];s.itemType=="smallCamera"?this.stateItemKey.camera=s.key:s.itemType=="dropDown"&&(s!=null&&s.isTaskValue)&&s.categoryItemType!="resultStatus"&&(this.stateItemKey.rating=s.key)}},defineItemKeyAvg(){this.stateDetailCbm.historyModifiedDefault.forEach(e=>{const s={};for(const a in e.items)if(Object.hasOwnProperty.call(e.items,a)){const o=e.items[a];o.categoryItemType=="resultParamRating"?s.value=o.key:o.itemType=="smallCamera"?s.camera=o.key:o.itemType=="paramRating"?s.rating=o.key:o.category=="cbmCalculateAvg"?s.value=o.key:(o.categoryItemType=="targetRating"||o.itemType=="dropDown"&&o.categoryItemType!="resultStatus")&&(s.rating=o.key)}this.stateItemKeyAvg.push(s)})},defineItemKeyOilCooled(){this.stateDetailCbm.historyModifiedDefault.forEach(e=>{for(const s in e.items)if(Object.hasOwnProperty.call(e.items,s)){const a=e.items[s];a.categoryItemType=="pistonMovementA"?this.stateItemKeyOilCooled.pistonMovementA=a.key:a.categoryItemType=="pistonMovementB"?this.stateItemKeyOilCooled.pistonMovementB=a.key:a.categoryItemType=="pistonMovementResult"?this.stateItemKeyOilCooled.pistonMovementResult=a.key:a.categoryItemType=="targetTool"?this.stateItemKeyOilCooled.uom=a.key:a.categoryItemType=="pistonMovementRating"?this.stateItemKeyOilCooled.pistonMovementRating=a.key:a.categoryItemType=="targetRating"?this.stateItemKeyOilCooled.rating=a.key:a.itemType=="smallCamera"&&(this.stateItemKeyOilCooled.camera=a.key)}})},getUrlApiUpdate(e){switch(e){case"interim":return mo;case"intervention":return po;default:return jt}},getUrlApiDefectUpdate(e){switch(e){case"interim":return vo;case"intervention":return go;default:return ho}},getBeforeValue(e){const s=e.find(n=>n.categoryItemType=="targetRating");let a="";s&&(a=s.value);const o=e.find(n=>n.categoryItemType=="targetTool");let r="";if(o)r=o.value;else if(!o){const n=e.findIndex(m=>m.categoryItemType=="paramRating"||m.categoryItemType=="paramRatingDynamic");r=e[n+1].value}const i=e.find(n=>n.categoryItemType=="paramRating"||n.categoryItemType=="paramRatingDynamic");let l="";return i&&(l=i.value),{rating:a,measurement:l,uom:r}},async postDefectHistory(e,s,a,o="serviceSheet",r=!1){const i=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",l=this.stateDetailCbm.beforeAdjustmentItems,n=this.stateDetailCbm.beforeReplacementItems,m={updateParams:[{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:e}]}],headerId:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,id:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,employee:this.stateEmployeeData,defectHeader:{workorder:this.stateDetailCbm.workOrder,form:this.stateDetailCbm.form,category:"CBM",taskId:this.stateDetailCbm.taskKey,taskNo:a,taskDesc:this.stateDetailCbm.currentCondition.measurementLocation,defectWorkorder:"",formDefect:"",defectType:"",cbmMeasurement:s||"",cbmUom:s?this.stateDetailCbm.currentCondition.uom:"",cbmImageKey:this.itemKey.camera,cbmImageProp:o=="intervention"?"images":"value",isCbmAdjusment:i?"true":"false",taskValue:e,repairedStatus:"Not-Repaired",cbmNAStatus:"Not-Confirm",supervisor:this.stateEmployeeData,status:"Submit"}};l&&(m.defectHeader.correctedValue=e,m.defectHeader.correctedMeasurement=s||"",m.defectHeader.correctedUom=s?this.stateDetailCbm.currentCondition.uom:"",m.defectHeader.taskValue=this.getBeforeValue(l).rating,m.defectHeader.cbmMeasurement=this.getBeforeValue(l).measurement,m.defectHeader.cbmUom=this.getBeforeValue(l).uom),n&&(m.defectHeader.correctedValue=e,m.defectHeader.correctedMeasurement=s||"",m.defectHeader.correctedUom=s?this.stateDetailCbm.currentCondition.uom:"",m.defectHeader.taskValue=this.getBeforeValue(n).rating,m.defectHeader.cbmMeasurement=this.getBeforeValue(n).measurement,m.defectHeader.cbmUom=this.getBeforeValue(n).uom),o=="intervention"?(m.defectHeader.interventionHeaderId=this.stateDetailCbm.interventionHeaderId,m.defectHeader.interventionId=this.stateDetailCbm.id):m.defectHeader.serviceSheetDetailId=this.stateDetailCbm.serviceSheetDetailId,r&&(m.defectHeader.cbmUom=this.stateModifiedObjectOilCooled.uom,m.defectHeader.pistonUom=this.stateModifiedObjectOilCooled.uom,m.defectHeader.cbmPistonA=this.stateModifiedObjectOilCooled.pistonMovementA,m.defectHeader.cbmPistonB=this.stateModifiedObjectOilCooled.pistonMovementB,m.defectHeader.cbmPistonResult=this.stateModifiedObjectOilCooled.pistonMovementResult,m.defectHeader.cbmPistonTool=this.getPistonToolLabel(this.stateModifiedObjectOilCooled.tool));try{const g={ver:"v1"},w=await ne.post(`${this.getUrlApiDefectUpdate(o)}?${new URLSearchParams(g).toString()}`,m);w.data.title==="Error"?(this.stateErrors.push(w.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(g){g.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=g,console.log(g),fe("IRONS",g),this.stateErrors.push(g.response.data.result.message),this.stateIsError=!0}},getPistonToolLabel(e){const s=this.stateDetailCbm.historyModifiedDefault[0].items.find(a=>a.categoryItemType=="dropdownTool");if(s){let a=[];const o=s.caption.replace("[","").replace("]","").split("; "),r=s.itemValue.replace("[","").replace("]","").split(", ");a=o.map((l,n)=>({label:l.replaceAll("'",""),value:r[n].replaceAll("'","")})),a.forEach(l=>{l.value==s.value&&l.label});const i=a.find(l=>l.value==e);return i==null?void 0:i.label}return""},async updateTaskReviseManual(e,s,a,o){this.defineItemMan(),(this.modifiedObjMan.measurementRating=="X"||this.modifiedObjMan.measurementRating=="C")&&this.postDefectHistory(this.modifiedObjMan.measurementRating,null,this.modifiedObjMan.taskNo,o);const i={headerId:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.rating,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjMan.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};o=="intervention"&&(i.component=e),this.modifiedObjMan.images.length!=0&&(i.isUpdatePhoto=!0,i.updateParams.push({keyValue:o=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:o=="intervention"?"images":"value",propertyValue:JSON.stringify(this.modifiedObjMan.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})),(this.modifiedObjMan.measurementRating=="A"||this.modifiedObjMan.measurementRating=="B")&&i.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjMan.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]});const l={measurementRating:this.modifiedObjMan.measurementRating,measurementValue:null};try{this.stateLoading=!0;const n={ver:"v1"},m=await ne.post(`${this.getUrlApiUpdate(o)}?${new URLSearchParams(n).toString()}`,i);return m.data.title==="Error"?(this.stateErrors.push(m.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(l,e,new Date(s),a),m}catch(n){n.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=n,fe("IRONS",n),console.log(n),this.stateErrors.push(n.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAutomatic(e,s,a,o="serviceSheet"){var x;this.defineItemKey();const r=this.modifiedObjAut.measurementRating=="X"||this.modifiedObjAut.measurementRating=="C",i=(x=this.stateDetailCbm)==null?void 0:x.historyModifiedDefault[0].description;if(!i)throw Error("Object is incorrect, invalid description");const[l,n,m]=i.split(";"),g=l+";"+n;r&&this.postDefectHistory(this.modifiedObjAut.measurementRating,this.modifiedObjAut.measurementValue,g,o);const w=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",V={headerId:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.rating,propertyParams:[{propertyName:w?"rating":"value",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};w||V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),o=="intervention"&&(V.component=e),this.itemKey.measurement!==""&&V.updateParams.push({keyValue:this.itemKey.measurement,propertyParams:[{propertyName:w?"measurement":"value",propertyValue:this.modifiedObjAut.measurementValue},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),(this.modifiedObjAut.measurementRating=="A"||this.modifiedObjAut.measurementRating=="B")&&V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjAut.images.length!=0&&(V.isUpdatePhoto=!0,V.updateParams.push({keyValue:o=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:o=="intervention"?"images":w?"pictures":"value",propertyValue:JSON.stringify(this.modifiedObjAut.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const P={measurementRating:this.modifiedObjAut.measurementRating,measurementValue:this.modifiedObjAut.measurementValue};try{this.stateLoading=!0;const k={ver:"v1"};console.log("payload",V);const O=await ne.post(`${this.getUrlApiUpdate(o)}?${new URLSearchParams(k).toString()}`,V);return O.data.title==="Error"?(this.stateErrors.push(O.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(P,e,new Date(s),a),O}catch(k){k.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=k,fe("IRONS",k),console.log(k),this.stateErrors.push(k.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAutomaticReplacementAndGap(e,s,a,o="serviceSheet"){var P;this.defineItemKey(o);const r=this.modifiedObjAut.measurementRating=="X"||this.modifiedObjAut.measurementRating=="C",i=(P=this.stateDetailCbm)==null?void 0:P.historyModifiedDefault[0].description;if(!i)throw Error("Object is incorrect, invalid description");const[l,n,m]=i.split(";"),g=l+";"+n;r&&this.postDefectHistory(this.modifiedObjAut.measurementRating,this.modifiedObjAut.measurementValue,g,o);const w={headerId:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKey.measurement,propertyParams:[{propertyName:this.isReplacementAdjustment?"measurement":"value",propertyValue:this.modifiedObjAut.measurementValue},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKey.rating,propertyParams:[{propertyName:this.isReplacementAdjustment?"rating":"value",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};(this.modifiedObjAut.measurementRating=="A"||this.modifiedObjAut.measurementRating=="B")&&w.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjAut.measurementRating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),(this.modifiedObjAut.measurementRating=="C"||this.modifiedObjAut.measurementRating=="X")&&w.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjAut.images.length>0&&(w.isUpdatePhoto=!0,w.updateParams.push({keyValue:o=="intervention"?this.stateDetailCbm.taskKey:this.itemKey.camera,propertyParams:[{propertyName:o=="intervention"?"images":"value",propertyValue:JSON.stringify(this.modifiedObjAut.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})),o=="intervention"&&(w.component=e);const V={measurementRating:this.modifiedObjAut.measurementRating,measurementValue:this.modifiedObjAut.measurementValue};try{this.stateLoading=!0;const x={ver:"v1"};console.log("payload",w);const k=await ne.post(`${this.getUrlApiUpdate(o)}?${new URLSearchParams(x).toString()}`,w);return k.data.title==="Error"?(this.stateErrors.push(k.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBM(V,e,new Date(s),a),k}catch(x){x.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=x,fe("IRONS",x),console.log(x),this.stateErrors.push(x.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async updateTaskReviseAverage(){this.stateLoading=!0,this.defineItemKeyAvg();const e=[];this.modifiedObjectAvg.value.forEach((s,a)=>{e.push(new Promise(o=>{this.avgReviseSingle(s,a).then(o)}))}),this.stateItemKeyAvg=[],await Promise.allSettled(e).then(s=>{const o=s.map(r=>{if(r.status==="fulfilled")return r.value}).find(r=>r.data.title==="Error");o&&(this.stateErrors.push(o.data.result.message),this.stateIsError=!0)}).finally(()=>{this.stateLoading=!1})},async updateTaskReviseOilCooled(e,s,a,o="serviceSheet"){var x;this.defineItemKeyOilCooled();const r=this.modifiedObjOilCooled.rating=="X"||this.modifiedObjOilCooled.rating=="C",i=(x=this.stateDetailCbm)==null?void 0:x.historyModifiedDefault[0].description;if(!i)throw Error("Object is incorrect, invalid description");const[l,n,m]=i.split(";"),g=l+";"+n;r&&this.postDefectHistory(this.modifiedObjOilCooled.rating,Number(this.modifiedObjOilCooled.pistonMovementRating)/100,g,o,!0);const w=this.stateDetailCbm.historyModifiedDefault[0].items[0].description=="Adjustment",V={headerId:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:this.stateDetailCbm.taskKey,id:o=="intervention"?this.stateDetailCbm.id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[{keyValue:this.itemKeyOilCooled.pistonMovementA,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementA},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementB,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementB},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementResult,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.pistonMovementResult},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.uom,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.uom},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.pistonMovementRating,propertyParams:[{propertyName:"value",propertyValue:Number(this.modifiedObjOilCooled.pistonMovementRating)/100},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.itemKeyOilCooled.rating,propertyParams:[{propertyName:"value",propertyValue:this.modifiedObjOilCooled.rating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},{keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}],employee:this.stateEmployeeData};(this.modifiedObjOilCooled.rating=="A"||this.modifiedObjOilCooled.rating=="B")&&V.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"taskValue",propertyValue:this.modifiedObjOilCooled.rating},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.modifiedObjOilCooled.images.length!=0&&(V.isUpdatePhoto=!0,V.updateParams.push({keyValue:o=="intervention"?this.stateDetailCbm.taskKey:this.itemKeyOilCooled.camera,propertyParams:[{propertyName:o=="intervention"?"images":w?"pictures":"value",propertyValue:JSON.stringify(this.modifiedObjOilCooled.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const P={ratingOri:this.stateDetailCbm.currentCondition.pistonRating,ratingUpdate:this.modifiedObjOilCooled.rating,valueOri:this.stateDetailCbm.currentCondition.pistonPercentageValue,valueUpdate:`${Number(this.modifiedObjOilCooled.pistonMovementRating)/100}`};try{this.stateLoading=!0;const k={ver:"v1"};console.log("payload",V);const O=await ne.post(`${this.getUrlApiUpdate(o)}?${new URLSearchParams(k).toString()}`,V);return O.data.title==="Error"?(this.stateErrors.push(O.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1),await this.changeHistoryCBMNew(P,e,new Date(s),a),O}catch(k){k.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=k,fe("IRONS",k),console.log(k),this.stateErrors.push(k.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},async avgReviseSingle(e,s){var E,A;const a=this.stateItemKeyAvg[s],o=(E=this.stateDetailCbm.historyModifiedDefault[s])==null?void 0:E.key,r=(A=this.stateDetailCbm)==null?void 0:A.historyModifiedDefault[s].description;if(!r)throw Error("Object is incorrect, invalid description");const[i,l,n]=r.split(";"),m=i+";"+l,g=e.measurementRating,w=e.measurementValue;!!g&&["C","X"].includes(g)&&await this.postDefectHistory(g,w,m).catch(()=>{throw Error("Defect history is failed to update")}),console.log("index:",s);const P={headerId:this.stateDetailCbm.headerId,workorder:this.stateDetailCbm.workOrder,taskKey:o,id:this.stateDetailCbm.serviceSheetDetailId,isUpdatePhoto:!1,updateParams:[],employee:this.stateEmployeeData};s==3&&(console.log("ok"),P.updateParams.push({keyValue:this.stateDetailCbm.taskKey,propertyParams:[{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}));const x={keyValue:a.rating,propertyParams:[{propertyName:"value",propertyValue:g},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},k={keyValue:a.value,propertyParams:[{propertyName:"value",propertyValue:w},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]},O={keyValue:a.camera,propertyParams:[{propertyName:"value",propertyValue:JSON.stringify(e.images)},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]};(g=="A"||g=="B")&&P.updateParams.push({keyValue:o,propertyParams:[{propertyName:"taskValue",propertyValue:g},{propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)},{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),e.images.length!=0&&(P.isUpdatePhoto=!0,P.updateParams.push(O)),a.value&&P.updateParams.push(k),a.rating&&P.updateParams.push(x);const B={ver:"v1"};return await ne.post(`${jt}?${new URLSearchParams(B).toString()}`,P)},async changeHistoryCBM(e,s,a,o){const r={equipment:this.stateDetailCbm.equipment,component:s,taskKey:this.stateDetailCbm.taskKey,sampleDate:a?Pt(Rt(a)):"",ratingOri:this.stateDetailCbm.currentCondition.rating,ratingUpdate:e.measurementRating,valueOri:this.stateDetailCbm.currentCondition.value||this.stateDetailCbm.currentCondition.measurementValue||null,valueUpdate:e.measurementValue||null,interventionReason:this.stateDetailCbm.currentCondition.measurementLocation,workOrder:this.stateDetailCbm.workOrder};try{const i={userAccount:o,ver:"v1"},l=await ne.post(`${Bt}?${new URLSearchParams(i).toString()}`,r);return l.data.title==="Error"&&console.log("error",l),l}catch(i){i.response.data.statusCode==401&&ye().setLoggedIn(!1),fe("IRONS",i),console.log(i)}},async changeHistoryCBMNew(e,s,a,o){const r={equipment:this.stateDetailCbm.equipment,component:s,taskKey:this.stateDetailCbm.taskKey,sampleDate:a?Pt(Rt(a)):"",ratingOri:e.ratingOri,ratingUpdate:e.ratingUpdate,valueOri:e.valueOri,valueUpdate:e.valueUpdate,interventionReason:this.stateDetailCbm.currentCondition.measurementLocation,workOrder:this.stateDetailCbm.workOrder};try{const i={userAccount:o,ver:"v1"},l=await ne.post(`${Bt}?${new URLSearchParams(i).toString()}`,r);return l.data.title==="Error"&&console.log("error",l),l}catch(i){i.response.data.statusCode==401&&ye().setLoggedIn(!1),console.log(i)}},setImagePerRowAverage(e,s){if(!this.stateModifiedObjectAvg.value[e])throw Error("never found index row");typeof this.stateModifiedObjectAvg.value[e].images=="string"&&(this.stateModifiedObjectAvg.value[e].images=[]);const o=s;this.stateModifiedObjectAvg.value[e].images=o},setImageManual(e){this.stateModifiedObjectMan.images=e},setImageAutomatic(e){this.stateModifiedObjectAut.images=e},setImageOilCooled(e){this.stateModifiedObjectOilCooled.images=e},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setInputErrorCbmAutomatic(e,s){this.stateInputError.measurementValue.errorMessage=e,this.stateInputError.measurementValue.isShowError=s},setInputErrorCbmManual(e,s){this.stateInputError.measurementRating.errorMessage=e,this.stateInputError.measurementRating.isShowError=s},setInputErrorCbmOilCooledPistonA(e,s){this.stateInputErrorOilCooled.pistonA.errorMessage=e,this.stateInputErrorOilCooled.pistonA.isShowError=s},setInputErrorCbmOilCooledPistonB(e,s){this.stateInputErrorOilCooled.pistonB.errorMessage=e,this.stateInputErrorOilCooled.pistonB.isShowError=s},initErrorInputCbmAverage(){this.stateInputErrorList=[],Array.from(this.stateDetailCbm.historyModifiedDefault).forEach(()=>{this.stateInputErrorList.push(Mt[0])})},setInputErrorCbmAverage(e,s,a){this.stateInputErrorList[e].measurementValue.errorMessage=s,this.stateInputErrorList[e].measurementValue.isShowError=a},setParamGetDetailCbm(e){this.stateParamGetDetailCbm.taskKey=e.taskKey,this.stateParamGetDetailCbm.workOrder=e.workOrder,this.stateParamGetDetailCbm.component=e.component},setAutomaticRating(e){this.stateModifiedObjectAut.measurementRating=e},setOilCooledPercentWorn(e){this.stateModifiedObjectOilCooled.pistonMovementRating=e},setOilCooledRating(e){this.stateModifiedObjectOilCooled.rating=e},setModifiedData(e,s,a){this.stateModifiedObjectAvg.value[e][s]=a},resetParamGetDetailCbm(){this.stateParamGetDetailCbm={...Ft}},resetList(){this.stateDetailCbm={},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1,this.stateIsUserCanRevise=!1},resetErrors(){this.stateErrors=[],this.stateIsError=!1,this.stateInputError={...qt},this.stateInputErrorList=[...Mt]}}}),_o={class:"input-eform-status"},Et=le({__name:"InputHistory",props:{item:{type:Object,required:!0}},setup(e){const s=e,a=Ze(s,"item"),o=S({get:()=>a.value.value,set:l=>{const n=l;a.value.value=n}}),r=S(()=>{const l=a.value.value.toString().replaceAll("'","");let n;return(a.value.categoryItemType=="targetRating"||a.value.itemType=="dropDown")&&(l=="A"?n="a":l=="B"?n="b":l=="C"?n="c":l=="X"&&(n="x")),n}),i=L();return pt(async()=>{o.value=a.value.value}),Ot(()=>{a.value={}}),qe(s.item,l=>{a.value=l},{deep:!0}),(l,n)=>{const m=X("el-input");return c(),h("div",_o,[f(m,{ref_key:"cbmInput",ref:i,class:pe(r.value),modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=g=>o.value=g),size:"small",readonly:!0,disabled:!0},null,8,["class","modelValue"])])}}}),Co={class:"input-eform-status"},Zt=le({__name:"InputHistoryAdjustment",props:{item:{type:String,required:!0}},setup(e){const s=e,a=Ze(s,"item"),o=S({get:()=>a.value,set:l=>{a.value=l}}),r=S(()=>{const l=s.item;let n;return l=="A"?n="a":l=="B"?n="b":l=="C"?n="c":l=="X"&&(n="x"),n}),i=L();return(l,n)=>{const m=X("el-input");return c(),h("div",Co,[f(m,{ref_key:"cbmInput",ref:i,class:pe([r.value]),modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=g=>o.value=g),size:"small",disabled:!0},null,8,["class","modelValue"])])}}}),So={class:"pt-2"},ko={class:"d-flex justify-content-center"},Io={class:"d-flex justify-content-center"},wo={class:"btn btn-sm btn-icon btn-bg-light",disabled:""},Eo=["src"],Do={key:0,id:"image-count",class:"d-flex justify-content-center ms-3"},vt=le({__name:"SmallCamera",props:{item:{type:Object,required:!0},isUpdatedByCurrentUser:{type:Boolean,required:!0}},emits:["showPreviewImages"],setup(e,{emit:s}){const a=e,o=s,r=Ze(a,"item"),i=S(()=>r.value?Wt(r.value):[]),l=()=>{let m="/media/svg/dma/camera/e-form/png/cam-active.png";return a.isUpdatedByCurrentUser&&i.value.length>0?m="/media/svg/dma/camera/e-form/png/cam-user.png":a.isUpdatedByCurrentUser&&i.value.length==0?m="/media/svg/dma/camera/e-form/png/cam-active.png":!a.isUpdatedByCurrentUser&&i.value.length>0?m="/media/svg/dma/camera/e-form/png/cam-read.png":m="/media/svg/dma/camera/e-form/png/cam-active.png",m},n=()=>{o("showPreviewImages",i.value)};return(m,g)=>(c(),h("div",So,[t("div",ko,[t("div",Io,[t("button",wo,[t("img",{src:l(),id:"icon-camera",style:{height:"12px",width:"14px"},alt:"camera"},null,8,Eo)])]),i.value&&i.value.length>0?(c(),h("div",Do,[t("button",{class:"btn btn-sm btn-icon btn-bg-success text-white",onClick:n,style:{"background-color":"#18AF4A"}}," +"+p(i.value.length),1)])):W("",!0)])]))}}),Ao={key:0,class:"text-center"},Mo={style:{height:"100px"}},Po={key:0},Ro={class:"row my-4"},Oo={key:0,class:"bg-secondary"},To=["src","onClick"],Vo=["onClick"],$o={key:0,class:"row mt-7 mb-0"},No=t("h5",{style:{"font-size":"15px","font-weight":"900"},class:"font-weight-bold text-dark"},"Mandatory to keep at least one photo as an evidence.",-1),Lo=[No],xo=le({__name:"ImageListModal",props:{visibility:{type:Boolean,default:!1},images:{type:Array,required:!0},showDeleteButton:{type:Boolean,default:!0},showRemainingPhotosMessage:{default:!1,type:Boolean}},emits:["handle-close","handle-delete"],setup(e,{emit:s}){const a=e,o=s,r=L(!1),i=L(!1),l=L(""),n=Va(),m=v=>{const u=R.value.findIndex(U=>U.imgBlob==v),b=R.value[u];if(u>0){const U=R.value.slice(u),D=R.value.slice(0,u);R.value=[...U,...D]}l.value=b.url,i.value=!0},g=()=>{l.value="",i.value=!1},w=Ze(a,"visibility"),V=S(()=>Qe.cloneDeep(a.images)),P=L([]),x=L(!1),k=L(""),O=L(!1),B=async()=>{var v;if(E(),r.value=!0,P.value=[],((v=V.value)==null?void 0:v.length)>0){let u=0;R.value.forEach(async b=>{var D;const U={fileUrl:`${b.imgBlob}`,ver:"v1"};try{const M=await At.pendingTaskFile.where({filename:b.imgBlob}).first(),d=window.URL||window.webkitURL;if(!M&&!xt()){const _=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(U).toString()}`,F=(await ne.getBlob(_)).data,de=new Blob([F]);await ua(At,"pendingTaskFile",{key:n.stateDumpToLocalInfo.taskKey,module:"serviceForm",workorder:n.stateDumpToLocalInfo.workOrder,type:de.type,fileType:"webp",createdBy:n.stateDumpToLocalInfo.updatedBy,email:n.stateDumpToLocalInfo.email,filename:b.imgBlob,originalFilename:b.imgBlob,blob:de,syncStatus:"Sync",syncDate:ka()}),b.url=d.createObjectURL(de)}else Qe.isUndefined(M)?b.url="":b.url=d.createObjectURL(M.blob);u++,u==((D=V.value)==null?void 0:D.length)&&(r.value=!1)}catch(M){console.log("image",M)}})}},R=L([]),E=()=>{const v=a.images;R.value=v==null?void 0:v.map(u=>({imgBlob:u.filename,url:"",description:u.description}))},A=v=>{!a.images||a.images.length==0||(k.value=a.images[v],x.value=!0)},q=()=>{x.value=!1},J=()=>{x.value=!1,I()},I=async()=>{var U;const v={ver:"v1",fileUrl:k.value},u={},b=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/delete_by_url?${new URLSearchParams(v).toString()}`;try{r.value=!0,O.value=!0,xt()?await At.pendingTaskFile.filter(D=>D.filename==k.value).delete():await ne.post(`${b}?${new URLSearchParams(v).toString()}`,u),o("handle-delete",k.value)}catch(D){console.log("delete image",D)}finally{r.value=!1,O.value=!1,((U=a.images)==null?void 0:U.length)==0&&y()}};pt(async()=>{B()}),qe(V,async(v,u)=>{(v==null?void 0:v.length)==0&&y(),(v==null?void 0:v.length)!=(u==null?void 0:u.length)&&await B()},{deep:!0});const y=()=>{o("handle-close",!1)};return(v,u)=>{const b=X("el-skeleton-item"),U=X("el-dialog"),D=Ee("loading");return c(),h(ie,null,[f(U,{modelValue:w.value,"onUpdate:modelValue":u[0]||(u[0]=M=>w.value=M),title:"Detailed picture",width:"80%",onClose:u[1]||(u[1]=M=>y())},{default:Q(()=>[r.value?(c(),h("div",Ao,[se(t("div",Mo,null,512),[[D,r.value]]),O.value?(c(),h("span",Po,"deleting image...")):W("",!0)])):(c(),h(ie,{key:1},[t("div",Ro,[(c(!0),h(ie,null,we(R.value,(M,d)=>(c(),h("div",{key:M.imgBlob,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[M.url?(c(),h("div",Oo,[t("img",{src:M.url,alt:"img",class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:_=>m(M.imgBlob)},null,8,To),e.showDeleteButton?(c(),h("img",{key:0,onClick:_=>A(d),alt:"delete",class:"delete-image-button",src:Ra},null,8,Vo)):W("",!0)])):(c(),Y(b,{key:1,variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}}))]))),128))]),e.showRemainingPhotosMessage?(c(),h("div",$o,Lo)):W("",!0)],64))]),_:1},8,["modelValue"]),f(Oa,{visibility:x.value,caption:"Are you sure want to delete this image?",onOnNoConfirm:q,onOnYesConfirm:J},null,8,["visibility"]),i.value?(c(),Y(Ta,{key:0,images:R.value,visibility:i.value,image:l.value,onHandleClose:g},null,8,["images","visibility","image"])):W("",!0)],64)}}}),Uo={class:"m-0 p-0",style:{"font-weight":"normal"}},jo={class:"dialog-footer"},ea=le({__name:"TakeReplacementPhoto",props:{show:{type:Boolean,required:!0},item:{type:Object,required:!0},tool:{type:String,required:!0},side:{type:String,required:!0}},emits:["close"],setup(e,{emit:s}){const a=e,o=S({get(){return a.show},set(l){return l}}),r=s,i=()=>{r("close")};return(l,n)=>{const m=X("el-button"),g=X("el-dialog");return c(),Y(g,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=w=>o.value=w),width:480,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"replacement-dialog"},{footer:Q(()=>[t("span",jo,[f(m,{class:"replacement-button",onClick:i},{default:Q(()=>[_e(" Take a Photo ")]),_:1})])]),default:Q(()=>[t("p",Uo,[_e(" Please take a photo of the "),t("b",null,p(e.tool),1),_e(" from the "),t("b",null,p(e.side),1),_e(" with the cover removed ")])]),_:1},8,["modelValue"])}}}),Bo=["disabled"],Fo=["src"],qo={class:"text-white"},nt=le({__name:"SmallCamera",props:{itemkey:{default:"modifiedCBM"},images:{type:Object,required:!0},isMandatory:{type:Boolean,required:!1,default:!1},isReplacement:{type:Boolean,required:!1,default:!1},item:{type:Object,required:!1},sectionData:{type:String}},emits:["onHandleImages"],setup(e,{emit:s}){const a=e,o=s,r=L(!1),i=Ze(a,"images"),l=L(!1),n=ht(),m=at(()=>i.value?i.value:[]),g=(y=!1)=>{n.setIsReplacementCamera(a.isReplacement),n.toggleIsVisible(!0,a.itemkey),n.setIsActionFromDelete(y),a.isReplacement?n.setShowCloseButton(!a.isMandatory):n.setShowCloseButton(a.isMandatory?i.value.length>0:!a.isMandatory),r.value=!1},w=at(()=>Qe.cloneDeep(n.ImageObjects.find(y=>y.Id===a.itemkey))),V=at(()=>{let y="";switch(a.sectionData){case"HV Alternator":y="alternator";break;case"Retarder Grid Box 1":case"Retarder Grid Box 2":y="blower motor";break}return y}),P=()=>{let y="/media/svg/dma/camera/e-form/png/cam-active.png";return m.value.length>0&&(y="/media/svg/dma/camera/e-form/png/cam-user.png"),y},x=at(()=>a.isMandatory&&m.value.length>1?!0:!a.isMandatory),k=()=>{l.value=!0},O=()=>{l.value=!1},B=async y=>{const v=i.value,u=y.filename?y.filename:y,b=v.filter(U=>U.filename!=u);n.setCurrent(a.itemkey),o("onHandleImages",b),n.clearCurrent(),a.isReplacement&&(n.setIsReplacementCamera(a.isReplacement),b.length<2&&(n.setReplacementPosition(y.type),A())),b.length==0&&O()},R=L(!1),E=()=>{R.value=!1},A=()=>{R.value=!1,g()},q=async()=>{r.value=!1;const y=n.ImageObjects.find(u=>u.Id===a.itemkey),v=y?[...i.value,...y.ImageInfos]:[];n.clearCurrent(),o("onHandleImages",v),a.isReplacement&&v.length<=1&&(r.value=!0,n.setReplacementPhotoLength(v.length),n.setIsActionFromDelete(!1))},J=at(()=>{let y=!1;return a.isReplacement&&m.value.length===2&&(y=!0),y});qe(w,async(y,v)=>{y&&y.ImageInfos.length>0&&y.ImageInfos.length!=(v==null?void 0:v.ImageInfos.length)&&(await q(),O())},{deep:!0});const I=at(()=>{var v;let y="pb-2";return(v=a.task)!=null&&v.updatedBy&&a.task.updatedBy.name&&(y=""),y});return(y,v)=>(c(),h("div",{class:pe([[K(I)],"pt-2"])},[t("div",{class:pe(["row",!K(Qe.isUndefined)(i.value)&&i.value.length>0?"d-flex":""])},[t("button",{class:"btn btn-sm btn-icon btn-bg-light me-5",onClick:v[0]||(v[0]=u=>g()),disabled:K(J)},[t("img",{src:P(),style:{height:"12px",width:"14px"},alt:"camera"},null,8,Fo)],8,Bo),K(m)&&K(m).length>0?(c(),h("button",{key:0,class:"btn btn-sm btn-icon btn-bg-success",onClick:k,style:{"background-color":"#18af4a"}},[t("label",qo,"+"+p(K(m).length),1)])):W("",!0)],2),l.value?(c(),h(ie,{key:0},[e.isReplacement?(c(),Y(Pa,{key:0,ref:"preview",images:K(m),visibility:l.value,"view-only":!1,onOnClose:O,onOnDelete:B},null,8,["images","visibility"])):(c(),Y(xo,{key:1,images:K(m),visibility:l.value,showDeleteButton:K(x),onHandleClose:O,onHandleDelete:B,showRemainingPhotosMessage:e.isMandatory},null,8,["images","visibility","showDeleteButton","showRemainingPhotosMessage"]))],64)):W("",!0),f(ea,{show:r.value,item:a.item,tool:K(V),side:"off cab side",onClose:A},null,8,["show","item","tool"]),f($a,{visibility:R.value,caption:"The photo successfully taken, would you like to take another photo?",onOnNoConfirm:E,onOnYesConfirm:A},null,8,["visibility"])],2))}}),ta=e=>(Le("data-v-ca4d3b64"),e=e(),xe(),e),Ko={key:0,class:"condition-modified my-5"},Go={class:"table table-bordered"},Ho=ta(()=>t("caption",null,null,-1)),Jo=ta(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"Task"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Measurement Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating"),t("th",{scope:"col",class:"table-header"})])],-1)),zo={scope:"row",class:"ps-3 align-middle"},Xo={scope:"row",class:"align-middle"},Wo={scope:"row",class:"align-middle"},Yo={scope:"row",class:"align-middle"},Qo={scope:"row",class:"align-middle"},Zo={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},er={scope:"row",class:"align-middle"},tr={key:1,class:"history-modified"},ar={class:"row w-100 table table-bordered"},sr=It('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-ca4d3b64><div class="col-1 py-3 table-header" data-v-ca4d3b64>Task</div><div class="col-3 py-3 table-header" data-v-ca4d3b64>Measurement Location</div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Measurement Value</div><div class="col-1 py-3 table-header" data-v-ca4d3b64>UoM</div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Rating</div><div class="col-1 py-3 table-header" data-v-ca4d3b64></div><div class="col-2 py-3 table-header" data-v-ca4d3b64>Action</div></div>',1),or={key:0},rr={class:"d-flex align-items-center col-1 table-value"},ir={class:"d-flex align-items-center col-3 table-value"},nr={class:"d-flex align-items-center col-2 table-value"},lr={class:"d-flex align-items-center col-1 table-value"},ur={class:"d-flex align-items-center col-2 table-value"},cr={class:"col-1 table-value"},dr={class:"d-flex align-items-center col-2 table-value"},mr={key:0,class:"row px-0 mx-0"},pr={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},hr={key:1,class:"row px-0 mx-0"},gr={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},vr={key:1,class:"col-12 table-header text-center py-8"},fr=le({__name:"CbmAutomaticTable",props:{isModifying:{type:Boolean,required:!0,default:!1},detailCbm:{type:Object,required:!0},source:{type:String,required:!1,default:"serviceSheet"}},setup(e){const s=e,a=ye(),o=et(),r=S(()=>s.detailCbm.historyModifiedDefault[0].items[0].description=="Adjustment"),i=S(()=>o.inputError),l=S(()=>s.source=="intervention"&&s.detailCbm&&s.detailCbm.historyModified&&s.detailCbm.historyModified.detail.history.length>1?!0:!!(s.source!="intervention"&&s.detailCbm&&s.detailCbm.historyModified&&s.detailCbm.historyModified.detail.history.length>0)),n=S(()=>s.detailCbm.historyModifiedDefault[0].rating=="CALIPER"),m=S(()=>o.modifiedObjAut),g=S(()=>s.detailCbm.currentCondition.taskNo),w=S(()=>{let d=s.detailCbm.historyModifiedDefault[0].description.split(";")[0];return s.detailCbm.historyModifiedDefault[0].description.split(";")[1]!=""&&(d+=s.detailCbm.historyModifiedDefault[0].description.split(";")[1]),g.value==""?d:g.value.replace(/[^a-z]/gi,"").length>1?g.value.replace(";","").replace(/\D/g,""):g.value.replace(";","")}),V=d=>{const _=d.items[0].value;let H=d.description.split(";")[0];return d.description.split(";")[1]!=""&&(H+=d.description.split(";")[1]),_==""?H:_},P=S(()=>{if(n.value)return x();let d="";for(const _ of s.detailCbm.historyModifiedDefault[0].items)_.itemType==="html"&&(d=_.value);return d!=""?d:s.detailCbm.currentCondition.measurementLocation}),x=()=>{let d="";return s.detailCbm.historyModifiedDefault&&(d+=s.detailCbm.historyModifiedDefault[0].description.split(";")[1],d+=". ",d+=s.detailCbm.historyModifiedDefault[0].description.split(";")[2]),d},k=S({get:()=>o.modifiedObjAut.measurementValue,set:d=>{if(!isNaN(Number(d))){{if(d.length>8)return;if((`${d}`.split(".")||[]).length-1>1)return;if(d.includes(".")){if(`${d}`.split(".")[1].length>2)return;m.value.measurementValue=d}}if(d.length>5&&d.length>=6&&d.length<=6){if(d[5]!=".")return;m.value.measurementValue=d}m.value.measurementValue=d}}}),O=d=>n.value?x():d.items[2].itemType!="input"?d.items[2].value:d.items.find(H=>H.itemType=="html").value,B=d=>{if(r.value&&d.cbmAdjustmentReplacementValue)return d.cbmAdjustmentReplacementValue.measurement;const _=d.items.find(H=>H.categoryItemType=="paramRating"||H.categoryItemType=="paramRatingDynamic");return _?_.value:""},R=d=>{if(r.value&&d.cbmAdjustmentReplacementValue)return d.cbmAdjustmentReplacementValue.uom;const _=d.items.find(H=>H.categoryItemType=="targetTool");if(_)return _.value;if(_)return"";{const H=d.items.findIndex(F=>F.categoryItemType=="paramRating"||F.categoryItemType=="paramRatingDynamic");return d.items[H+1].value}},E=d=>{const _=d.find(H=>H.categoryItemType=="targetRating");return _||{}},A=d=>d.cbmAdjustmentReplacementValue.rating,q=d=>{if(d.isUpdatePhoto!=null&&!d.isUpdatePhoto)return[];if(r.value&&d.cbmAdjustmentReplacementValue)return d.cbmAdjustmentReplacementValue.pictures;if(s.source=="intervention")return d.pictures;const _=d.items.find(H=>H.itemType=="smallCamera");return _?_.value:[]},J=d=>{let _=d.keyCode?d.keyCode:d.which;_!=46&&(_<48||_>57)&&d.preventDefault()},I=d=>{let _;return d=="A"?_="a":d=="B"?_="b":d=="C"?_="c":d=="X"&&(_="x"),_},y=d=>{o.setImageAutomatic(d)},v=()=>{o.resetErrors(),o.setInputErrorCbmAutomatic("",!1);let d;if(d=parseFloat(k.value),k.value=String(d),m.value.measurementValue==""){o.setInputErrorCbmAutomatic("This field is Required",!0),o.setErrors(["Please Check the form again"]);return}if(!it(m.value.measurementValue)){o.setInputErrorCbmAutomatic("Max. 2 decimal digits",!0),o.setErrors(["Please Check the form again"]);return}let _=u();if(!_){o.setInputErrorCbmAutomatic("Out of range",!0),o.setErrors(["Please Check the form again"]);return}o.setAutomaticRating(_)},u=()=>{let d;const H=s.detailCbm.detailSpec.filter(F=>F.uom==m.value.uom);if(H.length>0)return m.value.measurementValue===""?void 0:(H.every(F=>{const de=st(F,m.value.measurementValue),Ce=ot(F,m.value.measurementValue);return d=rt(de,Ce,F),!d}),d)},b=L(!1),U=L([]),D=()=>{b.value=!1},M=d=>{U.value=d,b.value=!0};return(d,_)=>{const H=X("el-input");return c(),h(ie,null,[s.isModifying?(c(),h("div",Ko,[t("table",Go,[Ho,Jo,t("tbody",null,[t("tr",null,[t("th",zo,p(w.value),1),t("th",Xo,p(P.value),1),t("th",Wo,[f(H,{modelValue:k.value,"onUpdate:modelValue":_[0]||(_[0]=F=>k.value=F),class:"mb-0",onKeypress:J,onFocusout:v},null,8,["modelValue"]),se(t("span",{class:"text-danger font-weight-bold"},p(i.value.measurementValue.errorMessage),513),[[Ye,i.value.measurementValue.isShowError]])]),t("th",Yo,p(m.value.uom),1),t("th",Qo,[t("div",Zo,[f(H,{modelValue:m.value.measurementRating,"onUpdate:modelValue":_[1]||(_[1]=F=>m.value.measurementRating=F),placeholder:"Rating",class:pe(I(m.value.measurementRating)),disabled:"",readonly:""},null,8,["modelValue","class"])])]),t("th",er,[f(nt,{images:m.value.images,"is-mandatory":!1,onOnHandleImages:y},null,8,["images"])])])])])])):(c(),h("div",tr,[t("div",ar,[sr,l.value?(c(),h("div",or,[(c(!0),h(ie,null,we(e.detailCbm.historyModified.detail.history,(F,de)=>(c(),h("div",{key:de,class:"row px-0 mx-0 row-histories"},[t("div",rr,[t("span",null,p(V(F)),1)]),t("div",ir,[t("span",null,p(O(F)),1)]),t("div",nr,[t("span",null,p(B(F)),1)]),t("div",lr,[t("span",null,p(R(F)),1)]),t("div",ur,[r.value&&F.cbmAdjustmentReplacementValue?(c(),Y(Zt,{key:0,item:A(F),task:F},null,8,["item","task"])):(c(),Y(Et,{key:1,item:E(F.items)},null,8,["item"]))]),t("div",cr,[f(vt,{item:q(F),"is-updated-by-current-user":F.updatedBy.id==K(a).user.EmployeeId,onShowPreviewImages:M},null,8,["item","is-updated-by-current-user"])]),t("div",dr,p(e.detailCbm.historyModified.detail.history.length-1==de?"IronForms":"IronPortal"),1),r.value&&F.cbmAdjustmentReplacementValue?(c(),h("div",mr,[t("div",pr,p(F.cbmAdjustmentReplacementValue.updatedBy.name)+", "+p(F.cbmAdjustmentReplacementValue.updatedDate),1)])):F.updatedBy.name?(c(),h("div",hr,[t("div",gr,p(F.updatedBy.name)+", "+p(F.updatedDate),1)])):W("",!0)]))),128))])):(c(),h("div",vr,"No Data Recorded"))])])),b.value?(c(),Y(wt,{key:2,type:"task","re-render":!1,images:U.value,"show-delete-button":!1,"is-mandatory":!1,visibility:b.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:D},null,8,["images","visibility"])):W("",!0)],64)}}}),yr=Ve(fr,[["__scopeId","data-v-ca4d3b64"]]),ft=e=>(Le("data-v-cc221bfc"),e=e(),xe(),e),br={key:0,class:"condition-modified my-5"},_r={class:"table table-bordered"},Cr=ft(()=>t("caption",null,null,-1)),Sr=ft(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"Task"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Measurement Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating"),t("th",{scope:"col",class:"table-header"})])],-1)),kr=["textContent"],Ir=["textContent"],wr={scope:"row",class:"align-middle"},Er=["textContent"],Dr=["textContent"],Ar={scope:"row",class:"align-middle"},Mr={key:0,class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Pr={scope:"row",class:"align-middle"},Rr={key:1,class:"history-modified"},Or={class:"table table-bordered"},Tr=ft(()=>t("caption",null,null,-1)),Vr=ft(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header px-4"},"Task"),t("th",{scope:"col",class:"table-header px-4"},"Measurement Location"),t("th",{scope:"col",class:"table-header px-4"},"Measurement Value"),t("th",{scope:"col",class:"table-header px-4"},"UoM"),t("th",{scope:"col",class:"table-header px-4"},"Rating"),t("th",{scope:"col",class:"table-header px-4",colspan:"2"},"Action")])],-1)),$r={key:0},Nr=["textContent"],Lr=["textContent"],xr={class:"p-4 align-middle"},Ur=["textContent"],jr={class:"p-4 align-middle input-eform-status"},Br={class:"p-4 align-middle"},Fr=["textContent"],qr={key:0},Kr={class:"timestamp-task text-end m-auto px-5 py-0",colspan:"9"},Gr={key:1},Hr=ft(()=>t("tr",null,[t("td",{colspan:"6",class:"table-header text-center py-8"},"No Data Recorded")],-1)),Jr=[Hr],zr=le({__name:"CbmAvgTable",props:{isModifying:{type:Boolean,required:!0,default:!1}},setup(e){const s=ht(),a=ye(),o=et(),r=e,i=S(()=>o.modifiedObjectAvg),l=S(()=>o.detailCbm),n=S(()=>o.inputErrorList),m=u=>{const b=l.value.historyModifiedDefault[0].description.split(";")[0];return u==""?b:u},g=u=>{if(u.isUpdatePhoto!=null&&!u.isUpdatePhoto)return[];const b=u.items.find(U=>U.itemType=="smallCamera");return b?b.value:[]},w=()=>{const u=i.value.value.findIndex(D=>D.measurementValue==""),b=i.value.value.length-1;if(u!=-1&&u!=b){o.stateIsError=!0;return}let U=0;for(let D=0;D<b;D++){if(isNaN(Number(i.value.value[D].measurementValue))){o.setModifiedData(b,"measurementValue",""),o.setModifiedData(b,"measurementRating","");return}U+=Number(i.value.value[D].measurementValue)}o.setModifiedData(b,"measurementValue",parseFloat((U/(i.value.value.length-1)).toString()).toFixed(2).toString()),x(b)},V=u=>{let b=u.keyCode?u.keyCode:u.which;b!=46&&(b<48||b>57)&&u.preventDefault()},P=u=>{if(o.resetErrors(),o.stateInputErrorList.length!=l.value.historyModifiedDefault.length&&o.initErrorInputCbmAverage(),i.value.value[u].measurementValue==""){o.setInputErrorCbmAverage(u,"This field is required",!0),o.setErrors(["Please Check the form again"]);return}if(!k(u)){o.setInputErrorCbmAverage(u,"Max. 2 decimal digits",!0),o.setErrors(["Please Check the form again"]);return}o.setInputErrorCbmAverage(u,"",!1),q(u),w()},x=u=>{const b=l.value.detailSpec,U=i.value.value[u];if(!(b.length>0)||U.measurementValue==="")return;let d;b.every(_=>{const H=st(_,U.measurementValue),F=ot(_,U.measurementValue);return d=rt(H,F,_),!d}),o.setModifiedData(u,"measurementRating",d||"")},k=u=>it(i.value.value[u].measurementValue),O=L(),B=u=>{const b=O.value;!b&&b!==0||o.setImagePerRowAverage(b,u)},R=u=>{let b;return u=="A"?b="a":u=="B"?b="b":u=="C"?b="c":u=="X"&&(b="x"),b},E=u=>{const b=l.value.historyModifiedDefault[u].items[3].customValidation;if(!b)return!1;let U=i.value.value[u].measurementValue;return b=="cbmTakePhotoAllRating"?!0:b=="cbmDefectTakePhoto"&&(U=="C"||U=="X")},A=u=>{s.toggleIsVisible(!0,"modifiedCBM"),s.setShowCloseButton(u)},q=u=>{i.value.value[u].images.length<1&&E(u)&&A(!1)},J=L(!1),I=L([]),y=()=>{J.value=!1},v=u=>{I.value=u,J.value=!0};return(u,b)=>{var D,M;const U=X("el-input");return c(),h(ie,null,[r.isModifying?(c(),h("div",br,[t("table",_r,[Cr,Sr,t("tbody",null,[(c(!0),h(ie,null,we(l.value.historyModifiedDefault,(d,_)=>{var H,F,de,Ce;return c(),h("tr",{key:`cbm-avg-table-edit-${_}`},[t("th",{scope:"row",class:"ps-3 align-middle",textContent:p(d.items[1].value)},null,8,kr),t("th",{scope:"row",class:"align-middle",textContent:p(d.items[2].value)},null,8,Ir),t("th",wr,[f(U,{modelValue:i.value.value[_].measurementValue,"onUpdate:modelValue":he=>i.value.value[_].measurementValue=he,onKeypress:V,onChange:he=>P(_),disabled:d.items[3].categoryItemType=="resultParamRating"},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),(F=(H=n.value[_])==null?void 0:H.measurementValue)!=null&&F.isShowError?(c(),h("span",{key:0,class:"text-danger font-weight-bold",textContent:p((Ce=(de=n.value[_])==null?void 0:de.measurementValue)==null?void 0:Ce.errorMessage)},null,8,Er)):W("",!0)]),t("th",{scope:"row",class:"align-middle",textContent:p(i.value.value[_].uom)},null,8,Dr),t("th",Ar,[d.items[5].itemType!="label"?(c(),h("div",Mr,[f(U,{modelValue:i.value.value[_].measurementRating,"onUpdate:modelValue":he=>i.value.value[_].measurementRating=he,placeholder:"Rating",class:pe(R(i.value.value[_].measurementRating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):W("",!0)]),t("th",Pr,[f(nt,{itemkey:`avg-img-${_}`,onClick:he=>O.value=_,images:K(o).modifiedObjectAvg.value[_].images,onOnHandleImages:b[0]||(b[0]=he=>B(he))},null,8,["itemkey","onClick","images"])])])}),128))])])])):(c(),h("div",Rr,[t("table",Or,[Tr,Vr,l.value.historyModified&&((D=l.value.historyModified.detail)==null?void 0:D.history.length)>0?(c(),h("tbody",$r,[(c(!0),h(ie,null,we((M=l.value.historyModified.detail)==null?void 0:M.history,(d,_)=>{var H,F;return c(),h(ie,{key:_},[t("tr",null,[t("td",{class:"p-4 align-middle",textContent:p(m(d.items[0].value))},null,8,Nr),t("td",{class:"p-4 align-middle",textContent:p(d.items[2].value)},null,8,Lr),t("td",xr,[f(U,{class:"input-overwrite-cbm",modelValue:d.items[3].value,"onUpdate:modelValue":de=>d.items[3].value=de,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),t("td",{class:"p-4 align-middle",textContent:p(d.items[4].value)},null,8,Ur),t("td",jr,[f(U,{class:pe(["input-overwrite-cbm",R(d.items[5].value)]),modelValue:d.items[5].value,"onUpdate:modelValue":de=>d.items[5].value=de,placeholder:"Measurement Value",disabled:""},null,8,["class","modelValue","onUpdate:modelValue"])]),t("td",Br,[f(vt,{item:g(d),"is-updated-by-current-user":d.updatedBy.id==K(a).user.EmployeeId,onShowPreviewImages:v},null,8,["item","is-updated-by-current-user"])]),t("td",{class:"p-4 align-middle",textContent:p(l.value.historyModified.detail.history.length-1==_?"IronForms":"IronPortal")},null,8,Fr)]),(H=d.updatedBy)!=null&&H.name?(c(),h("tr",qr,[t("td",Kr,p((F=d==null?void 0:d.updatedBy)==null?void 0:F.name)+", "+p(d==null?void 0:d.updatedDate),1)])):W("",!0)],64)}),128))])):(c(),h("tbody",Gr,Jr))])])),J.value?(c(),Y(wt,{key:2,type:"task","re-render":!1,images:I.value,"show-delete-button":!1,"is-mandatory":!1,visibility:J.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:y},null,8,["images","visibility"])):W("",!0)],64)}}}),Xr=Ve(zr,[["__scopeId","data-v-cc221bfc"]]),aa=e=>(Le("data-v-4b2a6092"),e=e(),xe(),e),Wr={key:0,class:"condition-modified my-5"},Yr={class:"table table-bordered"},Qr=aa(()=>t("caption",null,null,-1)),Zr=aa(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-2"},"Task"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Rating"),t("th",{scope:"col",class:"table-header"})])],-1)),ei={scope:"row",class:"ps-2"},ti={scope:"row"},ai={scope:"row"},si={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},oi={class:"text-danger font-weight-bold"},ri={scope:"row"},ii={key:1,class:"history-modified"},ni={class:"row w-100 table table-bordered"},li=It('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-4b2a6092><div class="col-1 py-3 table-header" data-v-4b2a6092>Task</div><div class="col-4 py-3 table-header" data-v-4b2a6092>Measurement Location</div><div class="col-4 py-3 table-header" data-v-4b2a6092>Rating</div><div class="col-1 py-3 table-header" data-v-4b2a6092></div><div class="col-2 py-3 table-header" data-v-4b2a6092>Action</div></div>',1),ui={key:0},ci={class:"row px-0 mx-0 row-histories"},di={class:"d-flex align-items-center col-1 table-value"},mi={class:"d-flex align-items-center col-4 table-value"},pi={class:"d-flex align-items-center col-4 table-value"},hi={class:"col-1 table-value"},gi={class:"d-flex align-items-center col-2 table-value"},vi={key:0,class:"row px-0 mx-0"},fi={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},yi={key:1,class:"col-12 table-header text-center py-8"},bi=le({__name:"CbmNormalTable",props:{isModifying:{type:Boolean,required:!0,default:!1},source:{type:String,required:!1,default:"serviceSheet"}},setup(e){const s=e,a=et(),o=ye(),r=S(()=>a.inputError),i=S(()=>a.modifiedObjMan),l=S(()=>a.detailCbm),n=()=>{a.resetErrors(),a.setInputErrorCbmManual("",!1),i.value.measurementRating==""&&(a.setInputErrorCbmManual("This field is Required",!0),a.setErrors(["Please Check the form again"]))},m=E=>{let A;return E=="A"?A="a":E=="B"?A="b":E=="C"?A="c":E=="X"&&(A="x"),A},g=S(()=>{let E="";for(const A of l.value.historyModifiedDefault[0].items)A.itemType==="html"&&(E=A.value);return E!=""?E:l.value.currentCondition.measurementLocation}),w=E=>E.items[2].itemType!="input"?E.items[2].value:E.items.find(q=>q.itemType=="html").value,V=E=>{const A=E.find(J=>J.categoryItemType=="resultRating"),q=E.find(J=>J.itemType=="dropDown");return A||q||{}},P=E=>{if(E.isUpdatePhoto!=null&&!E.isUpdatePhoto)return[];if(s.source=="intervention")return E.pictures;const A=E.items.find(q=>q.itemType=="smallCamera");return A?A.value:[]},x=E=>{a.setImageManual(E)},k=L(!1),O=L([]),B=()=>{k.value=!1},R=E=>{O.value=E,k.value=!0};return(E,A)=>{const q=X("el-option"),J=X("el-select");return c(),h(ie,null,[s.isModifying?(c(),h("div",Wr,[t("table",Yr,[Qr,Zr,t("tbody",null,[t("tr",null,[t("th",ei,p(i.value.taskNo),1),t("th",ti,p(g.value),1),t("th",ai,[t("div",si,[f(J,{modelValue:i.value.measurementRating,"onUpdate:modelValue":A[0]||(A[0]=I=>i.value.measurementRating=I),placeholder:"Rating",class:pe(m(i.value.measurementRating)),onChange:n},{default:Q(()=>[(c(),h(ie,null,we(["A","B","C","X"],I=>f(q,{key:I,label:I,value:I},null,8,["label","value"])),64))]),_:1},8,["modelValue","class"]),t("div",null,[se(t("span",oi,"This field is required",512),[[Ye,r.value.measurementRating.isShowError]])])])]),t("th",ri,[f(nt,{images:i.value.images,"is-mandatory":!1,onOnHandleImages:x},null,8,["images"])])])])])])):(c(),h("div",ii,[t("div",ni,[li,l.value&&l.value.historyModified&&l.value.historyModified.detail.history.length>0?(c(),h("div",ui,[(c(!0),h(ie,null,we(l.value.historyModified.detail.history,(I,y)=>(c(),h(ie,{key:y},[t("div",ci,[t("div",di,[t("span",null,p(I.items[0].value),1)]),t("div",mi,[t("span",null,p(w(I)),1)]),t("div",pi,[f(Et,{item:V(I.items)},null,8,["item"])]),t("div",hi,[f(vt,{item:P(I),"is-updated-by-current-user":I.updatedBy.id==K(o).user.EmployeeId,onShowPreviewImages:R},null,8,["item","is-updated-by-current-user"])]),t("div",gi,p(l.value.historyModified.detail.history.length-1==y?"IronForms":"IronPortal"),1)]),I.updatedBy.name?(c(),h("div",vi,[t("div",fi,p(I.updatedBy.name)+", "+p(I.updatedDate),1)])):W("",!0)],64))),128))])):(c(),h("div",yi,"No Data Recorded"))])])),k.value?(c(),Y(wt,{key:2,type:"task","re-render":!1,images:O.value,"show-delete-button":!1,"is-mandatory":!1,visibility:k.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:B},null,8,["images","visibility"])):W("",!0)],64)}}}),_i=Ve(bi,[["__scopeId","data-v-4b2a6092"]]),yt=e=>(Le("data-v-95e59e34"),e=e(),xe(),e),Ci={key:0,class:"condition-modified my-5"},Si={class:"table table-bordered"},ki=yt(()=>t("caption",null,null,-1)),Ii=yt(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"Task"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Adjusted Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating"),t("th",{scope:"col",class:"table-header"})])],-1)),wi=["textContent"],Ei=["textContent"],Di={scope:"row",class:"align-middle"},Ai=["textContent"],Mi=["textContent"],Pi={scope:"row",class:"align-middle"},Ri={key:0,class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Oi={scope:"row",class:"align-middle"},Ti={key:1,class:"history-modified"},Vi={class:"table table-bordered"},$i=yt(()=>t("caption",null,null,-1)),Ni=yt(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header px-4"},"Task"),t("th",{scope:"col",class:"table-header px-4"},"Measurement Location"),t("th",{scope:"col",class:"table-header px-4"},"Measurement Value"),t("th",{scope:"col",class:"table-header px-4"},"UoM"),t("th",{scope:"col",class:"table-header px-4"},"Status"),t("th",{scope:"col",class:"table-header px-4",colspan:"2"},"Action")])],-1)),Li={key:0},xi=["textContent"],Ui=["textContent"],ji={class:"p-4 align-middle"},Bi={class:"p-4 align-middle"},Fi=["textContent"],qi={class:"p-4 align-middle"},Ki=["textContent"],Gi={key:0},Hi={class:"timestamp-task text-end m-auto px-5 py-0",colspan:"9"},Ji={key:1},zi=yt(()=>t("tr",null,[t("td",{colspan:"6",class:"table-header text-center py-8"}," No Data Recorded ")],-1)),Xi=[zi],Wi=le({__name:"CbmSuspensionTable",props:{isModifying:{type:Boolean,required:!0,default:!1}},setup(e){const s=ht(),a=et(),o=e,r=S(()=>a.modifiedObjectAvg),i=S(()=>a.detailCbm),l=S(()=>a.inputErrorList),n=()=>{const E=r.value.value.findIndex(J=>J.measurementValue==""),A=r.value.value.length-1;if(E!=-1&&E!=A)return;let q=0;for(let J=0;J<A;J++)q+=Number(r.value.value[J].measurementValue);a.setModifiedData(A,"measurementValue",(q/(r.value.value.length-1)).toString()),w(A)},m=E=>{let A=E.keyCode?E.keyCode:E.which;A!=46&&(A<48||A>57)&&E.preventDefault()},g=E=>{if(a.resetErrors(),a.setInputErrorCbmAverage(E,"",!1),r.value.value[E].measurementValue==""){a.setInputErrorCbmAverage(E,"This field is required",!0),a.setErrors(["Please Check the form again"]);return}if(!V(E)){a.setInputErrorCbmAverage(E,"Max. 2 decimal digits",!0),a.setErrors(["Please Check the form again"]);return}a.setInputErrorCbmAverage(E,"",!1),R(E),n()},w=E=>{const A=i.value.detailSpec,q=r.value.value[E];if(!(A.length>0)||q.measurementValue==="")return;let y;A.every(v=>{const u=st(v,q.measurementValue),b=ot(v,q.measurementValue);return y=rt(u,b,v),!y}),a.setModifiedData(E,"measurementRating",y||"")},V=E=>it(r.value.value[E].measurementValue),P=L(),x=E=>{const A=P.value;A&&(r.value.value[A].images=E)},k=E=>{let A;return E=="A"?A="a":E=="B"?A="b":E=="C"?A="c":E=="X"&&(A="x"),A},O=E=>{const A=i.value.historyModifiedDefault[E].items[3].customValidation;if(!A)return!1;let q=r.value.value[E].measurementValue;return A=="cbmTakePhotoAllRating"?!0:A=="cbmDefectTakePhoto"&&(q=="C"||q=="X")},B=E=>{s.toggleIsVisible(!0,"modifiedCBM"),s.setShowCloseButton(E)},R=E=>{r.value.value[E].images.length<1&&O(E)&&B(!1)};return(E,A)=>{var J,I;const q=X("el-input");return o.isModifying?(c(),h("div",Ci,[t("table",Si,[ki,Ii,t("tbody",null,[(c(!0),h(ie,null,we(i.value.historyModifiedDefault,(y,v)=>(c(),h("tr",{key:`cbm-avg-table-edit-${v}`},[t("th",{scope:"row",class:"ps-3 align-middle",textContent:p(y.items[1].value)},null,8,wi),t("th",{scope:"row",class:"align-middle",textContent:p(y.items[2].value)},null,8,Ei),t("th",Di,[f(q,{modelValue:r.value.value[v].measurementValue,"onUpdate:modelValue":u=>r.value.value[v].measurementValue=u,onKeypress:m,onChange:u=>g(v),disabled:y.items[3].categoryItemType=="resultParamRating"},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),l.value[v].measurementValue.isShowError?(c(),h("span",{key:0,class:"text-danger font-weight-bold",textContent:p(l.value[v].measurementValue.errorMessage)},null,8,Ai)):W("",!0)]),t("th",{scope:"row",class:"align-middle",textContent:p(r.value.value[v].uom)},null,8,Mi),t("th",Pi,[y.items[5].itemType!="label"?(c(),h("div",Ri,[f(q,{modelValue:r.value.value[v].measurementRating,"onUpdate:modelValue":u=>r.value.value[v].measurementRating=u,placeholder:"Rating",class:pe(k(r.value.value[v].measurementRating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):W("",!0)]),t("th",Oi,[f(nt,{onClick:u=>P.value=v,images:r.value.value[v].images,onOnHandleImages:A[0]||(A[0]=u=>x(u))},null,8,["onClick","images"])])]))),128))])])])):(c(),h("div",Ti,[t("table",Vi,[$i,Ni,i.value.historyModified&&((J=i.value.historyModified.detail)==null?void 0:J.history.length)>0?(c(),h("tbody",Li,[(c(!0),h(ie,null,we((I=i.value.historyModified.detail)==null?void 0:I.history,(y,v)=>{var u,b;return c(),h(ie,{key:v},[t("tr",null,[t("td",{class:"p-4 align-middle",textContent:p(y.items[0].value)},null,8,xi),t("td",{class:"p-4 align-middle",textContent:p(y.items[2].value)},null,8,Ui),t("td",ji,[f(q,{class:"input-overwrite-cbm",modelValue:y.items[3].value,"onUpdate:modelValue":U=>y.items[3].value=U,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),t("td",Bi,[f(q,{class:"input-overwrite-cbm",modelValue:y.items[5].value,"onUpdate:modelValue":U=>y.items[5].value=U,placeholder:"Measurement Value",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),t("td",{class:"p-4 align-middle",textContent:p(y.items[4].value)},null,8,Fi),t("td",qi,[f(vt,{item:y.items[6],task:y},null,8,["item","task"])]),t("td",{class:"p-4 align-middle",textContent:p(i.value.historyModified.detail.history.length-1==v?"IronForms":"IronPortal")},null,8,Ki)]),(u=y.updatedBy)!=null&&u.name?(c(),h("tr",Gi,[t("td",Hi,p((b=y==null?void 0:y.updatedBy)==null?void 0:b.name)+", "+p(y==null?void 0:y.updatedDate),1)])):W("",!0)],64)}),128))])):(c(),h("tbody",Ji,Xi))])]))}}}),Yi=Ve(Wi,[["__scopeId","data-v-95e59e34"]]),sa=e=>(Le("data-v-37978c02"),e=e(),xe(),e),Qi={key:0,class:"condition-modified my-5"},Zi={class:"table table-bordered"},en=sa(()=>t("caption",null,null,-1)),tn=sa(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"Task"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Current Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Rating")])],-1)),an={scope:"row",class:"ps-3 align-middle"},sn={scope:"row",class:"align-middle"},on={scope:"row",class:"align-middle"},rn={scope:"row",class:"align-middle"},nn={scope:"row",class:"pe-3 align-middle"},ln={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},un={key:0},cn={scope:"row",class:"px-3 align-middle",colspan:"5"},dn={class:"d-flex align-items-center px-3 w-100",style:{border:"1px solid #e7eaee"}},mn={class:"ms-auto me-3"},pn={key:1,class:"history-modified"},hn={class:"row w-100 table table-bordered"},gn=It('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-37978c02><div class="col-1 py-3 table-header" data-v-37978c02>Task</div><div class="col-3 py-3 table-header" data-v-37978c02>Measurement Location</div><div class="col-2 py-3 table-header" data-v-37978c02>Measurement Value</div><div class="col-1 py-3 table-header" data-v-37978c02>UoM</div><div class="col-2 py-3 table-header" data-v-37978c02>Rating</div><div class="col-2 py-3 table-header" data-v-37978c02>Action</div></div>',1),vn={key:0},fn={class:"d-flex align-items-center col-1"},yn={class:"d-flex align-items-center col-3"},bn={class:"d-flex align-items-center col-2"},_n={class:"d-flex align-items-center col-1"},Cn={class:"d-flex align-items-center col-2"},Sn={key:0,class:"input-eform-status"},kn={class:"d-flex align-items-center col-2"},In={key:0,class:"row px-0 mx-0"},wn={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},En={key:1,class:"row px-0 mx-0"},Dn={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},An={key:1,class:"col-12 table-header text-center py-8"},Mn=le({__name:"CbmAutomaticReplacementTable",props:{isModifying:{type:Boolean,required:!0,default:!1},normalFormula:{type:Array},gapFormula:{type:Array},isReplacement:{type:Boolean}},setup(e){const s=e,a=et(),o=S(()=>a.cbmType),r=S(()=>a.detailCbm),i=S(()=>{const D=r.value.beforeReplacementItems.find(M=>M.categoryItemType=="previousParamRating");return D.value?D.value:""}),l=S(()=>a.inputError),n=S(()=>a.modifiedObjAut),m=S({get:()=>a.modifiedObjAut.measurementValue,set:D=>{if(!isNaN(Number(D))){{if(D.length>8)return;if((`${D}`.split(".")||[]).length-1>1)return;if(D.includes(".")){if(`${D}`.split(".")[1].length>2)return;n.value.measurementValue=D}}if(D.length>5&&D.length>=6&&D.length<=6){if(D[5]!=".")return;n.value.measurementValue=D}n.value.measurementValue=D}}}),g=S(()=>{if(r.value.historyModifiedDefault[0].items.length==1)return!0;const D=r.value.historyModifiedDefault[0].items.find(d=>d.categoryItemType=="paramRating"||d.categoryItemType=="paramRatingDynamic"),M=(D==null?void 0:D.customValidation)||"";return M?M=="cbmTakePhoto"||M=="cbmTakePhotoAllRating"||M=="cbmDefectTakePhoto"||M=="cbmReplaceDefectTakePhoto"&&(n.value.measurementRating=="C"||n.value.measurementRating=="X"):!1}),w=D=>D.items[2].itemType!="input"?D.items[2].value:D.items.find(d=>d.itemType=="html").value,V=D=>{const M=D.items.find(d=>d.categoryItemType=="paramRating"||d.categoryItemType=="paramRatingDynamic");return M?M.value:""},P=D=>{const M=D.items.find(d=>d.categoryItemType=="targetTool");if(M)return M.value;if(M)return"";{const d=D.items.findIndex(_=>_.categoryItemType=="paramRating"||_.categoryItemType=="paramRatingDynamic");return D.items[d+1].value}},x=D=>{const M=D.find(d=>d.categoryItemType=="targetRating");return M||{}},k=D=>{let M=D.keyCode?D.keyCode:D.which;M!=46&&(M<48||M>57)&&D.preventDefault()},O=D=>{let M;return D=="A"?M="a":D=="B"?M="b":D=="C"?M="c":D=="X"&&(M="x"),M},B=D=>{a.setImageAutomatic(D)},R=()=>{a.resetErrors(),a.setInputErrorCbmAutomatic("",!1);let D;if(D=parseFloat(m.value),m.value=String(D),n.value.measurementValue==""){a.setInputErrorCbmAutomatic("This field is Required",!0),a.setErrors(["Please Check the form again"]);return}if(o.value=="AUTOMATIC_REPLACEMENT_GAP"&&i.value&&(Number(n.value.measurementValue)<0||Number(n.value.measurementValue)>52)){a.setInputErrorCbmAutomatic("Must be 0-52",!0),a.setErrors(["Please Check the form again"]);return}if(!it(n.value.measurementValue)){a.setInputErrorCbmAutomatic("Max. 2 decimal digits",!0),a.setErrors(["Please Check the form again"]);return}let M=E();if(!M){a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]);return}a.setAutomaticRating(M)},E=()=>o.value=="AUTOMATIC_REPLACEMENT"?q():i.value?J():A(s.normalFormula,n.value.measurementValue)?"A":(a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]),""),A=(D,M)=>{let d;return D.every(_=>{const H=st(_,M),F=ot(_,M);return d=rt(H,F,_),!d}),d},q=()=>{if(s.normalFormula&&s.normalFormula.length>0)return n.value.measurementValue===""?void 0:A(s.normalFormula,n.value.measurementValue)},J=()=>{const D=Number(m.value),M=Number(i.value),d=Math.abs(D-M).toFixed(2);return M<D?(a.setInputErrorCbmAutomatic("Out of range",!0),a.setErrors(["Please Check the form again"]),""):A(s.gapFormula,d)},I=ht(),y=L(""),v=L(!1),u=L(""),b=()=>{u.value.length<2&&I.toggleIsVisible(!0,r.value.replacementPhoto[0].items[2].key),U(r.value.currentCondition.section),I.setReplacementTool(y.value),v.value=!1},U=D=>{switch(y.value="",D){case"HV Alternator":y.value="alternator";break;case"Retarder Grid Box 1":case"Retarder Grid Box 2":y.value="blower motor";break}};return(D,M)=>{const d=X("el-input");return c(),h(ie,null,[s.isModifying?(c(),h("div",Qi,[t("table",Zi,[en,tn,t("tbody",null,[t("tr",null,[t("th",an,p(n.value.taskNo),1),t("th",sn,p(n.value.measurementLocation),1),t("th",on,[f(d,{modelValue:m.value,"onUpdate:modelValue":M[0]||(M[0]=_=>m.value=_),class:"mb-0",onKeypress:k,onFocusout:R},null,8,["modelValue"]),se(t("span",{class:"text-danger font-weight-bold"},p(l.value.measurementValue.errorMessage),513),[[Ye,l.value.measurementValue.isShowError]])]),t("th",rn,p(n.value.uom),1),t("th",nn,[t("div",ln,[f(d,{modelValue:n.value.measurementRating,"onUpdate:modelValue":M[1]||(M[1]=_=>n.value.measurementRating=_),placeholder:"Rating",class:pe(O(n.value.measurementRating)),disabled:"",readonly:""},null,8,["modelValue","class"])])])]),r.value.replacementPhoto?(c(),h("tr",un,[t("th",cn,[t("div",dn,[t("span",null,p(r.value.replacementPhoto[0].items[1].value),1),t("span",mn,[f(nt,{images:n.value.images,"is-mandatory":g.value,item:r.value.replacementPhoto[0].items[2],itemkey:r.value.replacementPhoto[0].items[2].key,"section-data":r.value.currentCondition.section,"is-replacement":!0,onOnHandleImages:B},null,8,["images","is-mandatory","item","itemkey","section-data"])])])])])):W("",!0)])])])):(c(),h("div",pn,[t("div",hn,[gn,r.value.historyModified&&r.value.historyModified.detail.history.length>0?(c(),h("div",vn,[(c(!0),h(ie,null,we(r.value.historyModified.detail.history,(_,H)=>(c(),h("div",{key:H,class:"row px-0 mx-0"},[t("div",fn,[t("span",null,p(_.items[0].value),1)]),t("div",yn,[t("span",null,p(w(_)),1)]),t("div",bn,[t("span",null,p(s.isReplacement?_.cbmAdjustmentReplacementValue.measurement:V(_)),1)]),t("div",_n,[t("span",null,p(P(_)),1)]),t("div",Cn,[s.isReplacement?(c(),h("div",Sn,[f(d,{modelValue:_.cbmAdjustmentReplacementValue.rating,"onUpdate:modelValue":F=>_.cbmAdjustmentReplacementValue.rating=F,placeholder:"Rating",class:pe(O(_.cbmAdjustmentReplacementValue.rating)),disabled:"",readonly:""},null,8,["modelValue","onUpdate:modelValue","class"])])):(c(),Y(Et,{key:1,item:x(_.items)},null,8,["item"]))]),t("div",kn,p(r.value.historyModified.detail.history.length-1==H?"IronForms":"IronPortal"),1),s.isReplacement&&_.cbmAdjustmentReplacementValue?(c(),h("div",In,[t("div",wn,p(_.cbmAdjustmentReplacementValue.updatedBy.name)+", "+p(_.cbmAdjustmentReplacementValue.updatedDate),1)])):_.updatedBy.name?(c(),h("div",En,[t("div",Dn,p(_.updatedBy.name)+", "+p(_.updatedDate),1)])):W("",!0)]))),128))])):(c(),h("div",An,"No Data Recorded"))])])),r.value.replacementPhoto?(c(),Y(ea,{key:2,show:v.value,item:r.value.replacementPhoto[0].items[2],tool:y.value,side:K(I).replacementPosition,onClose:b},null,8,["show","item","tool","side"])):W("",!0)],64)}}}),Pn=Ve(Mn,[["__scopeId","data-v-37978c02"]]),oa=e=>(Le("data-v-3e6c1f90"),e=e(),xe(),e),Rn={key:0,class:"condition-modified my-5"},On={class:"table table-bordered"},Tn=oa(()=>t("caption",null,null,-1)),Vn=oa(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",style:{width:"5%"},class:"table-header ps-3"},"Task"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Measurement Location"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Tool"),t("th",{scope:"col",style:{width:"8%"},class:"table-header"},"A"),t("th",{scope:"col",style:{width:"8%"},class:"table-header"},"B"),t("th",{scope:"col",style:{width:"15%"},class:"table-header"},"Piston Movement (B-A)"),t("th",{scope:"col",style:{width:"5%"},class:"table-header"},"UoM"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Percent Worn"),t("th",{scope:"col",style:{width:"10%"},class:"table-header"},"Rating"),t("th",{scope:"col",style:{width:"9%"},class:"table-header"})])],-1)),$n={scope:"row",class:"ps-3 align-middle"},Nn={scope:"row",class:"align-middle"},Ln={scope:"row",class:"align-middle"},xn={scope:"row",class:"align-middle"},Un={scope:"row",class:"align-middle"},jn={scope:"row",class:"align-middle"},Bn={class:"text-danger font-weight-bold"},Fn={scope:"row",class:"align-middle"},qn={scope:"row",class:"align-middle"},Kn={scope:"row",class:"align-middle"},Gn={class:"div px-0 px-0 mx-0 my-0 w-100 h-100 input-eform-status"},Hn={scope:"row",class:"align-middle"},Jn={key:1,class:"history-modified"},zn={class:"row w-100 table table-bordered"},Xn=It('<div class="row w-100 ms-0" style="background:#f4f6f8;" data-v-3e6c1f90><div class="col py-3 table-header" data-v-3e6c1f90>Task</div><div class="col-2 py-3 table-header" data-v-3e6c1f90>Measurement Location</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Tool</div><div class="col py-3 table-header" data-v-3e6c1f90>A</div><div class="col py-3 table-header" data-v-3e6c1f90>B</div><div class="col-2 py-3 table-header" data-v-3e6c1f90>Piston Movement (B-A)</div><div class="col py-3 table-header" data-v-3e6c1f90>UoM</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Percent Worn</div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Rating</div><div class="col-1 py-3 table-header" data-v-3e6c1f90></div><div class="col-1 py-3 table-header" data-v-3e6c1f90>Action</div></div>',1),Wn={key:0},Yn={class:"d-flex align-items-center col"},Qn={class:"d-flex align-items-center col-2"},Zn={class:"d-flex align-items-center col-1"},el={class:"d-flex align-items-center col"},tl={class:"d-flex align-items-center col"},al={class:"d-flex align-items-center col-2"},sl={class:"d-flex align-items-center col"},ol={class:"d-flex align-items-center col-1"},rl={class:"d-flex align-items-center col-1"},il={class:"col-1"},nl={class:"d-flex align-items-center col-1"},ll={key:0,class:"row px-0 mx-0"},ul={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},cl={key:1,class:"row px-0 mx-0"},dl={class:"d-flex justify-content-end pb-1 pt-0 my-0 timestamp-task"},ml={key:1,class:"col-12 table-header text-center py-8"},pl=le({__name:"CbmOilCooledTable",props:{isModifying:{type:Boolean,required:!0,default:!1},source:{type:String,required:!1,default:"serviceSheet"}},emits:["openCamera"],setup(e,{emit:s}){const a=e,o=ye(),r=et(),i=S(()=>r.detailCbm),l=S(()=>i.value.historyModifiedDefault[0].items[0].description=="Adjustment"),n=S(()=>r.inputErrorOilCooled),m=S(()=>a.source=="intervention"&&i.value.historyModified&&i.value.historyModified.detail.history.length>1?!0:!!(a.source!="intervention"&&i.value.historyModified&&i.value.historyModified.detail.history.length>0)),g=S(()=>r.modifiedObjOilCooled),w=S(()=>i.value.currentCondition.taskNo),V=S(()=>{let C=i.value.historyModifiedDefault[0].description.split(";")[0];return i.value.historyModifiedDefault[0].description.split(";")[1]!=""&&(C+=i.value.historyModifiedDefault[0].description.split(";")[1]),w.value==""?C:w.value.replace(/[^a-z]/gi,"").length>1?w.value.replace(";","").replace(/\D/g,""):w.value.replace(";","")}),P=C=>{const T=C.items[0].value;let Z=C.description.split(";")[0];return C.description.split(";")[1]!=""&&(Z+=C.description.split(";")[1]),T==""?Z:T},x=S(()=>{let C="";for(const T of i.value.historyModifiedDefault[0].items)T.itemType==="html"&&(C=T.value);return C!=""?C:i.value.currentCondition.measurementLocation}),k=S(()=>g.value.tool=="BIRRANA"?"Birrana Gauge":"CAT Gauge"),O=S({get:()=>g.value.pistonMovementA,set:C=>{g.value.pistonMovementA=E(C)}}),B=S({get:()=>g.value.pistonMovementB,set:C=>{g.value.pistonMovementB=E(C)}}),R=S(()=>g.value.pistonMovementResult),E=C=>{let T=C;if(!isNaN(Number(C))){{if(C.length>8)return;if((`${C}`.split(".")||[]).length-1>1)return;if(C.includes(".")){if(`${C}`.split(".")[1].length>2)return;T=C}}if(C.length>5&&C.length>=6&&C.length<=6){if(C[5]!=".")return;T=C}return T}},A=C=>C.items[2].itemType!="input"?C.items[2].value:C.items.find(Z=>Z.itemType=="html").value,q=C=>{const T=C.find(Z=>Z.categoryItemType=="dropdownTool");return T?T.value=="BIRRANA"?"Birrana Gauge":"CAT Gauge":""},J=C=>{const T=C.find(Z=>Z.categoryItemType=="pistonMovementA");return T?T.value:""},I=C=>{const T=C.find(Z=>Z.categoryItemType=="pistonMovementB");return T?T.value:""},y=C=>{const T=C.find(Z=>Z.categoryItemType=="pistonMovementResult");return T?T.value:""},v=C=>{const T=C.find(Z=>Z.categoryItemType=="pistonMovementRating");return T&&T.value!="-"?`${parseFloat(T.value)*100}%`:"-"},u=C=>{const T=C.find(Z=>Z.categoryItemType=="targetTool");return T?T.value:""},b=C=>{const T=C.find(Z=>Z.categoryItemType=="targetRating");return T||{}},U=C=>C.cbmAdjustmentReplacementValue.rating,D=C=>{if(C.isUpdatePhoto!=null&&!C.isUpdatePhoto)return[];if(l.value&&C.cbmAdjustmentReplacementValue)return C.cbmAdjustmentReplacementValue.pictures;if(a.source=="intervention")return C.pictures;const T=C.items.find(Z=>Z.itemType=="smallCamera");return T?T.value:[]},M=C=>{let T=C.keyCode?C.keyCode:C.which;T!=46&&(T<48||T>57)&&C.preventDefault()},d=C=>{let T;return C=="A"?T="a":C=="B"?T="b":C=="C"?T="c":C=="X"&&(T="x"),T},_=C=>{r.setImageOilCooled(C)},H=()=>{r.resetErrors(),r.setInputErrorCbmOilCooledPistonA("",!1);let C;if(C=parseFloat(O.value),O.value=String(C),!g.value.pistonMovementA){r.setInputErrorCbmOilCooledPistonA("This field is Required",!0),r.setErrors(["Please Check the form again"]);return}if(!it(g.value.pistonMovementA)){r.setInputErrorCbmOilCooledPistonA("Max. 2 decimal digits",!0),r.setErrors(["Please Check the form again"]);return}B.value&&Ce()},F=()=>{r.resetErrors(),r.setInputErrorCbmOilCooledPistonB("",!1);let C;if(C=parseFloat(B.value),B.value=String(C),!g.value.pistonMovementB){r.setInputErrorCbmOilCooledPistonB("This field is Required",!0),r.setErrors(["Please Check the form again"]);return}if(!it(g.value.pistonMovementB)){r.setInputErrorCbmOilCooledPistonB("Max. 2 decimal digits",!0),r.setErrors(["Please Check the form again"]);return}if(C<parseFloat(O.value)){r.setInputErrorCbmOilCooledPistonB("Piston B must be greater than Piston A",!0),r.setErrors(["Please Check the form again"]);return}O.value&&Ce()},de=L(!1),Ce=()=>{de.value=!1,B.value&&O.value&&(g.value.pistonMovementResult=(parseFloat(B.value)-parseFloat(O.value)).toFixed(2).toString());let C=he();r.setOilCooledPercentWorn(C);let T=He();if(!C){de.value=!0,r.setErrors(["Please Check the form again"]);return}r.setOilCooledRating(T)},he=()=>{let C;const Z=i.value.detailSpec.filter(ge=>!["A","B","C","X"].includes(ge.cbmRating));if(Z.length>0)return g.value.pistonMovementResult?(Z.every(ge=>{const De=st(ge,g.value.pistonMovementResult),$=ot(ge,g.value.pistonMovementResult);return C=rt(De,$,ge),!C}),C):void 0},He=()=>{let C;const Z=i.value.detailSpec.filter(ge=>["A","B","C","X"].includes(ge.cbmRating));if(Z.length>0)return g.value.pistonMovementRating?(Z.every(ge=>{const De=st(ge,g.value.pistonMovementRating),$=ot(ge,g.value.pistonMovementRating);return C=rt(De,$,ge),!C}),C):void 0},Ie=L(!1),G=L([]),tt=()=>{Ie.value=!1},je=C=>{G.value=C,Ie.value=!0};return(C,T)=>{const Z=X("el-option"),ge=X("el-select"),De=X("el-input");return c(),h(ie,null,[a.isModifying?(c(),h("div",Rn,[t("table",On,[Tn,Vn,t("tbody",null,[t("tr",null,[t("th",$n,p(V.value),1),t("th",Nn,p(x.value),1),t("th",Ln,[f(ge,{modelValue:k.value,"onUpdate:modelValue":T[0]||(T[0]=$=>k.value=$),readonly:""},{default:Q(()=>[f(Z,{value:"BIRRANA"},{default:Q(()=>[_e("Birrana Gauge")]),_:1}),f(Z,{value:"CAT_GAUGE"},{default:Q(()=>[_e("CAT Gauge")]),_:1})]),_:1},8,["modelValue"])]),t("th",xn,[f(De,{modelValue:O.value,"onUpdate:modelValue":T[1]||(T[1]=$=>O.value=$),class:"mb-0",onKeypress:M,onFocusout:H},null,8,["modelValue"]),se(t("p",{class:"text-danger font-weight-bold"},p(n.value.pistonA.errorMessage),513),[[Ye,n.value.pistonA.isShowError]])]),t("th",Un,[f(De,{modelValue:B.value,"onUpdate:modelValue":T[2]||(T[2]=$=>B.value=$),class:"mb-0",onKeypress:M,onFocusout:F,disabled:O.value==""},null,8,["modelValue","disabled"]),se(t("p",{class:"text-danger font-weight-bold"},p(n.value.pistonB.errorMessage),513),[[Ye,n.value.pistonB.isShowError]])]),t("th",jn,[f(De,{modelValue:R.value,"onUpdate:modelValue":T[3]||(T[3]=$=>R.value=$),readonly:""},null,8,["modelValue"]),se(t("p",Bn,"Out of range",512),[[Ye,de.value]])]),t("th",Fn,p(g.value.uom),1),t("th",qn,p(g.value.pistonMovementRating?`${g.value.pistonMovementRating}%`:"-"),1),t("th",Kn,[t("div",Gn,[f(De,{modelValue:g.value.rating,"onUpdate:modelValue":T[4]||(T[4]=$=>g.value.rating=$),placeholder:"Rating",class:pe(d(g.value.rating)),disabled:"",readonly:""},null,8,["modelValue","class"])])]),t("th",Hn,[f(nt,{images:g.value.images,"is-mandatory":!1,onOnHandleImages:_},null,8,["images"])])])])])])):(c(),h("div",Jn,[t("div",zn,[Xn,m.value?(c(),h("div",Wn,[(c(!0),h(ie,null,we(i.value.historyModified.detail.history,($,ae)=>(c(),h("div",{key:ae,class:"row px-0 mx-0"},[t("div",Yn,[t("span",null,p(P($)),1)]),t("div",Qn,[t("span",null,p(A($)),1)]),t("div",Zn,[t("span",null,p(q($.items)),1)]),t("div",el,[t("span",null,p(J($.items)),1)]),t("div",tl,[t("span",null,p(I($.items)),1)]),t("div",al,[t("span",null,p(y($.items)),1)]),t("div",sl,[t("span",null,p(u($.items)),1)]),t("div",ol,[t("span",null,p(v($.items)),1)]),t("div",rl,[l.value&&$.cbmAdjustmentReplacementValue?(c(),Y(Zt,{key:0,item:U($),task:$},null,8,["item","task"])):(c(),Y(Et,{key:1,item:b($.items),task:$},null,8,["item","task"]))]),t("div",il,[f(vt,{item:D($),"is-updated-by-current-user":$.updatedBy.id==K(o).user.EmployeeId,onShowPreviewImages:je},null,8,["item","is-updated-by-current-user"])]),t("div",nl,p(i.value.historyModified.detail.history.length-1==ae?"IronForms":"IronPortal"),1),l.value&&$.cbmAdjustmentReplacementValue?(c(),h("div",ll,[t("div",ul,p($.cbmAdjustmentReplacementValue.updatedBy.name)+", "+p($.cbmAdjustmentReplacementValue.updatedDate),1)])):$.updatedBy.name?(c(),h("div",cl,[t("div",dl,p($.updatedBy.name)+", "+p($.updatedDate),1)])):W("",!0)]))),128))])):(c(),h("div",ml,"No Data Recorded"))])])),Ie.value?(c(),Y(wt,{key:2,type:"task","re-render":!1,images:G.value,"show-delete-button":!1,"is-mandatory":!1,visibility:Ie.value,"is-monitoring":!0,"show-mandatory-caption":!1,onOnClose:tt},null,8,["images","visibility"])):W("",!0)],64)}}}),hl=Ve(pl,[["__scopeId","data-v-3e6c1f90"]]),gl={class:"table table-bordered"},vl=t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"No"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Rating")])],-1),fl={scope:"row",class:"ps-3 align-middle"},yl={scope:"row",class:"align-middle"},bl={scope:"row",class:"align-middle"},_l={class:"input-eform-status"},Cl={class:"timestamp-task text-end m-auto px-3 pt-0 pb-3",colspan:"9"},Sl=le({__name:"CurrentConditionManTable",props:{itemService:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=dt({...s.itemService}),{rating:o}=mt(a);return qe(()=>s.itemService,r=>{Object.assign(a,r)},{deep:!0}),(r,i)=>{const l=X("el-input"),n=Ee("loading");return se((c(),h("table",gl,[vl,t("tbody",null,[t("tr",null,[t("th",fl,p(e.itemService.number),1),t("th",yl,p(e.itemService.text),1),t("th",bl,[t("div",_l,[f(l,{modelValue:K(o),"onUpdate:modelValue":i[0]||(i[0]=m=>Pe(o)?o.value=m:null),class:pe(`pe-3 ${e.itemService.color}`),disabled:""},null,8,["modelValue","class"])])])]),t("tr",null,[t("td",Cl,p(e.itemService.timestamp.name)+", "+p(e.itemService.timestamp.date),1)])])])),[[n,e.loading]])}}}),ra=e=>(Le("data-v-eab9e928"),e=e(),xe(),e),kl={class:"table table-bordered"},Il=ra(()=>t("caption",null,null,-1)),wl=ra(()=>t("thead",null,[t("tr",{style:{background:"#f4f6f8"}},[t("th",{scope:"col",class:"table-header ps-3"},"No"),t("th",{scope:"col",class:"table-header"},"Measurement Location"),t("th",{scope:"col",class:"table-header"},"Measurement Value"),t("th",{scope:"col",class:"table-header"},"UoM"),t("th",{scope:"col",class:"table-header"},"Status"),t("th",{scope:"col",class:"table-header"})])],-1)),El={key:0},Dl={scope:"row",class:"ps-3 align-middle"},Al={scope:"row",class:"align-middle"},Ml={scope:"row",class:"align-middle"},Pl={scope:"row",class:"align-middle"},Rl={scope:"row",class:"align-middle"},Ol={class:"px-0 py-0 mx-0 my-0 d-flex align-items-center"},Tl={scope:"row",class:"align-bottom"},Vl={key:0,class:"row px-0 mx-0"},$l={class:"pb-1 pt-0 my-0 timestamp-task text-end"},Nl=le({__name:"CurrentConditionSuspensionTable",props:{currentCondition:{type:Object,required:!0},loading:{type:Boolean}},setup(e){const s=e,a=o=>{let r="";switch(o){case"Out Spec":r="red";break;case"Out of spec":r="red";break;case"In spec":r="green";break}return r};return(o,r)=>{const i=X("el-input"),l=Ee("loading");return se((c(),h("table",kl,[Il,wl,e.currentCondition?(c(),h("tbody",El,[t("tr",null,[t("th",Dl,p(e.currentCondition.taskNo),1),t("th",Al,p(e.currentCondition.measurementLocation),1),t("th",Ml,[f(i,{modelValue:e.currentCondition.measurementValue,"onUpdate:modelValue":r[0]||(r[0]=n=>e.currentCondition.measurementValue=n),placeholder:"Measurement Value",class:"input-measurement_value",readonly:""},null,8,["modelValue"])]),t("th",Pl,p(e.currentCondition.uom),1),t("th",Rl,[t("div",Ol,[t("div",{class:pe(["little-box p-3 me-2",[a(e.currentCondition.rating)]])},null,2),_e(" "+p(e.currentCondition.rating),1)])]),t("th",Tl,[e.currentCondition.updatedBy.name?(c(),h("div",Vl,[t("div",$l,p(e.currentCondition.updatedBy.name)+", "+p(e.currentCondition.updatedDate),1)])):W("",!0)])])])):W("",!0)])),[[l,s.loading]])}}}),Ll=Ve(Nl,[["__scopeId","data-v-eab9e928"]]),Ue=e=>(Le("data-v-2ce7fc98"),e=e(),xe(),e),xl={key:0,class:"text-center py-10 my-10"},Ul={key:1},jl={class:"d-flex justify-content-between my-4"},Bl={class:"grey-box p-3"},Fl=Ue(()=>t("h5",null,"Work Order",-1)),ql={class:"grey-box p-3 mx-3"},Kl=Ue(()=>t("h5",null,"Asset Number",-1)),Gl={class:"grey-box p-3"},Hl=Ue(()=>t("h5",null,"Component",-1)),Jl={class:"my-4"},zl=Ue(()=>t("h3",{class:"my-7"},"Current Condition",-1)),Xl={key:6,class:"my-3"},Wl={key:7,class:"my-3"},Yl={key:8,class:"table table-bordered",style:{width:"500px"}},Ql=Ue(()=>t("caption",null,null,-1)),Zl=Ue(()=>t("thead",null,[t("tr",{style:{background:"#18af4a",color:"#fff"}},[t("th",{scope:"col",class:"table-header table-border-right-white ps-2"}," Rating "),t("th",{scope:"col",class:"table-header table-border-right-white"},"Value Min"),t("th",{scope:"col",class:"table-header table-border-right-white"},"Value Max"),t("th",{scope:"col",class:"table-header table-border-right-white"},"UoM")])],-1)),eu={scope:"row",class:"ps-2"},tu={scope:"row"},au={scope:"row"},su={scope:"row"},ou={key:9,class:"table table-bordered",style:{width:"500px"}},ru=Ue(()=>t("caption",null,null,-1)),iu=Ue(()=>t("thead",null,[t("tr",{style:{background:"#18af4a",color:"#fff"}},[t("th",{scope:"col",class:"table-header table-border-right-white ps-2"}," Rating "),t("th",{scope:"col",class:"table-header table-border-right-white"},"Value Min"),t("th",{scope:"col",class:"table-header table-border-right-white"},"Value Max"),t("th",{scope:"col",class:"table-header table-border-right-white"},"UoM")])],-1)),nu={scope:"row",class:"ps-2"},lu={scope:"row"},uu={scope:"row"},cu={scope:"row"},du=Ue(()=>t("h4",null,"Detailed Picture",-1)),mu=Ue(()=>t("span",null,"No Picture.",-1)),pu={key:1,class:"w-100 d-flex flex-wrap"},hu={key:0},gu={class:"bg-secondary cursor-pointer"},vu=["src","onClick","alt"],fu={class:"mt-20"},yu={class:"my-7"},bu={key:0,class:"dialog-footer"},_u={key:0,class:"dialog-footer"},Cu=le({__name:"Modal",props:{visibility:{type:Boolean,required:!1},type:{type:String,required:!0,default:"cbm"},workOrder:{type:String,required:!0},taskKey:{type:String,required:!0},assetNumber:{type:String,required:!0},component:{type:String,required:!0},sampleDate:{type:String,required:!0},source:{type:String,required:!1,default:"serviceSheet"}},emits:["onClose","onDelete","onDownloaded"],setup(e,{emit:s}){const a=e,o=s,r=et(),i=ye(),l=ht(),n=L(!1),m=L([]),g=Ze(a,"visibility"),w=L([]),V=L(0),P=L([]),x=L(!1),k=L(!1),O=S(()=>r.isUserCanRevise),B=S(()=>r.loading||k.value),R=S(()=>r.detailCbm),E=S(()=>R.value.component!=""?R.value.component:a.component),A=S(()=>r.isError),q=S(()=>{if(!R.value.detailSpec)return;const j=R.value.detailSpec.filter(z=>z.cbmType!="CBM_GAP");return Qe.orderBy(j,["uom","cbmRating","minValue"])}),J=S(()=>{if(!R.value.detailSpec)return;const j=R.value.detailSpec.filter(z=>z.cbmType=="CBM_GAP");return Qe.orderBy(j,["uom","cbmRating","minValue"])});S(()=>!!(R.value.beforeReplacementItems&&R.value.beforeReplacementItems[3].value));const I=S(()=>R.value&&R.value.currentCondition?R.value.currentCondition:{}),y=S(()=>R.value?R.value.historyModifiedDefault:[]),v=S(()=>{var j,z,oe;return y.value&&y.value[0].items[0].description=="Adjustment"&&R.value.historyModified!=null&&R.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue?{name:R.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue.updatedBy.name,date:R.value.historyModified.detail.history[0].cbmAdjustmentReplacementValue.updatedDate}:{name:((z=(j=I.value)==null?void 0:j.updatedBy)==null?void 0:z.name)||"",date:((oe=I.value)==null?void 0:oe.updatedDate)||""}}),u=S(()=>{var z,oe;let j="";return y.value&&(j=(z=y.value[0])==null?void 0:z.description.split(";")[0],y.value[0].description.split(";")[1]!=""&&(j+=(oe=y.value[0])==null?void 0:oe.description.split(";")[1])),I.value&&I.value.taskNo==""?j:I.value&&I.value.taskNo&&I.value.taskNo.replace(/[^a-z]/gi,"").length>1?I.value.taskNo.replace(";","").replace(/\D/g,""):I.value&&I.value.taskNo&&I.value.taskNo!=""&&I.value.taskNo.replace(/[^a-z]/gi,"").length<=1?I.value.taskNo.replace(";",""):""}),b=S(()=>{let j="";if(y.value)for(const z of y.value[0].items)z.itemType==="html"&&(j=z.value);return j!=""?j:I.value?I.value.measurementLocation:""}),U=S(()=>r.detailCbm.beforeReplacementItems!=null?r.detailCbm.beforeReplacementItems:[]),D=S(()=>r.isReplacementAdjustment?U.value[4].value:I.value.measurementValue),M=S(()=>r.isReplacementAdjustment?U.value[6].value:I.value.rating),d=S(()=>r.isReplacementAdjustment?{name:U.value[6].updatedBy.name,date:U.value[6].updatedDate}:v.value),_=S(()=>U.value&&U.value[3]?U.value[3].value:"-"),H=S(()=>({number:u.value,text:b.value,uom:I.value?I.value.uom:"",measurement:D.value,rating:M.value,timestamp:d.value,color:Ie(M.value),previousMeasurement:_.value,replacementMeasurement:I.value?I.value.measurementValue:"",replacementRating:I.value?I.value.rating:"",colorReplacementRating:Ie(I.value?I.value.rating:""),replacementTimestamp:v.value,isReplacementAdjustment:r.isReplacementAdjustment})),F=S(()=>{let j="";return y.value&&(j+=y.value[0].description.split(";")[1],j+=". ",j+=y.value[0].description.split(";")[2]),j!=""?j:I.value?I.value.measurementLocation:""}),de=S(()=>{let j="-";if(y.value)for(const z of y.value[0].items)z.categoryItemType==="previousParamRating"&&(j=z.value);return j}),Ce=S(()=>{let j="-";if(y.value)for(const z of y.value[0].items)z.categoryItemType==="previousTargetRating"&&(j=z.value?z.value:"-");return j}),he=S(()=>({number:u.value,text:F.value,uom:I.value?I.value.uom:"",measurement:D.value,rating:M.value,timestamp:d.value,color:Ie(M.value),previousMeasurement:de.value,previousRating:Ce.value,previousColor:Ce.value!="-"?Ie(Ce.value):""})),He=S(()=>({number:u.value,text:F.value,uom:I.value?I.value.pistonUom:"",tool:I.value?I.value.pistonTool:"",pistonAValue:I.value?I.value.pistonAValue:"",pistonBValue:I.value?I.value.pistonBValue:"",pistonResultValue:I.value?I.value.pistonResultValue:"",pistonPercentageValue:I.value?I.value.pistonPercentageValue:0,rating:I.value?I.value.pistonRating:"",timestamp:d.value,color:Ie(I.value?I.value.pistonRating:"")})),Ie=j=>j==null?void 0:j.toLocaleLowerCase(),G=S(()=>r.cbmType),tt=S(()=>[...r.cbmTypeAutomatic,...r.cbmTypeManual,"AVERAGE","CALIBRATION","AUTOMATIC_REPLACEMENT","AUTOMATIC_REPLACEMENT_GAP","AUTOMATIC_PREVIOUS_GROUP","OIL_COOLED","CALIPER"]),je=async()=>{k.value=!0,!A.value&&(r.stateEmployeeData={id:i.user.EmployeeId,name:i.user.Name},G.value=="MANUAL"||G.value=="NORMAL"?await r.updateTaskReviseManual(a.component,a.sampleDate,i.user.Name,a.source).then(()=>{A.value?Te(r.errors[0],"Ok"):C()}).catch(j=>{console.log(j),Te("Error when revising. Please check your input.","Ok")}):G.value=="AUTOMATIC"||G.value.includes("PREVIOUS")||G.value=="CALIPER"?await r.updateTaskReviseAutomatic(a.component,a.sampleDate,i.user.Name,a.source).then(()=>{A.value?Te(r.errors[0],"Ok"):C()}).catch(j=>{console.log(j),Te("Error when revising. Please check your input.","Ok")}):G.value=="AVERAGE"?(await r.updateTaskReviseAverage(),A.value?Te(r.errors[0],"Ok"):C()):G.value=="AUTOMATIC_REPLACEMENT"||G.value=="AUTOMATIC_REPLACEMENT_GAP"?await r.updateTaskReviseAutomaticReplacementAndGap(a.component,a.sampleDate,i.user.Name,a.source).then(()=>{A.value?Te(r.errors[0],"Ok"):C()}).catch(j=>{console.log(j),Te("Error when revising. Please check your input.","Ok")}):G.value=="OIL_COOLED"&&await r.updateTaskReviseOilCooled(a.component,a.sampleDate,i.user.Name,a.source).then(()=>{A.value?Te(r.errors[0],"Ok"):C()}).catch(j=>{console.log(j),Te("Error when revising. Please check your input.","Ok")}),k.value=!1)},C=()=>{da("Revision Successfully Submitted","Please allow up to 30 minutes for IronPortal to update visualisations.","Ok").then(()=>{$()})},T=j=>{l.setIsReplacementCamera(G.value==="AUTOMATIC_REPLACEMENT"||G.value==="AUTOMATIC_REPLACEMENT_GAP"),l.toggleIsVisible(!0,"modifiedCBM"),l.setShowCloseButton(j)},Z=L(""),ge=L(!1),De=j=>{var oe;if(m.value.length<1)return;let z;do z=(oe=m.value.find(N=>N.key==j))==null?void 0:oe.value;while(!z);return z},$=()=>{ae(),o("onClose")},ae=()=>{x.value=!1,n.value=!1,l.reset(),r.resetList(),r.resetErrors(),r.setInputErrorCbmAutomatic("",!1)},ue=()=>{if(G.value=="AVERAGE"&&r.initErrorInputCbmAverage(),Qe.get(R.value,"historyModified.detail.history.length",0)>=3){Te("Cannot revise the data, you have limit for revising 2 times.","Ok");return}n.value=!0,r.setModifiedObject(R)},$e=async()=>{r.stateIsError=!0;const j=ca();console.log(j.menu.allMenu);const z=j.menu.allMenu.findIndex(N=>N.MenuId==224);r.setIsUserCanRevise(z!=-1),await Ke(),console.log("📦 detailCbm.value",R.value);const oe=(G.value=="AUTOMATIC_REPLACEMENT"||G.value=="AUTOMATIC_REPLACEMENT_GAP")&&a.source=="serviceSheet"?R.value.replacementPhoto[0].items[2].value:R.value.detailedPicture;if(!oe){P.value=[];return}w.value=Array.apply(null,Array(oe)).map(function(){return!0}),V.value=0,m.value=[],console.log("📦 imagesFromCurrentCbm",oe),P.value=Array.isArray(oe)?Wt(oe):oe,console.log("📦 imageArray.value",P.value),await Be()},Ke=async()=>{const j={taskKey:a.taskKey,workOrder:a.workOrder,component:a.component||""};switch(r.setParamGetDetailCbm(j),a.source){case"interim":await r.getDetailCbmInterim();break;case"intervention":await r.getDetailIntervention();break;default:await r.getDetailCbm();break}},Be=async()=>{if(!(P.value&&P.value.length<1))for(const[j,z]of P.value.entries()){const oe=await r.getImage(z);oe&&(m.value.push({key:oe.key,value:oe.value}),P.value[j]={...P.value[j],imgBlob:oe.blob,url:De(P.value[j].filename)},w.value[j]=!1)}},Ae=L(),bt=j=>{const z=P.value.findIndex(N=>N.filename==j),oe=P.value[z];if(z>0){const N=P.value.slice(z),re=P.value.slice(0,z);Ae.value=[...N,...re]}else Ae.value=P.value;Z.value=oe.url,ge.value=!0},_t=()=>{Z.value="",ge.value=!1};return(j,z)=>{const oe=X("inline-svg"),N=X("el-empty"),re=X("el-skeleton-item"),ce=X("el-skeleton"),Se=X("el-alert"),Re=X("el-button"),me=X("el-dialog"),ee=Ee("loading");return c(),h(ie,null,[f(me,{modelValue:g.value,"onUpdate:modelValue":z[2]||(z[2]=te=>g.value=te),title:"Detailed Information",width:"80%",onOpen:$e,onClose:$},{footer:Q(()=>[O.value&&tt.value.includes(G.value)?se((c(),h("div",bu,[G.value!="CALIBRATION"?se((c(),h("div",_u,[f(Re,{onClick:$},{default:Q(()=>[_e("Cancel")]),_:1}),n.value?(c(),Y(Re,{key:0,disabled:A.value,onClick:je,type:"primary"},{default:Q(()=>[_e(" Submit ")]),_:1},8,["disabled"])):(c(),Y(Re,{key:1,onClick:ue,type:"primary"},{default:Q(()=>[_e("Revise")]),_:1}))])),[[ee,B.value]]):W("",!0)])),[[ee,B.value]]):W("",!0)]),default:Q(()=>[!tt.value.includes(G.value)&&!B.value?(c(),h("div",xl," Overwrite will be available soon ")):(c(),h("div",Ul,[t("div",jl,[se((c(),h("div",Bl,[Fl,t("span",null,p(R.value.workOrder),1)])),[[ee,B.value]]),se((c(),h("div",ql,[Kl,t("span",null,p(R.value.equipment),1)])),[[ee,B.value]]),se((c(),h("div",Gl,[Hl,t("span",null,p(E.value),1)])),[[ee,B.value]])]),t("div",Jl,[zl,I.value&&(G.value==="AUTOMATIC"||G.value.includes("PREVIOUS")||G.value==="AVERAGE")?(c(),Y(is,{key:0,"item-service":H.value,loading:B.value},null,8,["item-service","loading"])):I.value&&(G.value==="MANUAL"||G.value==="NORMAL")?(c(),Y(Sl,{key:1,"item-service":H.value,loading:B.value},null,8,["item-service","loading"])):G.value==="CALIBRATION"?(c(),Y(Ll,{key:2,currentCondition:I.value,loading:B.value},null,8,["currentCondition","loading"])):G.value==="AUTOMATIC_REPLACEMENT"||G.value==="AUTOMATIC_REPLACEMENT_GAP"?(c(),Y(Hs,{key:3,"item-service":H.value,loading:B.value},null,8,["item-service","loading"])):G.value==="OIL_COOLED"?(c(),Y(no,{key:4,"item-service":He.value,loading:B.value},null,8,["item-service","loading"])):W("",!0),I.value&&G.value==="CALIPER"?(c(),Y(ks,{key:5,"item-service":he.value,loading:B.value},null,8,["item-service","loading"])):W("",!0),G.value!="AUTOMATIC_REPLACEMENT_GAP"?(c(),h("h4",Xl,"Detail Spec")):(c(),h("h4",Wl,"Detail Spec Gap")),G.value!="AUTOMATIC_REPLACEMENT_GAP"?se((c(),h("table",Yl,[Ql,Zl,t("tbody",null,[(c(!0),h(ie,null,we(q.value,(te,Oe)=>(c(),h("tr",{key:Oe,class:pe(Oe%2==0?"even":"odd")},[t("th",eu,p(te.cbmRating),1),t("th",tu,p(te.minValueComplete),1),t("th",au,p(te.maxValueComplete),1),t("th",su,p(te.uom),1)],2))),128))])])),[[ee,B.value]]):se((c(),h("table",ou,[ru,iu,t("tbody",null,[(c(!0),h(ie,null,we(J.value,(te,Oe)=>(c(),h("tr",{key:Oe,class:pe(Oe%2==0?"even":"odd")},[t("th",nu,p(te.cbmRating),1),t("th",lu,p(te.minValueComplete),1),t("th",uu,p(te.maxValueComplete),1),t("th",cu,p(te.uom),1)],2))),128))])])),[[ee,B.value]]),du,se((c(),h("div",null,[!P.value||P.value.length===0?(c(),Y(N,{key:0},{image:Q(()=>[f(oe,{src:"/media/icons/bootstrap-icon/card-image.svg",width:"30",height:"30"})]),description:Q(()=>[mu]),_:1})):(c(),h("div",pu,[(c(!0),h(ie,null,we(P.value,(te,Oe)=>(c(),h("div",{key:te.filename,class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative"},[f(ce,{loading:w.value[Oe],animated:""},{template:Q(()=>[f(re,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},onClick:Je=>bt(te.filename),alt:te.filename},null,8,["onClick","alt"])]),default:Q(()=>[te.type&&(G.value==="AUTOMATIC_REPLACEMENT"||G.value==="AUTOMATIC_REPLACEMENT_GAP")?(c(),h("h4",hu,p(te.type),1)):W("",!0),t("div",gu,[t("img",{src:te.url,class:"w-100 rounded",style:{height:"200px","object-fit":"contain"},onClick:Je=>bt(te.filename),alt:te.filename},null,8,vu)])]),_:2},1032,["loading"])]))),128))]))])),[[ee,B.value]])]),se((c(),h("div",fu,[t("h3",yu,p(n.value?"Condition Modified":"History Modified"),1),R.value.historyModified&&R.value.historyModified.detail.history.length>=3?(c(),Y(Se,{key:0,title:"You have reached the maximum limit for revising 2 times.",type:"info","show-icon":"",closable:!1,class:"mb-10 alert-revise"})):W("",!0),G.value==="AUTOMATIC"||G.value.includes("PREVIOUS")||G.value==="CALIPER"?(c(),Y(yr,{key:1,"detail-cbm":R.value,"is-modifying":n.value,source:e.source},null,8,["detail-cbm","is-modifying","source"])):G.value==="MANUAL"||G.value==="NORMAL"?(c(),Y(_i,{key:2,"is-modifying":n.value,source:e.source},null,8,["is-modifying","source"])):G.value==="AVERAGE"?(c(),Y(Xr,{key:3,"is-modifying":n.value},null,8,["is-modifying"])):G.value==="CALIBRATION"?(c(),Y(Yi,{key:4,"is-modifying":n.value},null,8,["is-modifying"])):W("",!0),G.value==="AUTOMATIC_REPLACEMENT"||G.value==="AUTOMATIC_REPLACEMENT_GAP"?(c(),Y(Pn,{key:5,"is-modifying":n.value,"normal-formula":q.value,"gap-formula":J.value,"is-replacement":R.value.isReplacementAdjustment,onOpenCamera:z[0]||(z[0]=te=>T(te))},null,8,["is-modifying","normal-formula","gap-formula","is-replacement"])):W("",!0),G.value==="OIL_COOLED"?(c(),Y(hl,{key:6,"is-modifying":n.value,source:e.source,onOpenCamera:z[1]||(z[1]=te=>T(te))},null,8,["is-modifying","source"])):W("",!0)])),[[ee,B.value]])]))]),_:1},8,["modelValue"]),f(Ma,{images:Ae.value,visibility:ge.value,image:Z.value,onHandleClose:_t},null,8,["images","visibility","image"]),f(Aa,{visibility:K(l).isVisible},null,8,["visibility"])],64)}}}),Su=Ve(Cu,[["__scopeId","data-v-2ce7fc98"]]),ku={class:"row justify-content-center"},Iu=["onClick","disabled"],wu=le({__name:"Grid",props:["data","loading","loadingMapping"],emits:["showFormEdit"],setup(e,{emit:s}){const a=e,o=s,r=n=>n<2,i=n=>{console.log(n),o("showFormEdit",n)},l=()=>{o("showFormEdit",null)};return(n,m)=>{const g=X("el-button"),w=X("el-table-column"),V=X("inline-svg"),P=X("el-tooltip"),x=X("el-table"),k=Ee("loading");return c(),h(ie,null,[f(g,{disabled:a.loadingMapping,type:"primary",class:"mb-5",size:"small",onClick:l},{default:Q(()=>[_e(" Add New ")]),_:1},8,["disabled"]),se((c(),Y(x,{data:a.data,class:"table_dark-row table-dark","header-row-class-name":"table_dark-header","row-class-name":"table_dark-row text-white","element-loading-background":"#2d2b39b3"},{default:Q(()=>[f(w,{prop:"model",label:"Model"}),f(w,{prop:"replacementSmu",label:"SMU"}),f(w,{prop:"replacementDate",label:"Replacement Date"},{default:Q(O=>[t("span",null,p(K(Ia)(O.row.replacementDate)),1)]),_:1}),f(w,{label:"",width:"80"},{default:Q(O=>[f(P,{class:"box-item",effect:"dark",content:r(O.row.transactionCount)?"Edit":"Data has been edited twice",placement:"top"},{default:Q(()=>[t("div",ku,[t("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:B=>i(O.row),disabled:!r(O.row.transactionCount)},[f(V,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Iu)])]),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])),[[k,a.loading]])],64)}}}),Kt={site:"",model:"",equipment:"",component:"",Page:1,PageSize:1,ver:"v1"},Gt={componentReplacementId:0,site:"",model:"",equipment:"",component:"",componentAssignmentId:0,replacementDate:"",replacementSmu:0,hmoffset:0,frameHours:0,transactionCount:0},Eu=Tt({id:"componentReplacement",state:()=>({stateGetParam:Kt,stateComponentReplacementList:[],stateFormEdit:{...Gt},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateLoadingMapping:!1,stateHmoffsetDefault:0,stateHmOffsetOption:[]}),getters:{componentReplacementList:e=>e.stateComponentReplacementList,formEdit:e=>e.stateFormEdit,loading:e=>e.stateLoading,loadingMapping:e=>e.stateLoadingMapping,hmoffsetDefault:e=>e.stateHmoffsetDefault,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError},actions:{async getAndSetComponentReplacementMapping(e,s){const a={equipment:e,component:s,ver:"v1"};try{this.stateLoadingMapping=!0,this.stateLoading=!0;const o=await ne.get(Fa,"",new URLSearchParams(a).toString());this.setParam(o.data.result.content)}catch(o){fe("IRONS",o),console.log(o)}finally{this.stateLoadingMapping=!1,this.stateLoading=!1}},async getComponentReplacementList(){const e={site:this.stateGetParam.site||"",model:this.stateGetParam.model||"",equipment:this.stateGetParam.equipment||"",component:this.stateGetParam.component||"",Page:this.stateGetParam.Page.toString(),PageSize:this.stateGetParam.PageSize.toString(),ver:"v1"};try{this.stateLoading=!0;const s=await ne.get(qa,"",new URLSearchParams(e).toString());this.stateComponentReplacementList=s.data.result.content}catch(s){fe("IRONS",s),console.log(s)}finally{this.stateLoading=!1}},async getHmOffset(e,s){const a={equipment:e,ver:"v1"};try{this.stateLoading=!0;const o=await ne.get(Ka,"",new URLSearchParams(a).toString());this.stateHmoffsetDefault=o.data.result.content.hmoffset||0,s||(this.stateFormEdit.frameHours=this.stateHmoffsetDefault)}catch(o){fe("IRONS",o),console.log(o)}finally{this.stateLoading=!1}},async updateData(e){try{this.stateLoading=!0;const s={userAccount:e,ver:"v1"},a={componentReplacementId:this.stateFormEdit.componentReplacementId,site:this.stateFormEdit.site,model:this.stateFormEdit.model,equipment:this.stateFormEdit.equipment,component:this.stateFormEdit.component,componentAssignmentId:this.stateFormEdit.componentAssignmentId,replacementDate:Pt(Rt(new Date(this.stateFormEdit.replacementDate))),replacementSmu:this.stateFormEdit.replacementSmu,hmoffset:this.stateFormEdit.hmoffset,frameHours:this.stateFormEdit.frameHours,transactionCount:this.stateFormEdit.transactionCount},o=await ne.post(`${Ga}?${new URLSearchParams(s).toString()}`,a);o.data.title==="Error"?(this.stateErrors.push(o.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&ye().setLoggedIn(!1),this.stateError=s,fe("IRONS",s),console.log(s),this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0}finally{this.stateLoading=!1}},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},setParam(e){this.stateGetParam.site=e.site,this.stateGetParam.model=e.model,this.stateGetParam.equipment=e.equipment,this.stateGetParam.component=e.component},setFormEditFromGetParam(){this.stateFormEdit.site=this.stateGetParam.site,this.stateFormEdit.model=this.stateGetParam.model,this.stateFormEdit.equipment=this.stateGetParam.equipment,this.stateFormEdit.component=this.stateGetParam.component},setFormEditFromRow(e){this.stateFormEdit.componentReplacementId=e.componentReplacementId,this.stateFormEdit.site=e.site,this.stateFormEdit.model=e.model,this.stateFormEdit.equipment=e.equipment,this.stateFormEdit.component=e.component,this.stateFormEdit.componentAssignmentId=e.componentAssignmentId,this.stateFormEdit.replacementDate=e.replacementDate,this.stateFormEdit.replacementSmu=e.replacementSmu,this.stateFormEdit.hmoffset=e.hmoffset,this.stateFormEdit.frameHours=e.frameHours,this.stateFormEdit.transactionCount=e.transactionCount},resetParam(){this.stateGetParam={...Kt}},resetFormEdit(){this.stateFormEdit={...Gt}},resetList(){this.stateComponentReplacementList=[]},resetErrors(){this.stateErrors=[],this.stateIsError=!1}}}),Du={key:0},Au={key:1,class:"form-component_replacement"},Mu={class:"px-8 py-10","element-loading-background":"#2d2b39b3"},Pu={key:0,class:"dialog-footer"},Ru=le({__name:"Modal",props:{visibility:{type:Boolean,required:!1},equipment:{type:String,required:!0},component:{type:String,required:!0}},emits:["onClose"],setup(e,{emit:s}){const a=e,o=s,r=L(!1),i=ye(),l=Eu(),n=S(()=>l.loading),m=S(()=>l.loadingMapping),g=S(()=>l.hmoffsetDefault),w=S(()=>l.formEdit),V=S(()=>l.componentReplacementList),P=S(()=>l.errors),x=S(()=>l.isError),k=Na().shape({replacementDate:La().required("Replacement Date is mandatory").typeError("Replacement Date is mandatory"),replacementSmu:xa().required("Replacement SMU is mandatory").typeError("Replacement SMU is mandatory")}),O=async u=>{l.resetFormEdit(),u?l.setFormEditFromRow(u):l.setFormEditFromGetParam(),await l.getHmOffset(w.value.equipment,!!u),r.value=!0},B=u=>{w.value.replacementDate=u},R=u=>{w.value.replacementSmu=u,w.value.frameHours=(parseInt(u)||0)+g.value},E=async()=>{if(A(),await k.validate(w.value,{abortEarly:!1}).catch(u=>{l.setErrors(u.errors)}),!x.value)try{await l.updateData(i.user.Name).then(()=>{if(!l.isError)ma("Please wait 30 minutes for the dashboard to update this change","Component Replacement has been logged in IronPortal!"),l.resetFormEdit(),r.value=!1;else{l.setErrors(l.errors);return}}),await l.getComponentReplacementList()}catch(u){console.log(u),l.setErrors(["There is something wrong. Please try again"])}},A=()=>{l.setErrors([])},q=()=>{l.resetFormEdit(),l.resetErrors(),r.value=!1},J=async()=>{await l.getAndSetComponentReplacementMapping(a.equipment,a.component),await l.getComponentReplacementList()},I=()=>{r.value=!1,l.resetFormEdit(),l.resetParam(),l.resetList(),l.resetErrors()},y=()=>{I(),o("onClose")},v=Ze(a,"visibility");return(u,b)=>{const U=X("el-col"),D=X("el-row"),M=X("el-button"),d=X("el-dialog"),_=Ee("loading");return c(),Y(d,{modelValue:v.value,"onUpdate:modelValue":b[0]||(b[0]=H=>v.value=H),"modal-class":"modal-component_replacement",title:"Component Replacement",width:"50%",onOpen:J,onClose:y},{footer:Q(()=>[r.value?(c(),h("div",Pu,[f(M,{onClick:q,disabled:n.value},{default:Q(()=>[_e("Cancel")]),_:1},8,["disabled"]),f(M,{type:"primary",onClick:E,disabled:n.value},{default:Q(()=>[_e(p(w.value.componentReplacementId==0?"Add":"Save"),1)]),_:1},8,["disabled"])])):W("",!0)]),default:Q(()=>[r.value?(c(),h("div",Au,[se((c(),h("div",Mu,[f(D,{gutter:50},{default:Q(()=>[f(U,{span:12},{default:Q(()=>[f(ct,{labelClass:"text-white",value:w.value.site,label:"Site",name:"Site",disabled:!0},null,8,["value"]),f(ct,{labelClass:"text-white",value:w.value.equipment,label:"Equipment",name:"Equipment",disabled:!0},null,8,["value"]),f(ja,{class:"custom-text-input",labelClass:"text-white",value:w.value.replacementDate,label:"Replacement Date",name:"ReplacementDate","format-date":"DD/MM/YYYY",onHandleChange:B},null,8,["value"]),f(ct,{labelClass:"text-white",value:w.value.frameHours,label:"Frame Hours",name:"FrameHours",disabled:!0},null,8,["value"])]),_:1}),f(U,{span:12},{default:Q(()=>[f(ct,{labelClass:"text-white",value:w.value.model,label:"Model",name:"Model",disabled:!0},null,8,["value"]),f(ct,{labelClass:"text-white",value:w.value.component,label:"Component",name:"Component",disabled:!0},null,8,["value"]),f(Ua,{labelClass:"text-white",value:w.value.replacementSmu,label:"Replacement SMU",name:"ReplacementSmu",onHandleChange:R},null,8,["value"])]),_:1})]),_:1})])),[[_,n.value]])])):(c(),h("div",Du,[f(wu,{data:V.value,loading:n.value,loadingMapping:m.value,onShowFormEdit:O},null,8,["data","loading","loadingMapping"])])),f(ya,{name:"fade"},{default:Q(()=>[x.value?(c(),Y(Ba,{key:0,errorMessages:P.value,onResetForm:A},null,8,["errorMessages"])):W("",!0)]),_:1})]),_:1},8,["modelValue"])}}}),Ou={class:"text-bold"},Tu={key:0,"element-loading-background":"#2d2b39b3","element-loading-text":"Loading",class:"mb-5 py-10"},Vu=le({__name:"SensorList",props:{listData:{required:!0,type:Array},reRender:{default:!1},selectAll:{type:Boolean,required:!0},lastPage:{type:Number,required:!0},currentPage:{type:Number,required:!0},tableHeight:{type:Number,required:!0}},emits:["infiniteScroll_lastDataSearch","changeSelectAll"],setup(e,{emit:s}){const a=s,o=e,r=Vt(),i=L(),l=async k=>{r.updateSensorDataList(k)},n=Yt.debounce(k=>{console.log("emit debounce"),a("infiniteScroll_lastDataSearch",k)},1e3),m=S(()=>{const k=i.value;return k?k.$el.querySelector(".el-table__body-wrapper"):void 0}),g=S(()=>r.loadingSensor),w=()=>{const k=m.value;console.log("scrollableEl",k),k&&k.addEventListener("scroll",O=>{if(console.log(k.scrollHeight,k.scrollTop),k.scrollHeight-k.scrollTop<=500){n("next");return}})},V=k=>{a("changeSelectAll",k.length>0)},P=()=>{if(o.listData.length>0){const k=o.listData.filter(O=>O.isCheck==!0);k.length==o.listData.length&&a("changeSelectAll",!0),k.forEach(O=>{i.value.toggleRowSelection(O,!0)})}else console.log("ELSE CLEAR SELECTION"),i.value.clearSelection(),a("changeSelectAll",!1)};qe(()=>o.reRender===!0,()=>{P()});const x=k=>{if(k=="A")return"background: #54D62C;";if(k=="B")return"background: blue;";if(k=="C")return"background: orange;";if(k=="X")return"background: #FF4842;"};return pt(()=>{const k=m.value;k&&k.addEventListener("scroll",w)}),Ot(()=>{const k=m.value;k&&k.removeEventListener("scroll",w)}),(k,O)=>{const B=Ee("loading");return se((c(),Y(K(Ha),{ref_key:"tableSensorListRef",ref:i,data:o.listData,"element-loading-background":"#2d2b39b3","empty-text":"No Data",height:"320",class:"table-row table-dark sensor-table","header-row-class-name":"table-header","row-class-name":"table-row text-white",onSelectionChange:l,onSelectAll:V,"row-key":"sensorId","select-on-indeterminate":""},{append:Q(()=>[o.currentPage!=o.lastPage&&o.listData.length>0?se((c(),h("div",Tu,null,512)),[[B,!0]]):W("",!0)]),default:Q(()=>[f(K(Ne),{prop:"componentName",label:"Component","min-width":"125"}),f(K(Ne),{prop:"sensorParameter",label:"Sensor Parameter","min-width":"125"}),f(K(Ne),{prop:"occurence",label:"Occurence",align:"center","min-width":"100"}),f(K(Ne),{prop:"aggregate",label:"Agregate",align:"center"}),f(K(Ne),{prop:"uom",label:"UoM",align:"center"}),f(K(Ne),{prop:"value",label:"Value",align:"center"}),f(K(Ne),{prop:"rating",label:"Rating",align:"center"},{default:Q(R=>[t("div",{style:ba(x(R.row.rating))},[t("span",Ou,p(R.row.rating),1)],4)]),_:1}),f(K(Ne),{prop:"cautionThreshold",label:"Caution Threshold",align:"center"}),f(K(Ne),{prop:"criticalThreshold",label:"Critical Threshold",align:"center"}),f(K(Ne),{"reserve-selection":"",class:"table-selection","class-name":"table-selection",type:"selection",align:"center"})]),_:1},8,["data"])),[[B,g.value&&o.listData.length==0]])}}}),$t=e=>(Le("data-v-414f1348"),e=e(),xe(),e),$u={class:"w-95 mx-auto section-summary-intervantion"},Nu={class:"div-dark-rounded my-3 pt-5 px-10"},Lu={class:"d-flex align-items-top mt-3"},xu=$t(()=>t("p",{class:"text-white w-5 me-3"}," Filter by: ",-1)),Uu={class:"div-dark-rounded py-7 px-10 w-100 d-flex align-items-start flex-column",style:{"flex-grow":"1",height:"100%"}},ju=$t(()=>t("h3",{class:"text-white mb-3"},"Summary Caution & Critical List",-1)),Bu=$t(()=>t("h4",{class:"text-white"},"Sensor",-1)),Fu={class:"d-flex justify-content-end mt-3 mt-auto w-100"},qu=le({__name:"Index",emits:["onBack","onSubmitSummaryIntervention"],setup(e,{emit:s}){const a=S({get(){return i.rerenderSensorList},set(v){i.setReRenderSensorSelection(v)}}),o=s,r=ye(),i=Vt(),l=S(()=>i.isSensorSelectAll),n=S(()=>i.filter),m=S(()=>i.filterLoading),g=S(()=>i.sensorDataList),w=S(()=>i.sensorDataLastPage),V=S(()=>i.sensorDataCurrentPage),P=S(()=>i.isError),x=S(()=>i.errors),k=v=>{i.getSensorDataListPaginate(v)},O=async v=>{n.value.site=v,sessionStorage.setItem("IronPortalDashboardFilter-Site",JSON.stringify([v])),v!=""&&await i.getModelLookup(),await B("")},B=async v=>{n.value.model=v,sessionStorage.setItem("IronPortalDashboardFilter-Model",JSON.stringify([v])),v!=""&&await i.getEquipmentLookup(),await R("")},R=async v=>{n.value.equipment=v,sessionStorage.setItem("IronPortalDashboardFilter-Equipment",JSON.stringify([v])),v!=""&&await i.getComponentLookup(),await E([])},E=v=>{console.log(v);let u=[];v.length==0&&n.value.equipment!=""?u=["All"]:(v.includes("All")&&v.splice(0,1),u=v),i.setFilterComponent(u),sessionStorage.setItem("IronPortalDashboardFilter-Component",JSON.stringify(v.length!=0?u:[])),i.setIsSensorSelectAll(!1),a.value=!1,i.resetList(),a.value=!0,n.value.site!=""&&n.value.model!=""&&n.value.equipment!=""&&n.value.component.length>0&&A()},A=Yt.debounce(()=>{i.getSensorDataListPaginate()},1500),q=()=>{o("onBack")},J=async()=>{pa("Are you sure you want to submit?").then(async v=>{v.isConfirmed&&i.updateIntervention(r.user.Name).then(()=>{P.value?Te(x.value[0],"OK",!1):ha("Form has been successfully submitted!","OK").then(()=>{o("onSubmitSummaryIntervention")})})})},I=v=>{const u=sessionStorage.getItem(v);return u?JSON.parse(u):[]},y=v=>{const u=sessionStorage.getItem(v);return u&&u.length>0?JSON.parse(u)[0]:""};return zt(async()=>{const v=y("IronPortalDashboardFilter-Site"),u=y("IronPortalDashboardFilter-Model"),b=y("IronPortalDashboardFilter-Equipment"),U=I("IronPortalDashboardFilter-Component");v&&await O(v),u&&await B(u),b&&await R(b),U&&await E(U)}),(v,u)=>{const b=X("inline-svg"),U=X("el-button"),D=Ee("loading");return c(),h("div",$u,[t("div",Nu,[f(U,{text:"",class:"dark-btn",onClick:q},{default:Q(()=>[f(b,{src:"/media/icons/bootstrap-icon/arrow-left-short.svg",width:"36",height:"36",fill:"white"}),_e(" Back to Component Condition Summary (Medium-Long Term) Item selected ")]),_:1}),t("div",Lu,[xu,f(St,{class:"custom-text-input me-3 w-15",value:n.value.site,isLoading:m.value.site,placeholder:"Select Site",name:"Site",max:200,onHandleChange:O,options:K(i).siteOption},null,8,["value","isLoading","options"]),f(St,{class:"custom-text-input me-3 w-15",value:n.value.model,isLoading:m.value.model,placeholder:"Select Equipment Model",name:"EquipmentModel",max:200,onHandleChange:B,"is-disabled":!n.value.site,options:K(i).modelOption},null,8,["value","isLoading","is-disabled","options"]),f(St,{class:"custom-text-input me-3 w-15",value:n.value.equipment,isLoading:m.value.equipment,placeholder:"Select Equipment Number",name:"EquipmentNumber",max:200,onHandleChange:R,"is-disabled":!n.value.model,options:K(i).equipmentOption},null,8,["value","isLoading","is-disabled","options"]),f(St,{class:"custom-text-input me-3 w-50",value:n.value.component,isLoading:m.value.component,placeholder:"Select Component",name:"Component",max:200,isMultiple:!0,onHandleChange:E,"is-disabled":!n.value.equipment,options:K(i).componentOption},null,8,["value","isLoading","is-disabled","options"])])]),t("div",Uu,[ju,Bu,f(Vu,{reRender:a.value,listData:g.value,selectAll:l.value,lastPage:w.value,currentPage:V.value,onInfiniteScroll_lastDataSearch:k,onChangeSelectAll:u[0]||(u[0]=M=>K(i).setIsSensorSelectAll(M))},null,8,["reRender","listData","selectAll","lastPage","currentPage"]),t("div",Fu,[se((c(),Y(U,{disabled:g.value.length==0,onClick:J,type:"success"},{default:Q(()=>[_e(" Submit for Intervention Form ")]),_:1},8,["disabled"])),[[D,K(i).loadingUpdate]])])])])}}}),Ku=Ve(qu,[["__scopeId","data-v-414f1348"]]);function Gu(){return{getDataSelection:(s,a)=>{const o=s.toLowerCase();if(a.length<1)return[""];const r=[""];return o=="engine"?r[0]=Ht(a,"Blow-By Press Max")?"Blow-By Press Max":a[0]:o=="transmission"?r[0]=Ht(a,"Trn Slip Gear Change: 2-3 Ave")?"Trn Slip Gear Change: 2-3 Ave":a[0]:r[0]=a[0],console.log(r),r}}}const Ht=(e,s)=>!!e.find(o=>o==s),Hu=async e=>{const s=[];try{(await e.bookmarksManager.getBookmarks()).forEach(function(o){s.push({key:o.displayName,value:o.name})})}catch(a){console.log("get bookmark failed",a)}return s},Ju=(e,s,a,o)=>{let r="";if(!a.includes(s))return r;const i=o[0].identity;if(Array.isArray(i)&&i.length>2){const l=i[0].equals.replaceAll(" ",""),n=i[2].equals,m=`${l}_${n}`,g=e.find(w=>w.key==m);g&&(r=g.value)}return r},Jt=(e,s)=>{let a="";const o=s.find(r=>r.key==e);return o&&(a=o.value),a},zu={"element-loading-background":"#2d2b39b3",style:{height:"90vh"}},Xu=5,Wu=3e5,Yu=le({__name:"PbiReportEquipment",props:["reportName","visibletab","isPublic","pbiReportId","pbiWorkspaceId","isHideVisualHeaders","isTransparent","filterEquipment"],emits:["handle-click"],setup(e,{emit:s}){const{getDataSelection:a}=Gu(),o=e,r=Xt(),i=ye(),l=Vt(),n=L(""),m=L(""),g=L(""),w=L(""),V=L(""),P=L("serviceSheet"),x=L(!1),k=L([]),O=L([]),B=L(),R=L(0),E=L(""),A=L(!0),q=L(!1),J=L(!1),I=L(!1),y=L({site:"",component:"",model:"",equipment:""}),v=L(!1);let u;const b=[{slicerTitle:"Parameter OMS site",column:"site_description",table:"vw_dim_site",btnClearTitles:["clear_site"],sessionStorageName:"IronPortalDashboardFilter-Site"},{slicerTitle:"Parameter OMS model unit",column:"model_unit",table:"vw_dim_equipment",btnClearTitles:["clear_model"],sessionStorageName:"IronPortalDashboardFilter-Model"},{slicerTitle:"Parameter OMS equipment",column:"equipment",table:"vw_dim_equipment",btnClearTitles:["clear_equipment"],sessionStorageName:"IronPortalDashboardFilter-Equipment"},{slicerTitle:"Parameter OMS component name",column:"component_name",table:"vw_dim_component",btnClearTitles:["clear_component"],sessionStorageName:"IronPortalDashboardFilter-Component"},{slicerTitle:"Group_Parameter",column:"sample_group",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Group_Parameter"},{slicerTitle:"Parameter",column:"parameter_to",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Parameter"},{slicerTitle:"Time_Slicer",column:"Sranking",table:"vw_b0_pm_ehms_oms_3dphornet_map",btnClearTitles:[],sessionStorageName:"IronPortalDashboardFilter_Map-Time_Slicer"}],U=["S1_exportPDF","S2_exportPDF","S3_exportPDF","S4_exportPDF","S5_exportPDF","S6_exportPDF","S7_exportPDF","S8_exportPDF"],D=["btn_s1_back","btn_s2_back","btn_s3_back","btn_s4_back","btn_s5_back","btn_s6_back","btn_s7_back","btn_s8_back"],M=S(()=>r.getIsDashboardConfigLoading),d=S(()=>r.getDashboardConfigPbi),_=()=>{const $={type:"report",tokenType:We.models.TokenType.Embed||"",accessToken:d.value.embedToken.token||"",embedUrl:d.value.embedReport[0].embedUrl||"",id:d.value.embedReport[0].reportId||"",permissions:We.models.Permissions.All,settings:{panes:{filters:{visible:!1},pageNavigation:{visible:typeof o.visibletab>"u"?!0:o.visibletab}}}};if(o.isTransparent&&($.settings.background=We.models.BackgroundType.Transparent),sessionStorage.getItem("PbiEquipment_DetailInfo")=="true"){const ae=sessionStorage.getItem("PbiEquipment-Page_Map_Fullscreen");$.pageName=ae||"ReportSectiond46a3f7350de24c93ad7"}return $},H=$=>{switch($){case"Parameter OMS component name":return!0;case"Parameter OMS equipment":return!0;case"Parameter OMS model unit":return!0;case"Parameter OMS site":return!0;default:return!1}},F=L("S1"),de=()=>{try{if(typeof d.value<"u"){const $=_();let ae=new We.service.Service(We.factories.hpmFactory,We.factories.wpmpFactory,We.factories.routerFactory);B.value&&(u=ae.embed(B.value,$)),u.off("loaded"),u.on("loaded",async()=>{O.value=await Hu(u);let ue=[],$e=[];await u.getPages().then(N=>{ue=N}).catch(N=>{console.log("error get pages",N)}),await ue.find(N=>N.isActive).getVisuals().then(N=>{$e=N}).catch(N=>{console.log("error get visuals",N)});const Be=await Da(i.user.EmployeeId);if(Be&&Be!=="AU02"){const N={$schema:"http://powerbi.com/product/schema#basic",target:{table:b[0].table,column:b[0].column},operator:"In",values:[i.user.Location]};let re;re=document.getElementById("equimentContainer"),u=ae.get(re);try{await u.setFilters([N])}catch(ce){console.log(ce)}}const Ae=Ce(b[0].sessionStorageName);E.value=Be=="AU02"?"Blackwater":i.user.Location;const bt=[E.value],_t=Ae&&Ae.length>0?Ae:bt,j={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[..._t],target:{table:b[0].table,column:b[0].column},filterType:1,requireSingleSelection:!0}]};let z=$e.filter(N=>N.type==="slicer"&&N.title==="Parameter OMS site")[0];try{Be!=="AU02"&&(await z.setSlicerState(j),console.log("success set slicer site"))}catch(N){console.log(N)}je(b[0].slicerTitle,"In",[..._t],[]);const oe=async N=>{let re=$e.filter(ce=>ce.title==="slicer data trend")[0];try{let ce=await re.exportData();ce=Nt(ce?ce.data:"");const Se={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[...a(N,ce)],target:{table:"vw_b0_pm_ehms_omsstatus",column:"parameter_to"},filterType:1,requireSingleSelection:!0}]};await re.setSlicerState(Se),console.log("success set slicer data trend")}catch(ce){console.error("error set slicer data trend",ce)}};u.off("bookmarkApplied"),u.on("bookmarkApplied",async N=>{if(console.log(`Event - bookmarkApplied:
`,N.detail),N.detail.bookmarkName=="Bookmarka04d85905eb7cbd75ae4"){const re=he(b[3].sessionStorageName);await oe(re)}}),u.off("dataSelected"),u.on("dataSelected",async function(N){var ee,te,Oe,Je;console.log("event.detail",N.detail);let re=N.detail;const ce=re.dataPoints,Se=["matrix_condition_summary","Matrix_3dp&vims"];try{J.value=!0;const ve=Ju(O.value,re.visual.title,Se,ce);if(ve){ce[0].values.length!=0&&(F.value=ce[0].values[2].value),await u.bookmarksManager.apply(ve);return}}catch(ve){console.log(ve)}finally{J.value=!1}if(N.detail.visual.title=="Matrix_3dp&vims"){const ve="ReportSectione5ba9be2aabce8d119d9";try{let be=await(await ue.find(Xe=>Xe.displayName==="Detail Information").getVisuals()).find(Xe=>Xe.title==="hide_ranking").exportData();const Fe=Lt(be.data);await u.setPage(ve);const ze=await ue.find(Xe=>Xe.displayName==="Pop-up Chart").getVisuals();if(ze){let Xe=ze.find(Dt=>Dt.title==="parameter_slicer"),ia=ze.find(Dt=>Dt.title==="ranking_slicer");const na={filters:[{$schema:"http://powerbi.com/product/schema#basic",target:{table:"vw_b0_pm_ehms_oms_3dphornet_map",column:"parameter_to"},filterType:1,operator:"In",values:[Fe[1]],requireSingleSelection:!1}]};await Xe.setSlicerState(na),console.log("Succes set slicer param");const la={filters:[{$schema:"http://powerbi.com/product/schema#basic",target:{table:"vw_b0_pm_ehms_oms_3dphornet_map",column:"sample_ranking"},filterType:1,operator:"In",values:[Fe[0]],requireSingleSelection:!1}]};await ia.setSlicerState(la),console.log("Succes set slicer ranking")}}catch(ke){console.log(ke)}}if(re.visual.title==="ironforms_matrix"&&ce.length>0){x.value=!1;try{w.value=(ee=ce[0].values)==null?void 0:ee.find(ke=>ke.target.column==="task_key").formattedValue,g.value=(te=ce[0].values)==null?void 0:te.find(ke=>ke.target.column==="work_order").formattedValue,V.value=(Oe=ce[0].values)==null?void 0:Oe.find(ke=>ke.target.column==="sample_date").value,((Je=ce[0].values)==null?void 0:Je.find(ke=>ke.target.column==="sample_type_from").value)=="INTERVENTION"?P.value="intervention":P.value="serviceSheet",n.value=he(b[2].sessionStorageName),m.value=he(b[3].sessionStorageName),ge()}catch(ve){k.value=[],console.error("error get image",ve)}}if(re.visual.title=="matrix_condition_summary"&&ce.length>0){x.value=!1;try{const Me=await(await(await u.getActivePage()).getVisuals()).filter(Fe=>Fe.title==="wo_taskkey_matrix")[0].exportData(),be=Lt(Me.data);if(be.length<6)return;w.value=be[1],g.value=be[2],V.value=new Date(be[4]),be[3]=="INTERIM"?P.value="interim":be[3]=="INTERVENTION"?P.value="intervention":P.value="serviceSheet",n.value=he(b[2].sessionStorageName),m.value=he(b[3].sessionStorageName),ge()}catch(ve){k.value=[],console.error("error get image",ve)}}const me=["Parameter OMS site","Parameter OMS model unit","Parameter OMS equipment","Parameter OMS component name","Group_Parameter","Time_Slicer"].includes(re.visual.title);if(re.visual.type=="slicer")try{if(J.value=!0,q.value){q.value=!1;const be=Jt(`IronFormsCBM_${F.value}`,O.value);if(be)try{await u.bookmarksManager.apply(be)}catch(Fe){console.log(Fe)}}let lt=(await(await u.getActivePage()).getVisuals()).filter(be=>be.type==="slicer"&&be.title===re.visual.title)[0];const Me=await lt.getSlicerState();if(Me){let be=[],Fe="",ut=[];if(Me.filters.length>0){ut=me?[Me.filters[0].values[Me.filters[0].values.length-1]]:Me.filters[0].values,Fe=Me.filters[0].operator;const ze={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:ut,target:{table:Me.filters[0].target.table,column:Me.filters[0].target.column},filterType:1,requireSingleSelection:!me}]};await lt.setSlicerState(ze)}if(ut.length==0||Me.filters[0].operator=="NotIn"){let ze=await lt.exportData();be=Nt(ze.data)}je(re.visual.title,Fe,ut,be)}}catch(ve){console.log(ve)}finally{J.value=!1}if(H(re.visual.title)&&!sessionStorage.getItem("PbiEquipment_DetailInfo")){const ve=he(b[3].sessionStorageName);await oe(ve)}if(re.visual.title=="table_intervention"){if(N.detail.dataPoints.length==0)return;const ve={keyPbi:N.detail.dataPoints[0].identity[0].equals};try{sessionStorage.setItem("formFilter",JSON.stringify(ve)),C("#/ironportal-dashboard/intervention","intervention")}catch(ke){console.log(ke)}}}),u.off("buttonClicked"),u.on("buttonClicked",async N=>{var Se,Re;if(console.log(N.detail),N.detail.title=="IF_graph_s1")q.value=!0;else if(N.detail.title=="IF_table_s1"){q.value=!1;const me=Jt(`IronFormsCBM_${F.value}`,O.value);if(me)try{await u.bookmarksManager.apply(me)}catch(ee){console.log(ee)}}if(U.includes(N.detail.title)){tt();return}if(N.detail.title=="btn_back_equipment"){sessionStorage.removeItem("PbiEquipment_DetailInfo");return}if(N.detail.title.includes("fullscreen")){const me=ue.filter(ee=>ee.displayName==`S${N.detail.title[1]}_Map`)[0];sessionStorage.setItem("PbiEquipment-Page_Map_Fullscreen",me.name);try{await me.setActive(),console.log(`succes set S${N.detail.title[1]}_Map`)}catch(ee){console.log(ee)}return}if(D.includes(N.detail.title)){sessionStorage.removeItem("PbiEquipment-Page_Map_Fullscreen");return}if(N.detail.title=="component_replacement"){y.value.equipment=he(b[2].sessionStorageName),y.value.component=he(b[3].sessionStorageName),y.value.equipment&&y.value.component?I.value=!0:ga("Please select Equipment and Component first","Ok");return}if(N.detail.title=="summary_intervention"){localStorage.setItem("PbiEquipment_ShowPbi","false"),C("#/ironportal-dashboard/equipment","summary intervention");return}if(N.detail.title=="detail information"){localStorage.setItem("PbiEquipment_DetailInfo","true"),C("#/ironportal-dashboard/equipment","detail information");return}if(!((Se=N.detail.title)!=null&&Se.includes("clear"))&&!((Re=N.detail.title)!=null&&Re.includes("clr")))return;const re=b.findIndex(me=>{var ee;return(ee=me.btnClearTitles)==null?void 0:ee.includes(N.detail.title)});if(re==-1)return;for(let me=re;me<b.length;me++){const ee=b[me];je(ee.slicerTitle,"",[],[])}if(b[0].btnClearTitles.findIndex(me=>N.detail.title.includes(me))!=-1){const me={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:[E.value],target:{table:b[0].table,column:b[0].column},filterType:1,requireSingleSelection:!0}]};try{await(await(await u.getActivePage()).getVisuals()).filter(Je=>Je.type==="slicer"&&Je.title===b[0].slicerTitle)[0].setSlicerState(me),console.log("success set site again")}catch(ee){console.log(ee)}je(b[0].slicerTitle,"In",[],[])}}),b.forEach(async N=>{let Se=(await(await u.getActivePage()).getVisuals()).filter(ee=>ee.type==="slicer"&&ee.title===N.slicerTitle)[0];const Re=he(N.sessionStorageName);let me=[Re];if((sessionStorage.getItem("PbiEquipment_DetailInfo")&&N.slicerTitle=="Parameter OMS component name"||N.slicerTitle=="Parameter")&&(me=Ce(N.sessionStorageName)),!!Se)if(Re){const ee={filters:[{$schema:"http://powerbi.com/product/schema#basic",operator:"In",values:me,target:{column:N.column,table:N.table},filterType:1,requireSingleSelection:!1}]};try{await Se.setSlicerState(ee)}catch(te){console.log(te)}N.slicerTitle==="Parameter OMS component name"&&await oe(Re)}else try{const te=(await(Se==null?void 0:Se.getSlicerState())).filters[0].values;te&&te.length>0&&je(N.slicerTitle,"In",te,[])}catch(ee){console.log(ee)}})}),u.off("rendered"),u.on("error",async function(ue){ue.detail=="TokenExpired"&&await He(()=>{Ie()}),u.off("error")})}}catch($){console.log($)}},Ce=$=>{const ae=sessionStorage.getItem($);return ae?JSON.parse(ae):[]},he=$=>{const ae=sessionStorage.getItem($);return console.log(ae),ae&&ae.length>0?JSON.parse(ae)[0]:""},He=async $=>{await r[Ca.GET_PBI_CONFIG]({reportName:o.reportName,isPublic:o.isPublic,reportId:o.pbiReportId,workspaceId:o.pbiWorkspaceId}),$()},Ie=async()=>{await u.setAccessToken(d.value.embedToken.token),await u.refresh()},G=()=>{const ae=wa(new Date),$e=Date.parse(d.value.embedToken.expiration)-ae,Ke=Xu*60*1e3;$e<=Ke&&He(function(){Ie()})},tt=()=>{u&&u.print()},je=async($,ae,ue,$e)=>{let Ke=[];ue.length>0&&ae=="In"?Ke=[...ue]:ue.length>0&&ae=="NotIn"&&(Ke=$e.filter(Ae=>Ae!=""&&ue.indexOf(Ae)==-1));const Be=b.find(Ae=>Ae.slicerTitle==$);Be&&sessionStorage.setItem(Be.sessionStorageName,JSON.stringify(Ke))},C=($,ae)=>{const ue=window.open($,"_blank");(!ue||ue.closed||typeof ue.closed>"u")&&va(`Please allow pop-up permission on your browser if ${ae} page is not opened in a new tab.`,"OK")},T=()=>{A.value=!0,sessionStorage.removeItem("PbiEquipment_ShowPbi")},Z=async()=>{sessionStorage.removeItem("PbiEquipment_ShowPbi"),sessionStorage.removeItem("PbiEquipment_DetailInfo"),A.value=!0,u&&u.on("loaded",async()=>{try{const ae=(await u.getPages()).find(ue=>ue.displayName=="Equipment");console.log(ae)}catch($){console.log($)}})},ge=()=>{v.value=!0},De=()=>{P.value="serviceSheet",v.value=!1};return pt(async()=>{localStorage.getItem("PbiEquipment_DetailInfo")=="true"&&(sessionStorage.setItem("PbiEquipment_DetailInfo","true"),localStorage.removeItem("PbiEquipment_DetailInfo")),(localStorage.getItem("PbiEquipment_ShowPbi")=="false"||sessionStorage.getItem("PbiEquipment_ShowPbi")=="false")&&(sessionStorage.setItem("PbiEquipment_ShowPbi","false"),localStorage.removeItem("PbiEquipment_ShowPbi"),A.value=!1,await l.getSiteLookup()),await He(()=>{de()}),R.value=setInterval(()=>{G()},Wu)}),Ea(()=>{R.value&&clearInterval(R.value)}),($,ae)=>{const ue=Ee("loading");return se((c(),h("div",zu,[se(t("div",{id:"equimentContainer",ref_key:"reportContainer",ref:B,style:{height:"100%"}},null,512),[[Ye,A.value],[ue,M.value]]),A.value?W("",!0):(c(),Y(Ku,{key:0,onOnBack:T,onOnSubmitSummaryIntervention:Z})),f(Su,{visibility:v.value,taskKey:w.value,workOrder:g.value,"asset-number":n.value,component:m.value,"sample-date":V.value,source:P.value,onOnClose:De},null,8,["visibility","taskKey","workOrder","asset-number","component","sample-date","source"]),f(Ru,{visibility:I.value,equipment:y.value.equipment,component:y.value.component,onOnClose:ae[0]||(ae[0]=$e=>I.value=!1)},null,8,["visibility","equipment","component"])])),[[ue,J.value]])}}}),Qu="AM-EHM-Equipment",Zu=le({__name:"Index",setup(e){const s=L(!1),a=L(!1),o=ye(),r=Xt(),i=S(()=>({reportName:Qu,visibletab:!1,isPublic:!1,isTransparent:!0,isHideVisualHeaders:!0,pbiReportId:"a9befe6f-7bc4-4d4a-91c1-8715b01416c5",pbiWorkspaceId:"d90b69f1-3a2e-423e-9e27-e341dc02a972"})),n=setInterval(()=>{a.value&&(s.value=!0,m())},1*60*1e3);zt(()=>{r[Sa.SET_PBI_URL]("https://digital-bumaau-dev-apm-001.azure-api.net/amadm")});const m=async()=>{const w={email:o.user.Email,ver:"v1"};if(s.value){try{await ne.get(fa,"",new URLSearchParams(w).toString())}catch(V){console.log(V)}s.value=!1}};return pt(()=>{a.value=!0}),Ot(()=>{a.value=!1,clearInterval(n)}),(g,w)=>(c(),Y(Yu,_a(i.value,{class:"equipment-dashboard"}),null,16))}}),Dd=Ve(Zu,[["__scopeId","data-v-3d3cd832"]]);export{Dd as default};
