import{u as Ee}from"./vuex-BbOKrtVp.js";import{c as q,a as de,K as De,j as ye,J as fe,I as we,A as Ue}from"./index-BuVmIl8K.js";import{F as Fe}from"./file-saver-CwTBvle_.js";import{P as Te}from"./Pagination-D-xfdYmn.js";import{A as Ce}from"./MetronicAlert-CahvwpSR.js";import{D as Pe,a as ae,b as _e,c as qe,L as Ve,d as Ae,e as ze,E as Re}from"./urls-BUxQAIma.js";import{d as be}from"./pinia-BjOS2_Ao.js";import{P as xe}from"./Pagination-BiobnanQ.js";import{x as Y,w as se,C as Me,D as Be,q as ke,B as Q}from"./date-format-8-IvfSl3.js";import{c as he,m as ge}from"./mapOption-CeGMwmH0.js";import{k as J,r as N,R as S,Y as ce,p as y,aa as x,s as a,x as l,aB as o,B,C,A as H,u as v,y as Z,q as A,F as M,$ as W,bd as oe,bb as re,c as j,b4 as Ne,a0 as Ye,T as Ge,d as We,a7 as He,L as je}from"./@vue-BypzYtbH.js";import{_ as X}from"./nw-img-vue-CR837WER.js";import{a as Ke}from"./table-sort-Bpdq_Uwn.js";import{a as Qe}from"./vee-validate-C_msoaAA.js";import{c as Ze,a as te,b as ve,d as Je}from"./yup-C6P98bvY.js";import"./property-expr-DEi1ZLzV.js";import{E as Xe}from"./ErrorAlert-CMKGfwAi.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./vue-router-iNp9kJ0K.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./element-plus-BeWdvTRa.js";import"./dayjs-D0x2Df_K.js";import"./lodash-DrHMlsdo.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./language-BriOOvyN.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-NSxIV7Fb.js";const ee=be({id:"dailyScheduleBulk",state:()=>({statePagination:new xe,stateUploadLoading:!1,stateUploadProgress:null,stateTotalInvalid:0,stateTotalUploaded:0,stateGatewayData:[],stateDraftData:[],stateAlert:{show:!1,variant:"",desc:""},stateIsNewForm:!1,stateIsError:!1,stateError:"",stateLoading:!1,stateLoadingMsg:""}),getters:{progressPercentage:e=>e.stateUploadProgress!==null?`${e.stateUploadProgress}%`:"",alertVariant:e=>e.stateAlert.variant,alertDesc:e=>e.stateAlert.desc,pagination:e=>e.statePagination,error:e=>e.stateError,isError:e=>e.stateIsError,loading:e=>e.stateLoading,loadingMessage:e=>e.stateLoadingMsg,uploadLoading:e=>e.stateUploadLoading},actions:{async downloadBulkTemplate(){const e={ver:"v1"};try{return(await q.postBlob(`${Pe}/true?${new URLSearchParams(e).toString()}`,{})).data}catch(n){console.log(n)}},setUploadAlert(e,n,s){e===0&&n===0&&this.stateGatewayData.length===0?this.stateAlert={show:!0,variant:"info",desc:"No record has been submitted, please check your file"}:e===0&&n>0&&this.stateGatewayData.length===0&&(this.stateAlert={show:!0,variant:"success",desc:`${n} of
          ${n} ${s} submitted successfully`})},async upload(e){this.stateUploadLoading=!0,this.stateLoading=!0,this.stateLoadingMsg="Uploading Data";const n={ver:"v1"},s=`${ae}/bulk?${new URLSearchParams(n).toString()}`,r=new FormData;r.append("fileUpload",e);const d=p=>{const g=Math.round(p.loaded*100/p.total);this.stateUploadProgress=g};try{this.stateIsError=!1,this.stateError="";const p=await q.postWithProgress(s,r,d);if(p.data.statusCode==200)if(p.data.result.isError)this.stateIsError=!0,this.stateError=p.data.result.message;else{const g=p.data.result.content;this.stateGatewayData=[...g.dailyOutstandingServiceList];const F=g.dailyOutstandingServiceList.filter(O=>O.isValid===!1&&O.isWarning===!1);this.stateTotalInvalid=F.length,this.stateTotalUploaded=g.totalData;const P=g.totalData>1?"records":"record";this.setUploadAlert(this.stateTotalInvalid,this.stateTotalUploaded,P)}else this.stateAlert={show:!0,variant:"warning",desc:p.data.result.message},this.stateIsError=p.data.result.isError,this.stateError=p.data.result.message}catch(p){this.stateIsError=!0,this.stateError=p.response.data.result.message}finally{this.stateUploadProgress=null,this.stateUploadLoading=!1,this.stateLoading=!1,this.stateLoadingMsg=""}},setGatewayAlert(e,n,s){e>0&&n>0?this.stateAlert={show:!0,variant:"warning",desc:`${e} of
          ${n} ${s} failed to upload`}:e===0&&n===0&&this.stateGatewayData.length>0?this.stateAlert={show:!0,variant:"info",desc:"No record has been submitted, please check your file"}:e===0&&n>0&&this.stateGatewayData.length>0&&(this.stateAlert={show:!0,variant:"success",desc:`${n} of
          ${n} ${s} submitted successfully`})},async insertGateway(){try{this.stateLoading=!0,this.stateLoadingMsg="Uploading Data";const e={ver:"v1"},n=`${_e}?${new URLSearchParams(e).toString()}`,r=this.stateGatewayData.filter(g=>!g.isWarning).map(g=>({dailyScheduleId:0,unitNumber:g.unitNumber,smuDue:g.smuDue,workOrder:g.workOrder,psType:g.psType,dateService:Y(g.dateService),shift:g.shift,startDate:Y(g.startDate),endDate:Y(g.endDate),isActive:g.isActive,isAttention:!g.isWarning})),d=await q.post(n,r),p=this.stateTotalUploaded>1?"records":"record";return this.setGatewayAlert(this.stateTotalInvalid,this.stateTotalUploaded,p),d}catch(e){return this.stateError=e.response.data.result.message,this.stateIsError=!0,e}finally{this.stateLoading=!1,this.stateGatewayData=[]}},removeDraftItemById(e){const n=this.stateDraftData.findIndex(s=>s.dailyOutstandingServiceDraftId===e);this.stateDraftData.splice(n,1),this.stateAlert.show=!1},async deleteDraft(e){const n={ver:"v1"},s=[{dailyScheduleDraftId:e}];this.stateLoading=!0,this.stateLoadingMsg="Removing Data";try{const r=await q.post(`${ae}/delete_draft?${new URLSearchParams(n).toString()}`,s);return this.removeDraftItemById(e),r.data}catch(r){console.log(r)}finally{this.stateLoading=!1,this.stateLoadingMsg=""}},async deleteBulkDraft(e){const n=new URLSearchParams({ver:"v1"}).toString();this.stateLoading=!0,this.stateLoadingMsg="Removing Data";try{const s=await q.post(`${ae}/delete_draft?${n}`,e);return this.stateAlert.show=!1,s.data}catch(s){console.log(s)}finally{this.stateLoading=!1,this.stateLoadingMsg=""}}}});class Ie{constructor(){this.dailyScheduleId=null,this.unitNumber="",this.smuDue="",this.workOrder="",this.psType="",this.dateService="",this.shift="Day",this.startDate=se(new Date),this.endDate=se(new Date("12/31/9999")),this.isActive=!0}}const et=ee(),Oe=de(),K=be({id:"dailyScheduleForm",state:()=>({stateLoading:!1,stateLoadingMessage:"",stateFormToggle:!1,stateIsNewForm:!0,stateIsDraftForm:!1,stateIsDeleteList:!1,stateFormItem:[new Ie],stateIsError:!1,stateError:"",stateErrors:[],stateSiteOption:[],stateUnitNumberOption:[],stateFilterServiceSizeOpt:[],statePsTypeOption:[],stateStatusOption:[],stateShiftOption:[]}),getters:{formToggle:e=>e.stateFormToggle,isNewForm:e=>e.stateIsNewForm,error:e=>e.stateError,errors:e=>e.stateErrors,isError:e=>e.stateIsError,loading:e=>e.stateLoading,siteOption:e=>e.stateSiteOption,filterServiceSizeOpt:e=>e.stateFilterServiceSizeOpt,psTypeOption:e=>e.statePsTypeOption,statusOption:e=>e.stateStatusOption,shiftOption:e=>e.stateShiftOption,unitNumberOption:e=>e.stateUnitNumberOption},actions:{async getLookupSite(){const e=`${Re}/lookup_site`,n=new URLSearchParams({ver:"v1"}).toString();try{const s=await q.get(e,"",n),r=p=>p.siteName,d=p=>p.siteId;this.stateSiteOption=he(s.data.result.content,r,d)}catch(s){console.log(s)}},async getEquipmentNumberLookup(){const e={ver:"v1",status:"",siteId:Oe.user.isHO===1?"":Oe.user.SiteId};try{const n=await q.get(qe,"",new URLSearchParams(e).toString()),s=d=>d.equipmentNo+" | "+d.equipmentNoDescription,r=d=>d.equipmentNoId;this.stateUnitNumberOption=he(n.data.result.content,s,r)}catch(n){console.log(n)}},async getPsTypeLookup(){const e={ver:"v1"};try{const n=await q.get(Ve,"",new URLSearchParams(e).toString());this.stateFilterServiceSizeOpt=ge(n.data.result.content.psType)}catch(n){console.log(n)}},async lookupServiceSize(e){const n=`${ae}/lookup_service_size`,s={ver:"v1"},r={equipmentNo:e};try{const d=await q.post(`${n}?${new URLSearchParams(s).toString()}`,r);this.statePsTypeOption=ge(d.data.result.content)}catch(d){console.log(d)}},async getStatusLookup(){const e={ver:"v1"};try{const n=await q.get(Ae,"",new URLSearchParams(e).toString()),s=d=>d.status,r=d=>d.statusId;this.stateStatusOption=he(n.data.result.content,s,r)}catch(n){console.log(n)}},async getShiftLookup(){const e={ver:"v1"};try{const n=await q.get(ze,"",new URLSearchParams(e).toString());this.stateShiftOption=ge(n.data.result.content.shift)}catch(n){console.log(n)}},async insertData(){this.stateLoading=!0,this.stateLoadingMessage="Submitting Data";try{const e={ver:"v1"};if(this.stateIsDraftForm){const s=this.stateFormItem[0],r=[{dailyScheduleDraftId:s.dailyScheduleId,unitNumber:s.unitNumber,smuDue:s.smuDue,workOrder:s.workOrder,psType:s.psType,dateService:s.dateService,shift:s.shift,startDate:s.startDate,endDate:s.endDate,isActive:!0}],d=await q.post(`${_e}?${new URLSearchParams(e).toString()}`,r);return this.stateLoading=!1,d.data.result.isError?(this.setErrors(d.data.result.content.dailyOutstandingServiceList[0].validationReason.split(",")),ye("Failed to Submit","","Ok"),d):(De("Record has been submitted successfully","","Ok"),et.removeDraftItemById(s.dailyScheduleId),d)}const n=await q.post(`${_e}?${new URLSearchParams(e).toString()}`,this.stateFormItem);if(this.stateLoading=!1,n.data.result.isError)return this.setErrors(n.data.result.content.dailyOutstandingServiceList[0].validationReason.split(",")),ye("Failed to Submit","","Ok"),n;{const s=this.stateIsDeleteList?"Record has been removed !":"Record has been submitted successfully";return De(s,"","Ok"),n}}catch(e){this.stateErrors.push(e.response.data.result.message),this.stateIsError=!0}this.stateLoading=!1},setErrors(e){this.stateErrors=e,this.stateIsError=this.stateErrors.length>0},resetFormItem(){this.stateFormItem=[new Ie],this.stateIsNewForm=!0,this.stateIsDraftForm=!1}}}),ie=K(),tt=ee(),$e=de();class Le{constructor(n){this.siteId=n.isHO===1?"":n.SiteId,this.equipmentNoId=null,this.smuDue=void 0,this.workOrder=void 0,this.serviceSize="",this.dateFrom=null,this.dateTo=null,this.statusId=null,this.page=1,this.pageSize=20}}const le=be({id:"dailyscheduleList",state:()=>({stateFilterForm:new Le($e.user),stateList:[],statePageName:"dailyschedule",statePagination:new xe,stateLoading:!1,statePaginationLoading:!1}),getters:{pageName:e=>e.statePageName,pagination:e=>e.statePagination,list:e=>e.stateList,unitNumberOption:()=>ie.unitNumberOption,filterServiceSizeOpt:()=>ie.filterServiceSizeOpt,psTypeOption:()=>ie.psTypeOption,statusOption:()=>ie.statusOption,loading:e=>e.stateLoading,paginationLoading:e=>e.statePaginationLoading},actions:{setTotalPage(e){this.pagination.totalPage=e,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async getList(){this.stateLoading=!0;const e={ver:"v1"},n=this.stateFilterForm;n.siteId=n.siteId===""?"":n.siteId,n.equipmentNoId=n.equipmentNoId===""?null:n.equipmentNoId,n.statusId=n.statusId===""?null:n.statusId;try{const r=(await q.post(`${ae}?${new URLSearchParams(e).toString()}`,n)).data.result.content;this.stateList=r.dailyOutstandingServiceList,r.dailyOutstandingServiceDraftList&&(tt.stateDraftData=r.dailyOutstandingServiceDraftList),this.setTotalPage(r.totalData)}catch(s){console.log(s)}this.stateLoading=!1},async setPage(e){this.statePaginationLoading=!0,this.statePagination.totalPageSize=this.stateFilterForm.pageSize,this.statePagination.handleCurrentPageChange(e),this.stateFilterForm.page=this.statePagination.currentPage,await this.getList(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setAppliedFilter(e){this.stateFilterForm=e,await this.setPage(1)},async export(){const e={ver:"v1"},{equipmentNoId:n,smuDue:s,workOrder:r,serviceSize:d,statusId:p,siteId:g,dateFrom:F,dateTo:P}=this.stateFilterForm,O={equipmentNoId:n,smuDue:s,workOrder:r,serviceSize:d,statusId:p,siteId:g,dateFrom:F,dateTo:P};try{return(await q.postBlob(`${Pe}/false?${new URLSearchParams(e).toString()}`,O)).data}catch(E){console.log(E)}},resetFilter(){this.stateFilterForm=new Le($e.user)}}}),at=e=>(oe("data-v-ece9a982"),e=e(),re(),e),st={key:0,class:"d-flex justify-content-end"},ot={class:"svg-icon svg-icon-btech-danger-500 d-inline-block mr-2"},rt={key:1,style:{height:"100px"}},lt={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},nt=["onClick"],it={class:"m-0",style:{"line-height":"1.25rem"}},dt={class:"d-flex justify-content-center gap-6"},ct=["onClick"],ut=["onClick"],pt={class:"m-0"},mt={class:"m-0 invalid-reason"},ht=at(()=>o("span",{class:"dialog-footer"},null,-1)),gt=J({__name:"DraftTable",props:{listData:{required:!0,type:Array}},emits:["show-form","load-page"],setup(e,{emit:n}){const s=e,r=le(),d=ee(),p=K(),g=n,F=b=>{var t,h;const D={dailyScheduleId:b.row.dailyOutstandingServiceDraftId,unitNumber:b.row.equipmentNo,smuDue:(t=b.row.smuDue)==null?void 0:t.toString(),workOrder:(h=b.row.workOrder)==null?void 0:h.toString(),psType:b.row.serviceSize,dateService:b.row.dateService,shift:b.row.shift,startDate:b.row.startDate,endDate:b.row.endDate,isActive:b.row.isActive};p.stateIsNewForm=!1,p.stateIsDraftForm=!0,p.stateFormItem=[D],p.lookupServiceSize(D.unitNumber),g("show-form")},P=async b=>{fe("Remove this record from Need Review ?","Remove").then(async D=>{D.isConfirmed&&await d.deleteDraft(b.row.dailyOutstandingServiceDraftId).then(()=>{g("load-page"),we("Record has been removed !","Ok")})})},O=N([]),E=b=>{O.value=b.map(D=>({dailyScheduleDraftId:D.dailyOutstandingServiceDraftId}))},R=()=>{fe("Remove all selected records from Need Review?","Remove").then(async b=>{b.isConfirmed&&await d.deleteBulkDraft(O.value).then(()=>{g("load-page"),we("Records have been successfully deleted!","Ok"),O.value=[]})})},$=N(!1),m=N(""),U=N([]),L=b=>{m.value=b.workOrder,U.value=b.validationReason.split(","),U.value=U.value.map(D=>{const t=/PS Type/g;D=D.replace(t,"Planned Service Size");const h=/Unit Number/g;return D=D.replace(h,"Equipment No."),D}),$.value=!0};return(b,D)=>{const t=S("inline-svg"),h=S("el-button"),u=S("el-tooltip"),i=S("el-table-column"),I=S("el-table"),_=S("el-dialog"),k=ce("loading");return y(),x(M,null,[O.value.length>0?(y(),x("section",st,[a(h,{class:"btn btn-outline btn-outline-btech-danger btn-active-light-btech-danger btech-md mb-4",onClick:R},{default:l(()=>[o("span",ot,[a(t,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})]),B(" Delete ("+C(O.value.length)+") ",1)]),_:1})])):H("",!0),v(d).loading||v(r).loading?Z((y(),x("div",rt,null,512)),[[k,v(d).loading||v(r).loading]]):(y(),A(I,{key:2,data:s.listData,style:{width:"100%"},"empty-text":"No Data to Display","max-height":400,"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSelect:E,onSelectAll:E},{default:l(()=>[a(i,{prop:"equipmentNo",label:"Equipment No.",width:"174",sortable:""},{default:l(c=>[o("div",lt,[a(u,{class:"box-item",effect:"dark",placement:"top",content:"Click to see errors"},{default:l(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 me-1",style:{cursor:"pointer"},onClick:T=>L(c.row)},[a(t,{src:"/media/icons/bumaau/info.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,nt)]),_:2},1024),o("p",it,C(c.row.equipmentNo),1)])]),_:1}),a(i,{prop:"smuDue",label:"SMU Due (Hours)",width:"174",sortable:""}),a(i,{prop:"workOrder",label:"Work Order",width:"174",sortable:""}),a(i,{prop:"serviceSize",label:"Service Size",width:"174",sortable:""}),a(i,{prop:"dateService",label:"Planned Service Date",width:"185",sortable:""},{default:l(c=>[o("span",null,C(c.row.dateService?v(Y)(c.row.dateService):""),1)]),_:1}),a(i,{prop:"shift",label:"Shift","min-width":"90",sortable:""}),a(i,{prop:"startDate",label:"Start Date","min-width":"110",sortable:""},{default:l(c=>[o("span",null,C(c.row.startDate?v(Y)(c.row.startDate):""),1)]),_:1}),a(i,{prop:"endDate",label:"End Date","min-width":"110",sortable:""},{default:l(c=>[o("span",null,C(c.row.endDate?v(Y)(c.row.endDate):""),1)]),_:1}),a(i,{label:"Action","header-align":"center",fixed:"right",width:"80"},{default:l(c=>[o("div",dt,[a(u,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:l(()=>[o("span",{class:"svg-icon svg-icon-btech-secondary-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:T=>F(c)},[a(t,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,ct)]),_:2},1024),a(u,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:l(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:T=>P(c)},[a(t,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,ut)]),_:2},1024)])]),_:1}),a(i,{type:"selection",fixed:"right",width:"40",align:"center","header-align":"center"})]),_:1},8,["data"])),a(_,{modelValue:$.value,"onUpdate:modelValue":D[0]||(D[0]=c=>$.value=c),title:`Errors for work order ${m.value}`,"modal-class":"ironlake-dialog",width:"40%","align-center":""},{footer:l(()=>[ht]),default:l(()=>[o("ul",pt,[(y(!0),x(M,null,W(U.value,c=>(y(),x("li",{key:U.value.indexOf(c)},[o("p",mt,C(c),1)]))),128))])]),_:1},8,["modelValue","title"])],64)}}}),vt=X(gt,[["__scopeId","data-v-ece9a982"]]),ue=e=>(oe("data-v-339f3cd7"),e=e(),re(),e),ft={key:0,class:"mb-3 d-flex justify-content-between"},_t=ue(()=>o("p",{class:"m-0 card-table-title"},"Outstanding Service List",-1)),bt=[_t],St={class:"align-self-center d-flex gap-2 ironlake-table-toolbar"},Dt={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block mr-2"},yt={class:"p-2 d-flex flex-column gap-8"},wt=ue(()=>o("section",null,[o("p",{class:"m-0 popover-title"},"Filters")],-1)),kt={class:"d-flex flex-column gap-6"},It=ue(()=>o("span",null,"SMU Due (hours)",-1)),Ot=ue(()=>o("span",null," Work Order ",-1)),$t={class:"d-flex justify-content-end gap-3"},Lt={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block mr-2"},Ft=J({__name:"ListTableFilter",setup(e,{expose:n}){const s=le(),r=K(),d=ee(),p=de(),g=j(()=>p.user),F=N([]),P=u=>{const i=new Date;return i.setTime(i.getTime()-3600*1e3*24*u),[i,new Date]},O=()=>{const u=Me(),i=Be(u);return[u,i]},E=[{text:"Yesterday",value:P(1)},{text:"Last week",value:P(7)},{text:"Last month",value:O()}],R=()=>{s.stateFilterForm.dateFrom=ke(F.value[0]),s.stateFilterForm.dateTo=ke(F.value[1]),s.setPage(1)},$=N(!1),m=N({equipmentNoId:null,serviceSize:"",workOrder:void 0,smuDue:void 0,dateFrom:null,dateTo:null,statusId:null,siteId:g.value.isHO===1?"":p.user.SiteId,page:1,pageSize:20});n({dataFilter:m});const U=()=>{F.value=[],m.value={equipmentNoId:null,serviceSize:"",workOrder:void 0,smuDue:void 0,dateFrom:null,dateTo:null,statusId:null,siteId:g.value.isHO===1?"":p.user.SiteId,page:1,pageSize:20}},L=()=>{const u=s.stateFilterForm;m.value={equipmentNoId:u.equipmentNoId,serviceSize:u.serviceSize,workOrder:u.workOrder,smuDue:u.smuDue,dateFrom:u.dateFrom,dateTo:u.dateTo,statusId:u.statusId,siteId:u.siteId,page:u.page,pageSize:u.pageSize}},b=()=>{m.value.workOrder=m.value.workOrder===""?null:m.value.workOrder,m.value.smuDue=m.value.smuDue===""?null:m.value.smuDue,s.setAppliedFilter(m.value),$.value=!1},D=()=>{if(typeof m.value.smuDue=="string"){m.value.smuDue=m.value.smuDue.replace(/\D/g,"");const u=parseInt(m.value.smuDue);m.value.smuDue=isNaN(u)?null:u}},t=()=>{if(typeof m.value.workOrder=="string"){m.value.workOrder=m.value.workOrder.replace(/\D/g,"");const u=parseInt(m.value.workOrder);m.value.workOrder=isNaN(u)?null:u}},h=async()=>{const u=await s.export();Fe.saveAs(new Blob([u],{type:"application/octet-stream"}),"Master Data Outstanding Service.xlsx")};return(u,i)=>{const I=S("el-date-picker"),_=S("inline-svg"),k=S("el-button"),c=S("el-option"),T=S("el-select"),V=S("el-form-item"),f=S("el-input"),pe=S("el-form"),me=S("el-popover");return y(),x("section",{id:"table-actions",class:Ne(["mb-6 d-flex",v(d).stateDraftData.length>0?"justify-content-between":"justify-content-end"])},[v(d).stateDraftData.length>0?(y(),x("section",ft,bt)):H("",!0),o("div",St,[a(I,{modelValue:F.value,"onUpdate:modelValue":i[0]||(i[0]=w=>F.value=w),class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",type:"daterange","unlink-panels":"","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",format:"DD/MM/YYYY",clearable:!1,shortcuts:E,onChange:R},null,8,["modelValue"]),a(me,{placement:"bottom-end",visible:$.value,width:360,onAfterLeave:L},{reference:l(()=>[a(k,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:i[1]||(i[1]=w=>$.value=!$.value)},{default:l(()=>[o("span",Dt,[a(_,{src:"/media/icons/bumaau/filter_list.svg",style:{width:"1.25rem",height:"1.25rem"}})]),B(" Filter ")]),_:1})]),default:l(()=>[o("div",yt,[wt,o("section",kt,[a(pe,{model:m.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:l(()=>[g.value.isHO===1?(y(),A(V,{key:0,label:"Site"},{default:l(()=>[a(T,{modelValue:m.value.siteId,"onUpdate:modelValue":i[2]||(i[2]=w=>m.value.siteId=w),placeholder:"Write site name",clearable:"",filterable:""},{default:l(()=>[(y(!0),x(M,null,W(v(r).siteOption,w=>(y(),A(c,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):H("",!0),a(V,{label:"Equipment"},{default:l(()=>[a(T,{modelValue:m.value.equipmentNoId,"onUpdate:modelValue":i[3]||(i[3]=w=>m.value.equipmentNoId=w),placeholder:"Write your equipment unite",clearable:"",filterable:""},{default:l(()=>[(y(!0),x(M,null,W(v(s).unitNumberOption,w=>(y(),A(c,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(V,null,{label:l(()=>[It]),default:l(()=>[a(f,{modelValue:m.value.smuDue,"onUpdate:modelValue":i[4]||(i[4]=w=>m.value.smuDue=w),maxlength:"10",placeholder:"Write SMU Due (hours)",onInput:i[5]||(i[5]=w=>D())},null,8,["modelValue"])]),_:1}),a(V,null,{label:l(()=>[Ot]),default:l(()=>[a(f,{modelValue:m.value.workOrder,"onUpdate:modelValue":i[6]||(i[6]=w=>m.value.workOrder=w),maxlength:"10",placeholder:"Write your work order",onInput:i[7]||(i[7]=w=>t())},null,8,["modelValue"])]),_:1}),a(V,{label:"Service Size"},{default:l(()=>[a(T,{modelValue:m.value.serviceSize,"onUpdate:modelValue":i[8]||(i[8]=w=>m.value.serviceSize=w),placeholder:"Choose service size",clearable:"",filterable:""},{default:l(()=>[(y(!0),x(M,null,W(v(r).stateFilterServiceSizeOpt,w=>(y(),A(c,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(V,{label:"Status"},{default:l(()=>[a(T,{modelValue:m.value.statusId,"onUpdate:modelValue":i[9]||(i[9]=w=>m.value.statusId=w),placeholder:"Choose status",clearable:""},{default:l(()=>[(y(!0),x(M,null,W(v(s).statusOption,w=>(y(),A(c,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),o("section",$t,[o("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md me-auto",onClick:U}," Reset "),o("button",{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md",onClick:i[10]||(i[10]=w=>$.value=!1)}," Close "),o("button",{class:"btn btn-btech-secondary btech-md",onClick:b}," Apply ")])])]),_:1},8,["visible"]),a(k,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-md m-0",onClick:h},{default:l(()=>[o("span",Lt,[a(_,{src:"/media/icons/bumaau/download.svg",style:{width:"1.25rem",height:"1.25rem"}})]),B(" Export ")]),_:1})])],2)}}}),Pt=X(Ft,[["__scopeId","data-v-339f3cd7"]]),xt={key:0,style:{height:"100px"}},Nt={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},Et={class:"me-1"},Ut={class:"m-0",style:{"line-height":"1.25rem"}},Tt={key:0},Ct={class:"d-flex justify-content-center gap-6"},qt=["onClick"],Vt=["onClick"],At=J({__name:"ListTable",props:{search:{required:!0,type:String}},emits:["show-form"],setup(e,{emit:n}){const s=e,r=n,d=le(),p=K(),g=(t,h)=>t.toLowerCase().includes(h.toLowerCase()),F=j(()=>(d.stateList.forEach(t=>{t.status=t.status===null?"null":t.status}),d.stateList.filter(t=>{const h=g(t.equipmentNo,s.search),u=g(t.serviceSize,s.search),i=g(t.workOrder.toString(),s.search),I=g(t.dateService,s.search),_=g(t.smuDue.toString(),s.search);return!s.search||h||u||i||_||I}))),P=t=>{if(t==="Yet To Start")return"badge-light-dark";if(t==="In Progress")return"badge-light-btech-secondary";if(t==="Under Review")return"badge-light-btech-info text-btech-info-500";if(t==="Final Review")return"badge-light-btech-success text-btech-success-500";if(t==="Closed")return"badge-light-btech-primary"},O=t=>{const h=new Date,u=new Date(t.dateService),i=h.getFullYear(),I=h.getMonth(),_=h.getDate(),k=u.getFullYear(),c=u.getMonth(),T=u.getDate(),V=i===k&&I===c&&_===T,f=u>h;return t.status!==null&&t.status==="Yet To Start"&&!V&&t.status==="Yet To Start"&&!f},E=N(""),R=t=>{E.value=t.order},$=(t,h,u)=>Ke(t[u],h[u],E.value),m=(t,h)=>{const u=parseInt(t.serviceSize),i=parseInt(h.serviceSize);return u-i},U=(t,h)=>{const u=t.equipmentNo.toLowerCase(),i=h.equipmentNo.toLowerCase(),I=u.match(/[A-Za-z]+/)[0],_=i.match(/[A-Za-z]+/)[0];if(I!==_)return I.localeCompare(_);const k=parseInt(u.match(/\d+/)[0]),c=parseInt(i.match(/\d+/)[0]);return k-c},L=t=>({dailyScheduleId:t.dailyOutstandingServiceId,unitNumber:t.equipmentNo,smuDue:t.smuDue.toString(),workOrder:t.workOrder.toString(),psType:t.serviceSize,dateService:t.dateService,shift:t.shift,startDate:t.startDate,endDate:t.endDate,isActive:t.isActive}),b=t=>{const h=L(t.row);p.stateIsNewForm=!1,p.stateFormItem=[h],p.lookupServiceSize(h.unitNumber),r("show-form")},D=t=>{t.row.isActive=!1,t.row.dateService=Q(t.row.dateService),t.row.startDate=Q(t.row.startDate),t.row.endDate=Q(t.row.endDate);const h=L(t.row);p.stateIsDeleteList=!0,p.stateFormItem=[h],fe("Remove this record from List?","Remove").then(u=>{u.isConfirmed&&p.insertData().then(i=>{i!=null&&i.data.result.isError||(p.resetFormItem(),d.setPage(1),p.stateIsDeleteList=!1)})})};return(t,h)=>{const u=S("inline-svg"),i=S("el-tooltip"),I=S("el-table-column"),_=S("el-table"),k=ce("loading");return v(d).loading?Z((y(),x("div",xt,null,512)),[[k,v(d).loading]]):Z((y(),A(_,{key:1,data:F.value,"empty-text":"No Data",style:{width:"100%"},"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell",onSortChange:R},{default:l(()=>[a(I,{prop:"equipmentNo",label:"Equipment No",width:"174",sortable:"","sort-method":U,"sort-orders":["ascending","descending"]},{default:l(c=>[o("div",Nt,[O(c.row)?(y(),A(i,{key:0,class:"box-item",effect:"dark",placement:"top",content:"Planned Service Date has passed"},{default:l(()=>[o("span",Et,[a(u,{src:"/media/icons/bumaau/bookmark.svg",style:{width:"1.125rem",height:"1.125rem"}})])]),_:1})):H("",!0),o("p",Ut,C(c.row.equipmentNo),1)])]),_:1}),a(I,{prop:"smuDue",label:"SMU Due (hours)",width:"174",sortable:"","sort-orders":["ascending","descending"]}),a(I,{prop:"workOrder",label:"Work Order",width:"174",sortable:"","sort-orders":["ascending","descending"]}),a(I,{prop:"serviceSize",label:"Service Size",width:"174",sortable:"","sort-method":m,"sort-orders":["ascending","descending"]}),a(I,{prop:"dateService",label:"Planned Service Date",width:"185",sortable:"","sort-orders":["ascending","descending"]},{default:l(c=>[o("span",null,C(v(Y)(c.row.dateService)),1)]),_:1}),a(I,{prop:"status",label:"Status",sortable:"","sort-orders":["ascending","descending"],"sort-method":(c,T)=>$(c,T,"status")},{default:l(c=>[o("span",{class:Ne(["badge btech-badge",P(c.row.status)])},C(c.row.status),3)]),_:1},8,["sort-method"]),a(I,{label:"Action","header-align":"center",width:"80"},{default:l(c=>[c.row.status==="Yet To Start"?(y(),x("div",Tt,[o("div",Ct,[a(i,{class:"box-item",effect:"dark",content:"Edit",placement:"top"},{default:l(()=>[o("span",{class:"svg-icon svg-icon-btech-secondary-500 d-flex justify-content-end",style:{cursor:"pointer"},onClick:T=>b(c)},[a(u,{src:"/media/svg/tables/rows/mode-edit-round.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,qt)]),_:2},1024),a(i,{class:"box-item",effect:"dark",content:"Delete",placement:"top"},{default:l(()=>[o("span",{class:"svg-icon svg-icon-btech-danger-500 d-inline-block m-0",style:{cursor:"pointer"},onClick:T=>D(c)},[a(u,{src:"/media/icons/bumaau/delete.svg",style:{width:"1.25rem",height:"1.25rem"}})],8,Vt)]),_:2},1024)])])):H("",!0)]),_:1})]),_:1},8,["data"])),[[k,v(d).loading]])}}}),zt=X(At,[["__scopeId","data-v-b7a6ffb8"]]),z=e=>(oe("data-v-5e4eb4ac"),e=e(),re(),e),Rt={class:"container p-0"},Mt={class:"row m-0 gap-4"},Bt={class:"col p-0"},Yt=z(()=>o("span",{class:"required"},"Equipment No.",-1)),Gt={class:"col p-0"},Wt=z(()=>o("span",{class:"required"},"SMU Due (hours)",-1)),Ht=z(()=>o("div",{class:"col p-0"},null,-1)),jt={class:"container p-0"},Kt={class:"row m-0 gap-4"},Qt={class:"col p-0"},Zt=z(()=>o("span",{class:"required"}," Work Order ",-1)),Jt=z(()=>o("div",{class:"col p-0"},null,-1)),Xt=z(()=>o("div",{class:"col p-0"},null,-1)),ea={class:"container p-0"},ta={class:"row m-0 gap-4"},aa={class:"col p-0"},sa=z(()=>o("span",{class:"required"},"Service Size",-1)),oa=z(()=>o("p",{class:"m-0 text-center py-3 px-2 fs-7 text-btech-info-500"}," Equipment No. isn't mapped to any Service Size ",-1)),ra={class:"col p-0"},la=z(()=>o("span",{class:"required"},"Planned Service Date",-1)),na={class:"col p-0"},ia=z(()=>o("span",{class:"required"},"Shift",-1)),da={class:"container p-0"},ca={class:"row m-0 gap-4"},ua={class:"col p-0"},pa=z(()=>o("span",{class:"required"},"Start Date",-1)),ma={class:"col p-0"},ha=z(()=>o("span",{class:"required"},"End Date",-1)),ga=z(()=>o("div",{class:"col p-0"},null,-1)),va={class:"dialog-footer"},fa=J({__name:"FormDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(e,{emit:n}){const s=K(),r=j({get(){return s.stateFormItem[0]},set(D){s.stateFormItem[0]=D}}),p=Ye(e,"visibility"),g=D=>{s.stateFormItem[0].psType="",s.lookupServiceSize(D)},F=n,P=async(D=!1)=>{F("handle-close",D)},O=()=>{r.value.dateService=se(new Date(r.value.dateService)),r.value.startDate=se(new Date(r.value.startDate)),r.value.endDate=se(new Date(r.value.endDate)),s.resetFormItem(),b()},E=j(()=>s.errors),R=j(()=>s.isError),$=Ze().shape({unitNumber:te().required("Equipment No. is required"),smuDue:te().required("SMU Due is required"),workOrder:te().required("Work Order is required"),psType:te().required("Service Size is required"),shift:te().required("Shift is required"),dateService:ve().required("Planned Service Date is required").typeError("Planned Service Date is required"),startDate:ve().required("Start Date is required").typeError("Start Date is required"),endDate:ve().required("End Date is required").min(Je("startDate"),"End date must be later than start date").typeError("End Date is required")}),m=()=>{r.value.smuDue=r.value.smuDue.replace(/\D/g,"")},U=()=>{r.value.workOrder=r.value.workOrder.replace(/\D/g,"")},L=async()=>{if(await $.validate(r.value,{abortEarly:!1}).then(()=>{s.stateIsError=!1}).catch(t=>{s.setErrors(t.errors)}),R.value)return;const D={dateService:r.value.dateService,startDate:r.value.startDate,endDate:r.value.endDate};r.value.dateService=Q(r.value.dateService),r.value.startDate=Q(r.value.startDate),r.value.endDate=Q(r.value.endDate),s.insertData().then(t=>{r.value.dateService=D.dateService,r.value.startDate=D.startDate,r.value.endDate=D.endDate,t!=null&&t.data.result.isError||(s.resetFormItem(),P(!0))})},b=()=>{s.setErrors([])};return(D,t)=>{const h=S("el-option"),u=S("el-select"),i=S("el-form-item"),I=S("el-input"),_=S("el-date-picker"),k=S("el-form"),c=S("el-button"),T=S("el-dialog"),V=ce("loading");return Z((y(),A(T,{modelValue:p.value,"onUpdate:modelValue":t[11]||(t[11]=f=>p.value=f),title:`${v(s).isNewForm?"New":"Edit"} Daily Outstanding Service`,"modal-class":"ironlake-dialog",width:800,"align-center":!0,"close-on-click-modal":!1,"show-close":!1,onClose:t[12]||(t[12]=f=>P()),onClosed:t[13]||(t[13]=f=>O())},{footer:l(()=>[o("span",va,[a(c,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",onClick:t[10]||(t[10]=f=>P(!1)),disabled:v(s).loading},{default:l(()=>[B("Cancel")]),_:1},8,["disabled"]),a(c,{class:"btn btn-btech-secondary",onClick:L},{default:l(()=>[B(" Submit ")]),_:1})])]),default:l(()=>[a(Ge,{name:"fade"},{default:l(()=>[R.value?(y(),A(Xe,{key:0,errorMessages:E.value,onResetForm:b},null,8,["errorMessages"])):H("",!0)]),_:1}),a(v(Qe),null,{default:l(()=>[a(k,{ref:"ruleFormRef",model:r.value,"label-position":"top",class:"ironlake-form d-flex flex-column gap-6"},{default:l(()=>[o("section",Rt,[o("div",Mt,[o("div",Bt,[a(i,null,{label:l(()=>[Yt]),default:l(()=>[a(u,{modelValue:r.value.unitNumber,"onUpdate:modelValue":t[0]||(t[0]=f=>r.value.unitNumber=f),placeholder:"eg. DT0700",clearable:"",filterable:"",onChange:g},{default:l(()=>[(y(!0),x(M,null,W(v(s).unitNumberOption,f=>(y(),A(h,{key:f.value,label:f.label.split(" | ")[0],value:f.label.split(" | ")[0]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",Gt,[a(i,null,{label:l(()=>[Wt]),default:l(()=>[a(I,{modelValue:r.value.smuDue,"onUpdate:modelValue":t[1]||(t[1]=f=>r.value.smuDue=f),maxlength:"10",placeholder:"Write SMU Due (hours)",onInput:t[2]||(t[2]=f=>m())},null,8,["modelValue"])]),_:1})]),Ht])]),o("section",jt,[o("div",Kt,[o("div",Qt,[a(i,null,{label:l(()=>[Zt]),default:l(()=>[a(I,{modelValue:r.value.workOrder,"onUpdate:modelValue":t[3]||(t[3]=f=>r.value.workOrder=f),maxlength:"10",placeholder:"Write your work order",disabled:!v(s).stateIsNewForm&&!v(s).stateIsDraftForm,onInput:t[4]||(t[4]=f=>U())},null,8,["modelValue","disabled"])]),_:1})]),Jt,Xt])]),o("section",ea,[o("div",ta,[o("div",aa,[a(i,null,{label:l(()=>[sa]),default:l(()=>[a(u,{modelValue:r.value.psType,"onUpdate:modelValue":t[5]||(t[5]=f=>r.value.psType=f),placeholder:"Choose service size",clearable:"",filterable:""},{empty:l(()=>[oa]),default:l(()=>[(y(!0),x(M,null,W(v(s).psTypeOption,f=>(y(),A(h,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",ra,[a(i,null,{label:l(()=>[la]),default:l(()=>[a(_,{modelValue:r.value.dateService,"onUpdate:modelValue":t[6]||(t[6]=f=>r.value.dateService=f),type:"date",placeholder:"Choose date of service",format:"DD.MM.YYYY",clearable:!1},null,8,["modelValue"])]),_:1})]),o("div",na,[a(i,null,{label:l(()=>[ia]),default:l(()=>[a(u,{modelValue:r.value.shift,"onUpdate:modelValue":t[7]||(t[7]=f=>r.value.shift=f),placeholder:"Choose shift",clearable:"",filterable:""},{default:l(()=>[(y(!0),x(M,null,W(v(s).shiftOption,f=>(y(),A(h,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),o("section",da,[o("div",ca,[o("div",ua,[a(i,null,{label:l(()=>[pa]),default:l(()=>[a(_,{modelValue:r.value.startDate,"onUpdate:modelValue":t[8]||(t[8]=f=>r.value.startDate=f),type:"date",placeholder:"Start date",format:"DD.MM.YYYY","default-value":new Date,clearable:!1},null,8,["modelValue","default-value"])]),_:1})]),o("div",ma,[a(i,null,{label:l(()=>[ha]),default:l(()=>[a(_,{modelValue:r.value.endDate,"onUpdate:modelValue":t[9]||(t[9]=f=>r.value.endDate=f),type:"date",placeholder:"End date",format:"DD.MM.YYYY",clearable:!1},null,8,["modelValue"])]),_:1})]),ga])])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue","title"])),[[V,v(s).loading]])}}}),_a=X(fa,[["__scopeId","data-v-5e4eb4ac"]]),ba=e=>(oe("data-v-a8751f36"),e=e(),re(),e),Sa={class:"ironlake-dialog-title m-0"},Da={class:"text-btech-danger-500"},ya={class:"d-flex",style:{"line-height":"1.25","align-items":"center"}},wa=["onClick"],ka={class:"m-0",style:{"line-height":"1.25rem"}},Ia={class:"dialog-footer"},Oa={class:"m-0"},$a={class:"m-0 invalid-reason"},La=ba(()=>o("span",{class:"dialog-footer"},null,-1)),Fa=J({__name:"DraftGatewayDialog",setup(e,{expose:n}){const s=le(),r=K(),d=ee(),p=L=>!L.isValid&&!L.isWarning?"Click to see error":"Click to see warning",g=L=>!L.isValid&&!L.isWarning?"/media/icons/bumaau/info.svg":"/media/icons/bumaau/circle_close.svg",F=N(!1),P=N(""),O=N([]),E=(L,b)=>b?`${L} for Equipment No. ${b}`:`${L}`,R=L=>{L.isWarning?P.value=E("Warning",L.equipmentUnit):P.value=E("Error",L.equipmentUnit),O.value=L.validationReason.split(",").map(b=>b),F.value=!0},$=N(!1);n({showGatewayDialog:$});const m=()=>{$.value=!1},U=()=>{d.insertGateway().then(async()=>{r.getLookupSite(),r.getEquipmentNumberLookup(),r.getStatusLookup(),r.getShiftLookup(),s.resetFilter(),await s.setPage(1)}),$.value=!1};return(L,b)=>{const D=S("inline-svg"),t=S("el-tooltip"),h=S("el-table-column"),u=S("el-table"),i=S("el-button"),I=S("el-dialog");return y(),x(M,null,[a(I,{modelValue:$.value,"onUpdate:modelValue":b[0]||(b[0]=_=>$.value=_),"modal-class":"ironlake-dialog",width:1100,"align-center":!0,"close-on-click-modal":!1,"show-close":!1},{title:l(()=>[o("p",Sa,[B(" Need Attention "),o("span",Da," ("+C(v(d).stateGatewayData.length)+") ",1)])]),default:l(()=>[a(u,{data:v(d).stateGatewayData,"header-cell-class-name":"ironlake-table-cell-header","cell-class-name":"ironlake-table-cell","max-height":500,style:{width:"100%"}},{default:l(()=>[a(h,{prop:"unitNumber",label:"Equipment No.",sortable:"","sort-orders":["ascending","descending"]},{default:l(_=>[o("div",ya,[a(t,{class:"box-item",effect:"dark",placement:"top",content:p(_.row)},{default:l(()=>[o("span",{class:"svg-icon me-1 svg-icon-btech-danger-500",style:{cursor:"pointer"},onClick:k=>R(_.row)},[a(D,{src:g(_.row),style:{width:"1.25rem",height:"1.25rem"}},null,8,["src"])],8,wa)]),_:2},1032,["content"]),o("p",ka,C(_.row.unitNumber),1)])]),_:1}),a(h,{prop:"smuDue",label:"SMU Due (Hours)",sortable:"","sort-orders":["ascending","descending"],width:150}),a(h,{prop:"workOrder",label:"Work Order",sortable:"","sort-orders":["ascending","descending"],width:120}),a(h,{prop:"psType",label:"Service Size",sortable:"","sort-orders":["ascending","descending"],width:120}),a(h,{prop:"dateService",label:"Planned Service Date",sortable:"","sort-orders":["ascending","descending"],width:180},{default:l(_=>[o("span",null,C(v(Y)(_.row.dateService)),1)]),_:1}),a(h,{prop:"shift",label:"Shift",sortable:"","sort-orders":["ascending","descending"],width:90}),a(h,{prop:"startDate",label:"Start Date",sortable:"","sort-orders":["ascending","descending"],width:120},{default:l(_=>[o("span",null,C(_.row.startDate?v(Y)(_.row.startDate):""),1)]),_:1}),a(h,{prop:"endDate",label:"End Date",sortable:"","sort-orders":["ascending","descending"],width:120},{default:l(_=>[o("span",null,C(_.row.endDate?v(Y)(_.row.endDate):""),1)]),_:1})]),_:1},8,["data"])]),footer:l(()=>[o("span",Ia,[a(i,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary",onClick:m},{default:l(()=>[B(" Cancel ")]),_:1}),a(i,{class:"btn btn-btech-secondary",onClick:U},{default:l(()=>[B(" Upload ")]),_:1})])]),_:1},8,["modelValue"]),a(I,{modelValue:F.value,"onUpdate:modelValue":b[1]||(b[1]=_=>F.value=_),title:P.value,"modal-class":"ironlake-dialog",width:"40%","align-center":""},{footer:l(()=>[La]),default:l(()=>[o("ul",Oa,[(y(!0),x(M,null,W(O.value,_=>(y(),x("li",{key:O.value.indexOf(_)},[o("p",$a,C(_),1)]))),128))])]),_:1},8,["modelValue","title"])],64)}}}),Pa=X(Fa,[["__scopeId","data-v-a8751f36"]]),ne=e=>(oe("data-v-7fc250bd"),e=e(),re(),e),xa={"element-loading-text":"Submitting Data","element-loading-background":"rgba(0, 0, 0, 0.5)"},Na=["element-loading-text"],Ea={class:"px-3 py-8 d-flex"},Ua=ne(()=>o("div",{class:"flex-grow-1"},[o("h5",{class:"m-0 header-title"},"Daily Outstanding Service")],-1)),Ta={class:"align-self-start d-flex gap-2"},Ca={class:"svg-icon svg-icon-btech-secondary-500 d-inline-block p-0"},qa=ne(()=>o("i",{class:"fas fa-file-upload text-btech-secondary-500 fs-4 pe-2"},null,-1)),Va=ne(()=>o("i",{class:"fas fa-plus fs-4 pe-2"},null,-1)),Aa={key:0,class:"ironlake-upload-progress mb-6 d-flex"},za=ne(()=>o("p",{class:"mb-0 me-2"},"Uploading",-1)),Ra={key:1,class:"card mb-6"},Ma={class:"m-0"},Ba={class:"text-btech-danger-500"},Ya=ne(()=>o("section",{class:"mb-6"},null,-1)),Ga={class:"card mb-10"},Wa={class:"card-body p-3"},Ha={class:"m-0 ironlake-pagination"},ja=J({__name:"Index",setup(e){const n=Ee(),s=le(),r=K(),d=ee(),p=de(),g=k=>{const c=k.isHO===1?"":k.SiteId;F.value&&(F.value.dataFilter.siteId=c),s.stateFilterForm.siteId=c},F=N();We(()=>p.user,async k=>{g(k),$()});const P=N(""),O=j(()=>s.pagination),E=k=>{s.stateFilterForm.pageSize=k,s.setPage(1)},R=k=>{P.value="",s.setPage(k)},$=async()=>{await r.getPsTypeLookup(),await s.setPage(1),r.getLookupSite(),r.getEquipmentNumberLookup(),r.getStatusLookup(),r.getShiftLookup()},m=N(!1),U=()=>{m.value=!0},L=async k=>{m.value=!1,k&&await $()},b=async()=>{const k=await d.downloadBulkTemplate();Fe.saveAs(new Blob([k],{type:"application/octet-stream"}),"Outstanding Service.xlsx")},D=N(null),t=()=>{var k;(k=D.value)==null||k.click()},h=async k=>{d.stateAlert.show=!1;const c=k.target.files[0];await d.upload(c),I(),D.value&&(D.value.value="")},u=j(()=>d.stateUploadProgress),i=N(),I=()=>{d.stateGatewayData.length>0?i.value.showGatewayDialog=!0:(s.resetFilter(),$())},_=N(["draftPanel"]);return He(async()=>{n[Ue.ACTIVE_PAGE]("IronLake"),s.stateLoading=!0,p.user!==void 0&&(s.statePaginationLoading=!0,g(p.user),$())}),je(async()=>{s.$reset(),r.$reset(),d.$reset()}),(k,c)=>{const T=S("inline-svg"),V=S("el-button"),f=S("el-tooltip"),pe=S("el-progress"),me=S("el-collapse-item"),w=S("el-collapse"),Se=ce("loading");return y(),x(M,null,[o("template",null,[Z(o("div",xa,null,512),[[Se,v(r).loading,void 0,{fullscreen:!0,lock:!0}]]),Z(o("div",{"element-loading-text":v(d).loadingMessage,"element-loading-background":"rgba(0, 0, 0, 0.5)"},null,8,Na),[[Se,v(d).loading,void 0,{fullscreen:!0,lock:!0}]])]),o("section",Ea,[Ua,o("div",Ta,[a(f,{class:"box-item",effect:"dark",content:"Download Outstanding Service Template",placement:"top"},{default:l(()=>[a(V,{class:"btn btn-icon btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",onClick:b},{default:l(()=>[o("span",Ca,[a(T,{src:"/media/icons/bumaau/excel.svg",style:{width:"1.25rem",height:"1.25rem"}})])]),_:1})]),_:1}),a(V,{class:"btn btn-outline btn-outline-btech-secondary btn-active-light-btech-secondary btech-lg m-0",onClick:t},{default:l(()=>[qa,B(" Upload ")]),_:1}),o("input",{ref_key:"uploadBulk",ref:D,type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",hidden:"",onChange:h},null,544),a(V,{class:"btn btn-btech-secondary btech-lg m-0",onClick:U},{default:l(()=>[Va,B(" Add New ")]),_:1})])]),u.value?(y(),x("section",Aa,[za,a(pe,{percentage:u.value,width:500},null,8,["percentage"])])):H("",!0),a(Ce,{"show-alert":v(d).stateAlert.show,"onUpdate:showAlert":c[0]||(c[0]=G=>v(d).stateAlert.show=G),variant:v(d).alertVariant,desc:v(d).alertDesc},null,8,["show-alert","variant","desc"]),v(d).stateDraftData.length>0?(y(),x("section",Ra,[a(w,{modelValue:_.value,"onUpdate:modelValue":c[1]||(c[1]=G=>_.value=G),class:"card-body p-3 ironlake-draft-collapse"},{default:l(()=>[a(me,{name:"draftPanel"},{title:l(()=>[o("p",Ma,[B(" Need Review "),o("span",Ba," ("+C(v(d).stateDraftData.length)+") ",1)])]),default:l(()=>[Ya,a(vt,{class:"mb-6","list-data":v(d).stateDraftData,onShowForm:U,onLoadPage:$},null,8,["list-data"])]),_:1})]),_:1},8,["modelValue"])])):H("",!0),o("section",Ga,[o("div",Wa,[a(Pt,{ref_key:"tableFilterRef",ref:F,"search-data":P.value,"onUpdate:searchData":c[2]||(c[2]=G=>P.value=G)},null,8,["search-data"]),a(zt,{class:"mb-6",search:P.value,onShowForm:U},null,8,["search"]),o("div",Ha,[v(s).paginationLoading?H("",!0):(y(),A(Te,{key:0,currentPage:O.value.currentPage,totalPage:O.value.totalPage,totalPageSize:O.value.totalPageSize,startPaginationIndex:O.value.startPaginationIndex,endPaginationIndex:O.value.endPaginationIndex,isPageSizeChange:!0,onRaiseSizeChange:c[3]||(c[3]=G=>E(G)),onRaisePageChange:c[4]||(c[4]=G=>R(G))},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))])])]),a(_a,{visibility:m.value,onHandleClose:L},null,8,["visibility"]),a(Pa,{ref_key:"draftGateDialog",ref:i},null,512)],64)}}}),Ys=X(ja,[["__scopeId","data-v-7fc250bd"]]);export{Ys as default};
