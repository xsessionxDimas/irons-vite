import{d}from"./pinia-BjOS2_Ao.js";import{u as r}from"./authentication-handler-Pueb_EI7.js";import{c as o,s as i}from"./index-BuVmIl8K.js";const m="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_sos/get_sos_history",u="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_sos/get_sos_compartment?ver=v1",y="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_sos/get_print_sos_history?ver=v1",c="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_sos/generate_label?ver=v1",h="https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/service_sheet_sos/update_task?ver=v1",S="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/oil_type/lookup?ver=v1",L="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/oil_grade/lookup?ver=v1",g="https://digital-bumaau-dev-apm-001.azure-api.net/amadm/api/master_data/coolant/lookup?ver=v1",_=d({id:"sos",state:()=>({stateSosHistory:[],stateSosHistoryOptions:[],stateSelectedSosHistory:{},stateSosCompartment:[],stateSelectedSosCompartment:[],stateSosLabel:{},stateGeneratedLabel:[],stateSosLabelBefore:{},stateErrorField:[{field:"sampleDate",items:[]},{field:"lastMeterHrs",items:[]},{field:"fuelBurn",items:[]}],stateEmployeeData:{id:"",name:""},statePayloadEdit:{id:"",workOrder:"",employee:{},updateParams:[{keyValue:"",propertyParams:[]}]},stateAlertVisibility:!1,stateAlertType:"success",stateAlertMessage:"",stateIsSaveDisabled:!0,stateOilTypeList:[],stateOilGradeList:[],stateCoolantList:[]}),getters:{SosHistory:t=>t.stateSosHistory,SosHistoryOptions:t=>t.stateSosHistoryOptions,SelectedSosHistory:t=>t.stateSelectedSosHistory,SosCompartment:t=>t.stateSosCompartment,FormattedSosCompartment:t=>Object.keys(t.stateSosCompartment).length?t.stateSosCompartment.map(a=>({value:a.taskKeyOilSample,label:a.compartmentLubricant,status:a.errorMsg,labelNumber:a.label})):[],SelectedSosCompartment:t=>t.stateSelectedSosCompartment,SosLabel:t=>t.stateSosLabel,SosGeneratedLabel:t=>t.stateGeneratedLabel,SosEditErrors:t=>t.stateErrorField,AlertVisibility:t=>t.stateAlertVisibility,AlertType:t=>t.stateAlertType,AlertMessage:t=>t.stateAlertMessage,IsSaveDisabled:t=>t.stateIsSaveDisabled,OilTypeList:t=>t.stateOilTypeList,OilGradeList:t=>t.stateOilGradeList,CoolantList:t=>t.stateCoolantList},actions:{async getSosHistory(t){try{const e={ver:"v1",siteId:"AU03"},a=await o.get(m,"",new URLSearchParams(e).toString());this.stateSosHistory=a.data.result.content,this.formatSosHistoryOptions()}catch(e){r(e),i("IRONS",e),console.log(e)}},formatSosHistoryOptions(){this.stateSosHistoryOptions=this.stateSosHistory.map(t=>({label:`${t.equipment} - ${t.modelId} - ${t.psTypeId==null?"":t.psTypeId+" Hr Service - "}${t.workOrder} - ${t.eformType}`,value:t.workOrder}))},setSelectedSos(t){const e=this.stateSosHistory.find(a=>a.workOrder==t.value);e&&(this.stateSelectedSosHistory=e)},async getSosCompartment(t){try{const e=await o.post(u,t);this.stateSosCompartment=e.data.result.content}catch(e){r(e),i("IRONS",e),console.log(e)}},checkLatestCompartmentList(){const t=this.stateSosCompartment.filter(a=>a.isError==="False").map(a=>a.taskKeyOilSample),e=this.stateSelectedSosCompartment.filter(a=>t.includes(a.value));this.stateSelectedSosCompartment=e},checkSortSelectedCompartment(){const t={};this.stateSosCompartment.forEach((e,a)=>{t[e.taskKeyOilSample]=a}),this.stateSelectedSosCompartment.sort((e,a)=>t[e.value]-t[a.value])},async getLabelData(t){try{const e=await o.post(y,t);this.stateSosLabel=e.data.result.content,this.generatePayloadEdit(),this.generateErrorField()}catch(e){r(e),i("IRONS",e),console.log(e)}},async generateLabel(t){try{const e=await o.post(c,t);return e&&e.data.statusCode==200&&(this.stateGeneratedLabel=e.data.result.content,this.mapGeneratedLabel()),e}catch(e){r(e),i("IRONS",e),console.log(e)}},mapGeneratedLabel(){for(let t=0;t<this.stateSosLabel.details.length;t++)for(let e=0;e<this.stateGeneratedLabel.length;e++)this.stateSosLabel.details[t].key==this.stateGeneratedLabel[e].taskKey&&(this.stateSosLabel.details[t].label=this.stateGeneratedLabel[e].label)},updateSosData(t,e,a){this.stateSosLabel.details[e][t]=a,this.updatePayload(t,e,a)},updatePayloadGeneralData(t,e){this.showChangesWarning();const a=this.statePayloadEdit.updateParams.findIndex(s=>s.keyValue===this.stateSosLabel.key),l=this.statePayloadEdit.updateParams[a].propertyParams.findIndex(s=>s.propertyName==t);l!==-1?this.statePayloadEdit.updateParams[a].propertyParams[l].propertyValue=e:this.statePayloadEdit.updateParams[a].propertyParams.push({propertyName:t,propertyValue:e})},updatePayload(t,e,a){this.showChangesWarning();const l=this.stateSosLabel.details[e].key;this.statePayloadEdit.updateParams.forEach(s=>{if(s.keyValue==l){const n=s.propertyParams.findIndex(p=>p.propertyName===t);n!==-1?s.propertyParams[n].propertyValue=a:s.propertyParams.push({propertyName:t,propertyValue:a})}})},generatePayloadEdit(){this.statePayloadEdit.id=this.stateSosLabel.id,this.statePayloadEdit.workOrder=this.stateSosLabel.workOrder;const t=[];this.stateSosLabel.details.forEach(e=>{t.push({keyValue:e.key,propertyParams:[{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]})}),t.push({keyValue:this.stateSosLabel.key,propertyParams:[{propertyName:"updatedDate",propertyValue:"<<ServerDateTime>>"}]}),this.statePayloadEdit.updateParams=t},generateErrorField(){for(let t=0;t<this.stateSosLabel.details.length;t++)this.stateErrorField[0].items.push({message:""}),this.stateErrorField[1].items.push({message:""}),this.stateErrorField[2].items.push({message:""})},async saveLabelDataChanged(){this.updateEmployeeOnPayload();try{return await o.post(`${h}&Eform=${this.stateSosLabel.eformType}`,this.statePayloadEdit)}catch(t){r(t),i("IRONS",t),console.log(t)}},updateEmployeeOnPayload(){this.statePayloadEdit.employee=this.stateEmployeeData,this.statePayloadEdit.updateParams.forEach(t=>{t.propertyParams.push({propertyName:"updatedBy",propertyValue:JSON.stringify(this.stateEmployeeData)})})},showChangesWarning(){this.stateAlertType="warning",this.stateAlertMessage="You've just made some changes and might need to be saved",this.stateAlertVisibility=!0,this.stateIsSaveDisabled=!1},resetPayload(){this.statePayloadEdit={id:"",workOrder:"",employee:{},updateParams:[{keyValue:"",propertyParams:[]}]},this.generatePayloadEdit()},updateErrorWarning(t,e,a){this.stateErrorField[t].items[e].message=a},async getOilTypeList(){try{const t=await o.get(S);t.data.result.content?this.stateOilTypeList=t.data.result.content:this.stateOilTypeList=[]}catch(t){r(t),i("IRONS",t),console.log(t)}},async getOilGradeList(t){try{const e=await o.get(L+`&oilTypeId=${t}`);e.data.result.content?this.stateOilGradeList=e.data.result.content:this.stateOilGradeList=[]}catch(e){r(e),i("IRONS",e),console.log(e)}},async getCoolantList(){try{const t=await o.get(g);t.data.result.content?this.stateCoolantList=t.data.result.content:this.stateCoolantList=[]}catch(t){r(t),i("IRONS",t),console.log(t)}}}});export{_ as u};
