import{k as ne,r as i,a0 as ge,c as R,p as s,aa as l,s as b,x as F,q as me,A as C,F as E,R as H,Y as ke,aB as e,y as De,C as _,b4 as T,$ as Z,P as ve,bd as le,bb as oe,u as $}from"./@vue-BypzYtbH.js";import{u as Ce}from"./useInterimEngineStore-Ctq4w8Oq.js";import{u as re}from"./useInterimDefectsStore-DCjj_hjG.js";import{c as Se}from"./index-BuVmIl8K.js";import{e as se}from"./lodash-DrHMlsdo.js";import{_ as Ae}from"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import{s as $e}from"./string-to-imageinfo-converter-Cdr1iOkP.js";import{G as ae,c as Me,d as fe,a as be}from"./cbm-helper-BxJZ9NTc.js";import{_ as Ie}from"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import{_ as Be}from"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import{_ as Ne}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{a as Re}from"./element-plus-BeWdvTRa.js";import{N as he}from"./number-format-BdMuQVyW.js";import{I as Ve}from"./IronformConfig-BWypCgSI.js";import{_ as ce}from"./nw-img-vue-CR837WER.js";import{b as Ue,c as Ee,d as xe}from"./manipulate-html-string-DqTEGh-F.js";import{_ as Pe}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{k as ye,l as je}from"./helpers-wUOLw-dU.js";import{_ as Oe}from"./Check-CTArJpdm.js";import{N as Fe}from"./NAForm-BdrJ0TGj.js";import{b as He}from"./useDefectsFormStore-41UTMhiG.js";import{u as qe}from"./useCameraStore-BwXVJhPe.js";import{S as Te}from"./SMUDetailDialog-Bs-98WGo.js";import{b as Le}from"./vue-router-iNp9kJ0K.js";const G=t=>(le("data-v-d1ef563e"),t=t(),oe(),t),ze=G(()=>e("span",{class:"el-dialog__title",style:{"text-align":"start"}},null,-1)),Ge={class:"ps-3"},Ye=G(()=>e("h3",null,"Detailed Information",-1)),Ke=G(()=>e("div",{class:"d-flex flex-row justify-content-between"},[e("div",{class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"No")]),e("div",{class:"col text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Location")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Measurement Value")]),e("div",{class:"col-1 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"UoM")]),e("div",{class:"col-2 text-start px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-top":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},[e("label",null,"Rating")])],-1)),We={class:"d-flex flex-row justify-content-between"},Je={class:"col-1 text-center px-2 py-2",style:{"background-color":"rgb(249, 250, 251)","border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-left":"1px solid rgba(145, 158, 171, 0.24)"}},Qe={class:"col text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Xe={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},Ze={class:"col-1 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)"}},et={class:"col-2 text-start px-2 py-2",style:{"border-bottom":"1px solid rgba(145, 158, 171, 0.24)","border-right":"1px solid rgba(145, 158, 171, 0.24)"}},tt=G(()=>e("h3",{class:"mt-3"},"Detail Spec",-1)),at={class:"table table-bordered",style:{width:"500px"}},st=G(()=>e("caption",null,null,-1)),nt=G(()=>e("thead",null,[e("tr",{style:{background:"#70AD47"}},[e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Rating"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Min"),e("th",{scope:"col",class:"table-header",style:{"border-right":"1px solid white"}},"Value Max"),e("th",{scope:"col",class:"table-header"},"UoM")])],-1)),lt={scope:"row",style:{"border-right":"1px solid white","padding-left":"10px"}},ot={scope:"row",style:{"border-right":"1px solid white"}},rt={scope:"row",style:{"border-right":"1px solid white"}},ct={scope:"row"},it=G(()=>e("h3",{class:"mt-3"},"Detailed picture",-1)),dt={class:"row my-4"},ut={class:"bg-secondary"},pt=["src","onClick"],mt={key:2,class:"mt-1 py-2",style:{"word-break":"break-word !important"}},ft=G(()=>e("div",{class:"desc-label"},"Approval Comment",-1)),vt={class:"d-flex flex-column"},gt="CBM Successfully Confirmed",bt=ne({__name:"CBMInfo",props:{visibility:{required:!0,type:Boolean},cbmIsConfirmed:{required:!1,type:Boolean,default:!0},cbmData:{required:!0,type:Object},viewOnly:{required:!1,type:Boolean,default:!1}},emits:["closeForm","onApproveCbm"],setup(t,{emit:Y}){const f=t,V=Y,a=Ce(),P=re(),x=i(!1),N=i([]),S=i([]),k=i([]),h=i([]),M=i(""),v=i(""),j=i(""),O=i(!0),g=i(!1),y=i(!1),I=i(""),d=B=>{const m=h.value.findIndex(q=>q.imgBlob==B),D=h.value[m];if(m>0){const q=h.value.slice(m),te=h.value.slice(0,m);h.value=[...q,...te]}M.value=D.url,x.value=!0},n=()=>{M.value="",x.value=!1},u=ge(f,"visibility"),c=ge(f,"cbmData"),o=i([]),L=i(!1),W=i([]),ee=B=>{const m=N.value.find(D=>D.key==B);return(m==null?void 0:m.value)??""},ie=async()=>{if(W.value=[],!(k.value.length<1))for(const[B,m]of k.value.entries()){const D={fileUrl:`${m.filename}`,ver:"v1"};try{const q=`https://digital-bumaau-dev-apm-001.azure-api.net/dinspect/api/attachment/download_by_url?${new URLSearchParams(D).toString()}`,de=(await Se.getBlob(q)).data,ue=new Blob([de]),K=(window.URL||window.webkitURL).createObjectURL(ue);N.value.push({key:m.filename,value:K}),h.value.forEach(pe=>{pe.imgBlob==m.filename&&(pe.url=K)}),S.value[B]=!1}catch(q){console.log("image",q)}}},r=()=>{V("closeForm")},p=R(()=>c.value.taskNo.replace(/[^a-z]/gi,"").length>1?c.value.taskNo.replace(";","").replace(/\D/g,""):c.value.taskNo.replace(";","")),A=async()=>{L.value=!0,v.value="",O.value=!0,j.value="";const B=a.stateCBMFormulas.filter(D=>D.taskKey===c.value.taskId);o.value=se.orderBy(B,["uom","cbmRating","minValue"]);const m=await P.getDefectImages(c.value.serviceSheetDetailId,c.value.cbmImageKey,c.value.cbmImageProp);k.value=$e(m),S.value=Array.apply(null,Array(k.value.length)).map(function(){return!0}),h.value=k.value.map(D=>({imgBlob:D.filename,url:"",description:D.description})),await ie(),L.value=!1},z=B=>{v.value=B.value,j.value="",O.value=!0},J=()=>{if(Ve.isSPVPlannerMandatoryInputCommentOnApproveCBM&&!v.value){j.value="Approval Comment is required",O.value=!1;return}const B=Re.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});V("onApproveCbm",{headerId:f.cbmData.id,reason:v.value,callback:(m,D)=>{B.close(),m?(I.value=D,y.value=!0):U()}})},X=()=>{y.value=!1,I.value!=he.NO_NETWORK_VIEW&&r()},U=()=>{g.value=!0,setTimeout(()=>{g.value=!1,X()},1e3)};return(B,m)=>{const D=H("el-input"),q=H("el-skeleton-item"),te=H("el-skeleton"),de=H("el-dialog"),ue=ke("loading");return s(),l(E,null,[b(de,{modelValue:u.value,"onUpdate:modelValue":m[2]||(m[2]=w=>u.value=w),"custom-class":"crackform dialog-header-noborder",width:"90%",center:"",onClosed:r,onOpened:A,"destroy-on-close":!0},{title:F(()=>[ze]),default:F(()=>[e("div",null,[De((s(),l("div",Ge,[Ye,t.cbmData.appSPVBy?(s(),l(E,{key:0},[b(ae,{message:`${t.cbmData.appSPVDate} - ${t.cbmData.appSPVBy.name}`,"placeholder-message":"Approved by Supervisor"},null,8,["message"]),t.cbmData.approveReason?(s(),me(ae,{key:0,message:`${t.cbmData.approveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):C("",!0)],64)):C("",!0),t.cbmData.appPlannerBy?(s(),l(E,{key:1},[b(ae,{message:`${t.cbmData.appPlannerDate} - ${t.cbmData.appPlannerBy.name}`,"placeholder-message":"Approved by Planner"},null,8,["message"]),t.cbmData.plannerApproveReason?(s(),me(ae,{key:0,message:`${t.cbmData.plannerApproveReason}`,"placeholder-message":"Approval Comment"},null,8,["message"])):C("",!0)],64)):C("",!0),Ke,e("div",We,[e("div",Je,[e("label",null,_(p.value),1)]),e("div",Qe,[e("label",null,_(c.value.taskDesc),1)]),e("div",Xe,[b(D,{size:"small",class:"dark-text-primary",modelValue:c.value.cbmMeasurement,"onUpdate:modelValue":m[0]||(m[0]=w=>c.value.cbmMeasurement=w),disabled:!0},null,8,["modelValue"])]),e("div",Ze,[e("label",null,_(c.value.cbmUom),1)]),e("div",et,[b(D,{size:"small",modelValue:c.value.taskValue,"onUpdate:modelValue":m[1]||(m[1]=w=>c.value.taskValue=w),class:T(c.value.taskValue==="C"?"c":"x"),disabled:!0},null,8,["modelValue","class"])])]),tt,e("div",null,[e("table",at,[st,nt,e("tbody",null,[(s(!0),l(E,null,Z(o.value,(w,K)=>(s(),l("tr",{key:K,class:T(K%2==0?"even":"odd")},[e("th",lt,_(w.cbmRating),1),e("th",ot,_(w.minValueComplete),1),e("th",rt,_(w.maxValueComplete),1),e("th",ct,_(w.uom),1)],2))),128))])])]),it,e("div",dt,[(s(!0),l(E,null,Z(k.value,(w,K)=>(s(),l("div",{class:"col-md-3 fv-row fv-plugins-icon-container p-2 rounded position-relative",key:w.filename},[b(te,{loading:S.value[K],animated:""},{template:F(()=>[b(q,{variant:"image",class:"w-100 rounded",style:{height:"200px","object-fit":"fill"}})]),default:F(()=>[e("div",ut,[ee(w.filename)!=null?(s(),l("img",{key:0,src:ee(w.filename),class:"w-100 rounded",style:{height:"200px","object-fit":"contain",cursor:"pointer"},alt:"images",onClick:pe=>d(w.filename)},null,8,pt)):C("",!0)])]),_:2},1032,["loading"])]))),128))]),!t.cbmIsConfirmed&&!t.viewOnly?(s(),l("div",mt,[ft,e("div",vt,[b(Ie,{value:v.value??"","disable-floating":!0,name:"approveReason",max:255,"is-valid":O.value,"error-message":j.value,onHandleChange:z},null,8,["value","is-valid","error-message"])]),e("button",{class:"mt-2 btn btn-success w-100",onClick:ve(J,["prevent"]),style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"}},"Approve")])):C("",!0)])),[[ue,L.value]])])]),_:1},8,["modelValue"]),x.value?(s(),me(Ae,{key:0,images:h.value,visibility:x.value,image:M.value,onHandleClose:n},null,8,["images","visibility","image"])):C("",!0),b(Be,{show:g.value,message:gt},null,8,["show"]),b(Ne,{show:y.value,onClose:X,message:I.value,icon:"/media/svg/dma/alert.svg"},null,8,["show","message"])],64)}}}),ht=ce(bt,[["__scopeId","data-v-d1ef563e"]]),_e=t=>(le("data-v-ec38db44"),t=t(),oe(),t),xt={class:"mt-5 ps-0"},yt=_e(()=>e("div",{class:"row px-2 item mx-1 w-100 defect-panel-header"},[e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"}," Task"),e("div",{class:"col align-items-center d-flex text-break"},"Task Description"),e("div",{class:"col align-items-center d-flex text-break"},"Comments"),e("div",{class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"}," Rating"),e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"}," Review Status")],-1)),_t={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},wt=_e(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),kt=[wt],Dt={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Ct={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},St={class:"col align-items-center d-flex text-break"},At=["innerHTML"],$t={class:"col align-items-center d-flex text-break"},Mt={class:"text-break"},It={class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},Bt={style:{"font-weight":"600",color:"white"}},Nt={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},Rt=["onClick"],Vt={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Ut=ne({__name:"CBMPanel",props:{headers:{required:!0,type:[]},plannerApprove:{required:!1,type:Boolean,default:!1},isDisabled:{required:!1,type:Boolean,default:!1},defectStatus:{required:!1,type:String,default:""}},emits:["onRefreshData"],setup(t,{emit:Y}){const f=t,V=Y,a=re(),P=i("Component Condition Data"),x=i(),N=i(!1),S=i(!1),k=R(()=>{var g,y;return f.plannerApprove?((g=x.value)==null?void 0:g.plannerCbmNAStatus)==="Confirmed":((y=x.value)==null?void 0:y.cbmNAStatus)==="Confirmed"}),h=g=>{const y=f.headers.find(I=>I.id===g);x.value=y,N.value=!0},M=async g=>{try{a.ApprovalData.CBMHeaders.find(I=>I.id===g.headerId)&&(f.plannerApprove?await a.updatePlannerCBMConfirmedStatus(g.headerId,g.reason):await a.updateCBMConfirmedStatus(g.headerId,g.reason),g.callback&&(V("onRefreshData"),g.callback(a.IsError,a.ErrorMessage)))}catch(y){console.log(y)}},v=()=>{S.value=!1,a.stateErrorMessage!=he.NO_NETWORK_VIEW&&(a.resetErrorStatus(),j())},j=()=>{V("onRefreshData")},O=()=>{N.value=!1};return(g,y)=>{const I=H("el-collapse-item"),d=H("el-collapse");return s(),l(E,null,[e("div",xt,[b(d,{class:"task-group general-accordion py-1 px-5 testing",modelValue:P.value,"onUpdate:modelValue":y[0]||(y[0]=n=>P.value=n)},{default:F(()=>[b(I,{title:"Condition Data",name:"Component Condition Data"},{default:F(()=>[yt,t.headers.length<1?(s(),l("div",_t,kt)):(s(!0),l(E,{key:1},Z(t.headers,n=>(s(),l("div",{key:n.id,class:"item px-2 my-2 mx-1"},[e("div",Dt,[e("div",Ct,_($(Ue)(n.taskNo.replace(";",""))),1),e("div",St,[e("span",{class:"text-break defect-identified-task",innerHTML:$(Ee)(n.taskDesc,n.taskNo.replace(";",""))},null,8,At)]),e("div",$t,[e("span",Mt,_(n.commentValue),1)]),e("div",It,[e("div",{class:T(["little-box d-flex justify-content-center align-items-center px-2",$(Me)(n.taskValue)])},[e("span",Bt,_(n.taskValue),1)],2)]),e("div",Nt,[e("div",{class:T(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",$(ye)(n.id,t.headers,!t.plannerApprove,"cbmNAStatus","plannerCbmNAStatus",t.isDisabled,t.defectStatus)]),onClick:ve(u=>h(n.id),["prevent"])}," Detailed Information ",10,Rt)])]),e("div",Vt,_(n.createdBy.name)+", "+_(n.updatedDate!=""?n.updatedDate:n.createdDate),1)]))),128))]),_:1})]),_:1},8,["modelValue"])]),b(ht,{visibility:N.value,"cbm-data":x.value,"cbm-is-confirmed":k.value,onCloseForm:O,onOnApproveCbm:M},null,8,["visibility","cbm-data","cbm-is-confirmed"]),b(Pe,{visibility:S.value,caption:$(a).stateErrorMessage,onOnClose:v},null,8,["visibility","caption"])],64)}}}),Ya=ce(Ut,[["__scopeId","data-v-ec38db44"]]),Q=t=>(le("data-v-309d8214"),t=t(),oe(),t),Et={class:"mt-5 ps-0"},Pt={class:"row px-2 item mx-1 w-100 defect-panel-header"},jt=Q(()=>e("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Ot=Q(()=>e("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Ft=Q(()=>e("div",{class:"col align-items-center d-flex text-break"},"Comments",-1)),Ht={key:0,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},qt={key:1,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},Tt={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Lt=Q(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),zt=[Lt],Gt={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Yt={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},Kt={class:"col align-items-center d-flex text-break"},Wt=["innerHTML"],Jt={class:"col align-items-center d-flex text-break"},Qt={class:"text-break"},Xt=["onClick"],Zt=["onClick"],ea={key:0,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent align-items-center d-flex justify-content-center"},ta={key:1,class:"col-1 column-sm-20-percent column-md-11-percent column-lg-11-percent column-xl-11-percent justify-content-center align-items-center d-flex"},aa=["onClick"],sa={key:1,src:Oe,style:{width:"28px"},alt:""},na={key:2,class:"ms-1 d-flex align-items-center"},la=Q(()=>e("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),oa=Q(()=>e("span",null,"Loading...",-1)),ra=[la,oa],ca={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},ia=ne({__name:"NAPanel",props:{title:{required:!0,type:String},isDefect:{required:!0,type:Boolean,default:!0},headers:{required:!0,type:[]},plannerApprove:{required:!1,type:Boolean,default:!1},isDisabled:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData","onGetPositionY"],setup(t,{emit:Y}){const f=t,V=Y,a=re(),P=i(),x=i([]),N=R(()=>f.title);f.headers.forEach(()=>{x.value.push(!1)});const S=i(!1),k=i(),h=i(),M=()=>{S.value=!1},v=R(()=>!f.plannerApprove),j=async d=>{f.plannerApprove?(await a.updatePlannerDefectDeclineStatus(d.headerId,d.reason),d.afterSubmit(a.stateIsError,a.stateErrorMessage)):(await a.updateDefectDeclineStatus(d.headerId,d.reason),d.afterSubmit(a.stateIsError,a.stateErrorMessage))},O=async d=>{const{headerId:n,reason:u="",afterSubmit:c}=d;f.plannerApprove?(await a.updatePlannerDefectConfirmedStatus(n),c(a.stateIsError,a.stateErrorMessage)):(await a.updateDefectConfirmedStatus(n,u),c(a.stateIsError,a.stateErrorMessage))},g=d=>{V("onGetPositionY"),k.value=void 0,h.value=void 0;const n=d.id;let u=a.ApprovalData.DefectNADetails.find(o=>o.defectHeaderId==n),c=d;u?(S.value=!0,k.value=c,h.value=u):(u=a.ApprovalData.CrackNADetails.find(o=>o.defectHeaderId==n),u&&(S.value=!0,k.value=c,h.value=u))},y=async(d,n)=>{if(!(!be()||f.isDisabled))if(f.isDefect){const u=a.ApprovalData.DefectNAHeaders.find(c=>c.id===d);if(u){if(f.plannerApprove){if(!se.isUndefined(u.plannerCbmNAStatus)&&u.plannerCbmNAStatus==="Confirmed")return}else if(u.cbmNAStatus==="Confirmed")return;x.value[n]=!0,f.plannerApprove?await a.updatePlannerDefectConfirmedStatus(d):await a.updateDefectConfirmedStatus(d),P.value.handleErrorMessage(a.stateIsError,a.stateErrorMessage),x.value[n]=!1}}else{const u=a.ApprovalData.CrackNAHeaders.find(c=>c.id===d);if(u){if(f.plannerApprove){if(!se.isUndefined(u.plannerCbmNAStatus)&&u.plannerCbmNAStatus==="Confirmed")return}else if(u.cbmNAStatus==="Confirmed")return;x.value[n]=!0,f.plannerApprove?await a.updatePlannerCrackConfirmedStatus(d):await a.updateCrackConfirmedStatus(d),P.value.handleErrorMessage(a.stateIsError,a.stateErrorMessage),x.value[n]=!1}}},I=()=>{V("onRefreshData")};return(d,n)=>{const u=H("el-collapse-item"),c=H("el-collapse");return s(),l(E,null,[e("div",Et,[b(c,{class:"task-group general-accordion py-1 px-5 testing",modelValue:N.value,"onUpdate:modelValue":n[0]||(n[0]=o=>N.value=o)},{default:F(()=>[b(u,{title:t.title,name:t.title},{default:F(()=>[e("div",Pt,[jt,Ot,Ft,e("div",{class:T([[v.value?"col justify-content-end pe-16":"col-1 justify-content-center"],"column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex"])},"Review Status",2),v.value?C("",!0):(s(),l("div",Ht)),v.value?C("",!0):(s(),l("div",qt,"Confirmed"))]),t.headers.length<1?(s(),l("div",Tt,zt)):(s(!0),l(E,{key:1},Z(t.headers,(o,L)=>(s(),l("div",{key:o.id,class:"item px-2 my-2 mx-1"},[e("div",Gt,[e("div",Yt,_(o.taskNo.replace(";","")),1),e("div",Kt,[e("span",{class:"text-break defect-identified-task",innerHTML:$(xe)(o.taskDesc)},null,8,Wt)]),e("div",Jt,[e("span",Qt,_(o.commentValue),1)]),e("div",{class:T([[v.value?"col justify-content-end":"col-1 justify-content-center"],"column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex"])},[o.plannerCbmNAStatus=="Decline"||o.cbmNAStatus=="Decline"?(s(),l("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:W=>g(o)}," Declined ",8,Xt)):(s(),l("div",{key:1,class:T(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",$(ye)(o.id,t.headers,!0,"cbmNAStatus","plannerCbmNAStatus")]),onClick:ve(W=>g(o),["prevent"])}," Detailed Information ",10,Zt))],2),v.value?C("",!0):(s(),l("div",ea)),v.value?C("",!0):(s(),l("div",ta,[o.cbmNAStatus!="Decline"?(s(),l("div",{key:0,class:T(["mx-10 little-box rounded-circle d-flex justify-content-center align-items-center flex-fill cbm-confirm-checkbox flex-column",$(fe)(o.id,t.headers,t.plannerApprove)&&$(be)()?t.isDisabled?"not-allowed":"dot":"not-allowed"])},[$(fe)(o.id,t.headers,t.plannerApprove)?(s(),l("div",{key:0,class:"little-dot",onClick:W=>y(o.id,L)},null,8,aa)):C("",!0),$(fe)(o.id,t.headers,t.plannerApprove)?C("",!0):(s(),l("img",sa)),x.value[L]?(s(),l("div",na,ra)):C("",!0)],2)):C("",!0)]))]),e("div",ca,_(o.createdBy.name)+", "+_(o.updatedDate!=""?o.updatedDate:o.createdDate),1)]))),128))]),_:1},8,["title","name"])]),_:1},8,["modelValue"])]),b(Fe,{ref_key:"NAFormComponent",ref:P,"view-only":t.isDisabled||!v.value,visibility:S.value,"na-data-header":k.value,"na-data-detail":h.value,onClose:M,onOnSubmitDecline:j,onOnSubmitConfirm:O,onOnRefreshData:I},null,8,["view-only","visibility","na-data-header","na-data-detail"])],64)}}}),Ka=ce(ia,[["__scopeId","data-v-309d8214"]]),we=t=>(le("data-v-afcc5cb7"),t=t(),oe(),t),da={class:"mt-0 ps-0"},ua=we(()=>e("div",{class:"row px-2 item mx-1 w-100 defect-panel-header"},[e("div",{class:"col align-items-center d-flex text-break"},"Task Description"),e("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Status"),e("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status")],-1)),pa={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ma=we(()=>e("p",{style:{"text-align":"center"}},"No data recorded",-1)),fa=[ma],va={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},ga={class:"col align-items-center d-flex text-break"},ba=["innerHTML"],ha={class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},xa={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},ya=["onClick"],_a={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},wa=ne({__name:"DefectSMUPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData","onGetPositionY"],setup(t,{emit:Y}){const f=t,V=Le(),a=re(),P=qe(),x=He(),N=Y,S=i("SMU Machine Acknowledgement"),k=i(""),h=i(!1),M=R(()=>a.ApprovalData.SMUDefectHeaders),v=R(()=>a.DefectSMUHeader),j=R(()=>a.DefectSMUDetail),O=R(()=>{const r=x.Ownership;return je(r)}),g=R(()=>({isError:a.stateErrorMessage!="",messages:a.stateErrorMessage})),y=R(()=>{if(v.value){const{plannerStatus:r,updatedBy:p,updatedDate:A}=v.value;return{plannerStatus:r,updatedBy:p,updatedDate:A}}}),I=R(()=>{if(v.value){const{approvedBy:r,approvedDate:p,status:A}=v.value;return{approvedBy:r,approvedDate:p,status:A}}}),d=r=>!r.toLowerCase().includes("not"),n=(r,p)=>{let A="light-yellow color-dark-yellow";const z=p==null?void 0:p.find(J=>J.id===r);if(f.supervisor){if(z)switch(z.status){case"Submited":A="light-yellow color-dark-yellow";break;case"Acknowledge":A="light-green color-dark-green";break}}else!se.isUndefined(z.plannerStatus)&&z.plannerStatus&&(A="light-green color-dark-green");return A},u=async r=>{N("onGetPositionY"),P.setCurrent("defect");const p=a.setSMUDefectData(r);f.plannerApprove&&a.HeaderStatus!="Decline"&&a.updateHeaderDefectSMU(r),k.value=r,p&&(h.value=!0)},c=()=>{N("onRefreshData")},o=async r=>{await a.updateDefectDetailSMU(r.newDetail),r.callback()},L=async r=>{await a.updatePlannerDefectAcknowledge(!0,r.newTitle),r.callback()},W=async r=>{await a.updateDefectAcknowledge(!0,r.newTitle),r.callback()},ee=()=>{a.resetErrorStatus()},ie=R(()=>{var r;if(M.value.length>0){const p=a.ApprovalData.SMUDefectDetails.find(A=>A.defectHeaderId==M.value[0].id)??null;if(p)return`${((r=p.updatedBy)==null?void 0:r.name)||p.createdBy.name}, ${p.updatedDate!=""?p.updatedDate:p.createdDate}`}return""});return(r,p)=>{var J,X;const A=H("el-collapse-item"),z=H("el-collapse");return s(),l(E,null,[e("div",da,[b(z,{class:"task-group general-accordion py-1 px-5 testing",modelValue:S.value,"onUpdate:modelValue":p[0]||(p[0]=U=>S.value=U)},{default:F(()=>[b(A,{title:"SMU Machine Acknowledgement",name:"SMU Machine Acknowledgement"},{default:F(()=>[ua,M.value.length<1?(s(),l("div",pa,fa)):(s(!0),l(E,{key:1},Z(M.value,U=>(s(),l("div",{key:U.id,class:"item px-2 my-2 mx-1"},[e("div",va,[e("div",ga,[e("span",{class:"text-break defect-identified-task",innerHTML:$(xe)(U.taskDesc)},null,8,ba)]),e("div",ha,_(d(U.taskDesc)?"In Range":"Out of Range"),1),e("div",xa,[e("div",{class:T(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",n(U.id,M.value)]),onClick:B=>u(U.id)}," Detailed Information ",10,ya)])]),e("div",_a,_(ie.value),1)]))),128))]),_:1})]),_:1},8,["modelValue"])]),b(Te,{show:h.value,"onUpdate:show":p[1]||(p[1]=U=>h.value=U),detailDefect:j.value,ownership:O.value,"view-only":!t.plannerApprove&&((J=v.value)==null?void 0:J.status)=="Acknowledge"||t.plannerApprove&&((X=v.value)==null?void 0:X.plannerStatus)=="Acknowledge"||$(V).path=="/ironforms/e-form"||$(V).path=="/ironforms/monitoring-status/preview",plannerApprove:t.plannerApprove,"error-status":g.value,"planner-data":y.value,"approval-s-p-v-data":I.value,onOnRefreshData:c,onUpdateDefectDetailSMU:o,onUpdatePlannerDefectAcknowledge:L,onUpdateDefectAcknowledge:W,onResetErrorStatus:ee},null,8,["show","detailDefect","ownership","view-only","plannerApprove","error-status","planner-data","approval-s-p-v-data"])],64)}}}),Wa=ce(wa,[["__scopeId","data-v-afcc5cb7"]]);export{Ya as C,Wa as D,Ka as N};
