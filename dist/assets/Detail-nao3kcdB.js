import{C as gt}from"./Cameras-vtENZZzD.js";import{u as Be}from"./useCameraStore-BwXVJhPe.js";import{u as Dt,I as wt,d as ht,S as kt,e as _t,_ as xt,D as bt,a as dt,b as ut,C as pt,c as Ct,N as ft}from"./DefectPanelGeneric-BYVMPBe-.js";import{k as Me,r as a,c as M,d as Fe,o as Te,p as m,aa as g,s as c,aB as t,x as de,u as v,F as oe,q as Qe,A as N,R as Se,$ as Ee,C as z,b4 as x,P as Ze,bd as et,bb as tt,y as St,a5 as It,B as At,a7 as Pt,L as Ot}from"./@vue-BypzYtbH.js";import{_ as Ve}from"./Repair-zyV2di4A.js";import{_ as nt}from"./document_download-C1p7j0nJ.js";import{u as We}from"./useDefectsStore-7BpSnT1n.js";import{_ as ot}from"./ImagePreviews.vue_vue_type_style_index_0_lang-BJGkhvcB.js";import{d as Xe}from"./manipulate-html-string-DqTEGh-F.js";import{p as Re,D as $t}from"./cbm-helper-BxJZ9NTc.js";import{e as xe}from"./lodash-DrHMlsdo.js";import{u as Ge}from"./useDefectSheetStore-85RM-z1z.js";import{b as Le,a as Ft,u as Nt}from"./useDefectsFormStore-41UTMhiG.js";import{I as yt}from"./DefectForm-eu6l4STx.js";import{u as rt}from"./useHistoricalEformDmaStore-Fo4tKNgB.js";import{p as st,c as lt,a as Ht}from"./helpers-BS1ZZpAr.js";import{d as jt,o as at,h as Ke,g as Ce,i as ze,v as mt}from"./helpers-wUOLw-dU.js";import{_ as it}from"./Confirmation.vue_vue_type_style_index_0_lang-HchphDdZ.js";import{_ as Ue}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{N as qe,A as Et}from"./number-format-BdMuQVyW.js";import{h as Ie}from"./date-format-8-IvfSl3.js";import{_ as ct}from"./nw-img-vue-CR837WER.js";import{I as Rt}from"./CrackForm-CIiKEd4n.js";import{C as Bt}from"./CommentPanel-D0ptrEBp.js";import{_ as Mt}from"./MessageBox.vue_vue_type_style_index_0_lang-DfpcTVNJ.js";import{a as Je}from"./element-plus-BeWdvTRa.js";import{B as Tt}from"./BackNavigator-DxLlvPLq.js";import{_ as Vt}from"./PDFViewerDialog.vue_vue_type_style_index_0_lang-GWz8s3FD.js";import{_ as vt}from"./InformationPopUp.vue_vue_type_style_index_0_lang-O2xYF9Pq.js";import{_ as Wt}from"./InformationPopUpSideButton.vue_vue_type_style_index_0_lang-BO5OquVj.js";import{N as Gt}from"./NoDefect-DdL3mqty.js";import{u as Lt}from"./vue-router-iNp9kJ0K.js";import{u as Ut}from"./useMonitoringListStore-AIaGTQg8.js";import{_ as qt}from"./Toast.vue_vue_type_style_index_0_lang-OOgaHWFE.js";import"./UploadImageFailureDialog.vue_vue_type_style_index_0_lang-DVBJv3c1.js";import"./vue3-dropzone-_NG5IwbJ.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";import"./attr-accept-DLIfoYC7.js";import"./index-BuVmIl8K.js";import"./pinia-BjOS2_Ao.js";import"./object-path-DPahbflh.js";import"./@popperjs-BaMZbQYT.js";import"./deepmerge-oeePEK50.js";import"./crypto-js-BeOoaXQg.js";import"./cron-De-pTz2b.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./vuex-BbOKrtVp.js";import"./axios-CU9oF0EU.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-CppYEwAE.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./btech-analytics-wrapper-DOvMtwpJ.js";import"./posthog-js-CbYOvutT.js";import"./vue-i18n-CbVMwo04.js";import"./@intlify-YGwFW6EB.js";import"./prismjs-BrsEfPfk.js";import"./dayjs-D0x2Df_K.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-D6ofg2JO.js";import"./mitt-C1xD_ZTF.js";import"./async-validator-DK9uouaC.js";import"./useAttachmentStore-DqM3autD.js";import"./authentication-handler-Pueb_EI7.js";import"./useGlobalConnectionStore-DV9B81de.js";import"./simple-vue-camera-D9MGhAeE.js";import"./vue-BzYgrL08.js";import"./PhotoDescription.vue_vue_type_style_index_0_lang-1F5CAfuD.js";import"./Textarea.vue_vue_type_style_index_0_lang-v94SEJmi.js";import"./vue-drawing-canvas-CzCJUKem.js";import"./string-to-imageinfo-converter-Cdr1iOkP.js";import"./SMUDetailDialog-Bs-98WGo.js";import"./OfflineFullScreenDialog.vue_vue_type_style_index_0_lang-C2GTRJsq.js";import"./@vueuse-DFoNmIyu.js";import"./ToastWithIcon.vue_vue_type_style_index_0_lang-wfM94fOM.js";import"./MachineSMUEnum-CgiCo9nf.js";import"./prev-val-handler-DvA3D_kF.js";import"./urls-CvqtYZA-.js";import"./NAForm-BdrJ0TGj.js";import"./useMasterStore-CzSO06fn.js";import"./defect-CAkPobhd.js";import"./urls-CPQ2HRXU.js";import"./usePreviewNaFormStore-C1MJT2RQ.js";import"./ImageListModal.vue_vue_type_style_index_0_lang-djt6-PkA.js";import"./FullScreenDialog.vue_vue_type_style_index_0_lang-DXRDt27h.js";import"./Check-CTArJpdm.js";import"./@progress-DBKeVTWA.js";import"./usePositionListStore-BsprGHwA.js";import"./Pagination-BiobnanQ.js";import"./urls-DI_NR_TT.js";import"./mapOption-CeGMwmH0.js";import"./LargeCamera-BnWfLFAm.js";import"./ImagePreview.vue_vue_type_style_index_0_lang-DrcOCjy4.js";import"./CrackNoClass-0DSU7BAn.js";import"./CrackYesClass-COntz77m.js";import"./manipulate-file-oif_A7gg.js";import"./pdf-DNpyvVEz.js";import"./image-close-button-red-B1UxWyBV.js";import"./methods-bliey5hF.js";import"./useAttachmentStore-CPMOf2aR.js";import"./list-pcxkCnQg.js";import"./IronformConfig-BWypCgSI.js";import"./DefectNoClass-BqGKOkzR.js";import"./urls-B0Rq9QQ3.js";import"./urls-hWHEBXep.js";import"./urls-D8F5Tyyp.js";import"./pdf-merger-js-DY3-eECH.js";import"./pdf-lib-DrnT2QV2.js";import"./@pdf-lib-CXIx2D9y.js";import"./pako-Dx2kwFQn.js";import"./webp-converter-browser-C3MD88Lp.js";import"./compressorjs-Cmz8Y9J9.js";import"./file-saver-CwTBvle_.js";import"./moment-C5S46NFB.js";import"./urls-RITu66bD.js";import"./urls-COjrEEs1.js";const W=u=>(et("data-v-4aec7cc9"),u=u(),tt(),u),Yt={class:"mt-5 ps-0"},Kt={class:"row px-2 item mx-1 w-100 defect-panel-header"},zt=W(()=>t("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Jt=W(()=>t("div",{class:"col align-items-center d-flex text-break"},"Task Description â€“ Defect Description",-1)),Qt=W(()=>t("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center flex-basis-80"},"Priority",-1)),Xt=W(()=>t("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),Zt=W(()=>t("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),en=W(()=>t("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),tn={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},nn={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},on=W(()=>t("p",{style:{"text-align":"center"}},"No data recorded",-1)),rn=[on],sn={class:"row mt-2 flex-nowrap px-2 my-2 mx-1 w-100"},ln={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},an=["innerHTML"],cn={class:"item px-2 my-2 mx-1"},dn={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},un=W(()=>t("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},null,-1)),pn={class:"col align-items-center d-flex text-break defect-description"},fn=["innerHTML"],mn={class:"text-center",style:{"font-weight":"600",color:"white"}},vn={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},hn=["onClick"],yn=["onClick"],gn={class:"row"},Dn={class:"col-8 col-md-8 d-flex flex-column pe-0"},wn=["value","onChange","disabled"],kn={key:0,class:"ms-1 d-flex align-items-center"},_n=W(()=>t("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1)),xn=W(()=>t("span",null,"Loading...",-1)),bn=[_n,xn],Cn={class:"col-4 col-md-3 ps-0 pe-1"},Sn=["disabled","onClick"],In=W(()=>t("i",{class:"fa fa-save"},null,-1)),An=[In],Pn=W(()=>t("img",{src:Ve,alt:""},null,-1)),On=[Pn],$n={class:"mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",style:{"margin-top":"6px",cursor:"initial"}},Fn=["onClick"],Nn={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Hn={key:1},jn={class:"item header-collapse px-2 my-2 mx-1"},En={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Rn={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},Bn={class:"col align-items-center d-flex text-break defect-description"},Mn=["innerHTML"],Tn={class:"col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80"},Vn={class:"text-center",style:{"font-weight":"600",color:"white"}},Wn=W(()=>t("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},null,-1)),Gn={class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Ln=W(()=>t("img",{src:Ve,alt:""},null,-1)),Un=[Ln],qn={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Yn={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},Kn=Me({__name:"SupervisorDefectPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},headers:{required:!0,type:[]},details:{required:!0,type:[]},fitterId:{required:!1,type:String,default:""},viewIsDownload:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData"],setup(u,{emit:h}){const O=u,d=h,p=We(),G=Ge(),H=Dt(),S=Le(),T=rt(),se=a([]),R=a(!1),le=a(""),F=a(!1),ue=Be(),J=a("Defect Approval By Supervisor"),Q=a(!0),Y=a(""),$=a(""),V=a(),L=a(),j=a([]),B=a(!1),I=a(""),K=n=>n?lt(n):!1,pe=n=>n=="Acknowledge",U=a([""]),X=n=>{var o;return(o=j.value.find(f=>f.id==n))==null?void 0:o.wo},A=n=>{var o;return(o=j.value.find(f=>f.id==n))==null?void 0:o.load},fe=(n,o,f="")=>{let e=!0;const r=o==null?void 0:o.find(l=>l.id===n);if(r){if(f)return!0;e=!1,e=!(!r.defectWorkorder||r.defectWorkorder=="")}return e},_=n=>{n.preventDefault();const o=n.target,f=at(o.value).replaceAll(".","");o.value=f},E=(n,o)=>{j.value.every(f=>f.id==o?(f.wo=n.target.value,!1):!0)},P=n=>{let o=n.createdBy.name,f=n.updatedDate!=""?n.updatedDate:n.createdDate;const e=p.ApprovalData.DefectDetails.find(r=>r.defectHeaderId==n.id);return e&&e.otherFitterUpdatedBy&&(o=e.otherFitterUpdatedBy.name,Ie(e.updatedDate)>Ie(f)&&(f=e.updatedDate)),`${o}, ${f}`},ee=n=>{n.target.value.length>=15&&n.preventDefault();let o=n.keyCode?n.keyCode:n.which;(o<48||o>57)&&n.preventDefault()},ae=M(()=>p.DataFetched),be=n=>C.value[n].length==1&&C.value[n][0].cbmRatingType=="SERVICE_CLEANED_AND_REPLACED";Fe(ae,n=>{n===!0&&(ye(),De())});const ye=()=>{j.value=[],ne.value.forEach(n=>{j.value.push({id:n.id,wo:n.defectWorkorder,load:!1})})};Te(()=>{ye(),De()});const ge=(n,o)=>{let f="light-yellow color-dark-yellow";const e=o==null?void 0:o.find(r=>r.id===n);if(O.supervisor){if(e){if(["P3","P4"].includes((e==null?void 0:e.priority)??""))return"light-green color-dark-green";f=e.generalStatus==="Acknowledge"?"light-green color-dark-green":"light-yellow color-dark-yellow",e.priority===void 0&&e.defectType!=="machineSMU"&&(f="light-green color-dark-green")}}else if(e){switch(e.generalStatus){case"Submited":f="light-yellow color-dark-yellow";break;case"Acknowledge":f="light-green color-dark-green";break}e.priority===void 0&&(f="light-green color-dark-green")}return f},De=()=>{U.value=[],ne.value.forEach(n=>{U.value.findIndex(f=>n.taskDesc&&n.taskDesc.split(";")[1]&&n.taskDesc.split(";")[1]!=""?f==n.taskDesc.split(";")[0]+";"+n.taskDesc.split(";")[1]:f==n.taskNo)<0&&(n.taskDesc&&n.taskDesc.split(";")[1]&&n.taskDesc.split(";")[1]!=""?U.value.push(n.taskDesc.split(";")[0]+";"+n.taskDesc.split(";")[1]):U.value.push(n.taskNo))})},we=()=>{p.updateDownloadHistory(I.value,"defect")},ie=n=>p.getDefectDetail(n),me=a(!1),ve=()=>{me.value=!0,B.value=!1,p.stateErrorMessage!=qe.NO_NETWORK_VIEW&&(me.value=!1,p.resetErrorStatus(),je())},te=async n=>{const o=j.value.findIndex(f=>f.id==n);o<0||(j.value[o].load=!0,await p.updateDefectMO(n,j.value[o].wo),j.value[o].load=!1,p.IsError&&(B.value=!0))},ne=M(()=>{const n=["P3","P4"];return O.headers.filter(o=>!n.includes(o.priority))}),Ae=M(()=>{var n;return(n=p.DefectPictures[le.value])==null?void 0:n.map(o=>({fileName:o,url:""}))});O.headers.forEach(()=>{se.value.push(!1)});const Pe=M(()=>{let n=!1;return O.headers.forEach(o=>{o.defectType=="CALIBRATION"&&(n=!0)}),n}),ke=n=>{let o="red  ";return o=p.getCompleteStatus(n.defectHeaderId)?"green":"red",o},he=n=>n.status=="Decline"||n.priority===void 0?"invisible":"",s=()=>{R.value=!1},i=()=>{F.value=!1},b=async n=>{ue.setCurrent("defect");const o=await p.setDefectData(n);p.setDefectGeneralStatus(n),Q.value=p.getCompleteStatus(n),Y.value=n,O.fitterId?$.value=G.SelectedWorkOrder:$.value=G.SelectedDefectSheet.workOrder,o&&o=="CALIBRATION"?!xe.isUndefined(H.stateSCHeader)&&!xe.isUndefined(H.stateSCHeader.status)&&H.stateSCHeader.status=="Submitted"&&H.toggleShowPreviewSuspensionCylinderHeightForm(!0):R.value=!0},w=a(!1),y=a(),q=()=>{w.value=!1},ce=async(n,o,f)=>{if(f=="CALIBRATION"){I.value=n,T.setIsDownloadPDF(!0);const e=await Ht();T.setTimeStamp(e),V.value.handleDataFetch()}else w.value=!0,y.value={headerId:n,taskDesc:o}},Ye=()=>{T.setIsAttachmentIncludeDownload(!1),q(),Oe()},Ne=()=>{T.setIsAttachmentIncludeDownload(!0),q(),Oe()},Oe=()=>{I.value="";const n=xe.cloneDeep(ie(y.value.headerId)),o=p.getDefectHeader(y.value.headerId);n&&o&&st({header:o,detail:n.detail,serialNumber:S.SerialNumber,approvalData:{approvedBy:o.approvedBy,approvedDate:o.approvedDate},ownership:S.Ownership,unitNumber:G.SelectedDefectSheet.unitNumber})&&(I.value=y.value.headerId,L.value.handleDataFetch())},C=M(()=>{const n=ne.value;return p.ApprovalData.DefectDetails.forEach(o=>{const f=ne.value.findIndex(e=>e.id===o.defectHeaderId);f>=0&&(n[f].descriptionDefect=o.detail.description)}),n.forEach(o=>{o.taskDesc&&o.taskDesc.split(";")[1]&&o.taskDesc.split(";")[1]!=""&&(o.taskNo=o.taskDesc.split(";")[0]+";"+o.taskDesc.split(";")[1])}),n.reduce((o,f)=>{const e=o[f.taskNo]||[];return e.push(f),o[f.taskNo]=e,o},{})}),He=n=>n&&n.length>=30?n.substring(0,30)+"...":n,$e=n=>n.plannerStatus=="Decline"||n.status=="Decline"?"invisible":"",je=()=>{d("onRefreshData")};return(n,o)=>{const f=Se("el-collapse-item"),e=Se("el-collapse");return m(),g(oe,null,[c(yt,{ref_key:"downloadPdfDefectSupervisor",ref:L,onOnDownloadFinish:we},null,512),c(wt,{ref_key:"downloadPdfSuspension",ref:V,onOnDownloadFinish:we},null,512),t("div",Yt,[c(e,{class:"task-group general-accordion defect-panel-wrapper py-1 px-5 pb-1 testing",modelValue:J.value,"onUpdate:modelValue":o[1]||(o[1]=r=>J.value=r)},{default:de(()=>[c(f,{title:"Defect Approval By Supervisor",name:"Defect Approval By Supervisor"},{default:de(()=>[t("div",Kt,[zt,Jt,Qt,Xt,Zt,en,u.viewIsDownload?(m(),g("div",tn)):N("",!0)]),Object.keys(C.value).length===0?(m(),g("div",nn,rn)):(m(!0),g(oe,{key:1},Ee(v(jt)(Object.keys(C.value)),r=>(m(),g(oe,{key:r},[be(r)?(m(),g("div",Hn,[t("div",jn,[t("div",En,[t("div",Rn,z(C.value[r][0].taskNo&&C.value[r][0].taskNo.split(";")[0]),1),t("div",Bn,[t("span",{class:"text-break",style:{"white-space":"break-spaces"},innerHTML:v(Xe)(C.value[r][0].taskDesc)},null,8,Mn)]),t("div",Tn,[t("div",{class:x(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",v(Re)(C.value[r][0].priority)]),style:{"margin-top":"6px"}},[t("span",Vn,z(C.value[r][0].priority),1)],2)]),Wn,t("div",{class:x(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",he(C.value[r][0])])},null,2),t("div",Gn,[t("div",{class:x(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[ke(C.value[r][0])]]),style:{"margin-top":"6px"}},Un,2)]),u.viewIsDownload?(m(),g("div",qn)):N("",!0)]),t("div",Yn,z(C.value[r][0].createdBy.name)+", "+z(C.value[r][0].updatedDate!=""?C.value[r][0].updatedDate:C.value[r][0].createdDate),1)])])):(m(),Qe(e,{key:0,modelValue:U.value,"onUpdate:modelValue":o[0]||(o[0]=l=>U.value=l),class:"task-group e-form-only py-1 px-2 mt-2 overflow-visible defect-panel-task"},{default:de(()=>[c(f,{name:C.value[r][0].taskNo},{title:de(()=>[t("div",sn,[t("span",ln,z(C.value[r][0].taskNo.split(";")[0]),1),t("span",{class:"col defect-identified-task",innerHTML:v(Xe)(C.value[r][0].taskDesc)},null,8,an)])]),default:de(()=>[(m(!0),g(oe,null,Ee(C.value[r],l=>(m(),g("div",{key:l.defectHeaderId},[t("div",cn,[t("div",dn,[un,t("div",pn,[t("span",{class:"text-break",innerHTML:He(l.descriptionDefect)},null,8,fn)]),t("div",{class:x(["col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80",$e(l)])},[t("div",{class:x(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",v(Re)(l.priority)]),style:{"margin-top":"6px"}},[t("span",mn,z(l.priority),1)],2)],2),t("div",vn,[l.plannerStatus=="Decline"||l.status=="Decline"?(m(),g("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:k=>b(l.defectHeaderId)}," Declined ",8,hn)):(m(),g("div",{key:1,class:x(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",ge(l.defectHeaderId,u.headers)]),onClick:k=>b(l.defectHeaderId)}," Detailed Information ",10,yn))]),t("div",{class:x(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",he(l)])},[t("div",gn,[t("div",Dn,[t("input",{type:"text",class:"form-control mou-input",placeholder:"Input Work Order",onKeypress:ee,value:X(l.defectHeaderId),onChange:k=>E(k,l.defectHeaderId),onInput:Ze(_,["prevent"]),autocomplete:"off",disabled:fe(l.defectHeaderId,u.headers,u.fitterId)},null,40,wn),A(l.defectHeaderId)?(m(),g("div",kn,bn)):N("",!0)]),t("div",Cn,[t("button",{disabled:fe(l.defectHeaderId,u.headers,u.fitterId),onClick:k=>te(l.defectHeaderId),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},An,8,Sn)])])],2),t("div",{class:x(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",$e(l)])},[t("div",{class:x(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[ke(l)]]),style:{"margin-top":"6px"}},On,2)],2),u.viewIsDownload?(m(),g("div",{key:0,class:x(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",$e(l)])},[t("div",$n,[pe(l.status)?(m(),g("img",{key:0,onClick:k=>ce(l.defectHeaderId,C.value[r][0].taskDesc,l.defectType),class:x(["ms-4 me-2 download-icon",K(l.downloadHistory)?"icon-green":"icon-red"]),src:nt,style:{height:"18px"},alt:""},null,10,Fn)):N("",!0)])],2)):N("",!0)]),t("div",Nn,z(P(l)),1)])]))),128))]),_:2},1032,["name"])]),_:2},1032,["modelValue"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),c(ht,{status:v(p).GeneralStatus,"status-spv":v(p).DefectFormStatusSPV,visibility:R.value,"defect-data":v(p).DefectFormData,"header-id":Y.value,"work-order":$.value,"view-only":u.viewOnly,"fitter-id":u.fitterId,plannerApprove:!0,"is-complete":Q.value,onCloseForm:s,onOnRefreshData:je},null,8,["status","status-spv","visibility","defect-data","header-id","work-order","view-only","fitter-id","is-complete"]),c(ot,{images:Ae.value,visibility:F.value,onHandleClose:i},null,8,["images","visibility"]),Pe.value?(m(),g(oe,{key:0},[v(H).ShowPreviewSuspensionCylinderHeightForm?(m(),Qe(kt,{key:0,show:v(H).ShowPreviewSuspensionCylinderHeightForm,onClose:o[2]||(o[2]=()=>v(H).toggleShowPreviewSuspensionCylinderHeightForm(!1))},null,8,["show"])):N("",!0)],64)):N("",!0),c(it,{visibility:w.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:q,onOnNoConfirm:Ye,onOnYesConfirm:Ne},null,8,["visibility"]),c(Ue,{visibility:B.value,caption:v(p).stateErrorMessage,onOnClose:ve},null,8,["visibility","caption"])],64)}}}),zn=ct(Kn,[["__scopeId","data-v-4aec7cc9"]]),re=u=>(et("data-v-4c9f1563"),u=u(),tt(),u),Jn={class:"mt-5 ps-0"},Qn={class:"row px-2 item mx-1 w-100 defect-panel-header"},Xn=re(()=>t("div",{class:"col-1 column-sm-12-percent column-md-7-percent column-lg-10-percent column-xl-6-percent text-center align-items-center d-flex justify-content-center"},"Task",-1)),Zn=re(()=>t("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),eo=re(()=>t("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center flex-basis-80"},"Priority",-1)),to=re(()=>t("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),no=re(()=>t("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),oo=re(()=>t("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),ro={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},so={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},lo={class:"col-1 column-sm-12-percent column-md-7-percent column-xl-6-percent align-items-center d-flex text-break justify-content-center"},ao={class:"col align-items-center d-flex text-break"},io=["innerHTML"],co={style:{"font-weight":"600",color:"white"}},uo={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},po=["onClick"],fo=["onClick"],mo={class:"row"},vo={class:"col-8 col-md-8 d-flex flex-column pe-0"},ho={class:"mx-3 label d-flex flex-column flex-fill"},yo=["onUpdate:modelValue","disabled"],go={key:0,class:"ms-1 d-flex align-items-center"},Do=re(()=>t("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1)),wo=re(()=>t("span",null,"Loading...",-1)),ko=[Do,wo],_o={class:"col-4 col-md-3 ps-0 pe-1"},xo=["disabled","onClick"],bo=re(()=>t("i",{class:"fa fa-save"},null,-1)),Co=[bo],So=re(()=>t("img",{src:Ve,alt:""},null,-1)),Io=[So],Ao={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex"},Po=["onClick"],Oo={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},$o=Me({__name:"SupervisorCrackPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},headers:{required:!0,type:[]},details:{required:!0,type:[]},fitterId:{required:!1,type:String,default:""},viewIsDownload:{required:!1,type:Boolean,default:!1}},emits:["onRefreshData"],setup(u,{emit:h}){const O=u,d=h,p=We(),G=Le(),H=Ge(),S=rt(),T=a(!1),se=Be(),R=a([]),le=a(""),F=a(!0),ue=a(""),J=a(""),Q=a(!1),Y=a(!1),$=a([]),V=a(),L=a(""),j=s=>p.getCrackDetail(s),B=a(!1),I=a(),K=()=>{B.value=!1},pe=s=>{B.value=!0,I.value={headerId:s}},U=()=>{S.setIsAttachmentIncludeDownload(!1),K(),_()},X=()=>{S.setIsAttachmentIncludeDownload(!0),K(),_()},A=(s,i,b="")=>{let w=!0;const y=i==null?void 0:i.find(q=>q.id===s);if(y){if(b)return!0;w=!1,w=!(!y.defectWorkorder||y.defectWorkorder=="")}return w},fe=(s,i)=>{let b="light-yellow color-dark-yellow";const w=i==null?void 0:i.find(y=>y.id===s);if(O.supervisor){if(w){if(["P3","P4"].includes((w==null?void 0:w.priority)??""))return"light-green color-dark-green";b=w.generalStatus==="Acknowledge"?"light-green color-dark-green":"light-yellow color-dark-yellow",w.priority===void 0&&w.defectType!=="machineSMU"&&(b="light-green color-dark-green")}}else if(w){switch(w.generalStatus){case"Submited":b="light-yellow color-dark-yellow";break;case"Acknowledge":b="light-green color-dark-green";break}w.priority===void 0&&(b="light-green color-dark-green")}return b},_=async()=>{L.value="";const s=xe.cloneDeep(j(I.value.headerId)),i=p.getCrackHeader(I.value.headerId);if(s&&i){const b=await p.getReferencePhoto(s.detail.referencePhoto),w={title:s.detail.referenceSection,blob:b,dimension:p.referencePhoto.dimension,id:s.detail.referencePhoto};st({header:i,detail:s.detail,referencePhoto:w,serialNumber:G.SerialNumber,approvalData:{approvedBy:i.approvedBy,approvedDate:i.approvedDate},ownership:G.Ownership,unitNumber:H.SelectedDefectSheet.unitNumber})&&(L.value=I.value.headerId,V.value.handleDataFetch())}},E=s=>s?lt(s):!1,P=s=>s=="Acknowledge",ee=s=>{let i="red  ";return i=p.getCrackCompleteStatus(s.defectHeaderId)?"green":"red",i},ae=()=>{p.updateDownloadHistory(L.value,"crack")},be=s=>{s.target.value.length>=15&&s.preventDefault();let i=s.keyCode?s.keyCode:s.which;(i<48||i>57)&&s.preventDefault()},ye=s=>{s.preventDefault();const i=s.target,b=at(i.value).replaceAll(".","");i.value=b};Te(()=>{$.value=[],te.value.forEach(s=>{$.value.push(s.defectWorkorder)})});const ge=a(!1),De=()=>{ge.value=!0,Y.value=!1,p.stateErrorMessage!=qe.NO_NETWORK_VIEW&&(ge.value=!1,p.resetErrorStatus(),he())},we=s=>{let i=s.createdBy.name,b=s.updatedDate!=""?s.updatedDate:s.createdDate;const w=p.ApprovalData.CrackDetails.find(y=>y.defectHeaderId==s.id);return w&&w.otherFitterUpdatedBy&&(i=w.otherFitterUpdatedBy.name,Ie(w.updatedDate)>Ie(b)&&(b=w.updatedDate)),`${i}, ${b}`},ie=async(s,i)=>{$.value[i]===""||!$.value[i]||(R.value[i]=!0,await p.updateCrackMO(s,$.value[i]),R.value[i]=!1,p.IsError&&(Y.value=!0))},me=s=>s.status=="Decline"||s.priority===void 0?"invisible":"",ve=a("Crack Approval By Supervisor"),te=M(()=>{const s=["P3","P4"];return O.headers.filter(i=>!s.includes(i.priority))}),ne=M(()=>{var s;return(s=p.DefectPictures[le.value])==null?void 0:s.map(i=>({fileName:i,url:""}))});Fe(te,s=>{$.value=[],s.forEach(i=>{$.value.push(i.defectWorkorder)})},{deep:!0}),O.headers.forEach(()=>{R.value.push(!1)});const Ae=()=>{T.value=!1},Pe=()=>{Q.value=!1},ke=async s=>{se.setCurrent("crack"),await p.setCrackData(s),p.setCrackGeneralStatus(s),F.value=p.getCrackCompleteStatus(s),ue.value=s,O.fitterId?J.value=H.SelectedWorkOrder:J.value=H.SelectedDefectSheet.workOrder,T.value=!0},he=()=>{d("onRefreshData")};return(s,i)=>{const b=Se("el-collapse-item"),w=Se("el-collapse");return m(),g(oe,null,[c(Rt,{ref_key:"downloadPdfDefect",ref:V,onOnDownloadFinish:ae},null,512),t("div",Jn,[c(w,{class:"task-group general-accordion py-1 px-5 testing",modelValue:ve.value,"onUpdate:modelValue":i[0]||(i[0]=y=>ve.value=y)},{default:de(()=>[c(b,{title:"Crack Approval By Supervisor",name:"Crack Approval By Supervisor"},{default:de(()=>[t("div",Qn,[Xn,Zn,eo,to,no,oo,u.viewIsDownload?(m(),g("div",ro)):N("",!0)]),(m(!0),g(oe,null,Ee(te.value,(y,q)=>(m(),g("div",{key:y.defectHeaderId,class:"item px-2 my-2 mx-1"},[t("div",so,[t("div",lo,z(y.taskNo),1),t("div",ao,[t("span",{class:"text-break defect-identified-task",innerHTML:v(Xe)(y.taskDesc)},null,8,io)]),t("div",{class:x(["col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80",y.status=="Decline"?"invisible":""])},[t("div",{class:x(["little-box d-flex justify-content-center align-items-center",v(Re)(y.priority)]),style:{"margin-top":"6px"}},[t("span",co,z(y.priority),1)],2)],2),t("div",uo,[y.status=="Decline"?(m(),g("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:ce=>ke(y.defectHeaderId)}," Declined ",8,po)):(m(),g("div",{key:1,class:x(["label d-flex align-items-center py-2 acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",fe(y.defectHeaderId,u.headers)]),onClick:ce=>ke(y.defectHeaderId)}," Detailed Information ",10,fo))]),t("div",{class:x(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",me(y)])},[t("div",mo,[t("div",vo,[t("div",ho,[St(t("input",{type:"text",class:"form-control mou-input","onUpdate:modelValue":ce=>$.value[q]=ce,autocomplete:"off",placeholder:"Input Work Order",onKeypress:be,onInput:Ze(ye,["prevent"]),disabled:A(y.defectHeaderId,u.headers,u.fitterId)},null,40,yo),[[It,$.value[q]]]),R.value[q]?(m(),g("div",go,ko)):N("",!0)])]),t("div",_o,[t("button",{disabled:A(y.defectHeaderId,u.headers,u.fitterId),onClick:ce=>ie(y.defectHeaderId,q),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},Co,8,xo)])])],2),t("div",{class:x(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",y.status=="Decline"?"invisible":""])},[t("div",{class:x(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center",[ee(y)]]),style:{"margin-top":"6px"}},Io,2)],2),u.viewIsDownload?(m(),g("div",Ao,[P(y.status)?(m(),g("img",{key:0,onClick:ce=>pe(y.defectHeaderId),class:x(["ms-4 me-2 download-icon",E(y.downloadHistory)?"icon-green":"icon-red"]),src:nt,style:{height:"18px"},alt:""},null,10,Po)):N("",!0)])):N("",!0)]),t("div",Oo,z(we(y)),1)]))),128))]),_:1})]),_:1},8,["modelValue"])]),c(_t,{status:v(p).GeneralStatus,"status-spv":v(p).DefectFormStatusSPV,visibility:T.value,"header-id":ue.value,"work-order":J.value,"view-only":u.viewOnly,"fitter-id":u.fitterId,plannerApprove:!0,"is-form":!1,"is-complete":F.value,"crack-data":v(p).CrackFormData,onCloseForm:Ae,onOnRefreshData:he},null,8,["status","status-spv","visibility","header-id","work-order","view-only","fitter-id","is-complete","crack-data"]),c(ot,{images:ne.value,visibility:Q.value,onHandleClose:Pe},null,8,["images","visibility"]),c(it,{visibility:B.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No, Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:K,onOnNoConfirm:U,onOnYesConfirm:X},null,8,["visibility"]),c(Ue,{visibility:Y.value,caption:v(p).stateErrorMessage,onOnClose:De},null,8,["visibility","caption"])],64)}}}),Fo=ct($o,[["__scopeId","data-v-4c9f1563"]]),Z=u=>(et("data-v-e6dfd34f"),u=u(),tt(),u),No={class:"mt-5 ps-0"},Ho={class:"row px-2 item mx-1 w-100 defect-panel-header"},jo=Z(()=>t("div",{class:"col align-items-center d-flex text-break"},"Task Description",-1)),Eo=Z(()=>t("div",{class:"text-break col-1 text-center column-sm-11-percent column-md-10-percent column-lg-5-percent align-items-center d-flex justify-content-center flex-basis-80"},"Priority",-1)),Ro=Z(()=>t("div",{class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},"Review Status",-1)),Bo=Z(()=>t("div",{class:"col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center"},"Work Order",-1)),Mo=Z(()=>t("div",{class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},"Repair Status",-1)),To={key:0,class:"col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",style:{"word-break":"initial !important"}},Vo={key:0,class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Wo=Z(()=>t("p",{style:{"text-align":"center"}},"No data recorded",-1)),Go=[Wo],Lo={class:"row flex-nowrap px-2 my-2 mx-1 w-100"},Uo={class:"col align-items-center d-flex text-break defect-description"},qo=["innerHTML"],Yo={class:"text-center",style:{"font-weight":"600",color:"white"}},Ko={class:"col-1 column-sm-20-percent column-md-24-percent column-lg-10-percent column-xl-10-percent align-items-center d-flex justify-content-center"},zo=["onClick"],Jo=["onClick"],Qo={class:"row"},Xo={class:"col-8 col-md-8 d-flex flex-column pe-0"},Zo=["value","onChange","disabled"],er={key:0,class:"ms-1 d-flex align-items-center"},tr=Z(()=>t("div",{class:"spinner-border me-1",style:{width:"1rem !important",height:"1rem !important"},role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1)),nr=Z(()=>t("span",null,"Loading...",-1)),or=[tr,nr],rr={class:"col-4 col-md-3 ps-0 pe-1"},sr=["disabled","onClick"],lr=Z(()=>t("i",{class:"fa fa-save"},null,-1)),ar=[lr],ir=Z(()=>t("img",{src:Ve,alt:""},null,-1)),cr=[ir],dr={class:"mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",style:{"margin-top":"6px",cursor:"initial"}},ur=["onClick"],pr={class:"row flex-nowrap w-100 flex-row-reverse create-by",style:{"font-size":"13px !important"}},fr=Z(()=>t("em",{class:"fa fa-plus me-2"},null,-1)),mr=Me({__name:"SupervisorDefectGenericPanel",props:{viewOnly:{required:!1,type:Boolean,default:!1},supervisor:{required:!1,type:Boolean,default:!0},fitterId:{required:!1,type:String,default:""},plannerApprove:{required:!1,type:Boolean,default:!1},viewIsDownload:{required:!1,type:Boolean,default:!1},assetNumber:{required:!1,type:String,default:""},workorder:{required:!1,type:String,default:""},form:{required:!1,type:String,default:""},disableAddGeneric:{required:!1,type:Boolean,default:!0}},emits:["onRefreshData"],setup(u,{emit:h}){const O=u,d=We(),p=Be(),G=Ge(),H=Ft(),S=Le(),T=rt(),se=h,R=a("Generic Defect Identified By Supervisor"),le=a(!1);a(!1);const F=a([]),ue=a(""),J=a(!0),Q=a(""),Y=a(""),$=a(!1),V=a(!1),L=a(!1),j=a(),B=a(""),I=a([]),K=e=>{I.value=e},pe=()=>{I.value.length<1?X():U(),I.value=[]},U=async()=>{V.value=!1,S.cretateInstance(!0),S.toggleYesVisible(!0)},X=()=>{V.value=!1,S.cretateInstance(!1),S.toggleNoVisible(!0)},A=()=>{I.value=[],V.value=!1},fe=e=>e?lt(e):!1,_=()=>{V.value=!0},E=(e,r,l="")=>{let k=!0;const D=r==null?void 0:r.find(_e=>_e.id===e);if(D){if(l)return!0;k=!1,k=!(!D.defectWorkorder||D.defectWorkorder=="")}return k},P=M(()=>O.disableAddGeneric),ee=e=>e=="Acknowledge",ae=a([""]),be=e=>{var r;return(r=F.value.find(l=>l.id==e))==null?void 0:r.wo},ye=e=>{var r;return(r=F.value.find(l=>l.id==e))==null?void 0:r.load},ge=(e,r)=>{F.value.every(l=>l.id==r?(l.wo=e.target.value,!1):!0)},De=e=>{e.preventDefault();const r=e.target,l=at(r.value).replaceAll(".","");r.value=l},we=e=>{let r=e.createdBy.name,l=e.updatedDate!=""?e.updatedDate:e.createdDate;const k=d.ApprovalData.DefectGenericDetails.find(D=>D.defectHeaderId==e.defectHeaderId);return k&&k.otherFitterUpdatedBy&&(r=k.otherFitterUpdatedBy.name,Ie(k.updatedDate)>Ie(l)&&(l=k.updatedDate)),`${r}, ${l}`},ie=e=>e.plannerStatus=="Decline"||e.status=="Decline"||e.priority===void 0?"invisible":"",me=e=>e.plannerStatus=="Decline"||e.status=="Decline"?"invisible":"",ve=a(!1),te=a(),ne=()=>{ve.value=!1},Ae=e=>{ve.value=!0,te.value={headerId:e}},Pe=()=>{T.setIsAttachmentIncludeDownload(!1),ne(),he()},ke=()=>{T.setIsAttachmentIncludeDownload(!0),ne(),he()},he=()=>{B.value="";const e=xe.cloneDeep(C(te.value.headerId)),r=d.getDefectGenericHeader(te.value.headerId);e&&r&&st({header:r,detail:e.detail,serialNumber:S.SerialNumber,approvalData:{approvedBy:r.approvedBy,approvedDate:r.approvedDate},ownership:S.Ownership,unitNumber:G.SelectedDefectSheet.unitNumber,generic:!0})&&(B.value=te.value.headerId,j.value.handleDataFetch())},s=()=>{d.updateDownloadHistory(B.value,"defect",!0)},i=M(()=>d.ApprovalData.DefectGenericHeaders.filter(e=>!["P3","P4"].includes(e.priority))),b=M(()=>d.DataFetched),w=M(()=>{var e;return(e=d.DefectPictures[ue.value])==null?void 0:e.map(r=>({fileName:r,url:""}))}),y=e=>{e.target.value.length>=15&&e.preventDefault();let r=e.keyCode?e.keyCode:e.which;(r<48||r>57)&&e.preventDefault()};Fe(b,e=>{e===!0&&(q(),Ne())});const q=()=>{F.value=[],i.value.forEach(e=>{F.value.push({id:e.id,wo:e.defectWorkorder,load:!1})})},ce=(e,r)=>{let l="light-yellow color-dark-yellow";const k=r==null?void 0:r.find(D=>D.id===e);if(O.supervisor){if(k){if(["P3","P4"].includes((k==null?void 0:k.priority)??""))return"light-green color-dark-green";l=k.generalStatus==="Acknowledge"?"light-green color-dark-green":"light-yellow color-dark-yellow",k.priority===void 0&&k.defectType!=="machineSMU"&&(l="light-green color-dark-green")}}else if(k){switch(k.generalStatus){case"Submited":l="light-yellow color-dark-yellow";break;case"Acknowledge":l="light-green color-dark-green";break}k.priority===void 0&&(l="light-green color-dark-green")}return l},Ye=e=>d.getGenericCompleteStatus(e.id)?"green":"red",Ne=()=>{ae.value=[],i.value.forEach(e=>{ae.value.findIndex(l=>e.taskDesc&&e.taskDesc.split(";")[1]&&e.taskDesc.split(";")[1]!=""?l==e.taskDesc.split(";")[0]+";"+e.taskDesc.split(";")[1]:l==e.taskNo)<0&&(e.taskDesc&&e.taskDesc.split(";")[1]&&e.taskDesc.split(";")[1]!=""?ae.value.push(e.taskDesc.split(";")[0]+";"+e.taskDesc.split(";")[1]):ae.value.push(e.taskNo))})};Te(()=>{S.resetInstance(),b.value&&(q(),Ne()),H.getServerTimestamp()});const Oe=async e=>{p.setCurrent("defect"),await d.setDefectDataGeneric(e),d.setGenericDefectGeneralStatus(e),J.value=d.getGenericCompleteStatus(e),O.plannerApprove&&d.HeaderStatus!="Decline"&&d.updateHeaderGenericDefect(e),Q.value=e,O.fitterId?Y.value=G.SelectedWorkOrder:Y.value=G.SelectedDefectSheet.workOrder,le.value=!0},C=e=>d.getDefectGenericDetail(e),He=a(!1),$e=()=>{He.value=!0,L.value=!1,d.stateErrorMessage!=qe.NO_NETWORK_VIEW&&(He.value=!1,d.resetErrorStatus(),f())},je=async e=>{const r=F.value.findIndex(l=>l.id==e);r<0||(F.value[r].load=!0,await d.updateDefectMO(e,F.value[r].wo,!0),F.value[r].load=!1,d.IsError&&(L.value=!0))},n=()=>{le.value=!1},o=()=>{$.value=!1},f=()=>{se("onRefreshData")};return Fe(()=>S.OpenDialogConfirmSubmitDefect,e=>{e&&(V.value=e)}),(e,r)=>{const l=Se("el-collapse-item"),k=Se("el-collapse");return m(),g(oe,null,[c(yt,{ref_key:"downloadPdfDefect",ref:j,onOnDownloadFinish:s},null,512),t("div",No,[c(k,{class:"task-group general-accordion defect-panel-wrapper px-5 pb-1",modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=D=>R.value=D)},{default:de(()=>[c(l,{title:"Generic Defect Identified By Supervisor",name:"Generic Defect Identified By Supervisor"},{default:de(()=>[t("div",Ho,[jo,Eo,Ro,Bo,Mo,u.viewIsDownload?(m(),g("div",To)):N("",!0)]),i.value.length===0?(m(),g("div",Vo,Go)):(m(!0),g(oe,{key:1},Ee(i.value,D=>(m(),g("div",{key:D,class:"item px-2 my-2 mx-1"},[t("div",Lo,[t("div",Uo,[t("span",{class:"text-break defect-identified-task",innerHTML:D.taskDesc},null,8,qo)]),t("div",{class:x(["col-1 justify-content-center column-sm-11-percent column-md-11-percent column-xl-5-percent align-items-center d-flex flex-basis-80",me(D)])},[t("div",{class:x(["little-box justify-content-center align-items-center justify-content-center d-flex mx-auto",v(Re)(D.priority)]),style:{"margin-top":"6px"}},[t("span",Yo,z(D.priority),1)],2)],2),t("div",Ko,[D.plannerStatus=="Decline"||D.status=="Decline"?(m(),g("div",{key:0,class:"label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center red-bg text-dark-red cursor-pointer",onClick:_e=>Oe(D.defectHeaderId)}," Declined ",8,zo)):(m(),g("div",{key:1,class:x(["label d-flex align-items-center acknowledge-btn py-2 px-1 rounded text-center justify-content-center cursor-pointer",ce(D.defectHeaderId,i.value)]),onClick:_e=>Oe(D.defectHeaderId)}," Detailed Information ",10,Jo))]),t("div",{class:x(["col-1 column-sm-30-percent column-md-23-percent column-lg-16-percent column-xl-16-percent align-items-center d-flex justify-content-center",ie(D)])},[t("div",Qo,[t("div",Xo,[t("input",{type:"text",class:"form-control mou-input",autocomplete:"off",placeholder:"Input Work Order",onKeypress:y,value:be(D.defectHeaderId),onInput:Ze(De,["prevent"]),onChange:_e=>ge(_e,D.defectHeaderId),disabled:E(D.defectHeaderId,i.value,u.fitterId)},null,40,Zo),ye(D.defectHeaderId)?(m(),g("div",er,or)):N("",!0)]),t("div",rr,[t("button",{disabled:E(D.defectHeaderId,i.value,u.fitterId),onClick:_e=>je(D.defectHeaderId),class:"btn btn-sm btn-success ms-2 d-flex justify-content-center align-items-center",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white",width:"46px",height:"40px"}},ar,8,sr)])])],2),t("div",{class:x(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",me(D)])},[t("div",{class:x(["mx-3 little-box rounded-circle d-flex p-3 justify-content-center align-items-center mx-auto",[Ye(D)]]),style:{"margin-top":"6px"}},cr,2)],2),u.viewIsDownload?(m(),g("div",{key:0,class:x(["col-1 column-sm-10-percent column-md-6-percent column-lg-6-percent column-xl-6-percent justify-content-center align-items-center d-flex",me(D)])},[t("div",dr,[ee(D.status)?(m(),g("img",{key:0,onClick:_e=>Ae(D.defectHeaderId),class:x(["ms-4 me-2 download-icon",fe(D.downloadHistory)?"icon-green":"icon-red"]),src:nt,style:{height:"18px"},alt:""},null,10,ur)):N("",!0)])],2)):N("",!0)]),t("div",pr,z(we(D)),1)]))),128)),P.value?N("",!0):(m(),g("button",{key:2,class:"my-3 btn-add-new",onClick:_},[fr,At(" Add Generic Identified Defect, If Required ")]))]),_:1})]),_:1},8,["modelValue"])]),c(ht,{status:v(d).GeneralStatus,"status-spv":v(d).DefectFormStatusSPV,visibility:le.value,"defect-data":v(d).DefectFormData,"header-id":Q.value,"work-order":Y.value,"view-only":u.viewOnly,"fitter-id":u.fitterId,plannerApprove:u.plannerApprove,"is-complete":J.value,generic:!0,onCloseForm:n,onOnRefreshData:f},null,8,["status","status-spv","visibility","defect-data","header-id","work-order","view-only","fitter-id","plannerApprove","is-complete"]),c(ot,{images:w.value,visibility:$.value,onHandleClose:o},null,8,["images","visibility"]),c(xt,{show:V.value,"check-list-arr":I.value,onUpdateCheckList:K,onSubmit:pe,onClose:A},null,8,["show","check-list-arr"]),c(it,{visibility:ve.value,caption:"Are you sure want to download all the attachment in this defect file?",yesLabel:"Yes, Download All File",noLabel:"No,  Only F55 Form",showClose:!0,widthDialog:60,footerTemplate:"50-50",onOnClose:ne,onOnNoConfirm:Pe,onOnYesConfirm:ke},null,8,["visibility"]),c(Ue,{visibility:L.value,caption:v(d).stateErrorMessage,onOnClose:$e},null,8,["visibility","caption"])],64)}}}),vr=ct(mr,[["__scopeId","data-v-e6dfd34f"]]),hr={class:"p-2 py-5 d-flex justify-content-end mt-20 border-top border-top-2"},yr=["disabled"],Fl=Me({__name:"Detail",setup(u){const h=We(),O=Nt(),d=Ge(),p=Ut(),G=Be(),H=Le(),S=Lt(),T=a(!1),se=a(!1),R=a(!1),le=a(0),F=M(()=>h.stateErrorByNetwork),ue=M(()=>{const _=["P1","P2","P3","P4"];return!(!Ke(Ce(h.ApprovalData.DefectHeaders.filter(ie=>ie.defectType!="machineSMU"),_))||!Ke(Ce(h.ApprovalData.DefectGenericHeaders,_))||!ze(Ce(h.ApprovalData.DefectHeaders,_))||!ze(Ce(h.ApprovalData.DefectGenericHeaders,_))||!Ke(Ce(h.ApprovalData.CrackHeaders,_))||!ze(Ce(h.ApprovalData.CrackHeaders,_))||!h.ApprovalData.CBMHeaders.every(ie=>ie.plannerCbmNAStatus==="Confirmed")||!mt(h.ApprovalData.DefectNAHeaders,!0)||!mt(h.ApprovalData.CrackNAHeaders,!0)||Object.keys(h.DefectSMUHeader).length>0&&h.DefectSMUHeader.plannerStatus!=="Acknowledge")}),J=M(()=>{var _;return`${(_=h.ApproveBy)==null?void 0:_.name}, ${h.ApproveDate}`}),Q=M(()=>d.stateSheetAlreadyApproved);Fe(()=>Q.value,_=>{_&&setTimeout(()=>{d.stateSheetAlreadyApproved=!1,S.push({name:"defectsplanner"})},3e3)});const Y=()=>{h.toggleErrorByNetwork(!1),S.push({name:"defectsplanner"})},$=async()=>{const _=Je.service({lock:!0,text:"Processing...",background:"rgba(0, 0, 0, 0.7)"});if(await d.approveDefectSheetByPlanner(),_.close(),d.IsError){se.value=!0;return}d.reset(),R.value=!0},V=()=>{R.value=!1,L()},L=()=>{T.value=!1,p.setDefaultFormTypeOpenFromApprovalPlanner("Digital Service Forms"),S.push({name:"monitoringstatus"})},j=()=>{se.value=!1,d.Error!=Et.INCOMPLETE_DATA&&d.Error!=qe.NO_NETWORK_VIEW&&(p.setDefaultFormTypeOpenFromApprovalPlanner("Digital Service Forms"),S.push({name:"monitoringstatus"}))},B=a(null),I=a(""),K=a(!1),pe=a(!1),U=_=>{pe.value=_};Pt(()=>{(!d.SelectedDefectSheet||xe.isEmpty(d.SelectedDefectSheet))&&S.push({name:"defectsplanner"})});const X=()=>{le.value=window.scrollY},A=async()=>{const _=Je.service({lock:!0,text:"Refresh Data...",background:"rgba(0, 0, 0, 0.7)"});await h.getDefectsData(d.SelectedDefectSheet.workOrder),_.close()};Te(async()=>{const _=Je.service({lock:!0,text:"Loading Defect Data",background:"rgba(0, 0, 0, 0.7)"});if(h.DataFetched===!1){await h.getDefectsData(d.SelectedDefectSheet.workOrder);const E=d.SelectedDefectSheet.equipmentModel.split(" ")[0].split("-");let P=[...new Set(E)].join("-");xe.isUndefined(d.SelectedDefectSheet.equipmentModel.split(" ")[1])||(P=`${P} ${d.SelectedDefectSheet.equipmentModel.split(" ")[1]}`),O.setModelAndPsTypeId("",d.SelectedDefectSheet.psType,"",P,""),await O.getEhmsRating(),await H.getOwnershipDefectForm(d.SelectedDefectSheet.unitNumber),await H.getPartReference(d.SelectedDefectSheet.unitNumber)}try{Array.from(B.value.getElementsByClassName("show-pdf")).forEach(P=>{P.onclick=ee=>{ee.preventDefault(),K.value=!0,I.value=P.href}})}catch(E){console.log(E)}try{Array.from(B.value.getElementsByClassName("spv-print-pdf")).forEach(P=>{P.onclick=ee=>{ee.preventDefault(),K.value=!0,I.value=P.href,U(!0)}})}catch(E){console.log(E)}h.setCurrentUserGroup("Planner"),_.close()});const fe=()=>{K.value=!1};return Ot(()=>{G.reset()}),(_,E)=>{var P;return m(),g(oe,null,[t("div",{ref_key:"defectDetailRef",ref:B},[c(Tt,{title:`${(P=v(d).SelectedDefectSheet)==null?void 0:P.form}`,"component-router-push":"defectsplanner","approve-history":J.value},null,8,["title","approve-history"]),c($t),c(bt,{"view-only":!1,"planner-approve":!0,supervisor:!1,onOnRefreshData:A,onOnGetPositionY:X}),c(dt,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,onOnGetPositionY:X,title:"Repairs Completed"}),c(dt,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,onOnGetPositionY:X,title:"Further Action Required"}),c(ut,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,"disable-add-generic":!0,title:"Repairs Completed"}),c(ut,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,"disable-add-generic":!0,title:"Further Action Required"}),c(pt,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,onOnGetPositionY:X,title:"Repairs Completed"}),c(pt,{"view-only":!1,supervisor:!1,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,onOnGetPositionY:X,title:"Further Action Required"}),c(zn,{headers:v(h).ApprovalData.DefectHeaders,details:v(h).ApprovalData.DefectDetails,"view-only":!1,"view-is-download":!0},null,8,["headers","details"]),c(vr,{"view-only":!0,onOnRefreshData:A,"planner-approve":!0,"view-is-download":!0,"disable-add-generic":!0}),c(Fo,{headers:v(h).ApprovalData.CrackHeaders,onOnRefreshData:A,details:v(h).ApprovalData.CrackDetails,"view-only":!1,"view-is-download":!0},null,8,["headers","details"]),c(Ct,{headers:v(h).ApprovalData.CBMHeaders,"planner-approve":!0,onOnRefreshData:A},null,8,["headers"]),c(ft,{title:"Not Applicable Item Check",headers:v(h).ApprovalData.DefectNAHeaders,"is-defect":!0,"planner-approve":!0,onOnRefreshData:A},null,8,["headers"]),c(ft,{title:"Not Applicable Crack Check",headers:v(h).ApprovalData.CrackNAHeaders,"is-defect":!1,"planner-approve":!0,onOnRefreshData:A},null,8,["headers"]),c(Bt,{headers:v(h).Comments},null,8,["headers"]),t("div",hr,[v(h).ApprovalData.DefectHeaders.length==0&&v(h).ApprovalData.CrackHeaders.length==0&&v(h).ApprovalData.CrackNAHeaders.length==0&&v(h).ApprovalData.DefectNAHeaders.length==0&&v(h).ApprovalData.CBMHeaders.length==0?(m(),Qe(Gt,{key:0,message:"Service sheet was completed in full and no issues were identified."})):N("",!0),t("button",{class:"btn btn-success",style:{background:"#18AF4A","box-shadow":"0px 8px 16px rgba(0, 171, 85, 0.24)",color:"white"},disabled:!ue.value,onClick:$},"Approve",8,yr)])],512),c(gt,{visibility:v(G).isVisible},null,8,["visibility"]),c(Wt,{show:R.value,onClose:V,"title-pop-up":"Please ensure you generate a PDF copy of the completed IronForms service sheet and attach it to the SAP work order.",confirmLabel:"Ok"},null,8,["show"]),c(Mt,{show:T.value,onClose:L,message:"Data successfully approved"},null,8,["show"]),c(Ue,{visibility:se.value,caption:v(d).Error,onOnClose:j},null,8,["visibility","caption"]),c(Vt,{show:K.value,onHandleCloseModal:fe,"blob-url":I.value},null,8,["show","blob-url"]),c(vt,{show:pe.value,onClose:U,"title-pop-up":"if required, see your supervisor to print this"},null,8,["show"]),c(qt,{visibility:Q.value,caption:"You cannot approve this digital service sheet because another user already approved."},null,8,["visibility"]),c(vt,{show:F.value,onClose:Y,"title-pop-up":"No internet connection"},null,8,["show"])],64)}}});export{Fl as default};
