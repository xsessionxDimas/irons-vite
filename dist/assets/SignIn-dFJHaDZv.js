import{k as S,r as d,o as b,p as h,aa as w,aB as i,y as x,u as k,s as l,P as C,B as A,F as O,R as N,Y as U}from"./@vue-BypzYtbH.js";import{u as B}from"./vue-router-iNp9kJ0K.js";import{u as E,e as L,l as _,S as m,g as M}from"./index-BCnwA6yE.js";import{X as T}from"./dexie-CWyjz2Lo.js";import{a as V}from"./@vueuse-MfruhCTE.js";import{i as v}from"./internet-connection-B91-AJht.js";import{u as D}from"./useMsal-BbsBYoof.js";import{d as F}from"./get-user-info-ClQf79xP.js";import{_ as P}from"./ErrorBox.vue_vue_type_style_index_0_lang-Bysg_zE3.js";import{_ as R}from"./nw-img-vue-CR837WER.js";import"./vuex-BbOKrtVp.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./pinia-BjOS2_Ao.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./element-plus-C5R56mia.js";import"./dayjs-C7SXsQPH.js";import"./lodash-Cr9vlq0V.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./vee-validate-C_msoaAA.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./index-CLJyswLZ.js";const j={class:"row"},q={class:"shadow-lg p-4 pb-10 mb-5 bg-white rounded border border-light rounded text-center"},J={class:"row justify-content-center"},X={class:"w-100 justify-content-center",style:{"margin-right":"5px"}},z={style:{display:"none"}},Y=S({__name:"SignIn",setup($){const{instance:r}=D(),c=E(),a=B(),u=d(0),p=d(!1),{isOnline:g}=V(),y=async()=>{if(v()){if(!await F()){p.value=!0;return}a.push({name:"ironforms"});return}await f()};b(async()=>{await T.exists("DexieSchema").then(async function(){await L.open()});let o=!0;localStorage.setItem("lang","en");const t=r.getActiveAccount();if(t)try{r.acquireTokenSilent(_)}catch(e){console.log(e),o=!1}else o=!1;if(o&&(localStorage.setItem("account-info-cache",JSON.stringify(t)),a.push({name:"mydashboard"})),v()){const e=m.getInstance(),n=m.getMSALInstance();let s;if(s=await e.getActiveUser(n),s&&(localStorage.getItem("account-info-cache")||localStorage.getItem("account-info-cache")!=="undefined")){a.push({name:"ironforms"});return}}});const f=async()=>{const o=m.getInstance(),t=m.getMSALInstance();let e;if(e=await o.getActiveUser(t),e&&(localStorage.getItem("account-info-cache")||localStorage.getItem("account-info-cache")!=="undefined")){a.push({name:"mydashboard"});return}let n=!1;try{if(console.log("step 1 msal login"),await r.loginPopup(_),await c.signIn(r),!c.loggedIn)return;localStorage.setItem("login-tracked","false"),console.log("step 2 redirect to ironforms"),a.push({name:"mydashboard"})}catch(s){if(console.log("step error",s),!s){n=!1;return}if(s.errorCode=="user_cancelled")return;if(s.errorCode=="interaction_in_progress"){if(u.value<4){I(),await f(),u.value++;return}return}g.value||(console.log("isOnline:",g.value),M("Unable to sign in. Offline connection detected. Please check your internet connection and try signing in again.","Close"))}finally{console.log("step error final",n),c.setLoading(!1),n||a.push({name:"mydashboard"})}},I=()=>{const o=document.cookie.split(";");for(var t=1;t<=o.length;t++){var e=o[t-1],n=e.split("=");document.cookie=n[0]+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}window.localStorage.clear(),window.sessionStorage.clear()};return(o,t)=>{const e=N("NwImg"),n=U("loading");return h(),w(O,null,[i("div",j,[x((h(),w("div",q,[l(e,{class:"w-300px my-7",src:"/media/logos/bumaau/buma-logo.png",style:{height:"auto"},alt:"logo"}),i("div",J,[i("div",X,[i("button",{onClick:C(y,["prevent"]),href:"#",class:"w-100 btn btn-lg text-white btn-big",style:{"font-size":"12px","font-weight":"600"}},[l(e,{src:"/media/logos/bumaau/microsoft.png",alt:"microsoft",width:"24"}),A(" Sign in Microsoft ")])])]),i("div",z,[l(e,{src:"/media/icons/bumaau/danger.png"})])])),[[n,k(c).loading]])]),l(P,{visibility:p.value,caption:"Failed to sign in, you need to sign in when you have internet connection first",onOnClose:t[0]||(t[0]=()=>{p.value=!1})},null,8,["visibility"])],64)}}}),Ne=R(Y,[["__scopeId","data-v-57d297fd"]]);export{Ne as default};
