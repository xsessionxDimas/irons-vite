import{u as Vt}from"./vuex-BbOKrtVp.js";import{b as dt}from"./vue-router-iNp9kJ0K.js";import{a as zt}from"./breadcrumb-D-Q4Tk9w.js";import{b as R,u as W,s as z,i as tt,h as ct,j as Z,A as jt}from"./index-BCnwA6yE.js";import{P as _t}from"./Pagination-CVDIvnOM.js";import{F as Gt}from"./FilterIconButton-Bj0WTbms.js";import{h as Kt,A as Yt,U as Qt}from"./excel-generator-CRLIz6fw.js";import{D as Xt}from"./DownloadIconButton-CIQp-YG7.js";import{k as K,c as C,r as V,u as i,y as X,p as v,aa as q,s as a,x as p,T as Pt,q as T,F as Et,Y as mt,R as N,A as lt,aB as g,C as $,P as yt,bd as Tt,bb as It,a0 as pt,B as H,a7 as Jt,L as Zt}from"./@vue-BypzYtbH.js";import{_ as P,b as kt}from"./element-plus-C5R56mia.js";import{P as et,b as Y,a as te,d as ee}from"./table-sort-VnBD5Hfa.js";import{d as gt}from"./pinia-BjOS2_Ao.js";import{b as at,a as ut}from"./mapOption-sP4IrA4W.js";import{f as M,n as E,a as St}from"./date-format-BASVuupi.js";import{L as ae}from"./urls-DzqKjzQ_.js";import{c as se}from"./urls-DBLs_wGY.js";import{c as Bt,a as G,f as st,b as ot,d as qt}from"./yup-BRaPd8dh.js";import"./property-expr-DEi1ZLzV.js";import{E as Mt}from"./ErrorAlert-CMKGfwAi.js";import{_ as it}from"./AutoComplete.vue_vue_type_script_setup_true_lang-BJG-QfZq.js";import{_ as rt}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DQfguttb.js";import{_ as Ct}from"./NumberInput.vue_vue_type_script_setup_true_lang-DQgMY3Op.js";import{_ as nt}from"./DecimalInput.vue_vue_type_script_setup_true_lang-BrbFZUJW.js";import{_ as Lt}from"./nw-img-vue-CR837WER.js";import{a as oe}from"./vee-validate-C_msoaAA.js";import{_ as ie}from"./lodash-Cr9vlq0V.js";import{_ as re}from"./FileDropZone.vue_vue_type_style_index_0_lang-Ct77XTnP.js";import{m as ne}from"./map-anything-abi6NY2Z.js";import{_ as Q}from"./AutoComplete.vue_vue_type_style_index_0_lang-DTl0xZyN.js";import{_ as Ft}from"./DatePickerInput.vue_vue_type_script_setup_true_lang-DO0pIl2P.js";import{F as le}from"./file-saver-DhbZvGod.js";import"./object-path-BACu75q6.js";import"./attr-accept-BWI1aNlo.js";import"./crypto-js-BZehCumu.js";import"./cron-Ci8nYs3o.js";import"./luxon-C_T8jI2d.js";import"./dexie-CWyjz2Lo.js";import"./axios-N3crNZ6y.js";import"./vue-axios-BaogFJPH.js";import"./sweetalert2-DK0FVkv3.js";import"./@azure-DwL0pga8.js";import"./uuid-SoommWqA.js";import"./vue-inline-svg-Bgl3eqMC.js";import"./@microsoft-C248spM2.js";import"./@nevware21-CKApUIxW.js";import"./dayjs-C7SXsQPH.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./normalize-wheel-xcxZ5rdH.js";import"./mitt-C1xD_ZTF.js";import"./@popperjs-WhmJkuoZ.js";import"./async-validator-DK9uouaC.js";import"./language-BriOOvyN.js";import"./vue-i18n-CE6bnohq.js";import"./@intlify-CjZh8qSI.js";import"./PageEnum-BoOqFyRq.js";import"./xlsx-CpbwoZfi.js";import"./moment-C5S46NFB.js";import"./nanoclone-BAWie4i9.js";import"./toposort-CalJriC0.js";import"./vue3-dropzone-DPWU9yJt.js";import"./file-selector-CuD-TRe-.js";import"./tslib-DTLQ5SHO.js";const j="https://digital-bumaau-dev-apm-001.azure-api.net/ehms/api/master_model_weight",de=`${j}`,ue=`${j}/model_weight_bulk`,he=`${j}/validate_upload`,ce=`${j}/export`,me=`${j}/lookup`,pe=`${j}/model_weight`,ge=`${j}/model_weight/update`,ht={site:"",siteTo:"",equipmentModel:"",equipmentModelTo:"",weight:"",weightTo:"",whPerday:"",whPerdayTo:"",fuelBurn:"",fuelBurnTo:"",startDate:"",startDateTo:"",endDate:"",endDateTo:"",ver:"v1",page:1,pageSize:10,order:""},Dt=gt({id:"modelWeightList",state:()=>({stateFilterData:{...ht},stateLastUsedFilterData:{...ht},statePageName:"modelWeight",stateDisplayData:[],statePagination:new et,stateLoading:!1,statePaginationLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateWeightOption:[],stateWhPerdayOption:[],stateFuelBurnOption:[]}),getters:{pageName:t=>t.statePageName,pagination:t=>t.statePagination,displayData:t=>t.stateDisplayData,filterData:t=>t.stateFilterData,lastUsedFilterData:t=>t.stateLastUsedFilterData,loading:t=>t.stateLoading,paginationLoading:t=>t.statePaginationLoading,siteOption:t=>t.stateSiteOption,equipmentModelOption:t=>t.stateEquipmentModelOption,weightOption:t=>t.stateWeightOption,whPerdayOption:t=>t.stateWhPerdayOption,fuelBurnOption:t=>t.stateFuelBurnOption},actions:{async getData(t=!0){const s={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,equipmentModel:this.stateFilterData.equipmentModel,equipmentModelTo:this.stateFilterData.equipmentModelTo,weight:this.stateFilterData.weight,weightTo:this.stateFilterData.weightTo,whPerday:this.stateFilterData.whPerday,whPerdayTo:this.stateFilterData.whPerdayTo,fuelBurn:this.stateFilterData.fuelBurn,fuelBurnTo:this.stateFilterData.fuelBurnTo,startDate:this.stateFilterData.startDate?M(E(new Date(this.stateFilterData.startDate))):"",startDateTo:this.stateFilterData.startDateTo?M(E(new Date(this.stateFilterData.startDateTo))):"",endDate:this.stateFilterData.endDate?M(E(new Date(this.stateFilterData.endDate))):"",endDateTo:this.stateFilterData.endDateTo?M(E(new Date(this.stateFilterData.endDateTo))):"",page:this.stateFilterData.page.toString(),pageSize:this.stateFilterData.pageSize.toString(),order:this.stateFilterData.order,ver:this.stateFilterData.ver};try{t&&(this.stateLoading=!0),t||(this.stateDisplayData=[]);const e=await R.get(de,"model_weight",new URLSearchParams(s).toString());this.stateDisplayData=e.data.result.content,this.setTotalPage(e.data.result.total),this.stateLastUsedFilterData={...this.stateFilterData}}catch(e){!e.response.data&&(e!=null&&e.includes("Request failed with status code 401"))&&W().setLoggedIn(!1),z("IRONS",e),console.log(e)}this.stateLoading=!1},async getLookup(){const t={ver:this.stateFilterData.ver};try{const s=await R.get(me,"",new URLSearchParams(t).toString());this.stateSiteOption=at(s.data.result.content.site,"siteId","siteCode","siteDescription"),this.stateEquipmentModelOption=at(s.data.result.content.equipmentModel,"equipmentModel","brand","equipmentModelDescription"),this.stateWeightOption=ut(s.data.result.content.weight),this.stateWhPerdayOption=ut(s.data.result.content.whPerday),this.stateFuelBurnOption=ut(s.data.result.content.fuelBurn)}catch(s){s.response.data.statusCode==401&&W().setLoggedIn(!1),z("IRONS",s),console.log(s)}},async export(){const t={site:this.stateFilterData.site,siteTo:this.stateFilterData.siteTo,equipmentModel:this.stateFilterData.equipmentModel,equipmentModelTo:this.stateFilterData.equipmentModelTo,weight:this.stateFilterData.weight,weightTo:this.stateFilterData.weightTo,whPerday:this.stateFilterData.whPerday,whPerdayTo:this.stateFilterData.whPerdayTo,fuelBurn:this.stateFilterData.fuelBurn,fuelBurnTo:this.stateFilterData.fuelBurnTo,startDate:this.stateFilterData.startDate?M(E(new Date(this.stateFilterData.startDate))):"",startDateTo:this.stateFilterData.startDateTo?M(E(new Date(this.stateFilterData.startDateTo))):"",endDate:this.stateFilterData.endDate?M(E(new Date(this.stateFilterData.endDate))):"",endDateTo:this.stateFilterData.endDateTo?M(E(new Date(this.stateFilterData.endDateTo))):"",order:this.stateFilterData.order,ver:this.stateFilterData.ver,Gmt:new Date().toTimeString().slice(12,17)};try{return(await R.getBlob(ce,"",new URLSearchParams(t).toString())).data}catch(s){z("IRONS",s),console.log(s)}},setTotalPage(t){this.pagination.totalPage=t,this.pagination.getPaginationStartIndex(),this.pagination.getPaginationLastIndex()},async setPage(t){this.statePaginationLoading=!0,this.statePagination.handleCurrentPageChange(t),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(),setTimeout(()=>{this.statePaginationLoading=!1},200)},async setSort({prop:t,order:s}){if(!t&&!s)this.stateFilterData.order="";else{const e=s=="ascending"?"asc":"desc";this.stateFilterData.order=`${t}_${e}`}this.statePagination.handleCurrentPageChange(1),this.stateFilterData.page=this.statePagination.currentPage,await this.getData(!1)},setSite(t){this.stateFilterData.site=t},setSiteTo(t){this.stateFilterData.siteTo=t},setEquipmentModel(t){this.stateFilterData.equipmentModel=t},setEquipmentModelTo(t){this.stateFilterData.equipmentModelTo=t},setWeight(t){this.stateFilterData.weight=t},setWeightTo(t){this.stateFilterData.weightTo=t},setWhPerday(t){this.stateFilterData.whPerday=t},setWhPerdayTo(t){this.stateFilterData.whPerdayTo=t},setFuelBurn(t){this.stateFilterData.fuelBurn=t},setFuelBurnTo(t){this.stateFilterData.fuelBurnTo=t},setStartDate(t){this.stateFilterData.startDate=t},setStartDateTo(t){this.stateFilterData.startDateTo=t},setEndDate(t){this.stateFilterData.endDate=t},setEndDateTo(t){this.stateFilterData.endDateTo=t},async resetFilter(){this.stateFilterData.site="",this.stateFilterData.siteTo="",this.stateFilterData.equipmentModel="",this.stateFilterData.equipmentModelTo="",this.stateFilterData.weight="",this.stateFilterData.weightTo="",this.stateFilterData.whPerday="",this.stateFilterData.whPerdayTo="",this.stateFilterData.fuelBurn="",this.stateFilterData.fuelBurnTo="",this.stateFilterData.startDate="",this.stateFilterData.startDateTo="",this.stateFilterData.endDate="",this.stateFilterData.endDateTo="";const t=this.stateLastUsedFilterData.site!=="",s=this.stateLastUsedFilterData.siteTo!=="",e=this.stateLastUsedFilterData.equipmentModel!=="",D=this.stateLastUsedFilterData.equipmentModelTo!=="",l=this.stateLastUsedFilterData.weight!=="",o=this.stateLastUsedFilterData.weightTo!=="",h=this.stateLastUsedFilterData.whPerday!=="",c=this.stateLastUsedFilterData.whPerdayTo!=="",S=this.stateLastUsedFilterData.fuelBurn!=="",_=this.stateLastUsedFilterData.fuelBurnTo!=="",m=this.stateLastUsedFilterData.startDate!=="",n=this.stateLastUsedFilterData.startDateTo!=="",I=this.stateLastUsedFilterData.endDate!=="",B=this.stateLastUsedFilterData.endDateTo!=="";(t||s||e||D||l||o||h||c||S||_||m||n||I||B)&&await this.getData()},resetState(){this.stateFilterData={...ht},this.stateDisplayData=[],this.statePagination=new et,this.stateLoading=!1,this.statePaginationLoading=!1}}}),bt={modelWeightId:0,site:"",equipmentModel:"",weight:"",whPerday:"",fuelBurn:"",startDate:E(new Date),endDate:E(new Date("12/31/9999"))},ft=gt({id:"modelWeightForm",state:()=>({stateFormData:{...bt},stateIsError:!1,stateError:"",stateErrors:[],stateLoading:!1,stateSiteOption:[],stateEquipmentModelOption:[],stateEquipmentTypeOption:[],stateIsEdit:!1}),getters:{formData:t=>t.stateFormData,error:t=>t.stateError,errors:t=>t.stateErrors,isError:t=>t.stateIsError,loading:t=>t.stateLoading,siteOption:t=>t.stateSiteOption,equipmentModelOption:t=>t.stateEquipmentModelOption,equipmentTypeOption:t=>t.stateEquipmentTypeOption,isEdit:t=>t.stateIsEdit},actions:{async getLookup(){const t={ver:"v1"};try{const s=await R.get(ae,"",new URLSearchParams(t).toString()),e=await R.get(se,"",new URLSearchParams(t).toString());this.stateSiteOption=at(s.data.result.content,"siteId","siteCode","siteDescription"),this.stateEquipmentModelOption=at(e.data.result.content,"equipmentModel","brand","equipmentModelDescription")}catch(s){s.response.data.statusCode==401&&W().setLoggedIn(!1),z("IRONS",s),console.log(s)}},async insertData(t){try{this.stateLoading=!0;const s={userAccount:t,ver:"v1"},e={modelWeightId:0,site:this.stateFormData.site,equipmentModel:this.stateFormData.equipmentModel,weight:this.stateFormData.weight,whPerday:this.stateFormData.whPerday,fuelBurn:this.stateFormData.fuelBurn,startDate:M(E(new Date(this.stateFormData.startDate))),endDate:M(E(new Date(this.stateFormData.endDate)))},D=await R.post(`${pe}?${new URLSearchParams(s).toString()}`,e);D.data.title==="Error"?(this.stateErrors.push(D.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&W().setLoggedIn(!1),this.stateError=s,this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0,z("IRONS",s)}this.stateLoading=!1},async updateData(t){try{this.stateLoading=!0;const s={userAccount:t,ver:"v1"},e={modelWeightId:this.stateFormData.modelWeightId,site:this.stateFormData.site,equipmentModel:this.stateFormData.equipmentModel,weight:this.stateFormData.weight,whPerday:this.stateFormData.whPerday,fuelBurn:this.stateFormData.fuelBurn,startDate:M(E(new Date(this.stateFormData.startDate))),endDate:M(E(new Date(this.stateFormData.endDate)))},D=await R.post(`${ge}?${new URLSearchParams(s).toString()}`,e);D.data.title==="Error"?(this.stateErrors.push(D.data.result.message),this.stateIsError=!0):(this.stateError="",this.stateIsError=!1)}catch(s){s.response.data.statusCode==401&&W().setLoggedIn(!1),this.stateError=s,this.stateErrors.push(s.response.data.result.message),this.stateIsError=!0,z("IRONS",s)}this.stateLoading=!1},setErrors(t){this.stateErrors=t,this.stateIsError=this.stateErrors.length>0},setFormData(t){this.stateFormData.modelWeightId=t.modelWeightId,this.stateFormData.site=t.site,this.stateFormData.equipmentModel=t.equipmentModel,this.stateFormData.weight=t.weight,this.stateFormData.whPerday=t.whPerday,this.stateFormData.fuelBurn=t.fuelBurn,this.stateFormData.startDate=t.startDate,this.stateFormData.endDate=t.endDate},resetState(){this.stateFormData={...bt},this.stateIsError=!1,this.stateError="",this.stateErrors=[],this.stateLoading=!1},setIsEdit(t){this.stateIsEdit=t}}}),De=t=>(Tt("data-v-90034b41"),t=t(),It(),t),fe={key:0,style:{height:"100px"}},ve={key:1},we={key:1},ye={key:1},Se={key:1},Fe={key:1},be={key:0,class:"d-flex align-items-center"},_e=De(()=>g("span",{class:"mx-1 w-20"},"to",-1)),Pe={key:1,class:"row justify-content-center"},Ee={key:0,class:"d-flex justify-content-end"},Te=["disabled","onClick"],Ie=["onClick"],ke={key:1,class:"d-flex"},Be=K({__name:"Grid",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},emits:["show-dialog","fetch-data","duplicateData"],setup(t,{emit:s}){const e=t,D=W(),l=Dt(),o=ft(),h=s,c=C(()=>(e.page-1)*10+1),S=V(""),_=F=>{S.value=F.order;const r={prop:F.prop,order:F.order};l.setSort(r)},m=V({modelWeightId:0,site:"",equipmentModel:"",weight:"",whPerday:"",fuelBurn:"",startDate:E(new Date),endDate:E(new Date("12/31/9999"))}),n=V({modelWeightId:0,site:"",equipmentModel:"",weight:"",whPerday:"",fuelBurn:"",startDate:E(new Date),endDate:E(new Date("12/31/9999"))}),I=F=>{n.value={...F}},B=()=>{L(),setTimeout(()=>{n.value=Object.assign({},m.value)},300),o.resetState(),o.setIsEdit(!1)},O=Bt().shape({site:G().required("Site is mandatory"),equipmentModel:G().required("Equipment Model is mandatory"),weight:st().required("Weight is mandatory").typeError("Weight must be number"),whPerday:G().required("Wh Perday is mandatory").typeError("Wh Perday must be number"),fuelBurn:st().required("Fuel Burn is mandatory").typeError("Fuel Burn must be number"),startDate:ot().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:ot().required("End Date is mandatory").min(qt("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),L=()=>{o.setErrors([])},w=C(()=>o.isError),b=C(()=>o.errors),f=C(()=>o.isEdit),x=async()=>{o.setIsEdit(!0),L(),await O.validate(n.value,{abortEarly:!1}).catch(F=>{o.setErrors(F.errors),window&&window.scrollTo(0,0)}),!w.value&&tt("Are you sure you want to submit ?").then(async F=>{F.isConfirmed&&(o.setFormData(n.value),o.updateData(D.user.Name).then(()=>{o.isError||ct("Form has been successfully submitted!","Ok").then(()=>{B(),h("fetch-data",null)})}))})},A=async F=>{o.setFormData(F),h("duplicateData",!0)};return(F,r)=>{const k=N("inline-svg"),d=N("el-tooltip"),U=mt("loading");return i(l).loading?X((v(),q("div",fe,null,512)),[[U,i(l).loading]]):(v(),q(Et,{key:1},[a(Pt,{name:"fade"},{default:p(()=>[w.value&&f.value?(v(),T(Mt,{key:0,errorMessages:b.value,onResetForm:L},null,8,["errorMessages"])):lt("",!0)]),_:1}),X((v(),T(i(kt),{data:e.listData,style:{width:"100%"},onSortChange:_,"empty-text":"No Data"},{default:p(()=>[a(i(P),{label:"No",width:"90",align:"center"},{default:p(u=>[g("span",null,$(c.value+u.$index),1)]),_:1}),a(i(P),{prop:"site",label:"Site","min-width":"170",sortable:"","sort-method":(u,y)=>i(Y)(S.value)},{default:p(({row:u})=>[u.modelWeightId===n.value.modelWeightId?(v(),T(it,{key:0,value:n.value.site,placeholder:"Add Site",name:"Site",max:10,onHandleChange:r[0]||(r[0]=y=>n.value.site=y),options:i(o).siteOption},null,8,["value","options"])):(v(),q("span",ve,$(u.site),1))]),_:1},8,["sort-method"]),a(i(P),{prop:"equipmentModel",label:"Equipment Model","min-width":"170",sortable:"","sort-method":(u,y)=>i(Y)(S.value)},{default:p(({row:u})=>[u.modelWeightId===n.value.modelWeightId?(v(),T(it,{key:0,value:n.value.equipmentModel,placeholder:"Add Equipment Model",name:"EquipmentModel",max:20,onHandleChange:r[1]||(r[1]=y=>n.value.equipmentModel=y),options:i(o).equipmentModelOption},null,8,["value","options"])):(v(),q("span",we,$(u.equipmentModel),1))]),_:1},8,["sort-method"]),a(i(P),{prop:"weight",label:"Weight","min-width":"170",sortable:"","sort-method":(u,y)=>i(Y)(S.value)},{default:p(({row:u})=>[u.modelWeightId===n.value.modelWeightId?(v(),T(Ct,{key:0,value:n.value.weight,margin:!1,placeholder:"Add Weight",name:"Weight",max:10,onHandleChange:r[2]||(r[2]=y=>n.value.weight=y)},null,8,["value"])):(v(),q("span",ye,$(u.weight),1))]),_:1},8,["sort-method"]),a(i(P),{prop:"whPerday",label:"Wh Perday","min-width":"170",sortable:"","sort-method":(u,y)=>i(Y)(S.value)},{default:p(({row:u})=>[u.modelWeightId===n.value.modelWeightId?(v(),T(nt,{key:0,value:n.value.whPerday,placeholder:"Add Wh Perday",name:"WhPerday",max:20,onHandleChange:r[3]||(r[3]=y=>n.value.whPerday=y)},null,8,["value"])):(v(),q("span",Se,$(u.whPerday),1))]),_:1},8,["sort-method"]),a(i(P),{prop:"fuelBurn",label:"Fuel Burn","min-width":"170",sortable:"","sort-method":(u,y)=>i(Y)(S.value)},{default:p(({row:u})=>[u.modelWeightId===n.value.modelWeightId?(v(),T(nt,{key:0,value:n.value.fuelBurn,placeholder:"Add Fuel Burn",name:"FuelBurn",max:20,options:i(o).equipmentTypeOption,onHandleChange:r[4]||(r[4]=y=>n.value.fuelBurn=y)},null,8,["value","options"])):(v(),q("span",Fe,$(u.fuelBurn),1))]),_:1},8,["sort-method"]),a(i(P),{prop:"isActive",label:"Is Active",width:n.value.modelWeightId!=0?350:100,sortable:"",align:"center"},{default:p(u=>[u.row.modelWeightId===n.value.modelWeightId?(v(),q("div",be,[a(rt,{value:n.value.startDate,placeholder:"Add Start Date",name:"StartDate",onHandleChange:r[5]||(r[5]=y=>n.value.startDate=y)},null,8,["value"]),_e,a(rt,{value:n.value.endDate,placeholder:"Add End Date",name:"EndDate",onHandleChange:r[6]||(r[6]=y=>n.value.endDate=y)},null,8,["value"])])):(v(),q("div",Pe,[u.row.isActive?(v(),T(k,{key:0,src:"/media/svg/tables/rows/check.svg"})):(v(),T(k,{key:1,src:"/media/svg/tables/rows/minus.svg"}))]))]),_:1},8,["width"]),a(i(P),{label:"",width:"100"},{default:p(u=>[u.row.modelWeightId!==n.value.modelWeightId?(v(),q("div",Ee,[a(d,{class:"box-item",effect:"dark",content:u.row.isActive?"Edit":"Inactive data cannot be edited",placement:"top"},{default:p(()=>[g("div",null,[g("button",{disabled:!u.row.isActive,class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:y=>I(u.row)},[a(k,{src:"/media/svg/tables/rows/pencil-edit-blue.svg",width:"12",height:"12"})],8,Te)])]),_:2},1032,["content"]),a(d,{class:"box-item",effect:"dark",content:"Add new data based on table rows",placement:"top"},{default:p(()=>[g("div",null,[g("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:y=>A(u.row)},[a(k,{src:"/media/svg/tables/rows/paste-icon-button-blue.svg",width:"12",height:"12"})],8,Ie)])]),_:2},1024)])):(v(),q("div",ke,[a(d,{class:"box-item",effect:"dark",content:"Save",placement:"top"},{default:p(()=>[g("button",{class:"btn btn-sm btn-icon btn-bg-light me-3",onClick:yt(x,["prevent"])},[a(k,{src:"/media/svg/tables/rows/save.svg",width:"12",height:"12"})])]),_:1}),a(d,{class:"box-item",effect:"dark",content:"Cancel",placement:"top"},{default:p(()=>[g("button",{class:"btn btn-sm btn-icon btn-bg-light",onClick:yt(B,["prevent"])},[a(k,{src:"/media/svg/tables/rows/valid-false.svg",width:"12",height:"12"})])]),_:1})]))]),_:1})]),_:1},8,["data"])),[[U,i(l).loading]])],64))}}}),qe=Lt(Be,[["__scopeId","data-v-90034b41"]]),Me={class:"col-md-6 fv-row fv-plugins-icon-container"},Ce={class:"col-md-6 fv-row fv-plugins-icon-container"},Le={class:"dialog-footer"},Ue=K({__name:"FormAddDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const e=t,D=s,l=ft(),o=W(),h=pt(e,"visibility"),c=C(()=>l.formData),S=C(()=>l.errors),_=C(()=>l.isError),m=C(()=>l.isEdit),n=Bt().shape({site:G().required("Site is mandatory"),equipmentModel:G().required("Equipment Model is mandatory"),weight:st().required("Weight is mandatory").typeError("Weight must be number"),whPerday:G().required("Wh Perday is mandatory").typeError("Wh Perday must be number"),fuelBurn:st().required("Fuel Burn is mandatory").typeError("Fuel Burn must be number"),startDate:ot().required("Start Date is mandatory").typeError("Start Date is mandatory"),endDate:ot().required("End Date is mandatory").min(qt("startDate"),"End date must be later than start date").typeError("End date must be later than start date")}),I=(r=!1)=>{F(),l.resetState(),D("handle-close",r)},B=r=>{c.value.site=r},O=r=>{c.value.equipmentModel=r},L=r=>{c.value.weight=r},w=r=>{c.value.whPerday=r},b=r=>{c.value.fuelBurn=r},f=r=>{c.value.startDate=r},x=r=>{c.value.endDate=r},A=async()=>{F(),await n.validate(c.value,{abortEarly:!1}).catch(r=>{l.setErrors(r.errors)}),!_.value&&tt("Are you sure you want to submit ?").then(async r=>{r.isConfirmed&&l.insertData(o.user.Name).then(()=>{l.isError||ct("Form has been successfully submitted!","Ok").then(()=>{I(!0)})})})},F=()=>{l.setErrors([])};return(r,k)=>{const d=N("el-button"),U=N("el-dialog"),u=mt("loading");return X((v(),T(U,{modelValue:h.value,"onUpdate:modelValue":k[0]||(k[0]=y=>h.value=y),title:"New Data",width:"40%",onClose:k[1]||(k[1]=y=>I())},{footer:p(()=>[g("span",Le,[a(d,{type:"primary",onClick:A,disabled:i(l).loading},{default:p(()=>[H("Submit")]),_:1},8,["disabled"]),a(d,{type:"secondary",onClick:I,disabled:i(l).loading},{default:p(()=>[H("Close")]),_:1},8,["disabled"])])]),default:p(()=>[a(Pt,{name:"fade"},{default:p(()=>[_.value&&!m.value?(v(),T(Mt,{key:0,errorMessages:S.value,onResetForm:F},null,8,["errorMessages"])):lt("",!0)]),_:1}),X((v(),T(i(oe),{id:"kt_filter_form",class:"row g-9 my-4"},{default:p(()=>[a(it,{value:c.value.site,placeholder:"Add Site",label:"Site",name:"Site",max:10,onHandleChange:B,options:i(l).siteOption},null,8,["value","options"]),a(it,{value:c.value.equipmentModel,placeholder:"Add Equipment Model",label:"Equipment Model",name:"EquipmentModel",max:20,onHandleChange:O,options:i(l).equipmentModelOption},null,8,["value","options"]),a(Ct,{value:c.value.weight,margin:!1,placeholder:"Add Weight",label:"Weight",name:"Weight",max:10,onHandleChange:L},null,8,["value"]),a(nt,{value:c.value.whPerday,placeholder:"Add Wh Perday",label:"Wh Perday",name:"WhPerday",max:20,onHandleChange:w},null,8,["value"]),a(nt,{value:c.value.fuelBurn,margin:!1,placeholder:"Add Fuel Burn",label:"Fuel Burn",name:"FuelBurn",max:15,onHandleChange:b},null,8,["value"]),g("div",Me,[a(rt,{value:c.value.startDate,placeholder:"Add Start Date",label:"Start Date",name:"StartDate",onHandleChange:f},null,8,["value"])]),g("div",Ce,[a(rt,{value:c.value.endDate,placeholder:"Add End Date",label:"End Date",name:"EndDate",onHandleChange:x},null,8,["value"])])]),_:1})),[[u,i(l).loading]])]),_:1},8,["modelValue"])),[[u,i(l).loading]])}}}),vt=gt({id:"modelWeightBulk",state:()=>({statePagination:new et,stateValidatedData:[],stateDisplayData:[],stateBulkData:[],stateIsError:!1,stateError:"",stateLoading:!1,stateUploadLoading:!1,stateIsUploaded:!1,stateIsSort:!1,stateSortBy:null,stateSortOrder:null}),getters:{validatedData:t=>t.stateValidatedData,displayData:t=>t.stateDisplayData,pagination:t=>t.statePagination,bulkData:t=>t.stateBulkData,error:t=>t.stateError,isError:t=>t.stateIsError,loading:t=>t.stateLoading,uploadLoading:t=>t.stateUploadLoading,isUploaded:t=>t.stateIsUploaded},actions:{async bulkInsert(t){const s={userAccount:t,ver:"v1"};try{this.stateLoading=!0;const e=await R.post(`${ue}?${new URLSearchParams(s).toString()}`,this.stateBulkData);this.stateError=e.data.result.isError?e.data.result.message:"",this.stateIsError=e.data.result.isError}catch(e){e.response.data.statusCode==401&&W().setLoggedIn(!1),this.stateError=e.response.data.result.isError?e.response.data.result.message:"",this.stateIsError=!0,z("IRONS",e),console.log(e)}this.stateLoading=!1},async upload({userAccount:t,excelFile:s}){const e={userAccount:t,ver:"v1"},D=`${he}?${new URLSearchParams(e).toString()}`;try{this.stateIsError=!1,this.stateError="",this.stateValidatedData=[],this.stateDisplayData=[],this.stateUploadLoading=!0;const l=await R.postImages(D,s);l.data.statusCode==200?l.data.result.isError?(this.stateIsError=!0,this.stateError=l.data.result.message):(this.setIsUploadedState(!0),this.stateValidatedData=l.data.result.content,this.setTotalPage(this.stateValidatedData.length),this.stateIsError=ie.some(this.stateValidatedData,{isValid:!1}),this.setPage(1)):(this.stateIsError=l.data.result.isError,this.stateError=l.data.result.message)}catch(l){l.response.data.statusCode==401?W().setLoggedIn(!1):(this.stateIsError=!0,this.stateError=l.response.data.result.message),z("IRONS",l)}this.stateUploadLoading=!1},setTotalPage(t){this.pagination.totalPage=t},setDisplayData(){let t=[...this.stateValidatedData];this.stateIsSort&&(t=t.sort(te(this.stateSortBy,this.stateSortOrder))),this.stateDisplayData=t.slice(this.statePagination.startPaginationIndex,this.statePagination.endPaginationIndex)},setPage(t){this.statePagination.handleCurrentPageChange(t),this.setDisplayData()},setSort(t){this.stateIsSort=t.prop!==null,this.stateSortBy=t.prop,this.stateSortOrder=t.order,this.setPage(1)},setBulkData(t){this.stateBulkData=t},setIsUploadedState(t){this.stateIsUploaded=t},resetState(){this.stateValidatedData=[],this.stateDisplayData=[],this.stateBulkData=[],this.statePagination=new et,this.stateIsError=!1,this.stateError="",this.stateLoading=!1,this.stateUploadLoading=!1,this.stateIsSort=!1,this.stateSortBy=null,this.stateSortOrder=null}}}),We={class:"icon"},Oe=K({__name:"GridBulk",props:{listData:{required:!0,type:Array},page:{required:!0,type:Number,default:1}},setup(t){const s=t,e=V(""),D=vt(),l=C(()=>(s.page-1)*10+1),o=c=>{e.value=c.order;const S={prop:c.prop,order:c.order};D.setSort(S)},h=(c,S,_)=>ee(c[_],S[_],e.value);return(c,S)=>{const _=N("inline-svg");return v(),T(i(kt),{data:s.listData,style:{width:"100%"},onSortChange:o,"empty-text":"No Data"},{default:p(()=>[a(i(P),{label:"No",width:"60",align:"center"},{default:p(m=>[g("span",null,$(l.value+m.$index),1)]),_:1}),a(i(P),{prop:"site",label:"Site",width:"170",sortable:"","sort-method":(m,n)=>h(m,n,"site")},null,8,["sort-method"]),a(i(P),{prop:"equipmentModel",label:"Equipment Model",width:"170",sortable:"","sort-method":(m,n)=>h(m,n,"equipmentModel")},null,8,["sort-method"]),a(i(P),{prop:"weight",label:"Weight",width:"170",sortable:"","sort-method":(m,n)=>h(m,n,"weight")},null,8,["sort-method"]),a(i(P),{prop:"whPerday",label:"Wh Perday",width:"170",sortable:"","sort-method":(m,n)=>h(m,n,"whPerday")},null,8,["sort-method"]),a(i(P),{prop:"fuelBurn",label:"Fuel Burn",width:"170",sortable:"","sort-method":(m,n)=>h(m,n,"fuelBurn")},null,8,["sort-method"]),a(i(P),{prop:"startDate",label:"Start Date",align:"center",width:"170",sortable:""},{default:p(m=>[g("span",null,$(i(St)(m.row.startDate)),1)]),_:1}),a(i(P),{prop:"EndDate",label:"end Date",align:"center",width:"170",sortable:""},{default:p(m=>[g("span",null,$(i(St)(m.row.endDate)),1)]),_:1}),a(i(P),{prop:"validationReason",label:"Remark","min-width":"300",sortable:""}),a(i(P),{prop:"isValid",label:"Status",width:"100",sortable:""},{default:p(m=>[g("div",We,[a(_,{src:m.row.isValid?"/media/svg/tables/rows/valid-true.svg":"/media/svg/tables/rows/valid-false.svg"},null,8,["src"])])]),_:1})]),_:1},8,["data"])}}}),wt=t=>(Tt("data-v-da4da86d"),t=t(),It(),t),xe=wt(()=>g("div",{class:"text-center"},null,-1)),Ae=wt(()=>g("div",{class:"mb-3"},[g("span",null,[H(" Download template "),g("a",{href:"documents/MasterDataModelPriceWeight.xlsx",target:"_blank",id:"link-download"},"here"),H(" before uploading file ")])],-1)),$e=wt(()=>g("div",{class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},[g("div",{class:"d-flex align-items-center position-relative my-0 mb-2"})],-1)),Re={class:"card"},He={class:"card-body grid-padding"},Ne={class:"dialog-footer"},Ve=K({__name:"UploadBulkDialog",props:{visibility:{required:!0,type:Boolean}},emits:["handle-close"],setup(t,{emit:s}){const e=t,D=s,l=W(),o=vt(),h=pt(e,"visibility"),c=()=>{const w=ne(o.validatedData,b=>{const f=b;return{modelWeightId:0,site:f.site,equipmentModel:f.equipmentModel,weight:f.weight,whPerday:f.whPerday,fuelBurn:f.fuelBurn,startDate:f.startDate,endDate:f.endDate}});return Object.values(w)},S=()=>{const w=document.getElementById("link-download");w&&w.click()},_=()=>{o.validatedData.length>0?tt("Cancel Upload Data?","Confirm").then(b=>{b.isConfirmed&&n()}):n()},m=async w=>{await o.upload({userAccount:l.user.Name,excelFile:w}),o.stateError&&Z(o.error)},n=(w=!1)=>{o.resetState(),D("handle-close",w)},I=w=>{o.setIsUploadedState(w)},B=w=>{o.setPage(w)},O=()=>{if(o.validatedData.length<1){S();return}const w=["SITE","EQUIPMENT MODEL","WEIGHT","WH PERDAY","FUEL BURN","START DATE","END DATE","REMARK","STATUS"],b=o.validatedData.map(f=>({site:f.site,equipmentModel:f.equipmentModel,weight:f.weight,whPerday:f.whPerday,fuelBurn:f.fuelBurn,startDate:f.startDate,endDate:f.endDate,remark:f.validationReason,status:f.isValid?"OK":"Error"}));Kt("ModelPriceWeight",w,b)},L=async()=>{if(o.displayData.length<1){Z("There is no data to submit");return}if(o.isError){Z("There is still invalid row(s)");return}tt("Are you sure you want to submit ?").then(async w=>{if(w.isConfirmed){const b=c();if(o.setBulkData(b),await o.bulkInsert(l.user.Name),o.isError){Z(o.stateError);return}ct("Form has been successfully submitted!","Ok").then(()=>{n(!0)})}})};return(w,b)=>{const f=N("el-button"),x=N("el-dialog"),A=mt("loading");return v(),T(x,{title:"Upload Bulk Data",modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=F=>h.value=F),"before-close":_,width:"70%","custom-class":"upload-modal"},{footer:p(()=>[g("div",null,[g("span",Ne,[a(f,{type:"success",onClick:O},{default:p(()=>[H("Download")]),_:1}),a(f,{type:"primary",onClick:L},{default:p(()=>[H("Upload")]),_:1}),a(f,{type:"success",onClick:_},{default:p(()=>[H("Cancel")]),_:1})])])]),default:p(()=>[xe,Ae,X(a(re,{isSubmissionUploadSuccess:i(o).isUploaded,onHandleCloseUploadedFile:_,onHandleUpload:m,onHandleSetIsExcelFileUploaded:I},null,8,["isSubmissionUploadSuccess"]),[[A,i(o).uploadLoading]]),$e,g("div",Re,[g("div",He,[a(Oe,{"list-data":i(o).displayData,page:i(o).pagination.currentPage},null,8,["list-data","page"])])]),i(o).displayData.length>0?(v(),T(_t,{key:0,onRaisePageChange:b[0]||(b[0]=F=>B(F)),currentPage:i(o).pagination.currentPage,totalPage:i(o).pagination.totalPage,totalPageSize:i(o).pagination.totalPageSize,startPaginationIndex:i(o).pagination.startPaginationIndex,endPaginationIndex:i(o).pagination.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"])):lt("",!0)]),_:1},8,["modelValue"])}}}),ze=Lt(Ve,[["__scopeId","data-v-da4da86d"]]),je={class:"row g-9 my-4"},Ge={class:"dialog-footer"},Ke=K({__name:"FilterDialog",props:{visibility:{type:Boolean,default:!1}},emits:["handle-close"],setup(t,{emit:s}){const e=Dt(),D=t,l=s,o=pt(D,"visibility"),h=C(()=>e.filterData),c=()=>{S(),e.resetFilter()},S=()=>{l("handle-close",!1)},_=d=>{e.setSite(d)},m=d=>{e.setSiteTo(d)},n=d=>{e.setEquipmentModel(d)},I=d=>{e.setEquipmentModelTo(d)},B=d=>{e.setWeight(d)},O=d=>{e.setWeightTo(d)},L=d=>{e.setWhPerday(d)},w=d=>{e.setWhPerdayTo(d)},b=d=>{e.setFuelBurn(d)},f=d=>{e.setFuelBurnTo(d)},x=d=>{e.setStartDate(d)},A=d=>{e.setStartDateTo(d)},F=d=>{e.setEndDate(d)},r=d=>{e.setEndDateTo(d)},k=()=>{const d=e.lastUsedFilterData.site!==e.filterData.site,U=e.lastUsedFilterData.siteTo!==e.filterData.siteTo,u=e.lastUsedFilterData.equipmentModel!==e.filterData.equipmentModel,y=e.lastUsedFilterData.equipmentModelTo!==e.filterData.equipmentModelTo,J=e.lastUsedFilterData.weight!==e.filterData.weight,Ut=e.lastUsedFilterData.weightTo!==e.filterData.weightTo,Wt=e.lastUsedFilterData.whPerday!==e.filterData.whPerday,Ot=e.lastUsedFilterData.whPerdayTo!==e.filterData.whPerdayTo,xt=e.lastUsedFilterData.fuelBurn!==e.filterData.fuelBurn,At=e.lastUsedFilterData.fuelBurnTo!==e.filterData.fuelBurnTo,$t=e.lastUsedFilterData.startDate!==e.filterData.startDate,Rt=e.lastUsedFilterData.startDateTo!==e.filterData.startDateTo,Ht=e.lastUsedFilterData.endDate!==e.filterData.endDate,Nt=e.lastUsedFilterData.endDateTo!==e.filterData.endDateTo;l("handle-close",d||U||u||y||J||Ut||Wt||Ot||xt||At||$t||Rt||Ht||Nt)};return(d,U)=>{const u=N("el-button"),y=N("el-dialog");return v(),T(y,{modelValue:o.value,"onUpdate:modelValue":U[0]||(U[0]=J=>o.value=J),title:"Filter",width:"60%",onClose:U[1]||(U[1]=J=>S())},{footer:p(()=>[g("span",Ge,[a(u,{type:"secondary",onClick:c},{default:p(()=>[H("Reset")]),_:1}),a(u,{type:"primary",onClick:k},{default:p(()=>[H("Filter")]),_:1})])]),default:p(()=>[g("div",je,[a(Q,{"value-from":h.value.site,"value-to":h.value.siteTo,label:"Site",name:"Site",options:i(e).siteOption,onHandleChangeFrom:_,onHandleChangeTo:m},null,8,["value-from","value-to","options"]),a(Q,{"value-from":h.value.equipmentModel,"value-to":h.value.equipmentModelTo,label:"Equipment Model",name:"Equipment Model",options:i(e).equipmentModelOption,onHandleChangeFrom:n,onHandleChangeTo:I},null,8,["value-from","value-to","options"]),a(Q,{"value-from":h.value.weight,"value-to":h.value.weightTo,label:"Weight",name:"Weight",options:i(e).weightOption,onHandleChangeFrom:B,onHandleChangeTo:O},null,8,["value-from","value-to","options"]),a(Q,{"value-from":h.value.whPerday,"value-to":h.value.whPerdayTo,label:"Wh Perday",name:"WhPerday",options:i(e).whPerdayOption,onHandleChangeFrom:L,onHandleChangeTo:w},null,8,["value-from","value-to","options"]),a(Q,{"value-from":h.value.fuelBurn,"value-to":h.value.fuelBurnTo,label:"Fuel Burn",name:"FuelBurn",options:i(e).fuelBurnOption,onHandleChangeFrom:b,onHandleChangeTo:f},null,8,["value-from","value-to","options"]),a(Ft,{"value-from":h.value.startDate?h.value.startDate.toString():"","value-to":h.value.startDateTo?h.value.startDateTo.toString():"",label:"Start Date",name:"StartDate",placeholder:"Pick a date",onHandleChangeFrom:x,onHandleChangeTo:A},null,8,["value-from","value-to"]),a(Ft,{"value-from":h.value.endDate?h.value.endDate.toString():"","value-to":h.value.endDateTo?h.value.endDateTo.toString():"",label:"End Date",name:"EndDate",placeholder:"Pick a date",onHandleChangeFrom:F,onHandleChangeTo:r},null,8,["value-from","value-to"])])]),_:1},8,["modelValue"])}}}),Ye={class:"grid-icon-buttons d-flex justify-content-between flex-wrap align-items-center"},Qe=g("div",{class:"d-flex align-items-center position-relative my-0"},null,-1),Xe={class:"d-flex justify-content-between align-items-center"},Je={class:"card"},Ze={class:"card-body grid-padding"},ta={class:"my-5"},us=K({__name:"Index",setup(t){const s=Vt(),e=Dt(),D=ft(),l=vt(),o=V(!1),h=V(!1),c=V(!1),S=V(!1),_=C(()=>e.displayData),m=C(()=>e.pagination),n=r=>{e.setPage(r),D.setIsEdit(!1)};Jt(async()=>{s.dispatch(jt.ACTIVE_PAGE,dt().meta.parentMenu),zt("Model Price Weight",[{pageName:dt().meta.parentMenu,pageRoute:dt().meta.parentMenu.toLowerCase()},{pageName:"IronPortal Configuration",pageRoute:"ironlake-config-modelweight"},{pageName:"Model Price Weight",pageRoute:"ironlake-config-modelweight"}]),e.setPage(1),await e.getLookup(),await D.getLookup()}),Zt(async()=>{e.resetState(),D.resetState(),l.resetState()});const I=async()=>{await e.setPage(1),await e.getLookup(),await D.getLookup()},B=()=>{o.value=!0,D.setIsEdit(!1),D.setErrors([]),D.resetState()},O=async r=>{o.value=!1,r&&await I()},L=()=>{h.value=!0},w=()=>{c.value=!0},b=async r=>{c.value=!1,r&&await I()},f=async()=>{const r=await e.export();le.saveAs(new Blob([r],{type:"application/octet-stream"}),"ModelPriceWeight.xlsx")},x=()=>{S.value=!0},A=async r=>{S.value=!1,r&&await I()},F=()=>{o.value=!0,D.setIsEdit(!1),D.setErrors([])};return(r,k)=>(v(),q(Et,null,[g("div",Ye,[Qe,g("div",Xe,[a(Yt,{onShowDialog:B}),a(Gt,{onShowDialog:w}),a(Xt,{onHandleDownload:f}),a(Qt,{onShowDialog:x})])]),g("div",Je,[g("div",Ze,[a(qe,{"list-data":_.value,page:m.value.currentPage,onShowDialog:L,onFetchData:I,onDuplicateData:F},null,8,["list-data","page"])])]),g("div",ta,[i(e).paginationLoading?lt("",!0):(v(),T(_t,{key:0,onRaisePageChange:k[0]||(k[0]=d=>n(d)),currentPage:m.value.currentPage,totalPage:m.value.totalPage,totalPageSize:m.value.totalPageSize,startPaginationIndex:m.value.startPaginationIndex,endPaginationIndex:m.value.endPaginationIndex},null,8,["currentPage","totalPage","totalPageSize","startPaginationIndex","endPaginationIndex"]))]),a(Ue,{visibility:o.value,onHandleClose:O},null,8,["visibility"]),a(Ke,{visibility:c.value,onHandleClose:b},null,8,["visibility"]),a(ze,{visibility:S.value,onHandleClose:A},null,8,["visibility"])],64))}});export{us as default};
