import{d as b}from"./pinia-BjOS2_Ao.js";import{y as l,z as m,a as h,c as a}from"./index-BuVmIl8K.js";var O=(e=>(e.GET_PBI_CONFIG="getPbiConfig",e.POST_PBI_CONFIG="postPbiConfig",e.GET_MINING_PBI_ROLE="getMiningPbiRole",e))(O||{}),_=(e=>(e.SET_PBI_CONFIG="setPbiConfig",e.SET_LOADING="setLoading",e.SET_PBI_URL="setPBIUrl",e.SET_IS_PBI_URL_COMPLETE_URL="setIsPBIUrlCompleteUrl",e.SET_FIRST_INIT="setPbiFirstInit",e.SET_DATE_FILTER="setDateFilter",e))(_||{}),E=(e=>(e.UPDATE_ERROR="updateError",e.RESET_ERROR="resetError",e.UPDATE_FORM_INPUT_ERROR="updateFormInputError",e.RESET_FORM_INPUT_ERROR="resetFormInputError",e.TRIGGER_SWAL_ERROR_RESPONSE="triggerSwalErrorResponse",e.TRIGGER_SWAL_ERROR_BULK_RESPONSE="triggerSwalErrorBulkResponse",e.UPDATE_ERROR_TO_PAGE="updateErrorToPage",e))(E||{}),t=(e=>(e.SET_IS_ERROR="setIsError",e.SET_ERROR_RESPONSE="setErrorResponse",e.SET_FORM_INPUT_ERROR_MESSAGES="setformSubmitErrorMessages",e.SET_IS_FORM_INPUT_ERROR="setIsFormInputError",e.SET_ERROR_PAGES="setErrorPages",e.SET_ERROR_ON_PAGES="setErrorOnPages",e))(t||{});const p=b("errorHandle",{state:()=>({isError:!1,errorResponse:{},errorPages:{},isFromSubmitError:!1,formSubmitErrorMessages:[]}),getters:{getIsError:e=>e.isError,getErrorResponse:e=>e.errorResponse,getErrorPages:e=>e.errorPages,getformSubmitErrorMessages:e=>e.formSubmitErrorMessages,getIsFromSubmitError:e=>e.isFromSubmitError},actions:{[t.SET_IS_ERROR](e){this.isError=e},[t.SET_ERROR_RESPONSE](e){this.errorResponse=e},[t.SET_ERROR_PAGES](e){this.errorPages[e]={}},[t.SET_ERROR_ON_PAGES](e){this.errorPages[e.page]||(this.errorPages[e.page]={}),this.errorPages[e.page][e.name]={message:e.message,status:e.status!==void 0?e.status:""}},async[E.UPDATE_ERROR_TO_PAGE](e){this[t.SET_ERROR_ON_PAGES](e),e.type==="unhandledError"&&(typeof e.status>"u"||e.status)?this[E.TRIGGER_SWAL_ERROR_RESPONSE](e.message):e.type==="unhandledErrorBulk"&&(typeof e.status>"u"||e.status)&&this[E.TRIGGER_SWAL_ERROR_BULK_RESPONSE](e.message)},async[E.UPDATE_ERROR](e){await this[E.RESET_ERROR](),this[t.SET_IS_ERROR](e.status),this[t.SET_ERROR_RESPONSE](e.errorResponse),this[E.TRIGGER_SWAL_ERROR_RESPONSE](this.getErrorResponse.message)},[E.TRIGGER_SWAL_ERROR_RESPONSE](e){l(e,"OK")},[E.TRIGGER_SWAL_ERROR_BULK_RESPONSE](e){m(e)},[E.RESET_ERROR](){this[t.SET_IS_ERROR](!1),this[t.SET_ERROR_RESPONSE]({})},[t.SET_FORM_INPUT_ERROR_MESSAGES](e){this.formSubmitErrorMessages=e},[t.SET_IS_FORM_INPUT_ERROR](e){this.isFromSubmitError=e},async[E.UPDATE_FORM_INPUT_ERROR](e){this[E.RESET_FORM_INPUT_ERROR](),this[t.SET_IS_FORM_INPUT_ERROR](e.status),this[t.SET_FORM_INPUT_ERROR_MESSAGES](e.errorMessages)},[E.RESET_FORM_INPUT_ERROR](){this[t.SET_IS_FORM_INPUT_ERROR](!1),this[t.SET_FORM_INPUT_ERROR_MESSAGES]([])}}}),s=class s{constructor(r){this.store=h(),this.pbiConfig=r}getPbiConfig(){return this.pbiConfig}setPbiConfig(r){this.pbiConfig=r}setPbiUrl(r){s.baseUrl=r}setPbiIsCompleteUrl(r){s.isCompleteUrl=r}getApiPbiConfig(r){const o=r.reportName,S=`${r.workspaceId}/${r.reportId}`,i=`${s.baseUrl}/api/embed_info/${o}?ver=v1`,n=`${s.baseUrl}/api/embed_info/${S}?ver=v1`;return new Promise((g,I)=>{r.isPublic?a.publicGet(n).then(({data:R})=>{if(R.statusCode===200){const P=R.result.content;this.pbiConfig=P,g()}else s.callErrorAction(r,R)}).catch(({response:R})=>{I(),s.callErrorAction(r,R.data)}):a.get(i).then(({data:R})=>{if(R.statusCode===200){const P=R.result.content;this.pbiConfig=P,g()}else s.callErrorAction(r,R)}).catch(({response:R})=>{console.log("response ERROR PBI"),console.log(R),I(),s.callErrorAction(r,R.data)})})}postApiPbiConfig(r){if(this.store.user.email)return new Promise((o,S)=>{a.post(s.isCompleteUrl?s.baseUrl:`${s.baseUrl}/api/embed_info/?ver=v1`,{reportName:r.reportName,email:this.store.user.email}).then(({data:i})=>{if(i.statusCode===200){const n=i.result.content;this.pbiConfig=n,o()}else s.callErrorAction(r,i)}).catch(({response:i})=>{S(),s.callErrorAction(r,i.data)})})}static callErrorAction(r,o){let S="";if("message"in o)S=o.message;else{const i=o.result.message,n=o.result.content;S=i||n}this.errorStore[E.UPDATE_ERROR_TO_PAGE]({page:r.pageName,type:"unhandledError",name:`get-${r.pageName}-PbiEmbed`,message:`${o.statusCode} - ${S}`})}};s.baseUrl="",s.isCompleteUrl=!1,s.errorStore=p();let T=s;const c=b("pbiEmbedded",{state:()=>({pbiConfig:{type:"",embedReport:[{reportId:"",reportName:"",embedUrl:""}],embedToken:{token:"",tokenId:"",expiration:""}},pbi:new T({type:"",embedReport:[{reportId:"",reportName:"",embedUrl:""}],embedToken:{token:"",tokenId:"",expiration:""}}),loading:!1,firstInit:!0,date:null}),getters:{getPbiReportComponent:e=>e.firstInit,getDashboardConfigPbi:e=>e.pbi.getPbiConfig(),getIsDashboardConfigLoading:e=>e.loading,getPbiSelectedDate:e=>e.date},actions:{[_.SET_FIRST_INIT](e){this.firstInit=e},[_.SET_PBI_CONFIG](e){this.pbi.setPbiConfig(e)},[_.SET_LOADING](e){this.loading=e},[_.SET_PBI_URL](e){this.pbi.setPbiUrl(e)},[_.SET_IS_PBI_URL_COMPLETE_URL](){this.pbi.setPbiIsCompleteUrl(!0)},[_.SET_DATE_FILTER](e){this.date=e},async[O.GET_PBI_CONFIG](e){await this.pbi.getApiPbiConfig(e),this[_.SET_LOADING](!1)},async[O.POST_PBI_CONFIG](e){await this.pbi.postApiPbiConfig(e),this[_.SET_LOADING](!1)}}});export{O as A,_ as M,p as a,t as b,c as u};
